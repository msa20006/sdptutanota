{"version":3,"file":"OpenMailboxHandler.js","sourceRoot":"","sources":["../../../../../src/mail-app/native/main/OpenMailboxHandler.ts"],"names":[],"mappings":"AAAA,OAAO,CAAC,MAAM,SAAS,CAAA;AACvB,OAAO,EAAE,WAAW,EAAE,MAAM,iDAAiD,CAAA;AAC7E,OAAO,EAAE,aAAa,EAAE,MAAM,uBAAuB,CAAA;AACrD,OAAO,EAAE,wBAAwB,EAAE,MAAM,+BAA+B,CAAA;AACxE,OAAO,EAAE,YAAY,EAAE,MAAM,iDAAiD,CAAA;AAK9E;;GAEG;AACH,MAAM,OAAO,kBAAkB;IACD;IAA0C;IAAuC;IAA9G,YAA6B,MAAuB,EAAmB,SAAoB,EAAmB,YAA0B;QAA3G,WAAM,GAAN,MAAM,CAAiB;QAAmB,cAAS,GAAT,SAAS,CAAW;QAAmB,iBAAY,GAAZ,YAAY,CAAc;IAAG,CAAC;IAE5I,KAAK,CAAC,WAAW,CAAC,MAAU,EAAE,WAAmB,EAAE,aAA4B;QAC9E,IAAI,IAAI,CAAC,MAAM,CAAC,cAAc,EAAE,IAAI,IAAI,CAAC,MAAM,CAAC,iBAAiB,EAAE,CAAC,IAAI,CAAC,GAAG,KAAK,MAAM,EAAE,CAAC;YACzF,IAAI,CAAC,aAAa,EAAE,CAAC;gBACpB,MAAM,CAAC,aAAa,CAAC,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,iBAAiB,EAAE,CAAA;gBACnE,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,SAAS,CAAC,sBAAsB,CAAC,aAAa,CAAC,aAAa,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,CAAA;gBAC7G,MAAM,KAAK,GAAG,wBAAwB,CAAC,OAAO,EAAE,WAAW,CAAC,KAAK,CAAC,CAAA;gBAClE,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,GAAG,YAAY,CAAC,KAAK,CAAC,CAAC,CAAA;YAC5C,CAAC;iBAAM,CAAC;gBACP,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,OAAO,GAAG,aAAa,CAAC,CAAA;YACrC,CAAC;QACF,CAAC;aAAM,CAAC;YACP,IAAI,CAAC,aAAa,EAAE,CAAC;gBACpB,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,mCAAmC,MAAM,cAAc,WAAW,EAAE,CAAC,CAAA;YAClF,CAAC;iBAAM,CAAC;gBACP,MAAM,iBAAiB,GAAG,QAAQ,aAAa,EAAE,CAAA;gBACjD,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,mCAAmC,MAAM,cAAc,WAAW,kBAAkB,kBAAkB,CAAC,iBAAiB,CAAC,EAAE,CAAC,CAAA;YACzI,CAAC;QACF,CAAC;IACF,CAAC;CACD","sourcesContent":["import m from \"mithril\"\nimport { MailSetKind } from \"../../../common/api/common/TutanotaConstants.js\"\nimport { assertNotNull } from \"@tutao/tutanota-utils\"\nimport { assertSystemFolderOfType } from \"../../mail/model/MailUtils.js\"\nimport { getElementId } from \"../../../common/api/common/utils/EntityUtils.js\"\nimport { LoginController } from \"../../../common/api/main/LoginController.js\"\nimport { MailModel } from \"../../mail/model/MailModel.js\"\nimport { MailboxModel } from \"../../../common/mailFunctionality/MailboxModel.js\"\n\n/**\n * Handles requests for opening mailbox paths from native.\n */\nexport class OpenMailboxHandler {\n\tconstructor(private readonly logins: LoginController, private readonly mailModel: MailModel, private readonly mailboxModel: MailboxModel) {}\n\n\tasync openMailbox(userId: Id, mailAddress: string, requestedPath: string | null): Promise<void> {\n\t\tif (this.logins.isUserLoggedIn() && this.logins.getUserController().user._id === userId) {\n\t\t\tif (!requestedPath) {\n\t\t\t\tconst [mailboxDetail] = await this.mailboxModel.getMailboxDetails()\n\t\t\t\tconst folders = await this.mailModel.getMailboxFoldersForId(assertNotNull(mailboxDetail.mailbox.folders)._id)\n\t\t\t\tconst inbox = assertSystemFolderOfType(folders, MailSetKind.INBOX)\n\t\t\t\tm.route.set(\"/mail/\" + getElementId(inbox))\n\t\t\t} else {\n\t\t\t\tm.route.set(\"/mail\" + requestedPath)\n\t\t\t}\n\t\t} else {\n\t\t\tif (!requestedPath) {\n\t\t\t\tm.route.set(`/login?noAutoLogin=false&userId=${userId}&loginWith=${mailAddress}`)\n\t\t\t} else {\n\t\t\t\tconst fullRequestedPath = `/mail${requestedPath}`\n\t\t\t\tm.route.set(`/login?noAutoLogin=false&userId=${userId}&loginWith=${mailAddress}&requestedPath=${encodeURIComponent(fullRequestedPath)}`)\n\t\t\t}\n\t\t}\n\t}\n}\n"]}