{"version":3,"file":"SearchBarOverlay.js","sourceRoot":"","sources":["../../../../src/mail-app/search/SearchBarOverlay.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Entry, SearchBarState, ShowMoreAction } from \"./SearchBar\"\nimport { px, size } from \"../../common/gui/size\"\nimport { lang } from \"../../common/misc/LanguageViewModel\"\nimport { Button, ButtonType } from \"../../common/gui/base/Button.js\"\nimport { Icons } from \"../../common/gui/base/icons/Icons\"\nimport { downcast, isEmpty, isSameTypeRef, TypeRef } from \"@tutao/tutanota-utils\"\nimport { FULL_INDEXED_TIMESTAMP } from \"../../common/api/common/TutanotaConstants\"\nimport { formatDate, formatTimeOrDateOrYesterday } from \"../../common/misc/Formatter\"\nimport type { CalendarEvent, Contact, Mail } from \"../../common/api/entities/tutanota/TypeRefs.js\"\nimport { CalendarEventTypeRef, ContactTypeRef, MailTypeRef } from \"../../common/api/entities/tutanota/TypeRefs.js\"\nimport Badge from \"../../common/gui/base/Badge\"\nimport { Icon } from \"../../common/gui/base/Icon\"\nimport { client } from \"../../common/misc/ClientDetector\"\nimport m, { Children, Component, Vnode } from \"mithril\"\nimport { theme } from \"../../common/gui/theme\"\nimport { getMailFolderIcon, isTutanotaTeamMail } from \"../mail/view/MailGuiUtils\"\nimport { locator } from \"../../common/api/main/CommonLocator\"\nimport { IndexingErrorReason } from \"../../common/api/worker/search/SearchTypes\"\nimport { companyTeamLabel } from \"../../common/misc/ClientConstants.js\"\nimport { getTimeZone } from \"../../common/calendar/date/CalendarUtils.js\"\n\nimport { formatEventDuration } from \"../../calendar-app/calendar/gui/CalendarGuiUtils.js\"\nimport { getContactListName } from \"../../common/contactsFunctionality/ContactUtils.js\"\n\nimport { getSenderOrRecipientHeading } from \"../mail/view/MailViewerUtils.js\"\nimport { mailLocator } from \"../mailLocator.js\"\n\ntype SearchBarOverlayAttrs = {\n\tstate: SearchBarState\n\tisQuickSearch: boolean\n\tisFocused: boolean\n\tselectResult: (result: Entry | null) => void\n}\n\nexport class SearchBarOverlay implements Component<SearchBarOverlayAttrs> {\n\tview({ attrs }: Vnode<SearchBarOverlayAttrs>): Children {\n\t\tconst { state } = attrs\n\t\treturn [\n\t\t\tthis._renderIndexingStatus(state, attrs),\n\t\t\tstate.entities && !isEmpty(state.entities) && attrs.isQuickSearch && attrs.isFocused ? this.renderResults(state, attrs) : null,\n\t\t]\n\t}\n\n\trenderResults(state: SearchBarState, attrs: SearchBarOverlayAttrs): Children {\n\t\treturn m(\"ul.list.click.mail-list\", [\n\t\t\tstate.entities.map((result) => {\n\t\t\t\treturn m(\n\t\t\t\t\t\"li.plr-l.flex-v-center.\",\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\theight: px(52),\n\t\t\t\t\t\t\t\"border-left\": px(size.border_selection) + \" solid transparent\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\t// avoid closing overlay before the click event can be received\n\t\t\t\t\t\tonmousedown: (e: MouseEvent) => e.preventDefault(),\n\t\t\t\t\t\tonclick: () => attrs.selectResult(result),\n\t\t\t\t\t\tclass: state.selected === result ? \"row-selected\" : \"\",\n\t\t\t\t\t},\n\t\t\t\t\tthis.renderResult(state, result),\n\t\t\t\t)\n\t\t\t}),\n\t\t])\n\t}\n\n\t_renderIndexingStatus(state: SearchBarState, attrs: SearchBarOverlayAttrs): Children {\n\t\tif (attrs.isFocused || (!attrs.isQuickSearch && client.isDesktopDevice())) {\n\t\t\tif (state.indexState.failedIndexingUpTo != null) {\n\t\t\t\treturn this.renderError(state.indexState.failedIndexingUpTo, attrs)\n\t\t\t} else if (state.indexState.progress !== 0) {\n\t\t\t\treturn this._renderProgress(state, attrs)\n\t\t\t} else {\n\t\t\t\treturn null\n\t\t\t}\n\t\t} else {\n\t\t\treturn null\n\t\t}\n\t}\n\n\t_renderProgress(state: SearchBarState, attrs: SearchBarOverlayAttrs): Children {\n\t\treturn m(\".flex.col.rel\", [\n\t\t\tm(\n\t\t\t\t\".plr-l.pt-s.pb-s.flex.items-center.flex-space-between.mr-negative-s\",\n\t\t\t\t{\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\theight: px(52),\n\t\t\t\t\t\tborderLeft: `${px(size.border_selection)} solid transparent`,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[\n\t\t\t\t\tm(\n\t\t\t\t\t\t\".top.flex-space-between.col\",\n\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\".bottom.flex-space-between\",\n\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t\t\tlang.get(\"indexedMails_label\", {\n\t\t\t\t\t\t\t\t\t\"{count}\": state.indexState.indexedMailCount,\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t\tstate.indexState.progress !== 100\n\t\t\t\t\t\t? m(\n\t\t\t\t\t\t\t\t\"div\",\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t// avoid closing overlay before the click event can be received\n\t\t\t\t\t\t\t\t\tonmousedown: (e: MouseEvent) => e.preventDefault(),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tm(Button, {\n\t\t\t\t\t\t\t\t\tlabel: \"cancel_action\",\n\t\t\t\t\t\t\t\t\tclick: () => mailLocator.indexerFacade.cancelMailIndexing(),\n\t\t\t\t\t\t\t\t\t//icon: () => Icons.Cancel\n\t\t\t\t\t\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: null, // avoid closing overlay before the click event can be received\n\t\t\t\t],\n\t\t\t),\n\t\t\tm(\".abs\", {\n\t\t\t\tstyle: {\n\t\t\t\t\tbackgroundColor: theme.content_accent,\n\t\t\t\t\theight: \"2px\",\n\t\t\t\t\twidth: state.indexState.progress + \"%\",\n\t\t\t\t\tbottom: 0,\n\t\t\t\t},\n\t\t\t}),\n\t\t])\n\t}\n\n\tprivate renderError(failedIndexingUpTo: number, attrs: SearchBarOverlayAttrs): Children {\n\t\tconst errorMessageKey = attrs.state.indexState.error === IndexingErrorReason.ConnectionLost ? \"indexingFailedConnection_error\" : \"indexing_error\"\n\n\t\treturn m(\".flex.rel\", [\n\t\t\tm(\n\t\t\t\t\".plr-l.pt-s.pb-s.flex.items-center.flex-space-between.mr-negative-s\",\n\t\t\t\t{\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\theight: px(52),\n\t\t\t\t\t\tborderLeft: `${px(size.border_selection)} solid transparent`,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[\n\t\t\t\t\tm(\".small\", lang.get(errorMessageKey)),\n\t\t\t\t\tm(\n\t\t\t\t\t\t\"div\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// avoid closing overlay before the click event can be received\n\t\t\t\t\t\t\tonmousedown: (e: MouseEvent) => e.preventDefault(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tm(Button, {\n\t\t\t\t\t\t\tlabel: \"retry_action\",\n\t\t\t\t\t\t\tclick: () => mailLocator.indexerFacade.extendMailIndex(failedIndexingUpTo),\n\t\t\t\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t],\n\t\t\t),\n\t\t])\n\t}\n\n\trenderResult(state: SearchBarState, result: Entry): Children {\n\t\tlet type: TypeRef<any> | null = \"_type\" in result ? result._type : null\n\n\t\tif (!type) {\n\t\t\treturn this.renderShowMoreAction(downcast(result))\n\t\t} else if (isSameTypeRef(MailTypeRef, type)) {\n\t\t\treturn this.renderMailResult(downcast(result), state)\n\t\t} else if (isSameTypeRef(ContactTypeRef, type)) {\n\t\t\treturn this.renderContactResult(downcast(result))\n\t\t} else if (isSameTypeRef(CalendarEventTypeRef, type)) {\n\t\t\treturn this.renderCalendarEventResult(downcast(result))\n\t\t} else {\n\t\t\treturn []\n\t\t}\n\t}\n\n\tprivate renderShowMoreAction(result: ShowMoreAction): Children {\n\t\t// show more action\n\t\tlet showMoreAction = result as any as ShowMoreAction\n\t\tlet infoText\n\t\tlet indexInfo\n\n\t\tif (showMoreAction.resultCount === 0) {\n\t\t\tinfoText = lang.get(\"searchNoResults_msg\")\n\n\t\t\tif (locator.logins.getUserController().isFreeAccount()) {\n\t\t\t\tindexInfo = lang.get(\"changeTimeFrame_msg\")\n\t\t\t}\n\t\t} else if (showMoreAction.allowShowMore) {\n\t\t\tinfoText = lang.get(\"showMore_action\")\n\t\t} else {\n\t\t\tinfoText = lang.get(\"moreResultsFound_msg\", {\n\t\t\t\t\"{1}\": showMoreAction.resultCount - showMoreAction.shownCount,\n\t\t\t})\n\t\t}\n\n\t\tif (showMoreAction.indexTimestamp > FULL_INDEXED_TIMESTAMP && !indexInfo) {\n\t\t\tindexInfo = lang.get(\"searchedUntil_msg\") + \" \" + formatDate(new Date(showMoreAction.indexTimestamp))\n\t\t}\n\n\t\treturn indexInfo\n\t\t\t? [m(\".top.flex-center\", infoText), m(\".bottom.flex-center.small\", indexInfo)]\n\t\t\t: m(\"li.plr-l.pt-s.pb-s.items-center.flex-center\", m(\".flex-center\", infoText))\n\t}\n\n\tprivate renderContactResult(contact: Contact): Children {\n\t\treturn [\n\t\t\tm(\".top.flex-space-between\", m(\".name\", getContactListName(contact))),\n\t\t\tm(\n\t\t\t\t\".bottom.flex-space-between\",\n\t\t\t\tm(\"small.mail-address\", contact.mailAddresses && contact.mailAddresses.length > 0 ? contact.mailAddresses[0].address : \"\"),\n\t\t\t),\n\t\t]\n\t}\n\n\tprivate renderCalendarEventResult(event: CalendarEvent): Children {\n\t\treturn [\n\t\t\tm(\".top.flex-space-between\", m(\".name.text-ellipsis\", { title: event.summary }, event.summary)),\n\t\t\tm(\".bottom.flex-space-between\", m(\"small.mail-address\", formatEventDuration(event, getTimeZone(), false))),\n\t\t]\n\t}\n\n\tprivate renderMailResult(mail: Mail, state: SearchBarState): Children {\n\t\treturn [\n\t\t\tm(\".top.flex-space-between.badge-line-height\", [\n\t\t\t\tisTutanotaTeamMail(mail)\n\t\t\t\t\t? m(\n\t\t\t\t\t\t\tBadge,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tclasses: \".small.mr-s\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcompanyTeamLabel,\n\t\t\t\t\t  )\n\t\t\t\t\t: null,\n\t\t\t\tm(\"small.text-ellipsis\", getSenderOrRecipientHeading(mail, true)),\n\t\t\t\tm(\"small.text-ellipsis.flex-fixed\", formatTimeOrDateOrYesterday(mail.receivedDate)),\n\t\t\t]),\n\t\t\tm(\".bottom.flex-space-between\", [\n\t\t\t\tm(\".text-ellipsis\", mail.subject),\n\t\t\t\tm(\n\t\t\t\t\t\".icons.flex-fixed\",\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\"margin-right\": \"-3px\",\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t[\n\t\t\t\t\t\t// 3px to neutralize the svg icons internal border\n\t\t\t\t\t\tm(Icon, {\n\t\t\t\t\t\t\ticon: getMailFolderIcon(mail),\n\t\t\t\t\t\t\tclass: state.selected === mail ? \"svg-content-accent-fg\" : \"svg-content-fg\",\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tm(Icon, {\n\t\t\t\t\t\t\ticon: Icons.Attachment,\n\t\t\t\t\t\t\tclass: state.selected === mail ? \"svg-content-accent-fg\" : \"svg-content-fg\",\n\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\tdisplay: mail.attachments.length > 0 ? \"\" : \"none\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t),\n\t\t\t]),\n\t\t]\n\t}\n}\n"]}