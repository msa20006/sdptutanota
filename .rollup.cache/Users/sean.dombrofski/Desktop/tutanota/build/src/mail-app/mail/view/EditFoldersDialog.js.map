{"version":3,"file":"EditFoldersDialog.js","sourceRoot":"","sources":["../../../../../src/mail-app/mail/view/EditFoldersDialog.ts"],"names":[],"mappings":"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","sourcesContent":["import { modal, ModalComponent } from \"../../../common/gui/base/Modal.js\"\nimport { assertNotNull, noOp, Thunk } from \"@tutao/tutanota-utils\"\nimport { focusNext, focusPrevious, keyManager, Shortcut } from \"../../../common/misc/KeyManager.js\"\nimport { Keys } from \"../../../common/api/common/TutanotaConstants.js\"\nimport m, { Children } from \"mithril\"\nimport { alpha, AlphaEnum, AnimationPromise, animations, DefaultAnimationTime, opacity } from \"../../../common/gui/animation/Animations.js\"\nimport { getElevatedBackground, theme } from \"../../../common/gui/theme.js\"\nimport { INPUT } from \"../../../common/gui/base/Dialog.js\"\nimport { ease } from \"../../../common/gui/animation/Easing.js\"\nimport { px, size } from \"../../../common/gui/size.js\"\nimport { styles } from \"../../../common/gui/styles.js\"\nimport { LoginButton } from \"../../../common/gui/base/buttons/LoginButton.js\"\n\nexport class EditFoldersDialog implements ModalComponent {\n\tprivate visible: boolean\n\tprivate readonly _shortcuts: Shortcut[]\n\tprivate _domDialog: HTMLElement | null = null\n\t/** The element that was focused before we've shown the component so that we can return it back upon closing. */\n\tprivate focusedBeforeShown: HTMLElement | null = null\n\n\tprivate _closeHandler: Thunk | null = null\n\n\tprivate usedBottomNavBefore: boolean = styles.isUsingBottomNavigation()\n\n\tconstructor(private readonly folderList: () => Children) {\n\t\tthis.visible = false\n\n\t\tthis._shortcuts = [\n\t\t\t{\n\t\t\t\tkey: Keys.RETURN,\n\t\t\t\tshift: false,\n\t\t\t\texec: () => this.close(),\n\t\t\t\thelp: \"close_alt\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.ESC,\n\t\t\t\tshift: false,\n\t\t\t\texec: () => this.close(),\n\t\t\t\thelp: \"close_alt\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.TAB,\n\t\t\t\tshift: true,\n\t\t\t\texec: () => (this._domDialog ? focusPrevious(this._domDialog) : false),\n\t\t\t\thelp: \"selectPrevious_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.TAB,\n\t\t\t\tshift: false,\n\t\t\t\texec: () => (this._domDialog ? focusNext(this._domDialog) : false),\n\t\t\t\thelp: \"selectNext_action\",\n\t\t\t},\n\t\t]\n\n\t\tthis.view = this.view.bind(this)\n\t}\n\n\tview() {\n\t\tif (this.usedBottomNavBefore !== styles.isUsingBottomNavigation()) {\n\t\t\tthis.close()\n\t\t}\n\t\tthis.usedBottomNavBefore = styles.isUsingBottomNavigation()\n\t\tconst marginTop = this.usedBottomNavBefore ? \"env(safe-area-inset-top)\" : px(size.navbar_height)\n\t\treturn m(\n\t\t\t\".flex.col\",\n\t\t\t{\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: px(size.first_col_max_width - size.button_height),\n\t\t\t\t\theight: `calc(100% - ${marginTop})`,\n\t\t\t\t\t// for the header\n\t\t\t\t\tmarginTop,\n\t\t\t\t\tmarginLeft: px(size.button_height),\n\t\t\t\t},\n\t\t\t\tonclick: (e: MouseEvent) => e.stopPropagation(),\n\t\t\t\t// do not propagate clicks on the dialog as the Modal expects all propagated clicks to be clicks on the background\n\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\tthis._domDialog = vnode.dom as HTMLElement\n\t\t\t\t\tlet animation: AnimationPromise | null = null\n\n\t\t\t\t\tconst bgcolor = theme.navigation_bg\n\t\t\t\t\tconst children = Array.from(this._domDialog.children) as Array<HTMLElement>\n\t\t\t\t\tfor (let child of children) {\n\t\t\t\t\t\tchild.style.opacity = \"0\"\n\t\t\t\t\t}\n\t\t\t\t\tthis._domDialog.style.backgroundColor = `rgba(0, 0, 0, 0)`\n\t\t\t\t\tanimation = Promise.all([\n\t\t\t\t\t\tanimations.add(this._domDialog, alpha(AlphaEnum.BackgroundColor, bgcolor, 0, 1)),\n\t\t\t\t\t\tanimations.add(children, opacity(0, 1, true), {\n\t\t\t\t\t\t\tdelay: DefaultAnimationTime / 2,\n\t\t\t\t\t\t}),\n\t\t\t\t\t])\n\n\t\t\t\t\t// select first input field. blur first to avoid that users can enter text in the previously focused element while the animation is running\n\t\t\t\t\twindow.requestAnimationFrame(() => {\n\t\t\t\t\t\tconst activeElement = document.activeElement as HTMLElement | null\n\t\t\t\t\t\tif (activeElement && typeof activeElement.blur === \"function\") {\n\t\t\t\t\t\t\tactiveElement.blur()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tanimation.then(() => {\n\t\t\t\t\t\tthis.defaultFocusOnLoad()\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t},\n\t\t\t[\n\t\t\t\tm(\n\t\t\t\t\t\".plr-button.mt.mb\",\n\t\t\t\t\tm(LoginButton, {\n\t\t\t\t\t\tlabel: \"done_action\",\n\t\t\t\t\t\tonclick: () => this.close(),\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t\tm(\n\t\t\t\t\t\".scroll.overflow-x-hidden.flex.col.flex-grow\",\n\t\t\t\t\t{\n\t\t\t\t\t\tonscroll: (e: Event) => {\n\t\t\t\t\t\t\tconst target = e.target as HTMLElement\n\t\t\t\t\t\t\ttarget.style.borderTop = `1px solid ${theme.content_border}`\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tthis.folderList(),\n\t\t\t\t),\n\t\t\t],\n\t\t)\n\t}\n\n\tprivate defaultFocusOnLoad() {\n\t\tconst dom = assertNotNull(this._domDialog)\n\t\tlet inputs = Array.from(dom.querySelectorAll(INPUT)) as Array<HTMLElement>\n\n\t\tif (inputs.length > 0) {\n\t\t\tinputs[0].focus()\n\t\t} else {\n\t\t\tlet button = dom.querySelector(\"button\")\n\n\t\t\tif (button) {\n\t\t\t\tbutton.focus()\n\t\t\t}\n\t\t}\n\t}\n\n\thideAnimation(): Promise<void> {\n\t\tlet bgcolor = getElevatedBackground()\n\n\t\tif (this._domDialog) {\n\t\t\treturn Promise.all([\n\t\t\t\tanimations.add(this._domDialog.children, opacity(1, 0, true)),\n\t\t\t\tanimations.add(this._domDialog, alpha(AlphaEnum.BackgroundColor, bgcolor, 1, 0), {\n\t\t\t\t\tdelay: DefaultAnimationTime / 2,\n\t\t\t\t\teasing: ease.linear,\n\t\t\t\t}),\n\t\t\t]).then(noOp)\n\t\t} else {\n\t\t\treturn Promise.resolve()\n\t\t}\n\t}\n\n\tshow(): EditFoldersDialog {\n\t\tthis.focusedBeforeShown = document.activeElement as HTMLElement\n\t\tmodal.display(this)\n\t\tthis.visible = true\n\t\treturn this\n\t}\n\n\tclose(): void {\n\t\tthis.visible = false\n\t\tmodal.remove(this)\n\t}\n\n\t/**\n\t * Should be called to close a dialog. Notifies the closeHandler about the close attempt.\n\t */\n\tonClose(): void {\n\t\tif (this._closeHandler) {\n\t\t\tthis._closeHandler()\n\t\t} else {\n\t\t\tthis.close()\n\t\t}\n\t}\n\n\tshortcuts(): Shortcut[] {\n\t\treturn this._shortcuts\n\t}\n\n\tbackgroundClick(e: MouseEvent) {}\n\n\tpopState(e: Event): boolean {\n\t\tthis.onClose()\n\t\treturn false\n\t}\n\n\tcallingElement(): HTMLElement | null {\n\t\treturn this.focusedBeforeShown\n\t}\n\n\taddShortcut(shortcut: Shortcut): EditFoldersDialog {\n\t\tthis._shortcuts.push(shortcut)\n\n\t\tif (this.visible) {\n\t\t\tkeyManager.registerModalShortcuts([shortcut])\n\t\t}\n\n\t\treturn this\n\t}\n\n\tstatic showEdit(folders: () => Children) {\n\t\tnew EditFoldersDialog(folders).show()\n\t}\n}\n"]}