{"version":3,"file":"MobileMailActionBar.js","sourceRoot":"","sources":["../../../../../src/mail-app/mail/view/MobileMailActionBar.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { MailViewerViewModel } from \"./MailViewerViewModel.js\"\nimport { IconButton } from \"../../../common/gui/base/IconButton.js\"\nimport { createDropdown, Dropdown, DROPDOWN_MARGIN, DropdownButtonAttrs } from \"../../../common/gui/base/Dropdown.js\"\nimport { Icons } from \"../../../common/gui/base/icons/Icons.js\"\nimport { UserError } from \"../../../common/api/main/UserError.js\"\nimport { showUserError } from \"../../../common/misc/ErrorHandlerImpl.js\"\nimport { promptAndDeleteMails, showMoveMailsDropdown } from \"./MailGuiUtils.js\"\nimport { noOp, ofClass } from \"@tutao/tutanota-utils\"\nimport { modal } from \"../../../common/gui/base/Modal.js\"\nimport { editDraft, mailViewerMoreActions } from \"./MailViewerUtils.js\"\nimport { px, size } from \"../../../common/gui/size.js\"\nimport { LabelsPopup } from \"./LabelsPopup.js\"\n\nexport interface MobileMailActionBarAttrs {\n\tviewModel: MailViewerViewModel\n}\n\nexport class MobileMailActionBar implements Component<MobileMailActionBarAttrs> {\n\tprivate dom: HTMLElement | null = null\n\n\tview(vnode: Vnode<MobileMailActionBarAttrs>): Children {\n\t\tconst { attrs } = vnode\n\t\tconst { viewModel } = attrs\n\t\tlet actions: Children[]\n\n\t\tif (viewModel.isAnnouncement()) {\n\t\t\tactions = [this.placeholder(), this.placeholder(), this.deleteButton(attrs), this.placeholder(), this.moreButton(attrs)]\n\t\t} else if (viewModel.isDraftMail()) {\n\t\t\tactions = [this.placeholder(), this.placeholder(), this.deleteButton(attrs), this.moveButton(attrs), this.editButton(attrs)]\n\t\t} else if (viewModel.canForwardOrMove()) {\n\t\t\tactions = [this.replyButton(attrs), this.forwardButton(attrs), this.deleteButton(attrs), this.moveButton(attrs), this.moreButton(attrs)]\n\t\t} else {\n\t\t\tactions = [this.replyButton(attrs), this.placeholder(), this.deleteButton(attrs), this.placeholder(), this.moreButton(attrs)]\n\t\t}\n\n\t\treturn m(\n\t\t\t\".bottom-nav.bottom-action-bar.flex.items-center.plr-l.justify-between\",\n\t\t\t{\n\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\tthis.dom = vnode.dom as HTMLElement\n\t\t\t\t},\n\t\t\t},\n\t\t\t[actions],\n\t\t)\n\t}\n\n\tprivate placeholder() {\n\t\treturn m(\"\", {\n\t\t\tstyle: {\n\t\t\t\twidth: px(size.button_height),\n\t\t\t},\n\t\t})\n\t}\n\n\tprivate moveButton({ viewModel }: MobileMailActionBarAttrs) {\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"move_action\",\n\t\t\tclick: (e, dom) =>\n\t\t\t\tshowMoveMailsDropdown(viewModel.mailboxModel, viewModel.mailModel, dom.getBoundingClientRect(), [viewModel.mail], {\n\t\t\t\t\twidth: this.dropdownWidth(),\n\t\t\t\t\twithBackground: true,\n\t\t\t\t}),\n\t\t\ticon: Icons.Folder,\n\t\t})\n\t}\n\n\tprivate dropdownWidth() {\n\t\treturn this.dom?.offsetWidth ? this.dom.offsetWidth - DROPDOWN_MARGIN * 2 : undefined\n\t}\n\n\tprivate moreButton({ viewModel }: MobileMailActionBarAttrs) {\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"more_label\",\n\t\t\tclick: createDropdown({\n\t\t\t\tlazyButtons: () => {\n\t\t\t\t\tconst moreButtons: DropdownButtonAttrs[] = []\n\t\t\t\t\tif (viewModel.mailModel.canAssignLabels()) {\n\t\t\t\t\t\tmoreButtons.push({\n\t\t\t\t\t\t\tlabel: \"assignLabel_action\",\n\t\t\t\t\t\t\tclick: (event, dom) => {\n\t\t\t\t\t\t\t\tconst referenceDom = this.dom ?? dom\n\t\t\t\t\t\t\t\tconst popup = new LabelsPopup(\n\t\t\t\t\t\t\t\t\treferenceDom,\n\t\t\t\t\t\t\t\t\treferenceDom.getBoundingClientRect(),\n\t\t\t\t\t\t\t\t\tthis.dropdownWidth() ?? 200,\n\t\t\t\t\t\t\t\t\tviewModel.mailModel.getLabelsForMails([viewModel.mail]),\n\t\t\t\t\t\t\t\t\tviewModel.mailModel.getLabelStatesForMails([viewModel.mail]),\n\t\t\t\t\t\t\t\t\t(addedLabels, removedLabels) => viewModel.mailModel.applyLabels([viewModel.mail], addedLabels, removedLabels),\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\tpopup.show()\n\t\t\t\t\t\t\t\t}, 16)\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ticon: Icons.Label,\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\treturn [...moreButtons, ...mailViewerMoreActions(viewModel)]\n\t\t\t\t},\n\t\t\t\twidth: this.dropdownWidth(),\n\t\t\t\twithBackground: true,\n\t\t\t}),\n\t\t\ticon: Icons.More,\n\t\t})\n\t}\n\n\tprivate deleteButton({ viewModel }: MobileMailActionBarAttrs): Children {\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"delete_action\",\n\t\t\tclick: () => promptAndDeleteMails(viewModel.mailModel, [viewModel.mail], noOp),\n\t\t\ticon: Icons.Trash,\n\t\t})\n\t}\n\n\tprivate forwardButton({ viewModel }: MobileMailActionBarAttrs): Children {\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"forward_action\",\n\t\t\tclick: () => viewModel.forward().catch(ofClass(UserError, showUserError)),\n\t\t\ticon: Icons.Forward,\n\t\t})\n\t}\n\n\tprivate replyButton({ viewModel }: MobileMailActionBarAttrs) {\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"reply_action\",\n\t\t\tclick: viewModel.canReplyAll()\n\t\t\t\t? (e, dom) => {\n\t\t\t\t\t\tconst dropdown = new Dropdown(() => {\n\t\t\t\t\t\t\tconst buttons: DropdownButtonAttrs[] = []\n\t\t\t\t\t\t\tbuttons.push({\n\t\t\t\t\t\t\t\tlabel: \"replyAll_action\",\n\t\t\t\t\t\t\t\ticon: Icons.ReplyAll,\n\t\t\t\t\t\t\t\tclick: () => viewModel.reply(true),\n\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\tbuttons.push({\n\t\t\t\t\t\t\t\tlabel: \"reply_action\",\n\t\t\t\t\t\t\t\ticon: Icons.Reply,\n\t\t\t\t\t\t\t\tclick: () => viewModel.reply(false),\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\treturn buttons\n\t\t\t\t\t\t}, this.dropdownWidth() ?? 300)\n\n\t\t\t\t\t\tconst domRect = this.dom?.getBoundingClientRect() ?? dom.getBoundingClientRect()\n\t\t\t\t\t\tdropdown.setOrigin(domRect)\n\t\t\t\t\t\tmodal.displayUnique(dropdown, true)\n\t\t\t\t  }\n\t\t\t\t: () => viewModel.reply(false),\n\t\t\ticon: viewModel.canReplyAll() ? Icons.ReplyAll : Icons.Reply,\n\t\t})\n\t}\n\n\tprivate editButton(attrs: MobileMailActionBarAttrs) {\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"edit_action\",\n\t\t\ticon: Icons.Edit,\n\t\t\tclick: () => editDraft(attrs.viewModel),\n\t\t})\n\t}\n}\n"]}