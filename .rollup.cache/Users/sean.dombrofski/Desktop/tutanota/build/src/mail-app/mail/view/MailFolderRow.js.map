{"version":3,"file":"MailFolderRow.js","sourceRoot":"","sources":["../../../../../src/mail-app/mail/view/MailFolderRow.ts"],"names":[],"mappings":"AAAA,OAAO,CAAiC,MAAM,SAAS,CAAA;AAEvD,OAAO,EAAE,mBAAmB,EAAE,SAAS,EAAE,MAAM,uCAAuC,CAAA;AACtF,OAAO,EAAE,YAAY,EAAE,MAAM,uCAAuC,CAAA;AACpE,OAAO,EAAE,0BAA0B,EAAE,KAAK,EAAE,MAAM,2BAA2B,CAAA;AAC7E,OAAO,EAAE,EAAE,EAAE,IAAI,EAAE,MAAM,0BAA0B,CAAA;AACnD,OAAO,EAAE,UAAU,EAAmB,MAAM,wCAAwC,CAAA;AACpF,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,kCAAkC,CAAA;AAEjE,OAAO,EAAE,YAAY,EAAE,MAAM,sCAAsC,CAAA;AACnE,OAAO,EAAE,MAAM,EAAE,MAAM,wCAAwC,CAAA;AAC/D,OAAO,EAAE,IAAI,EAAE,MAAM,2CAA2C,CAAA;AAEhE,OAAO,EAAE,aAAa,EAAE,MAAM,gBAAgB,CAAA;AAC9C,OAAO,EAAE,aAAa,EAAE,MAAM,oBAAoB,CAAA;AAkBlD,MAAM,OAAO,aAAa;IACjB,OAAO,GAAY,KAAK,CAAA;IAEhC,QAAQ,CAAC,KAAgC;QACxC,IAAI,mBAAmB,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC;YAC7C,IAAI,CAAC,OAAO,GAAG,IAAI,CAAA;QACpB,CAAC;IACF,CAAC;IAED,IAAI,CAAC,KAAgC;QACpC,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,WAAW,EAAE,QAAQ,EAAE,gBAAgB,EAAE,MAAM,EAAE,WAAW,EAAE,QAAQ,EAAE,GAAG,KAAK,CAAC,KAAK,CAAA;QAC7G,MAAM,IAAI,GAAG,aAAa,CAAC,MAAM,CAAC,CAAA;QAClC,MAAM,OAAO,GAAG,GAAG,EAAE;YACpB,KAAK,CAAC,KAAK,CAAC,OAAO,EAAE,CAAA;YACrB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAA;QACpB,CAAC,CAAA;QAED,uEAAuE;QACvE,4DAA4D;QAC5D,MAAM,iBAAiB,GAAG,CAAC,KAAoB,EAAE,EAAE;YAClD,IAAI,KAAK,CAAC,GAAG,KAAK,KAAK,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;gBAC5C,IAAI,CAAC,OAAO,GAAG,KAAK,CAAA;YACrB,CAAC;QACF,CAAC,CAAA;QACD,MAAM,kBAAkB,GAAG,CAAC,KAAoB,EAAE,EAAE;YACnD,IAAI,KAAK,CAAC,GAAG,KAAK,KAAK,IAAI,KAAK,CAAC,QAAQ;gBAAE,IAAI,CAAC,OAAO,GAAG,KAAK,CAAA;QAChE,CAAC,CAAA;QAED,MAAM,iBAAiB,GAAG,gBAAgB,GAAG,IAAI,CAAC,IAAI,CAAA;QACtD,MAAM,aAAa,GAAG,IAAI,CAAC,WAAW,CAAA;QACtC,MAAM,WAAW,GAAG,IAAI,CAAC,eAAe,GAAG,aAAa,GAAG,CAAC,CAAA;QAE5D,OAAO,CAAC,CACP,mEAAmE,EACnE;YACC,KAAK,EAAE;gBACN,UAAU,EAAE,mBAAmB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE;aAC3D;YACD,KAAK,EAAE,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,KAAK,CAAC;YAC5C,YAAY,EAAE,OAAO;YACrB,YAAY,EAAE,GAAG,EAAE;gBAClB,IAAI,CAAC,OAAO,GAAG,KAAK,CAAA;YACrB,CAAC;SACD,EACD;YACC,WAAW,IAAI,CAAC,QAAQ;gBACvB,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE;oBACR,KAAK,EAAE;wBACN,QAAQ,EAAE,UAAU;wBACpB,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC;wBACb,IAAI,EAAE,EAAE,CAAC,CAAC,GAAG,iBAAiB,GAAG,WAAW,GAAG,CAAC,CAAC;wBACjD,IAAI,EAAE,mBAAmB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,0BAA0B,CAAC,CAAC,CAAC,KAAK,CAAC,iBAAiB;qBAC9F;oBACD,IAAI,uBAAW;oBACf,KAAK,EAAE,YAAY;iBAClB,CAAC;gBACJ,CAAC,CAAC,IAAI;YACP,CAAC,CAAC,EAAE,EAAE;gBACL,KAAK,EAAE;oBACN,UAAU,EAAE,EAAE,CAAC,iBAAiB,CAAC;iBACjC;aACD,CAAC;YACF,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,KAAK,EAAE,iBAAiB,CAAC;YACxD,CAAC,CACA,sCAAsC,GAAG,CAAC,QAAQ,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,CAAC,EACtF;gBACC,KAAK,EAAE;oBACN,IAAI,EAAE,EAAE,CAAC,iBAAiB,CAAC;oBAC3B,KAAK,EAAE,EAAE,CAAC,WAAW,CAAC;oBACtB,MAAM,EAAE,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC;oBAC9B,WAAW,EAAE,EAAE,CAAC,aAAa,CAAC;oBAC9B,YAAY,EAAE,EAAE,CAAC,aAAa,CAAC;oBAC/B,qEAAqE;oBACrE,MAAM,EAAE,CAAC;iBACT;gBACD,aAAa,EAAE,YAAY,aAAa,CAAC,MAAM,CAAC,EAAE;gBAClD,eAAe,EAAE,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO;gBACxD,OAAO,EAAE,KAAK,CAAC,KAAK,CAAC,eAAe;gBACpC,SAAS,EAAE,kBAAkB;aAC7B,EACD,CAAC,CAAC,IAAI,EAAE;gBACP,IAAI;gBACJ,IAAI,EAAE,QAAQ,CAAC,MAAM;gBACrB,KAAK,EAAE;oBACN,IAAI,EAAE,mBAAmB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,0BAA0B,CAAC,CAAC,CAAC,KAAK,CAAC,iBAAiB;iBAC9F;aACD,CAAC,CACF;YACD,CAAC,CAAC,SAAS,EAAE;gBACZ,GAAG,MAAM;gBACT,OAAO,EAAE,OAAO;gBAChB,SAAS,EAAE,kBAAkB;aAC7B,CAAC;YACF,mFAAmF;YACnF,WAAW,IAAI,CAAC,QAAQ,IAAI,CAAC,CAAC,MAAM,CAAC,cAAc,EAAE,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC;gBACtE,CAAC,CAAC,CAAC,CAAC,UAAU,EAAE;oBACd,GAAG,WAAW;oBACd,KAAK,EAAE,CAAC,KAAK,EAAE,GAAG,EAAE,EAAE;wBACrB,WAAW,CAAC,KAAK,CAAC,KAAK,EAAE,GAAG,CAAC,CAAA;oBAC9B,CAAC;oBACD,SAAS,EAAE,iBAAiB;iBAC3B,CAAC;gBACJ,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,WAAW,EAAE,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,EAAE,EAAE;oBACxD,CAAC,CAAC,YAAY,EAAE;wBACf,KAAK;wBACL,KAAK,EAAE,KAAK,CAAC,sBAAsB;wBACnC,UAAU,EAAE,0BAA0B,EAAE;wBACxC,aAAa,EAAE,IAAI;qBACnB,CAAC;iBACD,CAAC;SACL,CACD,CAAA;IACF,CAAC;IAEO,mBAAmB,CAAC,EAAE,gBAAgB,EAAE,oBAAoB,EAAE,aAAa,EAAE,cAAc,EAAsB,EAAE,iBAAyB;QACnJ,MAAM,QAAQ,GAAG,CAAC,CAAA;QAClB,MAAM,MAAM,GAAG,GAAG,QAAQ,YAAY,KAAK,CAAC,cAAc,EAAE,CAAA;QAC5D,MAAM,uBAAuB,GAAG,IAAI,CAAC,aAAa,GAAG,CAAC,GAAG,CAAC,CAAA;QAC1D,MAAM,uBAAuB,GAAG,CAAC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAA;QAC/E,MAAM,sBAAsB,GAAG,IAAI,CAAC,IAAI,GAAG,CAAC,CAAA;QAC5C,MAAM,UAAU,GAAG,iBAAiB,CAAA;QAEpC,OAAO,gBAAgB,KAAK,CAAC;YAC5B,CAAC,CAAC;gBACA,aAAa,IAAI,cAAc;oBAC9B,CAAC,CAAC,0CAA0C;wBAC1C,CAAC,CAAC,MAAM,EAAE;4BACV,KAAK,EAAE;gCACN,KAAK,EAAE,EAAE,CAAC,sBAAsB,CAAC;gCACjC,sBAAsB,EAAE,KAAK;gCAC7B,gHAAgH;gCAChH,iBAAiB;gCACjB,MAAM,EAAE,EAAE,CAAC,CAAC,GAAG,uBAAuB,GAAG,uBAAuB,GAAG,oBAAoB,GAAG,IAAI,CAAC,aAAa,CAAC;gCAC7G,GAAG,EAAE,EAAE,CAAC,CAAC,uBAAuB,GAAG,oBAAoB,GAAG,IAAI,CAAC,aAAa,CAAC;gCAC7E,IAAI,EAAE,EAAE,CAAC,UAAU,CAAC;gCACpB,UAAU,EAAE,MAAM;gCAClB,YAAY,EAAE,MAAM;gCACpB,wFAAwF;gCACxF,MAAM,EAAE,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;6BAC9B;yBACA,CAAC;oBACJ,CAAC,CAAC,gCAAgC;wBAChC,CAAC,CAAC,MAAM,EAAE;4BACV,KAAK,EAAE;gCACN,MAAM,EAAE,EAAE,CAAC,QAAQ,CAAC;gCACpB,GAAG,EAAE,EAAE,CAAC,uBAAuB,CAAC;gCAChC,IAAI,EAAE,EAAE,CAAC,UAAU,CAAC;gCACpB,KAAK,EAAE,EAAE,CAAC,sBAAsB,CAAC;gCACjC,eAAe,EAAE,KAAK,CAAC,cAAc;6BACrC;yBACA,CAAC;aACJ;YACH,CAAC,CAAC,IAAI,CAAA;IACR,CAAC;CACD","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport type { NavButtonAttrs } from \"../../../common/gui/base/NavButton.js\"\nimport { isNavButtonSelected, NavButton } from \"../../../common/gui/base/NavButton.js\"\nimport { CounterBadge } from \"../../../common/gui/base/CounterBadge\"\nimport { getNavButtonIconBackground, theme } from \"../../../common/gui/theme\"\nimport { px, size } from \"../../../common/gui/size\"\nimport { IconButton, IconButtonAttrs } from \"../../../common/gui/base/IconButton.js\"\nimport { Icon, IconSize } from \"../../../common/gui/base/Icon.js\"\nimport { Icons } from \"../../../common/gui/base/icons/Icons.js\"\nimport { stateBgHover } from \"../../../common/gui/builtinThemes.js\"\nimport { client } from \"../../../common/misc/ClientDetector.js\"\nimport { lang } from \"../../../common/misc/LanguageViewModel.js\"\nimport { MailFolder } from \"../../../common/api/entities/tutanota/TypeRefs\"\nimport { getFolderIcon } from \"./MailGuiUtils\"\nimport { getFolderName } from \"../model/MailUtils\"\n\nexport type MailFolderRowAttrs = {\n\tcount: number\n\tbutton: NavButtonAttrs\n\trightButton?: IconButtonAttrs | null\n\texpanded: boolean | null\n\tindentationLevel: number\n\tonExpanderClick: () => unknown\n\tfolder: MailFolder\n\thasChildren: boolean\n\tonSelectedPath: boolean\n\tnumberOfPreviousRows: number\n\tisLastSibling: boolean\n\teditMode: boolean\n\tonHover: () => void\n}\n\nexport class MailFolderRow implements Component<MailFolderRowAttrs> {\n\tprivate hovered: boolean = false\n\n\tonupdate(vnode: Vnode<MailFolderRowAttrs>): any {\n\t\tif (isNavButtonSelected(vnode.attrs.button)) {\n\t\t\tthis.hovered = true\n\t\t}\n\t}\n\n\tview(vnode: Vnode<MailFolderRowAttrs>): Children {\n\t\tconst { count, button, rightButton, expanded, indentationLevel, folder, hasChildren, editMode } = vnode.attrs\n\t\tconst icon = getFolderIcon(folder)\n\t\tconst onHover = () => {\n\t\t\tvnode.attrs.onHover()\n\t\t\tthis.hovered = true\n\t\t}\n\n\t\t// because onblur is fired upon changing folder due to the route change\n\t\t// these functions can be used to handle keyboard navigation\n\t\tconst handleForwardsTab = (event: KeyboardEvent) => {\n\t\t\tif (event.key === \"Tab\" && !event.shiftKey) {\n\t\t\t\tthis.hovered = false\n\t\t\t}\n\t\t}\n\t\tconst handleBackwardsTab = (event: KeyboardEvent) => {\n\t\t\tif (event.key === \"Tab\" && event.shiftKey) this.hovered = false\n\t\t}\n\n\t\tconst indentationMargin = indentationLevel * size.hpad\n\t\tconst paddingNeeded = size.hpad_button\n\t\tconst buttonWidth = size.icon_size_large + paddingNeeded * 2\n\n\t\treturn m(\n\t\t\t\".folder-row.flex.flex-row.mlr-button.border-radius-small.state-bg\",\n\t\t\t{\n\t\t\t\tstyle: {\n\t\t\t\t\tbackground: isNavButtonSelected(button) ? stateBgHover : \"\",\n\t\t\t\t},\n\t\t\t\ttitle: lang.getTranslationText(button.label),\n\t\t\t\tonmouseenter: onHover,\n\t\t\t\tonmouseleave: () => {\n\t\t\t\t\tthis.hovered = false\n\t\t\t\t},\n\t\t\t},\n\t\t\t[\n\t\t\t\thasChildren && !expanded\n\t\t\t\t\t? m(Icon, {\n\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\tposition: \"absolute\",\n\t\t\t\t\t\t\t\tbottom: px(9),\n\t\t\t\t\t\t\t\tleft: px(5 + indentationMargin + buttonWidth / 2),\n\t\t\t\t\t\t\t\tfill: isNavButtonSelected(button) ? theme.navigation_button_selected : theme.navigation_button,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ticon: Icons.Add,\n\t\t\t\t\t\t\tclass: \"icon-small\",\n\t\t\t\t\t  })\n\t\t\t\t\t: null,\n\t\t\t\tm(\"\", {\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tmarginLeft: px(indentationMargin),\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tthis.renderHierarchyLine(vnode.attrs, indentationMargin),\n\t\t\t\tm(\n\t\t\t\t\t\"button.flex.items-center.justify-end\" + (editMode || !hasChildren ? \".no-hover\" : \"\"),\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tleft: px(indentationMargin),\n\t\t\t\t\t\t\twidth: px(buttonWidth),\n\t\t\t\t\t\t\theight: px(size.button_height),\n\t\t\t\t\t\t\tpaddingLeft: px(paddingNeeded),\n\t\t\t\t\t\t\tpaddingRight: px(paddingNeeded),\n\t\t\t\t\t\t\t// the zIndex is so the hierarchy lines never get drawn over the icon\n\t\t\t\t\t\t\tzIndex: 3,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"data-testid\": `btn:icon:${getFolderName(folder)}`,\n\t\t\t\t\t\t\"data-expanded\": vnode.attrs.expanded ? \"true\" : \"false\",\n\t\t\t\t\t\tonclick: vnode.attrs.onExpanderClick,\n\t\t\t\t\t\tonkeydown: handleBackwardsTab,\n\t\t\t\t\t},\n\t\t\t\t\tm(Icon, {\n\t\t\t\t\t\ticon,\n\t\t\t\t\t\tsize: IconSize.Medium,\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tfill: isNavButtonSelected(button) ? theme.navigation_button_selected : theme.navigation_button,\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t\tm(NavButton, {\n\t\t\t\t\t...button,\n\t\t\t\t\tonfocus: onHover,\n\t\t\t\t\tonkeydown: handleBackwardsTab,\n\t\t\t\t}),\n\t\t\t\t// show the edit button in either edit mode or on hover (excluding hover on mobile)\n\t\t\t\trightButton && (editMode || (!client.isMobileDevice() && this.hovered))\n\t\t\t\t\t? m(IconButton, {\n\t\t\t\t\t\t\t...rightButton,\n\t\t\t\t\t\t\tclick: (event, dom) => {\n\t\t\t\t\t\t\t\trightButton.click(event, dom)\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonkeydown: handleForwardsTab,\n\t\t\t\t\t  })\n\t\t\t\t\t: m(\"\", { style: { marginRight: px(size.hpad_button) } }, [\n\t\t\t\t\t\t\tm(CounterBadge, {\n\t\t\t\t\t\t\t\tcount,\n\t\t\t\t\t\t\t\tcolor: theme.navigation_button_icon,\n\t\t\t\t\t\t\t\tbackground: getNavButtonIconBackground(),\n\t\t\t\t\t\t\t\tshowFullCount: true,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t  ]),\n\t\t\t],\n\t\t)\n\t}\n\n\tprivate renderHierarchyLine({ indentationLevel, numberOfPreviousRows, isLastSibling, onSelectedPath }: MailFolderRowAttrs, indentationMargin: number) {\n\t\tconst lineSize = 2\n\t\tconst border = `${lineSize}px solid ${theme.content_border}`\n\t\tconst verticalOffsetInsideRow = size.button_height / 2 + 1\n\t\tconst verticalOffsetForParent = (size.button_height - size.icon_size_large) / 2\n\t\tconst lengthOfHorizontalLine = size.hpad - 2\n\t\tconst leftOffset = indentationMargin\n\n\t\treturn indentationLevel !== 0\n\t\t\t? [\n\t\t\t\t\tisLastSibling || onSelectedPath\n\t\t\t\t\t\t? // draw both vertical and horizontal lines\n\t\t\t\t\t\t  m(\".abs\", {\n\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\twidth: px(lengthOfHorizontalLine),\n\t\t\t\t\t\t\t\t\tborderBottomLeftRadius: \"3px\",\n\t\t\t\t\t\t\t\t\t// there's some subtle difference between border we use here and the top for the other element and this +1 is to\n\t\t\t\t\t\t\t\t\t// accommodate it\n\t\t\t\t\t\t\t\t\theight: px(1 + verticalOffsetInsideRow + verticalOffsetForParent + numberOfPreviousRows * size.button_height),\n\t\t\t\t\t\t\t\t\ttop: px(-verticalOffsetForParent - numberOfPreviousRows * size.button_height),\n\t\t\t\t\t\t\t\t\tleft: px(leftOffset),\n\t\t\t\t\t\t\t\t\tborderLeft: border,\n\t\t\t\t\t\t\t\t\tborderBottom: border,\n\t\t\t\t\t\t\t\t\t// we need to draw selected lines over everything else, even things that are drawn later\n\t\t\t\t\t\t\t\t\tzIndex: onSelectedPath ? 2 : 1,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t  })\n\t\t\t\t\t\t: // draw only the horizontal line\n\t\t\t\t\t\t  m(\".abs\", {\n\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\theight: px(lineSize),\n\t\t\t\t\t\t\t\t\ttop: px(verticalOffsetInsideRow),\n\t\t\t\t\t\t\t\t\tleft: px(leftOffset),\n\t\t\t\t\t\t\t\t\twidth: px(lengthOfHorizontalLine),\n\t\t\t\t\t\t\t\t\tbackgroundColor: theme.content_border,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t  }),\n\t\t\t  ]\n\t\t\t: null\n\t}\n}\n"]}