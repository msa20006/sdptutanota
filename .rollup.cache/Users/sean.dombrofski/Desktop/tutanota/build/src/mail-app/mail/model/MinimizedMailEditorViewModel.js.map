{"version":3,"file":"MinimizedMailEditorViewModel.js","sourceRoot":"","sources":["../../../../../src/mail-app/mail/model/MinimizedMailEditorViewModel.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,SAAS,EAAE,MAAM,EAAE,MAAM,uBAAuB,CAAA;AAEzD,OAAO,EAAE,QAAQ,EAAE,MAAM,8CAA8C,CAAA;AAoCvE;;GAEG;AACH,MAAM,OAAO,4BAA4B;IACxC,iBAAiB,CAAwB;IAEzC;QACC,IAAI,CAAC,iBAAiB,GAAG,EAAE,CAAA;IAC5B,CAAC;IAED,kBAAkB,CACjB,MAAc,EACd,aAA4B,EAC5B,OAAmB,EACnB,UAA8B,EAC9B,oBAAgC;QAEhC,MAAM,CAAC,KAAK,EAAE,CAAA;QAEd,iDAAiD;QACjD,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,MAAM,CAAC,MAAM,KAAK,MAAM,CAAC,EAAE,CAAC;YACxE,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC;gBAC3B,aAAa,EAAE,aAAa;gBAC5B,MAAM,EAAE,MAAM;gBACd,OAAO,EAAE,OAAO;gBAChB,UAAU;gBACV,oBAAoB;aACpB,CAAC,CAAA;QACH,CAAC;QAED,OAAO,SAAS,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAA;IACzC,CAAC;IAED,yCAAyC;IACzC,qBAAqB,CAAC,MAAuB;QAC5C,MAAM,CAAC,oBAAoB,EAAE,CAAA;QAC7B,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,CAAA;QACpB,MAAM,CAAC,IAAI,CAAC,iBAAiB,EAAE,MAAM,CAAC,CAAA;IACvC,CAAC;IAED,6BAA6B;IAC7B,qBAAqB,CAAC,MAAuB;QAC5C,MAAM,CAAC,oBAAoB,EAAE,CAAA;QAC7B,MAAM,CAAC,OAAO,EAAE,CAAA;QAChB,MAAM,CAAC,IAAI,CAAC,iBAAiB,EAAE,MAAM,CAAC,CAAA;IACvC,CAAC;IAED,mBAAmB;QAClB,OAAO,IAAI,CAAC,iBAAiB,CAAA;IAC9B,CAAC;IAED,iBAAiB,CAAC,IAAU;QAC3B,OAAO,CACN,IAAI,CAAC,mBAAmB,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE;YACrC,MAAM,KAAK,GAAG,CAAC,CAAC,aAAa,CAAC,QAAQ,EAAE,CAAA;YACxC,OAAO,KAAK,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAA;QACpD,CAAC,CAAC,IAAI,IAAI,CACV,CAAA;IACF,CAAC;CACD","sourcesContent":["import type { Dialog } from \"../../../common/gui/base/Dialog\"\nimport type { SendMailModel } from \"../../../common/mailFunctionality/SendMailModel.js\"\nimport { lastThrow, remove } from \"@tutao/tutanota-utils\"\nimport type { Mail } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport { isSameId } from \"../../../common/api/common/utils/EntityUtils\"\nimport Stream from \"mithril/stream\"\n\nexport const enum SaveStatusEnum {\n\tSaving = 0,\n\tSaved = 1,\n\tNotSaved = 2,\n}\n\nexport const enum SaveErrorReason {\n\tUnknown,\n\tConnectionLost,\n}\n\nexport type SaveStatus =\n\t| {\n\t\t\tstatus: SaveStatusEnum.Saving\n\t  }\n\t| {\n\t\t\tstatus: SaveStatusEnum.Saved\n\t  }\n\t| {\n\t\t\tstatus: SaveStatusEnum.NotSaved\n\t\t\treason: SaveErrorReason\n\t  }\n\nexport type MinimizedEditor = {\n\tdialog: Dialog\n\tsendMailModel: SendMailModel\n\t// we pass sendMailModel for easier access to contents of mail,\n\tdispose: () => void\n\t// disposes dialog and templatePopup eventListeners when minimized mail is removed\n\tsaveStatus: Stream<SaveStatus>\n\tcloseOverlayFunction: () => void\n}\n\n/**\n * handles minimized Editors\n */\nexport class MinimizedMailEditorViewModel {\n\t_minimizedEditors: Array<MinimizedEditor>\n\n\tconstructor() {\n\t\tthis._minimizedEditors = []\n\t}\n\n\tminimizeMailEditor(\n\t\tdialog: Dialog,\n\t\tsendMailModel: SendMailModel,\n\t\tdispose: () => void,\n\t\tsaveStatus: Stream<SaveStatus>,\n\t\tcloseOverlayFunction: () => void,\n\t): MinimizedEditor {\n\t\tdialog.close()\n\n\t\t// disallow creation of duplicate minimized mails\n\t\tif (!this._minimizedEditors.some((editor) => editor.dialog === dialog)) {\n\t\t\tthis._minimizedEditors.push({\n\t\t\t\tsendMailModel: sendMailModel,\n\t\t\t\tdialog: dialog,\n\t\t\t\tdispose: dispose,\n\t\t\t\tsaveStatus,\n\t\t\t\tcloseOverlayFunction,\n\t\t\t})\n\t\t}\n\n\t\treturn lastThrow(this._minimizedEditors)\n\t}\n\n\t// fully removes and reopens clicked mail\n\treopenMinimizedEditor(editor: MinimizedEditor): void {\n\t\teditor.closeOverlayFunction()\n\t\teditor.dialog.show()\n\t\tremove(this._minimizedEditors, editor)\n\t}\n\n\t// fully removes clicked mail\n\tremoveMinimizedEditor(editor: MinimizedEditor): void {\n\t\teditor.closeOverlayFunction()\n\t\teditor.dispose()\n\t\tremove(this._minimizedEditors, editor)\n\t}\n\n\tgetMinimizedEditors(): Array<MinimizedEditor> {\n\t\treturn this._minimizedEditors\n\t}\n\n\tgetEditorForDraft(mail: Mail): MinimizedEditor | null {\n\t\treturn (\n\t\t\tthis.getMinimizedEditors().find((e) => {\n\t\t\t\tconst draft = e.sendMailModel.getDraft()\n\t\t\t\treturn draft ? isSameId(draft._id, mail._id) : null\n\t\t\t}) ?? null\n\t\t)\n\t}\n}\n"]}