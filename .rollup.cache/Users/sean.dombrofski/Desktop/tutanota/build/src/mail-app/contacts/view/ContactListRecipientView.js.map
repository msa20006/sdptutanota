{"version":3,"file":"ContactListRecipientView.js","sourceRoot":"","sources":["../../../../../src/mail-app/contacts/view/ContactListRecipientView.ts"],"names":[],"mappings":"AAAA,OAAO,CAAiC,MAAM,SAAS,CAAA;AACvD,OAAO,EAAE,gBAAgB,EAAE,MAAM,mCAAmC,CAAA;AACpE,OAAO,EAAE,iBAAiB,EAAE,MAAM,0CAA0C,CAAA;AAC5E,OAAO,qBAAqB,MAAM,mDAAmD,CAAA;AACrF,OAAO,EAAE,KAAK,EAAE,MAAM,8BAA8B,CAAA;AAEpD,OAAO,EAAE,IAAI,EAAiC,MAAM,kCAAkC,CAAA;AAEtF,OAAO,EAAE,IAAI,EAAE,MAAM,uBAAuB,CAAA;AAG5C,OAAO,EACN,eAAe,EACf,UAAU,EACV,UAAU,EACV,uBAAuB,EACvB,sBAAsB,EAEtB,mCAAmC,GACnC,MAAM,+CAA+C,CAAA;AACtD,OAAO,EAAE,EAAE,EAAE,IAAI,EAAE,MAAM,6BAA6B,CAAA;AACtD,OAAO,EAAE,kBAAkB,EAAE,cAAc,EAAE,cAAc,EAAE,MAAM,iBAAiB,CAAA;AACpF,OAAO,EAAE,MAAM,EAAE,MAAM,+BAA+B,CAAA;AAEtD,gBAAgB,EAAE,CAAA;AAOlB,MAAM,OAAO,wBAAwB;IAC5B,SAAS,GAAgC,IAAI,CAAA;IAErD,IAAI,CAAC,EAAE,KAAK,EAAE,EAAE,SAAS,EAAE,kBAAkB,EAAE,EAA+B;QAC7E,IAAI,CAAC,SAAS,GAAG,SAAS,CAAA;QAE1B,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,SAAS,CAAA;QAC1C,OAAO,CAAC,CACP,iBAAiB,EACjB;YACC,aAAa,EAAE,IAAI;SACnB,EACD,SAAS,IAAI,IAAI,IAAI,SAAS,CAAC,cAAc,EAAE;YAC9C,CAAC,CAAC,CAAC,CAAC,qBAAqB,EAAE;gBACzB,KAAK,EAAE,KAAK,CAAC,eAAe;gBAC5B,OAAO,EAAE,eAAe;gBACxB,IAAI,6BAAc;aACjB,CAAC;YACJ,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE;gBACR,YAAY,EAAE,IAAI,CAAC,YAAY;gBAC/B,KAAK,EAAE,SAAS,CAAC,KAAK;gBACtB,UAAU,EAAE,GAAG,EAAE,CAAC,SAAS,CAAC,QAAQ,EAAE;gBACtC,cAAc,EAAE,GAAG,EAAE,CAAC,SAAS,CAAC,YAAY,EAAE;gBAC9C,aAAa,EAAE,GAAG,EAAE,CAAC,SAAS,CAAC,WAAW,EAAE;gBAC5C,iBAAiB,EAAE,CAAC,IAAsB,EAAE,EAAE;oBAC7C,SAAS,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAA;oBACjC,kBAAkB,EAAE,CAAA;gBACrB,CAAC;gBACD,8BAA8B,EAAE,CAAC,IAAsB,EAAE,EAAE;oBAC1D,SAAS,CAAC,0BAA0B,CAAC,IAAI,EAAE,MAAM,CAAC,oBAAoB,EAAE,CAAC,CAAA;gBAC1E,CAAC;gBACD,uBAAuB,EAAE,CAAC,IAAsB,EAAE,EAAE;oBACnD,SAAS,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAA;gBACnC,CAAC;aACA,CAAC,CACL,CAAA;IACF,CAAC;IAEgB,YAAY,GAAiD;QAC7E,UAAU,EAAE,IAAI,CAAC,eAAe;QAChC,qBAAqB,iCAAyB;QAC9C,KAAK,EAAE,IAAI;QACX,aAAa,EAAE,CAAC,GAAG,EAAE,EAAE;YACtB,MAAM,iBAAiB,GAAG,IAAI,YAAY,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,IAAI,CAAC,SAAS,EAAE,SAAS,EAAE,0BAA0B,CAAC,MAAM,CAAC,CAAC,CAAA;YACrH,CAAC,CAAC,MAAM,CAAC,GAAG,EAAE,iBAAiB,CAAC,MAAM,EAAE,CAAC,CAAA;YACzC,OAAO,iBAAiB,CAAA;QACzB,CAAC;KACD,CAAA;CACD;AAED,MAAM,OAAO,YAAY;IAWK;IAV7B,GAAG,GAAW,CAAC,CAAA;IACf,UAAU,GAAuB,IAAI,CAAA,CAAC,gBAAgB;IAC9C,WAAW,CAAmB;IAC9B,kBAAkB,GAAG,mCAAmC,EAAE,CAAA;IAElE,MAAM,GAA4B,IAAI,CAAA;IAC9B,gBAAgB,CAA8B;IAC9C,QAAQ,CAAc;IACtB,KAAK,CAAc;IAE3B,YAA6B,UAAoE;QAApE,eAAU,GAAV,UAAU,CAA0D;IAAG,CAAC;IAErG,MAAM,CAAC,KAAuB,EAAE,QAAiB,EAAE,eAAwB;QAC1E,IAAI,CAAC,MAAM,GAAG,KAAK,CAAA;QAEnB,IAAI,CAAC,gBAAgB,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAA;QACtC,IAAI,CAAC,oBAAoB,CAAC,mCAAmC,EAAE,IAAI,eAAe,CAAC,CAAA;QACnF,eAAe,CAAC,IAAI,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAA;QAC3C,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,QAAQ,IAAI,eAAe,CAAA;QAEtD,IAAI,CAAC,QAAQ,CAAC,WAAW,GAAG,KAAK,CAAC,YAAY,CAAA;IAC/C,CAAC;IAEO,oBAAoB,CAAC,IAAa;QACzC,IAAI,IAAI,CAAC,kBAAkB,KAAK,IAAI;YAAE,OAAM;QAC5C,IAAI,IAAI,EAAE,CAAC;YACV,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,YAAY,GAAG,kBAAkB,CAAA;YAErD,MAAM,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,SAAS,EAAE,CAAC,cAAc,EAAE,cAAc,CAAC,EAAE,EAAE,uBAAuB,CAAC,CAAA;YACnH,MAAM,YAAY,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,EAAE,SAAS,EAAE,CAAC,UAAU,EAAE,UAAU,CAAC,EAAE,EAAE,uBAAuB,CAAC,CAAA;YAE/G,OAAO,CAAC,GAAG,CAAC,CAAC,WAAW,CAAC,QAAQ,EAAE,YAAY,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;gBACpE,WAAW,CAAC,MAAM,EAAE,CAAA;gBACpB,YAAY,CAAC,MAAM,EAAE,CAAA;gBACrB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAA;YACxB,CAAC,EAAE,IAAI,CAAC,CAAA;QACT,CAAC;aAAM,CAAC;YACP,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,YAAY,GAAG,GAAG,CAAA;YAEtC,MAAM,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,SAAS,EAAE,CAAC,cAAc,EAAE,cAAc,CAAC,EAAE,EAAE,uBAAuB,CAAC,CAAA;YACnH,MAAM,YAAY,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,EAAE,SAAS,EAAE,CAAC,UAAU,EAAE,UAAU,CAAC,EAAE,EAAE,uBAAuB,CAAC,CAAA;YAE/G,OAAO,CAAC,GAAG,CAAC,CAAC,WAAW,CAAC,QAAQ,EAAE,YAAY,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;gBACpE,WAAW,CAAC,MAAM,EAAE,CAAA;gBACpB,YAAY,CAAC,MAAM,EAAE,CAAA;gBACrB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAA;YACxB,CAAC,EAAE,IAAI,CAAC,CAAA;QACT,CAAC;QACD,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAA;IAC/B,CAAC;IAED,MAAM;QACL,OAAO,CAAC,CACP,sBAAsB,EACtB;YACC,QAAQ,EAAE,CAAC,KAAK,EAAE,EAAE;gBACnB,OAAO,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,mCAAmC,EAAE,CAAC,CAAC,CAAA;YACvF,CAAC;YACD,mBAAmB,EAAE,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,gBAAgB,GAAG,OAAO,CAAC;SACnE,EACD,CAAC,CAAC,YAAY,EAAE;YACf,CAAC,CAAC,+BAA+B,EAAE;gBAClC,KAAK,EAAE;oBACN,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC;iBACb;aACD,CAAC;YACF,CAAC,CAAC,8BAA8B,EAAE;gBACjC,IAAI,EAAE,UAAU;gBAChB,KAAK,EAAE;oBACN,eAAe,EAAE,MAAM;iBACvB;gBACD,OAAO,EAAE,CAAC,CAAa,EAAE,EAAE;oBAC1B,CAAC,CAAC,eAAe,EAAE,CAAA;gBACpB,CAAC;gBACD,QAAQ,EAAE,GAAG,EAAE;oBACd,IAAI,IAAI,CAAC,MAAM;wBAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAA;gBACxE,CAAC;gBACD,QAAQ,EAAE,CAAC,KAAK,EAAE,EAAE;oBACnB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC,GAAuB,CAAA;oBAChD,eAAe,CAAC,IAAI,CAAC,WAAW,EAAE,KAAK,CAAC,CAAA;gBACzC,CAAC;aACD,CAAC;YACF,CAAC,CAAC,+BAA+B,EAAE;gBAClC,KAAK,EAAE;oBACN,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC;iBACb;aACD,CAAC;SACF,CAAC,EACF,CAAC,CAAC,qCAAqC,EAAE;YACxC,CAAC,CAAC,EAAE,EAAE;gBACL,CAAC,CAAC,+BAA+B,EAAE;oBAClC,KAAK,EAAE;wBACN,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC;qBACb;iBACD,CAAC;gBACF,CAAC,CAAC,kCAAkC,EAAE;oBACrC,QAAQ,EAAE,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC,GAAkB,CAAC;iBAC/D,CAAC;gBACF,CAAC,CAAC,+BAA+B,EAAE;oBAClC,KAAK,EAAE;wBACN,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC;qBACb;iBACD,CAAC;aACF,CAAC;SACF,CAAC,CACF,CAAA;IACF,CAAC;IAEO,YAAY,CAAC,IAAa;QACjC,IAAI,SAAS,CAAA;QACb,IAAI,KAAK,CAAA;QACT,IAAI,OAAO,CAAA;QACX,IAAI,IAAI,EAAE,CAAC;YACV,SAAS,GAAG,cAAc,CAAA;YAC1B,KAAK,GAAG,UAAU,CAAA;YAClB,OAAO,GAAG,kBAAkB,CAAA;QAC7B,CAAC;aAAM,CAAC;YACP,SAAS,GAAG,cAAc,CAAA;YAC1B,KAAK,GAAG,UAAU,CAAA;YAClB,OAAO,GAAG,GAAG,CAAA;QACd,CAAC;QAED,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,GAAG,SAAS,CAAA;QACzC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,YAAY,GAAG,OAAO,CAAA;QAC1C,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,SAAS,GAAG,KAAK,CAAA;QACxC,uDAAuD;QACvD,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAA;IACpD,CAAC;CACD","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { assertMainOrNode } from \"../../../common/api/common/Env.js\"\nimport { ListColumnWrapper } from \"../../../common/gui/ListColumnWrapper.js\"\nimport ColumnEmptyMessageBox from \"../../../common/gui/base/ColumnEmptyMessageBox.js\"\nimport { theme } from \"../../../common/gui/theme.js\"\nimport { Icons } from \"../../../common/gui/base/icons/Icons.js\"\nimport { List, MultiselectMode, RenderConfig } from \"../../../common/gui/base/List.js\"\nimport { ContactListEntry } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport { noOp } from \"@tutao/tutanota-utils\"\nimport { ContactListViewModel } from \"./ContactListViewModel.js\"\nimport { VirtualRow } from \"../../../common/gui/base/ListUtils.js\"\nimport {\n\tcheckboxOpacity,\n\tscaleXHide,\n\tscaleXShow,\n\tselectableRowAnimParams,\n\tSelectableRowContainer,\n\tSelectableRowSelectedSetter,\n\tshouldAlwaysShowMultiselectCheckbox,\n} from \"../../../common/gui/SelectableRowContainer.js\"\nimport { px, size } from \"../../../common/gui/size.js\"\nimport { shiftByForCheckbox, translateXHide, translateXShow } from \"./ContactRow.js\"\nimport { styles } from \"../../../common/gui/styles.js\"\n\nassertMainOrNode()\n\nexport interface ContactListViewAttrs {\n\tviewModel: ContactListViewModel\n\tfocusDetailsViewer: () => unknown\n}\n\nexport class ContactListRecipientView implements Component<ContactListViewAttrs> {\n\tprivate viewModel: ContactListViewModel | null = null\n\n\tview({ attrs: { viewModel, focusDetailsViewer } }: Vnode<ContactListViewAttrs>): Children {\n\t\tthis.viewModel = viewModel\n\n\t\tconst listModel = this.viewModel.listModel\n\t\treturn m(\n\t\t\tListColumnWrapper,\n\t\t\t{\n\t\t\t\theaderContent: null,\n\t\t\t},\n\t\t\tlistModel == null || listModel.isEmptyAndDone()\n\t\t\t\t? m(ColumnEmptyMessageBox, {\n\t\t\t\t\t\tcolor: theme.list_message_bg,\n\t\t\t\t\t\tmessage: \"noEntries_msg\",\n\t\t\t\t\t\ticon: Icons.People,\n\t\t\t\t  })\n\t\t\t\t: m(List, {\n\t\t\t\t\t\trenderConfig: this.renderConfig,\n\t\t\t\t\t\tstate: listModel.state,\n\t\t\t\t\t\tonLoadMore: () => listModel.loadMore(),\n\t\t\t\t\t\tonRetryLoading: () => listModel.retryLoading(),\n\t\t\t\t\t\tonStopLoading: () => listModel.stopLoading(),\n\t\t\t\t\t\tonSingleSelection: (item: ContactListEntry) => {\n\t\t\t\t\t\t\tlistModel.onSingleSelection(item)\n\t\t\t\t\t\t\tfocusDetailsViewer()\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonSingleTogglingMultiselection: (item: ContactListEntry) => {\n\t\t\t\t\t\t\tlistModel.onSingleInclusiveSelection(item, styles.isSingleColumnLayout())\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonRangeSelectionTowards: (item: ContactListEntry) => {\n\t\t\t\t\t\t\tlistModel.selectRangeTowards(item)\n\t\t\t\t\t\t},\n\t\t\t\t  }),\n\t\t)\n\t}\n\n\tprivate readonly renderConfig: RenderConfig<ContactListEntry, RecipientRow> = {\n\t\titemHeight: size.list_row_height,\n\t\tmultiselectionAllowed: MultiselectMode.Enabled,\n\t\tswipe: null,\n\t\tcreateElement: (dom) => {\n\t\t\tconst recipientEntryRow = new RecipientRow((entity) => this.viewModel?.listModel?.onSingleExclusiveSelection(entity))\n\t\t\tm.render(dom, recipientEntryRow.render())\n\t\t\treturn recipientEntryRow\n\t\t},\n\t}\n}\n\nexport class RecipientRow implements VirtualRow<ContactListEntry> {\n\ttop: number = 0\n\tdomElement: HTMLElement | null = null // set from List\n\tprivate checkboxDom!: HTMLInputElement\n\tprivate checkboxWasVisible = shouldAlwaysShowMultiselectCheckbox()\n\n\tentity: ContactListEntry | null = null\n\tprivate selectionUpdater!: SelectableRowSelectedSetter\n\tprivate titleDom!: HTMLElement\n\tprivate idDom!: HTMLElement\n\n\tconstructor(private readonly onSelected: (entity: ContactListEntry, selected: boolean) => unknown) {}\n\n\tupdate(entry: ContactListEntry, selected: boolean, isInMultiSelect: boolean): void {\n\t\tthis.entity = entry\n\n\t\tthis.selectionUpdater(selected, false)\n\t\tthis.showCheckboxAnimated(shouldAlwaysShowMultiselectCheckbox() || isInMultiSelect)\n\t\tcheckboxOpacity(this.checkboxDom, selected)\n\t\tthis.checkboxDom.checked = selected && isInMultiSelect\n\n\t\tthis.titleDom.textContent = entry.emailAddress\n\t}\n\n\tprivate showCheckboxAnimated(show: boolean) {\n\t\tif (this.checkboxWasVisible === show) return\n\t\tif (show) {\n\t\t\tthis.titleDom.style.paddingRight = shiftByForCheckbox\n\n\t\t\tconst addressAnim = this.titleDom.animate({ transform: [translateXHide, translateXShow] }, selectableRowAnimParams)\n\t\t\tconst checkboxAnim = this.checkboxDom.animate({ transform: [scaleXHide, scaleXShow] }, selectableRowAnimParams)\n\n\t\t\tPromise.all([addressAnim.finished, checkboxAnim.finished]).then(() => {\n\t\t\t\taddressAnim.cancel()\n\t\t\t\tcheckboxAnim.cancel()\n\t\t\t\tthis.showCheckbox(show)\n\t\t\t}, noOp)\n\t\t} else {\n\t\t\tthis.titleDom.style.paddingRight = \"0\"\n\n\t\t\tconst addressAnim = this.titleDom.animate({ transform: [translateXShow, translateXHide] }, selectableRowAnimParams)\n\t\t\tconst checkboxAnim = this.checkboxDom.animate({ transform: [scaleXShow, scaleXHide] }, selectableRowAnimParams)\n\n\t\t\tPromise.all([addressAnim.finished, checkboxAnim.finished]).then(() => {\n\t\t\t\taddressAnim.cancel()\n\t\t\t\tcheckboxAnim.cancel()\n\t\t\t\tthis.showCheckbox(show)\n\t\t\t}, noOp)\n\t\t}\n\t\tthis.checkboxWasVisible = show\n\t}\n\n\trender(): Children {\n\t\treturn m(\n\t\t\tSelectableRowContainer,\n\t\t\t{\n\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\tPromise.resolve().then(() => this.showCheckbox(shouldAlwaysShowMultiselectCheckbox()))\n\t\t\t\t},\n\t\t\t\tonSelectedChangeRef: (updater) => (this.selectionUpdater = updater),\n\t\t\t},\n\t\t\tm(\".mt-xs.abs\", [\n\t\t\t\tm(\".text-ellipsis.smaller.mt-xxs\", {\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\theight: px(9),\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tm(\"input.checkbox.list-checkbox\", {\n\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\ttransformOrigin: \"left\",\n\t\t\t\t\t},\n\t\t\t\t\tonclick: (e: MouseEvent) => {\n\t\t\t\t\t\te.stopPropagation()\n\t\t\t\t\t},\n\t\t\t\t\tonchange: () => {\n\t\t\t\t\t\tif (this.entity) this.onSelected(this.entity, this.checkboxDom.checked)\n\t\t\t\t\t},\n\t\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\t\tthis.checkboxDom = vnode.dom as HTMLInputElement\n\t\t\t\t\t\tcheckboxOpacity(this.checkboxDom, false)\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tm(\".text-ellipsis.smaller.mt-xxs\", {\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\theight: px(9),\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t]),\n\t\t\tm(\".flex.col.overflow-hidden.flex-grow\", [\n\t\t\t\tm(\"\", [\n\t\t\t\t\tm(\".text-ellipsis.smaller.mt-xxs\", {\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\theight: px(9),\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tm(\".text-ellipsis.badge-line-height\", {\n\t\t\t\t\t\toncreate: (vnode) => (this.titleDom = vnode.dom as HTMLElement),\n\t\t\t\t\t}),\n\t\t\t\t\tm(\".text-ellipsis.smaller.mt-xxs\", {\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\theight: px(9),\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t]),\n\t\t\t]),\n\t\t)\n\t}\n\n\tprivate showCheckbox(show: boolean) {\n\t\tlet translate\n\t\tlet scale\n\t\tlet padding\n\t\tif (show) {\n\t\t\ttranslate = translateXShow\n\t\t\tscale = scaleXShow\n\t\t\tpadding = shiftByForCheckbox\n\t\t} else {\n\t\t\ttranslate = translateXHide\n\t\t\tscale = scaleXHide\n\t\t\tpadding = \"0\"\n\t\t}\n\n\t\tthis.titleDom.style.transform = translate\n\t\tthis.titleDom.style.paddingRight = padding\n\t\tthis.checkboxDom.style.transform = scale\n\t\t// Stop the hidden checkbox from entering the tab index\n\t\tthis.checkboxDom.style.display = show ? \"\" : \"none\"\n\t}\n}\n"]}