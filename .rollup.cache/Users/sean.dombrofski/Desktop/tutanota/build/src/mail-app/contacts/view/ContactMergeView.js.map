{"version":3,"file":"ContactMergeView.js","sourceRoot":"","sources":["../../../../../src/mail-app/contacts/view/ContactMergeView.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { ChildArray, Children } from \"mithril\"\nimport { Dialog } from \"../../../common/gui/base/Dialog\"\nimport { windowFacade } from \"../../../common/misc/WindowFacade\"\nimport { Icons } from \"../../../common/gui/base/icons/Icons\"\nimport { ContactAddressType, ContactMergeAction, getContactSocialType, Keys } from \"../../../common/api/common/TutanotaConstants\"\nimport type { TranslationKey } from \"../../../common/misc/LanguageViewModel\"\nimport { lang } from \"../../../common/misc/LanguageViewModel\"\nimport { formatContactDate } from \"../../../common/contactsFunctionality/ContactUtils.js\"\nimport { defer, DeferredObject, delay, downcast, Thunk } from \"@tutao/tutanota-utils\"\nimport { HtmlEditor, HtmlEditorMode } from \"../../../common/gui/editor/HtmlEditor\"\nimport { ButtonType } from \"../../../common/gui/base/Button.js\"\nimport type { Contact } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport { getContactAddressTypeLabel, getContactPhoneNumberTypeLabel, getContactSocialTypeLabel } from \"./ContactGuiUtils\"\nimport { TextField } from \"../../../common/gui/base/TextField.js\"\nimport { TextDisplayArea } from \"../../../common/gui/base/TextDisplayArea\"\nimport { DialogHeaderBarAttrs } from \"../../../common/gui/base/DialogHeaderBar\"\nimport { IconButton } from \"../../../common/gui/base/IconButton.js\"\nimport { LoginButton } from \"../../../common/gui/base/buttons/LoginButton.js\"\n\nexport class ContactMergeView {\n\tdialog: Dialog\n\tcontact1: Contact\n\tcontact2: Contact\n\tresolveFunction: DeferredObject<ContactMergeAction>[\"resolve\"] | null = null // must be called after the user action\n\n\twindowCloseUnsubscribe: Thunk | null = null\n\n\tconstructor(contact1: Contact, contact2: Contact) {\n\t\tthis.contact1 = contact1\n\t\tthis.contact2 = contact2\n\n\t\tconst cancelAction = () => {\n\t\t\tthis._close(ContactMergeAction.Cancel)\n\t\t}\n\n\t\tconst headerBarAttrs = {\n\t\t\tleft: [\n\t\t\t\t{\n\t\t\t\t\tlabel: \"cancel_action\",\n\t\t\t\t\tclick: cancelAction,\n\t\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t\t},\n\t\t\t],\n\t\t\tright: [\n\t\t\t\t{\n\t\t\t\t\tlabel: \"skip_action\",\n\t\t\t\t\tclick: () => this._close(ContactMergeAction.Skip),\n\t\t\t\t\ttype: ButtonType.Primary,\n\t\t\t\t},\n\t\t\t],\n\t\t\tmiddle: \"merge_action\",\n\t\t}\n\t\tthis.dialog = Dialog.largeDialog(headerBarAttrs as DialogHeaderBarAttrs, this)\n\t\t\t.setCloseHandler(cancelAction)\n\t\t\t.addShortcut({\n\t\t\t\tkey: Keys.ESC,\n\t\t\t\texec: () => {\n\t\t\t\t\tthis._close(ContactMergeAction.Cancel)\n\t\t\t\t\treturn false\n\t\t\t\t},\n\t\t\t\thelp: \"close_alt\",\n\t\t\t})\n\t}\n\n\tview(): Children {\n\t\tconst { mailAddresses: mailAddresses1, phones: phones1, addresses: addresses1, socials: socials1 } = this._createContactFields(this.contact1)\n\n\t\tconst { mailAddresses: mailAddresses2, phones: phones2, addresses: addresses2, socials: socials2 } = this._createContactFields(this.contact2)\n\n\t\t//empty.. placeholders are used if one contact has an attribute while the other does not have it, so an empty one is shown for comparison\n\t\tlet emptyFieldPlaceholder = m(TextField, {\n\t\t\tlabel: \"emptyString_msg\",\n\t\t\tvalue: \"\",\n\t\t\tisReadOnly: true,\n\t\t})\n\t\tlet emptyHTMLFieldPlaceholder = m(\n\t\t\tnew HtmlEditor(\"emptyString_msg\").showBorders().setValue(\"\").setReadOnly(false).setMode(HtmlEditorMode.HTML).setHtmlMonospace(false),\n\t\t)\n\n\t\tlet titleFields = this._createTextFields(this.contact1.title, this.contact2.title, \"title_placeholder\")\n\n\t\tlet firstNameFields = this._createTextFields(this.contact1.firstName, this.contact2.firstName, \"firstName_placeholder\")\n\n\t\tlet lastNameFields = this._createTextFields(this.contact1.lastName, this.contact2.lastName, \"lastName_placeholder\")\n\n\t\tlet nicknameFields = this._createTextFields(this.contact1.nickname, this.contact2.nickname, \"nickname_placeholder\")\n\n\t\tlet companyFields = this._createTextFields(this.contact1.company, this.contact2.company, \"company_label\")\n\n\t\tlet roleFields = this._createTextFields(this.contact1.role, this.contact2.role, \"role_placeholder\")\n\n\t\tlet birthdayFields = this._createTextFields(formatContactDate(this.contact1.birthdayIso), formatContactDate(this.contact2.birthdayIso), \"birthday_alt\")\n\n\t\tlet presharedPasswordFields = this._createTextFields(\n\t\t\tthis.contact1.presharedPassword && this.contact1.presharedPassword.length > 0 ? \"***\" : \"\",\n\t\t\tthis.contact2.presharedPassword && this.contact2.presharedPassword.length > 0 ? \"***\" : \"\",\n\t\t\t\"presharedPassword_label\",\n\t\t)\n\n\t\tlet commentField1: Children = null\n\t\tlet commentField2: Children = null\n\n\t\tif (this.contact1.comment || this.contact2.comment) {\n\t\t\tcommentField1 = m(TextDisplayArea, {\n\t\t\t\tlabel: \"comment_label\",\n\t\t\t\tvalue: this.contact1.comment,\n\t\t\t})\n\t\t\tcommentField2 = m(TextDisplayArea, {\n\t\t\t\tlabel: \"comment_label\",\n\t\t\t\tvalue: this.contact2.comment,\n\t\t\t})\n\t\t}\n\n\t\treturn m(\n\t\t\t\"#contact-editor\",\n\t\t\t{\n\t\t\t\toncreate: () => (this.windowCloseUnsubscribe = windowFacade.addWindowCloseListener(() => {})),\n\t\t\t\tonremove: () => this.windowCloseUnsubscribe?.(),\n\t\t\t},\n\t\t\t[\n\t\t\t\tm(\".flex-center.mt\", [\n\t\t\t\t\tm(\".full-width.max-width-s\", [\n\t\t\t\t\t\tm(LoginButton, {\n\t\t\t\t\t\t\tlabel: \"mergeContacts_action\",\n\t\t\t\t\t\t\tonclick: () => this._close(ContactMergeAction.Merge),\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t\tm(\".non-wrapping-row\", [\n\t\t\t\t\tm(\n\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t/*first contact */\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\tm(\".items-center\", [\n\t\t\t\t\t\t\t\tm(\".items-base.flex-space-between\", [\n\t\t\t\t\t\t\t\t\tm(\".h4.mt-l\", lang.get(\"firstMergeContact_label\")),\n\t\t\t\t\t\t\t\t\tthis._createDeleteContactButton(ContactMergeAction.DeleteFirst),\n\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t],\n\t\t\t\t\t),\n\t\t\t\t\tm(\n\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t/*second contact */\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\tm(\".items-center\", [\n\t\t\t\t\t\t\t\tm(\".items-base.flex-space-between\", [\n\t\t\t\t\t\t\t\t\tm(\".h4.mt-l\", lang.get(\"secondMergeContact_label\")),\n\t\t\t\t\t\t\t\t\tthis._createDeleteContactButton(ContactMergeAction.DeleteSecond),\n\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t],\n\t\t\t\t\t),\n\t\t\t\t]),\n\t\t\t\ttitleFields ? m(\".non-wrapping-row\", titleFields) : null,\n\t\t\t\tfirstNameFields ? m(\".non-wrapping-row\", firstNameFields) : null,\n\t\t\t\tlastNameFields ? m(\".non-wrapping-row\", lastNameFields) : null,\n\t\t\t\tnicknameFields ? m(\".non-wrapping-row\", nicknameFields) : null,\n\t\t\t\tcompanyFields ? m(\".non-wrapping-row\", companyFields) : null,\n\t\t\t\tbirthdayFields ? m(\".non-wrapping-row\", birthdayFields) : null,\n\t\t\t\troleFields ? m(\".non-wrapping-row\", roleFields) : null,\n\t\t\t\tmailAddresses1.length > 0 || mailAddresses2.length > 0\n\t\t\t\t\t? m(\".non-wrapping-row\", [\n\t\t\t\t\t\t\tm(\".mail.mt-l\", [m(\"\", lang.get(\"email_label\")), mailAddresses1.length > 0 ? mailAddresses1 : emptyFieldPlaceholder]),\n\t\t\t\t\t\t\tm(\".mail.mt-l\", [m(\"\", lang.get(\"email_label\")), mailAddresses2.length > 0 ? mailAddresses2 : emptyFieldPlaceholder]),\n\t\t\t\t\t  ])\n\t\t\t\t\t: null,\n\t\t\t\tphones1.length > 0 || phones2.length > 0\n\t\t\t\t\t? m(\".non-wrapping-row\", [\n\t\t\t\t\t\t\tm(\".phone.mt-l\", [m(\"\", lang.get(\"phone_label\")), m(\".aggregateEditors\", [phones1.length > 0 ? phones1 : emptyFieldPlaceholder])]),\n\t\t\t\t\t\t\tm(\".phone.mt-l\", [m(\"\", lang.get(\"phone_label\")), m(\".aggregateEditors\", [phones2.length > 0 ? phones2 : emptyFieldPlaceholder])]),\n\t\t\t\t\t  ])\n\t\t\t\t\t: null,\n\t\t\t\taddresses1.length > 0 || addresses2.length > 0\n\t\t\t\t\t? m(\".non-wrapping-row\", [\n\t\t\t\t\t\t\tm(\".address.mt-l.flex.flex-column\", [\n\t\t\t\t\t\t\t\tm(\"\", lang.get(\"address_label\")),\n\t\t\t\t\t\t\t\tm(\".aggregateEditors.flex.flex-column.flex-grow\", [addresses1.length > 0 ? addresses1 : emptyHTMLFieldPlaceholder]),\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\tm(\".address.mt-l\", [\n\t\t\t\t\t\t\t\tm(\"\", lang.get(\"address_label\")),\n\t\t\t\t\t\t\t\tm(\".aggregateEditors.flex.flex-column.flex-grow\", [addresses2.length > 0 ? addresses2 : emptyHTMLFieldPlaceholder]),\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t  ])\n\t\t\t\t\t: null,\n\t\t\t\tsocials1.length > 0 || socials2.length > 0\n\t\t\t\t\t? m(\".non-wrapping-row\", [\n\t\t\t\t\t\t\tm(\".social.mt-l\", [\n\t\t\t\t\t\t\t\tm(\"\", lang.get(\"social_label\")),\n\t\t\t\t\t\t\t\tm(\".aggregateEditors\", socials1.length > 0 ? socials1 : emptyFieldPlaceholder),\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\tm(\".social.mt-l\", [\n\t\t\t\t\t\t\t\tm(\"\", lang.get(\"social_label\")),\n\t\t\t\t\t\t\t\tm(\".aggregateEditors\", socials2.length > 0 ? socials2 : emptyFieldPlaceholder),\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t  ])\n\t\t\t\t\t: null,\n\t\t\t\tcommentField1 && commentField2\n\t\t\t\t\t? m(\".non-wrapping-row\", [m(\".mt-l.flex.flex-column\", [commentField1]), m(\".mt-l.flex.flex-column\", [commentField2])])\n\t\t\t\t\t: null,\n\t\t\t\tpresharedPasswordFields ? m(\".non-wrapping-row\", presharedPasswordFields) : null,\n\t\t\t\tm(\n\t\t\t\t\t\"\",\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\theight: \"5px\",\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t/*Used as spacer so the last gui-element is not touching the window border*/\n\t\t\t\t),\n\t\t\t],\n\t\t)\n\t}\n\n\t_createContactFields(contact: Contact): {\n\t\tmailAddresses: ChildArray\n\t\tphones: ChildArray\n\t\taddresses: ChildArray\n\t\tsocials: ChildArray\n\t} {\n\t\tconst mailAddresses = contact.mailAddresses.map((element) => {\n\t\t\treturn m(TextField, {\n\t\t\t\tlabel: getContactAddressTypeLabel(element.type as any, element.customTypeName),\n\t\t\t\tvalue: element.address,\n\t\t\t\tisReadOnly: true,\n\t\t\t})\n\t\t})\n\t\tconst phones = contact.phoneNumbers.map((element) => {\n\t\t\treturn m(TextField, {\n\t\t\t\tlabel: getContactPhoneNumberTypeLabel(element.type as any, element.customTypeName),\n\t\t\t\tvalue: element.number,\n\t\t\t\tisReadOnly: true,\n\t\t\t})\n\t\t})\n\t\tconst addresses = contact.addresses.map((element) => {\n\t\t\t// Manually implement text area to make it stretch vertically. TextField is unable to do that.\n\t\t\treturn m(TextDisplayArea, {\n\t\t\t\tvalue: element.address,\n\t\t\t\tlabel: getContactAddressTypeLabel(downcast<ContactAddressType>(element.type), element.customTypeName),\n\t\t\t})\n\t\t})\n\t\tconst socials = contact.socialIds.map((element) => {\n\t\t\treturn m(TextField, {\n\t\t\t\tlabel: getContactSocialTypeLabel(getContactSocialType(element), element.customTypeName),\n\t\t\t\tvalue: element.socialId,\n\t\t\t\tisReadOnly: true,\n\t\t\t})\n\t\t})\n\t\treturn {\n\t\t\tmailAddresses,\n\t\t\tphones,\n\t\t\taddresses,\n\t\t\tsocials,\n\t\t}\n\t}\n\n\t_createTextFields(value1: string | null, value2: string | null, labelTextId: TranslationKey): Children {\n\t\tif (value1 || value2) {\n\t\t\treturn [\n\t\t\t\tm(TextField, {\n\t\t\t\t\tlabel: labelTextId,\n\t\t\t\t\tvalue: value1 || \"\",\n\t\t\t\t\tisReadOnly: true,\n\t\t\t\t}),\n\t\t\t\tm(TextField, {\n\t\t\t\t\tlabel: labelTextId,\n\t\t\t\t\tvalue: value2 || \"\",\n\t\t\t\t\tisReadOnly: true,\n\t\t\t\t}),\n\t\t\t]\n\t\t} else {\n\t\t\treturn null\n\t\t}\n\t}\n\n\t_createDeleteContactButton(action: ContactMergeAction): Children {\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"delete_action\",\n\t\t\tclick: () => {\n\t\t\t\tDialog.confirm(\"deleteContact_msg\").then((confirmed) => {\n\t\t\t\t\tif (confirmed) {\n\t\t\t\t\t\tthis._close(action)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\ticon: Icons.Trash,\n\t\t})\n\t}\n\n\tshow(): Promise<ContactMergeAction> {\n\t\tthis.dialog.show()\n\t\tlet d = defer<ContactMergeAction>()\n\t\tthis.resolveFunction = d.resolve\n\t\treturn d.promise\n\t}\n\n\t_close(action: ContactMergeAction): void {\n\t\tthis.dialog.close()\n\t\tdelay(200).then(() => {\n\t\t\tthis.resolveFunction?.(action)\n\t\t})\n\t}\n}\n"]}