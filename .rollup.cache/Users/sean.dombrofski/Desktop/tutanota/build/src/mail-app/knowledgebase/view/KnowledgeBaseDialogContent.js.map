{"version":3,"file":"KnowledgeBaseDialogContent.js","sourceRoot":"","sources":["../../../../../src/mail-app/knowledgebase/view/KnowledgeBaseDialogContent.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { KnowledgeBaseModel } from \"../model/KnowledgeBaseModel.js\"\nimport type { EmailTemplate, KnowledgeBaseEntry } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport { KNOWLEDGEBASE_LIST_ENTRY_HEIGHT, KnowledgeBaseListEntry } from \"./KnowledgeBaseListEntry.js\"\nimport { lang } from \"../../../common/misc/LanguageViewModel.js\"\nimport stream from \"mithril/stream\"\nimport Stream from \"mithril/stream\"\nimport { KnowledgeBaseEntryView } from \"./KnowledgeBaseEntryView.js\"\nimport { NotFoundError } from \"../../../common/api/common/error/RestError.js\"\nimport { Dialog } from \"../../../common/gui/base/Dialog.js\"\nimport { TextField } from \"../../../common/gui/base/TextField.js\"\nimport { makeListSelectionChangedScrollHandler } from \"../../../common/gui/base/GuiUtils.js\"\nimport { ofClass } from \"@tutao/tutanota-utils\"\n\nexport type KnowledgebaseDialogContentAttrs = {\n\treadonly onTemplateSelect: (arg0: EmailTemplate) => void\n\treadonly model: KnowledgeBaseModel\n}\n\n/**\n *  Renders the SearchBar and the pages (list, entry, template) of the knowledgeBase besides the MailEditor\n */\nexport class KnowledgeBaseDialogContent implements Component<KnowledgebaseDialogContentAttrs> {\n\tprivate _streams: Array<Stream<any>>\n\tprivate filterValue: string = \"\"\n\tprivate _selectionChangedListener!: Stream<void>\n\n\tconstructor() {\n\t\tthis._streams = []\n\t}\n\n\toncreate({ attrs }: Vnode<KnowledgebaseDialogContentAttrs>) {\n\t\tconst { model } = attrs\n\n\t\tthis._streams.push(\n\t\t\tstream.combine(() => {\n\t\t\t\tm.redraw()\n\t\t\t}, [model.selectedEntry, model.filteredEntries]),\n\t\t)\n\t}\n\n\tonremove() {\n\t\tfor (let stream of this._streams) {\n\t\t\tstream.end(true)\n\t\t}\n\t}\n\n\tview({ attrs }: Vnode<KnowledgebaseDialogContentAttrs>): Children {\n\t\tconst model = attrs.model\n\t\tconst selectedEntry = model.selectedEntry()\n\t\treturn selectedEntry\n\t\t\t? m(KnowledgeBaseEntryView, {\n\t\t\t\t\tentry: selectedEntry,\n\t\t\t\t\tonTemplateSelected: (templateId) => {\n\t\t\t\t\t\tmodel\n\t\t\t\t\t\t\t.loadTemplate(templateId)\n\t\t\t\t\t\t\t.then((fetchedTemplate) => {\n\t\t\t\t\t\t\t\tattrs.onTemplateSelect(fetchedTemplate)\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(ofClass(NotFoundError, () => Dialog.message(\"templateNotExists_msg\")))\n\t\t\t\t\t},\n\t\t\t\t\treadonly: model.isReadOnly(selectedEntry),\n\t\t\t  })\n\t\t\t: [\n\t\t\t\t\tm(TextField, {\n\t\t\t\t\t\tlabel: \"filter_label\",\n\t\t\t\t\t\tvalue: this.filterValue,\n\t\t\t\t\t\toninput: (value) => {\n\t\t\t\t\t\t\tthis.filterValue = value\n\t\t\t\t\t\t\tmodel.filter(value)\n\t\t\t\t\t\t\tm.redraw()\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tthis._renderKeywords(model),\n\t\t\t\t\tthis._renderList(model, attrs),\n\t\t\t  ]\n\t}\n\n\t_renderKeywords(model: KnowledgeBaseModel): Children {\n\t\tconst matchedKeywords = model.getMatchedKeywordsInContent()\n\t\treturn m(\".flex.mt-s.wrap\", [\n\t\t\tmatchedKeywords.length > 0 ? m(\".small.full-width\", lang.get(\"matchingKeywords_label\")) : null,\n\t\t\tmatchedKeywords.map((keyword) => {\n\t\t\t\treturn m(\".keyword-bubble-no-padding.plr-button.pl-s.pr-s.border-radius.no-wrap.mr-s.min-content\", keyword)\n\t\t\t}),\n\t\t])\n\t}\n\n\t_renderList(model: KnowledgeBaseModel, attrs: KnowledgebaseDialogContentAttrs): Children {\n\t\treturn m(\n\t\t\t\".mt-s.scroll\",\n\t\t\t{\n\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\tthis._selectionChangedListener = model.selectedEntry.map(\n\t\t\t\t\t\tmakeListSelectionChangedScrollHandler(\n\t\t\t\t\t\t\tvnode.dom as HTMLElement,\n\t\t\t\t\t\t\tKNOWLEDGEBASE_LIST_ENTRY_HEIGHT,\n\t\t\t\t\t\t\tmodel.getSelectedEntryIndex.bind(model),\n\t\t\t\t\t\t),\n\t\t\t\t\t)\n\t\t\t\t},\n\t\t\t\tonbeforeremove: () => {\n\t\t\t\t\tthis._selectionChangedListener.end()\n\t\t\t\t},\n\t\t\t},\n\t\t\t[\n\t\t\t\tmodel.containsResult()\n\t\t\t\t\t? model.filteredEntries().map((entry) => this._renderListEntry(model, entry))\n\t\t\t\t\t: m(\".center\", lang.get(\"noEntryFound_label\")),\n\t\t\t],\n\t\t)\n\t}\n\n\t_renderListEntry(model: KnowledgeBaseModel, entry: KnowledgeBaseEntry): Children {\n\t\treturn m(\".flex.flex-column.click.hoverable-list-item\", [\n\t\t\tm(\n\t\t\t\t\".flex\",\n\t\t\t\t{\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tmodel.selectedEntry(entry)\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[\n\t\t\t\t\tm(KnowledgeBaseListEntry, {\n\t\t\t\t\t\tentry: entry,\n\t\t\t\t\t}),\n\t\t\t\t\tm(\"\", {\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\twidth: \"17.1px\",\n\t\t\t\t\t\t\theight: \"16px\",\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t),\n\t\t])\n\t}\n}\n"]}