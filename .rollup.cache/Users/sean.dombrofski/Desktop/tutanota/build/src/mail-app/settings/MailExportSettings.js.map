{"version":3,"file":"MailExportSettings.js","sourceRoot":"","sources":["../../../../src/mail-app/settings/MailExportSettings.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { lang } from \"../../common/misc/LanguageViewModel\"\nimport { DropDownSelector, type DropDownSelectorAttrs } from \"../../common/gui/base/DropDownSelector\"\nimport { MailboxDetail } from \"../../common/mailFunctionality/MailboxModel\"\nimport { getMailboxName } from \"../../common/mailFunctionality/SharedMailUtils\"\nimport { mailLocator } from \"../mailLocator\"\nimport { first } from \"@tutao/tutanota-utils\"\nimport { LoginController } from \"../../common/api/main/LoginController\"\nimport { MailExportController } from \"../native/main/MailExportController.js\"\nimport Stream from \"mithril/stream\"\nimport { Button, ButtonType } from \"../../common/gui/base/Button\"\nimport { IconButton } from \"../../common/gui/base/IconButton\"\nimport { Icons } from \"../../common/gui/base/icons/Icons\"\nimport { ButtonSize } from \"../../common/gui/base/ButtonSize\"\nimport { LoginButton, LoginButtonType } from \"../../common/gui/base/buttons/LoginButton\"\nimport { Icon, IconSize } from \"../../common/gui/base/Icon\"\nimport { BootIcons } from \"../../common/gui/base/icons/BootIcons\"\n\ninterface MailExportSettingsAttrs {\n\tmailboxDetails: MailboxDetail[]\n\tlogins: LoginController\n\tmailExportController: MailExportController\n}\n\nexport class MailExportSettings implements Component<MailExportSettingsAttrs> {\n\tprivate selectedMailbox: MailboxDetail | null = null\n\tprivate controllerSubscription: Stream<void> | null = null\n\tprivate isExportHistoryExpanded: boolean = false\n\n\toncreate(vnode: Vnode<MailExportSettingsAttrs>) {\n\t\tthis.controllerSubscription = vnode.attrs.mailExportController.state.map(m.redraw)\n\t}\n\n\tonremove() {\n\t\tif (this.controllerSubscription) {\n\t\t\tthis.controllerSubscription.end()\n\t\t\tthis.controllerSubscription = null\n\t\t}\n\t}\n\n\tview(vnode: Vnode<MailExportSettingsAttrs>): Children {\n\t\tconst { mailboxDetails } = vnode.attrs\n\t\tthis.selectedMailbox = this.selectedMailbox ?? first(mailboxDetails)\n\t\tconst state = vnode.attrs.mailExportController.state()\n\t\tconst emptyLabel = m(\"br\")\n\t\treturn [\n\t\t\tm(DropDownSelector, {\n\t\t\t\tlabel: \"mailboxToExport_label\",\n\t\t\t\titems: mailboxDetails.map((mailboxDetail) => {\n\t\t\t\t\treturn { name: getMailboxName(mailLocator.logins, mailboxDetail), value: mailboxDetail }\n\t\t\t\t}),\n\t\t\t\tselectedValue: this.selectedMailbox,\n\t\t\t\tselectionChangedHandler: (selectedMailbox) => {\n\t\t\t\t\tthis.selectedMailbox = selectedMailbox\n\t\t\t\t},\n\t\t\t\tdropdownWidth: 300,\n\t\t\t\tdisabled: state.type === \"exporting\",\n\t\t\t\thelpLabel: () => emptyLabel,\n\t\t\t} satisfies DropDownSelectorAttrs<MailboxDetail>),\n\t\t\tthis.renderState(vnode.attrs.mailExportController),\n\t\t]\n\t}\n\n\tprivate renderState(controller: MailExportController): Children {\n\t\tconst state = controller.state()\n\t\tswitch (state.type) {\n\t\t\tcase \"exporting\":\n\t\t\t\treturn [\n\t\t\t\t\tm(\n\t\t\t\t\t\t\".flex-start.mt-m.small\",\n\t\t\t\t\t\tlang.get(\"exportingEmails_label\", {\n\t\t\t\t\t\t\t\"{count}\": state.exportedMails,\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t\tm(\".flex-space-between.border-radius-big.mt-s.rel.nav-bg.full-width.center-vertically\", [\n\t\t\t\t\t\tm(Icon, {\n\t\t\t\t\t\t\ticon: BootIcons.Progress,\n\t\t\t\t\t\t\tclass: \"flex-center items-center icon-progress-tiny icon-progress ml-s\",\n\t\t\t\t\t\t\tsize: IconSize.Medium,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tm(IconButton, {\n\t\t\t\t\t\t\ttitle: \"cancel_action\",\n\t\t\t\t\t\t\ticon: Icons.Cancel,\n\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\tcontroller.cancelExport()\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsize: ButtonSize.Normal,\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]\n\t\t\tcase \"idle\":\n\t\t\t\treturn [\n\t\t\t\t\tm(\".flex-start.mt-m\", this.renderExportInfoText()),\n\t\t\t\t\tm(\n\t\t\t\t\t\t\".flex-start.mt-s\",\n\t\t\t\t\t\tm(LoginButton, {\n\t\t\t\t\t\t\ttype: LoginButtonType.FlexWidth,\n\t\t\t\t\t\t\tlabel: \"export_action\",\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tif (this.selectedMailbox) {\n\t\t\t\t\t\t\t\t\tcontroller.startExport(this.selectedMailbox)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t]\n\t\t\tcase \"error\":\n\t\t\t\treturn [\n\t\t\t\t\tm(\".flex-space-between.items-center.mt.mb-s\", [\n\t\t\t\t\t\tm(\"small.noselect\", state.message),\n\t\t\t\t\t\tm(Button, {\n\t\t\t\t\t\t\tlabel: \"retry_action\",\n\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\tcontroller.cancelExport()\n\t\t\t\t\t\t\t\tif (this.selectedMailbox) {\n\t\t\t\t\t\t\t\t\tcontroller.startExport(this.selectedMailbox)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]\n\t\t\tcase \"finished\":\n\t\t\t\treturn [\n\t\t\t\t\tm(\"small.noselect\", lang.get(\"exportFinished_label\")),\n\t\t\t\t\tm(\n\t\t\t\t\t\t\".flex-start.mt-s\",\n\t\t\t\t\t\tm(LoginButton, {\n\t\t\t\t\t\t\ttype: LoginButtonType.FlexWidth,\n\t\t\t\t\t\t\tlabel: \"open_action\",\n\t\t\t\t\t\t\tonclick: () => this.onOpenClicked(controller),\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t]\n\t\t\tcase \"locked\":\n\t\t\t\treturn [\n\t\t\t\t\tm(\".flex-space-between.items-center.mt.mb-s.button-height\", [\n\t\t\t\t\t\tm(\"small.noselect\", `${lang.get(\"exportRunningElsewhere_label\")} ${lang.get(\"pleaseWait_msg\")}`),\n\t\t\t\t\t]),\n\t\t\t\t]\n\t\t}\n\t}\n\n\tprivate async onOpenClicked(controller: MailExportController) {\n\t\tawait controller.openExportDirectory()\n\t\tawait controller.cancelExport()\n\t}\n\n\tprivate renderExportInfoText() {\n\t\treturn [m(\".small\", lang.get(\"mailExportInfoText_label\"))]\n\t}\n}\n"]}