{"version":3,"file":"SearchListView.js","sourceRoot":"","sources":["../../../../../src/mail-app/search/view/SearchListView.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { assertMainOrNode } from \"../../../common/api/common/Env\"\nimport { downcast, isSameTypeRef, TypeRef } from \"@tutao/tutanota-utils\"\nimport { MailRow } from \"../../mail/view/MailRow\"\nimport { ListElementListModel } from \"../../../common/misc/ListElementListModel.js\"\nimport { List, ListAttrs, MultiselectMode, RenderConfig } from \"../../../common/gui/base/List.js\"\nimport { size } from \"../../../common/gui/size.js\"\nimport { KindaContactRow } from \"../../contacts/view/ContactListView.js\"\nimport { SearchableTypes } from \"./SearchViewModel.js\"\nimport { CalendarEvent, CalendarEventTypeRef, Contact, ContactTypeRef, Mail, MailFolder } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport ColumnEmptyMessageBox from \"../../../common/gui/base/ColumnEmptyMessageBox.js\"\nimport { BootIcons } from \"../../../common/gui/base/icons/BootIcons.js\"\nimport { lang } from \"../../../common/misc/LanguageViewModel.js\"\nimport { theme } from \"../../../common/gui/theme.js\"\nimport { VirtualRow } from \"../../../common/gui/base/ListUtils.js\"\nimport { styles } from \"../../../common/gui/styles.js\"\nimport { KindaCalendarRow } from \"../../../calendar-app/calendar/gui/CalendarRow.js\"\nimport { AllIcons } from \"../../../common/gui/base/Icon.js\"\n\nassertMainOrNode()\n\nexport class SearchResultListEntry {\n\tconstructor(readonly entry: SearchableTypes) {}\n\n\tget _id(): IdTuple {\n\t\treturn this.entry._id\n\t}\n}\n\nexport interface SearchListViewAttrs {\n\tlistModel: ListElementListModel<SearchResultListEntry>\n\tonSingleSelection: (item: SearchResultListEntry) => unknown\n\tcurrentType: TypeRef<Mail> | TypeRef<Contact> | TypeRef<CalendarEvent>\n\tisFreeAccount: boolean\n\tcancelCallback: () => unknown | null\n\tgetLabelsForMail: (mail: Mail) => MailFolder[]\n}\n\nexport class SearchListView implements Component<SearchListViewAttrs> {\n\tprivate attrs: SearchListViewAttrs\n\n\tprivate get listModel(): ListElementListModel<SearchResultListEntry> {\n\t\treturn this.attrs.listModel\n\t}\n\n\tconstructor({ attrs }: Vnode<SearchListViewAttrs>) {\n\t\tthis.attrs = attrs\n\t}\n\n\tview({ attrs }: Vnode<SearchListViewAttrs>): Children {\n\t\tthis.attrs = attrs\n\t\tconst { icon, renderConfig } = this.getRenderItems(attrs.currentType)\n\n\t\treturn attrs.listModel.isEmptyAndDone()\n\t\t\t? m(ColumnEmptyMessageBox, {\n\t\t\t\t\ticon,\n\t\t\t\t\tmessage: \"searchNoResults_msg\",\n\t\t\t\t\tcolor: theme.list_message_bg,\n\t\t\t  })\n\t\t\t: m(List, {\n\t\t\t\t\tstate: attrs.listModel.state,\n\t\t\t\t\trenderConfig,\n\t\t\t\t\tonLoadMore: () => {\n\t\t\t\t\t\tattrs.listModel?.loadMore()\n\t\t\t\t\t},\n\t\t\t\t\tonRetryLoading: () => {\n\t\t\t\t\t\tattrs.listModel?.retryLoading()\n\t\t\t\t\t},\n\t\t\t\t\tonSingleSelection: (item: SearchResultListEntry) => {\n\t\t\t\t\t\tattrs.listModel?.onSingleSelection(item)\n\t\t\t\t\t\tattrs.onSingleSelection(item)\n\t\t\t\t\t},\n\t\t\t\t\tonSingleTogglingMultiselection: (item: SearchResultListEntry) => {\n\t\t\t\t\t\tattrs.listModel.onSingleInclusiveSelection(item, styles.isSingleColumnLayout())\n\t\t\t\t\t},\n\t\t\t\t\tonRangeSelectionTowards: (item: SearchResultListEntry) => {\n\t\t\t\t\t\tattrs.listModel.selectRangeTowards(item)\n\t\t\t\t\t},\n\t\t\t\t\tonStopLoading() {\n\t\t\t\t\t\tif (attrs.cancelCallback != null) {\n\t\t\t\t\t\t\tattrs.cancelCallback()\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tattrs.listModel.stopLoading()\n\t\t\t\t\t},\n\t\t\t  } satisfies ListAttrs<SearchResultListEntry, SearchResultListRow>)\n\t}\n\n\tprivate getRenderItems(type: TypeRef<Mail> | TypeRef<Contact> | TypeRef<CalendarEvent>): {\n\t\ticon: AllIcons\n\t\trenderConfig: RenderConfig<SearchResultListEntry, SearchResultListRow>\n\t} {\n\t\tif (isSameTypeRef(type, ContactTypeRef)) {\n\t\t\treturn {\n\t\t\t\ticon: BootIcons.Contacts,\n\t\t\t\trenderConfig: this.contactRenderConfig,\n\t\t\t}\n\t\t} else if (isSameTypeRef(type, CalendarEventTypeRef)) {\n\t\t\treturn {\n\t\t\t\ticon: BootIcons.Calendar,\n\t\t\t\trenderConfig: this.calendarRenderConfig,\n\t\t\t}\n\t\t} else {\n\t\t\treturn {\n\t\t\t\ticon: BootIcons.Mail,\n\t\t\t\trenderConfig: this.mailRenderConfig,\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate readonly calendarRenderConfig: RenderConfig<SearchResultListEntry, SearchResultListRow> = {\n\t\titemHeight: size.list_row_height,\n\t\tmultiselectionAllowed: MultiselectMode.Disabled,\n\t\tswipe: null,\n\t\tcreateElement: (dom) => {\n\t\t\tconst row: SearchResultListRow = new SearchResultListRow(new KindaCalendarRow(dom))\n\t\t\tm.render(dom, row.render())\n\t\t\treturn row\n\t\t},\n\t}\n\n\tprivate readonly mailRenderConfig: RenderConfig<SearchResultListEntry, SearchResultListRow> = {\n\t\titemHeight: size.list_row_height,\n\t\tmultiselectionAllowed: MultiselectMode.Enabled,\n\t\tswipe: null,\n\t\tcreateElement: (dom) => {\n\t\t\tconst row: SearchResultListRow = new SearchResultListRow(\n\t\t\t\tnew MailRow(\n\t\t\t\t\ttrue,\n\t\t\t\t\t(mail) => this.attrs.getLabelsForMail(mail),\n\t\t\t\t\t() => row.entity && this.listModel.onSingleExclusiveSelection(row.entity),\n\t\t\t\t),\n\t\t\t)\n\t\t\tm.render(dom, row.render())\n\t\t\treturn row\n\t\t},\n\t}\n\n\tprivate readonly contactRenderConfig: RenderConfig<SearchResultListEntry, SearchResultListRow> = {\n\t\titemHeight: size.list_row_height,\n\t\tmultiselectionAllowed: MultiselectMode.Enabled,\n\t\tswipe: null,\n\t\tcreateElement: (dom) => {\n\t\t\tconst row: SearchResultListRow = new SearchResultListRow(\n\t\t\t\tnew KindaContactRow(dom, () => row.entity && this.listModel.onSingleExclusiveSelection(row.entity)),\n\t\t\t)\n\t\t\tm.render(dom, row.render())\n\t\t\treturn row\n\t\t},\n\t}\n}\n\nexport class SearchResultListRow implements VirtualRow<SearchResultListEntry> {\n\ttop: number\n\t// set from List\n\tdomElement: HTMLElement | null = null\n\n\t// this is our own entry which we need for some reason (probably easier to deal with than a lot of sum type entries)\n\tprivate _entity: SearchResultListEntry | null = null\n\tget entity(): SearchResultListEntry | null {\n\t\treturn this._entity\n\t}\n\n\tprivate _delegate: MailRow | KindaContactRow | KindaCalendarRow\n\n\tconstructor(delegate: MailRow | KindaContactRow | KindaCalendarRow) {\n\t\tthis._delegate = delegate\n\t\tthis.top = 0\n\t}\n\n\tupdate(entry: SearchResultListEntry, selected: boolean, isInMultiSelect: boolean): void {\n\t\tthis._delegate.domElement = this.domElement\n\t\tthis._entity = entry\n\n\t\tthis._delegate.update(downcast(entry.entry), selected, isInMultiSelect)\n\t}\n\n\trender(): Children {\n\t\treturn this._delegate.render()\n\t}\n}\n"]}