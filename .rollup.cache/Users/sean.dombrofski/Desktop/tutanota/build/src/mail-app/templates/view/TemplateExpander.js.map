{"version":3,"file":"TemplateExpander.js","sourceRoot":"","sources":["../../../../../src/mail-app/templates/view/TemplateExpander.ts"],"names":[],"mappings":"AAAA,OAAO,CAAiC,MAAM,SAAS,CAAA;AACvD,OAAO,EAAE,EAAE,EAAE,IAAI,EAAE,MAAM,0BAA0B,CAAA;AACnD,OAAO,EAAE,IAAI,EAAE,MAAM,8CAA8C,CAAA;AAEnE,OAAO,EAAE,YAAY,EAAE,MAAM,iCAAiC,CAAA;AAE9D,OAAO,EAAE,qBAAqB,EAAE,MAAM,wBAAwB,CAAA;AAC9D,OAAO,EAAE,QAAQ,EAAE,MAAM,uBAAuB,CAAA;AAChD,OAAO,EAAE,aAAa,EAAE,MAAM,uCAAuC,CAAA;AACrE,OAAO,EAAE,KAAK,EAAE,MAAM,8BAA8B,CAAA;AAWpD,MAAM,OAAO,gBAAgB;IACX,aAAa,GAAG,QAAQ,CACxC,CAAC,IAAY,EAAE,EAAE,CAChB,aAAa,CAAC,YAAY,CAAC,IAAI,EAAE;QAChC,oBAAoB,EAAE,KAAK;QAC3B,kBAAkB,EAAE,IAAI;KACxB,CAAC,CAAC,IAAI,CACR,CAAA;IAED,IAAI,CAAC,EAAE,KAAK,EAAgC;QAC3C,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,KAAK,CAAA;QACjC,MAAM,eAAe,GAAG,KAAK,CAAC,kBAAkB,EAAE,CAAA;QAClD,OAAO,CAAC,CACP,yCAAyC,EACzC;YACC,KAAK,EAAE;gBACN,2HAA2H;gBAC3H,SAAS,EAAE,EAAE,CAAC,qBAAqB,GAAG,IAAI,CAAC,aAAa,CAAC;aACzD;YACD,SAAS,EAAE,CAAC,CAAgB,EAAE,EAAE;gBAC/B,IAAI,YAAY,CAAC,CAAC,CAAC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC;oBACnC,CAAC,CAAC,cAAc,EAAE,CAAA;gBACnB,CAAC;YACF,CAAC;SACD,EACD;YACC,CAAC,CACA,mCAAmC,EACnC;gBACC,KAAK,EAAE;oBACN,eAAe,EAAE,aAAa,KAAK,CAAC,cAAc,EAAE;iBACpD;aACD,EACD,QAAQ,CAAC,KAAK,CACd;YACD,CAAC,CAAC,gDAAgD,EAAE,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;SAC/H,CACD,CAAA;IACF,CAAC;CACD","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { px, size } from \"../../../common/gui/size\"\nimport { Keys } from \"../../../common/api/common/TutanotaConstants\"\nimport { TemplatePopupModel } from \"../model/TemplatePopupModel.js\"\nimport { isKeyPressed } from \"../../../common/misc/KeyManager\"\nimport type { EmailTemplate } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport { TEMPLATE_POPUP_HEIGHT } from \"./TemplateConstants.js\"\nimport { memoized } from \"@tutao/tutanota-utils\"\nimport { htmlSanitizer } from \"../../../common/misc/HtmlSanitizer.js\"\nimport { theme } from \"../../../common/gui/theme.js\"\n\n/**\n * TemplateExpander is the right side that is rendered within the Popup. Consists of Dropdown, Content and Button.\n * The Popup handles whether the Expander should be rendered or not, depending on available width-space.\n */\nexport type TemplateExpanderAttrs = {\n\ttemplate: EmailTemplate\n\tmodel: TemplatePopupModel\n}\n\nexport class TemplateExpander implements Component<TemplateExpanderAttrs> {\n\tprivate readonly sanitizedText = memoized(\n\t\t(text: string) =>\n\t\t\thtmlSanitizer.sanitizeHTML(text, {\n\t\t\t\tblockExternalContent: false,\n\t\t\t\tallowRelativeLinks: true,\n\t\t\t}).html,\n\t)\n\n\tview({ attrs }: Vnode<TemplateExpanderAttrs>): Children {\n\t\tconst { model, template } = attrs\n\t\tconst selectedContent = model.getSelectedContent()\n\t\treturn m(\n\t\t\t\".flex.flex-column.flex-grow.scroll.ml-s\",\n\t\t\t{\n\t\t\t\tstyle: {\n\t\t\t\t\t// maxHeight has to be set, because otherwise the content would overflow outside the flexbox (-44 because of header height)\n\t\t\t\t\tmaxHeight: px(TEMPLATE_POPUP_HEIGHT - size.button_height),\n\t\t\t\t},\n\t\t\t\tonkeydown: (e: KeyboardEvent) => {\n\t\t\t\t\tif (isKeyPressed(e.key, Keys.TAB)) {\n\t\t\t\t\t\te.preventDefault()\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\t[\n\t\t\t\tm(\n\t\t\t\t\t\".text-break.smaller.b.text-center\",\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\"border-bottom\": `1px solid ${theme.content_border}`,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\ttemplate.title,\n\t\t\t\t),\n\t\t\t\tm(\".text-break.flex-grow.pr.overflow-y-visible.pt\", selectedContent ? m.trust(this.sanitizedText(selectedContent.text)) : null),\n\t\t\t],\n\t\t)\n\t}\n}\n"]}