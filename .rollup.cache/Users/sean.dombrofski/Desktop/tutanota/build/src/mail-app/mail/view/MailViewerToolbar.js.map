{"version":3,"file":"MailViewerToolbar.js","sourceRoot":"","sources":["../../../../../src/mail-app/mail/view/MailViewerToolbar.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { MailboxModel } from \"../../../common/mailFunctionality/MailboxModel.js\"\nimport { Mail } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport { IconButton } from \"../../../common/gui/base/IconButton.js\"\nimport { promptAndDeleteMails, showMoveMailsDropdown } from \"./MailGuiUtils.js\"\nimport { noOp, ofClass } from \"@tutao/tutanota-utils\"\nimport { Icons } from \"../../../common/gui/base/icons/Icons.js\"\nimport { MailViewerViewModel } from \"./MailViewerViewModel.js\"\nimport { UserError } from \"../../../common/api/main/UserError.js\"\nimport { showUserError } from \"../../../common/misc/ErrorHandlerImpl.js\"\nimport { createDropdown, DropdownButtonAttrs } from \"../../../common/gui/base/Dropdown.js\"\nimport { editDraft, mailViewerMoreActions } from \"./MailViewerUtils.js\"\nimport { ButtonType } from \"../../../common/gui/base/Button.js\"\nimport { isApp } from \"../../../common/api/common/Env.js\"\nimport { locator } from \"../../../common/api/main/CommonLocator.js\"\nimport { showProgressDialog } from \"../../../common/gui/dialogs/ProgressDialog.js\"\nimport { lang } from \"../../../common/misc/LanguageViewModel.js\"\nimport { DialogHeaderBarAttrs } from \"../../../common/gui/base/DialogHeaderBar.js\"\nimport { Dialog, DialogType } from \"../../../common/gui/base/Dialog.js\"\nimport { ColumnWidth, Table } from \"../../../common/gui/base/Table.js\"\nimport { ExpanderButton, ExpanderPanel } from \"../../../common/gui/base/Expander.js\"\nimport stream from \"mithril/stream\"\nimport { exportMails } from \"../export/Exporter.js\"\nimport { MailModel } from \"../model/MailModel.js\"\nimport { LabelsPopup } from \"./LabelsPopup.js\"\nimport { allInSameMailbox } from \"../model/MailUtils\"\nimport { styles } from \"../../../common/gui/styles\"\n\n/*\n\tnote that mailViewerViewModel has a mailModel, so you do not need to pass both if you pass a mailViewerViewModel\n */\nexport interface MailViewerToolbarAttrs {\n\tmailboxModel: MailboxModel\n\tmailModel: MailModel\n\tmailViewerViewModel?: MailViewerViewModel\n\tmails: Mail[]\n\tselectNone?: () => void\n}\n\n// Note: this is only used for non-mobile views. Please also update MobileMailMultiselectionActionBar or MobileMailActionBar\nexport class MailViewerActions implements Component<MailViewerToolbarAttrs> {\n\tview(vnode: Vnode<MailViewerToolbarAttrs>) {\n\t\treturn m(\".flex.ml-between-s.items-center\", [\n\t\t\tthis.renderSingleMailActions(vnode.attrs),\n\t\t\tvnode.attrs.mailViewerViewModel ? m(\".nav-bar-spacer\") : null,\n\t\t\tthis.renderActions(vnode.attrs),\n\t\t\tthis.renderMoreButton(vnode.attrs.mailViewerViewModel),\n\t\t])\n\t}\n\n\tprivate renderActions(attrs: MailViewerToolbarAttrs): Children {\n\t\tconst mailModel = attrs.mailViewerViewModel ? attrs.mailViewerViewModel.mailModel : attrs.mailModel\n\n\t\tif (!mailModel || !attrs.mails) {\n\t\t\treturn null\n\t\t} else if (attrs.mailViewerViewModel) {\n\t\t\treturn [\n\t\t\t\tthis.renderDeleteButton(mailModel, attrs.mails, attrs.selectNone ?? noOp),\n\t\t\t\tattrs.mailViewerViewModel.canForwardOrMove() ? this.renderMoveButton(attrs.mailboxModel, mailModel, attrs.mails) : null,\n\t\t\t\tattrs.mailModel.canAssignLabels() ? this.renderLabelButton(mailModel, attrs.mails) : null,\n\t\t\t\tattrs.mailViewerViewModel.isDraftMail() ? null : this.renderReadButton(attrs),\n\t\t\t]\n\t\t} else if (attrs.mails.length > 0) {\n\t\t\treturn [\n\t\t\t\tthis.renderDeleteButton(mailModel, attrs.mails, attrs.selectNone ?? noOp),\n\t\t\t\tattrs.mailModel.isMovingMailsAllowed() ? this.renderMoveButton(attrs.mailboxModel, mailModel, attrs.mails) : null,\n\t\t\t\tattrs.mailModel.canAssignLabels() && allInSameMailbox(attrs.mails) ? this.renderLabelButton(mailModel, attrs.mails) : null,\n\t\t\t\tthis.renderReadButton(attrs),\n\t\t\t\tthis.renderExportButton(attrs),\n\t\t\t]\n\t\t}\n\t}\n\n\t/*\n\t * Actions that can only be taken on a single mail (reply, forward, edit, assign)\n\t * Will only return actions if there is a mailViewerViewModel\n\t * */\n\tprivate renderSingleMailActions(attrs: MailViewerToolbarAttrs): Children {\n\t\t// mailViewerViewModel means we are viewing one mail; if there is only the mailModel, it is coming from a MultiViewer\n\t\tif (attrs.mailViewerViewModel) {\n\t\t\tif (attrs.mailViewerViewModel.isAnnouncement()) {\n\t\t\t\treturn []\n\t\t\t} else if (attrs.mailViewerViewModel.isDraftMail()) {\n\t\t\t\treturn [this.renderEditButton(attrs.mailViewerViewModel)]\n\t\t\t} else if (attrs.mailViewerViewModel.canForwardOrMove()) {\n\t\t\t\treturn [this.renderReplyButton(attrs.mailViewerViewModel), this.renderForwardButton(attrs.mailViewerViewModel)]\n\t\t\t} else {\n\t\t\t\treturn [this.renderReplyButton(attrs.mailViewerViewModel)]\n\t\t\t}\n\t\t} else {\n\t\t\treturn []\n\t\t}\n\t}\n\n\tprivate renderDeleteButton(mailModel: MailModel, mails: Mail[], selectNone: () => void): Children {\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"delete_action\",\n\t\t\tclick: () => {\n\t\t\t\tpromptAndDeleteMails(mailModel, mails, selectNone)\n\t\t\t},\n\t\t\ticon: Icons.Trash,\n\t\t})\n\t}\n\n\tprivate renderMoveButton(mailboxModel: MailboxModel, mailModel: MailModel, mails: Mail[]): Children {\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"move_action\",\n\t\t\ticon: Icons.Folder,\n\t\t\tclick: (e, dom) => showMoveMailsDropdown(mailboxModel, mailModel, dom.getBoundingClientRect(), mails),\n\t\t})\n\t}\n\n\tprivate renderLabelButton(mailModel: MailModel, mails: Mail[]): Children {\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"assignLabel_action\",\n\t\t\ticon: Icons.Label,\n\t\t\tclick: (_, dom) => {\n\t\t\t\tconst popup = new LabelsPopup(\n\t\t\t\t\tdom,\n\t\t\t\t\tdom.getBoundingClientRect(),\n\t\t\t\t\tstyles.isDesktopLayout() ? 300 : 200,\n\t\t\t\t\tmailModel.getLabelsForMails(mails),\n\t\t\t\t\tmailModel.getLabelStatesForMails(mails),\n\t\t\t\t\t(addedLabels, removedLabels) => mailModel.applyLabels(mails, addedLabels, removedLabels),\n\t\t\t\t)\n\t\t\t\tpopup.show()\n\t\t\t},\n\t\t})\n\t}\n\n\tprivate renderReadButton({ mailModel, mailViewerViewModel, mails }: MailViewerToolbarAttrs): Children {\n\t\tconst markAction: (unread: boolean) => unknown = mailViewerViewModel\n\t\t\t? (unread) => mailViewerViewModel.setUnread(unread)\n\t\t\t: (unread) => mailModel.markMails(mails, unread)\n\n\t\tconst markReadButton = m(IconButton, {\n\t\t\ttitle: \"markRead_action\",\n\t\t\tclick: () => markAction(false),\n\t\t\ticon: Icons.Eye,\n\t\t})\n\t\tconst markUnreadButton = m(IconButton, {\n\t\t\ttitle: \"markUnread_action\",\n\t\t\tclick: () => markAction(true),\n\t\t\ticon: Icons.NoEye,\n\t\t})\n\n\t\t// mailViewerViewModel means we are viewing one mail; if there is only the mailModel, it is coming from a MultiViewer\n\t\tif (mailViewerViewModel) {\n\t\t\tif (mailViewerViewModel.isUnread()) {\n\t\t\t\treturn markReadButton\n\t\t\t} else {\n\t\t\t\treturn markUnreadButton\n\t\t\t}\n\t\t}\n\n\t\treturn [markReadButton, markUnreadButton]\n\t}\n\n\tprivate renderExportButton(attrs: MailViewerToolbarAttrs) {\n\t\tif (!isApp() && attrs.mailModel.isExportingMailsAllowed()) {\n\t\t\tconst operation = locator.operationProgressTracker.startNewOperation()\n\t\t\tconst ac = new AbortController()\n\t\t\tconst headerBarAttrs: DialogHeaderBarAttrs = {\n\t\t\t\tleft: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: \"cancel_action\",\n\t\t\t\t\t\tclick: () => ac.abort(),\n\t\t\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tmiddle: \"emptyString_msg\",\n\t\t\t}\n\n\t\t\treturn m(IconButton, {\n\t\t\t\ttitle: \"export_action\",\n\t\t\t\tclick: () =>\n\t\t\t\t\tshowProgressDialog(\n\t\t\t\t\t\tlang.getTranslation(\"mailExportProgress_msg\", {\n\t\t\t\t\t\t\t\"{current}\": Math.round((operation.progress() / 100) * attrs.mails.length).toFixed(0),\n\t\t\t\t\t\t\t\"{total}\": attrs.mails.length,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\texportMails(\n\t\t\t\t\t\t\tattrs.mails,\n\t\t\t\t\t\t\tlocator.mailFacade,\n\t\t\t\t\t\t\tlocator.entityClient,\n\t\t\t\t\t\t\tlocator.fileController,\n\t\t\t\t\t\t\tlocator.cryptoFacade,\n\t\t\t\t\t\t\toperation.id,\n\t\t\t\t\t\t\tac.signal,\n\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.then((result) => this.handleExportEmailsResult(result.failed))\n\t\t\t\t\t\t\t.finally(operation.done),\n\t\t\t\t\t\toperation.progress,\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\theaderBarAttrs,\n\t\t\t\t\t),\n\t\t\t\ticon: Icons.Export,\n\t\t\t})\n\t\t}\n\t}\n\n\tprivate handleExportEmailsResult(mailList: Mail[]) {\n\t\tif (mailList && mailList.length > 0) {\n\t\t\tconst lines = mailList.map((mail) => ({\n\t\t\t\tcells: [mail.sender.address, mail.subject],\n\t\t\t\tactionButtonAttrs: null,\n\t\t\t}))\n\n\t\t\tconst expanded = stream<boolean>(false)\n\t\t\tconst dialog = Dialog.createActionDialog({\n\t\t\t\ttitle: \"failedToExport_title\",\n\t\t\t\tchild: () =>\n\t\t\t\t\tm(\"\", [\n\t\t\t\t\t\tm(\".pt-m\", lang.get(\"failedToExport_msg\")),\n\t\t\t\t\t\tm(\".flex-start.items-center\", [\n\t\t\t\t\t\t\tm(ExpanderButton, {\n\t\t\t\t\t\t\t\tlabel: lang.makeTranslation(\n\t\t\t\t\t\t\t\t\t\"hide_show\",\n\t\t\t\t\t\t\t\t\t`${lang.get(expanded() ? \"hide_action\" : \"show_action\")} ${lang.get(\"failedToExport_label\", { \"{0}\": mailList.length })}`,\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\texpanded: expanded(),\n\t\t\t\t\t\t\t\tonExpandedChange: expanded,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t]),\n\t\t\t\t\t\tm(\n\t\t\t\t\t\t\tExpanderPanel,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\texpanded: expanded(),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tm(Table, {\n\t\t\t\t\t\t\t\tcolumnHeading: [\"email_label\", \"subject_label\"],\n\t\t\t\t\t\t\t\tcolumnWidths: [ColumnWidth.Largest, ColumnWidth.Largest],\n\t\t\t\t\t\t\t\tshowActionButtonColumn: false,\n\t\t\t\t\t\t\t\tlines,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t),\n\t\t\t\t\t]),\n\t\t\t\tokAction: () => dialog.close(),\n\t\t\t\tallowCancel: false,\n\t\t\t\tokActionTextId: \"ok_action\",\n\t\t\t\ttype: DialogType.EditMedium,\n\t\t\t})\n\n\t\t\tdialog.show()\n\t\t}\n\t}\n\n\tprivate renderReplyButton(viewModel: MailViewerViewModel) {\n\t\tconst actions: Children = []\n\t\tactions.push(\n\t\t\tm(IconButton, {\n\t\t\t\ttitle: \"reply_action\",\n\t\t\t\tclick: () => viewModel.reply(false),\n\t\t\t\ticon: Icons.Reply,\n\t\t\t}),\n\t\t)\n\n\t\tif (viewModel.canReplyAll()) {\n\t\t\tactions.push(\n\t\t\t\tm(IconButton, {\n\t\t\t\t\ttitle: \"replyAll_action\",\n\t\t\t\t\tclick: () => viewModel.reply(true),\n\t\t\t\t\ticon: Icons.ReplyAll,\n\t\t\t\t}),\n\t\t\t)\n\t\t}\n\t\treturn actions\n\t}\n\n\tprivate renderForwardButton(viewModel: MailViewerViewModel) {\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"forward_action\",\n\t\t\tclick: () => viewModel.forward().catch(ofClass(UserError, showUserError)),\n\t\t\ticon: Icons.Forward,\n\t\t})\n\t}\n\n\tprivate renderMoreButton(viewModel: MailViewerViewModel | undefined): Children {\n\t\tlet actions: DropdownButtonAttrs[] = []\n\n\t\tif (viewModel) {\n\t\t\tactions = mailViewerMoreActions(viewModel, false)\n\t\t}\n\n\t\treturn actions.length > 0\n\t\t\t? m(IconButton, {\n\t\t\t\t\ttitle: \"more_label\",\n\t\t\t\t\ticon: Icons.More,\n\t\t\t\t\tclick: createDropdown({\n\t\t\t\t\t\tlazyButtons: () => actions,\n\t\t\t\t\t\twidth: 300,\n\t\t\t\t\t}),\n\t\t\t  })\n\t\t\t: null\n\t}\n\n\tprivate renderEditButton(viewModel: MailViewerViewModel) {\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"edit_action\",\n\t\t\tclick: () => editDraft(viewModel),\n\t\t\ticon: Icons.Edit,\n\t\t})\n\t}\n}\n"]}