{"version":3,"file":"ContactAggregateEditor.js","sourceRoot":"","sources":["../../../../src/mail-app/contacts/ContactAggregateEditor.ts"],"names":[],"mappings":"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","sourcesContent":["import { Autocapitalize, TextField, TextFieldType } from \"../../common/gui/base/TextField.js\"\nimport { lang, TranslationKey, MaybeTranslation } from \"../../common/misc/LanguageViewModel\"\nimport m, { Children, Component, Vnode, VnodeDOM } from \"mithril\"\nimport { Icons } from \"../../common/gui/base/icons/Icons\"\nimport { animations, height, opacity } from \"../../common/gui/animation/Animations\"\nimport { attachDropdown } from \"../../common/gui/base/Dropdown.js\"\nimport { IconButton } from \"../../common/gui/base/IconButton.js\"\nimport { BootIcons } from \"../../common/gui/base/icons/BootIcons.js\"\nimport { ButtonSize } from \"../../common/gui/base/ButtonSize.js\"\n\nexport type AggregateEditorAttrs<AggregateType> = {\n\tvalue: string\n\tcancelAction: () => unknown\n\tkey: string\n\tanimateCreate?: boolean\n\tanimateCancel?: boolean\n\tallowCancel?: boolean\n\tfieldType: TextFieldType\n\tonUpdate: (newValue: string) => unknown\n\tlabel: MaybeTranslation\n\thelpLabel: MaybeTranslation\n\ttypeLabels: ReadonlyArray<[AggregateType, TranslationKey]>\n\tonTypeSelected: (arg0: AggregateType) => unknown\n\tautocapitalizeTextField?: Autocapitalize\n}\n\nexport class ContactAggregateEditor implements Component<AggregateEditorAttrs<any>> {\n\toncreate(vnode: VnodeDOM<AggregateEditorAttrs<any>>) {\n\t\tconst animate = typeof vnode.attrs.animateCreate === \"boolean\" ? vnode.attrs.animateCreate : true\n\t\tif (animate) this.animate(vnode.dom as HTMLElement, true)\n\t}\n\n\tasync onbeforeremove(vnode: VnodeDOM<AggregateEditorAttrs<any>>): Promise<void> {\n\t\tawait this.animate(vnode.dom as HTMLElement, false)\n\t}\n\n\tview(vnode: Vnode<AggregateEditorAttrs<any>>): Children {\n\t\tconst attrs = vnode.attrs\n\t\treturn m(\".flex.items-center.child-grow\", [\n\t\t\tm(TextField, {\n\t\t\t\tvalue: attrs.value,\n\t\t\t\tlabel: attrs.label,\n\t\t\t\ttype: attrs.fieldType,\n\t\t\t\tautocapitalize: attrs.autocapitalizeTextField,\n\t\t\t\thelpLabel: () => lang.getTranslationText(attrs.helpLabel),\n\t\t\t\tinjectionsRight: () => this._moreButtonFor(attrs),\n\t\t\t\toninput: (value) => attrs.onUpdate(value),\n\t\t\t}),\n\t\t\tthis._cancelButtonFor(attrs),\n\t\t])\n\t}\n\n\t_doesAllowCancel(attrs: AggregateEditorAttrs<any>): boolean {\n\t\treturn typeof attrs.allowCancel === \"boolean\" ? attrs.allowCancel : true\n\t}\n\n\t_cancelButtonFor(attrs: AggregateEditorAttrs<unknown>): Children {\n\t\tif (this._doesAllowCancel(attrs)) {\n\t\t\treturn m(IconButton, {\n\t\t\t\ttitle: \"remove_action\",\n\t\t\t\tclick: () => attrs.cancelAction(),\n\t\t\t\ticon: Icons.Cancel,\n\t\t\t})\n\t\t} else {\n\t\t\t// placeholder so that the text field does not jump around\n\t\t\treturn m(\".icon-button\")\n\t\t}\n\t}\n\n\t_moreButtonFor(attrs: AggregateEditorAttrs<any>): Children {\n\t\treturn m(\n\t\t\tIconButton,\n\t\t\tattachDropdown({\n\t\t\t\tmainButtonAttrs: {\n\t\t\t\t\ttitle: \"more_label\",\n\t\t\t\t\ticon: BootIcons.Expand,\n\t\t\t\t\tsize: ButtonSize.Compact,\n\t\t\t\t},\n\t\t\t\tchildAttrs: () =>\n\t\t\t\t\tattrs.typeLabels.map(([key, value]) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tlabel: value,\n\t\t\t\t\t\t\tclick: () => attrs.onTypeSelected(key),\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t}),\n\t\t)\n\t}\n\n\tanimate(domElement: HTMLElement, fadein: boolean): Promise<any> {\n\t\tlet childHeight = domElement.offsetHeight\n\n\t\tif (fadein) {\n\t\t\tdomElement.style.opacity = \"0\"\n\t\t}\n\n\t\tconst opacityP = animations.add(domElement, fadein ? opacity(0, 1, true) : opacity(1, 0, true))\n\t\tconst heightP = animations.add(domElement, fadein ? height(0, childHeight) : height(childHeight, 0))\n\t\theightP.then(() => {\n\t\t\tdomElement.style.height = \"\"\n\t\t})\n\t\treturn Promise.all([opacityP, heightP])\n\t}\n}\n"]}