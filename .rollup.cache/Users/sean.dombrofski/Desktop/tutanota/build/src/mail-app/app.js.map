{"version":3,"file":"app.js","sourceRoot":"","sources":["../../../src/mail-app/app.ts"],"names":[],"mappings":"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","sourcesContent":["import { client } from \"../common/misc/ClientDetector.js\"\nimport m from \"mithril\"\nimport Mithril, { Children, ClassComponent, Component, RouteDefs, RouteResolver, Vnode, VnodeDOM } from \"mithril\"\nimport { lang, languageCodeToTag, languages } from \"../common/misc/LanguageViewModel.js\"\nimport { root } from \"../RootView.js\"\nimport { assertNotNull, neverNull } from \"@tutao/tutanota-utils\"\nimport { windowFacade } from \"../common/misc/WindowFacade.js\"\nimport { styles } from \"../common/gui/styles.js\"\nimport { deviceConfig } from \"../common/misc/DeviceConfig.js\"\nimport { Logger, replaceNativeLogger } from \"../common/api/common/Logger.js\"\nimport { applicationPaths } from \"./ApplicationPaths.js\"\nimport { ProgrammingError } from \"../common/api/common/error/ProgrammingError.js\"\nimport type { LoginView, LoginViewAttrs } from \"../common/login/LoginView.js\"\nimport type { LoginViewModel } from \"../common/login/LoginViewModel.js\"\nimport { TerminationView, TerminationViewAttrs } from \"../common/termination/TerminationView.js\"\nimport { TerminationViewModel } from \"../common/termination/TerminationViewModel.js\"\nimport { MobileWebauthnAttrs, MobileWebauthnView } from \"../common/login/MobileWebauthnView.js\"\nimport { BrowserWebauthn } from \"../common/misc/2fa/webauthn/BrowserWebauthn.js\"\nimport { CalendarView, CalendarViewAttrs } from \"../calendar-app/calendar/view/CalendarView.js\"\nimport { DrawerMenuAttrs } from \"../common/gui/nav/DrawerMenu.js\"\nimport { MailView, MailViewAttrs, MailViewCache } from \"./mail/view/MailView.js\"\nimport { ContactView, ContactViewAttrs } from \"./contacts/view/ContactView.js\"\nimport { SettingsView } from \"./settings/SettingsView.js\"\nimport { SearchView, SearchViewAttrs } from \"./search/view/SearchView.js\"\nimport { TopLevelAttrs, TopLevelView } from \"../TopLevelView.js\"\nimport { AppHeaderAttrs } from \"../common/gui/Header.js\"\nimport { CalendarViewModel } from \"../calendar-app/calendar/view/CalendarViewModel.js\"\nimport { ExternalLoginView, ExternalLoginViewAttrs, ExternalLoginViewModel } from \"./mail/view/ExternalLoginView.js\"\nimport { LoginController } from \"../common/api/main/LoginController.js\"\nimport type { MailViewModel } from \"./mail/view/MailViewModel.js\"\nimport { SearchViewModel } from \"./search/view/SearchViewModel.js\"\nimport { ContactViewModel } from \"./contacts/view/ContactViewModel.js\"\nimport { ContactListViewModel } from \"./contacts/view/ContactListViewModel.js\"\nimport { assertMainOrNodeBoot, bootFinished, isApp, isDesktop, isIOSApp, isOfflineStorageAvailable } from \"../common/api/common/Env.js\"\nimport { SettingsViewAttrs } from \"../common/settings/Interfaces.js\"\nimport { disableErrorHandlingDuringLogout, handleUncaughtError } from \"../common/misc/ErrorHandler.js\"\nimport { AppType } from \"../common/misc/ClientConstants.js\"\nimport { ContactModel } from \"../common/contactsFunctionality/ContactModel.js\"\nimport { CacheMode } from \"../common/api/worker/rest/EntityRestClient\"\nimport { SessionType } from \"../common/api/common/SessionType.js\"\n\nassertMainOrNodeBoot()\nbootFinished()\n\nconst urlQueryParams = m.parseQueryString(location.search)\n\nassignEnvPlatformId(urlQueryParams)\nreplaceNativeLogger(window, new Logger())\n\nlet currentView: Component<unknown> | null = null\nwindow.tutao = {\n\tclient,\n\tm,\n\tlang,\n\troot,\n\tcurrentView,\n\tlocator: null,\n}\n\nclient.init(navigator.userAgent, navigator.platform, AppType.Mail)\n\nif (!client.isSupported()) {\n\tthrow new Error(\"Unsupported\")\n}\n\n// Setup exception handling after checking for client support, because in android the Error is caught by the unhandled rejection handler\n// and then the \"Update WebView\" message will never be show\n// we still want to do this ASAP so we can handle other errors\nsetupExceptionHandling()\n\n// If the webapp is served under some folder e.g. /build we want to consider this our root\nconst urlPrefixes = extractPathPrefixes()\n// Write it here for the WorkerClient so that it can load relative worker easily. Should do it here so that it doesn't break after HMR.\nwindow.tutao.appState = urlPrefixes\n\nconst startRoute = getStartUrl(urlQueryParams)\nhistory.replaceState(null, \"\", urlPrefixes.prefix + startRoute)\n\nregisterForMailto()\n\nimport(\"./translations/en.js\")\n\t.then((en) => lang.init(en.default))\n\t.then(async () => {\n\t\tawait import(\"../common/gui/main-styles.js\")\n\n\t\t// do this after lang initialized\n\t\tconst { initCommonLocator } = await import(\"../common/api/main/CommonLocator.js\")\n\t\tconst { mailLocator } = await import(\"./mailLocator.js\")\n\t\tawait mailLocator.init()\n\n\t\tinitCommonLocator(mailLocator)\n\n\t\tconst { setupNavShortcuts } = await import(\"../common/misc/NavShortcuts.js\")\n\t\tsetupNavShortcuts()\n\n\t\tconst { BottomNav } = await import(\"./gui/BottomNav.js\")\n\n\t\t// this needs to stay after client.init\n\t\twindowFacade.init(mailLocator.logins, mailLocator.connectivityModel, (visible) => {\n\t\t\tmailLocator.indexerFacade?.onVisibilityChanged(!document.hidden)\n\t\t})\n\t\tif (isDesktop()) {\n\t\t\timport(\"../common/native/main/UpdatePrompt.js\").then(({ registerForUpdates }) => registerForUpdates(mailLocator.desktopSettingsFacade))\n\t\t}\n\n\t\tconst userLanguage = deviceConfig.getLanguage() && languages.find((l) => l.code === deviceConfig.getLanguage())\n\n\t\tif (userLanguage) {\n\t\t\tconst language = {\n\t\t\t\tcode: userLanguage.code,\n\t\t\t\tlanguageTag: languageCodeToTag(userLanguage.code),\n\t\t\t}\n\t\t\tlang.setLanguage(language).catch((e) => {\n\t\t\t\tconsole.error(\"Failed to fetch translation: \" + userLanguage.code, e)\n\t\t\t})\n\n\t\t\tif (isDesktop()) {\n\t\t\t\tmailLocator.desktopSettingsFacade.changeLanguage(language.code, language.languageTag)\n\t\t\t}\n\t\t}\n\n\t\tmailLocator.logins.addPostLoginAction(() => mailLocator.postLoginActions())\n\t\tmailLocator.logins.addPostLoginAction(async () => {\n\t\t\treturn {\n\t\t\t\tasync onPartialLoginSuccess() {\n\t\t\t\t\tif (isApp()) {\n\t\t\t\t\t\tmailLocator.fileApp.clearFileData().catch((e) => console.log(\"Failed to clean file data\", e))\n\t\t\t\t\t\tconst syncManager = mailLocator.nativeContactsSyncManager()\n\t\t\t\t\t\tif (syncManager.isEnabled() && isIOSApp()) {\n\t\t\t\t\t\t\tconst canSync = await syncManager.canSync()\n\t\t\t\t\t\t\tif (!canSync) {\n\t\t\t\t\t\t\t\tawait syncManager.disableSync()\n\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsyncManager.syncContacts()\n\t\t\t\t\t}\n\t\t\t\t\tawait mailLocator.mailboxModel.init()\n\t\t\t\t\tawait mailLocator.mailModel.init()\n\t\t\t\t},\n\t\t\t\tasync onFullLoginSuccess() {\n\t\t\t\t\t// We might have outdated Customer features, force reload the customer to make sure the customizations are up-to-date\n\t\t\t\t\tif (isOfflineStorageAvailable()) {\n\t\t\t\t\t\tawait mailLocator.logins.loadCustomizations(CacheMode.WriteOnly)\n\t\t\t\t\t\tm.redraw()\n\t\t\t\t\t}\n\n\t\t\t\t\tif (mailLocator.mailModel.canManageLabels() && !mailLocator.logins.getUserController().props.defaultLabelCreated) {\n\t\t\t\t\t\tconst { TutanotaPropertiesTypeRef } = await import(\"../common/api/entities/tutanota/TypeRefs\")\n\t\t\t\t\t\tconst reloadTutanotaProperties = await mailLocator.entityClient.loadRoot(\n\t\t\t\t\t\t\tTutanotaPropertiesTypeRef,\n\t\t\t\t\t\t\tmailLocator.logins.getUserController().user.userGroup.group,\n\t\t\t\t\t\t\t{ cacheMode: CacheMode.WriteOnly },\n\t\t\t\t\t\t)\n\n\t\t\t\t\t\tif (!reloadTutanotaProperties.defaultLabelCreated) {\n\t\t\t\t\t\t\tconst mailboxDetail = await mailLocator.mailboxModel.getMailboxDetails()\n\n\t\t\t\t\t\t\tmailLocator.mailFacade\n\t\t\t\t\t\t\t\t.createLabel(assertNotNull(mailboxDetail[0].mailbox._ownerGroup), {\n\t\t\t\t\t\t\t\t\tname: lang.get(\"importantLabel_label\"),\n\t\t\t\t\t\t\t\t\tcolor: \"#FEDC59\",\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\tmailLocator.logins.getUserController().props.defaultLabelCreated = true\n\t\t\t\t\t\t\t\t\tmailLocator.entityClient.update(mailLocator.logins.getUserController().props)\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t}\n\t\t})\n\n\t\tif (isOfflineStorageAvailable()) {\n\t\t\tconst { CachePostLoginAction } = await import(\"../common/offline/CachePostLoginAction.js\")\n\t\t\tmailLocator.logins.addPostLoginAction(\n\t\t\t\tasync () =>\n\t\t\t\t\tnew CachePostLoginAction(\n\t\t\t\t\t\tawait mailLocator.calendarModel(),\n\t\t\t\t\t\tmailLocator.entityClient,\n\t\t\t\t\t\tmailLocator.progressTracker,\n\t\t\t\t\t\tmailLocator.cacheStorage,\n\t\t\t\t\t\tmailLocator.logins,\n\t\t\t\t\t),\n\t\t\t)\n\t\t}\n\n\t\tif (isDesktop()) {\n\t\t\tmailLocator.logins.addPostLoginAction(async () => {\n\t\t\t\treturn {\n\t\t\t\t\tonPartialLoginSuccess: async () => {},\n\t\t\t\t\tonFullLoginSuccess: async (event) => {\n\t\t\t\t\t\t// not a temporary aka signup login\n\t\t\t\t\t\tif (event.sessionType === SessionType.Persistent) {\n\t\t\t\t\t\t\tconst controller = await mailLocator.mailExportController()\n\t\t\t\t\t\t\tcontroller.resumeIfNeeded()\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\tstyles.init(mailLocator.themeController)\n\n\t\tconst contactViewResolver = makeViewResolver<\n\t\t\tContactViewAttrs,\n\t\t\tContactView,\n\t\t\t{\n\t\t\t\tdrawerAttrsFactory: () => DrawerMenuAttrs\n\t\t\t\theader: AppHeaderAttrs\n\t\t\t\tcontactViewModel: ContactViewModel\n\t\t\t\tcontactListViewModel: ContactListViewModel\n\t\t\t}\n\t\t>(\n\t\t\t{\n\t\t\t\tprepareRoute: async () => {\n\t\t\t\t\tconst { ContactView } = await import(\"./contacts/view/ContactView.js\")\n\t\t\t\t\tconst drawerAttrsFactory = await mailLocator.drawerAttrsFactory()\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcomponent: ContactView,\n\t\t\t\t\t\tcache: {\n\t\t\t\t\t\t\tdrawerAttrsFactory,\n\t\t\t\t\t\t\theader: await mailLocator.appHeaderAttrs(),\n\t\t\t\t\t\t\tcontactViewModel: await mailLocator.contactViewModel(),\n\t\t\t\t\t\t\tcontactListViewModel: await mailLocator.contactListViewModel(),\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tprepareAttrs: (cache) => ({\n\t\t\t\t\tdrawerAttrs: cache.drawerAttrsFactory(),\n\t\t\t\t\theader: cache.header,\n\t\t\t\t\tcontactViewModel: cache.contactViewModel,\n\t\t\t\t\tcontactListViewModel: cache.contactListViewModel,\n\t\t\t\t}),\n\t\t\t},\n\t\t\tmailLocator.logins,\n\t\t)\n\n\t\tconst paths = applicationPaths({\n\t\t\tlogin: makeViewResolver<LoginViewAttrs, LoginView, { makeViewModel: () => LoginViewModel }>(\n\t\t\t\t{\n\t\t\t\t\tprepareRoute: async () => {\n\t\t\t\t\t\tconst migrator = await mailLocator.credentialFormatMigrator()\n\t\t\t\t\t\tawait migrator.migrate()\n\n\t\t\t\t\t\tconst { LoginView } = await import(\"../common/login/LoginView.js\")\n\t\t\t\t\t\tconst makeViewModel = await mailLocator.loginViewModelFactory()\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tcomponent: LoginView,\n\t\t\t\t\t\t\tcache: {\n\t\t\t\t\t\t\t\tmakeViewModel,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tprepareAttrs: ({ makeViewModel }) => ({ targetPath: \"/mail\", makeViewModel }),\n\t\t\t\t\trequireLogin: false,\n\t\t\t\t},\n\t\t\t\tmailLocator.logins,\n\t\t\t),\n\t\t\ttermination: makeViewResolver<\n\t\t\t\tTerminationViewAttrs,\n\t\t\t\tTerminationView,\n\t\t\t\t{\n\t\t\t\t\tmakeViewModel: () => TerminationViewModel\n\t\t\t\t\theader: AppHeaderAttrs\n\t\t\t\t}\n\t\t\t>(\n\t\t\t\t{\n\t\t\t\t\tprepareRoute: async () => {\n\t\t\t\t\t\tconst { TerminationViewModel } = await import(\"../common/termination/TerminationViewModel.js\")\n\t\t\t\t\t\tconst { TerminationView } = await import(\"../common/termination/TerminationView.js\")\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tcomponent: TerminationView,\n\t\t\t\t\t\t\tcache: {\n\t\t\t\t\t\t\t\tmakeViewModel: () =>\n\t\t\t\t\t\t\t\t\tnew TerminationViewModel(\n\t\t\t\t\t\t\t\t\t\tmailLocator.logins,\n\t\t\t\t\t\t\t\t\t\tmailLocator.secondFactorHandler,\n\t\t\t\t\t\t\t\t\t\tmailLocator.serviceExecutor,\n\t\t\t\t\t\t\t\t\t\tmailLocator.entityClient,\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\theader: await mailLocator.appHeaderAttrs(),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tprepareAttrs: ({ makeViewModel, header }) => ({ makeViewModel, header }),\n\t\t\t\t\trequireLogin: false,\n\t\t\t\t},\n\t\t\t\tmailLocator.logins,\n\t\t\t),\n\t\t\tcontact: contactViewResolver,\n\t\t\tcontactList: contactViewResolver,\n\t\t\texternalLogin: makeViewResolver<\n\t\t\t\tExternalLoginViewAttrs,\n\t\t\t\tExternalLoginView,\n\t\t\t\t{\n\t\t\t\t\theader: AppHeaderAttrs\n\t\t\t\t\tmakeViewModel: () => ExternalLoginViewModel\n\t\t\t\t}\n\t\t\t>(\n\t\t\t\t{\n\t\t\t\t\tprepareRoute: async () => {\n\t\t\t\t\t\tconst { ExternalLoginView } = await import(\"./mail/view/ExternalLoginView.js\")\n\t\t\t\t\t\tconst makeViewModel = await mailLocator.externalLoginViewModelFactory()\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tcomponent: ExternalLoginView,\n\t\t\t\t\t\t\tcache: { header: await mailLocator.appHeaderAttrs(), makeViewModel },\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tprepareAttrs: ({ header, makeViewModel }) => ({ header, viewModelFactory: makeViewModel }),\n\t\t\t\t\trequireLogin: false,\n\t\t\t\t},\n\t\t\t\tmailLocator.logins,\n\t\t\t),\n\t\t\tmail: makeViewResolver<\n\t\t\t\tMailViewAttrs,\n\t\t\t\tMailView,\n\t\t\t\t{\n\t\t\t\t\tdrawerAttrsFactory: () => DrawerMenuAttrs\n\t\t\t\t\tcache: MailViewCache\n\t\t\t\t\theader: AppHeaderAttrs\n\t\t\t\t\tmailViewModel: MailViewModel\n\t\t\t\t}\n\t\t\t>(\n\t\t\t\t{\n\t\t\t\t\tprepareRoute: async (previousCache) => {\n\t\t\t\t\t\tconst { MailView } = await import(\"./mail/view/MailView.js\")\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tcomponent: MailView,\n\t\t\t\t\t\t\tcache: previousCache ?? {\n\t\t\t\t\t\t\t\tdrawerAttrsFactory: await mailLocator.drawerAttrsFactory(),\n\t\t\t\t\t\t\t\tcache: {\n\t\t\t\t\t\t\t\t\tmailList: null,\n\t\t\t\t\t\t\t\t\tselectedFolder: null,\n\t\t\t\t\t\t\t\t\tconversationViewModel: null,\n\t\t\t\t\t\t\t\t\tconversationViewPreference: null,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\theader: await mailLocator.appHeaderAttrs(),\n\t\t\t\t\t\t\t\tmailViewModel: await mailLocator.mailViewModel(),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tprepareAttrs: ({ drawerAttrsFactory, cache, header, mailViewModel }) => ({\n\t\t\t\t\t\tdrawerAttrs: drawerAttrsFactory(),\n\t\t\t\t\t\tcache,\n\t\t\t\t\t\theader,\n\t\t\t\t\t\tdesktopSystemFacade: mailLocator.desktopSystemFacade,\n\t\t\t\t\t\tmailViewModel,\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\tmailLocator.logins,\n\t\t\t),\n\t\t\tsettings: makeViewResolver<\n\t\t\t\tSettingsViewAttrs,\n\t\t\t\tSettingsView,\n\t\t\t\t{\n\t\t\t\t\tdrawerAttrsFactory: () => DrawerMenuAttrs\n\t\t\t\t\theader: AppHeaderAttrs\n\t\t\t\t}\n\t\t\t>(\n\t\t\t\t{\n\t\t\t\t\tprepareRoute: async () => {\n\t\t\t\t\t\tconst { SettingsView } = await import(\"./settings/SettingsView.js\")\n\t\t\t\t\t\tconst drawerAttrsFactory = await mailLocator.drawerAttrsFactory()\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tcomponent: SettingsView,\n\t\t\t\t\t\t\tcache: {\n\t\t\t\t\t\t\t\tdrawerAttrsFactory,\n\t\t\t\t\t\t\t\theader: await mailLocator.appHeaderAttrs(),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tprepareAttrs: (cache) => ({\n\t\t\t\t\t\tdrawerAttrs: cache.drawerAttrsFactory(),\n\t\t\t\t\t\theader: cache.header,\n\t\t\t\t\t\tlogins: mailLocator.logins,\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\tmailLocator.logins,\n\t\t\t),\n\t\t\tsearch: makeViewResolver<\n\t\t\t\tSearchViewAttrs,\n\t\t\t\tSearchView,\n\t\t\t\t{\n\t\t\t\t\tdrawerAttrsFactory: () => DrawerMenuAttrs\n\t\t\t\t\theader: AppHeaderAttrs\n\t\t\t\t\tsearchViewModelFactory: () => SearchViewModel\n\t\t\t\t\tcontactModel: ContactModel\n\t\t\t\t}\n\t\t\t>(\n\t\t\t\t{\n\t\t\t\t\tprepareRoute: async () => {\n\t\t\t\t\t\tconst { SearchView } = await import(\"./search/view/SearchView.js\")\n\t\t\t\t\t\tconst drawerAttrsFactory = await mailLocator.drawerAttrsFactory()\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tcomponent: SearchView,\n\t\t\t\t\t\t\tcache: {\n\t\t\t\t\t\t\t\tdrawerAttrsFactory,\n\t\t\t\t\t\t\t\theader: await mailLocator.appHeaderAttrs(),\n\t\t\t\t\t\t\t\tsearchViewModelFactory: await mailLocator.searchViewModelFactory(),\n\t\t\t\t\t\t\t\tcontactModel: mailLocator.contactModel,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tprepareAttrs: (cache) => ({\n\t\t\t\t\t\tdrawerAttrs: cache.drawerAttrsFactory(),\n\t\t\t\t\t\theader: cache.header,\n\t\t\t\t\t\tmakeViewModel: cache.searchViewModelFactory,\n\t\t\t\t\t\tcontactModel: cache.contactModel,\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\tmailLocator.logins,\n\t\t\t),\n\t\t\tcalendar: makeViewResolver<\n\t\t\t\tCalendarViewAttrs,\n\t\t\t\tCalendarView,\n\t\t\t\t{\n\t\t\t\t\tdrawerAttrsFactory: () => DrawerMenuAttrs\n\t\t\t\t\theader: AppHeaderAttrs\n\t\t\t\t\tcalendarViewModel: CalendarViewModel\n\t\t\t\t\tbottomNav: () => Children\n\t\t\t\t\tlazySearchBar: () => Children\n\t\t\t\t}\n\t\t\t>(\n\t\t\t\t{\n\t\t\t\t\tprepareRoute: async (cache) => {\n\t\t\t\t\t\tconst { CalendarView } = await import(\"../calendar-app/calendar/view/CalendarView.js\")\n\t\t\t\t\t\tconst { lazySearchBar } = await import(\"./LazySearchBar.js\")\n\t\t\t\t\t\tconst drawerAttrsFactory = await mailLocator.drawerAttrsFactory()\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tcomponent: CalendarView,\n\t\t\t\t\t\t\tcache: cache ?? {\n\t\t\t\t\t\t\t\tdrawerAttrsFactory,\n\t\t\t\t\t\t\t\theader: await mailLocator.appHeaderAttrs(),\n\t\t\t\t\t\t\t\tcalendarViewModel: await mailLocator.calendarViewModel(),\n\t\t\t\t\t\t\t\tbottomNav: () => m(BottomNav),\n\t\t\t\t\t\t\t\tlazySearchBar: () =>\n\t\t\t\t\t\t\t\t\tm(lazySearchBar, {\n\t\t\t\t\t\t\t\t\t\tplaceholder: lang.get(\"searchCalendar_placeholder\"),\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tprepareAttrs: ({ header, calendarViewModel, drawerAttrsFactory, bottomNav, lazySearchBar }) => ({\n\t\t\t\t\t\tdrawerAttrs: drawerAttrsFactory(),\n\t\t\t\t\t\theader,\n\t\t\t\t\t\tcalendarViewModel,\n\t\t\t\t\t\tbottomNav,\n\t\t\t\t\t\tlazySearchBar,\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\tmailLocator.logins,\n\t\t\t),\n\n\t\t\t/**\n\t\t\t * The following resolvers are programmed by hand instead of using createViewResolver() in order to be able to properly redirect\n\t\t\t * to the login page without having to deal with a ton of conditional logic in the LoginViewModel and to avoid some of the default\n\t\t\t * behaviour of resolvers created with createViewResolver(), e.g. caching.\n\t\t\t */\n\t\t\tsignup: {\n\t\t\t\tasync onmatch() {\n\t\t\t\t\tconst { showSignupDialog } = await import(\"../common/misc/LoginUtils.js\")\n\n\t\t\t\t\t// We have to manually parse it because mithril does not put hash into args of onmatch\n\t\t\t\t\tconst urlParams = m.parseQueryString(location.search.substring(1) + \"&\" + location.hash.substring(1))\n\t\t\t\t\tshowSignupDialog(urlParams)\n\n\t\t\t\t\t// Change the href of the canonical link element to make the /signup path indexed.\n\t\t\t\t\t// Since this is just for search crawlers, we do not have to change it again later.\n\t\t\t\t\t// We know at least Google crawler executes js to render the application.\n\t\t\t\t\tconst canonicalEl: HTMLLinkElement | null = document.querySelector(\"link[rel=canonical]\")\n\t\t\t\t\tif (canonicalEl) {\n\t\t\t\t\t\tcanonicalEl.href = \"https://app.tuta.com/signup\"\n\t\t\t\t\t}\n\n\t\t\t\t\t// when the user presses the browser back button, we would get a /login route without arguments\n\t\t\t\t\t// in the popstate event, logging us out and reloading the page before we have a chance to (asynchronously) ask for confirmation\n\t\t\t\t\t// onmatch of the login view is called after the popstate handler, but before any asynchronous operations went ahead.\n\t\t\t\t\t// duplicating the history entry allows us to keep the arguments for a single back button press and run our own code to handle it\n\t\t\t\t\tm.route.set(\"/login\", {\n\t\t\t\t\t\tnoAutoLogin: true,\n\t\t\t\t\t\tkeepSession: true,\n\t\t\t\t\t})\n\t\t\t\t\tm.route.set(\"/login\", {\n\t\t\t\t\t\tnoAutoLogin: true,\n\t\t\t\t\t\tkeepSession: true,\n\t\t\t\t\t})\n\t\t\t\t\treturn null\n\t\t\t\t},\n\t\t\t},\n\t\t\tgiftcard: {\n\t\t\t\tasync onmatch() {\n\t\t\t\t\tconst { showGiftCardDialog } = await import(\"../common/misc/LoginUtils.js\")\n\t\t\t\t\tshowGiftCardDialog(location.hash)\n\t\t\t\t\tm.route.set(\"/login\", {\n\t\t\t\t\t\tnoAutoLogin: true,\n\t\t\t\t\t\tkeepSession: true,\n\t\t\t\t\t})\n\t\t\t\t\treturn null\n\t\t\t\t},\n\t\t\t},\n\t\t\trecover: {\n\t\t\t\tasync onmatch(args: any) {\n\t\t\t\t\tconst { showRecoverDialog } = await import(\"../common/misc/LoginUtils.js\")\n\t\t\t\t\tconst resetAction = args.resetAction === \"password\" || args.resetAction === \"secondFactor\" ? args.resetAction : \"password\"\n\t\t\t\t\tconst mailAddress = typeof args.mailAddress === \"string\" ? args.mailAddress : \"\"\n\t\t\t\t\tshowRecoverDialog(mailAddress, resetAction)\n\t\t\t\t\tm.route.set(\"/login\", {\n\t\t\t\t\t\tnoAutoLogin: true,\n\t\t\t\t\t})\n\t\t\t\t\treturn null\n\t\t\t\t},\n\t\t\t},\n\t\t\twebauthn: makeOldViewResolver(\n\t\t\t\tasync () => {\n\t\t\t\t\tconst { BrowserWebauthn } = await import(\"../common/misc/2fa/webauthn/BrowserWebauthn.js\")\n\t\t\t\t\tconst { NativeWebauthnView } = await import(\"../common/login/NativeWebauthnView.js\")\n\t\t\t\t\tconst { WebauthnNativeBridge } = await import(\"../common/native/main/WebauthnNativeBridge.js\")\n\t\t\t\t\t// getCurrentDomainConfig() takes env.staticUrl into account but we actually don't care about it in this case.\n\t\t\t\t\t// Scenario when it can differ: local desktop client which opens webauthn window and that window is also built with the static URL because\n\t\t\t\t\t// it is the same client build.\n\t\t\t\t\tconst domainConfig = mailLocator.domainConfigProvider().getDomainConfigForHostname(location.hostname, location.protocol, location.port)\n\t\t\t\t\tconst creds = navigator.credentials\n\t\t\t\t\treturn new NativeWebauthnView(new BrowserWebauthn(creds, domainConfig), new WebauthnNativeBridge())\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\trequireLogin: false,\n\t\t\t\t\tcacheView: false,\n\t\t\t\t},\n\t\t\t\tmailLocator.logins,\n\t\t\t),\n\t\t\twebauthnmobile: makeViewResolver<\n\t\t\t\tMobileWebauthnAttrs,\n\t\t\t\tMobileWebauthnView,\n\t\t\t\t{\n\t\t\t\t\tbrowserWebauthn: BrowserWebauthn\n\t\t\t\t}\n\t\t\t>(\n\t\t\t\t{\n\t\t\t\t\tprepareRoute: async () => {\n\t\t\t\t\t\tconst { MobileWebauthnView } = await import(\"../common/login/MobileWebauthnView.js\")\n\t\t\t\t\t\tconst { BrowserWebauthn } = await import(\"../common/misc/2fa/webauthn/BrowserWebauthn.js\")\n\t\t\t\t\t\t// see /webauthn view resolver for the explanation\n\t\t\t\t\t\tconst domainConfig = mailLocator.domainConfigProvider().getDomainConfigForHostname(location.hostname, location.protocol, location.port)\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tcomponent: MobileWebauthnView,\n\t\t\t\t\t\t\tcache: {\n\t\t\t\t\t\t\t\tbrowserWebauthn: new BrowserWebauthn(navigator.credentials, domainConfig),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tprepareAttrs: (cache) => cache,\n\t\t\t\t\trequireLogin: false,\n\t\t\t\t},\n\t\t\t\tmailLocator.logins,\n\t\t\t),\n\t\t})\n\n\t\t// In some cases our prefix can have non-ascii characters, depending on the path the webapp is served from\n\t\t// see https://github.com/MithrilJS/mithril.js/issues/2659\n\t\tm.route.prefix = neverNull(urlPrefixes.prefix).replace(/(?:%[a-f89][a-f0-9])+/gim, decodeURIComponent)\n\n\t\t// keep in sync with RewriteAppResourceUrlHandler.java\n\t\tconst resolvers: RouteDefs = {\n\t\t\t\"/\": {\n\t\t\t\tonmatch: (args, requestedPath) => forceLogin(args, requestedPath),\n\t\t\t},\n\t\t}\n\n\t\tfor (let path in paths) {\n\t\t\tresolvers[path] = paths[path]\n\t\t}\n\n\t\t// append catch all at the end because mithril will stop at the first match\n\t\tresolvers[\"/:path...\"] = {\n\t\t\tonmatch: async () => {\n\t\t\t\tconst { NotFoundPage } = await import(\"../common/gui/base/NotFoundPage.js\")\n\t\t\t\treturn {\n\t\t\t\t\tview: () => m(root, m(NotFoundPage)),\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\n\t\t// keep in sync with RewriteAppResourceUrlHandler.java\n\t\tm.route(document.body, startRoute, resolvers)\n\n\t\t// We need to initialize native once we start the mithril routing, specifically for the case of mailto handling in android\n\t\t// If native starts telling the web side to navigate too early, mithril won't be ready and the requests will be lost\n\t\tif (isApp() || isDesktop()) {\n\t\t\tawait mailLocator.native.init()\n\t\t}\n\t\tif (isDesktop()) {\n\t\t\tconst { exposeNativeInterface } = await import(\"../common/api/common/ExposeNativeInterface.js\")\n\t\t\tmailLocator.logins.addPostLoginAction(async () => exposeNativeInterface(mailLocator.native).postLoginActions)\n\t\t}\n\t\t// after we set up prefixWithoutFile\n\t\tconst domainConfig = mailLocator.domainConfigProvider().getCurrentDomainConfig()\n\t\tconst serviceworker = await import(\"../common/serviceworker/ServiceWorkerClient.js\")\n\t\tserviceworker.init(domainConfig)\n\n\t\tprintJobsMessage(domainConfig)\n\t})\n\nfunction forceLogin(args: Record<string, Dict>, requestedPath: string) {\n\tif (requestedPath.indexOf(\"#mail\") !== -1) {\n\t\tm.route.set(`/ext${location.hash}`)\n\t} else if (requestedPath.startsWith(\"/#\")) {\n\t\t// we do not allow any other hashes except \"#mail\". this prevents login loops.\n\t\tm.route.set(\"/login\")\n\t} else {\n\t\tlet pathWithoutParameter = requestedPath.indexOf(\"?\") > 0 ? requestedPath.substring(0, requestedPath.indexOf(\"?\")) : requestedPath\n\n\t\tif (pathWithoutParameter.trim() === \"/\") {\n\t\t\tlet newQueryString = m.buildQueryString(args)\n\t\t\tm.route.set(`/login` + (newQueryString.length > 0 ? \"?\" + newQueryString : \"\"))\n\t\t} else {\n\t\t\tm.route.set(`/login?requestedPath=${encodeURIComponent(requestedPath)}`)\n\t\t}\n\t}\n}\n\nfunction setupExceptionHandling() {\n\twindow.addEventListener(\"error\", function (evt) {\n\t\t/**\n\t\t * evt.error is not always set, e.g. not for \"content.js:1963 Uncaught DOMException: Failed to read\n\t\t * the 'selectionStart' property from 'HTMLInputElement': The input element's type ('email')\n\t\t * does not support selection.\"\n\t\t *\n\t\t * checking for defaultPrevented is necessary to prevent devTools eval errors to be thrown in here until\n\t\t * https://chromium-review.googlesource.com/c/v8/v8/+/3660253\n\t\t * is in the chromium version used by our electron client.\n\t\t * see https://stackoverflow.com/questions/72396527/evalerror-possible-side-effect-in-debug-evaluate-in-google-chrome\n\t\t * */\n\t\tif (evt.error && !evt.defaultPrevented) {\n\t\t\thandleUncaughtError(evt.error)\n\t\t\tevt.preventDefault()\n\t\t}\n\t})\n\t// Handle unhandled native JS Promise rejections\n\twindow.addEventListener(\"unhandledrejection\", function (evt) {\n\t\thandleUncaughtError(evt.reason)\n\t\tevt.preventDefault()\n\t})\n}\n\n/**\n * Wrap top-level component with necessary logic.\n * Note: I can't make type inference work with attributes and components because of how broken mithril typedefs are so they are \"never\" by default and you\n * have to specify generic types manually.\n * @template FullAttrs type of the attributes that the component takes\n * @template ComponentType type of the component\n * @template RouteCache info that is prepared async on route change and can be used later to create attributes on every render. Is also persisted between\n * the route changes.\n * @param param\n * @param param.prepareRoute called once per route change. Use it for everything async that should happen before the route change. The result is preserved for\n * as long as RouteResolver lives if you need to persist things between routes. It receives the route cache from the previous call if there was one.\n * @param param.prepareAttrs called once per redraw. The result of it will be added to TopLevelAttrs to make full attributes.\n * @param param.requireLogin enforce login policy to either redirect to the login page or reload\n * @param logins logincontroller to ask about login state\n */\nfunction makeViewResolver<FullAttrs extends TopLevelAttrs = never, ComponentType extends TopLevelView<FullAttrs> = never, RouteCache = undefined>(\n\t{\n\t\tprepareRoute,\n\t\tprepareAttrs,\n\t\trequireLogin,\n\t}: {\n\t\tprepareRoute: (cache: RouteCache | null) => Promise<{ component: Class<ComponentType>; cache: RouteCache }>\n\t\tprepareAttrs: (cache: RouteCache) => Omit<FullAttrs, keyof TopLevelAttrs>\n\t\trequireLogin?: boolean\n\t},\n\tlogins: LoginController,\n): RouteResolver {\n\trequireLogin = requireLogin ?? true\n\tlet cache: RouteCache | null\n\n\t// a bit of context for why we do things the way we do. Constraints:\n\t//  - view must be imported async in onmatch\n\t//  - view shall not be created manually, we do not want to hold on to the instance\n\t//  - we want to pass additional parameters to the view\n\t//  - view should not be created twice and neither its dependencies\n\t//  - we either need to call updateUrl or pass requestedPath and args as attributes\n\treturn {\n\t\t// onmatch() is called for every URL change\n\t\tasync onmatch(args: Record<string, Dict>, requestedPath: string): Promise<Class<ComponentType> | null> {\n\t\t\t// enforce valid login state first.\n\t\t\t// we have views with requireLogin: true and views with requireLogin: false, each of which enforce being logged in or being logged out respectively.\n\t\t\t// in the logout case (where requireLogin: false) this will force a reload.\n\t\t\t// the login view is special in that it has requirelogin: false, but can be logged in after account creation during signup.\n\t\t\t// to handle back button presses where the user decides to stay on the page after all (we show a confirmation)\n\t\t\t// we need to prevent the logout/reload. this is the purpose of the keepSession argument.\n\t\t\t// the signup wizard that sets it handles the session itself.\n\t\t\tif (requireLogin && !logins.isUserLoggedIn()) {\n\t\t\t\tforceLogin(args, requestedPath)\n\t\t\t\treturn null\n\t\t\t} else if (!requireLogin && logins.isUserLoggedIn() && !args.keepSession) {\n\t\t\t\tawait disableErrorHandlingDuringLogout()\n\t\t\t\tawait logins.logout(false)\n\t\t\t\twindowFacade.reload(args)\n\t\t\t\treturn null\n\t\t\t} else {\n\t\t\t\tconst prepared = await prepareRoute(cache)\n\t\t\t\tcache = prepared.cache\n\t\t\t\treturn prepared.component\n\t\t\t}\n\t\t},\n\t\t// render() is called on every render\n\t\trender(vnode: Vnode<ComponentType>): Children {\n\t\t\tconst args = m.route.param()\n\t\t\tconst requestedPath = m.route.get()\n\t\t\t// result of onmatch() is passed into m() by mthril and then given to us here\n\t\t\t// It is not what we want as we want to pass few things to it but it's harmless because\n\t\t\t// it just creates a vnode but doesn't render it.\n\t\t\t// What we do is grab the class from that vnode. We could have done it differently but this\n\t\t\t// way we don't do any more caching than Mithril would do anyway.\n\n\t\t\t// TS can't prove that it's the right component and the mithril typings are generally slightly broken\n\t\t\tconst c = vnode.tag as unknown as Class<ClassComponent<FullAttrs>>\n\n\t\t\t// downcast because we ts can't really prove or enforce that additional attrs have compatible requestedPath and args\n\t\t\tconst attrs = { requestedPath, args, ...prepareAttrs(assertNotNull(cache)) } as FullAttrs\n\t\t\treturn m(\n\t\t\t\troot,\n\t\t\t\tm(c, {\n\t\t\t\t\t...attrs,\n\t\t\t\t\toncreate({ state }: VnodeDOM<FullAttrs, ComponentType>) {\n\t\t\t\t\t\twindow.tutao.currentView = state\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t)\n\t\t},\n\t}\n}\n\nfunction makeOldViewResolver(\n\tmakeView: (args: object, requestedPath: string) => Promise<TopLevelView>,\n\t{ requireLogin, cacheView }: { requireLogin?: boolean; cacheView?: boolean } = {},\n\tlogins: LoginController,\n): RouteResolver {\n\trequireLogin = requireLogin ?? true\n\tcacheView = cacheView ?? true\n\n\tconst viewCache: { view: TopLevelView | null } = { view: null }\n\treturn {\n\t\tonmatch: async (args, requestedPath) => {\n\t\t\tif (requireLogin && !logins.isUserLoggedIn()) {\n\t\t\t\tforceLogin(args, requestedPath)\n\t\t\t} else if (!requireLogin && logins.isUserLoggedIn()) {\n\t\t\t\tawait disableErrorHandlingDuringLogout()\n\t\t\t\tawait logins.logout(false)\n\t\t\t\twindowFacade.reload(args)\n\t\t\t} else {\n\t\t\t\tlet promise: Promise<TopLevelView>\n\n\t\t\t\tif (viewCache.view == null) {\n\t\t\t\t\tpromise = makeView(args, requestedPath).then((view) => {\n\t\t\t\t\t\tif (cacheView) {\n\t\t\t\t\t\t\tviewCache.view = view\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn view\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tpromise = Promise.resolve(viewCache.view)\n\t\t\t\t}\n\n\t\t\t\tPromise.all([promise]).then(([view]) => {\n\t\t\t\t\tview.updateUrl?.(args, requestedPath)\n\t\t\t\t\twindow.tutao.currentView = view\n\t\t\t\t})\n\t\t\t\treturn promise\n\t\t\t}\n\t\t},\n\t\trender: (vnode) => {\n\t\t\treturn m(root, vnode)\n\t\t},\n\t}\n}\n\n// PlatformId is passed by the native part in the URL\nfunction assignEnvPlatformId(urlQueryParams: Mithril.Params) {\n\tconst platformId = urlQueryParams[\"platformId\"]\n\n\tif (isApp() || isDesktop()) {\n\t\tif (\n\t\t\t(isApp() && (platformId === \"android\" || platformId === \"ios\")) ||\n\t\t\t(isDesktop() && (platformId === \"linux\" || platformId === \"win32\" || platformId === \"darwin\"))\n\t\t) {\n\t\t\tenv.platformId = platformId\n\t\t} else {\n\t\t\tthrow new ProgrammingError(`Invalid platform id: ${String(platformId)}`)\n\t\t}\n\t}\n}\n\nfunction extractPathPrefixes(): Readonly<{ prefix: string; prefixWithoutFile: string }> {\n\tconst prefix = location.pathname.endsWith(\"/\") ? location.pathname.substring(0, location.pathname.length - 1) : location.pathname\n\tconst prefixWithoutFile = prefix.includes(\".\") ? prefix.substring(0, prefix.lastIndexOf(\"/\")) : prefix\n\treturn Object.freeze({ prefix, prefixWithoutFile })\n}\n\nfunction getStartUrl(urlQueryParams: Mithril.Params): string {\n\t// Redirection triggered by the server or service worker (e.g. the user reloads /mail/id by pressing\n\t// F5 and we want to open /login?r=mail/id).\n\n\t// We want to build a new URL based on the redirect parameter and our current path and hash.\n\n\t// take redirect parameter from the query params\n\t// remove it from the query params (so that we don't loop)\n\tlet redirectTo = urlQueryParams[\"r\"]\n\tif (redirectTo) {\n\t\tdelete urlQueryParams[\"r\"]\n\n\t\tif (typeof redirectTo !== \"string\") {\n\t\t\tredirectTo = \"\"\n\t\t}\n\t} else {\n\t\tredirectTo = \"\"\n\t}\n\n\t// build new query, this time without redirect\n\tlet newQueryString = m.buildQueryString(urlQueryParams)\n\n\tif (newQueryString.length > 0) {\n\t\tnewQueryString = \"?\" + newQueryString\n\t}\n\n\tlet target = redirectTo + newQueryString\n\n\tif (target === \"\" || target[0] !== \"/\") target = \"/\" + target\n\n\t// Only append current hash if there's no hash in the redirect already.\n\t// Most browsers will keep the hash around even after the redirect unless there's another one provided.\n\t// In our case the hash is encoded as part of the query and is not deduplicated like described above so we have to manually do it, otherwise we end\n\t// up with double hashes.\n\tif (!new URL(urlPrefixes.prefix + target, window.location.href).hash) {\n\t\ttarget += location.hash\n\t}\n\treturn target\n}\n\nfunction registerForMailto() {\n\t// don't do this if we're in an iframe, in an app or the navigator doesn't allow us to do this.\n\tif (window.parent === window && !isDesktop() && typeof navigator.registerProtocolHandler === \"function\") {\n\t\tlet origin = location.origin\n\t\ttry {\n\t\t\t// @ts-ignore third argument removed from spec, but use is still recommended\n\t\t\tnavigator.registerProtocolHandler(\"mailto\", origin + \"/mailto#url=%s\", \"Tuta Mail\")\n\t\t} catch (e) {\n\t\t\t// Catch SecurityError's and some other cases when we are not allowed to register a handler\n\t\t\tconsole.log(\"Failed to register a mailto: protocol handler \", e)\n\t\t}\n\t}\n}\n\nfunction printJobsMessage(domainConfig: DomainConfig) {\n\tif (env.dist && domainConfig.firstPartyDomain) {\n\t\tconsole.log(`\n\n........................................\n........................................\n........................................\n........@@@@@@@@@@@@@@@@@@@@@@@.........\n.....@....@@@@@@@@@@@@@@@@@@@@@@@.......\n.....@@@....@@@@@@@@@@@@@@@@@@@@@@@.....\n.....@@@@@..............................    Do you care about privacy?\n.....@@@@@...@@@@@@@@@@@@@@@@@@@@@@.....\n.....@@@@...@@@@@@@@@@@@@@@@@@@@@@@.....    Work at Tuta! Fight for our rights!\n.....@@@@...@@@@@@@@@@@@@@@@@@@@@@......\n.....@@@...@@@@@@@@@@@@@@@@@@@@@@.......    https://tuta.com/jobs\n.....@@@...@@@@@@@@@@@@@@@@@@@@@@.......\n.....@@...@@@@@@@@@@@@@@@@@@@@@@........\n.....@@...@@@@@@@@@@@@@@@@@@@@@@........\n.....@...@@@@@@@@@@@@@@@@@@@@@@.........\n.....@...@@@@@@@@@@@@@@@@@@@@@@.........\n........@@@@@@@@@@@@@@@@@@@@@@..........\n.......@@@@@@@@@@@@@@@@@@@@@@...........\n.......@@@@@@@@@@@@@@@@@@@@@@...........\n........................................\n........................................\n........................................\n\n`)\n\t}\n}\n"]}