{"version":3,"file":"ContactEditor.js","sourceRoot":"","sources":["../../../../src/mail-app/contacts/ContactEditor.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { Dialog } from \"../../common/gui/base/Dialog\"\nimport type { Translation, TranslationKey } from \"../../common/misc/LanguageViewModel\"\nimport { lang } from \"../../common/misc/LanguageViewModel\"\nimport { isMailAddress } from \"../../common/misc/FormatValidator\"\nimport { formatBirthdayNumeric, formatContactDate } from \"../../common/contactsFunctionality/ContactUtils.js\"\nimport {\n\tContactAddressType,\n\tContactCustomDateType,\n\tContactMessengerHandleType,\n\tContactPhoneNumberType,\n\tContactRelationshipType,\n\tContactSocialType,\n\tContactWebsiteType,\n\tGroupType,\n\tKeys,\n} from \"../../common/api/common/TutanotaConstants\"\nimport {\n\tContact,\n\tContactAddress,\n\tContactCustomDate,\n\tContactMailAddress,\n\tContactMessengerHandle,\n\tContactPhoneNumber,\n\tContactPronouns,\n\tContactRelationship,\n\tContactSocialId,\n\tContactWebsite,\n\tcreateBirthday,\n\tcreateContact,\n\tcreateContactAddress,\n\tcreateContactCustomDate,\n\tcreateContactMailAddress,\n\tcreateContactMessengerHandle,\n\tcreateContactPhoneNumber,\n\tcreateContactPronouns,\n\tcreateContactRelationship,\n\tcreateContactSocialId,\n\tcreateContactWebsite,\n} from \"../../common/api/entities/tutanota/TypeRefs.js\"\nimport { assertNotNull, clone, downcast, findAndRemove, lastIndex, lastThrow, noOp, typedEntries } from \"@tutao/tutanota-utils\"\nimport { assertMainOrNode } from \"../../common/api/common/Env\"\nimport { windowFacade } from \"../../common/misc/WindowFacade\"\nimport { LockedError, NotFoundError, PayloadTooLargeError } from \"../../common/api/common/error/RestError\"\nimport type { ButtonAttrs } from \"../../common/gui/base/Button.js\"\nimport { ButtonType } from \"../../common/gui/base/Button.js\"\nimport { birthdayToIsoDate } from \"../../common/api/common/utils/BirthdayUtils\"\nimport {\n\tContactCustomDateTypeToLabel,\n\tContactCustomWebsiteTypeToLabel,\n\tContactMailAddressTypeToLabel,\n\tContactMessengerHandleTypeToLabel,\n\tContactPhoneNumberTypeToLabel,\n\tContactRelationshipTypeToLabel,\n\tContactSocialTypeToLabel,\n\tgetContactAddressTypeLabel,\n\tgetContactCustomDateTypeToLabel,\n\tgetContactCustomWebsiteTypeToLabel,\n\tgetContactMessengerHandleTypeToLabel,\n\tgetContactPhoneNumberTypeLabel,\n\tgetContactRelationshipTypeToLabel,\n\tgetContactSocialTypeLabel,\n} from \"./view/ContactGuiUtils\"\nimport { parseBirthday } from \"../../common/misc/DateParser\"\nimport type { TextFieldAttrs } from \"../../common/gui/base/TextField.js\"\nimport { Autocapitalize, Autocomplete, TextField, TextFieldType } from \"../../common/gui/base/TextField.js\"\nimport { EntityClient } from \"../../common/api/common/EntityClient\"\nimport { timestampToGeneratedId } from \"../../common/api/common/utils/EntityUtils\"\nimport { AggregateEditorAttrs, ContactAggregateEditor } from \"./ContactAggregateEditor\"\nimport { DefaultAnimationTime } from \"../../common/gui/animation/Animations\"\nimport { DialogHeaderBarAttrs } from \"../../common/gui/base/DialogHeaderBar\"\nimport { ProgrammingError } from \"../../common/api/common/error/ProgrammingError.js\"\nimport { locator } from \"../../common/api/main/CommonLocator.js\"\nimport { formatDate } from \"../../common/misc/Formatter.js\"\nimport { PasswordField } from \"../../common/misc/passwords/PasswordField.js\"\n\nassertMainOrNode()\n\nconst TAG = \"[ContactEditor]\"\n\ninterface CompleteCustomDate extends ContactCustomDate {\n\tdate: string\n\tisValid: boolean\n}\n\nexport class ContactEditor {\n\tprivate readonly dialog: Dialog\n\tprivate hasInvalidBirthday: boolean\n\tprivate readonly mailAddresses: Array<[ContactMailAddress, Id]>\n\tprivate readonly phoneNumbers: Array<[ContactPhoneNumber, Id]>\n\tprivate readonly addresses: Array<[ContactAddress, Id]>\n\tprivate readonly socialIds: Array<[ContactSocialId, Id]>\n\tprivate readonly websites: Array<[ContactWebsite, Id]>\n\tprivate readonly relationships: Array<[ContactRelationship, Id]>\n\tprivate readonly messengerHandles: Array<[ContactMessengerHandle, Id]>\n\tprivate readonly pronouns: Array<[ContactPronouns, Id]>\n\tprivate readonly customDates: Array<[CompleteCustomDate, Id]>\n\tprivate birthday: string\n\twindowCloseUnsubscribe: () => unknown\n\tprivate readonly isNewContact: boolean\n\tprivate readonly contact: Contact\n\tprivate readonly listId: Id\n\n\tprivate saving: boolean = false\n\n\t/*\n\t * The contact that should be update or the contact list that the new contact should be written to must be provided\n\t * @param entityClient\n\t * @param contact An existing or new contact. If null a new contact is created.\n\t * @param listId The list id of the new contact.\n\t * @param newContactIdReceiver. Is called receiving the contact id as soon as the new contact was saved.\n\t */\n\tconstructor(\n\t\tprivate readonly entityClient: EntityClient,\n\t\tcontact: Contact | null,\n\t\tlistId?: Id,\n\t\tprivate readonly newContactIdReceiver: ((contactId: Id) => unknown) | null = null,\n\t) {\n\t\tthis.contact = contact\n\t\t\t? clone(contact)\n\t\t\t: createContact({\n\t\t\t\t\tmailAddresses: [],\n\t\t\t\t\ttitle: null,\n\t\t\t\t\tsocialIds: [],\n\t\t\t\t\trole: \"\",\n\t\t\t\t\tpresharedPassword: null,\n\t\t\t\t\tphoto: null,\n\t\t\t\t\tphoneNumbers: [],\n\t\t\t\t\toldBirthdayDate: null,\n\t\t\t\t\tnickname: null,\n\t\t\t\t\tlastName: \"\",\n\t\t\t\t\tfirstName: \"\",\n\t\t\t\t\tcompany: \"\",\n\t\t\t\t\tcomment: \"\",\n\t\t\t\t\tbirthdayIso: null,\n\t\t\t\t\taddresses: [],\n\t\t\t\t\toldBirthdayAggregate: null,\n\t\t\t\t\tdepartment: null,\n\t\t\t\t\tmiddleName: null,\n\t\t\t\t\tnameSuffix: null,\n\t\t\t\t\tphoneticFirst: null,\n\t\t\t\t\tphoneticLast: null,\n\t\t\t\t\tphoneticMiddle: null,\n\t\t\t\t\tcustomDate: [],\n\t\t\t\t\tmessengerHandles: [],\n\t\t\t\t\tpronouns: [],\n\t\t\t\t\trelationships: [],\n\t\t\t\t\twebsites: [],\n\t\t\t  })\n\t\tthis.isNewContact = contact?._id == null\n\n\t\tif (this.isNewContact && listId == null) {\n\t\t\tthrow new ProgrammingError(\"must provide contact with Id to edit or listId for the new contact\")\n\t\t} else {\n\t\t\tthis.listId = listId ? listId : assertNotNull(contact, \"got an existing contact without id\")._id[0]\n\t\t}\n\n\t\tconst id = (entity: { _id: Id }) => entity._id || this.newId()\n\n\t\tthis.mailAddresses = this.contact.mailAddresses.map((address) => [address, id(address)])\n\t\tthis.mailAddresses.push(this.newMailAddress())\n\t\tthis.phoneNumbers = this.contact.phoneNumbers.map((phoneNumber) => [phoneNumber, id(phoneNumber)])\n\t\tthis.phoneNumbers.push(this.newPhoneNumber())\n\t\tthis.addresses = this.contact.addresses.map((address) => [address, id(address)])\n\t\tthis.addresses.push(this.newAddress())\n\t\tthis.socialIds = this.contact.socialIds.map((socialId) => [socialId, id(socialId)])\n\t\tthis.socialIds.push(this.newSocialId())\n\n\t\tthis.websites = this.contact.websites.map((website) => [website, id(website)])\n\t\tthis.websites.push(this.newWebsite())\n\t\tthis.relationships = this.contact.relationships.map((relation) => [relation, id(relation)])\n\t\tthis.relationships.push(this.newRelationship())\n\t\tthis.messengerHandles = this.contact.messengerHandles.map((handler) => [handler, id(handler)])\n\t\tthis.messengerHandles.push(this.newMessengerHandler())\n\t\tthis.pronouns = this.contact.pronouns.map((pronoun) => [pronoun, id(pronoun)])\n\t\tthis.pronouns.push(this.newPronoun())\n\t\tthis.customDates = this.contact.customDate.map((date) => [\n\t\t\t{\n\t\t\t\t...date,\n\t\t\t\tdate: formatContactDate(date.dateIso),\n\t\t\t\tisValid: true,\n\t\t\t},\n\t\t\tid(date),\n\t\t])\n\t\tthis.customDates.push(this.newCustomDate())\n\n\t\tthis.hasInvalidBirthday = false\n\t\tthis.birthday = formatContactDate(this.contact.birthdayIso) || \"\"\n\t\tthis.dialog = this.createDialog()\n\t\tthis.windowCloseUnsubscribe = noOp\n\t}\n\n\toncreate() {\n\t\tthis.windowCloseUnsubscribe = windowFacade.addWindowCloseListener(() => {})\n\t}\n\n\tonremove() {\n\t\tthis.windowCloseUnsubscribe()\n\t}\n\n\tview(): Children {\n\t\treturn m(\"#contact-editor\", [\n\t\t\tm(\".wrapping-row\", [this.renderFirstNameField(), this.renderLastNameField()]),\n\t\t\tm(\".wrapping-row\", [this.renderField(\"middleName\", \"middleName_placeholder\"), this.renderTitleField()]),\n\t\t\tm(\".wrapping-row\", [this.renderField(\"nameSuffix\", \"nameSuffix_placeholder\"), this.renderField(\"phoneticFirst\", \"phoneticFirst_placeholder\")]),\n\t\t\tm(\".wrapping-row\", [\n\t\t\t\tthis.renderField(\"phoneticMiddle\", \"phoneticMiddle_placeholder\"),\n\t\t\t\tthis.renderField(\"phoneticLast\", \"phoneticLast_placeholder\"),\n\t\t\t]),\n\t\t\tm(\".wrapping-row\", [this.renderField(\"nickname\", \"nickname_placeholder\"), this.renderBirthdayField()]),\n\t\t\tm(\".wrapping-row\", [\n\t\t\t\tthis.renderRoleField(),\n\t\t\t\tthis.renderField(\"department\", \"department_placeholder\"),\n\t\t\t\tthis.renderCompanyField(),\n\t\t\t\tthis.renderCommentField(),\n\t\t\t]),\n\t\t\tm(\".wrapping-row\", [\n\t\t\t\tm(\".custom-dates.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"dates_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.customDates.map(([date, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.customDates)\n\t\t\t\t\t\t\treturn this.renderCustomDatesEditor(id, !lastEditor, date)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t\tm(\".mail.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"email_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.mailAddresses.map(([address, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.mailAddresses)\n\t\t\t\t\t\t\treturn this.renderMailAddressesEditor(id, !lastEditor, address)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t\tm(\".phone.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"phone_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.phoneNumbers.map(([phoneNumber, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.phoneNumbers)\n\t\t\t\t\t\t\treturn this.renderPhonesEditor(id, !lastEditor, phoneNumber)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t\tm(\".relationship.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"relationships_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.relationships.map(([relationship, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.relationships)\n\t\t\t\t\t\t\treturn this.renderRelationshipsEditor(id, !lastEditor, relationship)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t\tm(\".address.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"address_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.addresses.map(([address, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.addresses)\n\t\t\t\t\t\t\treturn this.renderAddressesEditor(id, !lastEditor, address)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t]),\n\t\t\tm(\".wrapping-row\", [\n\t\t\t\tm(\".pronouns.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"pronouns_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.pronouns.map(([pronouns, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.pronouns)\n\t\t\t\t\t\t\treturn this.renderPronounsEditor(id, !lastEditor, pronouns)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t\tm(\".social.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"social_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.socialIds.map(([socialId, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.socialIds)\n\t\t\t\t\t\t\treturn this.renderSocialsEditor(id, !lastEditor, socialId)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t\tm(\".website.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"websites_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.websites.map(([website, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.websites)\n\t\t\t\t\t\t\treturn this.renderWebsitesEditor(id, !lastEditor, website)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t\tm(\".instant-message.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"messenger_handles_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.messengerHandles.map(([handle, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.messengerHandles)\n\t\t\t\t\t\t\treturn this.renderMessengerHandleEditor(id, !lastEditor, handle)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t]),\n\t\t\tthis.renderPresharedPasswordField(),\n\t\t\tm(\".pb\"),\n\t\t])\n\t}\n\n\tshow() {\n\t\tthis.dialog.show()\n\t}\n\n\tprivate close() {\n\t\tthis.dialog.close()\n\t}\n\n\t/**\n\t * * validate the input data\n\t * * create or update the contact, depending on status\n\t * * if successful, close the dialog.\n\t *\n\t * will not call the save function again if the operation is already running\n\t * @private\n\t */\n\tprivate async validateAndSave(): Promise<void> {\n\t\tif (this.hasInvalidBirthday) {\n\t\t\treturn Dialog.message(\"invalidBirthday_msg\")\n\t\t}\n\n\t\tif (this.saving) {\n\t\t\t// not showing a message. if the resource is locked, we'll show one when appropriate.\n\t\t\treturn\n\t\t}\n\t\tthis.saving = true\n\n\t\tthis.contact.mailAddresses = this.mailAddresses.map((e) => e[0]).filter((e) => e.address.trim().length > 0)\n\t\tthis.contact.phoneNumbers = this.phoneNumbers.map((e) => e[0]).filter((e) => e.number.trim().length > 0)\n\t\tthis.contact.addresses = this.addresses.map((e) => e[0]).filter((e) => e.address.trim().length > 0)\n\t\tthis.contact.socialIds = this.socialIds.map((e) => e[0]).filter((e) => e.socialId.trim().length > 0)\n\t\tthis.contact.customDate = this.customDates.map((e) => e[0] as ContactCustomDate).filter((e) => e.dateIso.trim().length > 0)\n\t\tthis.contact.relationships = this.relationships.map((e) => e[0]).filter((e) => e.person.trim().length > 0)\n\t\tthis.contact.websites = this.websites.map((e) => e[0]).filter((e) => e.url.length > 0)\n\t\tthis.contact.messengerHandles = this.messengerHandles.map((e) => e[0]).filter((e) => e.handle.length > 0)\n\t\tthis.contact.pronouns = this.pronouns.map((e) => e[0]).filter((e) => e.pronouns.length > 0)\n\t\ttry {\n\t\t\tif (this.isNewContact) {\n\t\t\t\tawait this.saveNewContact()\n\t\t\t} else {\n\t\t\t\tawait this.updateExistingContact()\n\t\t\t}\n\t\t\tthis.close()\n\t\t} catch (e) {\n\t\t\tthis.saving = false\n\t\t\tif (e instanceof PayloadTooLargeError) {\n\t\t\t\treturn Dialog.message(\"requestTooLarge_msg\")\n\t\t\t}\n\t\t\tif (e instanceof LockedError) {\n\t\t\t\treturn Dialog.message(\"operationStillActive_msg\")\n\t\t\t}\n\t\t}\n\t\t// if we got here, we're closing the dialog and don't have to reset this.saving\n\t}\n\n\tprivate async updateExistingContact(): Promise<void> {\n\t\ttry {\n\t\t\tawait this.entityClient.update(this.contact)\n\t\t} catch (e) {\n\t\t\tif (e instanceof NotFoundError) {\n\t\t\t\tconsole.log(TAG, `could not update contact ${this.contact._id}: not found`)\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async saveNewContact(): Promise<void> {\n\t\tthis.contact._ownerGroup = assertNotNull(\n\t\t\tlocator.logins.getUserController().user.memberships.find((m) => m.groupType === GroupType.Contact),\n\t\t\t\"did not find contact group membership\",\n\t\t).group\n\t\tconst contactId = await this.entityClient.setup(this.listId, this.contact)\n\t\tif (this.newContactIdReceiver) {\n\t\t\tthis.newContactIdReceiver(contactId)\n\t\t}\n\t}\n\n\tprivate renderCustomDatesEditor(id: Id, allowCancel: boolean, date: CompleteCustomDate): Children {\n\t\tlet dateHelpText = (): Translation => {\n\t\t\tlet bday = createBirthday({\n\t\t\t\tday: \"22\",\n\t\t\t\tmonth: \"9\",\n\t\t\t\tyear: \"2000\",\n\t\t\t})\n\t\t\treturn !date.isValid\n\t\t\t\t? lang.getTranslation(\"invalidDateFormat_msg\", {\n\t\t\t\t\t\t\"{1}\": formatBirthdayNumeric(bday),\n\t\t\t\t  })\n\t\t\t\t: lang.getTranslation(\"emptyString_msg\")\n\t\t}\n\n\t\tconst typeLabels: Array<[ContactCustomDateType, TranslationKey]> = typedEntries(ContactCustomDateTypeToLabel)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: date.date,\n\t\t\tfieldType: TextFieldType.Text,\n\t\t\tlabel: getContactCustomDateTypeToLabel(downcast(date.type), date.customTypeName),\n\t\t\thelpLabel: dateHelpText(),\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.customDates, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\tdate.date = value\n\t\t\t\tif (value.trim().length > 0) {\n\t\t\t\t\tlet parsedDate = parseBirthday(value, (referenceDate) => formatDate(referenceDate))\n\n\t\t\t\t\tif (parsedDate) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tdate.dateIso = birthdayToIsoDate(parsedDate)\n\t\t\t\t\t\t\tif (date === lastThrow(this.customDates)[0]) this.customDates.push(this.newCustomDate())\n\t\t\t\t\t\t\tdate.isValid = true\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tdate.isValid = false\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdate.isValid = false\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdate.isValid = true\n\t\t\t\t}\n\t\t\t},\n\t\t\tanimateCreate: !date.dateIso,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: (type) => this.onTypeSelected(type === ContactCustomDateType.CUSTOM, type, date),\n\t\t} satisfies AggregateEditorAttrs<any>)\n\t}\n\n\tprivate renderMailAddressesEditor(id: Id, allowCancel: boolean, mailAddress: ContactMailAddress): Children {\n\t\tlet helpLabel: TranslationKey\n\n\t\tif (mailAddress.address.trim().length > 0 && !isMailAddress(mailAddress.address.trim(), false)) {\n\t\t\thelpLabel = \"invalidInputFormat_msg\"\n\t\t} else {\n\t\t\thelpLabel = \"emptyString_msg\"\n\t\t}\n\n\t\tconst typeLabels: Array<[ContactAddressType, TranslationKey]> = typedEntries(ContactMailAddressTypeToLabel)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: mailAddress.address,\n\t\t\tfieldType: TextFieldType.Email,\n\t\t\tlabel: getContactAddressTypeLabel(downcast(mailAddress.type), mailAddress.customTypeName),\n\t\t\thelpLabel,\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.mailAddresses, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\tmailAddress.address = value\n\t\t\t\tif (mailAddress === lastThrow(this.mailAddresses)[0]) this.mailAddresses.push(this.newAddress())\n\t\t\t},\n\t\t\tanimateCreate: !mailAddress.address,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: (type) => this.onTypeSelected(type === ContactAddressType.CUSTOM, type, mailAddress),\n\t\t})\n\t}\n\n\tprivate renderPhonesEditor(id: Id, allowCancel: boolean, phoneNumber: ContactPhoneNumber): Children {\n\t\tconst typeLabels = typedEntries(ContactPhoneNumberTypeToLabel)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: phoneNumber.number,\n\t\t\tfieldType: TextFieldType.Text,\n\t\t\tlabel: getContactPhoneNumberTypeLabel(downcast(phoneNumber.type), phoneNumber.customTypeName),\n\t\t\thelpLabel: \"emptyString_msg\",\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.phoneNumbers, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\tphoneNumber.number = value\n\t\t\t\tif (phoneNumber === lastThrow(this.phoneNumbers)[0]) this.phoneNumbers.push(this.newPhoneNumber())\n\t\t\t},\n\t\t\tanimateCreate: !phoneNumber.number,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: (type) => this.onTypeSelected(type === ContactPhoneNumberType.CUSTOM, type, phoneNumber),\n\t\t})\n\t}\n\n\tprivate renderAddressesEditor(id: Id, allowCancel: boolean, address: ContactAddress): Children {\n\t\tconst typeLabels = typedEntries(ContactMailAddressTypeToLabel)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: address.address,\n\t\t\tfieldType: TextFieldType.Area,\n\t\t\tlabel: getContactAddressTypeLabel(downcast(address.type), address.customTypeName),\n\t\t\thelpLabel: \"emptyString_msg\",\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.addresses, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\taddress.address = value\n\t\t\t\tif (address === lastThrow(this.addresses)[0]) this.addresses.push(this.newAddress())\n\t\t\t},\n\t\t\tanimateCreate: !address.address,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: (type) => this.onTypeSelected(type === ContactAddressType.CUSTOM, type, address),\n\t\t})\n\t}\n\n\tprivate renderSocialsEditor(id: Id, allowCancel: boolean, socialId: ContactSocialId): Children {\n\t\tconst typeLabels = typedEntries(ContactSocialTypeToLabel)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: socialId.socialId,\n\t\t\tfieldType: TextFieldType.Text,\n\t\t\tlabel: getContactSocialTypeLabel(downcast<ContactSocialType>(socialId.type), socialId.customTypeName),\n\t\t\thelpLabel: \"emptyString_msg\",\n\t\t\tautocapitalizeTextField: Autocapitalize.none,\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.socialIds, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\tsocialId.socialId = value\n\t\t\t\tif (socialId === lastThrow(this.socialIds)[0]) this.socialIds.push(this.newSocialId())\n\t\t\t},\n\t\t\tanimateCreate: !socialId.socialId,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: (type) => this.onTypeSelected(type === ContactSocialType.CUSTOM, type, socialId),\n\t\t})\n\t}\n\n\tprivate renderWebsitesEditor(id: Id, allowCancel: boolean, website: ContactWebsite): Children {\n\t\tconst typeLabels = typedEntries(ContactCustomWebsiteTypeToLabel)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: website.url,\n\t\t\tfieldType: TextFieldType.Text,\n\t\t\tlabel: getContactCustomWebsiteTypeToLabel(downcast<ContactWebsiteType>(website.type), website.customTypeName),\n\t\t\thelpLabel: \"emptyString_msg\",\n\t\t\tautocapitalizeTextField: Autocapitalize.none,\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.websites, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\twebsite.url = value\n\t\t\t\tif (website === lastThrow(this.websites)[0]) this.websites.push(this.newWebsite())\n\t\t\t},\n\t\t\tanimateCreate: !website.url,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: (type) => this.onTypeSelected(type === ContactWebsiteType.CUSTOM, type, website),\n\t\t})\n\t}\n\n\tprivate renderRelationshipsEditor(id: Id, allowCancel: boolean, relationship: ContactRelationship): Children {\n\t\tconst typeLabels = typedEntries(ContactRelationshipTypeToLabel)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: relationship.person,\n\t\t\tfieldType: TextFieldType.Text,\n\t\t\tlabel: getContactRelationshipTypeToLabel(downcast<ContactRelationshipType>(relationship.type), relationship.customTypeName),\n\t\t\thelpLabel: \"emptyString_msg\",\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.relationships, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\trelationship.person = value\n\t\t\t\tif (relationship === lastThrow(this.relationships)[0]) this.relationships.push(this.newRelationship())\n\t\t\t},\n\t\t\tanimateCreate: !relationship.person,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: (type) => this.onTypeSelected(type === ContactRelationshipType.CUSTOM, type, relationship),\n\t\t})\n\t}\n\n\tprivate renderMessengerHandleEditor(id: Id, allowCancel: boolean, messengerHandle: ContactMessengerHandle): Children {\n\t\tconst typeLabels = typedEntries(ContactMessengerHandleTypeToLabel)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: messengerHandle.handle,\n\t\t\tfieldType: TextFieldType.Text,\n\t\t\tlabel: getContactMessengerHandleTypeToLabel(downcast<ContactMessengerHandleType>(messengerHandle.type), messengerHandle.customTypeName),\n\t\t\thelpLabel: \"emptyString_msg\",\n\t\t\tautocapitalizeTextField: Autocapitalize.none,\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.messengerHandles, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\tmessengerHandle.handle = value\n\t\t\t\tif (messengerHandle === lastThrow(this.messengerHandles)[0]) this.messengerHandles.push(this.newMessengerHandler())\n\t\t\t},\n\t\t\tanimateCreate: !messengerHandle.handle,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: (type) => this.onTypeSelected(type === ContactMessengerHandleType.CUSTOM, type, messengerHandle),\n\t\t})\n\t}\n\n\tprivate renderPronounsEditor(id: Id, allowCancel: boolean, pronouns: ContactPronouns): Children {\n\t\tconst typeLabels = typedEntries({ \"0\": \"language_label\" } as Record<string, TranslationKey>)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: pronouns.pronouns,\n\t\t\tfieldType: TextFieldType.Text,\n\t\t\tlabel: lang.makeTranslation(\"lang\", pronouns.language),\n\t\t\thelpLabel: \"emptyString_msg\",\n\t\t\tautocapitalizeTextField: Autocapitalize.none,\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.pronouns, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\tpronouns.pronouns = value\n\t\t\t\tif (pronouns === lastThrow(this.pronouns)[0]) this.pronouns.push(this.newPronoun())\n\t\t\t},\n\t\t\tanimateCreate: !pronouns.pronouns,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: () => this.onLanguageSelect(pronouns),\n\t\t})\n\t}\n\n\tprivate renderCommentField(): Children {\n\t\treturn m(StandaloneField, {\n\t\t\tlabel: \"comment_label\",\n\t\t\tvalue: this.contact.comment,\n\t\t\toninput: (value) => (this.contact.comment = value),\n\t\t\ttype: TextFieldType.Area,\n\t\t})\n\t}\n\n\tprivate renderFirstNameField(): Children {\n\t\treturn m(StandaloneField, {\n\t\t\tlabel: \"firstName_placeholder\",\n\t\t\tvalue: this.contact.firstName,\n\t\t\toninput: (value) => (this.contact.firstName = value),\n\t\t})\n\t}\n\n\tprivate renderField(fieldName: keyof Contact, label: TranslationKey): Children {\n\t\treturn m(StandaloneField, {\n\t\t\tlabel,\n\t\t\tvalue: (this.contact[fieldName] ?? \"\") as string,\n\t\t\toninput: (value: string) => {\n\t\t\t\t// Typescript will complain about it as an Unnecessary type check, but when the code gets\n\t\t\t\t// transpiled to javascript, without the check, we can pass any value\n\t\t\t\tif (typeof value === \"string\") {\n\t\t\t\t\tthis.contact[fieldName] = downcast(value)\n\t\t\t\t}\n\t\t\t},\n\t\t} satisfies TextFieldAttrs)\n\t}\n\n\tprivate renderLastNameField(): Children {\n\t\treturn m(StandaloneField, {\n\t\t\tlabel: \"lastName_placeholder\",\n\t\t\tvalue: this.contact.lastName,\n\t\t\toninput: (value) => (this.contact.lastName = value),\n\t\t})\n\t}\n\n\tprivate renderBirthdayField(): Children {\n\t\tlet birthdayHelpText = () => {\n\t\t\tlet bday = createBirthday({\n\t\t\t\tday: \"22\",\n\t\t\t\tmonth: \"9\",\n\t\t\t\tyear: \"2000\",\n\t\t\t})\n\t\t\treturn this.hasInvalidBirthday\n\t\t\t\t? lang.get(\"invalidDateFormat_msg\", {\n\t\t\t\t\t\t\"{1}\": formatBirthdayNumeric(bday),\n\t\t\t\t  })\n\t\t\t\t: \"\"\n\t\t}\n\n\t\treturn m(StandaloneField, {\n\t\t\tlabel: \"birthday_alt\",\n\t\t\tvalue: this.birthday,\n\t\t\thelpLabel: birthdayHelpText,\n\t\t\toninput: (value) => {\n\t\t\t\tthis.birthday = value\n\t\t\t\tif (value.trim().length === 0) {\n\t\t\t\t\tthis.contact.birthdayIso = null\n\t\t\t\t\tthis.hasInvalidBirthday = false\n\t\t\t\t} else {\n\t\t\t\t\tlet birthday = parseBirthday(value, (referenceDate) => formatDate(referenceDate))\n\n\t\t\t\t\tif (birthday) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.contact.birthdayIso = birthdayToIsoDate(birthday)\n\t\t\t\t\t\t\tthis.hasInvalidBirthday = false\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthis.hasInvalidBirthday = true\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.hasInvalidBirthday = true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t})\n\t}\n\n\tprivate renderCompanyField(): Children {\n\t\treturn m(StandaloneField, {\n\t\t\tlabel: \"company_label\",\n\t\t\tvalue: this.contact.company,\n\t\t\toninput: (value) => (this.contact.company = value),\n\t\t})\n\t}\n\n\tprivate renderRoleField(): Children {\n\t\treturn m(StandaloneField, {\n\t\t\tlabel: \"role_placeholder\",\n\t\t\tvalue: this.contact.role,\n\t\t\toninput: (value) => (this.contact.role = value),\n\t\t})\n\t}\n\n\tprivate renderTitleField(): Children {\n\t\treturn m(StandaloneField, {\n\t\t\tlabel: \"title_placeholder\",\n\t\t\tvalue: this.contact.title || \"\",\n\t\t\toninput: (value) => (this.contact.title = value),\n\t\t})\n\t}\n\n\tprivate renderPresharedPasswordField(): Children {\n\t\tif (!this.isNewContact && !this.contact.presharedPassword) {\n\t\t\treturn null\n\t\t}\n\n\t\treturn m(\".wrapping-row\", [\n\t\t\tm(\".passwords.mt-xl\", [\n\t\t\t\tm(\".h4\", lang.get(\"presharedPassword_label\")),\n\t\t\t\tm(PasswordField, {\n\t\t\t\t\tvalue: this.contact.presharedPassword ?? \"\",\n\t\t\t\t\tautocompleteAs: Autocomplete.newPassword,\n\t\t\t\t\toninput: (value) => (this.contact.presharedPassword = value),\n\t\t\t\t}),\n\t\t\t]),\n\t\t\tm(\".spacer\"),\n\t\t])\n\t}\n\n\tprivate createCloseButtonAttrs(): ButtonAttrs {\n\t\treturn {\n\t\t\tlabel: \"close_alt\",\n\t\t\tclick: () => this.close(),\n\t\t\ttype: ButtonType.Secondary,\n\t\t}\n\t}\n\n\tprivate newPhoneNumber(): [ContactPhoneNumber, Id] {\n\t\tconst phoneNumber = createContactPhoneNumber({\n\t\t\ttype: ContactPhoneNumberType.MOBILE,\n\t\t\tcustomTypeName: \"\",\n\t\t\tnumber: \"\",\n\t\t})\n\t\treturn [phoneNumber, this.newId()]\n\t}\n\n\tprivate newMailAddress(): [ContactMailAddress, Id] {\n\t\tconst mailAddress = createContactMailAddress({\n\t\t\ttype: ContactAddressType.WORK,\n\t\t\tcustomTypeName: \"\",\n\t\t\taddress: \"\",\n\t\t})\n\t\treturn [mailAddress, this.newId()]\n\t}\n\n\tprivate newAddress(): [ContactAddress, Id] {\n\t\tconst address = createContactAddress({\n\t\t\ttype: ContactAddressType.WORK,\n\t\t\tcustomTypeName: \"\",\n\t\t\taddress: \"\",\n\t\t})\n\t\treturn [address, this.newId()]\n\t}\n\n\tprivate newSocialId(): [ContactSocialId, Id] {\n\t\tconst socialId = createContactSocialId({\n\t\t\ttype: ContactSocialType.TWITTER,\n\t\t\tcustomTypeName: \"\",\n\t\t\tsocialId: \"\",\n\t\t})\n\t\treturn [socialId, this.newId()]\n\t}\n\n\tprivate newRelationship(): [ContactRelationship, Id] {\n\t\tconst relationship = createContactRelationship({\n\t\t\tperson: \"\",\n\t\t\ttype: ContactRelationshipType.ASSISTANT,\n\t\t\tcustomTypeName: \"\",\n\t\t})\n\t\treturn [relationship, this.newId()]\n\t}\n\n\tprivate newMessengerHandler(): [ContactMessengerHandle, Id] {\n\t\tconst messengerHandler = createContactMessengerHandle({\n\t\t\thandle: \"\",\n\t\t\ttype: ContactMessengerHandleType.SIGNAL,\n\t\t\tcustomTypeName: \"\",\n\t\t})\n\t\treturn [messengerHandler, this.newId()]\n\t}\n\n\tprivate newPronoun(): [ContactPronouns, Id] {\n\t\tconst contactPronouns = createContactPronouns({\n\t\t\tlanguage: \"\",\n\t\t\tpronouns: \"\",\n\t\t})\n\t\treturn [contactPronouns, this.newId()]\n\t}\n\n\tprivate newCustomDate(): [CompleteCustomDate, Id] {\n\t\tconst contactDate = createContactCustomDate({\n\t\t\tdateIso: \"\",\n\t\t\ttype: ContactCustomDateType.ANNIVERSARY,\n\t\t\tcustomTypeName: \"\",\n\t\t})\n\t\treturn [{ ...contactDate, date: \"\", isValid: true }, this.newId()]\n\t}\n\n\tprivate newWebsite(): [ContactWebsite, Id] {\n\t\tconst website = createContactWebsite({\n\t\t\ttype: ContactWebsiteType.PRIVATE,\n\t\t\turl: \"\",\n\t\t\tcustomTypeName: \"\",\n\t\t})\n\t\treturn [website, this.newId()]\n\t}\n\n\tprivate newId(): Id {\n\t\treturn timestampToGeneratedId(Date.now())\n\t}\n\n\tprivate onTypeSelected<\n\t\tK,\n\t\tT extends {\n\t\t\ttype: K\n\t\t\tcustomTypeName: string\n\t\t},\n\t>(isCustom: boolean, key: K, aggregate: T): void {\n\t\tif (isCustom) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tDialog.showTextInputDialog({\n\t\t\t\t\ttitle: \"customLabel_label\",\n\t\t\t\t\tlabel: \"customLabel_label\",\n\t\t\t\t\tdefaultValue: aggregate.customTypeName,\n\t\t\t\t}).then((name) => {\n\t\t\t\t\taggregate.customTypeName = name\n\t\t\t\t\taggregate.type = key\n\t\t\t\t})\n\t\t\t}, DefaultAnimationTime) // wait till the dropdown is hidden\n\t\t} else {\n\t\t\taggregate.type = key\n\t\t}\n\t}\n\n\tprivate onLanguageSelect(pronouns: ContactPronouns): void {\n\t\tsetTimeout(() => {\n\t\t\tDialog.showTextInputDialog({\n\t\t\t\ttitle: \"language_label\",\n\t\t\t\tlabel: \"language_label\",\n\t\t\t\tdefaultValue: pronouns.language.length > 0 ? pronouns.language : \"\",\n\t\t\t}).then((name) => {\n\t\t\t\tpronouns.language = name\n\t\t\t})\n\t\t}, DefaultAnimationTime) // wait till the dropdown is hidden\n\t}\n\n\tprivate createDialog(): Dialog {\n\t\tconst headerBarAttrs: DialogHeaderBarAttrs = {\n\t\t\tleft: [this.createCloseButtonAttrs()],\n\t\t\tmiddle: lang.makeTranslation(\"name\", this.contact.firstName + \" \" + this.contact.lastName),\n\t\t\tright: [\n\t\t\t\t{\n\t\t\t\t\tlabel: \"save_action\",\n\t\t\t\t\tclick: () => this.validateAndSave(),\n\t\t\t\t\ttype: ButtonType.Primary,\n\t\t\t\t},\n\t\t\t],\n\t\t}\n\t\treturn Dialog.largeDialog(headerBarAttrs, this)\n\t\t\t.addShortcut({\n\t\t\t\tkey: Keys.ESC,\n\t\t\t\texec: () => this.close(),\n\t\t\t\thelp: \"close_alt\",\n\t\t\t})\n\t\t\t.addShortcut({\n\t\t\t\tkey: Keys.S,\n\t\t\t\tctrlOrCmd: true,\n\t\t\t\texec: () => {\n\t\t\t\t\t// noinspection JSIgnoredPromiseFromCall\n\t\t\t\t\tthis.validateAndSave()\n\t\t\t\t},\n\t\t\t\thelp: \"save_action\",\n\t\t\t})\n\t\t\t.setCloseHandler(() => this.close())\n\t}\n}\n\n/** Renders TextField with wrapper and padding element to align them all. */\nclass StandaloneField implements Component<TextFieldAttrs> {\n\tview({ attrs }: Vnode<TextFieldAttrs>): Children {\n\t\treturn m(\".flex.child-grow\", [m(TextField, attrs), m(\".icon-button\")])\n\t}\n}\n"]}