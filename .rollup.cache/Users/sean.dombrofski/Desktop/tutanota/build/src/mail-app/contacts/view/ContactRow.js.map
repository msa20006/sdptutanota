{"version":3,"file":"ContactRow.js","sourceRoot":"","sources":["../../../../../src/mail-app/contacts/view/ContactRow.ts"],"names":[],"mappings":"AACA,OAAO,EACN,eAAe,EACf,UAAU,EACV,UAAU,EACV,uBAAuB,EACvB,sBAAsB,GAEtB,MAAM,+CAA+C,CAAA;AACtD,OAAO,EAAE,kBAAkB,EAAE,MAAM,uDAAuD,CAAA;AAC1F,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,MAAM,uBAAuB,CAAA;AAClD,OAAO,CAAe,MAAM,SAAS,CAAA;AACrC,OAAO,EAAE,EAAE,EAAE,IAAI,EAAE,MAAM,6BAA6B,CAAA;AAGtD,MAAM,CAAC,MAAM,kBAAkB,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,CAAA;AACpE,MAAM,CAAC,MAAM,cAAc,GAAG,cAAc,kBAAkB,GAAG,CAAA;AACjE,MAAM,CAAC,MAAM,cAAc,GAAG,eAAe,CAAA;AAE7C,MAAM,OAAO,UAAU;IAWO;IAA8E;IAV3G,GAAG,CAAQ;IACX,UAAU,GAAuB,IAAI,CAAA,CAAC,gBAAgB;IAEtD,MAAM,CAAgB;IACd,gBAAgB,CAA8B;IAC9C,OAAO,CAAc;IACrB,UAAU,CAAc;IACxB,WAAW,CAAmB;IAC9B,kBAAkB,CAAS;IAEnC,YAA6B,UAA2D,EAAmB,kBAAiC;QAA/G,eAAU,GAAV,UAAU,CAAiD;QAAmB,uBAAkB,GAAlB,kBAAkB,CAAe;QAC3I,IAAI,CAAC,GAAG,GAAG,CAAC,CAAA;QACZ,IAAI,CAAC,MAAM,GAAG,IAAI,CAAA;QAClB,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,kBAAkB,EAAE,CAAA;IACpD,CAAC;IAED,MAAM,CAAC,OAAgB,EAAE,QAAiB,EAAE,eAAwB;QACnE,IAAI,CAAC,MAAM,GAAG,OAAO,CAAA;QACrB,IAAI,CAAC,gBAAgB,CAAC,QAAQ,EAAE,eAAe,CAAC,CAAA;QAChD,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,kBAAkB,EAAE,IAAI,eAAe,CAAC,CAAA;QACvE,eAAe,CAAC,IAAI,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAA;QAC3C,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,QAAQ,IAAI,eAAe,CAAA;QAEtD,IAAI,CAAC,OAAO,CAAC,WAAW,GAAG,kBAAkB,CAAC,OAAO,CAAC,CAAA;QACtD,IAAI,CAAC,UAAU,CAAC,WAAW,GAAG,OAAO,CAAC,aAAa,IAAI,OAAO,CAAC,aAAa,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAA;IAClI,CAAC;IAED;;OAEG;IACH,MAAM;QACL,OAAO,CAAC,CACP,sBAAsB,EACtB;YACC,QAAQ,EAAE,CAAC,KAAK,EAAE,EAAE;gBACnB,OAAO,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAA;YAC3E,CAAC;YACD,mBAAmB,EAAE,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,gBAAgB,GAAG,OAAO,CAAC;SACnE,EACD,CAAC,CAAC,YAAY,EAAE;YACf,CAAC,CAAC,8BAA8B,EAAE;gBACjC,IAAI,EAAE,UAAU;gBAChB,KAAK,EAAE;oBACN,eAAe,EAAE,MAAM;iBACvB;gBACD,OAAO,EAAE,CAAC,CAAa,EAAE,EAAE;oBAC1B,CAAC,CAAC,eAAe,EAAE,CAAA;oBACnB,mBAAmB;gBACpB,CAAC;gBACD,QAAQ,EAAE,GAAG,EAAE;oBACd,IAAI,IAAI,CAAC,MAAM;wBAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAA;gBACxE,CAAC;gBACD,QAAQ,EAAE,CAAC,KAAK,EAAE,EAAE;oBACnB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC,GAAuB,CAAA;oBAChD,eAAe,CAAC,IAAI,CAAC,WAAW,EAAE,KAAK,CAAC,CAAA;gBACzC,CAAC;aACD,CAAC;SACF,CAAC,EACF,CAAC,CAAC,qCAAqC,EAAE;YACxC,CAAC,CAAC,kCAAkC,EAAE;gBACrC,QAAQ,EAAE,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC,GAAkB,CAAC;aAC9D,CAAC;YACF,CAAC,CAAC,+BAA+B,EAAE;gBAClC,QAAQ,EAAE,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC,GAAkB,CAAC;aACjE,CAAC;SACF,CAAC,CACF,CAAA;IACF,CAAC;IAEO,oBAAoB,CAAC,IAAa;QACzC,IAAI,IAAI,CAAC,kBAAkB,KAAK,IAAI;YAAE,OAAM;QAC5C,IAAI,IAAI,EAAE,CAAC;YACV,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,YAAY,GAAG,kBAAkB,CAAA;YACpD,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,YAAY,GAAG,kBAAkB,CAAA;YACvD,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,OAAO,GAAG,EAAE,CAAA;YAEnC,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,SAAS,EAAE,CAAC,cAAc,EAAE,cAAc,CAAC,EAAE,EAAE,uBAAuB,CAAC,CAAA;YAC/G,MAAM,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,SAAS,EAAE,CAAC,cAAc,EAAE,cAAc,CAAC,EAAE,EAAE,uBAAuB,CAAC,CAAA;YACrH,MAAM,YAAY,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,EAAE,SAAS,EAAE,CAAC,UAAU,EAAE,UAAU,CAAC,EAAE,EAAE,uBAAuB,CAAC,CAAA;YAE/G,OAAO,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,QAAQ,EAAE,WAAW,CAAC,QAAQ,EAAE,YAAY,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;gBACvF,QAAQ,CAAC,MAAM,EAAE,CAAA;gBACjB,WAAW,CAAC,MAAM,EAAE,CAAA;gBACpB,YAAY,CAAC,MAAM,EAAE,CAAA;gBACrB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAA;YACxB,CAAC,EAAE,IAAI,CAAC,CAAA;QACT,CAAC;aAAM,CAAC;YACP,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,YAAY,GAAG,GAAG,CAAA;YACrC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,YAAY,GAAG,GAAG,CAAA;YAExC,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,SAAS,EAAE,CAAC,cAAc,EAAE,cAAc,CAAC,EAAE,EAAE,uBAAuB,CAAC,CAAA;YAC/G,MAAM,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,SAAS,EAAE,CAAC,cAAc,EAAE,cAAc,CAAC,EAAE,EAAE,uBAAuB,CAAC,CAAA;YACrH,MAAM,YAAY,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,EAAE,SAAS,EAAE,CAAC,UAAU,EAAE,UAAU,CAAC,EAAE,EAAE,uBAAuB,CAAC,CAAA;YAE/G,OAAO,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,QAAQ,EAAE,WAAW,CAAC,QAAQ,EAAE,YAAY,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;gBACvF,QAAQ,CAAC,MAAM,EAAE,CAAA;gBACjB,WAAW,CAAC,MAAM,EAAE,CAAA;gBACpB,YAAY,CAAC,MAAM,EAAE,CAAA;gBACrB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAA;YACxB,CAAC,EAAE,IAAI,CAAC,CAAA;QACT,CAAC;QACD,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAA;IAC/B,CAAC;IAEO,YAAY,CAAC,IAAa;QACjC,IAAI,SAAS,CAAA;QACb,IAAI,KAAK,CAAA;QACT,IAAI,OAAO,CAAA;QACX,IAAI,IAAI,EAAE,CAAC;YACV,SAAS,GAAG,cAAc,CAAA;YAC1B,KAAK,GAAG,UAAU,CAAA;YAClB,OAAO,GAAG,kBAAkB,CAAA;QAC7B,CAAC;aAAM,CAAC;YACP,SAAS,GAAG,cAAc,CAAA;YAC1B,KAAK,GAAG,UAAU,CAAA;YAClB,OAAO,GAAG,GAAG,CAAA;QACd,CAAC;QAED,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,SAAS,GAAG,SAAS,CAAA;QAC3C,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,SAAS,GAAG,SAAS,CAAA;QACxC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,YAAY,GAAG,OAAO,CAAA;QAC5C,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,YAAY,GAAG,OAAO,CAAA;QACzC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,SAAS,GAAG,KAAK,CAAA;QACxC,uDAAuD;QACvD,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAA;IACpD,CAAC;CACD","sourcesContent":["import { Contact } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport {\n\tcheckboxOpacity,\n\tscaleXHide,\n\tscaleXShow,\n\tselectableRowAnimParams,\n\tSelectableRowContainer,\n\tSelectableRowSelectedSetter,\n} from \"../../../common/gui/SelectableRowContainer.js\"\nimport { getContactListName } from \"../../../common/contactsFunctionality/ContactUtils.js\"\nimport { NBSP, noOp } from \"@tutao/tutanota-utils\"\nimport m, { Children } from \"mithril\"\nimport { px, size } from \"../../../common/gui/size.js\"\nimport { VirtualRow } from \"../../../common/gui/base/ListUtils.js\"\n\nexport const shiftByForCheckbox = px(size.checkbox_size + size.hpad)\nexport const translateXShow = `translateX(${shiftByForCheckbox})`\nexport const translateXHide = \"translateX(0)\"\n\nexport class ContactRow implements VirtualRow<Contact> {\n\ttop: number\n\tdomElement: HTMLElement | null = null // set from List\n\n\tentity: Contact | null\n\tprivate selectionUpdater!: SelectableRowSelectedSetter\n\tprivate domName!: HTMLElement\n\tprivate domAddress!: HTMLElement\n\tprivate checkboxDom!: HTMLInputElement\n\tprivate checkboxWasVisible: boolean\n\n\tconstructor(private readonly onSelected: (entity: Contact, selected: boolean) => unknown, private readonly shouldShowCheckbox: () => boolean) {\n\t\tthis.top = 0\n\t\tthis.entity = null\n\t\tthis.checkboxWasVisible = this.shouldShowCheckbox()\n\t}\n\n\tupdate(contact: Contact, selected: boolean, isInMultiSelect: boolean): void {\n\t\tthis.entity = contact\n\t\tthis.selectionUpdater(selected, isInMultiSelect)\n\t\tthis.showCheckboxAnimated(this.shouldShowCheckbox() || isInMultiSelect)\n\t\tcheckboxOpacity(this.checkboxDom, selected)\n\t\tthis.checkboxDom.checked = selected && isInMultiSelect\n\n\t\tthis.domName.textContent = getContactListName(contact)\n\t\tthis.domAddress.textContent = contact.mailAddresses && contact.mailAddresses.length > 0 ? contact.mailAddresses[0].address : NBSP\n\t}\n\n\t/**\n\t * Only the structure is managed by mithril. We set all contents on our own (see update) in order to avoid the vdom overhead (not negligible on mobiles)\n\t */\n\trender(): Children {\n\t\treturn m(\n\t\t\tSelectableRowContainer,\n\t\t\t{\n\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\tPromise.resolve().then(() => this.showCheckbox(this.shouldShowCheckbox()))\n\t\t\t\t},\n\t\t\t\tonSelectedChangeRef: (updater) => (this.selectionUpdater = updater),\n\t\t\t},\n\t\t\tm(\".mt-xs.abs\", [\n\t\t\t\tm(\"input.checkbox.list-checkbox\", {\n\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\ttransformOrigin: \"left\",\n\t\t\t\t\t},\n\t\t\t\t\tonclick: (e: MouseEvent) => {\n\t\t\t\t\t\te.stopPropagation()\n\t\t\t\t\t\t// e.redraw = false\n\t\t\t\t\t},\n\t\t\t\t\tonchange: () => {\n\t\t\t\t\t\tif (this.entity) this.onSelected(this.entity, this.checkboxDom.checked)\n\t\t\t\t\t},\n\t\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\t\tthis.checkboxDom = vnode.dom as HTMLInputElement\n\t\t\t\t\t\tcheckboxOpacity(this.checkboxDom, false)\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t]),\n\t\t\tm(\".flex.col.overflow-hidden.flex-grow\", [\n\t\t\t\tm(\".text-ellipsis.badge-line-height\", {\n\t\t\t\t\toncreate: (vnode) => (this.domName = vnode.dom as HTMLElement),\n\t\t\t\t}),\n\t\t\t\tm(\".text-ellipsis.smaller.mt-xxs\", {\n\t\t\t\t\toncreate: (vnode) => (this.domAddress = vnode.dom as HTMLElement),\n\t\t\t\t}),\n\t\t\t]),\n\t\t)\n\t}\n\n\tprivate showCheckboxAnimated(show: boolean) {\n\t\tif (this.checkboxWasVisible === show) return\n\t\tif (show) {\n\t\t\tthis.domName.style.paddingRight = shiftByForCheckbox\n\t\t\tthis.domAddress.style.paddingRight = shiftByForCheckbox\n\t\t\tthis.checkboxDom.style.display = \"\"\n\n\t\t\tconst nameAnim = this.domName.animate({ transform: [translateXHide, translateXShow] }, selectableRowAnimParams)\n\t\t\tconst addressAnim = this.domAddress.animate({ transform: [translateXHide, translateXShow] }, selectableRowAnimParams)\n\t\t\tconst checkboxAnim = this.checkboxDom.animate({ transform: [scaleXHide, scaleXShow] }, selectableRowAnimParams)\n\n\t\t\tPromise.all([nameAnim.finished, addressAnim.finished, checkboxAnim.finished]).then(() => {\n\t\t\t\tnameAnim.cancel()\n\t\t\t\taddressAnim.cancel()\n\t\t\t\tcheckboxAnim.cancel()\n\t\t\t\tthis.showCheckbox(show)\n\t\t\t}, noOp)\n\t\t} else {\n\t\t\tthis.domName.style.paddingRight = \"0\"\n\t\t\tthis.domAddress.style.paddingRight = \"0\"\n\n\t\t\tconst nameAnim = this.domName.animate({ transform: [translateXShow, translateXHide] }, selectableRowAnimParams)\n\t\t\tconst addressAnim = this.domAddress.animate({ transform: [translateXShow, translateXHide] }, selectableRowAnimParams)\n\t\t\tconst checkboxAnim = this.checkboxDom.animate({ transform: [scaleXShow, scaleXHide] }, selectableRowAnimParams)\n\n\t\t\tPromise.all([nameAnim.finished, addressAnim.finished, checkboxAnim.finished]).then(() => {\n\t\t\t\tnameAnim.cancel()\n\t\t\t\taddressAnim.cancel()\n\t\t\t\tcheckboxAnim.cancel()\n\t\t\t\tthis.showCheckbox(show)\n\t\t\t}, noOp)\n\t\t}\n\t\tthis.checkboxWasVisible = show\n\t}\n\n\tprivate showCheckbox(show: boolean) {\n\t\tlet translate\n\t\tlet scale\n\t\tlet padding\n\t\tif (show) {\n\t\t\ttranslate = translateXShow\n\t\t\tscale = scaleXShow\n\t\t\tpadding = shiftByForCheckbox\n\t\t} else {\n\t\t\ttranslate = translateXHide\n\t\t\tscale = scaleXHide\n\t\t\tpadding = \"0\"\n\t\t}\n\n\t\tthis.domAddress.style.transform = translate\n\t\tthis.domName.style.transform = translate\n\t\tthis.domAddress.style.paddingRight = padding\n\t\tthis.domName.style.paddingRight = padding\n\t\tthis.checkboxDom.style.transform = scale\n\t\t// Stop the hidden checkbox from entering the tab index\n\t\tthis.checkboxDom.style.display = show ? \"\" : \"none\"\n\t}\n}\n"]}