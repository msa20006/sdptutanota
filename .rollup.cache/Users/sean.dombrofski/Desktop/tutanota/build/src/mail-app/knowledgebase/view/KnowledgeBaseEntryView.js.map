{"version":3,"file":"KnowledgeBaseEntryView.js","sourceRoot":"","sources":["../../../../../src/mail-app/knowledgebase/view/KnowledgeBaseEntryView.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport type { KnowledgeBaseEntry } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport { TemplateGroupRootTypeRef } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport { memoized, neverNull, noOp, ofClass, startsWith } from \"@tutao/tutanota-utils\"\nimport { htmlSanitizer } from \"../../../common/misc/HtmlSanitizer.js\"\nimport { Icons } from \"../../../common/gui/base/icons/Icons.js\"\nimport { locator } from \"../../../common/api/main/CommonLocator.js\"\nimport { getConfirmation } from \"../../../common/gui/base/GuiUtils.js\"\nimport { NotFoundError } from \"../../../common/api/common/error/RestError.js\"\nimport { IconButton } from \"../../../common/gui/base/IconButton.js\"\n\ntype KnowledgeBaseEntryViewAttrs = {\n\tentry: KnowledgeBaseEntry\n\tonTemplateSelected: (arg0: IdTuple) => unknown\n\treadonly: boolean\n}\n\n/**\n *  Renders one knowledgeBase entry\n */\nexport class KnowledgeBaseEntryView implements Component<KnowledgeBaseEntryViewAttrs> {\n\t_sanitizedEntry: (arg0: KnowledgeBaseEntry) => {\n\t\tcontent: string\n\t}\n\n\tconstructor() {\n\t\tthis._sanitizedEntry = memoized((entry) => {\n\t\t\treturn {\n\t\t\t\tcontent: htmlSanitizer.sanitizeHTML(entry.description, {\n\t\t\t\t\tblockExternalContent: true,\n\t\t\t\t}).html,\n\t\t\t}\n\t\t})\n\t}\n\n\tview({ attrs }: Vnode<KnowledgeBaseEntryViewAttrs>): Children {\n\t\treturn m(\".flex.flex-column\", [this._renderContent(attrs)])\n\t}\n\n\t_renderContent(attrs: KnowledgeBaseEntryViewAttrs): Children {\n\t\tconst { entry, readonly } = attrs\n\t\treturn m(\n\t\t\t\"\",\n\t\t\t{\n\t\t\t\tonclick: (event: MouseEvent) => {\n\t\t\t\t\tthis._handleAnchorClick(event, attrs)\n\t\t\t\t},\n\t\t\t},\n\t\t\t[\n\t\t\t\tm(\n\t\t\t\t\t\".flex.mt-l.center-vertically.selectable\",\n\t\t\t\t\tm(\".h4.text-ellipsis\", entry.title),\n\t\t\t\t\t!readonly ? [m(\".flex.flex-grow.justify-end\", [this.renderEditButton(entry), this.renderRemoveButton(entry)])] : null,\n\t\t\t\t),\n\t\t\t\tm(\"\", [\n\t\t\t\t\tm(\".mt-s.flex.mt-s.wrap\", [\n\t\t\t\t\t\tentry.keywords.map((entryKeyword) => {\n\t\t\t\t\t\t\treturn m(\".keyword-bubble.selectable\", entryKeyword.keyword)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t\tm(\".flex.flex-column.mt-s\", [m(\".editor-border.text-break.selectable\", m.trust(this._sanitizedEntry(entry).content))]),\n\t\t\t\t]),\n\t\t\t],\n\t\t)\n\t}\n\n\tprivate renderRemoveButton(entry: KnowledgeBaseEntry) {\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"remove_action\",\n\t\t\ticon: Icons.Trash,\n\t\t\tclick: () => {\n\t\t\t\tgetConfirmation(\"deleteEntryConfirm_msg\").confirmed(() => locator.entityClient.erase(entry).catch(ofClass(NotFoundError, noOp)))\n\t\t\t},\n\t\t})\n\t}\n\n\tprivate renderEditButton(entry: KnowledgeBaseEntry) {\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"edit_action\",\n\t\t\ticon: Icons.Edit,\n\t\t\tclick: () => {\n\t\t\t\timport(\"../../settings/KnowledgeBaseEditor.js\").then(({ showKnowledgeBaseEditor }) => {\n\t\t\t\t\tlocator.entityClient.load(TemplateGroupRootTypeRef, neverNull(entry._ownerGroup)).then((groupRoot) => {\n\t\t\t\t\t\tshowKnowledgeBaseEditor(entry, groupRoot)\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t},\n\t\t})\n\t}\n\n\t_handleAnchorClick(event: Event, attrs: KnowledgeBaseEntryViewAttrs): void {\n\t\tlet target = event.target as any\n\n\t\tif (target && target.closest) {\n\t\t\tlet anchorElement = target.closest(\"a\")\n\n\t\t\tif (anchorElement && startsWith(anchorElement.href, \"tutatemplate:\")) {\n\t\t\t\tevent.preventDefault()\n\t\t\t\tconst [listId, elementId] = new URL(anchorElement.href).pathname.split(\"/\")\n\t\t\t\tattrs.onTemplateSelected([listId, elementId])\n\t\t\t}\n\t\t}\n\t}\n}\n"]}