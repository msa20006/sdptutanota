{"version":3,"file":"MailViewerHeader.js","sourceRoot":"","sources":["../../../../../src/mail-app/mail/view/MailViewerHeader.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { InfoLink, lang } from \"../../../common/misc/LanguageViewModel.js\"\nimport { theme } from \"../../../common/gui/theme.js\"\nimport { styles } from \"../../../common/gui/styles.js\"\nimport { ExpanderButton, ExpanderPanel } from \"../../../common/gui/base/Expander.js\"\nimport { File as TutanotaFile } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport { BannerButtonAttrs, BannerType, InfoBanner } from \"../../../common/gui/base/InfoBanner.js\"\nimport { Icons } from \"../../../common/gui/base/icons/Icons.js\"\nimport { EventBanner, EventBannerAttrs } from \"./EventBanner.js\"\nimport { RecipientButton } from \"../../../common/gui/base/RecipientButton.js\"\nimport { createAsyncDropdown, createDropdown, DropdownButtonAttrs } from \"../../../common/gui/base/Dropdown.js\"\nimport { EncryptionAuthStatus, InboxRuleType, Keys, MailAuthenticationStatus, TabIndex } from \"../../../common/api/common/TutanotaConstants.js\"\nimport { Icon, progressIcon } from \"../../../common/gui/base/Icon.js\"\nimport { formatDateWithWeekday, formatDateWithWeekdayAndYear, formatStorageSize, formatTime } from \"../../../common/misc/Formatter.js\"\nimport { isAndroidApp, isDesktop, isIOSApp } from \"../../../common/api/common/Env.js\"\nimport { Button, ButtonType } from \"../../../common/gui/base/Button.js\"\nimport Badge from \"../../../common/gui/base/Badge.js\"\nimport { ContentBlockingStatus, MailViewerViewModel } from \"./MailViewerViewModel.js\"\nimport { canSeeTutaLinks } from \"../../../common/gui/base/GuiUtils.js\"\nimport { isNotNull, noOp, resolveMaybeLazy } from \"@tutao/tutanota-utils\"\nimport { IconButton } from \"../../../common/gui/base/IconButton.js\"\nimport { getConfidentialIcon, getFolderIconByType, isTutanotaTeamMail, promptAndDeleteMails, showMoveMailsDropdown } from \"./MailGuiUtils.js\"\nimport { BootIcons } from \"../../../common/gui/base/icons/BootIcons.js\"\nimport { editDraft, mailViewerMoreActions } from \"./MailViewerUtils.js\"\nimport { liveDataAttrs } from \"../../../common/gui/AriaUtils.js\"\nimport { isKeyPressed } from \"../../../common/misc/KeyManager.js\"\nimport { AttachmentBubble, getAttachmentType } from \"../../../common/gui/AttachmentBubble.js\"\nimport { responsiveCardHMargin, responsiveCardHPadding } from \"../../../common/gui/cards.js\"\nimport { companyTeamLabel } from \"../../../common/misc/ClientConstants.js\"\nimport { getMailAddressDisplayText } from \"../../../common/mailFunctionality/SharedMailUtils.js\"\nimport { MailAddressAndName } from \"../../../common/api/common/CommonMailUtils.js\"\nimport { LabelsPopup } from \"./LabelsPopup.js\"\nimport { Label } from \"../../../common/gui/base/Label.js\"\nimport { px, size } from \"../../../common/gui/size.js\"\n\nexport type MailAddressDropdownCreator = (args: {\n\tmailAddress: MailAddressAndName\n\tdefaultInboxRuleField: InboxRuleType | null\n\tcreateContact?: boolean\n}) => Promise<Array<DropdownButtonAttrs>>\n\nexport interface MailViewerHeaderAttrs {\n\t// Passing the whole viewModel because there are a lot of separate bits we might need.\n\t// If we want to reuse this view we should probably pass everything on its own.\n\tviewModel: MailViewerViewModel\n\tcreateMailAddressContextButtons: MailAddressDropdownCreator\n\tisPrimary: boolean\n\timportFile: (file: TutanotaFile) => void\n}\n\n/** The upper part of the mail viewer, everything but the mail body itself. */\nexport class MailViewerHeader implements Component<MailViewerHeaderAttrs> {\n\tprivate detailsExpanded = false\n\tprivate filesExpanded = false\n\n\tview({ attrs }: Vnode<MailViewerHeaderAttrs>): Children {\n\t\tconst { viewModel } = attrs\n\t\tconst dateTime = formatDateWithWeekday(viewModel.mail.receivedDate) + \" • \" + formatTime(viewModel.mail.receivedDate)\n\t\tconst dateTimeFull = formatDateWithWeekdayAndYear(viewModel.mail.receivedDate) + \" • \" + formatTime(viewModel.mail.receivedDate)\n\n\t\treturn m(\".header.selectable\", [\n\t\t\tthis.renderSubjectActionsLine(attrs),\n\t\t\tthis.renderFolderAndLabels(viewModel),\n\t\t\tthis.renderAddressesAndDate(viewModel, attrs, dateTime, dateTimeFull),\n\t\t\tm(\n\t\t\t\tExpanderPanel,\n\t\t\t\t{\n\t\t\t\t\texpanded: this.detailsExpanded,\n\t\t\t\t},\n\t\t\t\tthis.renderDetails(attrs, { bubbleMenuWidth: 300 }),\n\t\t\t),\n\t\t\tthis.renderAttachments(viewModel, attrs.importFile),\n\t\t\tthis.renderConnectionLostBanner(viewModel),\n\t\t\tthis.renderEventBanner(viewModel),\n\t\t\tthis.renderBanners(attrs),\n\t\t])\n\t}\n\n\tprivate renderFolderAndLabels(viewModel: MailViewerViewModel) {\n\t\tconst folderInfo = viewModel.getFolderInfo()\n\t\tif (!folderInfo) return null\n\t\tconst icon = getFolderIconByType(folderInfo.folderType)\n\n\t\tconst folderText = viewModel.getFolderMailboxText()\n\t\tconst labels = viewModel.getLabels()\n\t\tif (folderText == null && labels.length === 0) {\n\t\t\treturn null\n\t\t}\n\n\t\tconst margin = px(size.vpad_xsm)\n\t\treturn m(\n\t\t\t\".flex.mb-xs.flex-wrap\",\n\t\t\t{\n\t\t\t\tstyle: {\n\t\t\t\t\tcolumnGap: margin,\n\t\t\t\t\trowGap: margin,\n\t\t\t\t},\n\t\t\t\tclass: responsiveCardHMargin(),\n\t\t\t},\n\t\t\t[\n\t\t\t\tfolderText\n\t\t\t\t\t? m(\".flex.small\", [\n\t\t\t\t\t\t\tm(\".b\", m(\"\", lang.get(\"location_label\"))),\n\t\t\t\t\t\t\tm(Icon, {\n\t\t\t\t\t\t\t\ticon,\n\t\t\t\t\t\t\t\tcontainer: \"div\",\n\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\tfill: theme.content_button,\n\t\t\t\t\t\t\t\t\tmarginLeft: margin,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tm(\".span\", folderInfo.name),\n\t\t\t\t\t  ])\n\t\t\t\t\t: null,\n\t\t\t\tlabels.map((label) =>\n\t\t\t\t\tm(Label, {\n\t\t\t\t\t\ttext: label.name,\n\t\t\t\t\t\tcolor: label.color ?? theme.content_accent,\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t],\n\t\t)\n\t}\n\n\tprivate renderAddressesAndDate(viewModel: MailViewerViewModel, attrs: MailViewerHeaderAttrs, dateTime: string, dateTimeFull: string) {\n\t\tconst folderInfo = viewModel.getFolderInfo()\n\t\tif (!folderInfo) return null\n\n\t\tconst displayedSender = viewModel.getDisplayedSender()\n\t\treturn m(\n\t\t\t\".flex.mt-xs.click.col\",\n\t\t\t{\n\t\t\t\tclass: responsiveCardHMargin(),\n\t\t\t\trole: \"button\",\n\t\t\t\t\"aria-pressed\": String(this.detailsExpanded),\n\t\t\t\t\"aria-expanded\": String(this.detailsExpanded),\n\t\t\t\ttabindex: TabIndex.Default,\n\t\t\t\tonclick: () => {\n\t\t\t\t\tthis.detailsExpanded = !this.detailsExpanded\n\t\t\t\t},\n\t\t\t\tonkeydown: (e: KeyboardEvent) => {\n\t\t\t\t\tif (isKeyPressed(e.key, Keys.SPACE, Keys.RETURN)) {\n\t\t\t\t\t\tthis.detailsExpanded = !this.detailsExpanded\n\t\t\t\t\t\te.preventDefault()\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\t[\n\t\t\t\tdisplayedSender == null\n\t\t\t\t\t? null\n\t\t\t\t\t: m(\".small.flex.flex-wrap.items-start\", [\n\t\t\t\t\t\t\tm(\"span.text-break\", getMailAddressDisplayText(displayedSender.name, displayedSender.address, false)),\n\t\t\t\t\t  ]),\n\t\t\t\tm(\".flex\", [\n\t\t\t\t\tthis.getRecipientEmailAddress(attrs),\n\t\t\t\t\tm(\".flex-grow\"),\n\t\t\t\t\tm(\".flex.items-center.white-space-pre.ml-s.ml-between-s\", {\n\t\t\t\t\t\t// Orca refuses to read ut unless it's not focusable\n\t\t\t\t\t\ttabindex: TabIndex.Default,\n\t\t\t\t\t\t\"aria-label\": lang.get(viewModel.isConfidential() ? \"confidential_action\" : \"nonConfidential_action\") + \", \" + dateTime,\n\t\t\t\t\t}),\n\t\t\t\t\tm(\".flex.ml-between-s.items-center\", [\n\t\t\t\t\t\tviewModel.isConfidential()\n\t\t\t\t\t\t\t? m(Icon, {\n\t\t\t\t\t\t\t\t\ticon: getConfidentialIcon(viewModel.mail),\n\t\t\t\t\t\t\t\t\tcontainer: \"div\",\n\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\tfill: theme.content_button,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\thoverText: lang.get(\"confidential_label\"),\n\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t: null,\n\n\t\t\t\t\t\tm(Icon, {\n\t\t\t\t\t\t\ticon: getFolderIconByType(folderInfo.folderType),\n\t\t\t\t\t\t\tcontainer: \"div\",\n\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\tfill: theme.content_button,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\thoverText: folderInfo.name,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tm(\".small.font-weight-600.selectable.no-wrap\", { style: { color: theme.content_button } }, [\n\t\t\t\t\t\t\tm(\".noprint\", dateTime), // show the short date when viewing\n\t\t\t\t\t\t\tm(\".noscreen\", dateTimeFull), // show the date with year when printing\n\t\t\t\t\t\t]),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t],\n\t\t)\n\t}\n\n\tprivate renderSubjectActionsLine(attrs: MailViewerHeaderAttrs) {\n\t\tconst { viewModel } = attrs\n\t\tconst classes = this.makeSubjectActionsLineClasses()\n\t\tconst senderName = viewModel.getDisplayedSender()?.name?.trim() ?? \"\"\n\t\tconst displayAddressForSender = senderName === \"\"\n\n\t\treturn m(classes, [\n\t\t\tm(\n\t\t\t\t\".flex.flex-grow.align-self-start.items-start.overflow-hidden\",\n\t\t\t\t{\n\t\t\t\t\tclass: styles.isSingleColumnLayout() ? \"mt-m\" : \"mt\",\n\t\t\t\t\trole: \"button\",\n\t\t\t\t\t\"mail-expander\": \"true\",\n\t\t\t\t\t// \"aria-expanded\" is always true because this component is only used in expanded view\n\t\t\t\t\t\"aria-expanded\": \"true\",\n\t\t\t\t\ttabindex: TabIndex.Default,\n\t\t\t\t\tonclick: (e: MouseEvent) => {\n\t\t\t\t\t\tviewModel.collapseMail()\n\t\t\t\t\t\te.stopPropagation()\n\t\t\t\t\t},\n\t\t\t\t\tonkeydown: (e: KeyboardEvent) => {\n\t\t\t\t\t\tif (isKeyPressed(e.key, Keys.SPACE, Keys.RETURN) && (e.target as HTMLElement).hasAttribute(\"mail-expander\")) {\n\t\t\t\t\t\t\tviewModel.collapseMail()\n\t\t\t\t\t\t\te.preventDefault()\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[\n\t\t\t\t\tviewModel.isUnread() ? this.renderUnreadDot() : null,\n\t\t\t\t\tviewModel.isDraftMail()\n\t\t\t\t\t\t? m(\n\t\t\t\t\t\t\t\t\".mr-xs.align-self-center\",\n\t\t\t\t\t\t\t\tm(Icon, {\n\t\t\t\t\t\t\t\t\ticon: Icons.Edit,\n\t\t\t\t\t\t\t\t\tcontainer: \"div\",\n\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\tfill: theme.content_button,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\thoverText: lang.get(\"draft_label\"),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: null,\n\t\t\t\t\tthis.tutaoBadge(viewModel),\n\t\t\t\t\tm(\n\t\t\t\t\t\t\"span\" + (displayAddressForSender ? \".invisible.overflow-hidden\" : \".text-break\") + (viewModel.isUnread() ? \".font-weight-600\" : \"\"),\n\t\t\t\t\t\tdisplayAddressForSender ? viewModel.getDisplayedSender()?.address ?? \"\" : senderName,\n\t\t\t\t\t),\n\t\t\t\t],\n\t\t\t),\n\t\t\tm(\n\t\t\t\t\".flex-end.items-start.ml-between-s\",\n\t\t\t\t{\n\t\t\t\t\tclass: styles.isSingleColumnLayout() ? \"\" : \"mt-xs\",\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\t// align \"more\" button with the datetime text\n\t\t\t\t\t\tmarginRight: styles.isSingleColumnLayout() ? \"-3px\" : \"6px\",\n\t\t\t\t\t},\n\t\t\t\t\tonclick: (e: MouseEvent) => e.stopPropagation(),\n\t\t\t\t},\n\t\t\t\tthis.moreButton(attrs),\n\t\t\t),\n\t\t])\n\t}\n\n\tprivate renderUnreadDot(): Children {\n\t\treturn m(\n\t\t\t\".flex.flex-no-grow.no-shrink.pr-s\",\n\t\t\t{\n\t\t\t\tstyle: {\n\t\t\t\t\tpaddingTop: \"2px\",\n\t\t\t\t},\n\t\t\t},\n\t\t\tm(\".dot.bg-accent-fg\"),\n\t\t)\n\t}\n\n\tprivate makeSubjectActionsLineClasses() {\n\t\tlet classes = \".flex.click\"\n\t\tif (styles.isSingleColumnLayout()) {\n\t\t\tclasses += \".ml\"\n\t\t} else {\n\t\t\tclasses += \".pl-l\"\n\t\t}\n\n\t\treturn classes\n\t}\n\n\tprivate renderBanners(attrs: MailViewerHeaderAttrs): Children {\n\t\tconst { viewModel } = attrs\n\t\tif (viewModel.isCollapsed()) return null\n\t\t// we don't wrap it in a single element because our container might depend on us being separate children for margins\n\t\treturn [\n\t\t\tm(\n\t\t\t\t\".\" + responsiveCardHMargin(),\n\t\t\t\tthis.renderPhishingWarning(viewModel) ?? viewModel.isWarningDismissed()\n\t\t\t\t\t? null\n\t\t\t\t\t: this.renderHardAuthenticationFailWarning(viewModel) ?? this.renderSoftAuthenticationFailWarning(viewModel),\n\t\t\t),\n\t\t\tm(\".\" + responsiveCardHMargin(), this.renderExternalContentBanner(attrs)),\n\t\t\tm(\"hr.hr.mt-xs.\" + responsiveCardHMargin()),\n\t\t].filter(Boolean)\n\t}\n\n\tprivate renderConnectionLostBanner(viewModel: MailViewerViewModel): Children {\n\t\t// If the mail body failed to load, then we show a message in the main column\n\t\t// If the mail body did load but not everything else, we show the message here\n\t\tif (viewModel.isConnectionLost()) {\n\t\t\treturn m(\n\t\t\t\t\".\" + responsiveCardHMargin(),\n\t\t\t\tm(InfoBanner, {\n\t\t\t\t\tmessage: \"mailPartsNotLoaded_msg\",\n\t\t\t\t\ticon: Icons.Warning,\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: \"retry_action\",\n\t\t\t\t\t\t\tclick: () => viewModel.loadAll(Promise.resolve()),\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t)\n\t\t} else {\n\t\t\treturn null\n\t\t}\n\t}\n\n\tprivate renderEventBanner(viewModel: MailViewerViewModel): Children {\n\t\tconst eventAttachment = viewModel.getCalendarEventAttachment()\n\t\treturn eventAttachment\n\t\t\t? m(\n\t\t\t\t\t\".\" + responsiveCardHMargin(),\n\t\t\t\t\tm(EventBanner, {\n\t\t\t\t\t\tcontents: eventAttachment.contents,\n\t\t\t\t\t\trecipient: eventAttachment.recipient,\n\t\t\t\t\t\tmail: viewModel.mail,\n\t\t\t\t\t} satisfies EventBannerAttrs),\n\t\t\t  )\n\t\t\t: null\n\t}\n\n\tprivate renderDetails(attrs: MailViewerHeaderAttrs, { bubbleMenuWidth }: { bubbleMenuWidth: number }): Children {\n\t\tconst { viewModel, createMailAddressContextButtons } = attrs\n\t\tconst envelopeSender = viewModel.getDifferentEnvelopeSender()\n\t\tconst displayedSender = viewModel.getDisplayedSender()\n\n\t\treturn m(\".\" + responsiveCardHPadding(), liveDataAttrs(), [\n\t\t\tm(\n\t\t\t\t\".mt-s\",\n\t\t\t\tdisplayedSender == null\n\t\t\t\t\t? null\n\t\t\t\t\t: [\n\t\t\t\t\t\t\tm(\".small.b\", lang.get(\"from_label\")),\n\t\t\t\t\t\t\tm(RecipientButton, {\n\t\t\t\t\t\t\t\tlabel: getMailAddressDisplayText(displayedSender.name, displayedSender.address, false),\n\t\t\t\t\t\t\t\tclick: createAsyncDropdown({\n\t\t\t\t\t\t\t\t\tlazyButtons: () =>\n\t\t\t\t\t\t\t\t\t\tcreateMailAddressContextButtons({\n\t\t\t\t\t\t\t\t\t\t\tmailAddress: displayedSender,\n\t\t\t\t\t\t\t\t\t\t\tdefaultInboxRuleField: InboxRuleType.FROM_EQUALS,\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\twidth: bubbleMenuWidth,\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t  ],\n\t\t\t\tenvelopeSender\n\t\t\t\t\t? [\n\t\t\t\t\t\t\tm(\".small.b\", lang.get(\"sender_label\")),\n\t\t\t\t\t\t\tm(RecipientButton, {\n\t\t\t\t\t\t\t\tlabel: getMailAddressDisplayText(\"\", envelopeSender, false),\n\t\t\t\t\t\t\t\tclick: createAsyncDropdown({\n\t\t\t\t\t\t\t\t\tlazyButtons: async () => {\n\t\t\t\t\t\t\t\t\t\tconst childElements = [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tinfo: lang.get(\"envelopeSenderInfo_msg\"),\n\t\t\t\t\t\t\t\t\t\t\t\tcenter: false,\n\t\t\t\t\t\t\t\t\t\t\t\tbold: false,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tinfo: envelopeSender,\n\t\t\t\t\t\t\t\t\t\t\t\tcenter: true,\n\t\t\t\t\t\t\t\t\t\t\t\tbold: true,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\tconst contextButtons = await createMailAddressContextButtons({\n\t\t\t\t\t\t\t\t\t\t\tmailAddress: {\n\t\t\t\t\t\t\t\t\t\t\t\taddress: envelopeSender,\n\t\t\t\t\t\t\t\t\t\t\t\tname: \"\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tdefaultInboxRuleField: InboxRuleType.FROM_EQUALS,\n\t\t\t\t\t\t\t\t\t\t\tcreateContact: false,\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\treturn [...childElements, ...contextButtons]\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\twidth: bubbleMenuWidth,\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t  ]\n\t\t\t\t\t: null,\n\t\t\t),\n\t\t\tm(\n\t\t\t\t\".mt-s\",\n\t\t\t\tviewModel.getToRecipients().length\n\t\t\t\t\t? [\n\t\t\t\t\t\t\tm(\".small.b\", lang.get(\"to_label\")),\n\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\".flex.col.mt-between-s\",\n\t\t\t\t\t\t\t\tviewModel.getToRecipients().map((recipient) =>\n\t\t\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\t\t\".flex\",\n\t\t\t\t\t\t\t\t\t\tm(RecipientButton, {\n\t\t\t\t\t\t\t\t\t\t\tlabel: getMailAddressDisplayText(recipient.name, recipient.address, false),\n\t\t\t\t\t\t\t\t\t\t\tclick: createAsyncDropdown({\n\t\t\t\t\t\t\t\t\t\t\t\tlazyButtons: () =>\n\t\t\t\t\t\t\t\t\t\t\t\t\tcreateMailAddressContextButtons({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmailAddress: recipient,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefaultInboxRuleField: InboxRuleType.RECIPIENT_TO_EQUALS,\n\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\twidth: bubbleMenuWidth,\n\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t// To wrap text inside flex container, we need to allow element to shrink and pick own width\n\t\t\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t\t\tflex: \"0 1 auto\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t  ]\n\t\t\t\t\t: null,\n\t\t\t),\n\t\t\tm(\n\t\t\t\t\".mt-s\",\n\t\t\t\tviewModel.getCcRecipients().length\n\t\t\t\t\t? [\n\t\t\t\t\t\t\tm(\".small.b\", lang.get(\"cc_label\")),\n\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\".flex-start.flex-wrap\",\n\t\t\t\t\t\t\t\tviewModel.getCcRecipients().map((recipient) =>\n\t\t\t\t\t\t\t\t\tm(RecipientButton, {\n\t\t\t\t\t\t\t\t\t\tlabel: getMailAddressDisplayText(recipient.name, recipient.address, false),\n\t\t\t\t\t\t\t\t\t\tclick: createAsyncDropdown({\n\t\t\t\t\t\t\t\t\t\t\tlazyButtons: () =>\n\t\t\t\t\t\t\t\t\t\t\t\tcreateMailAddressContextButtons({\n\t\t\t\t\t\t\t\t\t\t\t\t\tmailAddress: recipient,\n\t\t\t\t\t\t\t\t\t\t\t\t\tdefaultInboxRuleField: InboxRuleType.RECIPIENT_CC_EQUALS,\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\twidth: bubbleMenuWidth,\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t\tflex: \"0 1 auto\",\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t  ]\n\t\t\t\t\t: null,\n\t\t\t),\n\t\t\tm(\n\t\t\t\t\".mt-s\",\n\t\t\t\tviewModel.getBccRecipients().length\n\t\t\t\t\t? [\n\t\t\t\t\t\t\tm(\".small.b\", lang.get(\"bcc_label\")),\n\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\".flex-start.flex-wrap\",\n\t\t\t\t\t\t\t\tviewModel.getBccRecipients().map((recipient) =>\n\t\t\t\t\t\t\t\t\tm(RecipientButton, {\n\t\t\t\t\t\t\t\t\t\tlabel: getMailAddressDisplayText(recipient.name, recipient.address, false),\n\t\t\t\t\t\t\t\t\t\tclick: createAsyncDropdown({\n\t\t\t\t\t\t\t\t\t\t\tlazyButtons: () =>\n\t\t\t\t\t\t\t\t\t\t\t\tcreateMailAddressContextButtons({\n\t\t\t\t\t\t\t\t\t\t\t\t\tmailAddress: recipient,\n\t\t\t\t\t\t\t\t\t\t\t\t\tdefaultInboxRuleField: InboxRuleType.RECIPIENT_BCC_EQUALS,\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\twidth: bubbleMenuWidth,\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t\tflex: \"0 1 auto\",\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t  ]\n\t\t\t\t\t: null,\n\t\t\t),\n\t\t\tm(\n\t\t\t\t\".mt-s\",\n\t\t\t\tviewModel.getReplyTos().length\n\t\t\t\t\t? [\n\t\t\t\t\t\t\tm(\".small.b\", lang.get(\"replyTo_label\")),\n\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\".flex-start.flex-wrap\",\n\t\t\t\t\t\t\t\tviewModel.getReplyTos().map((recipient) =>\n\t\t\t\t\t\t\t\t\tm(RecipientButton, {\n\t\t\t\t\t\t\t\t\t\tlabel: getMailAddressDisplayText(recipient.name, recipient.address, false),\n\t\t\t\t\t\t\t\t\t\tclick: createAsyncDropdown({\n\t\t\t\t\t\t\t\t\t\t\tlazyButtons: () =>\n\t\t\t\t\t\t\t\t\t\t\t\tcreateMailAddressContextButtons({\n\t\t\t\t\t\t\t\t\t\t\t\t\tmailAddress: recipient,\n\t\t\t\t\t\t\t\t\t\t\t\t\tdefaultInboxRuleField: null,\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\twidth: bubbleMenuWidth,\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t\tflex: \"0 1 auto\",\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t  ]\n\t\t\t\t\t: null,\n\t\t\t),\n\t\t])\n\t}\n\n\tprivate renderAttachments(viewModel: MailViewerViewModel, importFile: (file: TutanotaFile) => void): Children {\n\t\t// Show a loading symbol if we are loading attachments\n\t\tif (viewModel.isLoadingAttachments() && !viewModel.isConnectionLost()) {\n\t\t\treturn m(\".flex.\" + responsiveCardHMargin(), [\n\t\t\t\tm(\".flex-v-center.pl-button\", progressIcon()),\n\t\t\t\tm(\".small.flex-v-center.plr.button-height\", lang.get(\"loading_msg\")),\n\t\t\t])\n\t\t} else {\n\t\t\tconst attachments = viewModel.getNonInlineAttachments()\n\t\t\tconst attachmentCount = attachments.length\n\n\t\t\t// Do nothing if we have no attachments\n\t\t\tif (attachmentCount === 0) {\n\t\t\t\treturn null\n\t\t\t}\n\n\t\t\t// Get the total size of the attachments\n\t\t\tlet totalAttachmentSize = 0\n\t\t\tfor (const attachment of attachments) {\n\t\t\t\ttotalAttachmentSize += Number(attachment.size)\n\t\t\t}\n\n\t\t\treturn [\n\t\t\t\tm(\".flex.mt-s.mb-s\" + \".\" + responsiveCardHMargin(), liveDataAttrs(), [\n\t\t\t\t\tattachmentCount === 1\n\t\t\t\t\t\t? // If we have exactly one attachment, just show the attachment\n\t\t\t\t\t\t  this.renderAttachmentContainer(viewModel, attachments, importFile)\n\t\t\t\t\t\t: // Otherwise, we show the number of attachments and its total size along with a show all button\n\t\t\t\t\t\t  m(ExpanderButton, {\n\t\t\t\t\t\t\t\tlabel: lang.makeTranslation(\n\t\t\t\t\t\t\t\t\t\"attachmentAmount_label\",\n\t\t\t\t\t\t\t\t\tlang.get(\"attachmentAmount_label\", { \"{amount}\": attachmentCount + \"\" }) + ` (${formatStorageSize(totalAttachmentSize)})`,\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\"padding-top\": \"inherit\",\n\t\t\t\t\t\t\t\t\theight: \"inherit\",\n\t\t\t\t\t\t\t\t\t\"min-height\": \"inherit\",\n\t\t\t\t\t\t\t\t\t\"text-decoration\": \"none\",\n\t\t\t\t\t\t\t\t\t\"font-weight\": \"normal\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\texpanded: this.filesExpanded,\n\t\t\t\t\t\t\t\tcolor: theme.content_fg,\n\t\t\t\t\t\t\t\tisBig: true,\n\t\t\t\t\t\t\t\tisUnformattedLabel: true,\n\t\t\t\t\t\t\t\tonExpandedChange: (change) => {\n\t\t\t\t\t\t\t\t\tthis.filesExpanded = change\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t  }),\n\t\t\t\t]),\n\n\t\t\t\t// if we have more than one attachment, list them here in this expander panel\n\t\t\t\tattachments.length > 1\n\t\t\t\t\t? m(\n\t\t\t\t\t\t\tExpanderPanel,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\texpanded: this.filesExpanded,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tm(\".flex.col.\" + responsiveCardHMargin(), [\n\t\t\t\t\t\t\t\tm(\".flex.flex-wrap.gap-hpad\", this.renderAttachmentContainer(viewModel, attachments, importFile)),\n\t\t\t\t\t\t\t\tisIOSApp()\n\t\t\t\t\t\t\t\t\t? null\n\t\t\t\t\t\t\t\t\t: m(\n\t\t\t\t\t\t\t\t\t\t\t\".flex\",\n\t\t\t\t\t\t\t\t\t\t\tm(Button, {\n\t\t\t\t\t\t\t\t\t\t\t\tlabel: \"saveAll_action\",\n\t\t\t\t\t\t\t\t\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t\t\t\t\t\t\t\t\t\tclick: () => viewModel.downloadAll(),\n\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t  ),\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t  )\n\t\t\t\t\t: null,\n\t\t\t]\n\t\t}\n\t}\n\n\tprivate renderAttachmentContainer(viewModel: MailViewerViewModel, attachments: TutanotaFile[], importFile: (file: TutanotaFile) => void): Children {\n\t\treturn attachments.map((attachment) => {\n\t\t\tconst attachmentType = getAttachmentType(attachment.mimeType ?? \"\")\n\t\t\treturn m(AttachmentBubble, {\n\t\t\t\tattachment,\n\t\t\t\tremove: null,\n\t\t\t\tdownload:\n\t\t\t\t\tisAndroidApp() || isDesktop()\n\t\t\t\t\t\t? () => viewModel.downloadAndOpenAttachment(attachment, false)\n\t\t\t\t\t\t: () => viewModel.downloadAndOpenAttachment(attachment, true),\n\t\t\t\topen: isAndroidApp() || isDesktop() ? () => viewModel.downloadAndOpenAttachment(attachment, true) : null,\n\t\t\t\tfileImport: viewModel.canImportFile(attachment) ? () => importFile(attachment) : null,\n\t\t\t\ttype: attachmentType,\n\t\t\t})\n\t\t})\n\t}\n\n\tprivate tutaoBadge(viewModel: MailViewerViewModel): Children {\n\t\treturn isTutanotaTeamMail(viewModel.mail)\n\t\t\t? m(\n\t\t\t\t\tBadge,\n\t\t\t\t\t{\n\t\t\t\t\t\tclasses: \".mr-s\",\n\t\t\t\t\t},\n\t\t\t\t\tcompanyTeamLabel,\n\t\t\t  )\n\t\t\t: null\n\t}\n\n\tprivate renderPhishingWarning(viewModel: MailViewerViewModel): Children | null {\n\t\tif (viewModel.isMailSuspicious()) {\n\t\t\treturn m(InfoBanner, {\n\t\t\t\tmessage: \"phishingMessageBody_msg\",\n\t\t\t\ticon: Icons.Warning,\n\t\t\t\ttype: BannerType.Warning,\n\t\t\t\thelpLink: canSeeTutaLinks(viewModel.logins) ? InfoLink.Phishing : null,\n\t\t\t\tbuttons: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: \"markAsNotPhishing_action\",\n\t\t\t\t\t\tclick: () => viewModel.markAsNotPhishing().then(() => m.redraw()),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t})\n\t\t}\n\t}\n\n\tprivate renderHardAuthenticationFailWarning(viewModel: MailViewerViewModel): Children | null {\n\t\tconst authFailed =\n\t\t\tviewModel.checkMailAuthenticationStatus(MailAuthenticationStatus.HARD_FAIL) ||\n\t\t\tviewModel.mail.encryptionAuthStatus === EncryptionAuthStatus.TUTACRYPT_AUTHENTICATION_FAILED\n\n\t\tif (authFailed) {\n\t\t\treturn m(InfoBanner, {\n\t\t\t\tmessage: \"mailAuthFailed_msg\",\n\t\t\t\ticon: Icons.Warning,\n\t\t\t\thelpLink: canSeeTutaLinks(viewModel.logins) ? InfoLink.MailAuth : null,\n\t\t\t\ttype: BannerType.Warning,\n\t\t\t\tbuttons: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: \"close_alt\",\n\t\t\t\t\t\tclick: () => viewModel.setWarningDismissed(true),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t})\n\t\t}\n\t}\n\n\tprivate renderSoftAuthenticationFailWarning(viewModel: MailViewerViewModel): Children | null {\n\t\tconst buttons: ReadonlyArray<BannerButtonAttrs | null> = [\n\t\t\t{\n\t\t\t\tlabel: \"close_alt\",\n\t\t\t\tclick: () => viewModel.setWarningDismissed(true),\n\t\t\t},\n\t\t]\n\t\tif (viewModel.mail.encryptionAuthStatus === EncryptionAuthStatus.RSA_DESPITE_TUTACRYPT) {\n\t\t\treturn m(InfoBanner, {\n\t\t\t\tmessage: () => lang.get(\"deprecatedKeyWarning_msg\"),\n\t\t\t\ticon: Icons.Warning,\n\t\t\t\thelpLink: canSeeTutaLinks(viewModel.logins) ? InfoLink.DeprecatedKey : null,\n\t\t\t\tbuttons: buttons,\n\t\t\t})\n\t\t} else if (viewModel.checkMailAuthenticationStatus(MailAuthenticationStatus.SOFT_FAIL)) {\n\t\t\treturn m(InfoBanner, {\n\t\t\t\tmessage: () =>\n\t\t\t\t\tviewModel.mail.differentEnvelopeSender\n\t\t\t\t\t\t? lang.get(\"mailAuthMissingWithTechnicalSender_msg\", {\n\t\t\t\t\t\t\t\t\"{sender}\": viewModel.mail.differentEnvelopeSender,\n\t\t\t\t\t\t  })\n\t\t\t\t\t\t: lang.get(\"mailAuthMissing_label\"),\n\t\t\t\ticon: Icons.Warning,\n\t\t\t\thelpLink: canSeeTutaLinks(viewModel.logins) ? InfoLink.MailAuth : null,\n\t\t\t\tbuttons: buttons,\n\t\t\t})\n\t\t} else {\n\t\t\treturn null\n\t\t}\n\t}\n\n\tprivate renderExternalContentBanner(attrs: MailViewerHeaderAttrs): Children | null {\n\t\t// only show banner when there are blocked images and the user hasn't made a decision about how to handle them\n\t\tif (attrs.viewModel.getContentBlockingStatus() !== ContentBlockingStatus.Block) {\n\t\t\treturn null\n\t\t}\n\n\t\tconst showButton: BannerButtonAttrs = {\n\t\t\tlabel: \"showBlockedContent_action\",\n\t\t\tclick: () => attrs.viewModel.setContentBlockingStatus(ContentBlockingStatus.Show),\n\t\t}\n\t\tconst alwaysOrNeverAllowButtons = attrs.viewModel.canPersistBlockingStatus()\n\t\t\t? [\n\t\t\t\t\tattrs.viewModel.checkMailAuthenticationStatus(MailAuthenticationStatus.AUTHENTICATED)\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tlabel: \"allowExternalContentSender_action\" as const,\n\t\t\t\t\t\t\t\tclick: () => attrs.viewModel.setContentBlockingStatus(ContentBlockingStatus.AlwaysShow),\n\t\t\t\t\t\t  }\n\t\t\t\t\t\t: null,\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: \"blockExternalContentSender_action\" as const,\n\t\t\t\t\t\tclick: () => attrs.viewModel.setContentBlockingStatus(ContentBlockingStatus.AlwaysBlock),\n\t\t\t\t\t},\n\t\t\t  ].filter(isNotNull)\n\t\t\t: []\n\t\t// on narrow screens the buttons will end up on 2 lines if there are too many, this looks bad.\n\t\tconst maybeDropdownButtons: ReadonlyArray<BannerButtonAttrs> =\n\t\t\tstyles.isSingleColumnLayout() && alwaysOrNeverAllowButtons.length > 1\n\t\t\t\t? [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: \"more_label\",\n\t\t\t\t\t\t\tclick: createAsyncDropdown({\n\t\t\t\t\t\t\t\twidth: 216,\n\t\t\t\t\t\t\t\tlazyButtons: async () => resolveMaybeLazy(alwaysOrNeverAllowButtons),\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t  ]\n\t\t\t\t: alwaysOrNeverAllowButtons\n\t\treturn m(InfoBanner, {\n\t\t\tmessage: \"contentBlocked_msg\",\n\t\t\ticon: Icons.Picture,\n\t\t\thelpLink: canSeeTutaLinks(attrs.viewModel.logins) ? InfoLink.LoadImages : null,\n\t\t\tbuttons: [showButton, ...maybeDropdownButtons],\n\t\t})\n\t}\n\n\tprivate moreButton(attrs: MailViewerHeaderAttrs): Children {\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"more_label\",\n\t\t\ticon: Icons.More,\n\t\t\tclick: this.prepareMoreActions(attrs),\n\t\t})\n\t}\n\n\tprivate prepareMoreActions({ viewModel }: MailViewerHeaderAttrs) {\n\t\treturn createDropdown({\n\t\t\tlazyButtons: () => {\n\t\t\t\tlet actionButtons: DropdownButtonAttrs[] = []\n\t\t\t\tif (viewModel.isDraftMail()) {\n\t\t\t\t\tactionButtons.push({\n\t\t\t\t\t\tlabel: \"edit_action\",\n\t\t\t\t\t\tclick: () => editDraft(viewModel),\n\t\t\t\t\t\ticon: Icons.Edit,\n\t\t\t\t\t})\n\t\t\t\t\tactionButtons.push({\n\t\t\t\t\t\tlabel: \"move_action\",\n\t\t\t\t\t\tclick: (_: MouseEvent, dom: HTMLElement) =>\n\t\t\t\t\t\t\tshowMoveMailsDropdown(viewModel.mailboxModel, viewModel.mailModel, dom.getBoundingClientRect(), [viewModel.mail]),\n\t\t\t\t\t\ticon: Icons.Folder,\n\t\t\t\t\t})\n\t\t\t\t\tactionButtons.push({\n\t\t\t\t\t\tlabel: \"delete_action\",\n\t\t\t\t\t\tclick: () => promptAndDeleteMails(viewModel.mailModel, [viewModel.mail], noOp),\n\t\t\t\t\t\ticon: Icons.Trash,\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tif (viewModel.canForwardOrMove()) {\n\t\t\t\t\t\tactionButtons.push({\n\t\t\t\t\t\t\tlabel: \"reply_action\",\n\t\t\t\t\t\t\tclick: () => viewModel.reply(false),\n\t\t\t\t\t\t\ticon: Icons.Reply,\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\tif (viewModel.canReplyAll()) {\n\t\t\t\t\t\t\tactionButtons.push({\n\t\t\t\t\t\t\t\tlabel: \"replyAll_action\",\n\t\t\t\t\t\t\t\tclick: () => viewModel.reply(true),\n\t\t\t\t\t\t\t\ticon: Icons.ReplyAll,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tactionButtons.push({\n\t\t\t\t\t\t\tlabel: \"forward_action\",\n\t\t\t\t\t\t\tclick: () => viewModel.forward(),\n\t\t\t\t\t\t\ticon: Icons.Forward,\n\t\t\t\t\t\t})\n\t\t\t\t\t\tactionButtons.push({\n\t\t\t\t\t\t\tlabel: \"move_action\",\n\t\t\t\t\t\t\tclick: (_: MouseEvent, dom: HTMLElement) =>\n\t\t\t\t\t\t\t\tshowMoveMailsDropdown(viewModel.mailboxModel, viewModel.mailModel, dom.getBoundingClientRect(), [viewModel.mail]),\n\t\t\t\t\t\t\ticon: Icons.Folder,\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\tif (viewModel.mailModel.canAssignLabels()) {\n\t\t\t\t\t\tactionButtons.push({\n\t\t\t\t\t\t\tlabel: \"assignLabel_action\",\n\t\t\t\t\t\t\tclick: (_, dom) => {\n\t\t\t\t\t\t\t\tconst popup = new LabelsPopup(\n\t\t\t\t\t\t\t\t\tdom,\n\t\t\t\t\t\t\t\t\tdom.getBoundingClientRect(),\n\t\t\t\t\t\t\t\t\tstyles.isDesktopLayout() ? 300 : 200,\n\t\t\t\t\t\t\t\t\tviewModel.mailModel.getLabelsForMails([viewModel.mail]),\n\t\t\t\t\t\t\t\t\tviewModel.mailModel.getLabelStatesForMails([viewModel.mail]),\n\t\t\t\t\t\t\t\t\t(addedLabels, removedLabels) => viewModel.mailModel.applyLabels([viewModel.mail], addedLabels, removedLabels),\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t// waiting for the dropdown to be closed\n\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\tpopup.show()\n\t\t\t\t\t\t\t\t}, 16)\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ticon: Icons.Label,\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tactionButtons.push({\n\t\t\t\t\t\tlabel: \"delete_action\",\n\t\t\t\t\t\tclick: () => promptAndDeleteMails(viewModel.mailModel, [viewModel.mail], noOp),\n\t\t\t\t\t\ticon: Icons.Trash,\n\t\t\t\t\t})\n\n\t\t\t\t\tactionButtons.push(...mailViewerMoreActions(viewModel))\n\t\t\t\t}\n\n\t\t\t\treturn actionButtons\n\t\t\t},\n\t\t\twidth: 300,\n\t\t})\n\t}\n\n\tgetRecipientEmailAddress({ viewModel }: MailViewerHeaderAttrs) {\n\t\tconst relevantRecipient = viewModel.getRelevantRecipient()\n\n\t\tif (relevantRecipient) {\n\t\t\tconst numberOfAllRecipients = viewModel.getNumberOfRecipients()\n\t\t\treturn m(\n\t\t\t\t\".flex.click.small.ml-between-s.items-center\",\n\t\t\t\t{\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\t// use this to allow the container to shrink, otherwise it doesn't want to cut the recipient address\n\t\t\t\t\t\tminWidth: \"20px\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[\n\t\t\t\t\tm(\"\", lang.get(\"mailViewerRecipients_label\")),\n\t\t\t\t\tm(\".text-ellipsis\", relevantRecipient.address),\n\t\t\t\t\tm(\".flex.no-wrap\", [\n\t\t\t\t\t\tnumberOfAllRecipients > 1 ? `+ ${numberOfAllRecipients - 1}` : null,\n\t\t\t\t\t\tm(Icon, {\n\t\t\t\t\t\t\ticon: BootIcons.Expand,\n\t\t\t\t\t\t\tcontainer: \"div\",\n\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\tfill: theme.content_fg,\n\t\t\t\t\t\t\t\ttransform: this.detailsExpanded ? \"rotate(180deg)\" : \"\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t],\n\t\t\t)\n\t\t} else {\n\t\t\treturn \"\"\n\t\t}\n\t}\n}\n"]}