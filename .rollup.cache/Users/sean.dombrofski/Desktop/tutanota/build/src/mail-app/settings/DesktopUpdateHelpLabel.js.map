{"version":3,"file":"DesktopUpdateHelpLabel.js","sourceRoot":"","sources":["../../../../src/mail-app/settings/DesktopUpdateHelpLabel.ts"],"names":[],"mappings":"AAAA,OAAO,CAA6B,MAAM,SAAS,CAAA;AACnD,OAAO,EAAE,IAAI,EAAE,MAAM,4BAA4B,CAAA;AACjD,OAAO,EAAE,IAAI,EAAE,MAAM,qCAAqC,CAAA;AAE1D,OAAO,EAAE,KAAK,EAAE,MAAM,uBAAuB,CAAA;AAQ7C,MAAM,OAAO,sBAAsB;IAC1B,QAAQ,GAAY,KAAK,CAAA;IACzB,MAAM,GAAY,KAAK,CAAA;IAE/B,aAAa,CAAC,EAAE,eAAe,EAAE,YAAY,EAAwB;QACpE,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,MAAM;YAAE,OAAO,IAAI,CAAA;QAE7C,MAAM,OAAO,GAAG,KAAK,IAAI,EAAE;YAC1B,IAAI,eAAe,EAAE,EAAE,CAAC;gBACvB,iCAAiC;gBACjC,YAAY,EAAE,CAAA;YACf,CAAC;iBAAM,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;gBAC3B,yFAAyF;gBACzF,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAA;gBACpB,MAAM,CAAC,SAAS,CAAC,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC;oBACrC,YAAY,EAAE,EAAE,wCAAwC;oBACxD,+CAA+C;oBAC/C,KAAK,CAAC,GAAG,CAAC;iBACV,CAAC,CAAA;gBACF,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAA;gBACrB,eAAe,CAAC,SAAS,CAAC,CAAA;gBAC1B,CAAC,CAAC,MAAM,EAAE,CAAA;YACX,CAAC;QACF,CAAC,CAAA;QAED,OAAO,CAAC,CACP,sBAAsB,EACtB,CAAC,CACA,kBAAkB,EAClB;YACC,IAAI,EAAE,QAAQ;YACd,IAAI,EAAE,GAAG;YACT,QAAQ,EAAE,GAAG;YACb,IAAI,EAAE,QAAQ;YACd,OAAO;SACP,EACD,IAAI,CAAC,GAAG,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC,mBAAmB,CAAC,CACvE,CACD,CAAA;IACF,CAAC;IAED,QAAQ,CAAC,eAAgC;QACxC,IAAI,GAAG,GAAG,EAAE,CAAA;QAEZ,IAAI,eAAe,EAAE,EAAE,CAAC;YACvB,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAA;QACpC,CAAC;aAAM,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;YACxB,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAA;QACzC,CAAC;aAAM,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;YAC1B,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,0BAA0B,CAAC,CAAA;QAC3C,CAAC;aAAM,CAAC;YACP,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAA;QACxC,CAAC;QAED,OAAO,CAAC,CAAC,WAAW,EAAE,GAAG,GAAG,GAAG,CAAC,CAAA;IACjC,CAAC;IAED,OAAO;QACN,OAAO,IAAI,CAAC,QAAQ,IAAI,CAAC,IAAI,CAAC,MAAM;YACnC,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE;gBACR,IAAI,qCAAoB;gBACxB,KAAK,EAAE,2DAA2D;aACjE,CAAC;YACJ,CAAC,CAAC,IAAI,CAAA;IACR,CAAC;IAED,IAAI,CAAC,KAAkC;QACtC,OAAO,CAAC,CAAC,oBAAoB,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,eAAe,CAAC,EAAE,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CAAA;IAC9H,CAAC;CACD","sourcesContent":["import m, { Child, Children, Vnode } from \"mithril\"\nimport { Icon } from \"../../common/gui/base/Icon\"\nimport { lang } from \"../../common/misc/LanguageViewModel\"\nimport { BootIcons } from \"../../common/gui/base/icons/BootIcons\"\nimport { delay } from \"@tutao/tutanota-utils\"\nimport Stream from \"mithril/stream\"\n\nexport type UpdateHelpLabelAttrs = {\n\tupdateAvailable: Stream<boolean>\n\tmanualUpdate(): Promise<boolean>\n}\n\nexport class DesktopUpdateHelpLabel {\n\tprivate _waiting: boolean = false\n\tprivate _error: boolean = false\n\n\tgetActionLink({ updateAvailable, manualUpdate }: UpdateHelpLabelAttrs): Child {\n\t\tif (this._waiting || this._error) return null\n\n\t\tconst onclick = async () => {\n\t\t\tif (updateAvailable()) {\n\t\t\t\t// install now (restarts the app)\n\t\t\t\tmanualUpdate()\n\t\t\t} else if (!this._waiting) {\n\t\t\t\t// no update available & not currently waiting for check result -> check for update again\n\t\t\t\tthis._waiting = true\n\t\t\t\tconst [hasUpdate] = await Promise.all([\n\t\t\t\t\tmanualUpdate(), // make sure there's at least some delay\n\t\t\t\t\t// instant response tends to make users nervous\n\t\t\t\t\tdelay(500),\n\t\t\t\t])\n\t\t\t\tthis._waiting = false\n\t\t\t\tupdateAvailable(hasUpdate)\n\t\t\t\tm.redraw()\n\t\t\t}\n\t\t}\n\n\t\treturn m(\n\t\t\t\"span.text-break.pr-s\",\n\t\t\tm(\n\t\t\t\t\"button.underline\",\n\t\t\t\t{\n\t\t\t\t\ttype: \"button\",\n\t\t\t\t\thref: \"#\",\n\t\t\t\t\ttabindex: \"0\",\n\t\t\t\t\trole: \"button\",\n\t\t\t\t\tonclick,\n\t\t\t\t},\n\t\t\t\tlang.get(updateAvailable() ? \"installNow_action\" : \"checkAgain_action\"),\n\t\t\t),\n\t\t)\n\t}\n\n\tgetLabel(updateAvailable: Stream<boolean>): Child {\n\t\tlet ret = \"\"\n\n\t\tif (updateAvailable()) {\n\t\t\tret = lang.get(\"updateFound_label\")\n\t\t} else if (this._error) {\n\t\t\tret = lang.get(\"serviceUnavailable_msg\")\n\t\t} else if (this._waiting) {\n\t\t\tret = lang.get(\"checkingForUpdate_action\")\n\t\t} else {\n\t\t\tret = lang.get(\"noUpdateAvailable_msg\")\n\t\t}\n\n\t\treturn m(\"span.pr-s\", ret + \" \")\n\t}\n\n\tgetIcon(): Child {\n\t\treturn this._waiting && !this._error\n\t\t\t? m(Icon, {\n\t\t\t\t\ticon: BootIcons.Progress,\n\t\t\t\t\tclass: \"flex-center items-center icon-progress-tiny icon-progress\",\n\t\t\t  })\n\t\t\t: null\n\t}\n\n\tview(vnode: Vnode<UpdateHelpLabelAttrs>): Children {\n\t\treturn m(\".flex.items-center\", [this.getLabel(vnode.attrs.updateAvailable), this.getActionLink(vnode.attrs), this.getIcon()])\n\t}\n}\n"]}