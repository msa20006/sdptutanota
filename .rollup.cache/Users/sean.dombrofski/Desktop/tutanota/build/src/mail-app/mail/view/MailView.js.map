{"version":3,"file":"MailView.js","sourceRoot":"","sources":["../../../../../src/mail-app/mail/view/MailView.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Vnode } from \"mithril\"\nimport { ViewSlider } from \"../../../common/gui/nav/ViewSlider.js\"\nimport { ColumnType, ViewColumn } from \"../../../common/gui/base/ViewColumn\"\nimport { lang } from \"../../../common/misc/LanguageViewModel\"\nimport { Dialog } from \"../../../common/gui/base/Dialog\"\nimport { FeatureType, getMailFolderType, Keys, MailSetKind } from \"../../../common/api/common/TutanotaConstants\"\nimport { AppHeaderAttrs, Header } from \"../../../common/gui/Header.js\"\nimport { Mail, MailBox, MailFolder } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport { isEmpty, noOp, ofClass } from \"@tutao/tutanota-utils\"\nimport { MailListView } from \"./MailListView\"\nimport { assertMainOrNode, isApp } from \"../../../common/api/common/Env\"\nimport type { Shortcut } from \"../../../common/misc/KeyManager\"\nimport { keyManager } from \"../../../common/misc/KeyManager\"\nimport { getMailSelectionMessage, MultiItemViewer } from \"./MultiItemViewer.js\"\nimport { Icons } from \"../../../common/gui/base/icons/Icons\"\nimport { showProgressDialog } from \"../../../common/gui/dialogs/ProgressDialog\"\nimport type { MailboxDetail } from \"../../../common/mailFunctionality/MailboxModel.js\"\nimport { locator } from \"../../../common/api/main/CommonLocator\"\nimport { PermissionError } from \"../../../common/api/common/error/PermissionError\"\nimport { styles } from \"../../../common/gui/styles\"\nimport { px, size } from \"../../../common/gui/size\"\nimport { archiveMails, getConversationTitle, getMoveMailBounds, moveMails, moveToInbox, promptAndDeleteMails, showMoveMailsDropdown } from \"./MailGuiUtils\"\nimport { getElementId, isSameId } from \"../../../common/api/common/utils/EntityUtils\"\nimport { isNewMailActionAvailable } from \"../../../common/gui/nav/NavFunctions\"\nimport { CancelledError } from \"../../../common/api/common/error/CancelledError\"\nimport Stream from \"mithril/stream\"\nimport { readLocalFiles } from \"../../../common/file/FileController.js\"\nimport { MobileMailActionBar } from \"./MobileMailActionBar.js\"\nimport { deviceConfig } from \"../../../common/misc/DeviceConfig.js\"\nimport { DrawerMenuAttrs } from \"../../../common/gui/nav/DrawerMenu.js\"\nimport { BaseTopLevelView } from \"../../../common/gui/BaseTopLevelView.js\"\nimport { showEditFolderDialog } from \"./EditFolderDialog.js\"\nimport { MailFoldersView } from \"./MailFoldersView.js\"\nimport { FolderColumnView } from \"../../../common/gui/FolderColumnView.js\"\nimport { SidebarSection } from \"../../../common/gui/SidebarSection.js\"\nimport { EditFoldersDialog } from \"./EditFoldersDialog.js\"\nimport { TopLevelAttrs, TopLevelView } from \"../../../TopLevelView.js\"\nimport { ConversationViewModel } from \"./ConversationViewModel.js\"\nimport { conversationCardMargin, ConversationViewer } from \"./ConversationViewer.js\"\nimport { IconButton } from \"../../../common/gui/base/IconButton.js\"\nimport { BackgroundColumnLayout } from \"../../../common/gui/BackgroundColumnLayout.js\"\nimport { MailViewerActions } from \"./MailViewerToolbar.js\"\nimport { theme } from \"../../../common/gui/theme.js\"\nimport { MobileMailMultiselectionActionBar } from \"./MobileMailMultiselectionActionBar.js\"\nimport { SelectAllCheckbox } from \"../../../common/gui/SelectAllCheckbox.js\"\nimport { DesktopListToolbar, DesktopViewerToolbar } from \"../../../common/gui/DesktopToolbars.js\"\nimport { MobileHeader } from \"../../../common/gui/MobileHeader.js\"\nimport { LazySearchBar } from \"../../LazySearchBar.js\"\nimport { MultiselectMobileHeader } from \"../../../common/gui/MultiselectMobileHeader.js\"\nimport { MailViewModel } from \"./MailViewModel.js\"\nimport { selectionAttrsForList } from \"../../../common/misc/ListModel.js\"\nimport { ListLoadingState, MultiselectMode } from \"../../../common/gui/base/List.js\"\nimport { EnterMultiselectIconButton } from \"../../../common/gui/EnterMultiselectIconButton.js\"\nimport { MailFilterButton } from \"./MailFilterButton.js\"\nimport { listSelectionKeyboardShortcuts } from \"../../../common/gui/base/ListUtils.js\"\nimport { getMailboxName } from \"../../../common/mailFunctionality/SharedMailUtils.js\"\nimport { BottomNav } from \"../../gui/BottomNav.js\"\nimport { mailLocator } from \"../../mailLocator.js\"\nimport { showSnackBar } from \"../../../common/gui/base/SnackBar.js\"\nimport { getFolderName } from \"../model/MailUtils.js\"\nimport { canDoDragAndDropExport } from \"./MailViewerUtils.js\"\nimport { isSpamOrTrashFolder } from \"../model/MailChecks.js\"\nimport { showEditLabelDialog } from \"./EditLabelDialog\"\nimport { SidebarSectionRow } from \"../../../common/gui/base/SidebarSectionRow\"\nimport { attachDropdown } from \"../../../common/gui/base/Dropdown\"\nimport { ButtonSize } from \"../../../common/gui/base/ButtonSize\"\nimport { RowButton } from \"../../../common/gui/base/buttons/RowButton\"\nimport { getLabelColor } from \"../../../common/gui/base/Label.js\"\nimport { MAIL_PREFIX } from \"../../../common/misc/RouteChange\"\nimport { DropType, FileDropData, MailDropData } from \"../../../common/gui/base/GuiUtils\"\nimport { MailImporter } from \"../import/MailImporter.js\"\nimport { fileListToArray } from \"../../../common/api/common/utils/FileUtils.js\"\nimport { LabelsPopup } from \"./LabelsPopup\"\n\nassertMainOrNode()\n\n/** State persisted between re-creations. */\nexport interface MailViewCache {\n\t/** The preference for if conversation view was used, so we can reset if it was changed */\n\tconversationViewPreference: boolean | null\n}\n\nexport interface MailViewAttrs extends TopLevelAttrs {\n\tdrawerAttrs: DrawerMenuAttrs\n\tcache: MailViewCache\n\theader: AppHeaderAttrs\n\tmailViewModel: MailViewModel\n}\n\n/**\n * Top-level view for displaying mailboxes.\n */\nexport class MailView extends BaseTopLevelView implements TopLevelView<MailViewAttrs> {\n\tprivate readonly listColumn: ViewColumn\n\tprivate readonly folderColumn: ViewColumn\n\tprivate readonly mailColumn: ViewColumn\n\tprivate readonly viewSlider: ViewSlider\n\tcache: MailViewCache\n\treadonly oncreate: TopLevelView[\"oncreate\"]\n\treadonly onremove: TopLevelView[\"onremove\"]\n\n\tprivate countersStream: Stream<unknown> | null = null\n\n\tprivate readonly expandedState: Set<Id>\n\tprivate readonly mailViewModel: MailViewModel\n\n\tget conversationViewModel(): ConversationViewModel | null {\n\t\treturn this.mailViewModel.getConversationViewModel()\n\t}\n\n\tconstructor(vnode: Vnode<MailViewAttrs>) {\n\t\tsuper()\n\t\tthis.expandedState = new Set(deviceConfig.getExpandedFolders(locator.logins.getUserController().userId))\n\t\tthis.cache = vnode.attrs.cache\n\t\tthis.folderColumn = this.createFolderColumn(null, vnode.attrs.drawerAttrs)\n\t\tthis.mailViewModel = vnode.attrs.mailViewModel\n\n\t\tthis.listColumn = new ViewColumn(\n\t\t\t{\n\t\t\t\tview: () => {\n\t\t\t\t\tconst folder = this.mailViewModel.getFolder()\n\t\t\t\t\treturn m(BackgroundColumnLayout, {\n\t\t\t\t\t\tbackgroundColor: theme.navigation_bg,\n\t\t\t\t\t\tdesktopToolbar: () => m(DesktopListToolbar, m(SelectAllCheckbox, selectionAttrsForList(this.mailViewModel)), this.renderFilterButton()),\n\t\t\t\t\t\tcolumnLayout: folder\n\t\t\t\t\t\t\t? m(\n\t\t\t\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t\tmarginBottom: px(conversationCardMargin),\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tm(MailListView, {\n\t\t\t\t\t\t\t\t\t\tkey: getElementId(folder),\n\t\t\t\t\t\t\t\t\t\tmailViewModel: this.mailViewModel,\n\t\t\t\t\t\t\t\t\t\tonSingleSelection: (mail) => {\n\t\t\t\t\t\t\t\t\t\t\tthis.mailViewModel.onSingleSelection(mail)\n\t\t\t\t\t\t\t\t\t\t\tif (!this.mailViewModel.listModel?.isInMultiselect()) {\n\t\t\t\t\t\t\t\t\t\t\t\tthis.viewSlider.focus(this.mailColumn)\n\n\t\t\t\t\t\t\t\t\t\t\t\t// Make sure that we mark mail as read if you select the mail again, even if it was selected before.\n\t\t\t\t\t\t\t\t\t\t\t\t// Do it in the next even loop to not rely on what is called first, listModel or us. ListModel changes are\n\t\t\t\t\t\t\t\t\t\t\t\t// sync so this should be enough.\n\t\t\t\t\t\t\t\t\t\t\t\tPromise.resolve().then(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst conversationViewModel = this.mailViewModel.getConversationViewModel()\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (conversationViewModel && isSameId(mail._id, conversationViewModel.primaryMail._id)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconversationViewModel?.primaryViewModel().setUnread(false)\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tonSingleInclusiveSelection: (...args) => {\n\t\t\t\t\t\t\t\t\t\t\tthis.mailViewModel?.onSingleInclusiveSelection(...args)\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tonRangeSelectionTowards: (...args) => {\n\t\t\t\t\t\t\t\t\t\t\tthis.mailViewModel.onRangeSelectionTowards(...args)\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tonSingleExclusiveSelection: (...args) => {\n\t\t\t\t\t\t\t\t\t\t\tthis.mailViewModel.onSingleExclusiveSelection(...args)\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tonClearFolder: async () => {\n\t\t\t\t\t\t\t\t\t\t\tconst folder = this.mailViewModel.getFolder()\n\t\t\t\t\t\t\t\t\t\t\tif (folder == null) {\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.warn(\"Cannot delete folder, no folder is selected\")\n\t\t\t\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tconst confirmed = await Dialog.confirm(\n\t\t\t\t\t\t\t\t\t\t\t\tlang.getTranslation(\"confirmDeleteFinallySystemFolder_msg\", { \"{1}\": getFolderName(folder) }),\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\tif (confirmed) {\n\t\t\t\t\t\t\t\t\t\t\t\tshowProgressDialog(\"progressDeleting_msg\", this.mailViewModel.finallyDeleteAllMailsInSelectedFolder(folder))\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t  )\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tmobileHeader: () =>\n\t\t\t\t\t\t\tthis.mailViewModel.listModel?.isInMultiselect()\n\t\t\t\t\t\t\t\t? m(MultiselectMobileHeader, {\n\t\t\t\t\t\t\t\t\t\t...selectionAttrsForList(this.mailViewModel.listModel),\n\t\t\t\t\t\t\t\t\t\tmessage: getMailSelectionMessage(this.mailViewModel.listModel.getSelectedAsArray()),\n\t\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t\t: m(MobileHeader, {\n\t\t\t\t\t\t\t\t\t\t...vnode.attrs.header,\n\t\t\t\t\t\t\t\t\t\ttitle: this.listColumn.getTitle(),\n\t\t\t\t\t\t\t\t\t\tcolumnType: \"first\",\n\t\t\t\t\t\t\t\t\t\tactions: [\n\t\t\t\t\t\t\t\t\t\t\tthis.renderFilterButton(),\n\t\t\t\t\t\t\t\t\t\t\tm(EnterMultiselectIconButton, {\n\t\t\t\t\t\t\t\t\t\t\t\tclickAction: () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.mailViewModel.listModel?.enterMultiselect()\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\tprimaryAction: () => this.renderHeaderRightView(),\n\t\t\t\t\t\t\t\t\t\tbackAction: () => this.viewSlider.focusPreviousColumn(),\n\t\t\t\t\t\t\t\t  }),\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t},\n\t\t\tColumnType.Background,\n\t\t\t{\n\t\t\t\tminWidth: size.second_col_min_width,\n\t\t\t\tmaxWidth: size.second_col_max_width,\n\t\t\t\theaderCenter: () => {\n\t\t\t\t\tconst folder = this.mailViewModel.getFolder()\n\t\t\t\t\treturn folder ? lang.makeTranslation(\"folder_name\", getFolderName(folder)) : \"emptyString_msg\"\n\t\t\t\t},\n\t\t\t},\n\t\t)\n\n\t\tthis.mailColumn = new ViewColumn(\n\t\t\t{\n\t\t\t\tview: () => {\n\t\t\t\t\tconst viewModel = this.conversationViewModel\n\t\t\t\t\tif (viewModel) {\n\t\t\t\t\t\treturn this.renderSingleMailViewer(vnode.attrs.header, viewModel)\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn this.renderMultiMailViewer(vnode.attrs.header)\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tColumnType.Background,\n\t\t\t{\n\t\t\t\tminWidth: size.third_col_min_width,\n\t\t\t\tmaxWidth: size.third_col_max_width,\n\t\t\t\tariaLabel: () => lang.get(\"email_label\"),\n\t\t\t},\n\t\t)\n\t\tthis.viewSlider = new ViewSlider([this.folderColumn, this.listColumn, this.mailColumn])\n\t\tthis.viewSlider.focusedColumn = this.listColumn\n\n\t\tconst shortcuts = this.getShortcuts()\n\t\tvnode.attrs.mailViewModel.init()\n\n\t\tthis.oncreate = (vnode) => {\n\t\t\tthis.countersStream = mailLocator.mailModel.mailboxCounters.map(m.redraw)\n\t\t\tkeyManager.registerShortcuts(shortcuts)\n\t\t\tthis.cache.conversationViewPreference = deviceConfig.getConversationViewShowOnlySelectedMail()\n\t\t}\n\n\t\tthis.onremove = () => {\n\t\t\t// cancel the loading if we are destroyed\n\t\t\tthis.mailViewModel.listModel?.cancelLoadAll()\n\n\t\t\tthis.countersStream?.end(true)\n\t\t\tthis.countersStream = null\n\n\t\t\tkeyManager.unregisterShortcuts(shortcuts)\n\t\t}\n\t}\n\n\tprivate renderFilterButton() {\n\t\treturn m(MailFilterButton, {\n\t\t\tfilter: this.mailViewModel.filterType,\n\t\t\tsetFilter: (filter) => this.mailViewModel.setFilter(filter),\n\t\t})\n\t}\n\n\tprivate mailViewerSingleActions(viewModel: ConversationViewModel) {\n\t\treturn m(MailViewerActions, {\n\t\t\tmailboxModel: viewModel.primaryViewModel().mailboxModel,\n\t\t\tmailModel: viewModel.primaryViewModel().mailModel,\n\t\t\tmailViewerViewModel: viewModel.primaryViewModel(),\n\t\t\tmails: [viewModel.primaryMail],\n\t\t})\n\t}\n\n\tprivate renderSingleMailViewer(header: AppHeaderAttrs, viewModel: ConversationViewModel) {\n\t\treturn m(BackgroundColumnLayout, {\n\t\t\tbackgroundColor: theme.navigation_bg,\n\t\t\tdesktopToolbar: () => m(DesktopViewerToolbar, this.mailViewerSingleActions(viewModel)),\n\t\t\tmobileHeader: () =>\n\t\t\t\tm(MobileHeader, {\n\t\t\t\t\t...header,\n\t\t\t\t\tbackAction: () => {\n\t\t\t\t\t\tthis.viewSlider.focusPreviousColumn()\n\t\t\t\t\t},\n\t\t\t\t\tcolumnType: \"other\",\n\t\t\t\t\tactions: null,\n\t\t\t\t\tmulticolumnActions: () => this.mailViewerSingleActions(viewModel),\n\t\t\t\t\tprimaryAction: () => this.renderHeaderRightView(),\n\t\t\t\t\ttitle: getConversationTitle(viewModel),\n\t\t\t\t}),\n\t\t\tcolumnLayout: m(ConversationViewer, {\n\t\t\t\t// Re-create the whole viewer and its vnode tree if email has changed\n\t\t\t\tkey: getElementId(viewModel.primaryMail),\n\t\t\t\tviewModel: viewModel,\n\t\t\t\t// this assumes that the viewSlider focus animation is already started\n\t\t\t\tdelayBodyRendering: this.viewSlider.waitForAnimation(),\n\t\t\t}),\n\t\t})\n\t}\n\n\tprivate mailViewerMultiActions() {\n\t\treturn m(MailViewerActions, {\n\t\t\tmailboxModel: locator.mailboxModel,\n\t\t\tmailModel: mailLocator.mailModel,\n\t\t\tmails: this.mailViewModel.listModel?.getSelectedAsArray() ?? [],\n\t\t\tselectNone: () => this.mailViewModel.listModel?.selectNone(),\n\t\t})\n\t}\n\n\tprivate renderMultiMailViewer(header: AppHeaderAttrs) {\n\t\treturn m(BackgroundColumnLayout, {\n\t\t\tbackgroundColor: theme.navigation_bg,\n\t\t\tdesktopToolbar: () => m(DesktopViewerToolbar, this.mailViewerMultiActions()),\n\t\t\tmobileHeader: () =>\n\t\t\t\tm(MobileHeader, {\n\t\t\t\t\tactions: this.mailViewerMultiActions(),\n\t\t\t\t\tprimaryAction: () => this.renderHeaderRightView(),\n\t\t\t\t\tbackAction: () => this.viewSlider.focusPreviousColumn(),\n\t\t\t\t\t...header,\n\t\t\t\t\tcolumnType: \"other\",\n\t\t\t\t}),\n\t\t\tcolumnLayout: m(MultiItemViewer, {\n\t\t\t\tselectedEntities: this.mailViewModel.listModel?.getSelectedAsArray() ?? [],\n\t\t\t\tselectNone: () => {\n\t\t\t\t\tthis.mailViewModel.listModel?.selectNone()\n\t\t\t\t},\n\t\t\t\tloadAll: () => this.mailViewModel.listModel?.loadAll(),\n\t\t\t\tstopLoadAll: () => this.mailViewModel.listModel?.cancelLoadAll(),\n\t\t\t\tloadingAll: this.mailViewModel.listModel?.isLoadingAll()\n\t\t\t\t\t? \"loading\"\n\t\t\t\t\t: this.mailViewModel.listModel?.loadingStatus === ListLoadingState.Done\n\t\t\t\t\t? \"loaded\"\n\t\t\t\t\t: \"can_load\",\n\t\t\t\tgetSelectionMessage: (selected: ReadonlyArray<Mail>) => getMailSelectionMessage(selected),\n\t\t\t}),\n\t\t})\n\t}\n\n\tview({ attrs }: Vnode<MailViewAttrs>): Children {\n\t\treturn m(\n\t\t\t\"#mail.main-view\",\n\t\t\t{\n\t\t\t\tondragover: (ev: DragEvent) => {\n\t\t\t\t\t// do not check the data transfer here because it is not always filled, e.g. in Safari\n\t\t\t\t\tev.stopPropagation()\n\t\t\t\t\tev.preventDefault()\n\t\t\t\t},\n\t\t\t\tondrop: (ev: DragEvent) => {\n\t\t\t\t\tif (isNewMailActionAvailable() && ev.dataTransfer?.files && ev.dataTransfer.files.length > 0) {\n\t\t\t\t\t\tthis.handleFileDrop({\n\t\t\t\t\t\t\tdropType: DropType.ExternalFile,\n\t\t\t\t\t\t\tfiles: fileListToArray(ev.dataTransfer.files),\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\t// prevent in any case because firefox tries to open\n\t\t\t\t\t// dataTransfer as a URL otherwise.\n\t\t\t\t\tev.stopPropagation()\n\t\t\t\t\tev.preventDefault()\n\t\t\t\t},\n\t\t\t},\n\t\t\tm(this.viewSlider, {\n\t\t\t\theader: m(Header, {\n\t\t\t\t\trightView: this.renderHeaderRightView(),\n\t\t\t\t\tsearchBar: () =>\n\t\t\t\t\t\t// not showing search for external users\n\t\t\t\t\t\tlocator.logins.isInternalUserLoggedIn()\n\t\t\t\t\t\t\t? m(LazySearchBar, {\n\t\t\t\t\t\t\t\t\tplaceholder: lang.get(\"searchEmails_placeholder\"),\n\t\t\t\t\t\t\t\t\tdisabled: !locator.logins.isFullyLoggedIn(),\n\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t...attrs.header,\n\t\t\t\t}),\n\t\t\t\tbottomNav:\n\t\t\t\t\tstyles.isSingleColumnLayout() && this.viewSlider.focusedColumn === this.mailColumn && this.conversationViewModel\n\t\t\t\t\t\t? m(MobileMailActionBar, { viewModel: this.conversationViewModel.primaryViewModel() })\n\t\t\t\t\t\t: styles.isSingleColumnLayout() && this.mailViewModel.listModel?.isInMultiselect()\n\t\t\t\t\t\t? m(MobileMailMultiselectionActionBar, {\n\t\t\t\t\t\t\t\tmails: this.mailViewModel.listModel.getSelectedAsArray(),\n\t\t\t\t\t\t\t\tselectNone: () => this.mailViewModel.listModel?.selectNone(),\n\t\t\t\t\t\t\t\tmailModel: mailLocator.mailModel,\n\t\t\t\t\t\t\t\tmailboxModel: locator.mailboxModel,\n\t\t\t\t\t\t  })\n\t\t\t\t\t\t: m(BottomNav),\n\t\t\t}),\n\t\t)\n\t}\n\n\tgetViewSlider(): ViewSlider | null {\n\t\treturn this.viewSlider\n\t}\n\n\thandleBackButton(): boolean {\n\t\tconst listModel = this.mailViewModel.listModel\n\t\tif (listModel && listModel.isInMultiselect()) {\n\t\t\tlistModel.selectNone()\n\t\t\treturn true\n\t\t} else if (this.viewSlider.isFirstBackgroundColumnFocused()) {\n\t\t\tconst folder = this.mailViewModel.getFolder()\n\t\t\tif (folder == null || getMailFolderType(folder) !== MailSetKind.INBOX) {\n\t\t\t\tthis.mailViewModel.switchToFolder(MailSetKind.INBOX)\n\t\t\t\treturn true\n\t\t\t} else {\n\t\t\t\treturn false\n\t\t\t}\n\t\t} else {\n\t\t\treturn false\n\t\t}\n\t}\n\n\tprivate renderHeaderRightView(): Children {\n\t\treturn isNewMailActionAvailable()\n\t\t\t? [\n\t\t\t\t\tm(IconButton, {\n\t\t\t\t\t\ttitle: \"newMail_action\",\n\t\t\t\t\t\tclick: () => this.showNewMailDialog().catch(ofClass(PermissionError, noOp)),\n\t\t\t\t\t\ticon: Icons.PencilSquare,\n\t\t\t\t\t}),\n\t\t\t  ]\n\t\t\t: null\n\t}\n\n\tprivate getShortcuts(): Array<Shortcut> {\n\t\treturn [\n\t\t\t...listSelectionKeyboardShortcuts(MultiselectMode.Enabled, () => this.mailViewModel),\n\t\t\t{\n\t\t\t\tkey: Keys.N,\n\t\t\t\texec: () => {\n\t\t\t\t\tthis.showNewMailDialog().catch(ofClass(PermissionError, noOp))\n\t\t\t\t},\n\t\t\t\tenabled: () => !!this.mailViewModel.getFolder() && isNewMailActionAvailable(),\n\t\t\t\thelp: \"newMail_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.DELETE,\n\t\t\t\texec: () => {\n\t\t\t\t\tif (this.mailViewModel.listModel) this.deleteMails(this.mailViewModel.listModel.getSelectedAsArray())\n\t\t\t\t},\n\t\t\t\thelp: \"deleteEmails_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.BACKSPACE,\n\t\t\t\texec: () => {\n\t\t\t\t\tif (this.mailViewModel.listModel) this.deleteMails(this.mailViewModel.listModel.getSelectedAsArray())\n\t\t\t\t},\n\t\t\t\thelp: \"deleteEmails_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.A,\n\t\t\t\texec: () => {\n\t\t\t\t\tif (this.mailViewModel.listModel) archiveMails(this.mailViewModel.listModel.getSelectedAsArray())\n\t\t\t\t\treturn true\n\t\t\t\t},\n\t\t\t\thelp: \"archive_action\",\n\t\t\t\tenabled: () => locator.logins.isInternalUserLoggedIn(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.I,\n\t\t\t\texec: () => {\n\t\t\t\t\tif (this.mailViewModel.listModel) moveToInbox(this.mailViewModel.listModel.getSelectedAsArray())\n\t\t\t\t\treturn true\n\t\t\t\t},\n\t\t\t\thelp: \"moveToInbox_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.V,\n\t\t\t\texec: () => {\n\t\t\t\t\tthis.moveMails()\n\t\t\t\t\treturn true\n\t\t\t\t},\n\t\t\t\thelp: \"move_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.L,\n\t\t\t\texec: () => {\n\t\t\t\t\tthis.labels()\n\t\t\t\t\treturn true\n\t\t\t\t},\n\t\t\t\thelp: \"labels_label\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.U,\n\t\t\t\texec: () => {\n\t\t\t\t\tif (this.mailViewModel.listModel) this.toggleUnreadMails(this.mailViewModel.listModel.getSelectedAsArray())\n\t\t\t\t},\n\t\t\t\thelp: \"toggleUnread_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.ONE,\n\t\t\t\texec: () => {\n\t\t\t\t\tthis.mailViewModel.switchToFolder(MailSetKind.INBOX)\n\t\t\t\t\treturn true\n\t\t\t\t},\n\t\t\t\thelp: \"switchInbox_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.TWO,\n\t\t\t\texec: () => {\n\t\t\t\t\tthis.mailViewModel.switchToFolder(MailSetKind.DRAFT)\n\t\t\t\t\treturn true\n\t\t\t\t},\n\t\t\t\thelp: \"switchDrafts_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.THREE,\n\t\t\t\texec: () => {\n\t\t\t\t\tthis.mailViewModel.switchToFolder(MailSetKind.SENT)\n\t\t\t\t\treturn true\n\t\t\t\t},\n\t\t\t\thelp: \"switchSentFolder_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.FOUR,\n\t\t\t\texec: () => {\n\t\t\t\t\tthis.mailViewModel.switchToFolder(MailSetKind.TRASH)\n\t\t\t\t\treturn true\n\t\t\t\t},\n\t\t\t\thelp: \"switchTrash_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.FIVE,\n\t\t\t\texec: () => {\n\t\t\t\t\tthis.mailViewModel.switchToFolder(MailSetKind.ARCHIVE)\n\t\t\t\t\treturn true\n\t\t\t\t},\n\t\t\t\tenabled: () => locator.logins.isInternalUserLoggedIn(),\n\t\t\t\thelp: \"switchArchive_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.SIX,\n\t\t\t\texec: () => {\n\t\t\t\t\tthis.mailViewModel.switchToFolder(MailSetKind.SPAM)\n\t\t\t\t\treturn true\n\t\t\t\t},\n\t\t\t\tenabled: () => locator.logins.isInternalUserLoggedIn() && !locator.logins.isEnabled(FeatureType.InternalCommunication),\n\t\t\t\thelp: \"switchSpam_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.CTRL,\n\t\t\t\texec: () => false,\n\t\t\t\tenabled: canDoDragAndDropExport,\n\t\t\t\thelp: \"dragAndDrop_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.P,\n\t\t\t\texec: () => {\n\t\t\t\t\tthis.pressRelease()\n\t\t\t\t\treturn true\n\t\t\t\t},\n\t\t\t\thelp: \"emptyString_msg\",\n\t\t\t\tenabled: () => locator.logins.isEnabled(FeatureType.Newsletter),\n\t\t\t},\n\t\t]\n\t}\n\n\tprivate async pressRelease() {\n\t\tconst { openPressReleaseEditor } = await import(\"../press/PressReleaseEditor\")\n\t\tconst mailboxDetails = await this.mailViewModel.getMailboxDetails()\n\t\tif (mailboxDetails) {\n\t\t\topenPressReleaseEditor(mailboxDetails)\n\t\t}\n\t}\n\n\tprivate moveMails() {\n\t\tconst mailList = this.mailViewModel.listModel\n\t\tif (mailList == null) {\n\t\t\treturn\n\t\t}\n\n\t\tconst selectedMails = mailList.getSelectedAsArray()\n\n\t\tshowMoveMailsDropdown(locator.mailboxModel, mailLocator.mailModel, getMoveMailBounds(), selectedMails)\n\t}\n\n\t/**\n\t *Shortcut Method to show Labels dropdown only when atleast one mail is selected.\n\t */\n\tprivate labels() {\n\t\tconst mailList = this.mailViewModel.listModel\n\t\tif (mailList == null || !mailLocator.mailModel.canAssignLabels()) {\n\t\t\treturn\n\t\t}\n\t\tconst labels = mailLocator.mailModel.getLabelStatesForMails(mailList.getSelectedAsArray())\n\t\tconst selectedMails = mailList.getSelectedAsArray()\n\n\t\tif (isEmpty(labels) || isEmpty(selectedMails)) {\n\t\t\treturn\n\t\t}\n\n\t\tconst popup = new LabelsPopup(\n\t\t\tdocument.activeElement as HTMLElement,\n\t\t\tgetMoveMailBounds(),\n\t\t\tstyles.isDesktopLayout() ? 300 : 200,\n\t\t\tmailLocator.mailModel.getLabelsForMails(selectedMails),\n\t\t\tmailLocator.mailModel.getLabelStatesForMails(selectedMails),\n\t\t\t(addedLabels, removedLabels) => mailLocator.mailModel.applyLabels(selectedMails, addedLabels, removedLabels),\n\t\t)\n\t\tpopup.show()\n\t}\n\n\tprivate createFolderColumn(editingFolderForMailGroup: Id | null = null, drawerAttrs: DrawerMenuAttrs) {\n\t\treturn new ViewColumn(\n\t\t\t{\n\t\t\t\tview: () => {\n\t\t\t\t\treturn m(FolderColumnView, {\n\t\t\t\t\t\tdrawer: drawerAttrs,\n\t\t\t\t\t\tbutton: editingFolderForMailGroup\n\t\t\t\t\t\t\t? null\n\t\t\t\t\t\t\t: !styles.isUsingBottomNavigation() && isNewMailActionAvailable()\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tlabel: \"newMail_action\",\n\t\t\t\t\t\t\t\t\tclick: () => this.showNewMailDialog().catch(ofClass(PermissionError, noOp)),\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tcontent: this.renderFoldersAndLabels(editingFolderForMailGroup),\n\t\t\t\t\t\tariaLabel: \"folderTitle_label\",\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t},\n\t\t\teditingFolderForMailGroup ? ColumnType.Background : ColumnType.Foreground,\n\t\t\t{\n\t\t\t\tminWidth: size.first_col_min_width,\n\t\t\t\tmaxWidth: size.first_col_max_width,\n\t\t\t\theaderCenter: \"folderTitle_label\",\n\t\t\t},\n\t\t)\n\t}\n\n\tprivate renderFoldersAndLabels(editingFolderForMailGroup: Id | null) {\n\t\tconst details = locator.mailboxModel.mailboxDetails() ?? []\n\t\treturn [\n\t\t\t...details.map((mailboxDetail) => {\n\t\t\t\treturn this.renderFoldersAndLabelsForMailbox(mailboxDetail, editingFolderForMailGroup)\n\t\t\t}),\n\t\t]\n\t}\n\n\tprivate renderFoldersAndLabelsForMailbox(mailboxDetail: MailboxDetail, editingFolderForMailGroup: string | null) {\n\t\tconst inEditMode = editingFolderForMailGroup === mailboxDetail.mailGroup._id\n\t\t// Only show folders for mailbox in which edit was selected\n\t\tif (editingFolderForMailGroup && !inEditMode) {\n\t\t\treturn null\n\t\t} else {\n\t\t\treturn m(\n\t\t\t\tSidebarSection,\n\t\t\t\t{\n\t\t\t\t\tname: lang.makeTranslation(\"mailbox_name\", getMailboxName(locator.logins, mailboxDetail)),\n\t\t\t\t},\n\t\t\t\t[\n\t\t\t\t\tthis.createMailboxFolderItems(mailboxDetail, inEditMode, () => {\n\t\t\t\t\t\tEditFoldersDialog.showEdit(() => this.renderFoldersAndLabels(mailboxDetail.mailGroup._id))\n\t\t\t\t\t}),\n\t\t\t\t\tmailLocator.mailModel.canManageLabels()\n\t\t\t\t\t\t? this.renderMailboxLabelItems(mailboxDetail, inEditMode, () => {\n\t\t\t\t\t\t\t\tEditFoldersDialog.showEdit(() => this.renderFoldersAndLabels(mailboxDetail.mailGroup._id))\n\t\t\t\t\t\t  })\n\t\t\t\t\t\t: null,\n\t\t\t\t],\n\t\t\t)\n\t\t}\n\t}\n\n\tprivate createMailboxFolderItems(mailboxDetail: MailboxDetail, inEditMode: boolean, onEditMailbox: () => void): Children {\n\t\treturn m(MailFoldersView, {\n\t\t\tmailModel: mailLocator.mailModel,\n\t\t\tmailboxDetail,\n\t\t\texpandedFolders: this.expandedState,\n\t\t\tmailFolderElementIdToSelectedMailId: this.mailViewModel.getMailFolderToSelectedMail(),\n\t\t\tonFolderClick: () => {\n\t\t\t\tif (!inEditMode) {\n\t\t\t\t\tthis.viewSlider.focus(this.listColumn)\n\t\t\t\t}\n\t\t\t},\n\t\t\tonFolderExpanded: (folder, state) => this.setExpandedState(folder, state),\n\t\t\tonShowFolderAddEditDialog: (...args) => this.showFolderAddEditDialog(...args),\n\t\t\tonDeleteCustomMailFolder: (folder) => this.deleteCustomMailFolder(mailboxDetail, folder),\n\t\t\tonFolderDrop: (dropData, folder) => {\n\t\t\t\tif (dropData.dropType == DropType.Mail) {\n\t\t\t\t\tthis.handleFolderMailDrop(dropData, folder)\n\t\t\t\t} else if (dropData.dropType == DropType.ExternalFile) {\n\t\t\t\t\tthis.handeFolderFileDrop(dropData, mailboxDetail, folder)\n\t\t\t\t}\n\t\t\t},\n\t\t\tinEditMode,\n\t\t\tonEditMailbox,\n\t\t})\n\t}\n\n\tprivate setExpandedState(folder: MailFolder, currentExpansionState: boolean) {\n\t\tif (currentExpansionState) {\n\t\t\tthis.expandedState.delete(getElementId(folder))\n\t\t} else {\n\t\t\tthis.expandedState.add(getElementId(folder))\n\t\t}\n\t\tdeviceConfig.setExpandedFolders(locator.logins.getUserController().userId, [...this.expandedState])\n\t}\n\n\tprotected onNewUrl(args: Record<string, any>, requestedPath: string) {\n\t\tif (requestedPath.startsWith(\"/mailto\")) {\n\t\t\tif (location.hash.length > 5) {\n\t\t\t\tlet url = location.hash.substring(5)\n\t\t\t\tlet decodedUrl = decodeURIComponent(url)\n\t\t\t\tPromise.all([locator.mailboxModel.getUserMailboxDetails(), import(\"../editor/MailEditor\")]).then(\n\t\t\t\t\t([mailboxDetails, { newMailtoUrlMailEditor }]) => {\n\t\t\t\t\t\tnewMailtoUrlMailEditor(decodedUrl, false, mailboxDetails)\n\t\t\t\t\t\t\t.then((editor) => editor.show())\n\t\t\t\t\t\t\t.catch(ofClass(CancelledError, noOp))\n\t\t\t\t\t\thistory.pushState(\"\", document.title, window.location.pathname) // remove # from url\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t}\n\t\t}\n\n\t\tif (isApp()) {\n\t\t\tlet userGroupInfo = locator.logins.getUserController().userGroupInfo\n\t\t\tlocator.pushService.closePushNotification(\n\t\t\t\tuserGroupInfo.mailAddressAliases.map((alias) => alias.mailAddress).concat(userGroupInfo.mailAddress || []),\n\t\t\t)\n\t\t}\n\n\t\tif (typeof args.mail === \"string\") {\n\t\t\tconst [mailListId, mailId] = args.mail.split(\",\")\n\t\t\tif (mailListId && mailId) {\n\t\t\t\tthis.mailViewModel.showStickyMail([mailListId, mailId], () =>\n\t\t\t\t\tshowSnackBar({\n\t\t\t\t\t\tmessage: \"mailMoved_msg\",\n\t\t\t\t\t\tbutton: {\n\t\t\t\t\t\t\tlabel: \"ok_action\",\n\t\t\t\t\t\t\tclick: noOp,\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t)\n\t\t\t\tthis.viewSlider.focus(this.mailColumn)\n\t\t\t} else {\n\t\t\t\tthis.showMail(args)\n\t\t\t}\n\t\t} else {\n\t\t\tthis.showMail(args)\n\t\t}\n\t}\n\n\tprivate showMail(args: Record<string, any>) {\n\t\tthis.mailViewModel.showMailWithMailSetId(args.folderId, args.mailId)\n\t\tif (styles.isSingleColumnLayout() && !args.mailId && this.viewSlider.focusedColumn === this.mailColumn) {\n\t\t\tthis.viewSlider.focus(this.listColumn)\n\t\t}\n\t}\n\n\tprivate async handleFileDrop(fileDrop: FileDropData) {\n\t\ttry {\n\t\t\tconst [mailbox, dataFiles, { appendEmailSignature }, { newMailEditorFromTemplate }] = await Promise.all([\n\t\t\t\tthis.mailViewModel.getMailboxDetails(),\n\t\t\t\treadLocalFiles(fileDrop.files),\n\t\t\t\timport(\"../signature/Signature\"),\n\t\t\t\timport(\"../editor/MailEditor\"),\n\t\t\t])\n\n\t\t\tif (mailbox != null) {\n\t\t\t\tconst dialog = await newMailEditorFromTemplate(mailbox, {}, \"\", appendEmailSignature(\"\", locator.logins.getUserController().props), dataFiles)\n\t\t\t\tdialog.show()\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (!(e instanceof PermissionError)) throw e\n\t\t}\n\t}\n\n\tprivate async handleFolderMailDrop(dropData: MailDropData, folder: MailFolder) {\n\t\tconst { mailId } = dropData\n\t\tif (!this.mailViewModel.listModel) {\n\t\t\treturn\n\t\t}\n\t\tlet mailsToMove: Mail[] = []\n\n\t\t// the dropped mail is among the selected mails, move all selected mails\n\t\tif (this.mailViewModel.listModel.isItemSelected(mailId)) {\n\t\t\tmailsToMove = this.mailViewModel.listModel.getSelectedAsArray()\n\t\t} else {\n\t\t\tconst entity = this.mailViewModel.listModel.getMail(mailId)\n\n\t\t\tif (entity) {\n\t\t\t\tmailsToMove.push(entity)\n\t\t\t}\n\t\t}\n\n\t\tmoveMails({\n\t\t\tmailboxModel: locator.mailboxModel,\n\t\t\tmailModel: mailLocator.mailModel,\n\t\t\tmails: mailsToMove,\n\t\t\ttargetMailFolder: folder,\n\t\t})\n\t}\n\n\tprivate async handeFolderFileDrop(dropData: FileDropData, mailboxDetail: MailboxDetail, mailFolder: MailFolder) {\n\t\tfunction droppedOnlyMailFiles(files: Array<File>): boolean {\n\t\t\t// there's similar logic on the AttachmentBubble, but for natively shared files.\n\t\t\treturn files.every((f) => f.name.endsWith(\".eml\") || f.name.endsWith(\".mbox\"))\n\t\t}\n\n\t\tawait this.handleFileDrop(dropData)\n\n\t\t// DnD mail importing is disabled for now as the MailImporter might not have\n\t\t// been initialized yet.\n\t\t//\n\t\t// // importing mails is currently only allowed on plan LEGEND and UNLIMITED\n\t\t// const currentPlanType = await locator.logins.getUserController().getPlanType()\n\t\t// const isHighestTierPlan = HighestTierPlans.includes(currentPlanType)\n\t\t//\n\t\t// let importAction: { text: TranslationText; value: boolean } = {\n\t\t// \ttext: \"import_action\",\n\t\t// \tvalue: true,\n\t\t// }\n\t\t// let attachFilesAction: { text: TranslationText; value: boolean } = {\n\t\t// \ttext: \"attachFiles_action\",\n\t\t// \tvalue: false,\n\t\t// }\n\t\t// const willImport =\n\t\t// \tisHighestTierPlan && droppedOnlyMailFiles(dropData.files) && (await Dialog.choice(\"emlOrMboxInSharingFiles_msg\", [importAction, attachFilesAction]))\n\t\t//\n\t\t// if (!willImport) {\n\t\t// \tawait this.handleFileDrop(dropData)\n\t\t// } else if (mailFolder._ownerGroup && this.mailImporter) {\n\t\t// \tawait this.mailImporter.onStartBtnClick(\n\t\t// \t\tmailFolder,\n\t\t// \t\tdropData.files.map((file) => window.nativeApp.getPathForFile(file)),\n\t\t// \t)\n\t\t// }\n\t}\n\n\tprivate async showNewMailDialog(): Promise<void> {\n\t\tconst mailboxDetails = await this.mailViewModel.getMailboxDetails()\n\t\tif (mailboxDetails == null) {\n\t\t\treturn\n\t\t}\n\t\tconst { newMailEditor } = await import(\"../editor/MailEditor\")\n\t\tconst dialog = await newMailEditor(mailboxDetails)\n\t\tdialog.show()\n\t}\n\n\tprivate async deleteCustomMailFolder(mailboxDetail: MailboxDetail, folder: MailFolder): Promise<void> {\n\t\tif (folder.folderType !== MailSetKind.CUSTOM) {\n\t\t\tthrow new Error(\"Cannot delete non-custom folder: \" + String(folder._id))\n\t\t}\n\n\t\t// remove any selection to avoid that the next mail is loaded and selected for each deleted mail event\n\t\tthis.mailViewModel?.listModel?.selectNone()\n\t\tif (mailboxDetail.mailbox.folders == null) {\n\t\t\treturn\n\t\t}\n\t\tconst folders = await mailLocator.mailModel.getMailboxFoldersForId(mailboxDetail.mailbox.folders._id)\n\n\t\tif (isSpamOrTrashFolder(folders, folder)) {\n\t\t\tconst confirmed = await Dialog.confirm(\n\t\t\t\tlang.getTranslation(\"confirmDeleteFinallyCustomFolder_msg\", {\n\t\t\t\t\t\"{1}\": getFolderName(folder),\n\t\t\t\t}),\n\t\t\t)\n\t\t\tif (!confirmed) return\n\t\t\tawait mailLocator.mailModel.finallyDeleteCustomMailFolder(folder)\n\t\t} else {\n\t\t\tconst confirmed = await Dialog.confirm(\n\t\t\t\tlang.getTranslation(\"confirmDeleteCustomFolder_msg\", {\n\t\t\t\t\t\"{1}\": getFolderName(folder),\n\t\t\t\t}),\n\t\t\t)\n\t\t\tif (!confirmed) return\n\t\t\tawait mailLocator.mailModel.trashFolderAndSubfolders(folder)\n\t\t}\n\t}\n\n\tlogout() {\n\t\tm.route.set(\"/\")\n\t}\n\n\tprivate async toggleUnreadMails(mails: Mail[]): Promise<void> {\n\t\tif (mails.length == 0) {\n\t\t\treturn\n\t\t}\n\t\t// set all selected emails to the opposite of the first email's unread state\n\t\tawait mailLocator.mailModel.markMails(mails, !mails[0].unread)\n\t}\n\n\tprivate deleteMails(mails: Mail[]): Promise<boolean> {\n\t\treturn promptAndDeleteMails(mailLocator.mailModel, mails, noOp)\n\t}\n\n\tprivate async showFolderAddEditDialog(mailGroupId: Id, folder: MailFolder | null, parentFolder: MailFolder | null) {\n\t\tconst mailboxDetail = await locator.mailboxModel.getMailboxDetailsForMailGroup(mailGroupId)\n\t\tawait showEditFolderDialog(mailboxDetail, folder, parentFolder)\n\t}\n\n\tprivate async showLabelAddDialog(mailbox: MailBox) {\n\t\tawait showEditLabelDialog(mailbox, this.mailViewModel, null)\n\t}\n\n\tprivate async showLabelEditDialog(label: MailFolder) {\n\t\tawait showEditLabelDialog(null, this.mailViewModel, label)\n\t}\n\n\tprivate async showLabelDeleteDialog(label: MailFolder) {\n\t\tconst confirmed = await Dialog.confirm(\n\t\t\tlang.getTranslation(\"confirmDeleteLabel_msg\", {\n\t\t\t\t\"{1}\": label.name,\n\t\t\t}),\n\t\t)\n\t\tif (!confirmed) return\n\t\tawait this.mailViewModel.deleteLabel(label)\n\t}\n\n\tprivate renderMailboxLabelItems(mailboxDetail: MailboxDetail, inEditMode: boolean, onEditMailbox: () => void): Children {\n\t\treturn [\n\t\t\tm(\n\t\t\t\tSidebarSection,\n\t\t\t\t{\n\t\t\t\t\tname: \"labels_label\",\n\t\t\t\t\tbutton: inEditMode ? this.renderAddLabelButton(mailboxDetail) : this.renderEditMailboxButton(onEditMailbox),\n\t\t\t\t},\n\t\t\t\t[\n\t\t\t\t\tm(\".flex.col\", [\n\t\t\t\t\t\tArray.from(mailLocator.mailModel.getLabelsByGroupId(mailboxDetail.mailGroup._id).values()).map((label) => {\n\t\t\t\t\t\t\tconst path = `${MAIL_PREFIX}/${getElementId(label)}`\n\n\t\t\t\t\t\t\treturn m(SidebarSectionRow, {\n\t\t\t\t\t\t\t\ticon: Icons.Label,\n\t\t\t\t\t\t\t\ticonColor: getLabelColor(label.color),\n\t\t\t\t\t\t\t\tlabel: lang.makeTranslation(`folder:${label.name}`, label.name),\n\t\t\t\t\t\t\t\tpath,\n\t\t\t\t\t\t\t\tisSelectedPrefix: inEditMode ? false : path,\n\t\t\t\t\t\t\t\tdisabled: inEditMode,\n\t\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\t\tif (!inEditMode) {\n\t\t\t\t\t\t\t\t\t\tthis.viewSlider.focus(this.listColumn)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\talwaysShowMoreButton: inEditMode,\n\t\t\t\t\t\t\t\tmoreButton: attachDropdown({\n\t\t\t\t\t\t\t\t\tmainButtonAttrs: {\n\t\t\t\t\t\t\t\t\t\ticon: Icons.More,\n\t\t\t\t\t\t\t\t\t\ttitle: \"more_label\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tchildAttrs: () => [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tlabel: \"edit_action\",\n\t\t\t\t\t\t\t\t\t\t\ticon: Icons.Edit,\n\t\t\t\t\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\t\t\t\t\tthis.showLabelEditDialog(label)\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tlabel: \"delete_action\",\n\t\t\t\t\t\t\t\t\t\t\ticon: Icons.Trash,\n\t\t\t\t\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\t\t\t\t\tthis.showLabelDeleteDialog(label)\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t],\n\t\t\t),\n\t\t\tm(RowButton, {\n\t\t\t\tlabel: \"addLabel_action\",\n\t\t\t\ticon: Icons.Add,\n\t\t\t\tclass: \"folder-row mlr-button border-radius-small\",\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: `calc(100% - ${px(size.hpad_button * 2)})`,\n\t\t\t\t},\n\t\t\t\tonclick: () => {\n\t\t\t\t\tthis.showLabelAddDialog(mailboxDetail.mailbox)\n\t\t\t\t},\n\t\t\t}),\n\t\t]\n\t}\n\n\tprivate renderEditMailboxButton(onEditMailbox: () => unknown) {\n\t\treturn m(IconButton, {\n\t\t\ticon: Icons.Edit,\n\t\t\tsize: ButtonSize.Compact,\n\t\t\ttitle: \"edit_action\",\n\t\t\tclick: onEditMailbox,\n\t\t})\n\t}\n\n\tprivate renderAddLabelButton(mailboxDetail: MailboxDetail) {\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"addLabel_action\",\n\t\t\ticon: Icons.Add,\n\t\t\tclick: () => {\n\t\t\t\tthis.showLabelAddDialog(mailboxDetail.mailbox)\n\t\t\t},\n\t\t})\n\t}\n}\n"]}