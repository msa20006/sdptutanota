{"version":3,"file":"MultiDayCalendarView.js","sourceRoot":"","sources":["../../../../../src/calendar-app/calendar/view/MultiDayCalendarView.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Component, Vnode, VnodeDOM } from \"mithril\"\nimport { getStartOfDay, incrementDate, isToday, lastThrow, neverNull, ofClass, remove } from \"@tutao/tutanota-utils\"\nimport { formatShortTime, formatTime } from \"../../../common/misc/Formatter\"\nimport {\n\tcombineDateWithTime,\n\teventEndsAfterDay,\n\teventStartsBefore,\n\tgetDiffIn24hIntervals,\n\tgetEventEnd,\n\tgetEventStart,\n\tgetRangeOfDays,\n\tgetStartOfTheWeekOffset,\n\tgetStartOfWeek,\n\tgetTimeTextFormatForLongEvent,\n\tgetTimeZone,\n} from \"../../../common/calendar/date/CalendarUtils\"\nimport { CalendarDayEventsView, calendarDayTimes } from \"./CalendarDayEventsView\"\nimport { theme } from \"../../../common/gui/theme\"\nimport { px, size } from \"../../../common/gui/size\"\nimport { EventTextTimeOption, WeekStart } from \"../../../common/api/common/TutanotaConstants\"\nimport { lang } from \"../../../common/misc/LanguageViewModel\"\nimport { PageView } from \"../../../common/gui/base/PageView\"\nimport type { CalendarEvent } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport type { GroupColors } from \"./CalendarView\"\nimport type { EventDragHandlerCallbacks, MousePos } from \"./EventDragHandler\"\nimport { EventDragHandler } from \"./EventDragHandler\"\nimport { getIfLargeScroll, getPosAndBoundsFromMouseEvent } from \"../../../common/gui/base/GuiUtils\"\nimport { UserError } from \"../../../common/api/main/UserError\"\nimport { showUserError } from \"../../../common/misc/ErrorHandlerImpl\"\nimport { styles } from \"../../../common/gui/styles\"\nimport { CALENDAR_EVENT_HEIGHT, daysHaveEvents, EventLayoutMode, getEventColor, layOutEvents, TEMPORARY_EVENT_OPACITY } from \"../gui/CalendarGuiUtils.js\"\nimport type { CalendarEventBubbleClickHandler, CalendarEventBubbleKeyDownHandler, EventsOnDays } from \"./CalendarViewModel\"\nimport { ContinuingCalendarEventBubble } from \"./ContinuingCalendarEventBubble\"\nimport { CalendarViewType, isAllDayEvent } from \"../../../common/api/common/utils/CommonCalendarUtils\"\nimport { locator } from \"../../../common/api/main/CommonLocator.js\"\nimport { DateTime } from \"luxon\"\nimport { Time } from \"../../../common/calendar/date/Time.js\"\nimport { DaySelector } from \"../gui/day-selector/DaySelector.js\"\n\nexport type MultiDayCalendarViewAttrs = {\n\tselectedDate: Date\n\tdaysInPeriod: number\n\tonDateSelected: (date: Date, calendarViewTypeToShow?: CalendarViewType) => unknown\n\tgetEventsOnDays: (range: Array<Date>) => EventsOnDays\n\tonNewEvent: (date: Date | null) => unknown\n\tonEventClicked: CalendarEventBubbleClickHandler\n\tonEventKeyDown: CalendarEventBubbleKeyDownHandler\n\tgroupColors: GroupColors\n\tstartOfTheWeek: WeekStart\n\tonChangeViewPeriod: (next: boolean) => unknown\n\ttemporaryEvents: Array<CalendarEvent>\n\tdragHandlerCallbacks: EventDragHandlerCallbacks\n\tisDaySelectorExpanded: boolean\n\tweekIndicator: string | null\n\tselectedTime?: Time\n\tscrollPosition: number\n\tonScrollPositionChange: (newPosition: number) => unknown\n\tonViewChanged: (vnode: VnodeDOM) => unknown\n}\n\nexport class MultiDayCalendarView implements Component<MultiDayCalendarViewAttrs> {\n\tprivate longEventsDom: HTMLElement | null = null\n\tprivate domElements: HTMLElement[] = []\n\tprivate eventDragHandler: EventDragHandler\n\tprivate dateUnderMouse: Date | null = null\n\tprivate viewDom: HTMLElement | null = null\n\tprivate lastMousePos: MousePos | null = null\n\tprivate isHeaderEventBeingDragged: boolean = false\n\t// These variables are used to prevent `scrollDOMs()` overwriting an in-progress `scrollTo()` from a previous call to `scrollDOMs()`\n\tprivate isProgrammaticScrollInProgress: boolean = false\n\tprivate scrollEndTime: TimeoutID | null = null\n\tprivate lastScrollPosition: number | null = null\n\n\tconstructor({ attrs }: Vnode<MultiDayCalendarViewAttrs>) {\n\t\tthis.eventDragHandler = new EventDragHandler(neverNull(document.body as HTMLBodyElement), attrs.dragHandlerCallbacks)\n\t}\n\n\toncreate(vnode: VnodeDOM<MultiDayCalendarViewAttrs>) {\n\t\tthis.viewDom = vnode.dom as HTMLElement\n\t}\n\n\tonupdate(vnode: VnodeDOM<MultiDayCalendarViewAttrs>) {\n\t\tthis.viewDom = vnode.dom as HTMLElement\n\t}\n\n\tview({ attrs }: Vnode<MultiDayCalendarViewAttrs>): Children {\n\t\t// Special case for week view\n\n\t\tconst startOfThisPeriod =\n\t\t\tattrs.daysInPeriod === 7 ? getStartOfWeek(attrs.selectedDate, getStartOfTheWeekOffset(attrs.startOfTheWeek)) : attrs.selectedDate\n\t\tconst startOfPreviousPeriod = incrementDate(new Date(startOfThisPeriod), -attrs.daysInPeriod)\n\t\tconst startOfNextPeriod = incrementDate(new Date(startOfThisPeriod), attrs.daysInPeriod)\n\n\t\tconst previousPageEvents = this.getEventsInRange(attrs.getEventsOnDays, attrs.daysInPeriod, startOfPreviousPeriod)\n\t\tconst currentPageEvents = this.getEventsInRange(attrs.getEventsOnDays, attrs.daysInPeriod, startOfThisPeriod)\n\t\tconst nextPageEvents = this.getEventsInRange(attrs.getEventsOnDays, attrs.daysInPeriod, startOfNextPeriod)\n\t\tconst startOfWeek = getStartOfWeek(attrs.selectedDate, getStartOfTheWeekOffset(attrs.startOfTheWeek))\n\t\tconst weekEvents = this.getEventsInRange(attrs.getEventsOnDays, 7, startOfWeek)\n\n\t\tconst isDayView = attrs.daysInPeriod === 1\n\t\tconst isDesktopLayout = styles.isDesktopLayout()\n\n\t\treturn m(\".flex.col.fill-absolute\", [\n\t\t\t!isDesktopLayout\n\t\t\t\t? [\n\t\t\t\t\t\tthis.renderDateSelector(attrs, isDayView),\n\t\t\t\t\t\tthis.renderHeaderMobile(\n\t\t\t\t\t\t\tisDayView ? currentPageEvents : weekEvents,\n\t\t\t\t\t\t\tattrs.groupColors,\n\t\t\t\t\t\t\tattrs.onEventClicked,\n\t\t\t\t\t\t\tattrs.onEventKeyDown,\n\t\t\t\t\t\t\tattrs.temporaryEvents,\n\t\t\t\t\t\t),\n\t\t\t\t  ]\n\t\t\t\t: null,\n\n\t\t\tm(PageView, {\n\t\t\t\tpreviousPage: {\n\t\t\t\t\tkey: startOfPreviousPeriod.getTime(),\n\t\t\t\t\tnodes: this.renderDays(attrs, previousPageEvents, currentPageEvents, isDayView, isDesktopLayout),\n\t\t\t\t},\n\t\t\t\tcurrentPage: {\n\t\t\t\t\tkey: startOfThisPeriod.getTime(),\n\t\t\t\t\tnodes: this.renderDays(attrs, currentPageEvents, currentPageEvents, isDayView, isDesktopLayout),\n\t\t\t\t},\n\t\t\t\tnextPage: {\n\t\t\t\t\tkey: startOfNextPeriod.getTime(),\n\t\t\t\t\tnodes: this.renderDays(attrs, nextPageEvents, currentPageEvents, isDayView, isDesktopLayout),\n\t\t\t\t},\n\t\t\t\tonChangePage: (next) => attrs.onChangeViewPeriod(next),\n\t\t\t}),\n\t\t])\n\t}\n\n\tprivate getEventsInRange(getEventsFunction: (range: Date[]) => EventsOnDays, daysInPeriod: number, startOfPeriod: Date) {\n\t\tconst weekRange = getRangeOfDays(startOfPeriod, daysInPeriod)\n\t\treturn getEventsFunction(weekRange)\n\t}\n\n\tprivate renderDateSelector(attrs: MultiDayCalendarViewAttrs, isDayView: boolean): Children {\n\t\treturn m(\"\", [\n\t\t\tm(\n\t\t\t\t\".header-bg.pb-s.overflow-hidden\",\n\t\t\t\t{\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\"margin-left\": px(size.calendar_hour_width_mobile),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tm(DaySelector, {\n\t\t\t\t\tselectedDate: attrs.selectedDate,\n\t\t\t\t\tonDateSelected: (date) => attrs.onDateSelected(date),\n\t\t\t\t\twide: true,\n\t\t\t\t\tstartOfTheWeekOffset: getStartOfTheWeekOffset(attrs.startOfTheWeek),\n\t\t\t\t\tisDaySelectorExpanded: attrs.isDaySelectorExpanded,\n\t\t\t\t\thandleDayPickerSwipe: (isNext: boolean) => {\n\t\t\t\t\t\tconst sign = isNext ? 1 : -1\n\t\t\t\t\t\tconst duration = {\n\t\t\t\t\t\t\tmonth: sign * (attrs.isDaySelectorExpanded ? 1 : 0),\n\t\t\t\t\t\t\tweek: sign * (attrs.isDaySelectorExpanded ? 0 : 1),\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tattrs.onDateSelected(DateTime.fromJSDate(attrs.selectedDate).plus(duration).toJSDate())\n\t\t\t\t\t},\n\t\t\t\t\tshowDaySelection: isDayView,\n\t\t\t\t\thighlightToday: true,\n\t\t\t\t\thighlightSelectedWeek: !isDayView,\n\t\t\t\t\tuseNarrowWeekName: styles.isSingleColumnLayout(),\n\t\t\t\t\thasEventOn: (date) => daysHaveEvents(attrs.getEventsOnDays([date])),\n\t\t\t\t}),\n\t\t\t),\n\t\t])\n\t}\n\n\tprivate static getTodayTimestamp(): number {\n\t\treturn getStartOfDay(new Date()).getTime()\n\t}\n\n\tprivate renderDays(\n\t\tattrs: MultiDayCalendarViewAttrs,\n\t\tthisPeriod: EventsOnDays,\n\t\tmainPeriod: EventsOnDays,\n\t\tisDayView: boolean,\n\t\tisDesktopLayout: boolean,\n\t): Children {\n\t\tlet containerStyle\n\n\t\tif (isDesktopLayout) {\n\t\t\tcontainerStyle = {\n\t\t\t\tmarginLeft: \"5px\",\n\t\t\t\toverflow: \"hidden\",\n\t\t\t\tmarginBottom: px(size.hpad_large),\n\t\t\t}\n\t\t} else {\n\t\t\tcontainerStyle = {}\n\t\t}\n\n\t\t// Whether the current list is the visible list and not one of the lists used for swiping\n\t\tconst isMainView = thisPeriod === mainPeriod\n\n\t\treturn m(\n\t\t\t\".fill-absolute.flex.col.overflow-hidden\",\n\t\t\t{\n\t\t\t\tclass: isDesktopLayout ? \"mlr-l border-radius-big\" : \"border-radius-top-left-big border-radius-top-right-big content-bg mlr-safe-inset\",\n\t\t\t\tstyle: containerStyle,\n\t\t\t\tonmousemove: (mouseEvent: EventRedraw<MouseEvent>) => {\n\t\t\t\t\tmouseEvent.redraw = false\n\t\t\t\t\tthis.lastMousePos = getPosAndBoundsFromMouseEvent(mouseEvent)\n\n\t\t\t\t\tif (this.dateUnderMouse) {\n\t\t\t\t\t\treturn this.eventDragHandler.handleDrag(this.dateUnderMouse, this.lastMousePos)\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonmouseup: (mouseEvent: EventRedraw<MouseEvent>) => {\n\t\t\t\t\tmouseEvent.redraw = false\n\n\t\t\t\t\tthis.endDrag(mouseEvent)\n\t\t\t\t},\n\t\t\t\tonmouseleave: (mouseEvent: EventRedraw<MouseEvent>) => {\n\t\t\t\t\tmouseEvent.redraw = false\n\n\t\t\t\t\tif (this.eventDragHandler.isDragging) {\n\t\t\t\t\t\tthis.cancelDrag()\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\t[\n\t\t\t\tisDesktopLayout ? this.renderHeaderDesktop(attrs, thisPeriod, mainPeriod) : null,\n\t\t\t\t// using .scroll-no-overlay because of a browser bug in Chromium where scroll wouldn't work at all\n\t\t\t\t// see https://github.com/tutao/tutanota/issues/4846\n\t\t\t\tm(\n\t\t\t\t\t\".flex.scroll-no-overlay.content-bg\",\n\t\t\t\t\t{\n\t\t\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\t\t\tthis.isProgrammaticScrollInProgress = false\n\t\t\t\t\t\t\tif (isMainView) {\n\t\t\t\t\t\t\t\tif (attrs.selectedTime) {\n\t\t\t\t\t\t\t\t\tattrs.onScrollPositionChange(size.calendar_hour_height * attrs.selectedTime.hour)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tthis.scrollDOMs(vnode, attrs, false)\n\t\t\t\t\t\t\t\tattrs.onViewChanged(vnode)\n\t\t\t\t\t\t\t\tthis.lastScrollPosition = attrs.scrollPosition\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.domElements.push(vnode.dom as HTMLElement)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonupdate: isMainView\n\t\t\t\t\t\t\t? (vnode) => {\n\t\t\t\t\t\t\t\t\tthis.scrollDOMs(vnode, attrs, getIfLargeScroll(this.lastScrollPosition, attrs.scrollPosition))\n\t\t\t\t\t\t\t\t\tattrs.onViewChanged(vnode)\n\t\t\t\t\t\t\t\t\tthis.lastScrollPosition = attrs.scrollPosition\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\tonscroll: isMainView\n\t\t\t\t\t\t\t? (event: Event) => {\n\t\t\t\t\t\t\t\t\t// Ignore calls to `scrollTo()` via the `isProgrammaticScrollInProgress` flag\n\t\t\t\t\t\t\t\t\t// because they are considered user input by `event.isTrusted`\n\t\t\t\t\t\t\t\t\t// Safari does not support the scroll end event, so we have to implement it ourselves\n\t\t\t\t\t\t\t\t\tif (this.isProgrammaticScrollInProgress) {\n\t\t\t\t\t\t\t\t\t\tclearTimeout(this.scrollEndTime)\n\t\t\t\t\t\t\t\t\t\tthis.scrollEndTime = setTimeout(() => {\n\t\t\t\t\t\t\t\t\t\t\tthis.isProgrammaticScrollInProgress = false\n\t\t\t\t\t\t\t\t\t\t\tattrs.onScrollPositionChange((event.target as HTMLElement).scrollTop)\n\t\t\t\t\t\t\t\t\t\t}, 100)\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tattrs.onScrollPositionChange((event.target as HTMLElement).scrollTop)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\tonremove: (vnode) => {\n\t\t\t\t\t\t\tremove(this.domElements, vnode.dom as HTMLElement)\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t[\n\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\".flex.col\",\n\t\t\t\t\t\t\tcalendarDayTimes.map((time) => {\n\t\t\t\t\t\t\t\tconst width = isDesktopLayout ? size.calendar_hour_width : size.calendar_hour_width_mobile\n\t\t\t\t\t\t\t\treturn m(\n\t\t\t\t\t\t\t\t\t\".calendar-hour.flex.cursor-pointer\",\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tonclick: (e: MouseEvent) => {\n\t\t\t\t\t\t\t\t\t\t\te.stopPropagation()\n\t\t\t\t\t\t\t\t\t\t\tattrs.onNewEvent(time.toDate(attrs.selectedDate))\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\t\t\".pl-s.pr-s.center.small.flex.flex-column.justify-center\",\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t\t\t\"line-height\": isDesktopLayout ? px(size.calendar_hour_height) : \"unset\",\n\t\t\t\t\t\t\t\t\t\t\t\twidth: px(width),\n\t\t\t\t\t\t\t\t\t\t\t\theight: px(size.calendar_hour_height),\n\t\t\t\t\t\t\t\t\t\t\t\t\"border-right\": `1px solid ${theme.content_border}`,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tisDesktopLayout ? formatTime(time.toDate()) : formatShortTime(time.toDate()),\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\".flex.flex-grow\",\n\t\t\t\t\t\t\tthisPeriod.days.map((weekday, i) => {\n\t\t\t\t\t\t\t\tconst events = thisPeriod.shortEventsPerDay[i]\n\n\t\t\t\t\t\t\t\tconst newEventHandler = (hours: number, minutes: number) => {\n\t\t\t\t\t\t\t\t\tconst newDate = new Date(weekday)\n\t\t\t\t\t\t\t\t\tnewDate.setHours(hours, minutes)\n\t\t\t\t\t\t\t\t\tattrs.onNewEvent(newDate)\n\t\t\t\t\t\t\t\t\tattrs.onDateSelected(new Date(weekday))\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn m(\n\t\t\t\t\t\t\t\t\t\".flex-grow\",\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tclass: !isDayView ? \"calendar-column-border\" : \"\",\n\t\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t\theight: px(calendarDayTimes.length * size.calendar_hour_height),\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tm(CalendarDayEventsView, {\n\t\t\t\t\t\t\t\t\t\tonEventClicked: attrs.onEventClicked,\n\t\t\t\t\t\t\t\t\t\tonEventKeyDown: attrs.onEventKeyDown,\n\t\t\t\t\t\t\t\t\t\tgroupColors: attrs.groupColors,\n\t\t\t\t\t\t\t\t\t\tevents: events,\n\t\t\t\t\t\t\t\t\t\tdisplayTimeIndicator: weekday.getTime() === MultiDayCalendarView.getTodayTimestamp(),\n\t\t\t\t\t\t\t\t\t\tonTimePressed: newEventHandler,\n\t\t\t\t\t\t\t\t\t\tonTimeContextPressed: newEventHandler,\n\t\t\t\t\t\t\t\t\t\tday: weekday,\n\t\t\t\t\t\t\t\t\t\tsetCurrentDraggedEvent: (event) => this.startEventDrag(event),\n\t\t\t\t\t\t\t\t\t\tsetTimeUnderMouse: (time) => (this.dateUnderMouse = combineDateWithTime(weekday, time)),\n\t\t\t\t\t\t\t\t\t\tisTemporaryEvent: (event) => attrs.temporaryEvents.includes(event),\n\t\t\t\t\t\t\t\t\t\tisDragging: this.eventDragHandler.isDragging,\n\t\t\t\t\t\t\t\t\t\tfullViewWidth: this.viewDom?.getBoundingClientRect().width,\n\t\t\t\t\t\t\t\t\t\tdisabled: !isMainView,\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t),\n\t\t\t\t\t],\n\t\t\t\t),\n\t\t\t],\n\t\t)\n\t}\n\n\tprivate scrollDOMs(vnode: VnodeDOM, attrs: MultiDayCalendarViewAttrs, isSmooth: boolean): void {\n\t\t// Do not override an ongoing `scrollTo()` call unless the update was caused by user input\n\t\t// Also do not scroll to a position the list is already at\n\t\tif ((this.isProgrammaticScrollInProgress && this.lastScrollPosition === attrs.scrollPosition) || vnode.dom.scrollTop === attrs.scrollPosition) {\n\t\t\treturn\n\t\t}\n\n\t\tif (isSmooth) {\n\t\t\tthis.isProgrammaticScrollInProgress = true\n\t\t\tvnode.dom.scrollTo({ top: attrs.scrollPosition, behavior: \"smooth\" })\n\t\t\tfor (const dom of this.domElements) {\n\t\t\t\tdom.scrollTo({ top: attrs.scrollPosition, behavior: \"smooth\" })\n\t\t\t}\n\t\t\tvnode.dom.dispatchEvent(new Event(\"scroll\"))\n\t\t} else {\n\t\t\tthis.isProgrammaticScrollInProgress = false\n\t\t\tvnode.dom.scrollTop = attrs.scrollPosition\n\t\t\tfor (const dom of this.domElements) {\n\t\t\t\tdom.scrollTop = attrs.scrollPosition\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate startEventDrag(event: CalendarEvent) {\n\t\tconst lastMousePos = this.lastMousePos\n\n\t\tif (this.dateUnderMouse && lastMousePos) {\n\t\t\tthis.eventDragHandler.prepareDrag(event, this.dateUnderMouse, lastMousePos, this.isHeaderEventBeingDragged)\n\t\t}\n\t}\n\n\tprivate renderHeaderMobile(\n\t\tthisPageEvents: EventsOnDays,\n\t\tgroupColors: GroupColors,\n\t\tonEventClicked: CalendarEventBubbleClickHandler,\n\t\tonEventKeyDown: CalendarEventBubbleKeyDownHandler,\n\t\ttemporaryEvents: Array<CalendarEvent>,\n\t): Children {\n\t\tconst longEventsResult = this.renderLongEvents(\n\t\t\tthisPageEvents.days,\n\t\t\tthisPageEvents.longEvents,\n\t\t\tgroupColors,\n\t\t\tonEventClicked,\n\t\t\tonEventKeyDown,\n\t\t\ttemporaryEvents,\n\t\t\tfalse,\n\t\t)\n\t\t// We calculate the height manually because we want the header to transition between heights when swiping left and right\n\t\t// Hardcoding some styles instead of classes so that we can avoid nasty magic numbers\n\t\tconst mainPageEventsCount = longEventsResult.rows\n\t\tconst padding = mainPageEventsCount !== 0 ? size.vpad_small : 0\n\t\t// Set bottom padding in height, because it will be ignored in the style\n\t\tconst height = mainPageEventsCount * CALENDAR_EVENT_HEIGHT + padding\n\t\treturn m(\n\t\t\t\".calendar-long-events-header.flex-fixed.calendar-hour-margin.pr-l.rel\",\n\t\t\t{\n\t\t\t\tstyle: {\n\t\t\t\t\tmarginLeft: size.calendar_hour_width_mobile,\n\t\t\t\t\tborderBottom: \"none\",\n\t\t\t\t\theight: px(height),\n\t\t\t\t\tpaddingTop: px(padding),\n\t\t\t\t\ttransition: \"height 200ms ease-in-out\",\n\t\t\t\t},\n\t\t\t},\n\t\t\tlongEventsResult.children,\n\t\t)\n\t}\n\n\tprivate renderHeaderDesktop(attrs: MultiDayCalendarViewAttrs, thisPageEvents: EventsOnDays, mainPageEvents: EventsOnDays): Children {\n\t\tconst { daysInPeriod, onDateSelected, onEventClicked, onEventKeyDown, groupColors, temporaryEvents } = attrs\n\t\t// `scrollbar-gutter-stable-or-fallback` is needed because the scroll bar brings the calendar body out of line with the header\n\t\treturn m(\".calendar-long-events-header.flex-fixed.content-bg.pt-s.scrollbar-gutter-stable-or-fallback\", [\n\t\t\tthis.renderDayNamesRow(thisPageEvents.days, attrs.weekIndicator, onDateSelected),\n\t\t\tm(\".content-bg\", [\n\t\t\t\tm(\n\t\t\t\t\t\".calendar-hour-margin.content-bg\",\n\t\t\t\t\t{\n\t\t\t\t\t\tonmousemove: (mouseEvent: MouseEvent) => {\n\t\t\t\t\t\t\tconst { x, targetWidth } = getPosAndBoundsFromMouseEvent(mouseEvent)\n\t\t\t\t\t\t\tconst dayWidth = targetWidth / daysInPeriod\n\t\t\t\t\t\t\tconst dayNumber = Math.floor(x / dayWidth)\n\t\t\t\t\t\t\tconst date = new Date(thisPageEvents.days[dayNumber])\n\t\t\t\t\t\t\tconst dateUnderMouse = this.dateUnderMouse\n\n\t\t\t\t\t\t\t// When dragging short events, don't cause the mouse position date to drop to 00:00 when dragging over the header\n\t\t\t\t\t\t\tif (dateUnderMouse && this.eventDragHandler.isDragging && !this.isHeaderEventBeingDragged) {\n\t\t\t\t\t\t\t\tdate.setHours(dateUnderMouse.getHours())\n\t\t\t\t\t\t\t\tdate.setMinutes(dateUnderMouse.getMinutes())\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.dateUnderMouse = date\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t// this section is tricky with margins. We use this view for both week and day view.\n\t\t\t\t\t// in day view there's no days row and no selection indicator.\n\t\t\t\t\t// it all must work with and without long events.\n\t\t\t\t\t// thread carefully and test all the cases.\n\t\t\t\t\t[this.renderLongEventsSection(thisPageEvents, mainPageEvents, groupColors, onEventClicked, onEventKeyDown, temporaryEvents)],\n\t\t\t\t),\n\t\t\t]),\n\t\t])\n\t}\n\n\tprivate renderLongEventsSection(\n\t\tthisPageEvents: EventsOnDays,\n\t\tmainPageEvents: EventsOnDays,\n\t\tgroupColors: GroupColors,\n\t\tonEventClicked: CalendarEventBubbleClickHandler,\n\t\tonEventKeyDown: CalendarEventBubbleKeyDownHandler,\n\t\ttemporaryEvents: Array<CalendarEvent>,\n\t): Children {\n\t\tconst thisPageLongEvents = this.renderLongEvents(\n\t\t\tthisPageEvents.days,\n\t\t\tthisPageEvents.longEvents,\n\t\t\tgroupColors,\n\t\t\tonEventClicked,\n\t\t\tonEventKeyDown,\n\t\t\ttemporaryEvents,\n\t\t\ttrue,\n\t\t)\n\t\tconst mainPageLongEvents = this.renderLongEvents(\n\t\t\tmainPageEvents.days,\n\t\t\tmainPageEvents.longEvents,\n\t\t\tgroupColors,\n\t\t\tonEventClicked,\n\t\t\tonEventKeyDown,\n\t\t\ttemporaryEvents,\n\t\t\ttrue,\n\t\t)\n\t\treturn m(\n\t\t\t\".rel.mb-xs\",\n\t\t\t{\n\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\tif (mainPageEvents === thisPageEvents) {\n\t\t\t\t\t\tthis.longEventsDom = vnode.dom as HTMLElement\n\t\t\t\t\t}\n\n\t\t\t\t\tm.redraw()\n\t\t\t\t},\n\t\t\t\tonupdate: (vnode) => {\n\t\t\t\t\tif (mainPageEvents === thisPageEvents) {\n\t\t\t\t\t\tthis.longEventsDom = vnode.dom as HTMLElement\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstyle: {\n\t\t\t\t\theight: px(mainPageLongEvents.rows * CALENDAR_EVENT_HEIGHT),\n\t\t\t\t\twidth: \"100%\",\n\t\t\t\t\ttransition: \"height 200ms ease-in-out\",\n\t\t\t\t},\n\t\t\t},\n\t\t\tthisPageLongEvents.children,\n\t\t)\n\t}\n\n\t/**\n\t *\n\t * @returns the rendered calendar bubble children, and the maximum number of events that occur on a day (out of all days)\n\t */\n\tprivate renderLongEvents(\n\t\tdayRange: Array<Date>,\n\t\tevents: Array<CalendarEvent>,\n\t\tgroupColors: GroupColors,\n\t\tonEventClicked: CalendarEventBubbleClickHandler,\n\t\tonEventKeyDown: CalendarEventBubbleKeyDownHandler,\n\t\ttemporaryEvents: Array<CalendarEvent>,\n\t\tisDesktopLayout: boolean,\n\t): {\n\t\tchildren: Children\n\t\trows: number\n\t} {\n\t\tif (isDesktopLayout) {\n\t\t\treturn dayRange.length === 1\n\t\t\t\t? {\n\t\t\t\t\t\tchildren: this.renderLongEventsForSingleDay(dayRange[0], events, groupColors, onEventClicked, onEventKeyDown, temporaryEvents),\n\t\t\t\t\t\trows: events.length,\n\t\t\t\t  }\n\t\t\t\t: this.renderLongEventsForMultipleDays(dayRange, events, groupColors, onEventClicked, onEventKeyDown, temporaryEvents)\n\t\t} else {\n\t\t\treturn this.renderLongEventsForMultipleDays(dayRange, events, groupColors, onEventClicked, onEventKeyDown, temporaryEvents)\n\t\t}\n\t}\n\n\t/**\n\t *Only called from day view where header events are not draggable\n\t */\n\tprivate renderLongEventsForSingleDay(\n\t\tday: Date,\n\t\tevents: Array<CalendarEvent>,\n\t\tgroupColors: GroupColors,\n\t\tonEventClicked: CalendarEventBubbleClickHandler,\n\t\tonEventKeyDown: CalendarEventBubbleKeyDownHandler,\n\t\ttemporaryEvents: Array<CalendarEvent>,\n\t): Children {\n\t\tconst zone = getTimeZone()\n\t\treturn [\n\t\t\tm(\n\t\t\t\t\"\",\n\t\t\t\tevents.map((event) => {\n\t\t\t\t\treturn this.renderLongEventBubble(\n\t\t\t\t\t\tevent,\n\t\t\t\t\t\tgetTimeTextFormatForLongEvent(event, day, day, zone),\n\t\t\t\t\t\teventStartsBefore(day, zone, event),\n\t\t\t\t\t\teventEndsAfterDay(day, zone, event),\n\t\t\t\t\t\tgroupColors,\n\t\t\t\t\t\t(_, domEvent) => onEventClicked(event, domEvent),\n\t\t\t\t\t\t(_, domEvent) => onEventKeyDown(event, domEvent),\n\t\t\t\t\t\ttemporaryEvents.includes(event),\n\t\t\t\t\t)\n\t\t\t\t}),\n\t\t\t),\n\t\t]\n\t}\n\n\tprivate renderLongEventsForMultipleDays(\n\t\tdayRange: Array<Date>,\n\t\tevents: Array<CalendarEvent>,\n\t\tgroupColors: GroupColors,\n\t\tonEventClicked: CalendarEventBubbleClickHandler,\n\t\tonEventKeyDown: CalendarEventBubbleKeyDownHandler,\n\t\ttemporaryEvents: Array<CalendarEvent>,\n\t): {\n\t\tchildren: Children\n\t\trows: number\n\t} {\n\t\tif (this.longEventsDom == null && this.viewDom == null) {\n\t\t\treturn {\n\t\t\t\tchildren: null,\n\t\t\t\trows: 0,\n\t\t\t}\n\t\t}\n\t\tconst dayWidth =\n\t\t\t(this.longEventsDom != null ? this.longEventsDom.offsetWidth : this.viewDom!.offsetWidth - size.calendar_hour_width_mobile) / dayRange.length\n\t\tlet maxEventsInColumn = 0\n\t\tconst firstDay = dayRange[0]\n\t\tconst lastDay = lastThrow(dayRange)\n\t\tconst zone = getTimeZone()\n\t\tconst children = layOutEvents(\n\t\t\tevents,\n\t\t\tzone,\n\t\t\t(columns) => {\n\t\t\t\tmaxEventsInColumn = Math.max(maxEventsInColumn, columns.length)\n\t\t\t\treturn columns.map((rows, c) =>\n\t\t\t\t\trows.map((event) => {\n\t\t\t\t\t\tconst isAllDay = isAllDayEvent(event)\n\t\t\t\t\t\tconst eventEnd = isAllDay ? incrementDate(getEventEnd(event, zone), -1) : event.endTime\n\t\t\t\t\t\tconst dayOfStartDate = getDiffIn24hIntervals(firstDay, getEventStart(event, zone))\n\t\t\t\t\t\tconst dayOfEndDate = getDiffIn24hIntervals(firstDay, eventEnd)\n\t\t\t\t\t\tconst startsBefore = eventStartsBefore(firstDay, zone, event)\n\t\t\t\t\t\tconst endsAfter = eventEndsAfterDay(lastDay, zone, event)\n\t\t\t\t\t\tconst left = startsBefore ? 0 : dayOfStartDate * dayWidth\n\t\t\t\t\t\tconst right = endsAfter ? 0 : (dayRange.length - 1 - dayOfEndDate) * dayWidth\n\t\t\t\t\t\treturn m(\n\t\t\t\t\t\t\t\".abs\",\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\ttop: px(c * CALENDAR_EVENT_HEIGHT),\n\t\t\t\t\t\t\t\t\tleft: px(left),\n\t\t\t\t\t\t\t\t\tright: px(right),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tkey: event._id[0] + event._id[1] + event.startTime.getTime(),\n\t\t\t\t\t\t\t\tonmousedown: () => {\n\t\t\t\t\t\t\t\t\t// Only allow dragging all-day events on the desktop layout, since the header supports it\n\t\t\t\t\t\t\t\t\tif (styles.isDesktopLayout()) {\n\t\t\t\t\t\t\t\t\t\tthis.isHeaderEventBeingDragged = true\n\t\t\t\t\t\t\t\t\t\tthis.startEventDrag(event)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tthis.renderLongEventBubble(\n\t\t\t\t\t\t\t\tevent,\n\t\t\t\t\t\t\t\tisAllDay ? null : EventTextTimeOption.START_END_TIME,\n\t\t\t\t\t\t\t\tstartsBefore,\n\t\t\t\t\t\t\t\tendsAfter,\n\t\t\t\t\t\t\t\tgroupColors,\n\t\t\t\t\t\t\t\tonEventClicked,\n\t\t\t\t\t\t\t\tonEventKeyDown,\n\t\t\t\t\t\t\t\ttemporaryEvents.includes(event),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t)\n\t\t\t\t\t}),\n\t\t\t\t)\n\t\t\t},\n\t\t\tEventLayoutMode.DayBasedColumn,\n\t\t)\n\t\treturn {\n\t\t\tchildren,\n\t\t\trows: maxEventsInColumn,\n\t\t}\n\t}\n\n\tprivate renderLongEventBubble(\n\t\tevent: CalendarEvent,\n\t\tshowTime: EventTextTimeOption | null,\n\t\tstartsBefore: boolean,\n\t\tendsAfter: boolean,\n\t\tgroupColors: GroupColors,\n\t\tonEventClicked: CalendarEventBubbleClickHandler,\n\t\tonEventKeyDown: CalendarEventBubbleKeyDownHandler,\n\t\tisTemporary: boolean,\n\t): Children {\n\t\tconst fadeIn = !isTemporary\n\t\tconst opacity = isTemporary ? TEMPORARY_EVENT_OPACITY : 1\n\t\tconst enablePointerEvents = !this.eventDragHandler.isDragging && !isTemporary\n\t\treturn m(ContinuingCalendarEventBubble, {\n\t\t\tevent,\n\t\t\tstartsBefore,\n\t\t\tendsAfter,\n\t\t\tcolor: getEventColor(event, groupColors),\n\t\t\tonEventClicked,\n\t\t\tonEventKeyDown: onEventKeyDown,\n\t\t\tshowTime,\n\t\t\tuser: locator.logins.getUserController().user,\n\t\t\tfadeIn,\n\t\t\topacity,\n\t\t\tenablePointerEvents,\n\t\t})\n\t}\n\n\tprivate renderDayNamesRow(days: Array<Date>, weekIndicator: string | null, onDateSelected: (arg0: Date, arg1: CalendarViewType) => unknown): Children {\n\t\tif (days.length === 1 && weekIndicator == null) {\n\t\t\treturn null\n\t\t}\n\n\t\tconst rowSize = px(size.calendar_days_header_height)\n\n\t\treturn m(\n\t\t\t\".flex.mb-s\",\n\t\t\tweekIndicator ? m(\".calendar-hour-column.calendar-day-indicator.b.center-horizontally\", weekIndicator) : m(\".calendar-hour-margin\"),\n\t\t\tdays.length === 1\n\t\t\t\t? null\n\t\t\t\t: days.map((day) => {\n\t\t\t\t\t\t// the click handler is set on each child individually so as to not make the entire flex container clickable, only the text\n\t\t\t\t\t\tconst onclick = () => onDateSelected(day, CalendarViewType.DAY)\n\n\t\t\t\t\t\treturn m(\".flex.center-horizontally.flex-grow.center.b\", [\n\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\".calendar-day-indicator.clickable\",\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tonclick,\n\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t\"padding-right\": px(4),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tlang.formats.weekdayShort.format(day) + \" \",\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\".rel.click.flex.items-center.justify-center.rel.ml-hpad_small\",\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\"aria-label\": day.toLocaleDateString(),\n\t\t\t\t\t\t\t\t\tonclick,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\tm(\".abs.z1.circle\", {\n\t\t\t\t\t\t\t\t\t\tclass: isToday(day) ? \"calendar-current-day-circle\" : \"\",\n\t\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t\twidth: rowSize,\n\t\t\t\t\t\t\t\t\t\t\theight: rowSize,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\t\t\".full-width.height-100p.center.z2\",\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tclass: isToday(day) ? \"calendar-current-day-text\" : \"\",\n\t\t\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t\t\tfontSize: px(14),\n\t\t\t\t\t\t\t\t\t\t\t\tlineHeight: rowSize,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tday.getDate(),\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t])\n\t\t\t\t  }),\n\t\t)\n\t}\n\n\tprivate endDrag(pos: MousePos) {\n\t\tthis.isHeaderEventBeingDragged = false\n\n\t\tif (this.dateUnderMouse) {\n\t\t\tthis.eventDragHandler.endDrag(this.dateUnderMouse, pos).catch(ofClass(UserError, showUserError))\n\t\t}\n\t}\n\n\tprivate cancelDrag() {\n\t\tthis.eventDragHandler.cancelDrag()\n\t}\n}\n"]}