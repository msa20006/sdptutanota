{"version":3,"file":"GuestPicker.js","sourceRoot":"","sources":["../../../../../../src/calendar-app/calendar/gui/pickers/GuestPicker.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { ClassComponent, Vnode, VnodeDOM } from \"mithril\"\nimport { Select, SelectAttributes, SelectOption, SelectState } from \"../../../../common/gui/base/Select.js\"\nimport { Keys, TabIndex } from \"../../../../common/api/common/TutanotaConstants.js\"\nimport { SingleLineTextField } from \"../../../../common/gui/base/SingleLineTextField.js\"\nimport { debounceStart, getFirstOrThrow } from \"@tutao/tutanota-utils\"\nimport { Dialog } from \"../../../../common/gui/base/Dialog.js\"\nimport { lang, TranslationKey } from \"../../../../common/misc/LanguageViewModel.js\"\nimport { parseMailAddress, parsePastedInput, parseTypedInput } from \"../../../../common/gui/MailRecipientsTextField.js\"\nimport { Contact } from \"../../../../common/api/entities/tutanota/TypeRefs.js\"\nimport { RecipientSearchResultItem, RecipientsSearchModel } from \"../../../../common/misc/RecipientsSearchModel.js\"\nimport stream from \"mithril/stream\"\nimport { keyboardEventToKeyPress } from \"../../../../common/misc/KeyManager.js\"\nimport { theme } from \"../../../../common/gui/theme.js\"\nimport { Icons } from \"../../../../common/gui/base/icons/Icons.js\"\nimport { Icon } from \"../../../../common/gui/base/Icon.js\"\nimport { px, size } from \"../../../../common/gui/size.js\"\nimport { DefaultAnimationTime } from \"../../../../common/gui/animation/Animations.js\"\nimport { TextFieldType } from \"../../../../common/gui/base/TextField.js\"\n\nexport interface GuestPickerAttrs {\n\tariaLabel: TranslationKey\n\tonRecipientAdded: (address: string, name: string | null, contact: Contact | null) => void\n\tdisabled: boolean\n\tsearch: RecipientsSearchModel\n}\n\ninterface GuestItem extends SelectOption<RecipientSearchResultItem> {\n\tname: string\n\taddress?: string\n\ttype: string\n}\n\nexport class GuestPicker implements ClassComponent<GuestPickerAttrs> {\n\tprivate isExpanded: boolean = false\n\tprivate isFocused: boolean = false\n\tprivate value: string = \"\"\n\tprivate selected?: GuestItem\n\tprivate options: stream<Array<GuestItem>> = stream([])\n\tprivate selectDOM: VnodeDOM<SelectAttributes<GuestItem, RecipientSearchResultItem>> | null = null\n\n\tview({ attrs }: Vnode<GuestPickerAttrs>) {\n\t\treturn m(Select<GuestItem, RecipientSearchResultItem>, {\n\t\t\tclasses: [\"flex-grow\"],\n\t\t\tdropdownPosition: \"bottom\",\n\t\t\tonchange: ({ value: guest }) => {\n\t\t\t\tthis.handleSelection(attrs, guest)\n\t\t\t},\n\t\t\tonclose: () => {\n\t\t\t\tthis.isExpanded = false\n\t\t\t},\n\t\t\toncreate: (node: VnodeDOM<SelectAttributes<GuestItem, RecipientSearchResultItem>>) => {\n\t\t\t\tthis.selectDOM = node\n\t\t\t},\n\t\t\tselected: this.selected,\n\t\t\tariaLabel: attrs.ariaLabel,\n\t\t\tdisabled: attrs.disabled,\n\t\t\toptions: this.options,\n\t\t\tnoIcon: true,\n\t\t\texpanded: true,\n\t\t\ttabIndex: Number(TabIndex.Programmatic),\n\t\t\tplaceholder: this.renderSearchInput(attrs),\n\t\t\trenderDisplay: () => this.renderSearchInput(attrs),\n\t\t\trenderOption: (option) => this.renderSuggestionItem(option === this.selected, option),\n\t\t\tkeepFocus: true,\n\t\t} satisfies SelectAttributes<GuestItem, RecipientSearchResultItem>)\n\t}\n\n\tprivate renderSuggestionItem(selected: boolean, option: GuestItem) {\n\t\tconst firstRow =\n\t\t\toption.value.type === \"recipient\"\n\t\t\t\t? option.value.value.name\n\t\t\t\t: m(Icon, {\n\t\t\t\t\t\ticon: Icons.People,\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tfill: theme.content_fg,\n\t\t\t\t\t\t\t\"aria-describedby\": lang.get(\"contactListName_label\"),\n\t\t\t\t\t\t},\n\t\t\t\t  })\n\t\tconst secondRow = option.value.type === \"recipient\" ? option.value.value.address : option.value.value.name\n\t\treturn m(\n\t\t\t\".pt-s.pb-s.click.content-hover.button-min-height\",\n\t\t\t{\n\t\t\t\tclass: selected ? \"content-accent-fg row-selected icon-accent\" : \"\",\n\t\t\t\tstyle: {\n\t\t\t\t\t\"padding-left\": selected ? px(size.hpad_large - 3) : px(size.hpad_large),\n\t\t\t\t\t\"border-left\": selected ? \"3px solid\" : null,\n\t\t\t\t},\n\t\t\t},\n\t\t\t[m(\".small.full-width.text-ellipsis\", firstRow), m(\".name.full-width.text-ellipsis\", secondRow)],\n\t\t)\n\t}\n\n\tprivate async handleSelection(attrs: GuestPickerAttrs, guest: RecipientSearchResultItem) {\n\t\tif (guest.value != null) {\n\t\t\tif (guest.type === \"recipient\") {\n\t\t\t\tconst { address, name, contact } = guest.value\n\t\t\t\tattrs.onRecipientAdded(address, name, contact)\n\t\t\t\tattrs.search.clear()\n\t\t\t\tthis.value = \"\"\n\t\t\t} else {\n\t\t\t\tthis.value = \"\"\n\t\t\t\tconst recipients = await attrs.search.resolveContactList(guest.value)\n\t\t\t\tfor (const { address, name, contact } of recipients) {\n\t\t\t\t\tattrs.onRecipientAdded(address, name, contact)\n\t\t\t\t}\n\t\t\t\tattrs.search.clear()\n\t\t\t\tm.redraw()\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate renderSearchInput(attrs: GuestPickerAttrs) {\n\t\treturn m(SingleLineTextField, {\n\t\t\tclasses: [\"height-100p\"],\n\t\t\tvalue: this.value,\n\t\t\tplaceholder: lang.get(\"addGuest_label\"),\n\t\t\tonclick: (e: MouseEvent) => {\n\t\t\t\te.stopImmediatePropagation()\n\t\t\t\tif (!this.isExpanded && this.value.length > 0 && this.selectDOM) {\n\t\t\t\t\t;(this.selectDOM.dom as HTMLElement).click()\n\t\t\t\t\tthis.isExpanded = true\n\t\t\t\t}\n\t\t\t},\n\t\t\toninput: (val: string) => {\n\t\t\t\tif (val.length > 0 && !this.isExpanded && this.selectDOM) {\n\t\t\t\t\t;(this.selectDOM.dom as HTMLElement).click()\n\t\t\t\t\tthis.isExpanded = true\n\t\t\t\t}\n\n\t\t\t\t// if the new text length is more than one character longer,\n\t\t\t\t// it means the user pasted the text in, so we want to try and resolve a list of contacts\n\t\t\t\tconst { remainingText, newRecipients, errors } = val.length - this.value.length > 1 ? parsePastedInput(val) : parseTypedInput(val)\n\n\t\t\t\tfor (const { address, name } of newRecipients) {\n\t\t\t\t\tattrs.onRecipientAdded(address, name, null)\n\t\t\t\t}\n\n\t\t\t\tif (errors.length === 1 && newRecipients.length === 0) {\n\t\t\t\t\t// if there was a single recipient and it was invalid then just pretend nothing happened\n\t\t\t\t\tthis.value = getFirstOrThrow(errors)\n\t\t\t\t} else {\n\t\t\t\t\tif (errors.length > 0) {\n\t\t\t\t\t\tDialog.message(lang.makeTranslation(\"error_message\", `${lang.get(\"invalidPastedRecipients_msg\")}\\n\\n${errors.join(\"\\n\")}`))\n\t\t\t\t\t}\n\t\t\t\t\tthis.value = remainingText\n\t\t\t\t}\n\n\t\t\t\tthis.doSearch(val, attrs)\n\t\t\t},\n\t\t\tdisabled: attrs.disabled,\n\t\t\tariaLabel: attrs.ariaLabel,\n\t\t\tonfocus: (event: FocusEvent) => {\n\t\t\t\tthis.isFocused = true\n\t\t\t},\n\t\t\tonblur: (e: any) => {\n\t\t\t\tif (this.isFocused) {\n\t\t\t\t\tthis.resolveInput(attrs, false)\n\t\t\t\t\tthis.isFocused = false\n\t\t\t\t}\n\n\t\t\t\te.redraw = false\n\t\t\t},\n\t\t\tonkeydown: (event: KeyboardEvent) => this.handleKeyDown(event, attrs),\n\t\t\ttype: TextFieldType.Text,\n\t\t})\n\t}\n\n\tprivate doSearch = debounceStart(DefaultAnimationTime, (val: string, attrs: GuestPickerAttrs) => {\n\t\tattrs.search.search(val).then(() => {\n\t\t\tconst searchResult = attrs.search.results()\n\n\t\t\tif (searchResult.length === 0) {\n\t\t\t\tthis.selected = undefined\n\t\t\t}\n\n\t\t\tthis.options(\n\t\t\t\tsearchResult.map((option) => ({\n\t\t\t\t\tname: option.value.name,\n\t\t\t\t\tvalue: option,\n\t\t\t\t\ttype: option.type,\n\t\t\t\t\tariaValue: option.value.name,\n\t\t\t\t})),\n\t\t\t)\n\n\t\t\tm.redraw()\n\t\t})\n\t})\n\n\tprivate handleKeyDown(event: KeyboardEvent, attrs: GuestPickerAttrs) {\n\t\tconst keyPress = keyboardEventToKeyPress(event)\n\n\t\tswitch (keyPress.key.toLowerCase()) {\n\t\t\tcase Keys.RETURN.code:\n\t\t\t\tthis.resolveInput(attrs, true)\n\t\t\t\tbreak\n\t\t\tcase Keys.DOWN.code:\n\t\t\t\tthis.moveSelection(true)\n\t\t\t\tevent.stopImmediatePropagation()\n\t\t\t\treturn false\n\t\t\tcase Keys.UP.code:\n\t\t\t\tthis.moveSelection(false)\n\t\t\t\tevent.stopImmediatePropagation()\n\t\t\t\treturn false\n\t\t}\n\n\t\treturn true\n\t}\n\n\tprivate moveSelection(forward: boolean) {\n\t\tconst selectedIndex = this.selected ? this.options().indexOf(this.selected) : -1\n\t\tconst optionsLength = this.options().length\n\n\t\tlet newIndex\n\t\tif (forward) {\n\t\t\tnewIndex = selectedIndex + 1 < optionsLength ? selectedIndex + 1 : 0\n\t\t} else {\n\t\t\tnewIndex = selectedIndex - 1 >= 0 ? selectedIndex - 1 : optionsLength - 1\n\t\t}\n\n\t\tthis.selected = this.options()[newIndex]\n\t}\n\n\tprivate async selectSuggestion(attrs: GuestPickerAttrs) {\n\t\tif (this.selected == null) {\n\t\t\treturn\n\t\t}\n\n\t\tif (this.selected.value.type === \"recipient\") {\n\t\t\tconst { address, name, contact } = this.selected.value.value\n\t\t\tattrs.onRecipientAdded(address, name, contact)\n\t\t\tattrs.search.clear()\n\t\t\tthis.value = \"\"\n\t\t} else {\n\t\t\tattrs.search.clear()\n\t\t\tthis.value = \"\"\n\t\t\tconst recipients = await attrs.search.resolveContactList(this.selected.value.value)\n\t\t\tfor (const { address, name, contact } of recipients) {\n\t\t\t\tattrs.onRecipientAdded(address, name, contact)\n\t\t\t}\n\t\t\tm.redraw()\n\t\t}\n\n\t\tthis.closePicker()\n\t}\n\n\t/**\n\t * Resolves a typed in mail address or one of the suggested ones.\n\t * @param attrs\n\t * @param selectSuggestion boolean value indicating whether a suggestion should be selected or not. Should be true if a suggestion is explicitly selected by\n\t * for example hitting the enter key and false e.g. if the dialog is closed\n\t */\n\tprivate resolveInput(attrs: GuestPickerAttrs, selectSuggestion: boolean) {\n\t\tconst suggestions = attrs.search.results()\n\t\tif (suggestions.length > 0 && selectSuggestion) {\n\t\t\tthis.selectSuggestion(attrs)\n\t\t} else {\n\t\t\tconst parsed = parseMailAddress(this.value)\n\t\t\tif (parsed != null) {\n\t\t\t\tattrs.onRecipientAdded(parsed.address, parsed.name, null)\n\t\t\t\tthis.value = \"\"\n\t\t\t\tthis.closePicker()\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate closePicker() {\n\t\tif (this.selectDOM) {\n\t\t\t;(this.selectDOM.state as SelectState).dropdownContainer?.onClose()\n\t\t}\n\t}\n}\n"]}