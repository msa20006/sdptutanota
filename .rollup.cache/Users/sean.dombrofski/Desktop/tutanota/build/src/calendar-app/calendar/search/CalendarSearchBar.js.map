{"version":3,"file":"CalendarSearchBar.js","sourceRoot":"","sources":["../../../../../src/calendar-app/calendar/search/CalendarSearchBar.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Component, Vnode } from \"mithril\"\nimport { px, size } from \"../../../common/gui/size\"\nimport stream from \"mithril/stream\"\nimport Stream from \"mithril/stream\"\nimport type { PositionRect } from \"../../../common/gui/base/Overlay\"\nimport { displayOverlay } from \"../../../common/gui/base/Overlay\"\nimport type { CalendarEvent } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport type { Shortcut } from \"../../../common/misc/KeyManager\"\nimport { isKeyPressed, keyManager } from \"../../../common/misc/KeyManager\"\nimport { encodeCalendarSearchKey, getRestriction } from \"./model/SearchUtils\"\nimport { FULL_INDEXED_TIMESTAMP, Keys } from \"../../../common/api/common/TutanotaConstants\"\nimport { assertMainOrNode, isApp } from \"../../../common/api/common/Env\"\nimport { styles } from \"../../../common/gui/styles\"\nimport { client } from \"../../../common/misc/ClientDetector\"\nimport { debounce, downcast, memoized, mod, TypeRef } from \"@tutao/tutanota-utils\"\nimport { BrowserType } from \"../../../common/misc/ClientConstants\"\nimport { hasMoreResults } from \"./model/CalendarSearchModel.js\"\nimport type { SearchRestriction, SearchResult } from \"../../../common/api/worker/search/SearchTypes\"\nimport { LayerType } from \"../../../RootView\"\nimport { BaseSearchBar, BaseSearchBarAttrs } from \"../../../common/gui/base/BaseSearchBar.js\"\nimport { generateCalendarInstancesInRange, isClientOnlyCalendar, retrieveClientOnlyEventsForUser } from \"../../../common/calendar/date/CalendarUtils.js\"\n\nimport { loadMultipleFromLists } from \"../../../common/api/common/EntityClient.js\"\nimport { SearchRouter } from \"../../../common/search/view/SearchRouter.js\"\nimport { calendarLocator } from \"../../calendarLocator.js\"\nimport { CalendarSearchBarOverlay } from \"./CalendarSearchBarOverlay.js\"\n\nassertMainOrNode()\nexport type ShowMoreAction = {\n\tresultCount: number\n\tshownCount: number\n\tindexTimestamp: number\n\tallowShowMore: boolean\n}\nexport type CalendarSearchBarAttrs = {\n\tplaceholder?: string | null\n\treturnListener?: (() => unknown) | null\n\tdisabled?: boolean\n}\n\nconst MAX_SEARCH_PREVIEW_RESULTS = 10\nexport type Entry = CalendarEvent | ShowMoreAction\ntype Entries = Array<Entry>\nexport type CalendarSearchBarState = {\n\tquery: string\n\tsearchResult: SearchResult | null\n\tentities: Entries\n\tselected: Entry | null\n}\n\n// create our own copy which is not perfect because we don't benefit from the shared cache but currently there's no way to get async dependencies into\n// singletons like this (without top-level await at least)\n// once SearchBar is rewritten this should be removed\nconst searchRouter = new SearchRouter(calendarLocator.throttledRouter())\n\nexport class CalendarSearchBar implements Component<CalendarSearchBarAttrs> {\n\tfocused: boolean = false\n\tprivate readonly state: Stream<CalendarSearchBarState>\n\tbusy: boolean = false\n\tprivate closeOverlayFunction: (() => void) | null = null\n\tprivate readonly overlayContentComponent: Component\n\tprivate domWrapper!: HTMLElement\n\tprivate domInput!: HTMLElement\n\tprivate indexStateStream: Stream<unknown> | null = null\n\tprivate stateStream: Stream<unknown> | null = null\n\tprivate lastQueryStream: Stream<unknown> | null = null\n\n\tconstructor() {\n\t\tthis.state = stream<CalendarSearchBarState>({\n\t\t\tquery: \"\",\n\t\t\tsearchResult: null,\n\t\t\tentities: [] as Entries,\n\t\t\tselected: null,\n\t\t})\n\t\tthis.overlayContentComponent = {\n\t\t\tview: () => {\n\t\t\t\treturn m(CalendarSearchBarOverlay, {\n\t\t\t\t\tstate: this.state(),\n\t\t\t\t\tisQuickSearch: this.isQuickSearch(),\n\t\t\t\t\tisFocused: this.focused,\n\t\t\t\t\tselectResult: (selected) => this.selectResult(selected),\n\t\t\t\t})\n\t\t\t},\n\t\t}\n\n\t\tthis.view = this.view.bind(this)\n\t\tthis.oncreate = this.oncreate.bind(this)\n\t\tthis.onremove = this.onremove.bind(this)\n\t}\n\n\t/**\n\t * this reacts to URL changes by clearing the suggestions - the selected item may have changed\n\t * that shouldn't clear our current state, but if the URL changed in a way that makes the previous state outdated, we clear it.\n\t */\n\tprivate readonly onPathChange = memoized((newPath: string) => {\n\t\tif (calendarLocator.search.isNewSearch(this.state().query, getRestriction(newPath))) {\n\t\t\tthis.updateState({\n\t\t\t\tsearchResult: null,\n\t\t\t\tselected: null,\n\t\t\t\tentities: [],\n\t\t\t})\n\t\t}\n\t})\n\n\tview(vnode: Vnode<CalendarSearchBarAttrs>) {\n\t\tthis.onPathChange(m.route.get())\n\n\t\treturn m(BaseSearchBar, {\n\t\t\tplaceholder: vnode.attrs.placeholder,\n\t\t\ttext: this.state().query,\n\t\t\tbusy: this.busy,\n\t\t\tdisabled: vnode.attrs.disabled,\n\t\t\tonInput: (text) => this.search(text),\n\t\t\tonSearchClick: () => this.handleSearchClick(),\n\t\t\tonClear: () => {\n\t\t\t\tthis.clear()\n\t\t\t},\n\t\t\tonWrapperCreated: (dom) => {\n\t\t\t\tthis.domWrapper = dom\n\t\t\t\tthis.showOverlay()\n\t\t\t},\n\t\t\tonInputCreated: (dom) => {\n\t\t\t\tthis.domInput = dom\n\t\t\t},\n\t\t\tonFocus: () => (this.focused = true),\n\t\t\tonBlur: () => this.onBlur(),\n\t\t\tonKeyDown: (e) => this.onkeydown(e),\n\t\t} satisfies BaseSearchBarAttrs)\n\t}\n\n\tprivate readonly onkeydown = (e: KeyboardEvent) => {\n\t\tconst { selected, entities } = this.state()\n\n\t\tconst keyHandlers = [\n\t\t\t{\n\t\t\t\tkey: Keys.F1,\n\t\t\t\texec: () => keyManager.openF1Help(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.ESC,\n\t\t\t\texec: () => this.clear(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.RETURN,\n\t\t\t\texec: () => {\n\t\t\t\t\tif (selected) {\n\t\t\t\t\t\tthis.selectResult(selected)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.search()\n\t\t\t\t\t}\n\t\t\t\t\t// blur() is used to hide keyboard on return button click\n\t\t\t\t\tthis.domInput.blur()\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.UP,\n\t\t\t\texec: () => {\n\t\t\t\t\tif (entities.length > 0) {\n\t\t\t\t\t\tlet oldSelected = selected || entities[0]\n\n\t\t\t\t\t\tthis.updateState({\n\t\t\t\t\t\t\tselected: entities[mod(entities.indexOf(oldSelected) - 1, entities.length)],\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.DOWN,\n\t\t\t\texec: () => {\n\t\t\t\t\tif (entities.length > 0) {\n\t\t\t\t\t\tlet newSelected = selected || entities[0]\n\n\t\t\t\t\t\tthis.updateState({\n\t\t\t\t\t\t\tselected: entities[mod(entities.indexOf(newSelected) + 1, entities.length)],\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t]\n\t\tlet keyHandler = keyHandlers.find((handler) => isKeyPressed(e.key, handler.key))\n\n\t\tif (keyHandler) {\n\t\t\tkeyHandler.exec()\n\t\t\te.preventDefault()\n\t\t}\n\n\t\t// disable shortcuts\n\t\te.stopPropagation()\n\t\treturn true\n\t}\n\n\toncreate() {\n\t\tif (isApp()) {\n\t\t\t// only focus in the mobile app, the search bar always exists in desktop/web and will always be grabbing attention\n\t\t\tthis.onFocus()\n\t\t}\n\t\tkeyManager.registerShortcuts(this.shortcuts)\n\t\tthis.stateStream = this.state.map((state) => m.redraw())\n\t\tthis.lastQueryStream = calendarLocator.search.lastQueryString.map((value) => {\n\t\t\t// Set value from the model when it's set from the URL e.g. reloading the page on the search screen\n\t\t\tif (value) {\n\t\t\t\tthis.updateState({\n\t\t\t\t\tquery: value,\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t}\n\n\tonremove() {\n\t\tthis.focused = false\n\n\t\tif (this.shortcuts) keyManager.unregisterShortcuts(this.shortcuts)\n\n\t\tthis.stateStream?.end(true)\n\n\t\tthis.lastQueryStream?.end(true)\n\n\t\tthis.indexStateStream?.end(true)\n\n\t\tthis.closeOverlay()\n\t}\n\n\tprivate timePeriodHasChanged(oldEnd: number | null, aimedEnd: number): boolean {\n\t\treturn oldEnd !== aimedEnd\n\t}\n\n\t/**\n\t * Ensure that overlay exists in DOM\n\t */\n\tprivate showOverlay() {\n\t\tif (this.closeOverlayFunction == null && this.domWrapper != null) {\n\t\t\tthis.closeOverlayFunction = displayOverlay(\n\t\t\t\t() => this.makeOverlayRect(),\n\t\t\t\tthis.overlayContentComponent,\n\t\t\t\tundefined,\n\t\t\t\tundefined,\n\t\t\t\t\"dropdown-shadow border-radius\",\n\t\t\t)\n\t\t} else {\n\t\t\tm.redraw()\n\t\t}\n\t}\n\n\tprivate closeOverlay() {\n\t\tif (this.closeOverlayFunction) {\n\t\t\tthis.closeOverlayFunction()\n\n\t\t\tthis.closeOverlayFunction = null\n\t\t}\n\t}\n\n\tprivate makeOverlayRect(): PositionRect {\n\t\t// note: this is called on every render which probably thrashes our layout constantly.\n\t\t// we should at least not do it while we don't have anything to show\n\t\tlet overlayRect: PositionRect\n\n\t\tconst domRect = this.domWrapper.getBoundingClientRect()\n\n\t\tif (styles.isDesktopLayout()) {\n\t\t\toverlayRect = {\n\t\t\t\ttop: px(domRect.bottom + 5),\n\t\t\t\tright: px(window.innerWidth - domRect.right),\n\t\t\t\twidth: px(350),\n\t\t\t\tzIndex: LayerType.LowPriorityOverlay,\n\t\t\t}\n\t\t} else if (window.innerWidth < 500) {\n\t\t\toverlayRect = {\n\t\t\t\ttop: px(size.navbar_height_mobile + 6),\n\t\t\t\tleft: px(16),\n\t\t\t\tright: px(16),\n\t\t\t\tzIndex: LayerType.LowPriorityOverlay,\n\t\t\t}\n\t\t} else {\n\t\t\toverlayRect = {\n\t\t\t\ttop: px(size.navbar_height_mobile + 6),\n\t\t\t\tleft: px(domRect.left),\n\t\t\t\tright: px(window.innerWidth - domRect.right),\n\t\t\t\tzIndex: LayerType.LowPriorityOverlay,\n\t\t\t}\n\t\t}\n\n\t\treturn overlayRect\n\t}\n\n\tprivate readonly shortcuts: ReadonlyArray<Shortcut> = [\n\t\t{\n\t\t\tkey: Keys.F,\n\t\t\tenabled: () => true,\n\t\t\texec: () => {\n\t\t\t\tthis.onFocus()\n\t\t\t\tm.redraw()\n\t\t\t},\n\t\t\thelp: \"search_label\",\n\t\t},\n\t]\n\n\tprivate selectResult(result: CalendarEvent | ShowMoreAction | null) {\n\t\tconst { query } = this.state()\n\n\t\tif (result != null) {\n\t\t\tlet type: TypeRef<any> | null = \"_type\" in result ? result._type : null\n\n\t\t\tif (!type) {\n\t\t\t\t// click on SHOW MORE button\n\t\t\t\tif ((result as ShowMoreAction).allowShowMore) {\n\t\t\t\t\tthis.updateSearchUrl(query)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.updateSearchUrl(query, downcast(result))\n\t\t\t}\n\t\t}\n\t}\n\n\thandleSearchClick() {\n\t\tif (!this.focused) {\n\t\t\tthis.onFocus()\n\t\t} else {\n\t\t\tthis.search()\n\t\t}\n\t}\n\n\tprivate getRestriction(): SearchRestriction {\n\t\treturn getRestriction(m.route.get())\n\t}\n\n\tprivate updateSearchUrl(query: string, selected?: CalendarEvent) {\n\t\tsearchRouter.routeTo(query, this.getRestriction(), selected && encodeCalendarSearchKey(selected))\n\t}\n\n\tprivate search(query?: string) {\n\t\tlet oldQuery = this.state().query\n\n\t\tif (query != null) {\n\t\t\tthis.updateState({\n\t\t\t\tquery,\n\t\t\t})\n\t\t} else {\n\t\t\tquery = oldQuery\n\t\t}\n\n\t\tlet restriction = this.getRestriction()\n\n\t\tif (!calendarLocator.search.isNewSearch(query, restriction) && oldQuery === query) {\n\t\t\tconst result = calendarLocator.search.result()\n\n\t\t\tif (this.isQuickSearch() && result) {\n\t\t\t\tthis.showResultsInOverlay(result)\n\t\t\t}\n\n\t\t\tthis.busy = false\n\t\t} else {\n\t\t\tif (query.trim() !== \"\") {\n\t\t\t\tthis.busy = true\n\t\t\t}\n\n\t\t\tthis.doSearch(query, restriction, () => {\n\t\t\t\tthis.busy = false\n\t\t\t\tm.redraw()\n\t\t\t})\n\t\t}\n\t}\n\n\tprivate readonly doSearch = debounce(300, (query: string, restriction: SearchRestriction, cb: () => void) => {\n\t\tif (!this.isQuickSearch()) {\n\t\t\t// if we're already on the search view, we don't want to wait until there's a new result to update the\n\t\t\t// UI. we can directly go to the URL and let the SearchViewModel do its thing from there.\n\t\t\tsearchRouter.routeTo(query, restriction)\n\t\t\treturn cb()\n\t\t}\n\n\t\tlet useSuggestions = m.route.get().startsWith(\"/settings\")\n\t\t// This is a vestige of the searchbar for mail, keeping just in case\n\t\t// we do not need to limit calendar events since they are local\n\t\tconst limit = null\n\n\t\tcalendarLocator.search\n\t\t\t.search(\n\t\t\t\t{\n\t\t\t\t\tquery: query ?? \"\",\n\t\t\t\t\trestriction,\n\t\t\t\t\tminSuggestionCount: useSuggestions ? 10 : 0,\n\t\t\t\t\tmaxResults: limit,\n\t\t\t\t},\n\t\t\t\tcalendarLocator.progressTracker,\n\t\t\t)\n\t\t\t.then((result) => this.loadAndDisplayResult(query, result ? result : null, limit))\n\t\t\t.finally(() => cb())\n\t})\n\n\t/** Given the result from the search load additional results if needed and then display them or set URL. */\n\tprivate loadAndDisplayResult(query: string, result: SearchResult | null, limit: number | null) {\n\t\tconst safeResult = result,\n\t\t\tsafeLimit = limit\n\n\t\tthis.updateState({\n\t\t\tsearchResult: safeResult,\n\t\t})\n\n\t\tif (!safeResult || calendarLocator.search.isNewSearch(query, safeResult.restriction)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (this.isQuickSearch()) {\n\t\t\t// Calendar does not have a quick search bar, so this has been taken out\n\t\t\t// but this is left in case this changes in the future\n\t\t} else {\n\t\t\t// instances will be displayed as part of the list of the search view, when the search view is displayed\n\t\t\tsearchRouter.routeTo(query, safeResult.restriction)\n\t\t}\n\t}\n\n\tprivate clear() {\n\t\tif (m.route.get().startsWith(\"/search\")) {\n\t\t\t// this needs to happen in this order, otherwise the list's result subscription will override our\n\t\t\t// routing.\n\t\t\tthis.updateSearchUrl(\"\")\n\t\t\tcalendarLocator.search.result(null)\n\t\t}\n\n\t\tthis.updateState({\n\t\t\tquery: \"\",\n\t\t\tentities: [],\n\t\t\tselected: null,\n\t\t\tsearchResult: null,\n\t\t})\n\t}\n\n\tprivate async showResultsInOverlay(result: SearchResult): Promise<void> {\n\t\tconst filteredEvents = result.results.filter(([calendarId, eventId]) => !isClientOnlyCalendar(calendarId))\n\n\t\tconst eventsRepository = await calendarLocator.calendarEventsRepository()\n\t\tconst entries = [\n\t\t\t...(await loadMultipleFromLists(result.restriction.type, calendarLocator.entityClient, filteredEvents)),\n\t\t\t...(await retrieveClientOnlyEventsForUser(calendarLocator.logins, result.results, eventsRepository.getBirthdayEvents())),\n\t\t]\n\n\t\t// If there was no new search while we've been downloading the result\n\t\tif (!calendarLocator.search.isNewSearch(result.query, result.restriction)) {\n\t\t\tconst { filteredEntries, couldShowMore } = this.filterResults(entries, result.restriction)\n\n\t\t\tif (\n\t\t\t\tresult.query.trim() !== \"\" &&\n\t\t\t\t(filteredEntries.length === 0 || hasMoreResults(result) || couldShowMore || result.currentIndexTimestamp !== FULL_INDEXED_TIMESTAMP)\n\t\t\t) {\n\t\t\t\tconst moreEntry: ShowMoreAction = {\n\t\t\t\t\tresultCount: result.results.length,\n\t\t\t\t\tshownCount: filteredEntries.length,\n\t\t\t\t\tindexTimestamp: result.currentIndexTimestamp,\n\t\t\t\t\tallowShowMore: true,\n\t\t\t\t}\n\t\t\t\tfilteredEntries.push(moreEntry)\n\t\t\t}\n\n\t\t\tthis.updateState({\n\t\t\t\tentities: filteredEntries,\n\t\t\t\tselected: filteredEntries[0],\n\t\t\t})\n\t\t}\n\t}\n\n\tprivate isQuickSearch(): boolean {\n\t\treturn !m.route.get().startsWith(\"/search\")\n\t}\n\n\tprivate filterResults(\n\t\tinstances: Array<Entry>,\n\t\trestriction: SearchRestriction,\n\t): {\n\t\tfilteredEntries: Entries\n\t\tcouldShowMore: boolean\n\t} {\n\t\tconst range = { start: restriction.start ?? 0, end: restriction.end ?? 0 }\n\t\tconst generatedInstances = generateCalendarInstancesInRange(downcast(instances), range, MAX_SEARCH_PREVIEW_RESULTS + 1)\n\t\treturn {\n\t\t\tfilteredEntries: generatedInstances.slice(0, MAX_SEARCH_PREVIEW_RESULTS),\n\t\t\tcouldShowMore: generatedInstances.length > MAX_SEARCH_PREVIEW_RESULTS,\n\t\t}\n\t}\n\n\tprivate onFocus() {\n\t\tif (!this.focused) {\n\t\t\tthis.focused = true\n\t\t\t// setTimeout to fix bug in current Safari with losing focus\n\t\t\tsetTimeout(\n\t\t\t\t() => {\n\t\t\t\t\tthis.domInput.focus()\n\n\t\t\t\t\tthis.search()\n\t\t\t\t},\n\t\t\t\tclient.browser === BrowserType.SAFARI ? 200 : 0,\n\t\t\t)\n\t\t}\n\t}\n\n\tprivate onBlur() {\n\t\tthis.focused = false\n\n\t\tif (this.state().query === \"\") {\n\t\t\tif (m.route.get().startsWith(\"/search\")) {\n\t\t\t\tconst restriction = searchRouter.getRestriction()\n\t\t\t\tsearchRouter.routeTo(\"\", restriction)\n\t\t\t}\n\t\t}\n\t\tm.redraw()\n\t}\n\n\tprivate updateState(update: Partial<CalendarSearchBarState>): CalendarSearchBarState {\n\t\tconst newState = Object.assign({}, this.state(), update)\n\n\t\tthis.state(newState)\n\n\t\treturn newState\n\t}\n}\n\n// Should be changed to not be a singleton and be proper component (instantiated by mithril).\n// We need to extract some state of it into some kind of viewModel, pluggable depending on the current view but this requires complete rewrite of SearchBar.\nexport const searchBar = new CalendarSearchBar()\n"]}