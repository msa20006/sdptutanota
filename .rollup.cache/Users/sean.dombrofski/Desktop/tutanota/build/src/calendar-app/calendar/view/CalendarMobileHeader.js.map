{"version":3,"file":"CalendarMobileHeader.js","sourceRoot":"","sources":["../../../../../src/calendar-app/calendar/view/CalendarMobileHeader.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { IconButton } from \"../../../common/gui/base/IconButton.js\"\nimport { ViewSlider } from \"../../../common/gui/nav/ViewSlider.js\"\nimport { BaseMobileHeader } from \"../../../common/gui/BaseMobileHeader.js\"\nimport { OfflineIndicator } from \"../../../common/gui/base/OfflineIndicator.js\"\nimport { ProgressBar } from \"../../../common/gui/base/ProgressBar.js\"\nimport { CalendarNavConfiguration, getIconForViewType } from \"../gui/CalendarGuiUtils.js\"\nimport { MobileHeaderBackButton, MobileHeaderMenuButton, MobileHeaderTitle } from \"../../../common/gui/MobileHeader.js\"\nimport { AppHeaderAttrs } from \"../../../common/gui/Header.js\"\nimport { attachDropdown } from \"../../../common/gui/base/Dropdown.js\"\nimport { lang, TranslationKey } from \"../../../common/misc/LanguageViewModel.js\"\nimport { styles } from \"../../../common/gui/styles.js\"\nimport { theme } from \"../../../common/gui/theme.js\"\nimport { ClickHandler } from \"../../../common/gui/base/GuiUtils.js\"\nimport { TodayIconButton } from \"./TodayIconButton.js\"\nimport { ExpanderButton } from \"../../../common/gui/base/Expander.js\"\nimport { isApp } from \"../../../common/api/common/Env.js\"\nimport { BootIcons } from \"../../../common/gui/base/icons/BootIcons.js\"\nimport { locator } from \"../../../common/api/main/CommonLocator.js\"\nimport { NavButton } from \"../../../common/gui/base/NavButton.js\"\nimport { CalendarViewType } from \"../../../common/api/common/utils/CommonCalendarUtils.js\"\nimport { Icons } from \"../../../common/gui/base/icons/Icons.js\"\nimport { client } from \"../../../common/misc/ClientDetector.js\"\n\nexport interface CalendarMobileHeaderAttrs extends AppHeaderAttrs {\n\tviewType: CalendarViewType\n\tviewSlider: ViewSlider\n\tnavConfiguration: CalendarNavConfiguration\n\tonCreateEvent: () => unknown\n\tonToday: () => unknown\n\tonViewTypeSelected: (viewType: CalendarViewType) => unknown\n\tonTap?: ClickHandler\n\tshowExpandIcon: boolean\n\tisDaySelectorExpanded: boolean\n}\n\n/**\n * A special header that is used instead of {@link MobileHeader} but just for calendar.\n */\nexport class CalendarMobileHeader implements Component<CalendarMobileHeaderAttrs> {\n\tview({ attrs }: Vnode<CalendarMobileHeaderAttrs>): Children {\n\t\treturn m(BaseMobileHeader, {\n\t\t\tleft: this.renderTopLeftButton(attrs),\n\t\t\tcenter: m(MobileHeaderTitle, {\n\t\t\t\ttitle: attrs.showExpandIcon\n\t\t\t\t\t? m(ExpanderButton, {\n\t\t\t\t\t\t\tlabel: lang.makeTranslation(attrs.navConfiguration.title, attrs.navConfiguration.title),\n\t\t\t\t\t\t\tisUnformattedLabel: true,\n\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\"padding-top\": \"inherit\",\n\t\t\t\t\t\t\t\theight: \"inherit\",\n\t\t\t\t\t\t\t\t\"min-height\": \"inherit\",\n\t\t\t\t\t\t\t\t\"text-decoration\": \"none\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\texpanded: attrs.isDaySelectorExpanded,\n\t\t\t\t\t\t\tcolor: theme.content_fg,\n\t\t\t\t\t\t\tisBig: true,\n\t\t\t\t\t\t\tisPropagatingEvents: true,\n\t\t\t\t\t\t\tonExpandedChange: () => {},\n\t\t\t\t\t  })\n\t\t\t\t\t: attrs.navConfiguration.title,\n\t\t\t\tbottom: m(OfflineIndicator, attrs.offlineIndicatorModel.getCurrentAttrs()),\n\t\t\t\tonTap: attrs.onTap,\n\t\t\t}),\n\t\t\tright: [\n\t\t\t\tthis.renderDateNavigation(attrs),\n\t\t\t\tm(TodayIconButton, {\n\t\t\t\t\tclick: attrs.onToday,\n\t\t\t\t}),\n\t\t\t\tthis.renderViewSelector(attrs),\n\t\t\t\tclient.isCalendarApp()\n\t\t\t\t\t? this.renderSearchNavigationButton()\n\t\t\t\t\t: m(IconButton, {\n\t\t\t\t\t\t\ticon: Icons.Add,\n\t\t\t\t\t\t\ttitle: \"newEvent_action\",\n\t\t\t\t\t\t\tclick: attrs.onCreateEvent,\n\t\t\t\t\t  }),\n\t\t\t],\n\t\t\tinjections: m(ProgressBar, { progress: attrs.offlineIndicatorModel.getProgress() }),\n\t\t})\n\t}\n\n\tprivate renderTopLeftButton(attrs: CalendarMobileHeaderAttrs) {\n\t\tif (attrs.viewType === CalendarViewType.AGENDA && history.state?.origin === CalendarViewType.MONTH) {\n\t\t\treturn m(MobileHeaderBackButton, {\n\t\t\t\tbackAction: () => {\n\t\t\t\t\tconst date = history.state.dateString ?? new Date().toISOString().substring(0, 10)\n\t\t\t\t\tm.route.set(\"/calendar/:view/:date\", {\n\t\t\t\t\t\tview: CalendarViewType.MONTH,\n\t\t\t\t\t\tdate,\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t})\n\t\t} else if (styles.isUsingBottomNavigation() && styles.isDesktopLayout()) {\n\t\t\treturn null\n\t\t}\n\n\t\treturn m(MobileHeaderMenuButton, { newsModel: attrs.newsModel, backAction: () => attrs.viewSlider.focusPreviousColumn() })\n\t}\n\n\tprivate renderSearchNavigationButton() {\n\t\tif (locator.logins.isInternalUserLoggedIn()) {\n\t\t\treturn m(\n\t\t\t\t\".icon-button\",\n\t\t\t\tm(NavButton, {\n\t\t\t\t\tlabel: \"search_label\",\n\t\t\t\t\thideLabel: true,\n\t\t\t\t\ticon: () => BootIcons.Search,\n\t\t\t\t\thref: \"/search/calendar\",\n\t\t\t\t\tcentred: true,\n\t\t\t\t\tfillSpaceAround: false,\n\t\t\t\t}),\n\t\t\t)\n\t\t}\n\n\t\treturn null\n\t}\n\n\tprivate renderDateNavigation(attrs: CalendarMobileHeaderAttrs) {\n\t\tif (isApp() || !(styles.isSingleColumnLayout() || styles.isTwoColumnLayout())) {\n\t\t\treturn null\n\t\t}\n\n\t\treturn m.fragment({}, [attrs.navConfiguration.back, attrs.navConfiguration.forward])\n\t}\n\n\tprivate renderViewSelector(attrs: CalendarMobileHeaderAttrs): Children {\n\t\treturn m(\n\t\t\tIconButton,\n\t\t\tattachDropdown({\n\t\t\t\tmainButtonAttrs: {\n\t\t\t\t\ticon: getIconForViewType(attrs.viewType),\n\t\t\t\t\ttitle: \"view_label\",\n\t\t\t\t},\n\t\t\t\tchildAttrs: () => {\n\t\t\t\t\tconst calendarViewValues: Array<{ name: TranslationKey; value: CalendarViewType }> = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"agenda_label\",\n\t\t\t\t\t\t\tvalue: CalendarViewType.AGENDA,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"day_label\",\n\t\t\t\t\t\t\tvalue: CalendarViewType.DAY,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"week_label\",\n\t\t\t\t\t\t\tvalue: CalendarViewType.WEEK,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"month_label\",\n\t\t\t\t\t\t\tvalue: CalendarViewType.MONTH,\n\t\t\t\t\t\t},\n\t\t\t\t\t]\n\n\t\t\t\t\treturn calendarViewValues.map(({ name, value }) => ({\n\t\t\t\t\t\tlabel: name,\n\t\t\t\t\t\tselected: value === attrs.viewType,\n\t\t\t\t\t\ticon: getIconForViewType(value),\n\t\t\t\t\t\tclick: () => attrs.onViewTypeSelected(value),\n\t\t\t\t\t}))\n\t\t\t\t},\n\t\t\t}),\n\t\t)\n\t}\n}\n"]}