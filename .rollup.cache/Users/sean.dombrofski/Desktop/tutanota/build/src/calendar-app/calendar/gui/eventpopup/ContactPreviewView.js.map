{"version":3,"file":"ContactPreviewView.js","sourceRoot":"","sources":["../../../../../../src/calendar-app/calendar/gui/eventpopup/ContactPreviewView.ts"],"names":[],"mappings":"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","sourcesContent":["import type { CalendarEvent, Contact } from \"../../../../common/api/entities/tutanota/TypeRefs.js\"\nimport m, { Children, Component, Vnode } from \"mithril\"\nimport { AllIcons, Icon, IconSize } from \"../../../../common/gui/base/Icon.js\"\nimport { theme } from \"../../../../common/gui/theme.js\"\nimport { BootIcons } from \"../../../../common/gui/base/icons/BootIcons.js\"\nimport { Icons } from \"../../../../common/gui/base/icons/Icons.js\"\nimport { calculateContactsAge, getTimeZone } from \"../../../../common/calendar/date/CalendarUtils.js\"\nimport { memoized, noOp } from \"@tutao/tutanota-utils\"\nimport { lang, TranslationKey } from \"../../../../common/misc/LanguageViewModel.js\"\nimport { BannerButton, BannerButtonAttrs } from \"../../../../common/gui/base/buttons/BannerButton.js\"\nimport { pureComponent } from \"../../../../common/gui/base/PureComponent.js\"\nimport { formatEventDuration } from \"../CalendarGuiUtils.js\"\nimport { getLocationUrl } from \"./EventPreviewView.js\"\nimport { getContactTitle } from \"../../../../common/gui/base/GuiUtils.js\"\nimport { isoDateToBirthday } from \"../../../../common/api/common/utils/BirthdayUtils.js\"\nimport { createDropdown } from \"../../../../common/gui/base/Dropdown.js\"\nimport { writeMail } from \"../../../../mail-app/contacts/view/ContactView.js\"\nimport { client } from \"../../../../common/misc/ClientDetector.js\"\n\nexport type ContactPreviewViewAttrs = {\n\tevent: CalendarEvent\n\tcontact: Contact\n}\n\nexport class ContactPreviewView implements Component<ContactPreviewViewAttrs> {\n\t// Cache the parsed URL, so we don't parse the URL on every single view call\n\tprivate readonly getLocationUrl: typeof getLocationUrl\n\n\tconstructor() {\n\t\tthis.getLocationUrl = memoized(getLocationUrl)\n\t}\n\n\tview(vnode: Vnode<ContactPreviewViewAttrs>): Children {\n\t\tconst { event, contact } = vnode.attrs\n\t\tconst eventTitle = getContactTitle(contact)\n\n\t\tconst birthYear = contact.birthdayIso && isoDateToBirthday(contact.birthdayIso).year\n\t\tconst age = birthYear && calculateContactsAge(new Date(birthYear).getFullYear(), event.startTime.getFullYear())\n\t\tconst ageString = age ? lang.get(\"birthdayEventAge_title\", { \"{age}\": age }) : \"\"\n\n\t\treturn m(\".flex.col.smaller.scroll.visible-scrollbar\", [\n\t\t\tthis.renderRow(BootIcons.Calendar, [m(\"span.h3\", eventTitle)]),\n\t\t\tthis.renderRow(Icons.Time, [formatEventDuration(event, getTimeZone(), false)]),\n\t\t\tage ? this.renderRow(Icons.Gift, ageString) : null,\n\t\t\tthis.renderActions(contact),\n\t\t])\n\t}\n\n\tprivate renderRow(headerIcon: AllIcons, children: Children, isAlignedLeft?: boolean): Children {\n\t\treturn m(\n\t\t\t\".flex.pb-s\",\n\t\t\t{\n\t\t\t\tclass: isAlignedLeft ? \"items-start\" : \"items-center\",\n\t\t\t},\n\t\t\t[this.renderSectionIndicator(headerIcon, isAlignedLeft ? { marginTop: \"2px\" } : undefined), m(\".selectable.text-break.full-width\", children)],\n\t\t)\n\t}\n\n\tprivate renderSectionIndicator(icon: AllIcons, style: Record<string, any> = {}): Children {\n\t\treturn m(Icon, {\n\t\t\ticon,\n\t\t\tclass: \"pr\",\n\t\t\tsize: IconSize.Medium,\n\t\t\tstyle: Object.assign(\n\t\t\t\t{\n\t\t\t\t\tfill: theme.content_button,\n\t\t\t\t\tdisplay: \"block\",\n\t\t\t\t},\n\t\t\t\tstyle,\n\t\t\t),\n\t\t})\n\t}\n\n\tprivate renderActions(contact: Contact): Children {\n\t\treturn m(\".flex.pb-s\", m(ActionButtons, contact))\n\t}\n}\n\nexport function simulateMailToClick(mailAddress: string) {\n\tconst anchorElement: HTMLAnchorElement = document.createElement(\"a\")\n\tanchorElement.href = `mailto:${mailAddress}`\n\tanchorElement.target = \"_blank\"\n\tanchorElement.click()\n}\n\nconst ActionButtons = pureComponent((contact: Contact) => {\n\tinterface ButtonColors {\n\t\tborderColor: string\n\t\tcolor: string\n\t}\n\n\tconst makeActionButtonAttrs = (onClick: (e: any, dom: any) => unknown, text: TranslationKey, colors: ButtonColors, icon?: Children): BannerButtonAttrs => ({\n\t\ttext,\n\t\tclass: \"width-min-content flex items-center\",\n\t\tclick: onClick,\n\t\ticon,\n\t\t...colors,\n\t})\n\n\tconst renderIcon = (icon: AllIcons, fillColor: string) =>\n\t\tm(Icon, {\n\t\t\ticon,\n\t\t\tclass: \"flex-center items-center mr-xs\",\n\t\t\tstyle: {\n\t\t\t\tfill: fillColor,\n\t\t\t},\n\t\t})\n\n\tconst renderSuffix = (text: string) => (text !== \"\" ? `(${text}) ` : \"\")\n\n\tconst showMailDropdown = createDropdown({\n\t\tlazyButtons: () =>\n\t\t\tcontact.mailAddresses.map((mailAddress, index) => ({\n\t\t\t\tlabel: lang.makeTranslation(\"mailAddress_label\", `${renderSuffix(mailAddress.customTypeName)}${mailAddress.address}`),\n\t\t\t\tclick: () => {\n\t\t\t\t\tif (client.isCalendarApp()) {\n\t\t\t\t\t\tsimulateMailToClick(mailAddress.address)\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\treturn writeMail({\n\t\t\t\t\t\tname: `${contact.firstName} ${contact.lastName}`.trim(),\n\t\t\t\t\t\taddress: mailAddress.address,\n\t\t\t\t\t\tcontact: contact,\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t})),\n\t})\n\tconst showPhoneDropdown = createDropdown({\n\t\tlazyButtons: () =>\n\t\t\tcontact.phoneNumbers.map((contactPhone, index) => ({\n\t\t\t\tlabel: lang.makeTranslation(\"phoneNumber\", `${renderSuffix(contactPhone.customTypeName)}${contactPhone.number}`),\n\t\t\t\tclick: () => {\n\t\t\t\t\tconst element: HTMLAnchorElement = document.createElement(\"a\")\n\t\t\t\t\telement.href = `tel:${contactPhone.number}`\n\t\t\t\t\telement.target = \"_blank\"\n\t\t\t\t\telement.click()\n\t\t\t\t},\n\t\t\t})),\n\t})\n\n\tconst emailButtonColors = {\n\t\tborderColor: theme.content_accent,\n\t\tcolor: theme.content_accent,\n\t}\n\tconst phoneButtonColors = {\n\t\tborderColor: theme.content_button,\n\t\tcolor: theme.content_button,\n\t}\n\n\tconst singleEmailAdress = contact.mailAddresses.length === 1\n\tconst singlePhoneNumber = contact.phoneNumbers.length === 1\n\n\tconst onSendMailClick = (event: MouseEvent, dom: HTMLElement) => {\n\t\tif (singleEmailAdress) {\n\t\t\tif (client.isCalendarApp()) {\n\t\t\t\treturn\n\t\t\t} else if (!client.isCalendarApp()) {\n\t\t\t\treturn writeMail({\n\t\t\t\t\tname: `${contact.firstName} ${contact.lastName}`.trim(),\n\t\t\t\t\taddress: contact.mailAddresses[0].address,\n\t\t\t\t\tcontact: contact,\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\tshowMailDropdown(event, dom)\n\t}\n\n\treturn m(\".full-width.flex.items-center.flex-end.mt-s\", [\n\t\tcontact.mailAddresses.length\n\t\t\t? m(\n\t\t\t\t\tsingleEmailAdress && client.isCalendarApp() ? `a[href=\"mailto:${contact.mailAddresses[0].address}\"][target=_blank].no-text-decoration` : \"\",\n\t\t\t\t\tm(\n\t\t\t\t\t\tBannerButton,\n\t\t\t\t\t\tmakeActionButtonAttrs(onSendMailClick, \"sendMail_label\", emailButtonColors, renderIcon(BootIcons.Mail, emailButtonColors.color)),\n\t\t\t\t\t),\n\t\t\t  )\n\t\t\t: null,\n\t\tcontact.phoneNumbers.length\n\t\t\t? m(\n\t\t\t\t\tsinglePhoneNumber ? `a[href=\"tel:${contact.phoneNumbers[0].number}\"][target=_blank].no-text-decoration` : \"\",\n\t\t\t\t\tm(\n\t\t\t\t\t\tBannerButton,\n\t\t\t\t\t\tmakeActionButtonAttrs(\n\t\t\t\t\t\t\tsinglePhoneNumber ? noOp : showPhoneDropdown,\n\t\t\t\t\t\t\t\"callNumber_label\",\n\t\t\t\t\t\t\tphoneButtonColors,\n\t\t\t\t\t\t\trenderIcon(Icons.Call, phoneButtonColors.color),\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t  )\n\t\t\t: null,\n\t])\n})\n"]}