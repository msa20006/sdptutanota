{"version":3,"file":"CalendarEventBubble.js","sourceRoot":"","sources":["../../../../../src/calendar-app/calendar/view/CalendarEventBubble.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Child, Children, Component, Vnode } from \"mithril\"\nimport { px, size } from \"../../../common/gui/size\"\nimport { Icon } from \"../../../common/gui/base/Icon\"\nimport { Icons } from \"../../../common/gui/base/icons/Icons\"\nimport { ClickHandler, colorForBg } from \"../../../common/gui/base/GuiUtils\"\nimport { TabIndex } from \"../../../common/api/common/TutanotaConstants.js\"\n\nexport type CalendarEventBubbleAttrs = {\n\ttext: string\n\tsecondLineText?: string | null\n\tcolor: string\n\thasAlarm: boolean\n\tisAltered: boolean\n\tisClientOnly: boolean\n\tclick: ClickHandler\n\tkeyDown: (event: KeyboardEvent, dom: HTMLElement) => unknown\n\theight?: number\n\tnoBorderRight?: boolean\n\tnoBorderLeft?: boolean\n\tverticalPadding?: number\n\tfadeIn: boolean\n\topacity: number\n\tenablePointerEvents: boolean\n}\nconst lineHeight = size.calendar_line_height\nconst lineHeightPx = px(lineHeight)\n\nexport class CalendarEventBubble implements Component<CalendarEventBubbleAttrs> {\n\tprivate hasFinishedInitialRender: boolean = false\n\n\toncreate(vnode: Vnode<CalendarEventBubbleAttrs>) {\n\t\tthis.hasFinishedInitialRender = true\n\t}\n\n\tview({ attrs }: Vnode<CalendarEventBubbleAttrs>): Children {\n\t\t// This helps us stop flickering in certain cases where we want to disable and re-enable fade in (ie. when dragging events)\n\t\t// Reapplying the animation to the element will cause it to trigger instantly, so we don't want to do that\n\t\tconst doFadeIn = !this.hasFinishedInitialRender && attrs.fadeIn\n\t\tconst enablePointerEvents = attrs.enablePointerEvents\n\t\treturn m(\n\t\t\t\".calendar-event.small.overflow-hidden.flex.cursor-pointer\" +\n\t\t\t\t(doFadeIn ? \".fade-in\" : \"\") +\n\t\t\t\t(attrs.noBorderLeft ? \".event-continues-left\" : \"\") +\n\t\t\t\t(attrs.noBorderRight ? \".event-continues-right\" : \"\"),\n\t\t\t{\n\t\t\t\tstyle: {\n\t\t\t\t\tbackground: \"#\" + attrs.color,\n\t\t\t\t\tcolor: colorForBg(\"#\" + attrs.color),\n\t\t\t\t\tminHeight: lineHeightPx,\n\t\t\t\t\theight: px(attrs.height ? Math.max(attrs.height, 0) : lineHeight),\n\t\t\t\t\t\"padding-top\": px(attrs.verticalPadding || 0),\n\t\t\t\t\topacity: attrs.opacity,\n\t\t\t\t\tpointerEvents: enablePointerEvents ? \"auto\" : \"none\",\n\t\t\t\t},\n\t\t\t\ttabIndex: enablePointerEvents ? TabIndex.Default : TabIndex.Programmatic,\n\t\t\t\tonclick: (e: MouseEvent) => {\n\t\t\t\t\te.stopPropagation()\n\t\t\t\t\tattrs.click(e, e.target as HTMLElement)\n\t\t\t\t},\n\t\t\t\tonkeydown: (e: KeyboardEvent) => {\n\t\t\t\t\tattrs.keyDown(e, e.target as HTMLElement)\n\t\t\t\t},\n\t\t\t},\n\t\t\t[\n\t\t\t\tattrs.hasAlarm\n\t\t\t\t\t? m(Icon, {\n\t\t\t\t\t\t\ticon: Icons.Notifications,\n\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\tfill: colorForBg(\"#\" + attrs.color),\n\t\t\t\t\t\t\t\t\"padding-top\": \"2px\",\n\t\t\t\t\t\t\t\t\"padding-right\": \"2px\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tclass: \"icon-small\",\n\t\t\t\t\t  })\n\t\t\t\t\t: null,\n\t\t\t\tattrs.isAltered\n\t\t\t\t\t? m(Icon, {\n\t\t\t\t\t\t\ticon: Icons.Edit,\n\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\tfill: colorForBg(\"#\" + attrs.color),\n\t\t\t\t\t\t\t\t\"padding-top\": \"2px\",\n\t\t\t\t\t\t\t\t\"padding-right\": \"2px\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tclass: \"icon-small\",\n\t\t\t\t\t  })\n\t\t\t\t\t: null,\n\t\t\t\tattrs.isClientOnly\n\t\t\t\t\t? m(Icon, {\n\t\t\t\t\t\t\ticon: Icons.Gift,\n\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\tfill: colorForBg(\"#\" + attrs.color),\n\t\t\t\t\t\t\t\t\"padding-top\": \"2px\",\n\t\t\t\t\t\t\t\t\"padding-right\": \"2px\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tclass: \"icon-small\",\n\t\t\t\t\t  })\n\t\t\t\t\t: null,\n\t\t\t\tm(\n\t\t\t\t\t\".flex.col\",\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t// Limit the width to trigger ellipsis\n\t\t\t\t\t\t\twidth: \"95%\",\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tCalendarEventBubble.renderContent(attrs),\n\t\t\t\t),\n\t\t\t],\n\t\t)\n\t}\n\n\tprivate static renderContent({ height: maybeHeight, text, secondLineText, color }: CalendarEventBubbleAttrs): Children {\n\t\t// If the bubble has 2 or more lines worth of vertical space, then we will render the text + the secondLineText on separate lines\n\t\t// Otherwise we will combine them onto a single line\n\t\tconst height = maybeHeight ?? lineHeight\n\t\tconst isMultiline = height >= lineHeight * 2\n\n\t\tif (isMultiline) {\n\t\t\t// How many lines of text that will fit in the bubble\n\t\t\t// we dont want any cut in half lines in case the bubble cannot fit a whole number of lines\n\t\t\tconst linesInBubble = Math.floor(height / lineHeight)\n\t\t\t// leave space for the second text line. it will be restricted to a maximum of one line in height\n\t\t\tconst topSectionMaxLines = secondLineText != null ? linesInBubble - 1 : linesInBubble\n\t\t\tconst topSectionClass = topSectionMaxLines === 1 ? \".text-clip\" : \".text-ellipsis-multi-line\"\n\t\t\treturn [\n\t\t\t\t// The wrapper around `text` is needed to stop `-webkit-box` from changing the height\n\t\t\t\tCalendarEventBubble.renderTextSection(\n\t\t\t\t\t\"\",\n\t\t\t\t\tm(\n\t\t\t\t\t\ttopSectionClass,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\"-webkit-line-clamp\": topSectionMaxLines, // This helps resizing the text to show as much as possible of its contents\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttext,\n\t\t\t\t\t),\n\t\t\t\t\ttopSectionMaxLines * lineHeight,\n\t\t\t\t),\n\t\t\t\tsecondLineText ? CalendarEventBubble.renderTextSection(\".text-ellipsis\", secondLineText, lineHeight) : null,\n\t\t\t]\n\t\t} else {\n\t\t\treturn CalendarEventBubble.renderTextSection(\n\t\t\t\t\".text-clip\",\n\t\t\t\tsecondLineText\n\t\t\t\t\t? [\n\t\t\t\t\t\t\t`${text} `,\n\t\t\t\t\t\t\tm(Icon, {\n\t\t\t\t\t\t\t\ticon: Icons.Time,\n\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\tfill: colorForBg(\"#\" + color),\n\t\t\t\t\t\t\t\t\t\"padding-top\": \"2px\",\n\t\t\t\t\t\t\t\t\t\"padding-right\": \"2px\",\n\t\t\t\t\t\t\t\t\t\"vertical-align\": \"text-top\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tclass: \"icon-small\",\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t`${secondLineText}`,\n\t\t\t\t\t  ]\n\t\t\t\t\t: text,\n\t\t\t\tlineHeight,\n\t\t\t)\n\t\t}\n\t}\n\n\tprivate static renderTextSection(classes: string, text: Children, maxHeight: number): Child {\n\t\treturn m(\n\t\t\tclasses,\n\t\t\t{\n\t\t\t\tstyle: {\n\t\t\t\t\tlineHeight: lineHeightPx,\n\t\t\t\t\tmaxHeight: px(maxHeight),\n\t\t\t\t},\n\t\t\t},\n\t\t\ttext,\n\t\t)\n\t}\n}\n"]}