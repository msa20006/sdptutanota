{"version":3,"file":"EventDetailsView.js","sourceRoot":"","sources":["../../../../../src/calendar-app/calendar/view/EventDetailsView.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { IconButton, IconButtonAttrs } from \"../../../common/gui/base/IconButton.js\"\nimport { Icons } from \"../../../common/gui/base/icons/Icons.js\"\nimport { Button, ButtonColor, ButtonType } from \"../../../common/gui/base/Button.js\"\nimport { BootIcons } from \"../../../common/gui/base/icons/BootIcons.js\"\nimport { EventPreviewView } from \"../gui/eventpopup/EventPreviewView.js\"\nimport { createAsyncDropdown } from \"../../../common/gui/base/Dropdown.js\"\nimport { Dialog } from \"../../../common/gui/base/Dialog.js\"\nimport { CalendarEventPreviewViewModel } from \"../gui/eventpopup/CalendarEventPreviewViewModel.js\"\nimport { styles } from \"../../../common/gui/styles.js\"\nimport { CalendarPreviewModels } from \"./CalendarViewModel.js\"\n\nexport interface EventDetailsViewAttrs {\n\teventPreviewModel: CalendarEventPreviewViewModel\n}\n\nexport class EventDetailsView implements Component<EventDetailsViewAttrs> {\n\tprivate model: CalendarEventPreviewViewModel | null = null\n\n\tview({ attrs }: Vnode<EventDetailsViewAttrs>) {\n\t\tthis.model = attrs.eventPreviewModel\n\t\treturn m(\".content-bg.border-radius-big.pl-l.pb-s.flex.pr\", [\n\t\t\tm(\n\t\t\t\t\".flex-grow\",\n\t\t\t\t{\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\t// align text to the buttons on the right\n\t\t\t\t\t\tpaddingTop: \"6px\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tm(EventPreviewView, {\n\t\t\t\t\tevent: this.model.calendarEvent,\n\t\t\t\t\tsanitizedDescription: this.model.getSanitizedDescription(),\n\t\t\t\t\tparticipation: this.model.getParticipationSetterAndThen(() => null),\n\t\t\t\t}),\n\t\t\t),\n\t\t\tm(\".flex.mt-xs\", [this.renderSendUpdateButton(), this.renderEditButton(), this.renderDeleteButton()]),\n\t\t])\n\t}\n\n\tprivate renderEditButton(): Children {\n\t\tif (this.model == null || !this.model.canEdit || styles.isSingleColumnLayout()) return null\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"edit_action\",\n\t\t\ticon: Icons.Edit,\n\t\t\tclick: (event, dom) => handleEventEditButtonClick(this.model, event, dom),\n\t\t})\n\t}\n\n\tprivate renderDeleteButton(): Children {\n\t\tif (this.model == null || !this.model.canDelete || styles.isSingleColumnLayout()) return null\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"delete_action\",\n\t\t\ticon: Icons.Trash,\n\t\t\tclick: (event, dom) => handleEventDeleteButtonClick(this.model, event, dom),\n\t\t})\n\t}\n\n\tprivate renderSendUpdateButton(): Children {\n\t\tif (this.model == null || !this.model.canSendUpdates || styles.isSingleColumnLayout()) return null\n\t\treturn m(IconButton, {\n\t\t\ttitle: \"sendUpdates_label\",\n\t\t\tclick: () => handleSendUpdatesClick(this.model),\n\t\t\ticon: BootIcons.Mail,\n\t\t})\n\t}\n\n\tprivate async confirmDeleteClose(): Promise<void> {\n\t\tif (!(await Dialog.confirm(\"deleteEventConfirmation_msg\"))) return\n\t\tawait this.model?.deleteAll()\n\t}\n}\n\nexport async function handleSendUpdatesClick(previewModel: CalendarEventPreviewViewModel | null) {\n\tconst confirmed = await Dialog.confirm(\"sendUpdates_msg\")\n\tif (confirmed) await previewModel?.sendUpdates()\n}\n\nexport function handleEventEditButtonClick(previewModel: CalendarEventPreviewViewModel | null, ev: MouseEvent, receiver: HTMLElement) {\n\tif (previewModel?.isRepeatingForEditing) {\n\t\tcreateAsyncDropdown({\n\t\t\tlazyButtons: () =>\n\t\t\t\tPromise.resolve([\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: \"updateOneCalendarEvent_action\",\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t// noinspection JSIgnoredPromiseFromCall\n\t\t\t\t\t\t\tpreviewModel?.editSingle()\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: \"updateAllCalendarEvents_action\",\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t// noinspection JSIgnoredPromiseFromCall\n\t\t\t\t\t\t\tpreviewModel?.editAll()\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t]),\n\t\t\twidth: 300,\n\t\t})(ev, receiver)\n\t} else {\n\t\t// noinspection JSIgnoredPromiseFromCall\n\t\tpreviewModel?.editAll()\n\t}\n}\n\nexport async function handleEventDeleteButtonClick(previewModel: CalendarEventPreviewViewModel | null, ev: MouseEvent, receiver: HTMLElement) {\n\tif (await previewModel?.isRepeatingForDeleting()) {\n\t\tcreateAsyncDropdown({\n\t\t\tlazyButtons: () =>\n\t\t\t\tPromise.resolve([\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: \"deleteSingleEventRecurrence_action\",\n\t\t\t\t\t\tclick: async () => {\n\t\t\t\t\t\t\tawait previewModel?.deleteSingle()\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: \"deleteAllEventRecurrence_action\",\n\t\t\t\t\t\tclick: () => confirmDeleteClose(previewModel),\n\t\t\t\t\t},\n\t\t\t\t]),\n\t\t\twidth: 300,\n\t\t})(ev, receiver)\n\t} else {\n\t\t// noinspection JSIgnoredPromiseFromCall, ES6MissingAwait\n\t\tconfirmDeleteClose(previewModel)\n\t}\n}\n\nasync function confirmDeleteClose(previewModel: CalendarEventPreviewViewModel | null): Promise<void> {\n\tif (!(await Dialog.confirm(\"deleteEventConfirmation_msg\"))) return\n\tawait previewModel?.deleteAll()\n}\n"]}