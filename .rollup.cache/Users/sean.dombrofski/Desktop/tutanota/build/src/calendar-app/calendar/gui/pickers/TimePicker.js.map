{"version":3,"file":"TimePicker.js","sourceRoot":"","sources":["../../../../../../src/calendar-app/calendar/gui/pickers/TimePicker.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { TextFieldType as TextFieldType } from \"../../../../common/gui/base/TextField.js\"\nimport { theme } from \"../../../../common/gui/theme.js\"\nimport { TabIndex, TimeFormat } from \"../../../../common/api/common/TutanotaConstants.js\"\nimport { timeStringFromParts } from \"../../../../common/misc/Formatter.js\"\nimport { Time } from \"../../../../common/calendar/date/Time.js\"\nimport { Select, SelectAttributes } from \"../../../../common/gui/base/Select.js\"\nimport { SingleLineTextField } from \"../../../../common/gui/base/SingleLineTextField.js\"\nimport { isApp } from \"../../../../common/api/common/Env.js\"\nimport { px, size } from \"../../../../common/gui/size.js\"\nimport stream from \"mithril/stream\"\n\nexport type TimePickerAttrs = {\n\ttime: Time | null\n\tonTimeSelected: (arg0: Time | null) => unknown\n\ttimeFormat: TimeFormat\n\tdisabled?: boolean\n\tariaLabel: string\n\tclasses?: Array<string>\n}\n\ninterface TimeOption {\n\tvalue: string\n\tariaValue: string\n\tname: string\n}\n\nexport class TimePicker implements Component<TimePickerAttrs> {\n\tprivate values: ReadonlyArray<string>\n\tprivate focused: boolean\n\tprivate isExpanded: boolean = false\n\tprivate oldValue: string\n\tprivate value: string\n\tprivate readonly amPm: boolean\n\n\tconstructor({ attrs }: Vnode<TimePickerAttrs>) {\n\t\tthis.focused = false\n\t\tthis.value = \"\"\n\t\tthis.amPm = attrs.timeFormat === TimeFormat.TWELVE_HOURS\n\t\tconst times: string[] = []\n\n\t\tfor (let hour = 0; hour < 24; hour++) {\n\t\t\tfor (let minute = 0; minute < 60; minute += 30) {\n\t\t\t\ttimes.push(timeStringFromParts(hour, minute, this.amPm))\n\t\t\t}\n\t\t}\n\t\tthis.oldValue = attrs.time?.toString(false) ?? \"--\"\n\t\tthis.values = times\n\t}\n\n\tview({ attrs }: Vnode<TimePickerAttrs>): Children {\n\t\tif (attrs.time) {\n\t\t\tconst timeAsString = attrs.time?.toString(this.amPm) ?? \"\"\n\n\t\t\tif (!this.focused) {\n\t\t\t\tthis.value = timeAsString\n\t\t\t}\n\t\t}\n\n\t\tif (isApp()) {\n\t\t\treturn this.renderNativeTimePicker(attrs)\n\t\t} else {\n\t\t\treturn this.renderCustomTimePicker(attrs)\n\t\t}\n\t}\n\n\tprivate renderNativeTimePicker(attrs: TimePickerAttrs): Children {\n\t\tif (this.oldValue !== attrs.time?.toString(false)) {\n\t\t\tthis.onSelected(attrs)\n\t\t}\n\n\t\t// input[type=time] wants time in 24h format, no matter what is actually displayed. Otherwise it will be empty.\n\t\tconst timeAsString = attrs.time?.toString(false) ?? \"\"\n\t\tthis.oldValue = timeAsString\n\t\tthis.value = timeAsString\n\n\t\tconst displayTime = attrs.time?.toString(this.amPm)\n\n\t\treturn m(\".rel\", [\n\t\t\tm(\"input.fill-absolute.invisible.tutaui-button-outline\", {\n\t\t\t\tdisabled: attrs.disabled,\n\t\t\t\ttype: TextFieldType.Time,\n\t\t\t\tstyle: {\n\t\t\t\t\tzIndex: 1,\n\t\t\t\t\tborder: `2px solid ${theme.content_message_bg}`,\n\t\t\t\t\twidth: \"auto\",\n\t\t\t\t\theight: \"auto\",\n\t\t\t\t\tappearance: \"none\",\n\t\t\t\t\topacity: attrs.disabled ? 0.7 : 1.0,\n\t\t\t\t},\n\t\t\t\tvalue: this.value,\n\t\t\t\toninput: (event: InputEvent) => {\n\t\t\t\t\tconst inputValue = (event.target as HTMLInputElement).value\n\t\t\t\t\tif (this.value === inputValue) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tthis.value = inputValue\n\t\t\t\t\tattrs.onTimeSelected(Time.parseFromString(inputValue))\n\t\t\t\t},\n\t\t\t}),\n\t\t\tm(\n\t\t\t\t\".tutaui-button-outline\",\n\t\t\t\t{\n\t\t\t\t\tclass: attrs.classes?.join(\" \"),\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tzIndex: \"2\",\n\t\t\t\t\t\tposition: \"inherit\",\n\t\t\t\t\t\tborderColor: \"transparent\",\n\t\t\t\t\t\tpointerEvents: \"none\",\n\t\t\t\t\t\tpadding: `${px(size.vpad_small)} 0`,\n\t\t\t\t\t\topacity: attrs.disabled ? 0.7 : 1.0,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tdisplayTime,\n\t\t\t),\n\t\t])\n\t}\n\n\tprivate renderCustomTimePicker(attrs: TimePickerAttrs): Children {\n\t\tconst options = this.values.map((time) => ({\n\t\t\tvalue: time,\n\t\t\tname: time,\n\t\t\tariaValue: time,\n\t\t}))\n\n\t\treturn m(Select<TimeOption, string>, {\n\t\t\tonchange: (newValue) => {\n\t\t\t\tif (this.value === newValue.value) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tthis.value = newValue.value\n\t\t\t\tthis.onSelected(attrs)\n\t\t\t\tm.redraw.sync()\n\t\t\t},\n\t\t\tonclose: () => {\n\t\t\t\tthis.isExpanded = false\n\t\t\t},\n\t\t\tselected: { value: this.value, name: this.value, ariaValue: this.value },\n\t\t\tariaLabel: attrs.ariaLabel,\n\t\t\tdisabled: attrs.disabled,\n\t\t\toptions: stream(options),\n\t\t\tnoIcon: true,\n\t\t\texpanded: true,\n\t\t\ttabIndex: Number(TabIndex.Programmatic),\n\t\t\trenderDisplay: () => this.renderTimeSelectInput(attrs),\n\t\t\trenderOption: (option) => this.renderTimeOptions(option),\n\t\t\tkeepFocus: true,\n\t\t} satisfies SelectAttributes<TimeOption, string>)\n\t}\n\n\tprivate renderTimeOptions(option: TimeOption) {\n\t\treturn m(\n\t\t\t\"button.items-center.flex-grow\",\n\t\t\t{\n\t\t\t\tclass: \"state-bg button-content dropdown-button pt-s pb-s button-min-height\",\n\t\t\t},\n\t\t\toption.name,\n\t\t)\n\t}\n\n\tprivate renderTimeSelectInput(attrs: TimePickerAttrs) {\n\t\treturn m(SingleLineTextField, {\n\t\t\tclasses: [...(attrs.classes ?? []), \"tutaui-button-outline\", \"text-center\", \"border-content-message-bg\"],\n\t\t\tvalue: this.value,\n\t\t\toninput: (val: string) => {\n\t\t\t\tif (this.value === val) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tthis.value = val\n\t\t\t},\n\t\t\tdisabled: attrs.disabled,\n\t\t\tariaLabel: attrs.ariaLabel,\n\t\t\tstyle: {\n\t\t\t\ttextAlign: \"center\",\n\t\t\t},\n\t\t\tonclick: (e: MouseEvent) => {\n\t\t\t\te.stopImmediatePropagation()\n\t\t\t\tif (!this.isExpanded) {\n\t\t\t\t\t;(e.target as HTMLElement).parentElement?.click()\n\t\t\t\t\tthis.isExpanded = true\n\t\t\t\t}\n\t\t\t},\n\t\t\tonfocus: (event: FocusEvent) => {\n\t\t\t\tthis.focused = true\n\t\t\t\tif (!this.isExpanded) {\n\t\t\t\t\t;(event.target as HTMLElement).parentElement?.click()\n\t\t\t\t\tthis.isExpanded = true\n\t\t\t\t}\n\t\t\t},\n\t\t\tonblur: (e: any) => {\n\t\t\t\tif (this.focused) {\n\t\t\t\t\tthis.onSelected(attrs)\n\t\t\t\t}\n\n\t\t\t\te.redraw = false\n\t\t\t},\n\t\t\ttype: TextFieldType.Text,\n\t\t})\n\t}\n\n\tprivate onSelected(attrs: TimePickerAttrs) {\n\t\tthis.focused = false\n\n\t\tattrs.onTimeSelected(Time.parseFromString(this.value))\n\t}\n}\n"]}