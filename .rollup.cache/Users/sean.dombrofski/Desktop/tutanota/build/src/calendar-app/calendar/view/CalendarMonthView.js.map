{"version":3,"file":"CalendarMonthView.js","sourceRoot":"","sources":["../../../../../src/calendar-app/calendar/view/CalendarMonthView.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, ClassComponent, Component, Vnode, VnodeDOM } from \"mithril\"\nimport { px, size } from \"../../../common/gui/size\"\nimport { EventTextTimeOption, WeekStart } from \"../../../common/api/common/TutanotaConstants\"\nimport {\n\tCalendarDay,\n\tCalendarMonth,\n\tgetAllDayDateForTimezone,\n\tgetDiffIn24hIntervals,\n\tgetEventEnd,\n\tgetFirstDayOfMonth,\n\tgetStartOfNextDayWithZone,\n\tgetStartOfTheWeekOffset,\n\tgetTimeZone,\n\tgetWeekNumber,\n} from \"../../../common/calendar/date/CalendarUtils\"\nimport { deepEqual, incrementDate, incrementMonth, isToday, lastThrow, neverNull, ofClass } from \"@tutao/tutanota-utils\"\nimport { ContinuingCalendarEventBubble } from \"./ContinuingCalendarEventBubble\"\nimport { styles } from \"../../../common/gui/styles\"\nimport { CalendarViewType, isAllDayEvent, isAllDayEventByTimes, setNextHalfHour } from \"../../../common/api/common/utils/CommonCalendarUtils\"\nimport { windowFacade } from \"../../../common/misc/WindowFacade\"\nimport type { CalendarEvent } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport type { GroupColors } from \"./CalendarView\"\nimport type { EventDragHandlerCallbacks, MousePos } from \"./EventDragHandler\"\nimport { EventDragHandler } from \"./EventDragHandler\"\nimport { getPosAndBoundsFromMouseEvent } from \"../../../common/gui/base/GuiUtils\"\nimport { UserError } from \"../../../common/api/main/UserError\"\nimport { showUserError } from \"../../../common/misc/ErrorHandlerImpl\"\nimport {\n\tCALENDAR_EVENT_HEIGHT,\n\tchangePeriodOnWheel,\n\tEventLayoutMode,\n\tgetCalendarMonth,\n\tgetDateFromMousePos,\n\tgetEventColor,\n\tlayOutEvents,\n\tSELECTED_DATE_INDICATOR_THICKNESS,\n\tTEMPORARY_EVENT_OPACITY,\n} from \"../gui/CalendarGuiUtils.js\"\nimport type { CalendarEventBubbleClickHandler, CalendarEventBubbleKeyDownHandler, EventsOnDays } from \"./CalendarViewModel\"\nimport { Time } from \"../../../common/calendar/date/Time.js\"\nimport { client } from \"../../../common/misc/ClientDetector\"\nimport { locator } from \"../../../common/api/main/CommonLocator.js\"\nimport { PageView } from \"../../../common/gui/base/PageView.js\"\nimport { DaysToEvents } from \"../../../common/calendar/date/CalendarEventsRepository.js\"\nimport { isIOSApp } from \"../../../common/api/common/Env\"\nimport { getSafeAreaInsetBottom } from \"../../../common/gui/HtmlUtils\"\n\ntype CalendarMonthAttrs = {\n\tselectedDate: Date\n\tonDateSelected: (date: Date, calendarViewTypeToShow: CalendarViewType) => unknown\n\teventsForDays: DaysToEvents\n\tgetEventsOnDaysToRender: (range: Array<Date>) => EventsOnDays\n\tonNewEvent: (date: Date | null) => unknown\n\tonEventClicked: CalendarEventBubbleClickHandler\n\tonEventKeyDown: CalendarEventBubbleKeyDownHandler\n\tonChangeMonth: (next: boolean) => unknown\n\tamPmFormat: boolean\n\tstartOfTheWeek: WeekStart\n\tgroupColors: GroupColors\n\thiddenCalendars: ReadonlySet<Id>\n\ttemporaryEvents: Array<CalendarEvent>\n\tdragHandlerCallbacks: EventDragHandlerCallbacks\n}\ntype SimplePosRect = {\n\ttop: number\n\tleft: number\n\tright: number\n}\n\n/** height of the day number indicator at the top of the day square */\nconst dayHeight = () => (styles.isDesktopLayout() ? 32 : 24)\n\nconst spaceBetweenEvents = () => (styles.isDesktopLayout() ? 2 : 1)\n\nconst EVENT_BUBBLE_VERTICAL_OFFSET = 5\n\nexport class CalendarMonthView implements Component<CalendarMonthAttrs>, ClassComponent<CalendarMonthAttrs> {\n\tprivate monthDom: HTMLElement | null = null\n\tprivate readonly resizeListener: () => unknown\n\tprivate readonly zone: string\n\tprivate lastWidth: number\n\tprivate lastHeight: number\n\tprivate eventDragHandler: EventDragHandler\n\tprivate dayUnderMouse: Date | null = null\n\tprivate lastMousePos: MousePos | null = null\n\n\tconstructor({ attrs }: Vnode<CalendarMonthAttrs>) {\n\t\tthis.resizeListener = m.redraw\n\t\tthis.zone = getTimeZone()\n\t\tthis.lastWidth = 0\n\t\tthis.lastHeight = 0\n\t\tthis.eventDragHandler = new EventDragHandler(neverNull(document.body as HTMLBodyElement), attrs.dragHandlerCallbacks)\n\t}\n\n\toncreate() {\n\t\twindowFacade.addResizeListener(this.resizeListener)\n\t}\n\n\tonremove() {\n\t\twindowFacade.removeResizeListener(this.resizeListener)\n\t}\n\n\tview({ attrs }: Vnode<CalendarMonthAttrs>): Children {\n\t\tconst startOfTheWeekOffset = getStartOfTheWeekOffset(attrs.startOfTheWeek)\n\t\tconst thisMonth = getCalendarMonth(attrs.selectedDate, startOfTheWeekOffset, styles.isSingleColumnLayout())\n\t\tconst lastMonthDate = incrementMonth(attrs.selectedDate, -1)\n\t\tconst nextMonthDate = incrementMonth(attrs.selectedDate, 1)\n\t\tconst previousMonth = getCalendarMonth(lastMonthDate, startOfTheWeekOffset, styles.isSingleColumnLayout())\n\t\tconst nextMonth = getCalendarMonth(nextMonthDate, startOfTheWeekOffset, styles.isSingleColumnLayout())\n\n\t\tconst isDesktopLayout = styles.isDesktopLayout()\n\n\t\tlet containerStyle\n\t\tlet weekdayDaysClasses = \"\"\n\t\tif (isDesktopLayout) {\n\t\t\tcontainerStyle = {\n\t\t\t\toverflow: \"hidden\",\n\t\t\t\tmarginBottom: px(size.hpad_large),\n\t\t\t}\n\t\t\tweekdayDaysClasses = \"content-bg border-radius-top-left-big border-radius-top-right-big\"\n\t\t} else {\n\t\t\tcontainerStyle = {\n\t\t\t\tpaddingBottom: isIOSApp() && client.isCalendarApp() ? px(getSafeAreaInsetBottom()) : null,\n\t\t\t}\n\t\t\tweekdayDaysClasses = \"nav-bg\"\n\t\t}\n\n\t\treturn m(\n\t\t\t\".fill-absolute.flex.col\",\n\t\t\t{\n\t\t\t\tclass: isDesktopLayout ? \" mlr-l border-radius-big\" : \"mlr-safe-inset\",\n\t\t\t\tstyle: isDesktopLayout ? { marginLeft: px(5) } : null,\n\t\t\t\tonwheel: changePeriodOnWheel(attrs.onChangeMonth),\n\t\t\t},\n\t\t\t[\n\t\t\t\tm(\n\t\t\t\t\t\".flex.pt-s.pb-m\",\n\t\t\t\t\t{\n\t\t\t\t\t\tclass: weekdayDaysClasses,\n\t\t\t\t\t},\n\t\t\t\t\tthisMonth.weekdays.map((wd) => m(\".flex-grow\", m(\".calendar-day-indicator.b\", wd))),\n\t\t\t\t),\n\t\t\t\tm(\n\t\t\t\t\t\".flex.col.rel.flex-grow.overflow-hidden\",\n\t\t\t\t\t{\n\t\t\t\t\t\tclass:\n\t\t\t\t\t\t\t(!styles.isUsingBottomNavigation() || (isIOSApp() && client.isCalendarApp()) ? \"content-bg\" : \"\") +\n\t\t\t\t\t\t\t(!isDesktopLayout ? \" border-radius-top-left-big border-radius-top-right-big\" : \"\"),\n\t\t\t\t\t\tstyle: containerStyle,\n\t\t\t\t\t},\n\t\t\t\t\tm(PageView, {\n\t\t\t\t\t\tpreviousPage: {\n\t\t\t\t\t\t\tkey: getFirstDayOfMonth(lastMonthDate).getTime(),\n\t\t\t\t\t\t\tnodes: this.monthDom ? this.renderCalendar(attrs, previousMonth, thisMonth, this.zone) : null,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcurrentPage: {\n\t\t\t\t\t\t\tkey: getFirstDayOfMonth(attrs.selectedDate).getTime(),\n\t\t\t\t\t\t\tnodes: this.renderCalendar(attrs, thisMonth, thisMonth, this.zone),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tnextPage: {\n\t\t\t\t\t\t\tkey: getFirstDayOfMonth(nextMonthDate).getTime(),\n\t\t\t\t\t\t\tnodes: this.monthDom ? this.renderCalendar(attrs, nextMonth, thisMonth, this.zone) : null,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonChangePage: (next) => attrs.onChangeMonth(next),\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t],\n\t\t)\n\t}\n\n\tonbeforeupdate(newVnode: Vnode<CalendarMonthAttrs>, oldVnode: VnodeDOM<CalendarMonthAttrs>): boolean {\n\t\tconst dom = this.monthDom\n\t\tconst different =\n\t\t\t!dom ||\n\t\t\toldVnode.attrs.eventsForDays !== newVnode.attrs.eventsForDays ||\n\t\t\toldVnode.attrs.selectedDate !== newVnode.attrs.selectedDate ||\n\t\t\toldVnode.attrs.amPmFormat !== newVnode.attrs.amPmFormat ||\n\t\t\t!deepEqual(oldVnode.attrs.groupColors, newVnode.attrs.groupColors) ||\n\t\t\toldVnode.attrs.hiddenCalendars !== newVnode.attrs.hiddenCalendars ||\n\t\t\tdom.offsetWidth !== this.lastWidth ||\n\t\t\tdom.offsetHeight !== this.lastHeight\n\n\t\tif (dom) {\n\t\t\tthis.lastWidth = dom.offsetWidth\n\t\t\tthis.lastHeight = dom.offsetHeight\n\t\t}\n\n\t\treturn different || this.eventDragHandler.queryHasChanged()\n\t}\n\n\tprivate renderCalendar(attrs: CalendarMonthAttrs, month: CalendarMonth, currentlyVisibleMonth: CalendarMonth, zone: string): Children {\n\t\tconst { weeks } = month\n\t\tconst isVisible = month === currentlyVisibleMonth\n\t\treturn m(\n\t\t\t\".fill-absolute.flex.col.flex-grow\",\n\t\t\t{\n\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\tif (isVisible) {\n\t\t\t\t\t\tthis.monthDom = vnode.dom as HTMLElement\n\t\t\t\t\t\tm.redraw()\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonupdate: (vnode) => {\n\t\t\t\t\tif (isVisible) {\n\t\t\t\t\t\tthis.monthDom = vnode.dom as HTMLElement\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonmousemove: (mouseEvent: MouseEvent & { redraw?: boolean }) => {\n\t\t\t\t\tmouseEvent.redraw = false\n\t\t\t\t\tconst posAndBoundsFromMouseEvent = getPosAndBoundsFromMouseEvent(mouseEvent)\n\t\t\t\t\tthis.lastMousePos = posAndBoundsFromMouseEvent\n\t\t\t\t\tthis.dayUnderMouse = getDateFromMousePos(\n\t\t\t\t\t\tposAndBoundsFromMouseEvent,\n\t\t\t\t\t\tweeks.map((week) => week.map((day) => day.date)),\n\t\t\t\t\t)\n\n\t\t\t\t\tthis.eventDragHandler.handleDrag(this.dayUnderMouse, posAndBoundsFromMouseEvent)\n\t\t\t\t},\n\t\t\t\tonmouseup: (mouseEvent: MouseEvent & { redraw?: boolean }) => {\n\t\t\t\t\tmouseEvent.redraw = false\n\n\t\t\t\t\tthis.endDrag(mouseEvent)\n\t\t\t\t},\n\t\t\t\tonmouseleave: (mouseEvent: MouseEvent & { redraw?: boolean }) => {\n\t\t\t\t\tmouseEvent.redraw = false\n\n\t\t\t\t\tif (this.eventDragHandler.isDragging) {\n\t\t\t\t\t\tthis.eventDragHandler.cancelDrag()\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tweeks.map((week, weekIndex) => {\n\t\t\t\treturn m(\n\t\t\t\t\t\".flex.flex-grow.rel\",\n\t\t\t\t\t{\n\t\t\t\t\t\tkey: week[0].date.getTime(),\n\t\t\t\t\t},\n\t\t\t\t\t[\n\t\t\t\t\t\tweek.map((day, i) => this.renderDay(attrs, day, i, weekIndex === 0)),\n\t\t\t\t\t\tthis.monthDom ? this.renderWeekEvents(attrs, week, zone, !isVisible) : null,\n\t\t\t\t\t],\n\t\t\t\t)\n\t\t\t}),\n\t\t)\n\t}\n\n\tprivate endDrag(pos: MousePos) {\n\t\tconst dayUnderMouse = this.dayUnderMouse\n\t\tconst originalDate = this.eventDragHandler.originalEvent?.startTime\n\n\t\tif (dayUnderMouse && originalDate) {\n\t\t\t//make sure the date we move to also gets a time\n\t\t\tconst dateUnderMouse = Time.fromDate(originalDate).toDate(dayUnderMouse)\n\n\t\t\tthis.eventDragHandler.endDrag(dateUnderMouse, pos).catch(ofClass(UserError, showUserError))\n\t\t}\n\t}\n\n\t/** render the grid of days */\n\tprivate renderDay(attrs: CalendarMonthAttrs, day: CalendarDay, weekDayNumber: number, firstWeek: boolean): Children {\n\t\treturn m(\n\t\t\t\".calendar-day.calendar-column-border.flex-grow.rel.overflow-hidden.fill-absolute.cursor-pointer\",\n\t\t\t{\n\t\t\t\tstyle: {\n\t\t\t\t\t...(firstWeek && !styles.isDesktopLayout() ? { borderTop: \"none\" } : {}),\n\t\t\t\t},\n\t\t\t\tkey: day.date.getTime(),\n\t\t\t\tonclick: (e: MouseEvent) => {\n\t\t\t\t\tif (client.isDesktopDevice()) {\n\t\t\t\t\t\tconst newDate = setNextHalfHour(new Date(day.date))\n\n\t\t\t\t\t\tattrs.onDateSelected(new Date(day.date), CalendarViewType.MONTH)\n\t\t\t\t\t\tattrs.onNewEvent(newDate)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tattrs.onDateSelected(new Date(day.date), styles.isDesktopLayout() ? CalendarViewType.DAY : CalendarViewType.AGENDA)\n\t\t\t\t\t}\n\n\t\t\t\t\te.preventDefault()\n\t\t\t\t},\n\t\t\t},\n\t\t\t[\n\t\t\t\tm(\".mb-xs\", {\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\theight: px(SELECTED_DATE_INDICATOR_THICKNESS),\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tthis.renderDayHeader(day, attrs.onDateSelected), // According to ISO 8601, weeks always start on Monday. Week numbering systems for\n\t\t\t\t// weeks that do not start on Monday are not strictly defined, so we only display\n\t\t\t\t// a week number if the user's client is configured to start weeks on Monday\n\t\t\t\tweekDayNumber === 0 && attrs.startOfTheWeek === WeekStart.MONDAY\n\t\t\t\t\t? m(\n\t\t\t\t\t\t\t\".calendar-month-week-number.abs.z3\",\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tonclick: (e: MouseEvent) => {\n\t\t\t\t\t\t\t\t\te.stopPropagation()\n\t\t\t\t\t\t\t\t\tattrs.onDateSelected(new Date(day.date), CalendarViewType.WEEK)\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tgetWeekNumber(day.date),\n\t\t\t\t\t  )\n\t\t\t\t\t: null,\n\t\t\t],\n\t\t)\n\t}\n\n\tprivate renderDayHeader(\n\t\t{ date, day, isPaddingDay }: CalendarDay,\n\t\tonDateSelected: (date: Date, calendarViewTypeToShow: CalendarViewType) => unknown,\n\t): Children {\n\t\tconst size = styles.isDesktopLayout() ? px(22) : px(20)\n\t\treturn m(\n\t\t\t\".rel.click.flex.items-center.justify-center.rel.ml-hpad_small\",\n\t\t\t{\n\t\t\t\t\"aria-label\": date.toLocaleDateString(),\n\t\t\t\tonclick: (e: MouseEvent) => {\n\t\t\t\t\tonDateSelected(new Date(date), client.isDesktopDevice() || styles.isDesktopLayout() ? CalendarViewType.DAY : CalendarViewType.AGENDA)\n\t\t\t\t\te.stopPropagation()\n\t\t\t\t},\n\t\t\t},\n\t\t\t[\n\t\t\t\tm(\".abs.z1.circle\", {\n\t\t\t\t\tclass: isToday(date) ? \"calendar-current-day-circle\" : \"\",\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\twidth: size,\n\t\t\t\t\t\theight: size,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tm(\n\t\t\t\t\t\".full-width.height-100p.center.z2\",\n\t\t\t\t\t{\n\t\t\t\t\t\tclass: isToday(date) ? \"calendar-current-day-text\" : \"\",\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\topacity: isPaddingDay ? 0.4 : 1,\n\t\t\t\t\t\t\tfontWeight: isPaddingDay ? \"500\" : null,\n\t\t\t\t\t\t\tfontSize: styles.isDesktopLayout() ? \"14px\" : \"12px\",\n\t\t\t\t\t\t\tlineHeight: size,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tString(day),\n\t\t\t\t),\n\t\t\t],\n\t\t)\n\t}\n\n\t/** render the events for the given week */\n\tprivate renderWeekEvents(attrs: CalendarMonthAttrs, week: ReadonlyArray<CalendarDay>, zone: string, isDisabled: boolean): Children {\n\t\tconst eventsOnDays = attrs.getEventsOnDaysToRender(week.map((day) => day.date))\n\t\tconst events = new Set(eventsOnDays.longEvents.concat(eventsOnDays.shortEventsPerDay.flat()))\n\t\tconst firstDayOfWeek = week[0].date\n\t\tconst lastDayOfWeek = lastThrow(week)\n\n\t\tconst dayWidth = this.getWidthForDay()\n\n\t\tconst weekHeight = this.getHeightForWeek()\n\n\t\tconst eventHeight = size.calendar_line_height + spaceBetweenEvents() // height + border\n\n\t\tconst maxEventsPerDay = (weekHeight - dayHeight()) / eventHeight\n\t\tconst numberOfEventsPerDayToRender = Math.floor(maxEventsPerDay) - 1 // preserve some space for the more events indicator\n\n\t\t/** initially, we have 0 extra, non-rendered events on each day of the week */\n\t\tconst moreEventsForDay = [0, 0, 0, 0, 0, 0, 0]\n\t\tconst eventMargin = styles.isDesktopLayout() ? size.calendar_event_margin : size.calendar_event_margin_mobile\n\t\tconst firstDayOfNextWeek = getStartOfNextDayWithZone(lastDayOfWeek.date, zone)\n\t\treturn layOutEvents(\n\t\t\tArray.from(events),\n\t\t\tzone,\n\t\t\t(columns) => {\n\t\t\t\treturn columns\n\t\t\t\t\t.map((eventsInColumn, columnIndex) => {\n\t\t\t\t\t\treturn eventsInColumn.map((event) => {\n\t\t\t\t\t\t\tif (columnIndex < numberOfEventsPerDayToRender) {\n\t\t\t\t\t\t\t\tconst eventIsAllDay = isAllDayEventByTimes(event.startTime, event.endTime)\n\t\t\t\t\t\t\t\tconst eventStart = eventIsAllDay ? getAllDayDateForTimezone(event.startTime, zone) : event.startTime\n\t\t\t\t\t\t\t\tconst eventEnd = eventIsAllDay ? incrementDate(getEventEnd(event, zone), -1) : event.endTime\n\n\t\t\t\t\t\t\t\tconst position = this.getEventPosition(\n\t\t\t\t\t\t\t\t\teventStart,\n\t\t\t\t\t\t\t\t\teventEnd,\n\t\t\t\t\t\t\t\t\tfirstDayOfWeek,\n\t\t\t\t\t\t\t\t\tfirstDayOfNextWeek,\n\t\t\t\t\t\t\t\t\tdayWidth,\n\t\t\t\t\t\t\t\t\tdayHeight(),\n\t\t\t\t\t\t\t\t\tcolumnIndex,\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\treturn this.renderEvent(event, position, eventStart, firstDayOfWeek, firstDayOfNextWeek, eventEnd, attrs, isDisabled)\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfor (const [dayIndex, dayInWeek] of week.entries()) {\n\t\t\t\t\t\t\t\t\tconst eventsForDay = attrs.eventsForDays.get(dayInWeek.date.getTime())\n\n\t\t\t\t\t\t\t\t\tif (eventsForDay && eventsForDay.indexOf(event) !== -1) {\n\t\t\t\t\t\t\t\t\t\tmoreEventsForDay[dayIndex]++\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn null\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t\t.concat(\n\t\t\t\t\t\tmoreEventsForDay.map((moreEventsCount, weekday) => {\n\t\t\t\t\t\t\tconst day = week[weekday]\n\t\t\t\t\t\t\tconst isPadding = day.isPaddingDay\n\n\t\t\t\t\t\t\tif (moreEventsCount > 0) {\n\t\t\t\t\t\t\t\treturn m(\n\t\t\t\t\t\t\t\t\t\".abs.small\" + (isPadding ? \".calendar-bubble-more-padding-day\" : \"\"),\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t\tbottom: 0,\n\t\t\t\t\t\t\t\t\t\t\theight: px(CALENDAR_EVENT_HEIGHT),\n\t\t\t\t\t\t\t\t\t\t\tleft: px(weekday * dayWidth + eventMargin),\n\t\t\t\t\t\t\t\t\t\t\twidth: px(dayWidth - 2 - eventMargin * 2),\n\t\t\t\t\t\t\t\t\t\t\tpointerEvents: \"none\",\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t\t\t\"font-weight\": \"600\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\"+\" + moreEventsCount,\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn null\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t)\n\t\t\t},\n\t\t\tEventLayoutMode.DayBasedColumn,\n\t\t)\n\t}\n\n\tprivate renderEvent(\n\t\tevent: CalendarEvent,\n\t\tposition: SimplePosRect,\n\t\teventStart: Date,\n\t\tfirstDayOfWeek: Date,\n\t\tfirstDayOfNextWeek: Date,\n\t\teventEnd: Date,\n\t\tattrs: CalendarMonthAttrs,\n\t\tisDisabled: boolean,\n\t): Children {\n\t\tconst isTemporary = attrs.temporaryEvents.includes(event)\n\t\treturn m(\n\t\t\t\".abs.overflow-hidden\",\n\t\t\t{\n\t\t\t\tkey: event._id[0] + event._id[1] + event.startTime.getTime(),\n\t\t\t\tstyle: {\n\t\t\t\t\ttop: px(position.top),\n\t\t\t\t\theight: px(CALENDAR_EVENT_HEIGHT),\n\t\t\t\t\tleft: px(position.left),\n\t\t\t\t\tright: px(position.right),\n\t\t\t\t\tpointerEvents: !styles.isUsingBottomNavigation() ? \"auto\" : \"none\",\n\t\t\t\t},\n\t\t\t\tonmousedown: () => {\n\t\t\t\t\tlet dayUnderMouse = this.dayUnderMouse\n\t\t\t\t\tlet lastMousePos = this.lastMousePos\n\n\t\t\t\t\tif (dayUnderMouse && lastMousePos && !isTemporary) {\n\t\t\t\t\t\tthis.eventDragHandler.prepareDrag(event, dayUnderMouse, lastMousePos, true)\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tm(ContinuingCalendarEventBubble, {\n\t\t\t\tevent: event,\n\t\t\t\tstartsBefore: eventStart < firstDayOfWeek,\n\t\t\t\tendsAfter: firstDayOfNextWeek < eventEnd,\n\t\t\t\tcolor: getEventColor(event, attrs.groupColors),\n\t\t\t\tshowTime: styles.isDesktopLayout() && !isAllDayEvent(event) ? EventTextTimeOption.START_TIME : null,\n\t\t\t\tuser: locator.logins.getUserController().user,\n\t\t\t\tonEventClicked: (e, domEvent) => {\n\t\t\t\t\tattrs.onEventClicked(event, domEvent)\n\t\t\t\t},\n\t\t\t\tonEventKeyDown: (e, domEvent) => {\n\t\t\t\t\tattrs.onEventKeyDown(event, domEvent)\n\t\t\t\t},\n\t\t\t\tfadeIn: !this.eventDragHandler.isDragging,\n\t\t\t\topacity: isTemporary ? TEMPORARY_EVENT_OPACITY : 1,\n\t\t\t\tenablePointerEvents: !this.eventDragHandler.isDragging && !isTemporary && client.isDesktopDevice() && !isDisabled,\n\t\t\t}),\n\t\t)\n\t}\n\n\tprivate getEventPosition(\n\t\teventStart: Date,\n\t\teventEnd: Date,\n\t\tfirstDayOfWeek: Date,\n\t\tfirstDayOfNextWeek: Date,\n\t\tcalendarDayWidth: number,\n\t\tcalendarDayHeight: number,\n\t\tcolumnIndex: number,\n\t): SimplePosRect {\n\t\tconst top = (size.calendar_line_height + spaceBetweenEvents()) * columnIndex + calendarDayHeight + EVENT_BUBBLE_VERTICAL_OFFSET\n\t\tconst dayOfStartDateInWeek = getDiffIn24IntervalsFast(eventStart, firstDayOfWeek)\n\t\tconst dayOfEndDateInWeek = getDiffIn24IntervalsFast(eventEnd, firstDayOfWeek)\n\t\tconst calendarEventMargin = styles.isDesktopLayout() ? size.calendar_event_margin : size.calendar_event_margin_mobile\n\t\tconst left = (eventStart < firstDayOfWeek ? 0 : dayOfStartDateInWeek * calendarDayWidth) + calendarEventMargin\n\t\tconst right = (eventEnd > firstDayOfNextWeek ? 0 : (6 - dayOfEndDateInWeek) * calendarDayWidth) + calendarEventMargin\n\t\treturn {\n\t\t\ttop,\n\t\t\tleft,\n\t\t\tright,\n\t\t}\n\t}\n\n\tprivate getHeightForWeek(): number {\n\t\tif (!this.monthDom) {\n\t\t\treturn 1\n\t\t}\n\n\t\tconst monthDomHeight = this.monthDom.offsetHeight\n\t\treturn monthDomHeight / 6\n\t}\n\n\tprivate getWidthForDay(): number {\n\t\tif (!this.monthDom) {\n\t\t\treturn 1\n\t\t}\n\n\t\tconst monthDomWidth = this.monthDom.offsetWidth\n\t\treturn monthDomWidth / 7\n\t}\n}\n\n/**\n * Optimization to not create luxon's DateTime in simple case.\n * May not work if we allow override time zones.\n */\nfunction getDiffIn24IntervalsFast(left: Date, right: Date): number {\n\tif (left.getMonth() === right.getMonth()) {\n\t\treturn left.getDate() - right.getDate()\n\t} else {\n\t\treturn getDiffIn24hIntervals(right, left)\n\t}\n}\n"]}