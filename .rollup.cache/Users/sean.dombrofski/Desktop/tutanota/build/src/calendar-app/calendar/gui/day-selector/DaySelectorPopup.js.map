{"version":3,"file":"DaySelectorPopup.js","sourceRoot":"","sources":["../../../../../../src/calendar-app/calendar/gui/day-selector/DaySelectorPopup.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,KAAK,EAAkB,MAAM,sCAAsC,CAAA;AAG5E,OAAO,CAAe,MAAM,SAAS,CAAA;AACrC,OAAO,EAAE,IAAI,EAAE,MAAM,oDAAoD,CAAA;AACzE,OAAO,EAAE,WAAW,EAAE,MAAM,kBAAkB,CAAA;AAC9C,OAAO,EAAE,UAAU,EAAE,OAAO,EAAE,SAAS,EAAiB,MAAM,gDAAgD,CAAA;AAC9G,OAAO,EAAE,IAAI,EAAE,MAAM,4CAA4C,CAAA;AACjE,OAAO,EAAE,EAAE,EAAE,MAAM,gCAAgC,CAAA;AACnD,OAAO,EAAE,uBAAuB,EAAE,MAAM,sCAAsC,CAAA;AAC9E,OAAO,EAAE,cAAc,EAAE,MAAM,uBAAuB,CAAA;AACtD,OAAO,EAAE,MAAM,EAAE,MAAM,kCAAkC,CAAA;AACzD,OAAO,0BAA0B,MAAM,oDAAoD,CAAA;AAW3F,MAAM,OAAO,gBAAgB;IAUC;IAAgC;IAT5C,UAAU,GAAe,EAAE,CAAA;IACpC,GAAG,GAAuB,IAAI,CAAA;IAC9B,WAAW,CAAM;IACjB,kBAAkB,GAAuB,IAAI,CAAA;IAErD;;;OAGG;IACH,YAA6B,IAAa,EAAmB,KAA4B;QAA5D,SAAI,GAAJ,IAAI,CAAS;QAAmB,UAAK,GAAL,KAAK,CAAuB;QACxF,IAAI,CAAC,cAAc,EAAE,CAAA;QACrB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;QAChC,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC,YAAY,CAAA;IACtC,CAAC;IAED,IAAI;QACH,OAAO,CAAC,CACP,+EAA+E,EAC/E;YACC,KAAK,EAAE;gBACN,OAAO,EAAE,GAAG;gBACZ,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC;gBACxB,GAAG,EAAE,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;aACzB;YACD,QAAQ,EAAE,CAAC;YACX,SAAS,EAAE,MAAM;YACjB,QAAQ,EAAE,CAAC,KAAK,EAAE,EAAE;gBACnB,IAAI,CAAC,GAAG,GAAG,KAAK,CAAC,GAAkB,CAAA;gBAEnC,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,EAAE,SAAS,oCAAsB,GAAG,EAAE,CAAC,CAAC,CAAC,EAAE;oBACvF,MAAM,EAAE,IAAI,CAAC,GAAG;iBAChB,CAAC,CAAA;gBAEF,8DAA8D;gBAC9D,uDAAuD;gBACvD,UAAU,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE,GAAG,CAAC,CAAA;YACzC,CAAC;SACD,EACD;YACC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,WAAW,CAAC;YACzC,CAAC,CAAC,4BAA4B,EAAE;gBAC/B,CAAC,CAAC,WAAW,EAAE;oBACd,YAAY,EAAE,IAAI,CAAC,WAAW;oBAC9B,cAAc,EAAE,IAAI,CAAC,KAAK,CAAC,cAAc;oBACzC,IAAI,EAAE,IAAI;oBACV,oBAAoB,EAAE,IAAI,CAAC,KAAK,CAAC,oBAAoB;oBACrD,qBAAqB,EAAE,IAAI;oBAC3B,oBAAoB,EAAE,CAAC,MAAM,EAAE,EAAE;wBAChC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAA;wBAC1B,CAAC,CAAC,MAAM,EAAE,CAAA;oBACX,CAAC;oBACD,gBAAgB,EAAE,KAAK;oBACvB,cAAc,EAAE,IAAI,CAAC,KAAK,CAAC,cAAc;oBACzC,qBAAqB,EAAE,IAAI,CAAC,KAAK,CAAC,qBAAqB;oBACvD,iBAAiB,EAAE,MAAM,CAAC,oBAAoB,EAAE;oBAChD,UAAU,EAAE,IAAI,CAAC,KAAK,CAAC,WAAW;iBAClC,CAAC;aACF,CAAC;SACF,CACD,CAAA;IACF,CAAC;IAEO,kBAAkB,CAAC,IAAU;QACpC,OAAO,CAAC,CAAC,4CAA4C,EAAE;YACtD,CAAC,CACA,IAAI,EACJ;gBACC,KAAK,EAAE;oBACN,QAAQ,EAAE,MAAM;oBAChB,UAAU,EAAE,KAAK;iBACjB;aACD,EACD,uBAAuB,CAAC,IAAI,CAAC,CAC7B;YACD,CAAC,CAAC,oBAAoB,EAAE;gBACvB,0BAA0B,CAAC,KAAK,EAAE,EAAE,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;gBACtE,0BAA0B,CAAC,IAAI,EAAE,EAAE,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;aACpE,CAAC;SACF,CAAC,CAAA;IACH,CAAC;IAEO,aAAa,CAAC,OAAgB;QACrC,IAAI,CAAC,WAAW,GAAG,cAAc,CAAC,IAAI,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;IACtE,CAAC;IAED,kGAAkG;IAClG,iGAAiG;IACzF,aAAa,CAAC,EAAW;QAChC,MAAM,aAAa,GAAG,QAAQ,CAAC,sBAAsB,CAAC,WAAW,CAAC,CAAA;QAElE,IAAI,aAAa,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YAC9B,MAAM,OAAO,GAAG,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;YACrC,IAAI,EAAE;gBAAE,OAAO,EAAE,YAAY,CAAC,OAAO,EAAE,MAAM,CAAC,CAAA;;gBACzC,OAAO,EAAE,eAAe,CAAC,OAAO,CAAC,CAAA;QACvC,CAAC;IACF,CAAC;IAED,IAAI;QACH,IAAI,CAAC,kBAAkB,GAAG,QAAQ,CAAC,aAA4B,CAAA;QAC/D,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAA;QACxB,KAAK,CAAC,OAAO,CAAC,IAAI,EAAE,KAAK,CAAC,CAAA;IAC3B,CAAC;IAED,KAAK;QACJ,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAA;QACzB,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;IACnB,CAAC;IAED,eAAe,CAAC,CAAa;QAC5B,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAA;QACzB,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;IACnB,CAAC;IAED,aAAa;QACZ,OAAO,OAAO,CAAC,OAAO,EAAE,CAAA;IACzB,CAAC;IAED,OAAO;QACN,IAAI,CAAC,KAAK,EAAE,CAAA;IACb,CAAC;IAED,SAAS;QACR,OAAO,IAAI,CAAC,UAAU,CAAA;IACvB,CAAC;IAED,QAAQ,CAAC,CAAQ;QAChB,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAA;QACzB,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;QAClB,OAAO,KAAK,CAAA;IACb,CAAC;IAED,cAAc;QACb,OAAO,IAAI,CAAC,kBAAkB,CAAA;IAC/B,CAAC;IAEO,cAAc;QACrB,MAAM,KAAK,GAAa;YACvB,GAAG,EAAE,IAAI,CAAC,GAAG;YACb,IAAI,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,KAAK,EAAE;YACxB,IAAI,EAAE,WAAW;SACjB,CAAA;QAED,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;IAC5B,CAAC;CACD","sourcesContent":["import { modal, ModalComponent } from \"../../../../common/gui/base/Modal.js\"\nimport { Shortcut } from \"../../../../common/misc/KeyManager.js\"\nimport { PosRect } from \"../../../../common/gui/base/Dropdown.js\"\nimport m, { Children } from \"mithril\"\nimport { Keys } from \"../../../../common/api/common/TutanotaConstants.js\"\nimport { DaySelector } from \"./DaySelector.js\"\nimport { animations, opacity, transform, TransformEnum } from \"../../../../common/gui/animation/Animations.js\"\nimport { ease } from \"../../../../common/gui/animation/Easing.js\"\nimport { px } from \"../../../../common/gui/size.js\"\nimport { formatMonthWithFullYear } from \"../../../../common/misc/Formatter.js\"\nimport { incrementMonth } from \"@tutao/tutanota-utils\"\nimport { styles } from \"../../../../common/gui/styles.js\"\nimport renderSwitchMonthArrowIcon from \"../../../../common/gui/base/buttons/ArrowButton.js\"\n\nexport interface DaySelectorPopupAttrs {\n\tselectedDate: Date\n\tonDateSelected: (date: Date, dayClick: boolean) => unknown\n\tstartOfTheWeekOffset: number\n\thasEventsOn: (date: Date) => boolean\n\thighlightToday: boolean\n\thighlightSelectedWeek: boolean\n}\n\nexport class DaySelectorPopup implements ModalComponent {\n\tprivate readonly _shortcuts: Shortcut[] = []\n\tprivate dom: HTMLElement | null = null\n\tprivate currentDate: Date\n\tprivate focusedBeforeShown: HTMLElement | null = null\n\n\t/**\n\t * @param rect The rect with coordinates about where the popup should be rendered\n\t * @param attrs The attributes for the component\n\t */\n\tconstructor(private readonly rect: PosRect, private readonly attrs: DaySelectorPopupAttrs) {\n\t\tthis.setupShortcuts()\n\t\tthis.view = this.view.bind(this)\n\t\tthis.currentDate = attrs.selectedDate\n\t}\n\n\tview(): Children {\n\t\treturn m(\n\t\t\t\".abs.elevated-bg.plr.pt-s.pb-m.border-radius.dropdown-shadow.flex.flex-column\",\n\t\t\t{\n\t\t\t\tstyle: {\n\t\t\t\t\topacity: \"0\",\n\t\t\t\t\tleft: px(this.rect.left),\n\t\t\t\t\ttop: px(this.rect.bottom),\n\t\t\t\t},\n\t\t\t\ttabIndex: 0,\n\t\t\t\tautoFocus: \"true\",\n\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\tthis.dom = vnode.dom as HTMLElement\n\n\t\t\t\t\tanimations.add(this.dom, [opacity(0, 1, true), transform(TransformEnum.Scale, 0.5, 1)], {\n\t\t\t\t\t\teasing: ease.out,\n\t\t\t\t\t})\n\n\t\t\t\t\t// We need a little timeout to focus the modal, this will wait\n\t\t\t\t\t// the necessary time to the popup be visible on screen\n\t\t\t\t\tsetTimeout(() => this.dom?.focus(), 200)\n\t\t\t\t},\n\t\t\t},\n\t\t\t[\n\t\t\t\tthis.renderPickerHeader(this.currentDate),\n\t\t\t\tm(\".flex-grow.overflow-hidden\", [\n\t\t\t\t\tm(DaySelector, {\n\t\t\t\t\t\tselectedDate: this.currentDate,\n\t\t\t\t\t\tonDateSelected: this.attrs.onDateSelected,\n\t\t\t\t\t\twide: true,\n\t\t\t\t\t\tstartOfTheWeekOffset: this.attrs.startOfTheWeekOffset,\n\t\t\t\t\t\tisDaySelectorExpanded: true,\n\t\t\t\t\t\thandleDayPickerSwipe: (isNext) => {\n\t\t\t\t\t\t\tthis.onMonthChange(isNext)\n\t\t\t\t\t\t\tm.redraw()\n\t\t\t\t\t\t},\n\t\t\t\t\t\tshowDaySelection: false,\n\t\t\t\t\t\thighlightToday: this.attrs.highlightToday,\n\t\t\t\t\t\thighlightSelectedWeek: this.attrs.highlightSelectedWeek,\n\t\t\t\t\t\tuseNarrowWeekName: styles.isSingleColumnLayout(),\n\t\t\t\t\t\thasEventOn: this.attrs.hasEventsOn,\n\t\t\t\t\t}),\n\t\t\t\t]),\n\t\t\t],\n\t\t)\n\t}\n\n\tprivate renderPickerHeader(date: Date): Children {\n\t\treturn m(\".flex.flex-space-between.pb-s.items-center\", [\n\t\t\tm(\n\t\t\t\t\".b\",\n\t\t\t\t{\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tfontSize: \"14px\",\n\t\t\t\t\t\tmarginLeft: \"6px\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tformatMonthWithFullYear(date),\n\t\t\t),\n\t\t\tm(\".flex.items-center\", [\n\t\t\t\trenderSwitchMonthArrowIcon(false, 24, () => this.onMonthChange(false)),\n\t\t\t\trenderSwitchMonthArrowIcon(true, 24, () => this.onMonthChange(true)),\n\t\t\t]),\n\t\t])\n\t}\n\n\tprivate onMonthChange(forward: boolean) {\n\t\tthis.currentDate = incrementMonth(this.currentDate, forward ? 1 : -1)\n\t}\n\n\t// Sets the content div (.main-view) to inert, disabling the ability to be focused, this traps the\n\t// focus to the popup, releasing it just when the popup is closed and the inert property removed.\n\tprivate turnTrapFocus(on: boolean) {\n\t\tconst elementsQuery = document.getElementsByClassName(\"main-view\")\n\n\t\tif (elementsQuery.length > 0) {\n\t\t\tconst mainDiv = elementsQuery.item(0)\n\t\t\tif (on) mainDiv?.setAttribute(\"inert\", \"true\")\n\t\t\telse mainDiv?.removeAttribute(\"inert\")\n\t\t}\n\t}\n\n\tshow() {\n\t\tthis.focusedBeforeShown = document.activeElement as HTMLElement\n\t\tthis.turnTrapFocus(true)\n\t\tmodal.display(this, false)\n\t}\n\n\tclose() {\n\t\tthis.turnTrapFocus(false)\n\t\tmodal.remove(this)\n\t}\n\n\tbackgroundClick(e: MouseEvent): void {\n\t\tthis.turnTrapFocus(false)\n\t\tmodal.remove(this)\n\t}\n\n\thideAnimation(): Promise<void> {\n\t\treturn Promise.resolve()\n\t}\n\n\tonClose(): void {\n\t\tthis.close()\n\t}\n\n\tshortcuts(): Shortcut[] {\n\t\treturn this._shortcuts\n\t}\n\n\tpopState(e: Event): boolean {\n\t\tthis.turnTrapFocus(false)\n\t\tmodal.remove(this)\n\t\treturn false\n\t}\n\n\tcallingElement(): HTMLElement | null {\n\t\treturn this.focusedBeforeShown\n\t}\n\n\tprivate setupShortcuts() {\n\t\tconst close: Shortcut = {\n\t\t\tkey: Keys.ESC,\n\t\t\texec: () => this.close(),\n\t\t\thelp: \"close_alt\",\n\t\t}\n\n\t\tthis._shortcuts.push(close)\n\t}\n}\n"]}