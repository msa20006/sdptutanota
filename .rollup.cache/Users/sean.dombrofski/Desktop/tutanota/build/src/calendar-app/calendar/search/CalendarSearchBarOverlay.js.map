{"version":3,"file":"CalendarSearchBarOverlay.js","sourceRoot":"","sources":["../../../../../src/calendar-app/calendar/search/CalendarSearchBarOverlay.ts"],"names":[],"mappings":"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","sourcesContent":["import { CalendarSearchBarAttrs, CalendarSearchBarState, Entry, ShowMoreAction } from \"./CalendarSearchBar.js\"\nimport m, { Children, Component, Vnode } from \"mithril\"\nimport { downcast, isEmpty, isSameTypeRef, TypeRef } from \"@tutao/tutanota-utils\"\nimport { px, size } from \"../../../common/gui/size.js\"\nimport { CalendarEvent, CalendarEventTypeRef } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport { lang } from \"../../../common/misc/LanguageViewModel.js\"\nimport { locator } from \"../../../common/api/main/CommonLocator.js\"\nimport { FULL_INDEXED_TIMESTAMP } from \"../../../common/api/common/TutanotaConstants.js\"\nimport { formatDate } from \"../../../common/misc/Formatter.js\"\nimport { formatEventDuration } from \"../gui/CalendarGuiUtils.js\"\nimport { getTimeZone } from \"../../../common/calendar/date/CalendarUtils.js\"\n\ntype CalendarSearchBarOverlayAttrs = {\n\tstate: CalendarSearchBarState\n\tisQuickSearch: boolean\n\tisFocused: boolean\n\tselectResult: (result: Entry | null) => void\n}\n\nexport class CalendarSearchBarOverlay implements Component<CalendarSearchBarOverlayAttrs> {\n\tview({ attrs }: Vnode<CalendarSearchBarOverlayAttrs>): Children {\n\t\tconst { state } = attrs\n\t\treturn [state.entities && !isEmpty(state.entities) && attrs.isQuickSearch && attrs.isFocused ? this.renderResults(state, attrs) : null]\n\t}\n\n\trenderResults(state: CalendarSearchBarState, attrs: CalendarSearchBarOverlayAttrs): Children {\n\t\treturn m(\"ul.list.click.mail-list\", [\n\t\t\tstate.entities.map((result) => {\n\t\t\t\treturn m(\n\t\t\t\t\t\"li.plr-l.flex-v-center.\",\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\theight: px(52),\n\t\t\t\t\t\t\t\"border-left\": px(size.border_selection) + \" solid transparent\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\t// avoid closing overlay before the click event can be received\n\t\t\t\t\t\tonmousedown: (e: MouseEvent) => e.preventDefault(),\n\t\t\t\t\t\tonclick: () => attrs.selectResult(result),\n\t\t\t\t\t\tclass: state.selected === result ? \"row-selected\" : \"\",\n\t\t\t\t\t},\n\t\t\t\t\tthis.renderResult(state, result),\n\t\t\t\t)\n\t\t\t}),\n\t\t])\n\t}\n\n\trenderResult(state: CalendarSearchBarState, result: Entry): Children {\n\t\tlet type: TypeRef<any> | null = \"_type\" in result ? result._type : null\n\n\t\tif (!type) {\n\t\t\treturn this.renderShowMoreAction(downcast(result))\n\t\t} else if (isSameTypeRef(CalendarEventTypeRef, type)) {\n\t\t\treturn this.renderCalendarEventResult(downcast(result))\n\t\t} else {\n\t\t\treturn []\n\t\t}\n\t}\n\n\tprivate renderShowMoreAction(result: ShowMoreAction): Children {\n\t\t// show more action\n\t\tlet showMoreAction = result as any as ShowMoreAction\n\t\tlet infoText\n\t\tlet indexInfo\n\n\t\tif (showMoreAction.resultCount === 0) {\n\t\t\tinfoText = lang.get(\"searchNoResults_msg\")\n\n\t\t\tif (locator.logins.getUserController().isFreeAccount()) {\n\t\t\t\tindexInfo = lang.get(\"changeTimeFrame_msg\")\n\t\t\t}\n\t\t} else if (showMoreAction.allowShowMore) {\n\t\t\tinfoText = lang.get(\"showMore_action\")\n\t\t} else {\n\t\t\tinfoText = lang.get(\"moreResultsFound_msg\", {\n\t\t\t\t\"{1}\": showMoreAction.resultCount - showMoreAction.shownCount,\n\t\t\t})\n\t\t}\n\n\t\tif (showMoreAction.indexTimestamp > FULL_INDEXED_TIMESTAMP && !indexInfo) {\n\t\t\tindexInfo = lang.get(\"searchedUntil_msg\") + \" \" + formatDate(new Date(showMoreAction.indexTimestamp))\n\t\t}\n\n\t\treturn indexInfo\n\t\t\t? [m(\".top.flex-center\", infoText), m(\".bottom.flex-center.small\", indexInfo)]\n\t\t\t: m(\"li.plr-l.pt-s.pb-s.items-center.flex-center\", m(\".flex-center\", infoText))\n\t}\n\n\tprivate renderCalendarEventResult(event: CalendarEvent): Children {\n\t\treturn [\n\t\t\tm(\".top.flex-space-between\", m(\".name.text-ellipsis\", { title: event.summary }, event.summary)),\n\t\t\tm(\".bottom.flex-space-between\", m(\"small.mail-address\", formatEventDuration(event, getTimeZone(), false))),\n\t\t]\n\t}\n}\n"]}