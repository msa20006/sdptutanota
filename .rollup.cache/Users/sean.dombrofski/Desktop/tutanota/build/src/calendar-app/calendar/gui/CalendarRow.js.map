{"version":3,"file":"CalendarRow.js","sourceRoot":"","sources":["../../../../../src/calendar-app/calendar/gui/CalendarRow.ts"],"names":[],"mappings":"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","sourcesContent":["import type { CalendarEvent } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport { locator } from \"../../../common/api/main/CommonLocator.js\"\nimport m, { Children, VnodeDOM } from \"mithril\"\n\nimport { SelectableRowContainer, SelectableRowContainerAttrs, SelectableRowSelectedSetter } from \"../../../common/gui/SelectableRowContainer.js\"\nimport { VirtualRow } from \"../../../common/gui/base/ListUtils.js\"\nimport { getTimeZone } from \"../../../common/calendar/date/CalendarUtils.js\"\nimport { ViewHolder } from \"../../../common/gui/base/List.js\"\nimport { styles } from \"../../../common/gui/styles.js\"\nimport { DefaultAnimationTime } from \"../../../common/gui/animation/Animations.js\"\n\nimport { formatEventDuration, getClientOnlyColors, getDisplayEventTitle, getEventColor, getGroupColors } from \"./CalendarGuiUtils.js\"\nimport { GroupColors } from \"../view/CalendarView.js\"\n\nexport class CalendarRow implements VirtualRow<CalendarEvent> {\n\ttop: number\n\n\tentity: CalendarEvent | null\n\tcolors: GroupColors\n\n\tprivate selectionSetter!: SelectableRowSelectedSetter\n\tprivate calendarIndicatorDom!: HTMLElement\n\tprivate summaryDom!: HTMLElement\n\tprivate durationDom!: HTMLElement\n\n\tconstructor(readonly domElement: HTMLElement) {\n\t\tthis.top = 0\n\t\tthis.entity = null\n\n\t\tconst clientOnlyColors = getClientOnlyColors(locator.logins.getUserController().userId, locator.deviceConfig.getClientOnlyCalendars())\n\t\tconst groupColors = getGroupColors(locator.logins.getUserController().userSettingsGroupRoot)\n\t\tfor (let [calendarId, color] of clientOnlyColors.entries()) {\n\t\t\tgroupColors.set(calendarId, color)\n\t\t}\n\n\t\tthis.colors = groupColors\n\t}\n\n\tupdate(event: CalendarEvent, selected: boolean, isInMultiSelect: boolean): void {\n\t\tthis.entity = event\n\t\tthis.summaryDom.innerText = getDisplayEventTitle(event.summary)\n\t\tthis.calendarIndicatorDom.style.backgroundColor = `#${getEventColor(event, this.colors)}`\n\t\tthis.durationDom.innerText = formatEventDuration(this.entity, getTimeZone(), false)\n\n\t\tthis.selectionSetter(selected, isInMultiSelect)\n\t}\n\n\t/**\n\t * Only the structure is managed by mithril. We set all contents on our own (see update) in order to avoid the vdom overhead (not negligible on mobiles)\n\t */\n\trender(): Children {\n\t\treturn m(\n\t\t\tSelectableRowContainer,\n\t\t\t{\n\t\t\t\tonSelectedChangeRef: (changer) => {\n\t\t\t\t\tthis.selectionSetter = changer\n\t\t\t\t},\n\t\t\t} satisfies SelectableRowContainerAttrs,\n\t\t\tm(\n\t\t\t\t\".flex.items-center.gap-vpad.click.border-radius\",\n\t\t\t\t{\n\t\t\t\t\tclass: (styles.isDesktopLayout() ? \"\" : \"state-bg\") + \"limit-width full-width\",\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\ttransition: `background ${DefaultAnimationTime}ms`,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[\n\t\t\t\t\tm(\"\", {\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tminWidth: \"16px\",\n\t\t\t\t\t\t\tminHeight: \"16px\",\n\t\t\t\t\t\t\tborderRadius: \"50%\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\toncreate: (vnode: VnodeDOM) => {\n\t\t\t\t\t\t\tthis.calendarIndicatorDom = vnode.dom as HTMLElement\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tm(\".flex.col\", { class: \"min-width-0\" }, [\n\t\t\t\t\t\tm(\"p.b.m-0.badge-line-height\", {\n\t\t\t\t\t\t\tclass: \"text-ellipsis\",\n\t\t\t\t\t\t\toncreate: (vnode: VnodeDOM) => {\n\t\t\t\t\t\t\t\tthis.summaryDom = vnode.dom as HTMLElement\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tm(\".smaller\", {\n\t\t\t\t\t\t\toncreate: (vnode: VnodeDOM) => {\n\t\t\t\t\t\t\t\tthis.durationDom = vnode.dom as HTMLElement\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t],\n\t\t\t),\n\t\t)\n\t}\n}\n\nexport class KindaCalendarRow implements ViewHolder<CalendarEvent> {\n\treadonly cr: CalendarRow\n\tdomElement: HTMLElement\n\tentity: CalendarEvent | null = null\n\n\tconstructor(dom: HTMLElement) {\n\t\tthis.cr = new CalendarRow(dom)\n\t\tthis.domElement = dom\n\t\tm.render(dom, this.cr.render())\n\t}\n\n\tupdate(item: CalendarEvent, selected: boolean, isInMultiSelect: boolean) {\n\t\tthis.entity = item\n\t\tthis.cr.update(item, selected, isInMultiSelect)\n\t}\n\n\trender(): Children {\n\t\treturn this.cr.render()\n\t}\n}\n"]}