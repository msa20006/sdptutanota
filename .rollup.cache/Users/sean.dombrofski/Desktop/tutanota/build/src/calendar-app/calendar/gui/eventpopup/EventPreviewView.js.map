{"version":3,"file":"EventPreviewView.js","sourceRoot":"","sources":["../../../../../../src/calendar-app/calendar/gui/eventpopup/EventPreviewView.ts"],"names":[],"mappings":"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","sourcesContent":["import type { CalendarEvent, CalendarEventAttendee, CalendarRepeatRule, EncryptedMailAddress } from \"../../../../common/api/entities/tutanota/TypeRefs.js\"\nimport { createCalendarEventAttendee, createEncryptedMailAddress } from \"../../../../common/api/entities/tutanota/TypeRefs.js\"\nimport m, { Children, Component, Vnode } from \"mithril\"\nimport { AllIcons, Icon, IconSize } from \"../../../../common/gui/base/Icon.js\"\nimport { theme } from \"../../../../common/gui/theme.js\"\nimport { BootIcons } from \"../../../../common/gui/base/icons/BootIcons.js\"\nimport { Icons } from \"../../../../common/gui/base/icons/Icons.js\"\nimport { getRepeatEndTimeForDisplay, getTimeZone } from \"../../../../common/calendar/date/CalendarUtils.js\"\nimport { CalendarAttendeeStatus, EndType, getAttendeeStatus, RepeatPeriod } from \"../../../../common/api/common/TutanotaConstants.js\"\nimport { downcast, memoized } from \"@tutao/tutanota-utils\"\nimport { lang, TranslationKey } from \"../../../../common/misc/LanguageViewModel.js\"\nimport type { RepeatRule } from \"../../../../common/api/entities/sys/TypeRefs.js\"\nimport { cleanMailAddress, findAttendeeInAddresses, isAllDayEvent } from \"../../../../common/api/common/utils/CommonCalendarUtils.js\"\nimport { formatDateWithMonth } from \"../../../../common/misc/Formatter.js\"\nimport { BannerButton, BannerButtonAttrs } from \"../../../../common/gui/base/buttons/BannerButton.js\"\nimport { pureComponent } from \"../../../../common/gui/base/PureComponent.js\"\nimport { CalendarEventPreviewViewModel } from \"./CalendarEventPreviewViewModel.js\"\nimport { UpgradeRequiredError } from \"../../../../common/api/main/UpgradeRequiredError.js\"\nimport { showPlanUpgradeRequiredDialog } from \"../../../../common/misc/SubscriptionDialogs.js\"\nimport { ExternalLink } from \"../../../../common/gui/base/ExternalLink.js\"\n\nimport { createRepeatRuleFrequencyValues, formatEventDuration, getDisplayEventTitle, iconForAttendeeStatus } from \"../CalendarGuiUtils.js\"\nimport { hasError } from \"../../../../common/api/common/utils/ErrorUtils.js\"\n\nexport type EventPreviewViewAttrs = {\n\tevent: Omit<CalendarEvent, \"description\">\n\tsanitizedDescription: string | null\n\tparticipation?: ReturnType<typeof CalendarEventPreviewViewModel.prototype.getParticipationSetterAndThen>\n}\n\n/** the buttons enabling the user to view their current participation status on an event and to trigger a change to it, including\n * a mail to the organizer. */\nexport const ReplyButtons = pureComponent((participation: NonNullable<EventPreviewViewAttrs[\"participation\"]>) => {\n\tconst colors = {\n\t\tborderColor: theme.content_button,\n\t\tcolor: theme.content_fg,\n\t}\n\n\tconst highlightColors = {\n\t\tborderColor: theme.content_accent,\n\t\tcolor: theme.content_accent,\n\t}\n\n\tconst makeStatusButtonAttrs = (status: CalendarAttendeeStatus, text: TranslationKey): BannerButtonAttrs =>\n\t\tObject.assign(\n\t\t\t{\n\t\t\t\ttext,\n\t\t\t\tclass: \"width-min-content\",\n\t\t\t\tclick: async () => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait participation.setParticipation(status)\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tif (e instanceof UpgradeRequiredError) {\n\t\t\t\t\t\t\tconst ordered = await showPlanUpgradeRequiredDialog(e.plans, e.message)\n\t\t\t\t\t\t\tif (!ordered) return\n\t\t\t\t\t\t\tawait participation.setParticipation(status)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow e\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tparticipation.ownAttendee.status === status ? highlightColors : colors,\n\t\t)\n\n\treturn m(\".flex.col\", [\n\t\tm(\".small\", lang.get(\"invitedToEvent_msg\")),\n\t\tm(\".flex.items-center.mt-s\", [\n\t\t\tm(BannerButton, makeStatusButtonAttrs(CalendarAttendeeStatus.ACCEPTED, \"yes_label\")),\n\t\t\tm(BannerButton, makeStatusButtonAttrs(CalendarAttendeeStatus.TENTATIVE, \"maybe_label\")),\n\t\t\tm(BannerButton, makeStatusButtonAttrs(CalendarAttendeeStatus.DECLINED, \"no_label\")),\n\t\t]),\n\t])\n})\n\nexport class EventPreviewView implements Component<EventPreviewViewAttrs> {\n\t// Cache the parsed URL, so we don't parse the URL on every single view call\n\tprivate readonly getLocationUrl: typeof getLocationUrl\n\n\tconstructor() {\n\t\tthis.getLocationUrl = memoized(getLocationUrl)\n\t}\n\n\tview(vnode: Vnode<EventPreviewViewAttrs>): Children {\n\t\tconst { event, sanitizedDescription, participation } = vnode.attrs\n\t\tconst attendees = prepareAttendees(event.attendees, event.organizer)\n\t\tconst eventTitle = getDisplayEventTitle(event.summary)\n\n\t\treturn m(\".flex.col.smaller.scroll.visible-scrollbar\", [\n\t\t\tthis.renderRow(BootIcons.Calendar, [m(\"span.h3\", eventTitle)]),\n\t\t\tthis.renderRow(Icons.Time, [formatEventDuration(event, getTimeZone(), false), this.renderRepeatRule(event.repeatRule, isAllDayEvent(event))]),\n\t\t\tthis.renderLocation(event.location),\n\t\t\tthis.renderAttendeesSection(attendees, participation),\n\t\t\tthis.renderAttendanceSection(event, attendees, participation),\n\t\t\tthis.renderDescription(sanitizedDescription),\n\t\t])\n\t}\n\n\tprivate renderRow(headerIcon: AllIcons, children: Children, isAlignedLeft?: boolean): Children {\n\t\treturn m(\n\t\t\t\".flex.pb-s\",\n\t\t\t{\n\t\t\t\tclass: isAlignedLeft ? \"items-start\" : \"items-center\",\n\t\t\t},\n\t\t\t[this.renderSectionIndicator(headerIcon, isAlignedLeft ? { marginTop: \"2px\" } : undefined), m(\".selectable.text-break.full-width\", children)],\n\t\t)\n\t}\n\n\tprivate renderSectionIndicator(icon: AllIcons, style: Record<string, any> = {}): Children {\n\t\treturn m(Icon, {\n\t\t\ticon,\n\t\t\tclass: \"pr\",\n\t\t\tsize: IconSize.Medium,\n\t\t\tstyle: Object.assign(\n\t\t\t\t{\n\t\t\t\t\tfill: theme.content_button,\n\t\t\t\t\tdisplay: \"block\",\n\t\t\t\t},\n\t\t\t\tstyle,\n\t\t\t),\n\t\t})\n\t}\n\n\tprivate renderRepeatRule(rule: CalendarRepeatRule | null, isAllDay: boolean): Children {\n\t\tif (rule == null) return null\n\n\t\tconst frequency = formatRepetitionFrequency(rule)\n\n\t\tif (frequency) {\n\t\t\treturn m(\"\", frequency + formatRepetitionEnd(rule, isAllDay))\n\t\t} else {\n\t\t\t// If we cannot properly process the frequency we just indicate that the event is part of a series.\n\t\t\treturn m(\"\", lang.get(\"unknownRepetition_msg\"))\n\t\t}\n\t}\n\n\tprivate renderLocation(location: string | null): Children {\n\t\tif (location == null || location.trim().length === 0) return null\n\t\treturn this.renderRow(Icons.Pin, [\n\t\t\tm(\n\t\t\t\t\".text-ellipsis.selectable\",\n\t\t\t\tm(ExternalLink, {\n\t\t\t\t\thref: this.getLocationUrl(location.trim()).toString(),\n\t\t\t\t\ttext: location,\n\t\t\t\t\tisCompanySite: false,\n\t\t\t\t}),\n\t\t\t),\n\t\t])\n\t}\n\n\tprivate renderAttendeesSection(attendees: Array<CalendarEventAttendee>, participation: EventPreviewViewAttrs[\"participation\"]): Children {\n\t\tif (attendees.length === 0) return null\n\t\treturn this.renderRow(\n\t\t\tIcons.People,\n\t\t\t[\n\t\t\t\tm(\n\t\t\t\t\t\".flex-wrap\",\n\t\t\t\t\tattendees.map((a) => this.renderAttendee(a, participation)),\n\t\t\t\t),\n\t\t\t],\n\t\t\ttrue,\n\t\t)\n\t}\n\n\t/**\n\t * if we're an attendee of this event, this renders a selector to be able to set our own attendance.\n\t * @param event if the event is not in a calendar, we don't want to set our attendance from here.\n\t * @param attendees list of attendees (including the organizer)\n\t * @param participation\n\t * @private\n\t */\n\tprivate renderAttendanceSection(\n\t\tevent: EventPreviewViewAttrs[\"event\"],\n\t\tattendees: Array<CalendarEventAttendee>,\n\t\tparticipation: EventPreviewViewAttrs[\"participation\"],\n\t): Children {\n\t\tif (attendees.length === 0 || participation == null || event._ownerGroup == null) return null\n\t\treturn m(\".flex.pb-s\", [this.renderSectionIndicator(BootIcons.Contacts), m(ReplyButtons, participation)])\n\t}\n\n\tprivate renderAttendee(attendee: CalendarEventAttendee, participation: EventPreviewViewAttrs[\"participation\"]): Children {\n\t\tconst attendeeField = hasError(attendee.address) ? lang.get(\"corruptedValue_msg\") : attendee.address.address\n\t\t/** we might have a more current local attendance for ourselves. */\n\t\tconst status =\n\t\t\tparticipation != null && cleanMailAddress(attendee.address.address) === participation.ownAttendee.address.address\n\t\t\t\t? getAttendeeStatus(participation.ownAttendee)\n\t\t\t\t: getAttendeeStatus(attendee)\n\n\t\treturn m(\".flex.items-center\", [\n\t\t\tm(Icon, {\n\t\t\t\ticon: iconForAttendeeStatus[status],\n\t\t\t\tstyle: {\n\t\t\t\t\tfill: theme.content_fg,\n\t\t\t\t},\n\t\t\t\tclass: \"mr-s\",\n\t\t\t}),\n\t\t\tm(\".span.line-break-anywhere.selectable\", attendeeField),\n\t\t])\n\t}\n\n\tprivate renderDescription(sanitizedDescription: string | null) {\n\t\tif (sanitizedDescription == null || sanitizedDescription.length === 0) return null\n\t\treturn this.renderRow(Icons.AlignLeft, [m.trust(sanitizedDescription)], true)\n\t}\n}\n\n/**\n * if text is a valid absolute url, then returns a URL with text as the href\n * otherwise passes text as the search parameter for open street map\n * @param text\n * @returns {*}\n */\nexport function getLocationUrl(text: string): URL {\n\tconst osmHref = `https://www.openstreetmap.org/search?query=${text}`\n\tlet url\n\n\ttry {\n\t\t// if not a valid _absolute_ url then we get an exception\n\t\turl = new URL(text)\n\t} catch {\n\t\turl = new URL(osmHref)\n\t}\n\n\treturn url\n}\n\nexport function formatRepetitionFrequency(repeatRule: RepeatRule): string | null {\n\tif (repeatRule.interval === \"1\") {\n\t\tconst frequency = createRepeatRuleFrequencyValues().find((frequency) => frequency.value === repeatRule.frequency)\n\n\t\tif (frequency) {\n\t\t\treturn frequency.name\n\t\t}\n\t} else {\n\t\treturn lang.get(\"repetition_msg\", {\n\t\t\t\"{interval}\": repeatRule.interval,\n\t\t\t\"{timeUnit}\": getFrequencyTimeUnit(downcast(repeatRule.frequency)),\n\t\t})\n\t}\n\n\treturn null\n}\n\n/**\n * @returns {string} The returned string includes a leading separator (\", \" or \" \").\n */\nexport function formatRepetitionEnd(repeatRule: RepeatRule, isAllDay: boolean): string {\n\tswitch (repeatRule.endType) {\n\t\tcase EndType.Count:\n\t\t\tif (!repeatRule.endValue) {\n\t\t\t\treturn \"\"\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t\", \" +\n\t\t\t\tlang.get(\"times_msg\", {\n\t\t\t\t\t\"{amount}\": repeatRule.endValue,\n\t\t\t\t})\n\t\t\t)\n\n\t\tcase EndType.UntilDate: {\n\t\t\tconst repeatEndTime = getRepeatEndTimeForDisplay(repeatRule, isAllDay, getTimeZone())\n\t\t\treturn \" \" + lang.get(\"until_label\") + \" \" + formatDateWithMonth(repeatEndTime)\n\t\t}\n\n\t\tdefault:\n\t\t\treturn \"\"\n\t}\n}\n\nfunction getFrequencyTimeUnit(frequency: RepeatPeriod): string {\n\tswitch (frequency) {\n\t\tcase RepeatPeriod.DAILY:\n\t\t\treturn lang.get(\"days_label\")\n\n\t\tcase RepeatPeriod.WEEKLY:\n\t\t\treturn lang.get(\"weeks_label\")\n\n\t\tcase RepeatPeriod.MONTHLY:\n\t\t\treturn lang.get(\"pricing.months_label\")\n\n\t\tcase RepeatPeriod.ANNUALLY:\n\t\t\treturn lang.get(\"years_label\")\n\n\t\tdefault:\n\t\t\tthrow new Error(\"Unknown calendar event repeat rule frequency: \" + frequency)\n\t}\n}\n\nfunction prepareAttendees(attendees: Array<CalendarEventAttendee>, organizer: EncryptedMailAddress | null): Array<CalendarEventAttendee> {\n\t// We copy the attendees array so that we can add the organizer, in the case that they are not already in attendees\n\t// This is just for display purposes. We need to copy because event.attendees is the source of truth for the event\n\t// so we can't modify it\n\tconst attendeesCopy = attendees.slice()\n\n\tif (organizer != null && attendeesCopy.length > 0 && !findAttendeeInAddresses(attendeesCopy, [organizer.address])) {\n\t\tattendeesCopy.unshift(\n\t\t\tcreateCalendarEventAttendee({\n\t\t\t\taddress: createEncryptedMailAddress({\n\t\t\t\t\taddress: organizer.address,\n\t\t\t\t\tname: \"\",\n\t\t\t\t}),\n\t\t\t\tstatus: CalendarAttendeeStatus.ADDED, // We don't know whether the organizer will be attending or not in this case\n\t\t\t}),\n\t\t)\n\t}\n\n\treturn attendeesCopy\n}\n"]}