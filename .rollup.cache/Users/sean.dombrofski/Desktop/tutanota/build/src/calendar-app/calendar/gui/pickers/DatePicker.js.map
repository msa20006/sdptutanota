{"version":3,"file":"DatePicker.js","sourceRoot":"","sources":["../../../../../../src/calendar-app/calendar/gui/pickers/DatePicker.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { client } from \"../../../../common/misc/ClientDetector.js\"\nimport { formatDate, formatDateWithWeekdayAndYear, formatMonthWithFullYear } from \"../../../../common/misc/Formatter.js\"\nimport type { TranslationKey, MaybeTranslation } from \"../../../../common/misc/LanguageViewModel.js\"\nimport { lang } from \"../../../../common/misc/LanguageViewModel.js\"\nimport { px } from \"../../../../common/gui/size.js\"\nimport { theme } from \"../../../../common/gui/theme.js\"\n\nimport { getStartOfDay, isSameDayOfDate, memoized } from \"@tutao/tutanota-utils\"\nimport { DateTime } from \"luxon\"\nimport { getAllDayDateLocal } from \"../../../../common/api/common/utils/CommonCalendarUtils.js\"\nimport { TextField, TextFieldType } from \"../../../../common/gui/base/TextField.js\"\nimport type { CalendarDay } from \"../../../../common/calendar/date/CalendarUtils.js\"\nimport { parseDate } from \"../../../../common/misc/DateParser.js\"\nimport renderSwitchMonthArrowIcon from \"../../../../common/gui/base/buttons/ArrowButton.js\"\nimport { getCalendarMonth } from \"../CalendarGuiUtils.js\"\nimport { isKeyPressed, keyboardEventToKeyPress, keyHandler, KeyPress, useKeyHandler } from \"../../../../common/misc/KeyManager.js\"\nimport { Keys, TabIndex } from \"../../../../common/api/common/TutanotaConstants.js\"\nimport { AriaPopupType } from \"../../../../common/gui/AriaUtils.js\"\nimport { isApp } from \"../../../../common/api/common/Env.js\"\nimport { InputButton, InputButtonAttributes, InputButtonVariant } from \"../../../../common/gui/base/InputButton.js\"\n\nexport enum PickerPosition {\n\tTOP,\n\tBOTTOM,\n}\n\nexport interface DatePickerAttrs {\n\tdate?: Date\n\tonDateSelected: (date: Date) => unknown\n\tstartOfTheWeekOffset: number\n\tlabel: TranslationKey\n\tnullSelectionText?: MaybeTranslation\n\tdisabled?: boolean\n\trightAlignDropdown?: boolean\n\tuseInputButton?: boolean\n\tposition?: PickerPosition\n\tclasses?: Array<string>\n}\n\n/**\n * Date picker component. Looks like a text field until interacted. On mobile it will be native browser picker, on desktop a {@class VisualDatePicker}.\n *\n * The HTML input[type=date] is not usable on desktops because:\n * * it always displays a placeholder (mm/dd/yyyy) and several buttons and\n * * the picker can't be opened programmatically and\n * * the date format is based on the operating systems locale and not on the one set in the browser (and used by us)\n *\n * That is why we only use the picker on mobile devices. They provide native picker components\n * and allow opening the picker by forwarding the click event to the input.\n */\nexport class DatePicker implements Component<DatePickerAttrs> {\n\tprivate inputText: string = \"\"\n\tprivate showingDropdown: boolean = false\n\tprivate domInput: HTMLElement | null = null\n\tprivate documentInteractionListener: ((e: MouseEvent) => unknown) | null = null\n\tprivate textFieldHasFocus: boolean = false\n\tprivate previousPassedDownDate?: Date\n\n\tconstructor({ attrs }: Vnode<DatePickerAttrs>) {\n\t\tthis.inputText = attrs.date ? formatDate(attrs.date) : \"\"\n\t\tthis.previousPassedDownDate = attrs.date\n\t}\n\n\tview({ attrs }: Vnode<DatePickerAttrs>): Children {\n\t\tconst date = attrs.date\n\n\t\t// If the user is interacting with the textfield, then we want the textfield to accept their input, so never override the text\n\t\t// Otherwise, we want to it to reflect whatever date has been passed in, because it may have been changed programmatically\n\t\t// The same day check is because sometimes focus is lost when trying to update the date. handleInput\n\t\t//  or handleSelectedDate should be called first, but it is not and the date trying to be selected is\n\t\t//  lost. So checking if the date was actually passed in \"from above\" is a band-aid solution for now.\n\t\tif (!this.textFieldHasFocus && !isSameDayOfDate(date, this.previousPassedDownDate)) {\n\t\t\tthis.inputText = date ? formatDate(date) : \"\"\n\t\t\tthis.previousPassedDownDate = date\n\t\t}\n\n\t\treturn m(\".rel\", { class: attrs.classes?.join(\" \") }, [\n\t\t\t!attrs.useInputButton ? this.renderTextField(attrs) : this.renderInputButtonPicker(attrs),\n\t\t\tthis.showingDropdown ? this.renderDropdown(attrs) : null,\n\t\t\t// For mobile devices we render a native date picker, it's easier to use and more accessible.\n\t\t\t// We render invisible input which opens native picker on interaction.\n\t\t\tclient.isMobileDevice() && !attrs.useInputButton ? this.renderMobileDateInput(attrs) : null,\n\t\t])\n\t}\n\n\tprivate renderInputButtonPicker({ disabled, date, onDateSelected, label }: DatePickerAttrs): Children {\n\t\treturn m.fragment({}, [\n\t\t\tisApp()\n\t\t\t\t? m(\"input.fill-absolute.invisible.tutaui-button-outline\", {\n\t\t\t\t\t\tdisabled,\n\t\t\t\t\t\ttype: TextFieldType.Date,\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tzIndex: 1,\n\t\t\t\t\t\t\tborder: `2px solid ${theme.content_message_bg}`,\n\t\t\t\t\t\t\twidth: \"auto\",\n\t\t\t\t\t\t\theight: \"auto\",\n\t\t\t\t\t\t\tpadding: 0,\n\t\t\t\t\t\t\tappearance: \"none\",\n\t\t\t\t\t\t\topacity: disabled ? 0.7 : 1.0,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tvalue: date != null ? DateTime.fromJSDate(date).toISODate() : \"\",\n\t\t\t\t\t\toninput: (event: InputEvent) => {\n\t\t\t\t\t\t\tthis.handleNativeInput(event, onDateSelected)\n\t\t\t\t\t\t},\n\t\t\t\t  })\n\t\t\t\t: null,\n\t\t\tm(InputButton, {\n\t\t\t\ttabIndex: Number(isApp() ? TabIndex.Programmatic : TabIndex.Default),\n\t\t\t\tariaLabel: lang.getTranslationText(label),\n\t\t\t\tinputValue: this.inputText,\n\t\t\t\toninput: (newValue: string) => (this.inputText = newValue),\n\t\t\t\tdisplay: formatDateWithWeekdayAndYear(date ?? new Date()),\n\t\t\t\tvariant: InputButtonVariant.OUTLINE,\n\t\t\t\tdisabled,\n\t\t\t\ttype: TextFieldType.Text,\n\t\t\t\tonclick: () => {\n\t\t\t\t\tif (!disabled) {\n\t\t\t\t\t\tthis.showingDropdown = true\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonfocus: (_, input) => {\n\t\t\t\t\tif (!disabled) {\n\t\t\t\t\t\tthis.showingDropdown = true\n\t\t\t\t\t}\n\t\t\t\t\tthis.textFieldHasFocus = true\n\t\t\t\t},\n\t\t\t\toncreate: (input: any) => {\n\t\t\t\t\tif (this.domInput == null) {\n\t\t\t\t\t\tthis.domInput = input.dom as HTMLInputElement\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonblur: () => {\n\t\t\t\t\tthis.textFieldHasFocus = false\n\t\t\t\t},\n\t\t\t\tonkeydown: (event: KeyboardEvent) => {\n\t\t\t\t\tconst key = keyboardEventToKeyPress(event)\n\t\t\t\t\treturn this.handleInputKeyEvents(key, disabled, onDateSelected)\n\t\t\t\t},\n\t\t\t\tcontainerStyle: isApp()\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tzIndex: \"2\",\n\t\t\t\t\t\t\tposition: \"inherit\",\n\t\t\t\t\t\t\tborderColor: \"transparent\",\n\t\t\t\t\t\t\tpointerEvents: \"none\",\n\t\t\t\t\t  }\n\t\t\t\t\t: {},\n\t\t\t} satisfies InputButtonAttributes),\n\t\t])\n\t}\n\n\tprivate renderTextField({ date, onDateSelected, label, nullSelectionText, disabled }: DatePickerAttrs): Children {\n\t\treturn m(\n\t\t\t\"\",\n\t\t\t{\n\t\t\t\tonclick: () => {\n\t\t\t\t\tif (!disabled) {\n\t\t\t\t\t\tthis.showingDropdown = true\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tm(TextField, {\n\t\t\t\tvalue: this.inputText,\n\t\t\t\tlabel,\n\t\t\t\thelpLabel: () => this.renderHelpLabel(date, nullSelectionText ?? null),\n\t\t\t\tdisabled,\n\t\t\t\thasPopup: AriaPopupType.Dialog,\n\t\t\t\toninput: (text) => {\n\t\t\t\t\t// we want to hold on to the text for when we actually want to process it\n\t\t\t\t\tthis.inputText = text\n\t\t\t\t},\n\t\t\t\tonfocus: (_, input) => {\n\t\t\t\t\tif (!disabled) {\n\t\t\t\t\t\tthis.showingDropdown = true\n\t\t\t\t\t}\n\t\t\t\t\tthis.textFieldHasFocus = true\n\t\t\t\t},\n\t\t\t\tonDomInputCreated: (input) => {\n\t\t\t\t\tif (this.domInput == null) {\n\t\t\t\t\t\tthis.domInput = input\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonblur: () => {\n\t\t\t\t\tthis.textFieldHasFocus = false\n\t\t\t\t},\n\t\t\t\tkeyHandler: (key) => {\n\t\t\t\t\treturn this.handleInputKeyEvents(key, disabled, onDateSelected)\n\t\t\t\t},\n\t\t\t}),\n\t\t)\n\t}\n\n\tprivate handleEscapePress(key: KeyPress): boolean {\n\t\tif (isKeyPressed(key.key, Keys.ESC) && this.showingDropdown) {\n\t\t\tthis.domInput?.focus()\n\t\t\tthis.showingDropdown = false\n\t\t\treturn false\n\t\t}\n\t\treturn true\n\t}\n\n\tprivate renderHelpLabel(date: Date | null | undefined, nullSelectionText: MaybeTranslation | null): Children {\n\t\tif (this.showingDropdown) {\n\t\t\treturn null\n\t\t} else if (date != null) {\n\t\t\treturn [m(\"\", formatDateWithWeekdayAndYear(date)), nullSelectionText ? m(\"\", lang.getTranslationText(nullSelectionText)) : null]\n\t\t} else {\n\t\t\treturn lang.getTranslationText(nullSelectionText ?? \"emptyString_msg\")\n\t\t}\n\t}\n\n\tprivate renderDropdown({ date, onDateSelected, startOfTheWeekOffset, rightAlignDropdown, label, position }: DatePickerAttrs): Children {\n\t\t// We would like to show the date being typed in the dropdown\n\t\tconst dropdownDate = this.parseDate(this.inputText) ?? date ?? new Date()\n\t\treturn m(\n\t\t\t\".content-bg.z3.menu-shadow.plr.pb-s\",\n\t\t\t{\n\t\t\t\t\"aria-modal\": \"true\",\n\t\t\t\t\"aria-label\": lang.get(label),\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: \"240px\",\n\t\t\t\t\tright: rightAlignDropdown ? \"0\" : null,\n\t\t\t\t},\n\t\t\t\tclass: position === PickerPosition.TOP ? \"abs\" : \"fixed\",\n\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\tconst listener = (e: MouseEvent) => {\n\t\t\t\t\t\tif (!vnode.dom.contains(e.target as HTMLElement) && !this.domInput?.contains(e.target as HTMLElement)) {\n\t\t\t\t\t\t\t// We are subscribed to two events so this listener *will* be invoked twice, but we only need to do the work once.\n\t\t\t\t\t\t\tif (this.showingDropdown) {\n\t\t\t\t\t\t\t\tthis.showingDropdown = false\n\t\t\t\t\t\t\t\tthis.handleInput(this.inputText, onDateSelected)\n\t\t\t\t\t\t\t\tm.redraw()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (position === PickerPosition.TOP && vnode.dom.parentElement) {\n\t\t\t\t\t\tconst bottomMargin = vnode.dom.parentElement.getBoundingClientRect().height\n\t\t\t\t\t\t;(vnode.dom as HTMLElement).style.bottom = px(bottomMargin)\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.documentInteractionListener = listener\n\t\t\t\t\tdocument.addEventListener(\"click\", listener, true)\n\t\t\t\t\tdocument.addEventListener(\"focus\", listener, true)\n\t\t\t\t},\n\t\t\t\tonremove: () => {\n\t\t\t\t\tif (this.documentInteractionListener) {\n\t\t\t\t\t\tdocument.removeEventListener(\"click\", this.documentInteractionListener, true)\n\t\t\t\t\t\tdocument.removeEventListener(\"focus\", this.documentInteractionListener, true)\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tm(VisualDatePicker, {\n\t\t\t\tselectedDate: dropdownDate,\n\t\t\t\tonDateSelected: (newDate, dayClick) => {\n\t\t\t\t\t// We differentiate between different selections as we sometimes* want to keep the dropdown open but still want to select the date\n\t\t\t\t\t// * with keyboard-based navigation space selects the date but keeps it open while return key will work like click\n\t\t\t\t\tthis.handleSelectedDate(newDate, onDateSelected)\n\t\t\t\t\tif (dayClick) {\n\t\t\t\t\t\t// We want to retain the focus on the input for accessibility, but we still want to close the dropdown.\n\t\t\t\t\t\tif (this.domInput) {\n\t\t\t\t\t\t\t// Focus the dom input but then override the showingDropdown right after focus.\n\t\t\t\t\t\t\t// It should be invoked after the normal listener since the listeners are appended to the end.\n\n\t\t\t\t\t\t\t// One would think that \"focus\" listeners would be called on the next event loop after we call focus() but alas.\n\t\t\t\t\t\t\t// So make sure to add the listener first.\n\t\t\t\t\t\t\tthis.domInput.addEventListener(\n\t\t\t\t\t\t\t\t\"focus\",\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tthis.showingDropdown = false\n\t\t\t\t\t\t\t\t\tm.redraw()\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{ once: true },\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\tthis.domInput.focus()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tkeyHandler: (key: KeyPress) => this.handleEscapePress(key),\n\t\t\t\twide: false,\n\t\t\t\tstartOfTheWeekOffset: startOfTheWeekOffset,\n\t\t\t}),\n\t\t)\n\t}\n\n\tprivate renderMobileDateInput({ date, onDateSelected, disabled }: DatePickerAttrs): Children {\n\t\treturn m(\"input.fill-absolute\", {\n\t\t\tdisabled: disabled,\n\t\t\ttype: \"date\",\n\t\t\tstyle: {\n\t\t\t\topacity: 0,\n\t\t\t\t// This overrides platform-specific width setting, we want to cover the whole field\n\t\t\t\tminWidth: \"100%\",\n\t\t\t\tminHeight: \"100%\",\n\t\t\t},\n\t\t\t// Format as ISO date format (YYYY-MM-dd). We use luxon for that because JS Date only supports full format with time.\n\t\t\tvalue: date != null ? DateTime.fromJSDate(date).toISODate() : \"\",\n\t\t\toninput: (event: InputEvent) => {\n\t\t\t\tthis.handleNativeInput(event, onDateSelected)\n\t\t\t},\n\t\t})\n\t}\n\n\tprivate handleInput(text: string, onDateSelected: DatePickerAttrs[\"onDateSelected\"]) {\n\t\tthis.inputText = text\n\t\tconst parsedDate = this.parseDate(text)\n\t\tif (parsedDate) {\n\t\t\tonDateSelected(parsedDate)\n\t\t}\n\t}\n\n\tprivate handleSelectedDate(date: Date, onDateSelected: DatePickerAttrs[\"onDateSelected\"]) {\n\t\tthis.inputText = formatDate(date)\n\t\tonDateSelected(date)\n\t}\n\n\tprivate parseDate = memoized((text: string): Date | null => {\n\t\tconst trimmedValue = text.trim()\n\n\t\tif (trimmedValue !== \"\") {\n\t\t\ttry {\n\t\t\t\treturn parseDate(trimmedValue, (referenceDate) => formatDate(referenceDate))\n\t\t\t} catch (e) {\n\t\t\t\t// Parsing failed so the user is probably typing\n\t\t\t}\n\t\t}\n\t\treturn null\n\t})\n\n\tprivate handleInputKeyEvents(key: KeyPress, disabled: boolean | undefined, onDateSelected: (date: Date) => unknown) {\n\t\tif (isKeyPressed(key.key, Keys.DOWN)) {\n\t\t\tif (!disabled && !key.shift && !key.ctrl && !key.meta) {\n\t\t\t\tthis.showingDropdown = true\n\t\t\t}\n\t\t} else if (isKeyPressed(key.key, Keys.RETURN)) {\n\t\t\tthis.handleInput(this.inputText, onDateSelected)\n\t\t}\n\t\treturn this.handleEscapePress(key)\n\t}\n\n\tprivate handleNativeInput(event: InputEvent, onDateSelected: (date: Date) => unknown) {\n\t\t// valueAsDate is always 00:00 UTC\n\t\t// https://www.w3.org/TR/html52/sec-forms.html#date-state-typedate\n\t\tconst htmlDate = (event.target as HTMLInputElement).valueAsDate\n\t\t// It can be null if user clicks \"clear\". Ignore it.\n\t\tif (htmlDate != null) {\n\t\t\tthis.handleSelectedDate(getAllDayDateLocal(htmlDate), onDateSelected)\n\t\t}\n\t}\n}\n\ntype VisualDatePickerAttrs = {\n\tselectedDate: Date | null\n\tonDateSelected?: (date: Date, dayClick: boolean) => unknown\n\tkeyHandler?: keyHandler\n\twide: boolean\n\tstartOfTheWeekOffset: number\n}\n\n/** Date picker used on desktop. Displays a month and ability to select a month. */\nexport class VisualDatePicker implements Component<VisualDatePickerAttrs> {\n\tprivate displayingDate: Date\n\tprivate lastSelectedDate: Date | null = null\n\n\tconstructor(vnode: Vnode<VisualDatePickerAttrs>) {\n\t\tthis.displayingDate = vnode.attrs.selectedDate || getStartOfDay(new Date())\n\t}\n\n\tview(vnode: Vnode<VisualDatePickerAttrs>): Children {\n\t\tconst selectedDate = vnode.attrs.selectedDate\n\t\tif (selectedDate && !isSameDayOfDate(this.lastSelectedDate, selectedDate)) {\n\t\t\tthis.lastSelectedDate = selectedDate\n\t\t\tthis.displayingDate = new Date(selectedDate)\n\n\t\t\tthis.displayingDate.setDate(1)\n\t\t}\n\n\t\tlet date = new Date(this.displayingDate)\n\t\tlet { weeks, weekdays } = getCalendarMonth(this.displayingDate, vnode.attrs.startOfTheWeekOffset, true)\n\t\treturn m(\n\t\t\t\".flex.flex-column\",\n\t\t\t{\n\t\t\t\tonkeydown: (event: KeyboardEvent) => useKeyHandler(event, vnode.attrs.keyHandler),\n\t\t\t},\n\t\t\t[\n\t\t\t\tthis.renderPickerHeader(vnode, date),\n\t\t\t\tm(\".flex.flex-space-between\", this.renderWeekDays(vnode.attrs.wide, weekdays)),\n\t\t\t\tm(\n\t\t\t\t\t\".flex.flex-column.flex-space-around\",\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tfontSize: px(14),\n\t\t\t\t\t\t\tlineHeight: px(this.getElementWidth(vnode.attrs)),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tweeks.map((w) => this.renderWeek(w, vnode.attrs)),\n\t\t\t\t),\n\t\t\t],\n\t\t)\n\t}\n\n\tprivate renderPickerHeader(vnode: Vnode<VisualDatePickerAttrs>, date: Date): Children {\n\t\tconst size = this.getElementWidth(vnode.attrs)\n\t\treturn m(\".flex.flex-space-between.pt-s.pb-s.items-center\", [\n\t\t\trenderSwitchMonthArrowIcon(false, size, () => this.onPrevMonthSelected()),\n\t\t\tm(\n\t\t\t\t\".b\",\n\t\t\t\t{\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tfontSize: px(14),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tformatMonthWithFullYear(date),\n\t\t\t),\n\t\t\trenderSwitchMonthArrowIcon(true, size, () => this.onNextMonthSelected()),\n\t\t])\n\t}\n\n\tprivate onPrevMonthSelected() {\n\t\tthis.displayingDate.setMonth(this.displayingDate.getMonth() - 1)\n\t}\n\n\tprivate onNextMonthSelected() {\n\t\tthis.displayingDate.setMonth(this.displayingDate.getMonth() + 1)\n\t}\n\n\tprivate renderDay({ date, day, isPaddingDay }: CalendarDay, index: number, attrs: VisualDatePickerAttrs): Children {\n\t\tconst isSelectedDay = isSameDayOfDate(date, attrs.selectedDate)\n\t\t// We need a day to tab onto if the selected day is not visible, so we use the first day of the month\n\t\tconst isSubstituteDay = attrs.selectedDate?.getMonth() !== date.getMonth() && date.getDate() === 1\n\t\tconst isTabbable = !isPaddingDay && (isSelectedDay || isSubstituteDay)\n\n\t\tconst size = this.getElementWidth(attrs)\n\t\tconst selector = isSelectedDay && !isPaddingDay ? \".circle.accent-bg\" : \"\"\n\t\treturn m(\n\t\t\t\".rel.flex.items-center.justify-center\",\n\t\t\t{\n\t\t\t\tstyle: {\n\t\t\t\t\theight: px(size),\n\t\t\t\t\twidth: px(size),\n\t\t\t\t},\n\t\t\t\tclass: isPaddingDay ? undefined : \"click\",\n\t\t\t\t\"aria-hidden\": `${isPaddingDay}`,\n\t\t\t\t\"aria-label\": date.toLocaleDateString(),\n\t\t\t\t\"aria-selected\": `${isSelectedDay}`,\n\t\t\t\trole: \"option\",\n\t\t\t\ttabindex: isTabbable ? TabIndex.Default : TabIndex.Programmatic,\n\t\t\t\tonclick: isPaddingDay ? undefined : () => attrs.onDateSelected?.(date, true),\n\t\t\t\tonkeydown: (event: KeyboardEvent) => {\n\t\t\t\t\tconst key = keyboardEventToKeyPress(event)\n\t\t\t\t\tconst target = event.target as HTMLInputElement\n\n\t\t\t\t\tif (isKeyPressed(key.key, Keys.LEFT)) {\n\t\t\t\t\t\tlet targetDay\n\n\t\t\t\t\t\tif (target.previousElementSibling == null) {\n\t\t\t\t\t\t\t// If the user presses left on the first day of the week, go to the last day of the previous week\n\t\t\t\t\t\t\ttargetDay = target.parentElement?.previousElementSibling?.children.item(6)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttargetDay = target.previousElementSibling\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!this.focusDayIfPossible(target, targetDay)) {\n\t\t\t\t\t\t\tthis.onPrevMonthSelected()\n\t\t\t\t\t\t\tm.redraw.sync()\n\t\t\t\t\t\t\tthis.focusLastDay(target)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tevent.preventDefault()\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isKeyPressed(key.key, Keys.RIGHT)) {\n\t\t\t\t\t\tlet targetDay\n\n\t\t\t\t\t\tif (target.nextElementSibling == null) {\n\t\t\t\t\t\t\ttargetDay = target.parentElement?.nextElementSibling?.children.item(0)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttargetDay = target.nextElementSibling\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!this.focusDayIfPossible(target, targetDay)) {\n\t\t\t\t\t\t\tthis.onNextMonthSelected()\n\t\t\t\t\t\t\tm.redraw.sync()\n\t\t\t\t\t\t\tthis.focusFirstDay(target)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tevent.preventDefault()\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isKeyPressed(key.key, Keys.UP)) {\n\t\t\t\t\t\tconst dayAbove = target.parentElement?.previousElementSibling?.children.item(index)\n\t\t\t\t\t\tif (!this.focusDayIfPossible(target, dayAbove)) {\n\t\t\t\t\t\t\t// If the user presses up on the first week, go to the same day of the previous week\n\t\t\t\t\t\t\tthis.onPrevMonthSelected()\n\t\t\t\t\t\t\tm.redraw.sync()\n\t\t\t\t\t\t\tthis.focusLastWeekDay(target, index)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tevent.preventDefault()\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isKeyPressed(key.key, Keys.DOWN)) {\n\t\t\t\t\t\tconst dayBelow = target.parentElement?.nextElementSibling?.children.item(index)\n\t\t\t\t\t\tif (!this.focusDayIfPossible(target, dayBelow)) {\n\t\t\t\t\t\t\tthis.onNextMonthSelected()\n\t\t\t\t\t\t\tm.redraw.sync()\n\t\t\t\t\t\t\tthis.focusFirstWeekDay(target, index)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tevent.preventDefault()\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isKeyPressed(key.key, Keys.HOME) && !isPaddingDay) {\n\t\t\t\t\t\tthis.focusFirstDay(target)\n\t\t\t\t\t\tevent.preventDefault()\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isKeyPressed(key.key, Keys.END) && !isPaddingDay) {\n\t\t\t\t\t\tthis.focusLastDay(target)\n\t\t\t\t\t\tevent.preventDefault()\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isKeyPressed(key.key, Keys.PAGE_UP) && !isPaddingDay) {\n\t\t\t\t\t\tif (key.shift) {\n\t\t\t\t\t\t\tthis.displayingDate.setFullYear(this.displayingDate.getFullYear() - 1)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.onPrevMonthSelected()\n\t\t\t\t\t\t}\n\t\t\t\t\t\tm.redraw.sync()\n\t\t\t\t\t\tthis.focusFirstDay(target)\n\t\t\t\t\t\tevent.preventDefault()\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isKeyPressed(key.key, Keys.PAGE_DOWN) && !isPaddingDay) {\n\t\t\t\t\t\tif (key.shift) {\n\t\t\t\t\t\t\tthis.displayingDate.setFullYear(this.displayingDate.getFullYear() + 1)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.onNextMonthSelected()\n\t\t\t\t\t\t}\n\t\t\t\t\t\tm.redraw.sync()\n\t\t\t\t\t\tthis.focusFirstDay(target)\n\t\t\t\t\t\tevent.preventDefault()\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isKeyPressed(key.key, Keys.RETURN) && !isPaddingDay) {\n\t\t\t\t\t\tattrs.onDateSelected?.(date, true)\n\t\t\t\t\t\tevent.preventDefault()\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isKeyPressed(key.key, Keys.SPACE) && !isPaddingDay) {\n\t\t\t\t\t\tattrs.onDateSelected?.(date, false)\n\t\t\t\t\t\tevent.preventDefault()\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\t[\n\t\t\t\tm(\".abs.z1\" + selector, {\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\twidth: px(size),\n\t\t\t\t\t\theight: px(size),\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tm(selector + \".full-width.height-100p.center.z2\", { style: { \"background-color\": \"transparent\" } }, isPaddingDay ? null : day),\n\t\t\t],\n\t\t)\n\t}\n\n\t// Focuses on a day if it is not a padding day & returns whether it focused on the day\n\tprivate focusDayIfPossible(previousElement: HTMLElement, dayElement: globalThis.Element | null | undefined): boolean {\n\t\tconst element = dayElement as HTMLInputElement | null | undefined\n\t\tif (element != null && element.ariaHidden === \"false\") {\n\t\t\telement.focus()\n\t\t\t// Put the currently focused element into the tab index so the next tab press follows the tab index\n\t\t\telement.tabIndex = 0\n\t\t\tpreviousElement.tabIndex = -1\n\t\t\treturn true\n\t\t}\n\t\treturn false\n\t}\n\n\t// Focus the last day of the month in the calendar\n\tprivate focusLastDay(target: HTMLInputElement) {\n\t\tconst weeks = target.parentElement?.parentElement?.children\n\t\tif (weeks != null) {\n\t\t\tfor (let i = weeks.length - 1; i >= 0; i--) {\n\t\t\t\tconst week = weeks.item(i)?.children\n\t\t\t\tlet isDateFound = false\n\t\t\t\tif (week != null) {\n\t\t\t\t\tfor (let j = week.length - 1; j >= 0; j--) {\n\t\t\t\t\t\tconst child = week.item(j)\n\t\t\t\t\t\tif (this.focusDayIfPossible(target, child)) {\n\t\t\t\t\t\t\tisDateFound = true\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (isDateFound) break\n\t\t\t}\n\t\t}\n\t}\n\n\t// Focus a day in the final week of the calendar\n\tprivate focusLastWeekDay(target: HTMLInputElement, weekDay: number) {\n\t\tconst weeks = target.parentElement?.parentElement?.children\n\t\tif (weeks != null) {\n\t\t\tfor (let i = weeks.length - 1; i >= 0; i--) {\n\t\t\t\tconst week = weeks.item(i)?.children\n\t\t\t\tif (week != null) {\n\t\t\t\t\tconst child = week.item(weekDay)\n\t\t\t\t\tif (this.focusDayIfPossible(target, child)) {\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Focus the first day of the month in the calendar\n\tprivate focusFirstDay(target: HTMLInputElement) {\n\t\tconst weeks = target.parentElement?.parentElement?.children\n\t\tif (weeks != null) {\n\t\t\tfor (let i = 0; i < weeks.length; i++) {\n\t\t\t\tconst week = weeks.item(i)?.children\n\t\t\t\tlet isDateFound = false\n\t\t\t\tif (week != null) {\n\t\t\t\t\tfor (let j = 0; j < week.length; j++) {\n\t\t\t\t\t\tconst child = week.item(j)\n\t\t\t\t\t\tif (this.focusDayIfPossible(target, child)) {\n\t\t\t\t\t\t\tisDateFound = true\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (isDateFound) break\n\t\t\t}\n\t\t}\n\t}\n\n\t// Focus a day in the first week of the calendar\n\tprivate focusFirstWeekDay(target: HTMLInputElement, weekDay: number) {\n\t\tconst weeks = target.parentElement?.parentElement?.children\n\t\tif (weeks != null) {\n\t\t\tfor (let i = 0; i < weeks.length; i++) {\n\t\t\t\tconst week = weeks.item(i)?.children\n\t\t\t\tif (week != null) {\n\t\t\t\t\tconst child = week.item(weekDay)\n\t\t\t\t\tif (this.focusDayIfPossible(target, child)) {\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate getElementWidth(attrs: VisualDatePickerAttrs): number {\n\t\treturn attrs.wide ? 40 : 24\n\t}\n\n\tprivate renderWeek(week: ReadonlyArray<CalendarDay>, attrs: VisualDatePickerAttrs): Children {\n\t\treturn m(\n\t\t\t\".flex.flex-space-between\",\n\t\t\tweek.map((d, i) => this.renderDay(d, i, attrs)),\n\t\t)\n\t}\n\n\tprivate renderWeekDays(wide: boolean, weekdays: readonly string[]): Children {\n\t\tconst size = px(wide ? 40 : 24)\n\t\tconst fontSize = px(14)\n\t\treturn weekdays.map((wd) =>\n\t\t\tm(\n\t\t\t\t\".center\",\n\t\t\t\t{\n\t\t\t\t\t\"aria-hidden\": \"true\",\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tfontSize,\n\t\t\t\t\t\theight: size,\n\t\t\t\t\t\twidth: size,\n\t\t\t\t\t\tlineHeight: size,\n\t\t\t\t\t\tcolor: theme.navigation_menu_icon,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\twd,\n\t\t\t),\n\t\t)\n\t}\n}\n"]}