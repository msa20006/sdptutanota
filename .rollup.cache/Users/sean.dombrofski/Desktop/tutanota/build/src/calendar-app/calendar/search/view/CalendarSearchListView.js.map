{"version":3,"file":"CalendarSearchListView.js","sourceRoot":"","sources":["../../../../../../src/calendar-app/calendar/search/view/CalendarSearchListView.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { assertMainOrNode } from \"../../../../common/api/common/Env\"\nimport { downcast } from \"@tutao/tutanota-utils\"\nimport { List, ListAttrs, MultiselectMode, RenderConfig } from \"../../../../common/gui/base/List.js\"\nimport { size } from \"../../../../common/gui/size.js\"\nimport { CalendarEvent } from \"../../../../common/api/entities/tutanota/TypeRefs.js\"\nimport ColumnEmptyMessageBox from \"../../../../common/gui/base/ColumnEmptyMessageBox.js\"\nimport { BootIcons } from \"../../../../common/gui/base/icons/BootIcons.js\"\nimport { lang } from \"../../../../common/misc/LanguageViewModel.js\"\nimport { theme } from \"../../../../common/gui/theme.js\"\nimport { VirtualRow } from \"../../../../common/gui/base/ListUtils.js\"\nimport { styles } from \"../../../../common/gui/styles.js\"\nimport { KindaCalendarRow } from \"../../gui/CalendarRow.js\"\nimport { ListElementListModel } from \"../../../../common/misc/ListElementListModel\"\n\nassertMainOrNode()\n\nexport class CalendarSearchResultListEntry {\n\tconstructor(readonly entry: CalendarEvent) {}\n\n\tget _id(): IdTuple {\n\t\treturn this.entry._id\n\t}\n}\n\nexport interface CalendarSearchListViewAttrs {\n\tlistModel: ListElementListModel<CalendarSearchResultListEntry>\n\tonSingleSelection: (item: CalendarSearchResultListEntry) => unknown\n\tisFreeAccount: boolean\n\tcancelCallback: () => unknown | null\n}\n\nexport class CalendarSearchListView implements Component<CalendarSearchListViewAttrs> {\n\tprivate listModel: ListElementListModel<CalendarSearchResultListEntry>\n\n\tconstructor({ attrs }: Vnode<CalendarSearchListViewAttrs>) {\n\t\tthis.listModel = attrs.listModel\n\t}\n\n\tview({ attrs }: Vnode<CalendarSearchListViewAttrs>): Children {\n\t\tthis.listModel = attrs.listModel\n\t\tconst icon = BootIcons.Calendar\n\t\tconst renderConfig = this.calendarRenderConfig\n\n\t\treturn attrs.listModel.isEmptyAndDone()\n\t\t\t? m(ColumnEmptyMessageBox, {\n\t\t\t\t\ticon,\n\t\t\t\t\tmessage: \"searchNoResults_msg\",\n\t\t\t\t\tcolor: theme.list_message_bg,\n\t\t\t  })\n\t\t\t: m(List, {\n\t\t\t\t\tstate: attrs.listModel.state,\n\t\t\t\t\trenderConfig,\n\t\t\t\t\tonLoadMore: () => {\n\t\t\t\t\t\tattrs.listModel?.loadMore()\n\t\t\t\t\t},\n\t\t\t\t\tonRetryLoading: () => {\n\t\t\t\t\t\tattrs.listModel?.retryLoading()\n\t\t\t\t\t},\n\t\t\t\t\tonSingleSelection: (item: CalendarSearchResultListEntry) => {\n\t\t\t\t\t\tattrs.listModel?.onSingleSelection(item)\n\t\t\t\t\t\tattrs.onSingleSelection(item)\n\t\t\t\t\t},\n\t\t\t\t\tonSingleTogglingMultiselection: (item: CalendarSearchResultListEntry) => {\n\t\t\t\t\t\tattrs.listModel.onSingleInclusiveSelection(item, styles.isSingleColumnLayout())\n\t\t\t\t\t},\n\t\t\t\t\tonRangeSelectionTowards: (item: CalendarSearchResultListEntry) => {\n\t\t\t\t\t\tattrs.listModel.selectRangeTowards(item)\n\t\t\t\t\t},\n\t\t\t\t\tonStopLoading() {\n\t\t\t\t\t\tif (attrs.cancelCallback != null) {\n\t\t\t\t\t\t\tattrs.cancelCallback()\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tattrs.listModel.stopLoading()\n\t\t\t\t\t},\n\t\t\t  } satisfies ListAttrs<CalendarSearchResultListEntry, SearchResultListRow>)\n\t}\n\n\tprivate readonly calendarRenderConfig: RenderConfig<CalendarSearchResultListEntry, SearchResultListRow> = {\n\t\titemHeight: size.list_row_height,\n\t\tmultiselectionAllowed: MultiselectMode.Disabled,\n\t\tswipe: null,\n\t\tcreateElement: (dom: HTMLElement) => {\n\t\t\tconst row: SearchResultListRow = new SearchResultListRow(new KindaCalendarRow(dom))\n\t\t\tm.render(dom, row.render())\n\t\t\treturn row\n\t\t},\n\t}\n}\n\nexport class SearchResultListRow implements VirtualRow<CalendarSearchResultListEntry> {\n\ttop: number\n\t// set from List\n\tdomElement: HTMLElement | null = null\n\n\t// this is our own entry which we need for some reason (probably easier to deal with than a lot of sum type entries)\n\tprivate _entity: CalendarSearchResultListEntry | null = null\n\tget entity(): CalendarSearchResultListEntry | null {\n\t\treturn this._entity\n\t}\n\n\tprivate _delegate: KindaCalendarRow\n\n\tconstructor(delegate: KindaCalendarRow) {\n\t\tthis._delegate = delegate\n\t\tthis.top = 0\n\t}\n\n\tupdate(entry: CalendarSearchResultListEntry, selected: boolean, isInMultiSelect: boolean): void {\n\t\tthis._delegate.domElement = this.domElement!\n\t\tthis._entity = entry\n\n\t\tthis._delegate.update(downcast(entry.entry), selected, isInMultiSelect)\n\t}\n\n\trender(): Children {\n\t\treturn this._delegate.render()\n\t}\n}\n"]}