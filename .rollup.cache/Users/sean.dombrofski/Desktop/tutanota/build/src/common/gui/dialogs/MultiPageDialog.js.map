{"version":3,"file":"MultiPageDialog.js","sourceRoot":"","sources":["../../../../../src/common/gui/dialogs/MultiPageDialog.ts"],"names":[],"mappings":"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","sourcesContent":["import { noOp } from \"@tutao/tutanota-utils\"\nimport { Dialog } from \"../base/Dialog.js\"\nimport { ButtonAttrs } from \"../base/Button.js\"\nimport stream from \"mithril/stream\"\nimport { theme } from \"../theme.js\"\nimport m, { Children, Component, Vnode, VnodeDOM } from \"mithril\"\nimport { client } from \"../../misc/ClientDetector.js\"\nimport { px, size } from \"../size.js\"\nimport { ProgrammingError } from \"../../api/common/error/ProgrammingError.js\"\nimport { windowFacade, windowSizeListener } from \"../../misc/WindowFacade.js\"\nimport { MaybeTranslation } from \"../../misc/LanguageViewModel.js\"\n\ntype ContentRenderer<TPages> = (currentPage: TPages, dialog: Dialog, navigateToPage: (targetPage: TPages) => void, goBack: (to?: TPages) => void) => Children\ntype DialogAction<TPages> = (\n\tcurrentPage: TPages,\n\tdialog: Dialog,\n\tnavigateToPage: (targetPage: TPages) => void,\n\tgoBack: (to?: TPages) => void,\n) => ButtonAttrs | undefined\n\ntype DialogHeaderOptions<TPages> = {\n\tgetLeftAction?: DialogAction<TPages>\n\tgetRightAction?: DialogAction<TPages>\n\tgetPageTitle: (currentPage: TPages) => MaybeTranslation\n}\n\n/**\n * Multipage dialog with transition animations.\n *\n * @example\n * enum UpgradePlanPages {\n *   PLAN,\n *   INVOICE,\n *   CONFIRM\n * }\n *\n * function renderContent(page, dialog, navigateToPage, goBack) {\n *     if(page === UpgradePlanPages.PLAN) {\n *         // return your component here for the \"plan\" page...\n *     }\n *\n *     // ... return your other pages\n * }\n *\n * function getLeftAction(page, dialog, navigateToPage, goBack) {\n * \t\tif(page === UpgradePlanPages.PLAN) {\n *\t\t\treturn {\n *\t\t\t\ttype: ButtonType.Secondary,\n *\t\t\t\tclick: () => dialog.close()\n *\t\t\t\tlabel: () => \"Close\",\n *\t\t\t}\n *\t\t}\n *  \t// ... handle other pages\n * }\n *\n * const dialog = new MultiPageDialog<UpgradePlanPages>()\n * \t .buildDialog(renderContent, { getLeftAction, getPageTitle, getRightAction })\n *\n * dialog.show()\n *\n * @see ContentRenderer\n * @see DialogAction\n * @see DialogHeaderOptions\n * @see ButtonAttrs\n */\nexport class MultiPageDialog<TPages> {\n\tprivate readonly currentPageStream: stream<TPages>\n\tprivate readonly pageStackStream: stream<TPages[]>\n\tprivate readonly isAnimating: stream<boolean> = stream(false)\n\n\tconstructor(rootPage: TPages) {\n\t\tthis.currentPageStream = stream(rootPage)\n\t\tthis.pageStackStream = stream([rootPage])\n\t}\n\n\tprivate readonly goBack = (to?: TPages) => {\n\t\tif (this.isAnimating() || this.pageStackStream().length < 2) {\n\t\t\treturn\n\t\t}\n\n\t\tconst tmp = this.pageStackStream()\n\t\tif (to !== undefined) {\n\t\t\tif (!this.pageStackStream().includes(to)) {\n\t\t\t\tconsole.error(new ProgrammingError(\"Cannot go back to a page that was never visited before.\"))\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\twhile (tmp[tmp.length - 1] !== to) {\n\t\t\t\ttmp.pop()\n\t\t\t}\n\t\t} else {\n\t\t\ttmp.pop()\n\t\t}\n\n\t\tthis.pageStackStream(tmp)\n\t\tthis.currentPageStream(tmp[tmp.length - 1])\n\t}\n\n\tprivate readonly navigateToPage = (target: TPages) => {\n\t\tif (this.isAnimating()) {\n\t\t\treturn\n\t\t}\n\n\t\tconst tmp = this.pageStackStream()\n\t\ttmp.push(target)\n\n\t\tthis.currentPageStream(target)\n\t\tthis.pageStackStream(tmp)\n\t}\n\n\t/**\n\t * Prepares dialog attributes and builds a MediumDialog returning it to the caller\n\t * @param renderContent\n\t * @param getLeftAction\n\t * @param getPageTitle\n\t * @param getRightAction\n\t */\n\tbuildDialog(renderContent: ContentRenderer<TPages>, { getLeftAction, getPageTitle, getRightAction }: DialogHeaderOptions<TPages>): Dialog {\n\t\tconst dialog: Dialog = Dialog.editMediumDialog(\n\t\t\t{\n\t\t\t\tleft: () => [getLeftAction?.(this.currentPageStream(), dialog, this.navigateToPage, this.goBack)].filter((item): item is ButtonAttrs => !!item),\n\t\t\t\tmiddle: getPageTitle(this.currentPageStream()),\n\t\t\t\tright: () =>\n\t\t\t\t\t[getRightAction?.(this.currentPageStream(), dialog, this.navigateToPage, this.goBack)].filter((item): item is ButtonAttrs => !!item),\n\t\t\t},\n\t\t\tMultiPageDialogViewWrapper<TPages>,\n\t\t\t{\n\t\t\t\tcurrentPageStream: this.currentPageStream,\n\t\t\t\trenderContent: (page: stream<TPages>) => renderContent(page(), dialog, this.navigateToPage, this.goBack),\n\t\t\t\tstackStream: this.pageStackStream,\n\t\t\t\tisAnimating: this.isAnimating,\n\t\t\t},\n\t\t\t{\n\t\t\t\theight: \"100%\",\n\t\t\t\t\"background-color\": theme.navigation_bg,\n\t\t\t},\n\t\t)\n\n\t\tif (client.isMobileDevice()) {\n\t\t\t// Prevent focusing text field automatically on mobile. It opens keyboard, and you don't see all details.\n\t\t\tdialog.setFocusOnLoadFunction(noOp)\n\t\t}\n\n\t\treturn dialog\n\t}\n}\n\ntype Props<TPages> = {\n\tcurrentPageStream: stream<TPages>\n\trenderContent: (currentPage: stream<TPages>) => Children\n\tstackStream: stream<TPages[]>\n\tisAnimating: stream<boolean>\n}\n\nenum SlideDirection {\n\tLEFT,\n\tRIGHT,\n}\n\nclass MultiPageDialogViewWrapper<TPages> implements Component<Props<TPages>> {\n\tprivate readonly transitionPage: stream<TPages | null> = stream(null)\n\tprivate dialogHeight: number | null = null\n\tprivate pageWidth: number = -1\n\tprivate translate = 0\n\tprivate pagesWrapperDomElement!: HTMLElement\n\t// We can assume the stack size is one because we already enforce having a root page when initializing MultiPageDialog\n\tprivate stackSize = 1\n\tprivate slideDirection: SlideDirection | undefined = undefined\n\tprivate transitionClass = \"\"\n\n\tconstructor(vnode: Vnode<Props<TPages>>) {\n\t\tvnode.attrs.stackStream.map((newStack: TPages[]) => {\n\t\t\tconst newStackLength = newStack.length\n\t\t\tif (newStackLength < this.stackSize && newStack.length > 0) {\n\t\t\t\tthis.slideDirection = SlideDirection.LEFT\n\t\t\t\tthis.goBack(vnode)\n\t\t\t\tthis.stackSize = newStackLength\n\t\t\t} else if (newStackLength > this.stackSize) {\n\t\t\t\tthis.slideDirection = SlideDirection.RIGHT\n\t\t\t\tthis.stackSize = newStackLength\n\t\t\t\tthis.transitionTo(vnode, newStack[newStackLength - 1])\n\t\t\t}\n\t\t})\n\t}\n\n\tprivate readonly resizeListener: windowSizeListener = () => {\n\t\tthis.setPageWidth(this.pagesWrapperDomElement)\n\t\tm.redraw()\n\t}\n\n\tprivate setPageWidth(dom: HTMLElement) {\n\t\tconst parentElement = dom.parentElement\n\t\tif (parentElement) {\n\t\t\tthis.pageWidth = dom.parentElement.clientWidth - size.hpad_large * 2\n\t\t}\n\t\t// Twice the page width plus the gap between pages (64px)\n\t\tdom.style.width = px(this.pageWidth * 2 + size.vpad_xxl)\n\t}\n\n\tonremove(vnode: VnodeDOM<Props<TPages>>) {\n\t\twindowFacade.removeResizeListener(this.resizeListener)\n\t\tvnode.attrs.currentPageStream.end(true)\n\t}\n\n\toncreate(vnode: VnodeDOM<Props<TPages>>): void {\n\t\tthis.pagesWrapperDomElement = vnode.dom as HTMLElement\n\n\t\tvnode.dom.addEventListener(\"transitionend\", () => {\n\t\t\tthis.transitionClass = \"\"\n\t\t\tvnode.attrs.isAnimating(false)\n\t\t\tthis.transitionPage(null)\n\t\t\tthis.translate = 0\n\t\t\tm.redraw()\n\t\t})\n\n\t\twindowFacade.addResizeListener(this.resizeListener)\n\t}\n\n\tonupdate(vnode: VnodeDOM<Props<TPages>>): any {\n\t\tconst dom = vnode.dom as HTMLElement\n\t\tif (this.dialogHeight == null && dom.parentElement) {\n\t\t\tthis.dialogHeight = dom.parentElement.clientHeight\n\t\t\t;(vnode.dom as HTMLElement).style.height = px(this.dialogHeight)\n\t\t}\n\n\t\tif (this.pageWidth == -1 && dom.parentElement) {\n\t\t\tthis.setPageWidth(dom)\n\t\t\tm.redraw()\n\t\t}\n\t}\n\n\tprivate wrap(children: Children) {\n\t\treturn m(\"\", { style: { width: px(this.pageWidth) } }, children)\n\t}\n\n\tprivate getFillerPage(currentPage: TPages, stack: TPages[]): stream<TPages> {\n\t\tconst page = this.slideDirection == SlideDirection.RIGHT ? stack[stack.length - 2] : this.transitionPage()\n\t\treturn stream(page ?? currentPage)\n\t}\n\n\tprivate renderPage(vnode: Vnode<Props<TPages>>) {\n\t\tconst updatedStackSize = vnode.attrs.stackStream().length\n\n\t\tconst fillerPageStream = this.getFillerPage(vnode.attrs.currentPageStream(), vnode.attrs.stackStream())\n\n\t\tconst pages = [this.wrap(vnode.attrs.renderContent(fillerPageStream)), this.wrap(vnode.attrs.renderContent(vnode.attrs.currentPageStream))]\n\n\t\tconst isOnRootPage = this.transitionPage() == null && updatedStackSize >= 2\n\n\t\tif (vnode.attrs.isAnimating() && !isOnRootPage) {\n\t\t\treturn this.slideDirection === SlideDirection.RIGHT ? pages : pages.reverse()\n\t\t}\n\n\t\treturn this.slideDirection === SlideDirection.RIGHT ? pages.reverse() : pages\n\t}\n\n\tprivate goBack(vnode: Vnode<Props<TPages>>) {\n\t\tthis.tryScrollToTop()\n\n\t\tconst target = vnode.attrs.currentPageStream()\n\t\tthis.translate = -(this.pageWidth + size.vpad_xxl)\n\t\tm.redraw.sync()\n\n\t\trequestAnimationFrame(() => {\n\t\t\tvnode.attrs.isAnimating(true)\n\t\t\tthis.transitionPage(target)\n\t\t\tthis.transitionClass = \"transition-transform\"\n\t\t\tthis.translate = 0\n\t\t})\n\t}\n\n\t/**\n\t * Determines the parent element of the pages wrapper (which should be the dialog) and sets the `scrollTop` to `0`.\n\t * If the parent element is not found or does not include the `scroll` CSS class, nothing will happen.\n\t */\n\tprivate tryScrollToTop() {\n\t\tconst parentElement = this.pagesWrapperDomElement.parentElement\n\n\t\tif (parentElement?.classList.contains(\"scroll\")) {\n\t\t\tparentElement.scrollTop = 0\n\t\t}\n\t}\n\n\tprivate transitionTo(vnode: Vnode<Props<TPages>>, target: TPages) {\n\t\tthis.tryScrollToTop()\n\n\t\tthis.translate = 0\n\t\tm.redraw.sync()\n\n\t\trequestAnimationFrame(() => {\n\t\t\tvnode.attrs.isAnimating(true)\n\t\t\tthis.transitionPage(target)\n\t\t\tthis.transitionClass = \"transition-transform\"\n\t\t\tthis.translate = -(this.pageWidth + size.vpad_xxl)\n\t\t})\n\t}\n\n\tview(vnode: Vnode<Props<TPages>>): Children {\n\t\treturn m(\n\t\t\t\".flex.gap-vpad-xxl.fit-content\",\n\t\t\t{\n\t\t\t\tclass: this.transitionClass,\n\t\t\t\tstyle: {\n\t\t\t\t\ttransform: `translateX(${this.translate}px)`,\n\t\t\t\t},\n\t\t\t},\n\t\t\tthis.renderPage(vnode),\n\t\t)\n\t}\n}\n"]}