{"version":3,"file":"PageView.js","sourceRoot":"","sources":["../../../../../src/common/gui/base/PageView.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { SwipeHandler } from \"./SwipeHandler\"\nimport { animations, transform, TransformEnum } from \"../animation/Animations\"\n\ntype Page = {\n\tkey: string | number\n\tnodes: Children\n}\ntype Attrs = {\n\tpreviousPage: Page\n\tcurrentPage: Page\n\tnextPage: Page\n\tonChangePage: (next: boolean) => unknown\n}\n\nexport class PageView implements Component<Attrs> {\n\tprivate viewDom: HTMLElement | null = null\n\tprivate onChangePage!: (_: boolean) => unknown\n\n\tview({ attrs }: Vnode<Attrs>): Children {\n\t\tthis.onChangePage = (next) => attrs.onChangePage(next)\n\t\treturn m(\n\t\t\t\".rel.flex-grow.overflow-hidden\",\n\t\t\tm(\n\t\t\t\t\".fill-absolute\",\n\t\t\t\t{\n\t\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\t\tthis.viewDom = vnode.dom as HTMLElement\n\t\t\t\t\t\tconst swipeHandler = new PageSwipeHandler(this.viewDom, (next) => this.onChangePage(next))\n\t\t\t\t\t\tswipeHandler.attach()\n\n\t\t\t\t\t\t// This redraw is needed after setting the viewDom to immediately apply the transforms\n\t\t\t\t\t\t// preventing the overlap of events from other dates with the current listed date\n\t\t\t\t\t\tm.redraw()\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[\n\t\t\t\t\tm(\n\t\t\t\t\t\t\".abs\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"aria-hidden\": \"true\",\n\t\t\t\t\t\t\tkey: attrs.previousPage.key,\n\t\t\t\t\t\t\tstyle: this.viewDom &&\n\t\t\t\t\t\t\t\tthis.viewDom.offsetWidth > 0 && {\n\t\t\t\t\t\t\t\t\twidth: this.viewDom.offsetWidth + \"px\",\n\t\t\t\t\t\t\t\t\theight: this.viewDom.offsetHeight + \"px\",\n\t\t\t\t\t\t\t\t\ttransform: `translateX(${-this.viewDom.offsetWidth}px)`,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tattrs.previousPage.nodes,\n\t\t\t\t\t),\n\t\t\t\t\tm(\n\t\t\t\t\t\t\".fill-absolute\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: attrs.currentPage.key,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tattrs.currentPage.nodes,\n\t\t\t\t\t),\n\t\t\t\t\tm(\n\t\t\t\t\t\t\".abs\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"aria-hidden\": \"true\",\n\t\t\t\t\t\t\tkey: attrs.nextPage.key,\n\t\t\t\t\t\t\tstyle: this.viewDom &&\n\t\t\t\t\t\t\t\tthis.viewDom.offsetWidth > 0 && {\n\t\t\t\t\t\t\t\t\twidth: this.viewDom.offsetWidth + \"px\",\n\t\t\t\t\t\t\t\t\theight: this.viewDom.offsetHeight + \"px\",\n\t\t\t\t\t\t\t\t\ttransform: `translateX(${this.viewDom.offsetWidth}px)`,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tattrs.nextPage.nodes,\n\t\t\t\t\t),\n\t\t\t\t],\n\t\t\t),\n\t\t)\n\t}\n}\n\nclass PageSwipeHandler extends SwipeHandler {\n\tprivate readonly onGestureCompleted: (next: boolean) => unknown\n\tprivate xOffset: number = 0\n\n\tconstructor(touchArea: HTMLElement, onGestureCompleted: (next: boolean) => unknown) {\n\t\tsuper(touchArea)\n\t\t// avoid flickering especially in day and week view when overflow-y is set on nested elements\n\t\ttouchArea.style.transformStyle = \"preserve-3d\"\n\t\ttouchArea.style.backfaceVisibility = \"hidden\"\n\t\tthis.onGestureCompleted = onGestureCompleted\n\t}\n\n\tonHorizontalDrag(xDelta: number, yDelta: number) {\n\t\tthis.xOffset = Math.abs(xDelta) > 40 ? xDelta : 0\n\t\tthis.touchArea.style.transform = `translateX(${this.xOffset}px)`\n\t}\n\n\tonHorizontalGestureCompleted(delta: { x: number; y: number }): Promise<void> {\n\t\tif (Math.abs(delta.x) > 100) {\n\t\t\tthis.xOffset = 0\n\t\t\treturn animations\n\t\t\t\t.add(this.touchArea, transform(TransformEnum.TranslateX, delta.x, this.touchArea.offsetWidth * (delta.x > 0 ? 1 : -1)))\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.onGestureCompleted(delta.x < 0)\n\n\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\tthis.touchArea.style.transform = \"\"\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t} else {\n\t\t\treturn this.reset(delta)\n\t\t}\n\t}\n\n\treset(delta: { x: number; y: number }): Promise<any> {\n\t\tif (Math.abs(this.xOffset) > 40) {\n\t\t\tanimations.add(this.touchArea, transform(TransformEnum.TranslateX, delta.x, 0))\n\t\t} else {\n\t\t\tthis.touchArea.style.transform = \"\"\n\t\t}\n\n\t\tthis.xOffset = 0\n\t\treturn super.reset(delta)\n\t}\n}\n"]}