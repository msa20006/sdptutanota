{"version":3,"file":"DesktopWebauthnFacade.js","sourceRoot":"","sources":["../../../../../src/common/desktop/2fa/DesktopWebauthnFacade.ts"],"names":[],"mappings":"AASA,MAAM,OAAO,qBAAqB;IAGJ;IAAkD;IAFvE,aAAa,GAAkE,IAAI,CAAA;IAE3F,YAA6B,YAA+B,EAAmB,mBAAwC;QAA1F,iBAAY,GAAZ,YAAY,CAAmB;QAAmB,wBAAmB,GAAnB,mBAAmB,CAAqB;IAAG,CAAC;IAE3H,KAAK,CAAC,QAAQ,CAAC,SAAwC;QACtD,MAAM,EAAE,MAAM,EAAE,GAAG,SAAS,CAAA;QAE5B,OAAO,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAA;IAC3E,CAAC;IAED,KAAK,CAAC,IAAI,CAAC,SAAgC;QAC1C,MAAM,EAAE,MAAM,EAAE,GAAG,SAAS,CAAA;QAE5B,OAAO,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAA;IACvE,CAAC;IAED,KAAK,CAAC,0BAA0B,CAAC,IAAY;QAC5C,OAAO,IAAI,CAAA;IACZ,CAAC;IAED,KAAK,CAAC,8BAA8B,CAAC,KAAa;QACjD,OAAO,IAAI,CAAA;IACZ,CAAC;IAED,KAAK,CAAC,WAAW;QAChB,OAAO,IAAI,CAAA;IACZ,CAAC;IAED,KAAK,CAAC,qBAAqB;QAC1B,IAAI,CAAC;YACJ,CAAC;YAAA,CAAC,MAAM,IAAI,CAAC,aAAa,CAAC,EAAE,MAAM,EAAE,CAAA;QACtC,CAAC;QAAC,OAAO,OAAO,EAAE,CAAC;YAClB,WAAW;QACZ,CAAC;IACF,CAAC;IAEO,KAAK,CAAC,UAAU,CAAI,UAAkB,EAAE,OAAiD;QAChG,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,mBAAmB,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,EAAE,IAAI,GAAG,CAAC,UAAU,CAAC,CAAC,CAAA;QAE/F,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,aAAa,CAAA;QACvC,IAAI,CAAC;YACJ,mEAAmE;YACnE,OAAO,MAAM,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,OAAO,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,CAAA;QAC5E,CAAC;gBAAS,CAAC;YACV,IAAI,CAAC,aAAa,GAAG,IAAI,CAAA;QAC1B,CAAC;IACF,CAAC;CACD","sourcesContent":["import { WebAuthnFacade } from \"../../native/common/generatedipc/WebAuthnFacade.js\"\nimport type { WebDialogController } from \"../WebDialog.js\"\nimport { WebDialog } from \"../WebDialog.js\"\nimport { ApplicationWindow } from \"../ApplicationWindow.js\"\nimport { WebAuthnRegistrationChallenge } from \"../../native/common/generatedipc/WebAuthnRegistrationChallenge.js\"\nimport { WebAuthnRegistrationResult } from \"../../native/common/generatedipc/WebAuthnRegistrationResult.js\"\nimport { WebAuthnSignChallenge } from \"../../native/common/generatedipc/WebAuthnSignChallenge.js\"\nimport { WebAuthnSignResult } from \"../../native/common/generatedipc/WebAuthnSignResult.js\"\n\nexport class DesktopWebauthnFacade implements WebAuthnFacade {\n\tprivate currentDialog: Promise<WebDialog<{ WebAuthnFacade: WebAuthnFacade }>> | null = null\n\n\tconstructor(private readonly parentWindow: ApplicationWindow, private readonly webDialogController: WebDialogController) {}\n\n\tasync register(challenge: WebAuthnRegistrationChallenge): Promise<WebAuthnRegistrationResult> {\n\t\tconst { domain } = challenge\n\n\t\treturn this.withDialog(domain, (webauthn) => webauthn.register(challenge))\n\t}\n\n\tasync sign(challenge: WebAuthnSignChallenge): Promise<WebAuthnSignResult> {\n\t\tconst { domain } = challenge\n\n\t\treturn this.withDialog(domain, (webauthn) => webauthn.sign(challenge))\n\t}\n\n\tasync canAttemptChallengeForRpId(rpId: string): Promise<boolean> {\n\t\treturn true\n\t}\n\n\tasync canAttemptChallengeForU2FAppId(appId: string): Promise<boolean> {\n\t\treturn true\n\t}\n\n\tasync isSupported(): Promise<boolean> {\n\t\treturn true\n\t}\n\n\tasync abortCurrentOperation(): Promise<void> {\n\t\ttry {\n\t\t\t;(await this.currentDialog)?.cancel()\n\t\t} catch (ignored) {\n\t\t\t/* empty */\n\t\t}\n\t}\n\n\tprivate async withDialog<T>(baseDomain: string, request: (webauthn: WebAuthnFacade) => Promise<T>): Promise<T> {\n\t\tthis.currentDialog = this.webDialogController.create(this.parentWindow.id, new URL(baseDomain))\n\n\t\tconst dialog = await this.currentDialog\n\t\ttry {\n\t\t\t// make sure to await to get finally() to trigger in case of errors\n\t\t\treturn await dialog.makeRequest((remote) => request(remote.WebAuthnFacade))\n\t\t} finally {\n\t\t\tthis.currentDialog = null\n\t\t}\n\t}\n}\n"]}