{"version":3,"file":"DesktopContextMenu.js","sourceRoot":"","sources":["../../../../src/common/desktop/DesktopContextMenu.ts"],"names":[],"mappings":"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","sourcesContent":["import type { ContextMenuParams, Menu, WebContents } from \"electron\"\nimport { lang } from \"../misc/LanguageViewModel\"\nimport { WindowManager } from \"./DesktopWindowManager.js\"\nimport { client } from \"../misc/ClientDetector.js\"\n\ntype Electron = typeof Electron.CrossProcessExports\n\nexport class DesktopContextMenu {\n\tconstructor(private readonly electron: Electron, private readonly windowManager: WindowManager) {}\n\n\topen(params: ContextMenuParams) {\n\t\tconst { linkURL, editFlags, misspelledWord, dictionarySuggestions } = params\n\t\tconst menu = new this.electron.Menu()\n\t\tconst pasteItem = new this.electron.MenuItem({\n\t\t\tlabel: lang.get(\"paste_action\"),\n\t\t\taccelerator: \"CmdOrCtrl+V\",\n\t\t\tclick: (_, bw) => this.getWebContents(bw)?.paste(),\n\t\t\tenabled: editFlags.canPaste,\n\t\t})\n\t\tconst pasteWithoutFormattingItem = new this.electron.MenuItem({\n\t\t\tlabel: lang.get(\"pasteWithoutFormatting_action\"),\n\t\t\taccelerator: client.isMacOS ? \"Cmd+Option+Shift+V\" : \"Ctrl+Shift+V\",\n\t\t\tclick: (_, bw) => this.getWebContents(bw)?.pasteAndMatchStyle(),\n\t\t\tenabled: editFlags.canPaste,\n\t\t})\n\t\tconst copyItem = new this.electron.MenuItem({\n\t\t\tlabel: lang.get(\"copy_action\"),\n\t\t\taccelerator: \"CmdOrCtrl+C\",\n\t\t\tclick: (_, bw) => this.getWebContents(bw)?.copy(),\n\t\t\tenabled: editFlags.canCopy,\n\t\t})\n\t\tconst cutItem = new this.electron.MenuItem({\n\t\t\tlabel: lang.get(\"cut_action\"),\n\t\t\taccelerator: \"CmdOrCtrl+X\",\n\t\t\tclick: (_, bw) => this.getWebContents(bw)?.cut(),\n\t\t\tenabled: editFlags.canCut,\n\t\t})\n\t\tconst copyLinkItem = new this.electron.MenuItem({\n\t\t\tlabel: lang.get(\"copyLink_action\"),\n\t\t\tclick: () => !!linkURL && this.electron.clipboard.writeText(linkURL),\n\t\t\tenabled: !!linkURL,\n\t\t})\n\t\tconst undoItem = new this.electron.MenuItem({\n\t\t\tlabel: lang.get(\"undo_action\"),\n\t\t\taccelerator: \"CmdOrCtrl+Z\",\n\t\t\tclick: (_, bw) => this.getWebContents(bw)?.undo(),\n\t\t\tenabled: editFlags.canUndo,\n\t\t})\n\t\tconst redoItem = new this.electron.MenuItem({\n\t\t\tlabel: lang.get(\"redo_action\"),\n\t\t\taccelerator: \"CmdOrCtrl+Shift+Z\",\n\t\t\tclick: (_, bw) => this.getWebContents(bw)?.redo(),\n\t\t\tenabled: editFlags.canRedo,\n\t\t})\n\t\tconst spellingItem = new this.electron.MenuItem({\n\t\t\tlabel: lang.get(\"spelling_label\"),\n\t\t\tsubmenu: this.spellingSubmenu(misspelledWord, dictionarySuggestions),\n\t\t})\n\t\tmenu.append(copyItem)\n\t\tmenu.append(cutItem)\n\t\tmenu.append(copyLinkItem)\n\t\tmenu.append(pasteItem)\n\t\tmenu.append(pasteWithoutFormattingItem)\n\t\tmenu.append(\n\t\t\tnew this.electron.MenuItem({\n\t\t\t\ttype: \"separator\",\n\t\t\t}),\n\t\t)\n\t\tmenu.append(undoItem)\n\t\tmenu.append(redoItem)\n\t\tmenu.append(\n\t\t\tnew this.electron.MenuItem({\n\t\t\t\ttype: \"separator\",\n\t\t\t}),\n\t\t)\n\t\t// it would be possible to open the menu with a spellcheck dummy\n\t\t// like \"searching dictionary...\" and then append suggestions\n\t\t// and then re-popup the context menu, but alas, the suggestions\n\t\t// are already searched before the context-menu handler is even\n\t\t// invoked, leading to a delay between right-click and menu popup.\n\t\tmenu.append(spellingItem)\n\t\tmenu.popup()\n\t}\n\n\tprivate getWebContents(bw: Electron.BaseWindow | undefined): WebContents | null {\n\t\treturn (bw && bw instanceof this.electron.BrowserWindow && bw.webContents) || null\n\t}\n\n\tprivate spellingSubmenu(misspelledWord: string, dictionarySuggestions: Array<string>): Menu {\n\t\tconst submenu = new this.electron.Menu()\n\n\t\tif (misspelledWord !== \"\") {\n\t\t\tfor (const s of dictionarySuggestions) {\n\t\t\t\tconst menuItem = new this.electron.MenuItem({\n\t\t\t\t\tlabel: s,\n\t\t\t\t\tclick: (_, bw) => this.getWebContents(bw)?.replaceMisspelling(s),\n\t\t\t\t})\n\t\t\t\tsubmenu.append(menuItem)\n\t\t\t}\n\t\t\tsubmenu.append(\n\t\t\t\tnew this.electron.MenuItem({\n\t\t\t\t\ttype: \"separator\",\n\t\t\t\t}),\n\t\t\t)\n\t\t\tsubmenu.append(\n\t\t\t\tnew this.electron.MenuItem({\n\t\t\t\t\tlabel: lang.get(\"addToDict_action\", {\n\t\t\t\t\t\t\"{word}\": misspelledWord,\n\t\t\t\t\t}),\n\t\t\t\t\tclick: (_, bw) => this.getWebContents(bw)?.session.addWordToSpellCheckerDictionary(misspelledWord),\n\t\t\t\t}),\n\t\t\t)\n\t\t}\n\n\t\t// the spellcheck API uses the OS spell checker on MacOs, the language is set in the OS settings.\n\t\tif (process.platform !== \"darwin\") {\n\t\t\tsubmenu.append(\n\t\t\t\tnew this.electron.MenuItem({\n\t\t\t\t\tlabel: lang.get(\"changeSpellCheckLang_action\"),\n\t\t\t\t\tclick: (_, bw) => {\n\t\t\t\t\t\tconst webContents = this.getWebContents(bw)\n\t\t\t\t\t\tif (webContents) {\n\t\t\t\t\t\t\tthis.changeSpellcheckLanguage(webContents)\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t)\n\t\t}\n\n\t\treturn submenu\n\t}\n\n\tprivate async changeSpellcheckLanguage(wc: WebContents) {\n\t\tconst windowId = this.electron.BrowserWindow.fromWebContents(wc)?.id\n\t\tif (windowId == null) return\n\t\tconst window = this.windowManager.get(windowId)\n\t\twindow?.desktopFacade.showSpellcheckDropdown()\n\t}\n}\n"]}