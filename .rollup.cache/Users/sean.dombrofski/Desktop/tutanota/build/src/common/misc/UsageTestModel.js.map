{"version":3,"file":"UsageTestModel.js","sourceRoot":"","sources":["../../../../src/common/misc/UsageTestModel.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n\tcreateUsageTestAssignmentIn,\n\tcreateUsageTestMetricData,\n\tcreateUsageTestParticipationIn,\n\tUsageTestAssignment,\n\tUsageTestAssignmentOut,\n\tUsageTestAssignmentTypeRef,\n} from \"../api/entities/usage/TypeRefs.js\"\nimport { PingAdapter, Stage, UsageTest, UsageTestController } from \"@tutao/tutanota-usagetests\"\nimport { assertNotNull, filterInt, lazy, neverNull } from \"@tutao/tutanota-utils\"\nimport { BadRequestError, NotFoundError, PreconditionFailedError } from \"../api/common/error/RestError\"\nimport { UsageTestMetricType } from \"../api/common/TutanotaConstants\"\nimport { SuspensionError } from \"../api/common/error/SuspensionError\"\nimport { SuspensionBehavior } from \"../api/worker/rest/RestClient\"\nimport { DateProvider } from \"../api/common/DateProvider.js\"\nimport { IServiceExecutor } from \"../api/common/ServiceRequest\"\nimport { UsageTestAssignmentService, UsageTestParticipationService } from \"../api/entities/usage/Services.js\"\nimport { resolveTypeReference } from \"../api/common/EntityFunctions\"\nimport { lang, TranslationKey } from \"./LanguageViewModel\"\nimport stream from \"mithril/stream\"\nimport { Dialog, DialogType } from \"../gui/base/Dialog\"\nimport { DropDownSelector, SelectorItem } from \"../gui/base/DropDownSelector\"\nimport m, { Children } from \"mithril\"\nimport { isOfflineError } from \"../api/common/utils/ErrorUtils.js\"\nimport { LoginController } from \"../api/main/LoginController.js\"\nimport { CustomerProperties, CustomerPropertiesTypeRef, CustomerTypeRef } from \"../api/entities/sys/TypeRefs.js\"\nimport { EntityClient } from \"../api/common/EntityClient.js\"\nimport { EventController } from \"../api/main/EventController.js\"\nimport { createUserSettingsGroupRoot, UserSettingsGroupRootTypeRef } from \"../api/entities/tutanota/TypeRefs.js\"\nimport { EntityUpdateData, isUpdateForTypeRef } from \"../api/common/utils/EntityUpdateUtils.js\"\n\nconst PRESELECTED_LIKERT_VALUE = null\n\ntype ExperienceSamplingOptions = {\n\ttitle?: TranslationKey\n\texplanationText?: TranslationKey\n\tperMetric: {\n\t\t[key: string]: {\n\t\t\tquestion: TranslationKey\n\t\t\tanswerOptions: Array<string>\n\t\t}\n\t}\n}\n\nexport async function showExperienceSamplingDialog(stage: Stage, experienceSamplingOptions: ExperienceSamplingOptions): Promise<void> {\n\tconst likertMetrics = Array.from(stage.metricConfigs.values()).filter(\n\t\t(metricConfig) => (metricConfig.type as UsageTestMetricType) === UsageTestMetricType.Likert,\n\t)\n\tconst selectedValues = new Map(likertMetrics.map((likertMetric) => [likertMetric.name, stream(PRESELECTED_LIKERT_VALUE)]))\n\n\tDialog.showActionDialog({\n\t\ttype: DialogType.EditMedium,\n\t\tokAction: (dialog: Dialog) => {\n\t\t\tfor (let [metricName, selectedValue] of selectedValues) {\n\t\t\t\tconst selection = selectedValue()\n\n\t\t\t\tif (selection === null) {\n\t\t\t\t\t// User did not select an answer\n\t\t\t\t\treturn Dialog.message(\"experienceSamplingSelectAnswer_msg\")\n\t\t\t\t}\n\n\t\t\t\tstage.setMetric({\n\t\t\t\t\tname: metricName,\n\t\t\t\t\tvalue: selection,\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tstage.complete().then(() => dialog.close())\n\t\t\treturn Dialog.message(\"experienceSamplingThankYou_msg\")\n\t\t},\n\t\ttitle: experienceSamplingOptions.title ?? \"experienceSamplingHeader_label\",\n\t\tchild: () => {\n\t\t\tconst children: Array<Children> = []\n\n\t\t\tif (experienceSamplingOptions.explanationText) {\n\t\t\t\tconst explanationTextLines = lang.getTranslationText(experienceSamplingOptions.explanationText).split(\"\\n\")\n\n\t\t\t\tchildren.push(\n\t\t\t\t\tm(\"#dialog-message.text-break.text-prewrap.selectable.scroll\", [explanationTextLines.map((line) => m(\".text-break.selectable\", line))]),\n\t\t\t\t)\n\t\t\t}\n\n\t\t\tfor (let likertMetricConfig of likertMetrics) {\n\t\t\t\tconst metricOptions = experienceSamplingOptions[\"perMetric\"][likertMetricConfig.name]\n\n\t\t\t\tconst answerOptionItems: Array<SelectorItem<string>> = metricOptions.answerOptions.map((answerOption, index) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: answerOption,\n\t\t\t\t\t\tvalue: (index + 1).toString(),\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tchildren.push(m(\"p.text-prewrap.scroll\", lang.getTranslationText(metricOptions.question)))\n\n\t\t\t\tchildren.push(\n\t\t\t\t\tm(DropDownSelector, {\n\t\t\t\t\t\tlabel: \"experienceSamplingAnswer_label\",\n\t\t\t\t\t\titems: answerOptionItems,\n\t\t\t\t\t\tselectedValue: selectedValues.get(likertMetricConfig.name)!,\n\t\t\t\t\t}),\n\t\t\t\t)\n\t\t\t}\n\n\t\t\treturn children\n\t\t},\n\t})\n}\n\nexport interface PersistedAssignmentData {\n\tupdatedAt: number\n\tassignments: UsageTestAssignment[]\n\tusageModelVersion: number\n}\n\nexport interface UsageTestStorage {\n\tgetTestDeviceId(): Promise<string | null>\n\n\tstoreTestDeviceId(testDeviceId: string): Promise<void>\n\n\tgetAssignments(): Promise<PersistedAssignmentData | null>\n\n\tstoreAssignments(persistedAssignmentData: PersistedAssignmentData): Promise<void>\n}\n\nexport class EphemeralUsageTestStorage implements UsageTestStorage {\n\tprivate assignments: PersistedAssignmentData | null = null\n\tprivate testDeviceId: string | null = null\n\n\tgetAssignments(): Promise<PersistedAssignmentData | null> {\n\t\treturn Promise.resolve(this.assignments)\n\t}\n\n\tgetTestDeviceId(): Promise<string | null> {\n\t\treturn Promise.resolve(this.testDeviceId)\n\t}\n\n\tstoreAssignments(persistedAssignmentData: PersistedAssignmentData): Promise<void> {\n\t\tthis.assignments = persistedAssignmentData\n\t\treturn Promise.resolve()\n\t}\n\n\tstoreTestDeviceId(testDeviceId: string): Promise<void> {\n\t\tthis.testDeviceId = testDeviceId\n\t\treturn Promise.resolve()\n\t}\n}\n\nexport const ASSIGNMENT_UPDATE_INTERVAL_MS = 1000 * 60 * 60 // 1h\n\nexport const enum StorageBehavior {\n\t/* Store usage test assignments in the \"persistent\" storage. Currently, this is the client's instance of DeviceConfig, which uses the browser's local storage.\n\tUse if the user is logged in and has opted in to sending usage data. */\n\tPersist,\n\t/* Store usage test assignments in the \"ephemeral\" storage. Currently, this is an instance of EphemeralUsageTestStorage.\n\tUse if the user is not logged in. */\n\tEphemeral,\n}\n\nexport class UsageTestModel implements PingAdapter {\n\tprivate storageBehavior = StorageBehavior.Ephemeral\n\tprivate customerProperties?: CustomerProperties\n\tprivate lastOptInDecision: boolean | null = null\n\tprivate lastPing = Promise.resolve()\n\n\tconstructor(\n\t\tprivate readonly storages: { [key in StorageBehavior]: UsageTestStorage },\n\t\tprivate readonly dateProvider: DateProvider,\n\t\tprivate readonly serviceExecutor: IServiceExecutor,\n\t\tprivate readonly entityClient: EntityClient,\n\t\tprivate readonly loginController: LoginController,\n\t\tprivate readonly eventController: EventController,\n\t\tprivate readonly usageTestController: () => UsageTestController,\n\t) {\n\t\teventController.addEntityListener((updates: ReadonlyArray<EntityUpdateData>) => {\n\t\t\treturn this.entityEventsReceived(updates)\n\t\t})\n\t}\n\n\tasync entityEventsReceived(updates: ReadonlyArray<EntityUpdateData>) {\n\t\tfor (const update of updates) {\n\t\t\tif (isUpdateForTypeRef(CustomerPropertiesTypeRef, update)) {\n\t\t\t\tawait this.loginController.waitForFullLogin()\n\t\t\t\tawait this.updateCustomerProperties()\n\t\t\t} else if (isUpdateForTypeRef(UserSettingsGroupRootTypeRef, update)) {\n\t\t\t\tawait this.loginController.waitForFullLogin()\n\t\t\t\tconst updatedOptInDecision = this.loginController.getUserController().userSettingsGroupRoot.usageDataOptedIn\n\n\t\t\t\tif (this.lastOptInDecision === updatedOptInDecision) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\t// Opt-in decision has changed, load tests\n\t\t\t\tconst tests = await this.loadActiveUsageTests()\n\t\t\t\tthis.usageTestController().setTests(tests)\n\t\t\t\tthis.lastOptInDecision = updatedOptInDecision\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * only for usage from the console. may have unintended consequences when used too early or too late.\n\t * @param test the name of the test to change the variant on\n\t * @param variant the number of the variant to use from here on\n\t */\n\tprivate setVariant(test: string, variant: number) {\n\t\tthis.usageTestController().getTest(test).variant = variant\n\t}\n\n\tprivate async updateCustomerProperties() {\n\t\tconst customer = await this.entityClient.load(CustomerTypeRef, neverNull(this.loginController.getUserController().user.customer))\n\t\tthis.customerProperties = await this.entityClient.load(CustomerPropertiesTypeRef, neverNull(customer.properties))\n\t}\n\n\t/**\n\t * Needs to be called after construction, ideally after login, so that the logged-in user's CustomerProperties are loaded.\n\t */\n\tasync init() {\n\t\tawait this.updateCustomerProperties()\n\t}\n\n\tsetStorageBehavior(storageBehavior: StorageBehavior) {\n\t\tthis.storageBehavior = storageBehavior\n\t}\n\n\tprivate storage() {\n\t\treturn this.storages[this.storageBehavior]\n\t}\n\n\t/**\n\t * Returns true if the customer has opted out.\n\t * Defaults to true if init() has not been called.\n\t */\n\tisCustomerOptedOut(): boolean {\n\t\treturn this.customerProperties?.usageDataOptedOut ?? true\n\t}\n\n\t/**\n\t * Returns true if the opt-in dialog indicator should be shown, depending on the user's and the customer's decisions.\n\t * Defaults to false if init() has not been called.\n\t */\n\tshowOptInIndicator(): boolean {\n\t\tif (!this.loginController.isUserLoggedIn() || this.isCustomerOptedOut()) {\n\t\t\t// shortcut if customer has opted out (or is not logged in)\n\t\t\treturn false\n\t\t}\n\n\t\treturn this.loginController.getUserController().userSettingsGroupRoot.usageDataOptedIn === null\n\t}\n\n\t/**\n\t * Sets the user's usage data opt-in decision. True means they opt in.\n\t *\n\t * Immediately refetches the user's active usage tests if they opted in.\n\t */\n\tpublic async setOptInDecision(decision: boolean) {\n\t\tconst userSettingsGroupRoot = createUserSettingsGroupRoot(this.loginController.getUserController().userSettingsGroupRoot)\n\t\tuserSettingsGroupRoot.usageDataOptedIn = decision\n\n\t\tawait this.entityClient.update(userSettingsGroupRoot)\n\t\tthis.lastOptInDecision = decision\n\n\t\t// we need to unset the tests in case of an opt-out because otherwise we might keep using them\n\t\t// in case of an opt-in we need to load them because they might not yet have been loaded\n\t\tconst tests = decision ? await this.doLoadActiveUsageTests() : []\n\t\tthis.usageTestController().setTests(tests)\n\t}\n\n\tprivate getOptInDecision(): boolean {\n\t\tif (!this.loginController.isUserLoggedIn()) {\n\t\t\treturn false\n\t\t}\n\n\t\tconst userOptIn = this.loginController.getUserController().userSettingsGroupRoot.usageDataOptedIn\n\n\t\tif (!userOptIn) {\n\t\t\t// shortcut if userOptIn not set or equal to false\n\t\t\treturn false\n\t\t}\n\n\t\t// customer opt-out overrides the user setting\n\t\treturn !assertNotNull(this.customerProperties).usageDataOptedOut\n\t}\n\n\t/**\n\t * If the storageBehavior is set to StorageBehavior.Persist, then init() must have been called before calling this method.\n\t */\n\tasync loadActiveUsageTests() {\n\t\tif (this.storageBehavior === StorageBehavior.Persist && !this.getOptInDecision()) {\n\t\t\treturn []\n\t\t}\n\n\t\treturn await this.doLoadActiveUsageTests()\n\t}\n\n\tprivate async doLoadActiveUsageTests() {\n\t\tconst persistedData = await this.storage().getAssignments()\n\t\tconst modelVersion = await this.modelVersion()\n\n\t\tif (persistedData == null || persistedData.usageModelVersion !== modelVersion || Date.now() - persistedData.updatedAt > ASSIGNMENT_UPDATE_INTERVAL_MS) {\n\t\t\treturn this.assignmentsToTests(await this.loadAssignments())\n\t\t} else {\n\t\t\treturn this.assignmentsToTests(persistedData.assignments)\n\t\t}\n\t}\n\n\tprivate async modelVersion(): Promise<number> {\n\t\tconst model = await resolveTypeReference(UsageTestAssignmentTypeRef)\n\t\treturn filterInt(model.version)\n\t}\n\n\tprivate async loadAssignments(): Promise<UsageTestAssignment[]> {\n\t\tconst testDeviceId = await this.storage().getTestDeviceId()\n\t\tconst data = createUsageTestAssignmentIn({\n\t\t\ttestDeviceId: testDeviceId,\n\t\t})\n\n\t\ttry {\n\t\t\tconst response: UsageTestAssignmentOut = testDeviceId\n\t\t\t\t? await this.serviceExecutor.put(UsageTestAssignmentService, data, {\n\t\t\t\t\t\tsuspensionBehavior: SuspensionBehavior.Throw,\n\t\t\t\t  })\n\t\t\t\t: await this.serviceExecutor.post(UsageTestAssignmentService, data, {\n\t\t\t\t\t\tsuspensionBehavior: SuspensionBehavior.Throw,\n\t\t\t\t  })\n\t\t\tawait this.storage().storeTestDeviceId(response.testDeviceId)\n\t\t\tawait this.storage().storeAssignments({\n\t\t\t\tassignments: response.assignments,\n\t\t\t\tupdatedAt: this.dateProvider.now(),\n\t\t\t\tusageModelVersion: await this.modelVersion(),\n\t\t\t})\n\n\t\t\treturn response.assignments\n\t\t} catch (e) {\n\t\t\tif (e instanceof SuspensionError) {\n\t\t\t\tconsole.log(\"rate-limit for new assignments reached, disabling tests\")\n\t\t\t\treturn []\n\t\t\t} else if (isOfflineError(e)) {\n\t\t\t\tconsole.log(\"offline, disabling tests\")\n\t\t\t\treturn []\n\t\t\t}\n\n\t\t\tthrow e\n\t\t}\n\t}\n\n\tprivate assignmentsToTests(assignments: UsageTestAssignment[]): UsageTest[] {\n\t\treturn assignments.map((usageTestAssignment) => {\n\t\t\tconst test = new UsageTest(usageTestAssignment.testId, usageTestAssignment.name, Number(usageTestAssignment.variant), usageTestAssignment.sendPings)\n\n\t\t\tfor (const [index, stageConfig] of usageTestAssignment.stages.entries()) {\n\t\t\t\tconst stage = new Stage(index, test, Number(stageConfig.minPings), Number(stageConfig.maxPings))\n\t\t\t\tfor (const metricConfig of stageConfig.metrics) {\n\t\t\t\t\tconst configValues = new Map<string, string>()\n\n\t\t\t\t\tfor (const metricConfigValue of metricConfig.configValues) {\n\t\t\t\t\t\tconfigValues.set(metricConfigValue.key, metricConfigValue.value)\n\t\t\t\t\t}\n\n\t\t\t\t\tstage.setMetricConfig({\n\t\t\t\t\t\tname: metricConfig.name,\n\t\t\t\t\t\ttype: metricConfig.type,\n\t\t\t\t\t\tconfigValues,\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\ttest.addStage(stage)\n\t\t\t}\n\n\t\t\treturn test\n\t\t})\n\t}\n\n\tasync sendPing(test: UsageTest, stage: Stage): Promise<void> {\n\t\tthis.lastPing = this.lastPing.then(\n\t\t\t() => this.doSendPing(stage, test),\n\t\t\t() => this.doSendPing(stage, test),\n\t\t)\n\t\treturn this.lastPing\n\t}\n\n\tprivate async doSendPing(stage: Stage, test: UsageTest) {\n\t\t// Immediately stop sending pings if the user has opted out.\n\t\t// Only applicable if the user opts out and then does not re-log.\n\t\tif (this.storageBehavior === StorageBehavior.Persist && !this.getOptInDecision()) {\n\t\t\treturn\n\t\t}\n\n\t\tconst testDeviceId = await this.storage().getTestDeviceId()\n\t\tif (testDeviceId == null) {\n\t\t\tconsole.warn(\"No device id set before sending pings\")\n\t\t\treturn\n\t\t}\n\n\t\tconst metrics = Array.from(stage.collectedMetrics).map(([key, { name, value }]) =>\n\t\t\tcreateUsageTestMetricData({\n\t\t\t\tname: name,\n\t\t\t\tvalue: value,\n\t\t\t}),\n\t\t)\n\n\t\tconst data = createUsageTestParticipationIn({\n\t\t\ttestId: test.testId,\n\t\t\tmetrics,\n\t\t\tstage: stage.number.toString(),\n\t\t\ttestDeviceId: testDeviceId,\n\t\t})\n\n\t\ttry {\n\t\t\tawait this.serviceExecutor.post(UsageTestParticipationService, data, {\n\t\t\t\tsuspensionBehavior: SuspensionBehavior.Throw,\n\t\t\t})\n\t\t} catch (e) {\n\t\t\tif (e instanceof SuspensionError) {\n\t\t\t\ttest.active = false\n\t\t\t\tconsole.log(\"rate-limit for pings reached\")\n\t\t\t} else if (e instanceof PreconditionFailedError) {\n\t\t\t\tif (e.data === \"invalid_state\") {\n\t\t\t\t\ttest.active = false\n\t\t\t\t\tconsole.log(`Tried to send ping for paused test ${test.testName}`, e)\n\t\t\t\t} else if (e.data === \"invalid_restart\") {\n\t\t\t\t\ttest.active = false\n\t\t\t\t\tconsole.log(`Tried to restart test '${test.testName}' in ParticipationMode.Once that device has already participated in`, e)\n\t\t\t\t} else if (e.data === \"invalid_stage\") {\n\t\t\t\t\tconsole.log(`Tried to send ping for wrong stage ${stage.number} of test '${test.testName}'`, e)\n\t\t\t\t} else if (e.data === \"invalid_stage_skip\") {\n\t\t\t\t\tconsole.log(`Tried to skip a required stage before stage ${stage.number} of test '${test.testName}'`, e)\n\t\t\t\t} else if (e.data === \"invalid_stage_repetition\") {\n\t\t\t\t\tconsole.log(`Tried to repeat stage ${stage.number} of test '${test.testName}' too many times`, e)\n\t\t\t\t} else {\n\t\t\t\t\tthrow e\n\t\t\t\t}\n\t\t\t} else if (e instanceof NotFoundError) {\n\t\t\t\t// Cached assignments are likely out of date if we run into a NotFoundError here.\n\t\t\t\t// We should not attempt to re-send pings, as the relevant test has likely been deleted.\n\t\t\t\t// Hence, we just remove the cached assignment and disable the test.\n\t\t\t\ttest.active = false\n\t\t\t\tconsole.log(`Tried to send ping. Removing test '${test.testName}' from storage`, e)\n\n\t\t\t\tconst storedAssignments = await this.storage().getAssignments()\n\t\t\t\tif (storedAssignments) {\n\t\t\t\t\tawait this.storage().storeAssignments({\n\t\t\t\t\t\tupdatedAt: storedAssignments.updatedAt,\n\t\t\t\t\t\tusageModelVersion: storedAssignments.usageModelVersion,\n\t\t\t\t\t\tassignments: storedAssignments.assignments.filter((assignment) => assignment.testId !== test.testId),\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t} else if (e instanceof BadRequestError) {\n\t\t\t\ttest.active = false\n\t\t\t\tconsole.log(`Tried to send ping. Setting test '${test.testName}' inactive because it is misconfigured`, e)\n\t\t\t} else if (isOfflineError(e)) {\n\t\t\t\tconsole.log(\"Tried to send ping, but we are offline\", e)\n\t\t\t} else {\n\t\t\t\tthrow e\n\t\t\t}\n\t\t}\n\t}\n}\n"]}