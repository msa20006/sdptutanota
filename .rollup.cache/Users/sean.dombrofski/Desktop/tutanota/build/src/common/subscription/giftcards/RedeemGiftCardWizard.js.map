{"version":3,"file":"RedeemGiftCardWizard.js","sourceRoot":"","sources":["../../../../../src/common/subscription/giftcards/RedeemGiftCardWizard.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Vnode, VnodeDOM } from \"mithril\"\nimport stream from \"mithril/stream\"\nimport { mapNullable, neverNull, noOp, ofClass } from \"@tutao/tutanota-utils\"\nimport type { WizardPageAttrs, WizardPageN } from \"../../gui/base/WizardDialog.js\"\nimport { createWizardDialog, emitWizardEvent, WizardEventType, wizardPageWrapper } from \"../../gui/base/WizardDialog.js\"\nimport { LoginController } from \"../../api/main/LoginController\"\nimport type { NewAccountData } from \"../UpgradeSubscriptionWizard\"\nimport { Dialog, DialogType } from \"../../gui/base/Dialog\"\nimport { LoginForm } from \"../../../common/login/LoginForm\"\nimport { CredentialsSelector } from \"../../../common/login/CredentialsSelector\"\nimport { showProgressDialog } from \"../../gui/dialogs/ProgressDialog\"\nimport { SignupForm } from \"../SignupForm\"\nimport { UserError } from \"../../api/main/UserError\"\nimport { showUserError } from \"../../misc/ErrorHandlerImpl\"\nimport type { AccountingInfo, GiftCardRedeemGetReturn } from \"../../api/entities/sys/TypeRefs.js\"\nimport { AccountingInfoTypeRef, CustomerInfoTypeRef } from \"../../api/entities/sys/TypeRefs.js\"\nimport { locator } from \"../../api/main/CommonLocator\"\nimport { getTokenFromUrl, renderAcceptGiftCardTermsCheckbox, renderGiftCardSvg } from \"./GiftCardUtils\"\nimport { CancelledError } from \"../../api/common/error/CancelledError\"\nimport { lang } from \"../../misc/LanguageViewModel\"\nimport { getLoginErrorMessage, handleExpectedLoginError } from \"../../misc/LoginUtils\"\nimport { RecoverCodeField } from \"../../settings/login/RecoverCodeDialog.js\"\nimport { HabReminderImage } from \"../../gui/base/icons/Icons\"\nimport { PaymentMethodType, PlanType } from \"../../api/common/TutanotaConstants\"\nimport { formatPrice, getPaymentMethodName, PaymentInterval, PriceAndConfigProvider } from \"../PriceUtils\"\nimport { TextField } from \"../../gui/base/TextField.js\"\nimport { elementIdPart, isSameId } from \"../../api/common/utils/EntityUtils\"\nimport { CredentialsProvider } from \"../../misc/credentials/CredentialsProvider.js\"\nimport { SessionType } from \"../../api/common/SessionType.js\"\nimport { NotAuthorizedError, NotFoundError } from \"../../api/common/error/RestError.js\"\nimport { GiftCardFacade } from \"../../api/worker/facades/lazy/GiftCardFacade.js\"\nimport { EntityClient } from \"../../api/common/EntityClient.js\"\nimport { Country, getByAbbreviation } from \"../../api/common/CountryList.js\"\nimport { renderCountryDropdown } from \"../../gui/base/GuiUtils.js\"\nimport { UpgradePriceType } from \"../FeatureListProvider\"\nimport { SecondFactorHandler } from \"../../misc/2fa/SecondFactorHandler.js\"\nimport { LoginButton } from \"../../gui/base/buttons/LoginButton.js\"\nimport { CredentialsInfo } from \"../../native/common/generatedipc/CredentialsInfo.js\"\n\nconst enum GetCredentialsMethod {\n\tLogin,\n\tSignup,\n}\n\nclass RedeemGiftCardModel {\n\tmailAddress = \"\"\n\tnewAccountData: NewAccountData | null = null\n\tcredentialsMethod = GetCredentialsMethod.Signup\n\n\t// accountingInfo is loaded after the user logs in, before redeeming the gift card\n\taccountingInfo: AccountingInfo | null = null\n\n\tconstructor(\n\t\tprivate readonly config: {\n\t\t\tgiftCardInfo: GiftCardRedeemGetReturn\n\t\t\tkey: string\n\t\t\tpremiumPrice: number\n\t\t\tstoredCredentials: ReadonlyArray<CredentialsInfo>\n\t\t},\n\t\tprivate readonly giftCardFacade: GiftCardFacade,\n\t\tprivate readonly credentialsProvider: CredentialsProvider,\n\t\tprivate readonly secondFactorHandler: SecondFactorHandler,\n\t\tprivate readonly logins: LoginController,\n\t\tprivate readonly entityClient: EntityClient,\n\t) {}\n\n\tget giftCardInfo(): GiftCardRedeemGetReturn {\n\t\treturn this.config.giftCardInfo\n\t}\n\n\tget giftCardId(): Id {\n\t\treturn elementIdPart(this.giftCardInfo.giftCard)\n\t}\n\n\tget key(): string {\n\t\treturn this.config.key\n\t}\n\n\tget premiumPrice(): number {\n\t\treturn this.config.premiumPrice\n\t}\n\n\tget message(): string {\n\t\treturn this.config.giftCardInfo.message\n\t}\n\n\tget paymentMethod(): PaymentMethodType {\n\t\treturn (this.accountingInfo?.paymentMethod as PaymentMethodType | null) ?? PaymentMethodType.AccountBalance\n\t}\n\n\tget storedCredentials(): ReadonlyArray<CredentialsInfo> {\n\t\treturn this.config.storedCredentials\n\t}\n\n\tasync loginWithStoredCredentials(encryptedCredentials: CredentialsInfo) {\n\t\tif (this.logins.isUserLoggedIn() && isSameId(this.logins.getUserController().user._id, encryptedCredentials.userId)) {\n\t\t\t// If the user is logged in already (because they selected credentials and then went back) we dont have to do\n\t\t\t// anything, so just move on\n\t\t\tawait this.postLogin()\n\t\t} else {\n\t\t\tawait this.logins.logout(false)\n\t\t\tconst credentials = await this.credentialsProvider.getDecryptedCredentialsByUserId(encryptedCredentials.userId)\n\n\t\t\tif (credentials) {\n\t\t\t\tawait this.logins.resumeSession(credentials, null, null)\n\t\t\t\tawait this.postLogin()\n\t\t\t}\n\t\t}\n\t}\n\n\tasync loginWithFormCredentials(mailAddress: string, password: string) {\n\t\tthis.mailAddress = mailAddress\n\t\t// If they try to login with a mail address that is stored, we want to swap out the old session with a new one\n\t\tawait this.logins.logout(false)\n\t\tawait this.logins.createSession(mailAddress, password, SessionType.Temporary)\n\t\tawait this.postLogin()\n\t}\n\n\tasync handleNewSignup(newAccountData: NewAccountData | null) {\n\t\tif (newAccountData || this.newAccountData) {\n\t\t\t// if there's an existing account it means the signup form was readonly\n\t\t\t// because we came back from the next page after having already signed up\n\t\t\tif (!this.newAccountData) {\n\t\t\t\tthis.newAccountData = newAccountData\n\t\t\t}\n\n\t\t\tconst { mailAddress, password } = neverNull(newAccountData || this.newAccountData)\n\n\t\t\tthis.mailAddress = mailAddress\n\n\t\t\tawait this.logins.createSession(mailAddress, password, SessionType.Temporary)\n\t\t\tawait this.postLogin()\n\t\t}\n\t}\n\n\tasync redeemGiftCard(country: Country | null): Promise<void> {\n\t\tif (country == null) {\n\t\t\tthrow new UserError(\"invoiceCountryInfoBusiness_msg\")\n\t\t}\n\n\t\treturn this.giftCardFacade\n\t\t\t.redeemGiftCard(this.giftCardId, this.key, country?.a ?? null)\n\t\t\t.catch(\n\t\t\t\tofClass(NotFoundError, () => {\n\t\t\t\t\tthrow new UserError(\"invalidGiftCard_msg\")\n\t\t\t\t}),\n\t\t\t)\n\t\t\t.catch(\n\t\t\t\tofClass(NotAuthorizedError, (e) => {\n\t\t\t\t\tthrow new UserError(lang.makeTranslation(\"error_msg\", e.message))\n\t\t\t\t}),\n\t\t\t)\n\t}\n\n\tprivate async postLogin(): Promise<void> {\n\t\tif (!this.logins.getUserController().isGlobalAdmin()) {\n\t\t\tthrow new UserError(\"onlyAccountAdminFeature_msg\")\n\t\t}\n\n\t\tawait this.secondFactorHandler.closeWaitingForSecondFactorDialog()\n\t\tconst customer = await this.logins.getUserController().loadCustomer()\n\t\tconst customerInfo = await this.entityClient.load(CustomerInfoTypeRef, customer.customerInfo)\n\t\tthis.accountingInfo = await this.entityClient.load(AccountingInfoTypeRef, customerInfo.accountingInfo)\n\n\t\tif (PaymentMethodType.AppStore === this.accountingInfo.paymentMethod) {\n\t\t\tthrow new UserError(\"redeemGiftCardWithAppStoreSubscription_msg\")\n\t\t}\n\n\t\tif (customer.businessUse) {\n\t\t\tthrow new UserError(\"onlyPrivateAccountFeature_msg\")\n\t\t}\n\t}\n}\n\ntype GiftCardRedeemAttrs = WizardPageAttrs<RedeemGiftCardModel>\n\n/**\n * This page gives the user the option to either signup or login to an account with which to redeem their gift card.\n */\n\nclass GiftCardWelcomePage implements WizardPageN<RedeemGiftCardModel> {\n\tprivate dom!: HTMLElement\n\n\toncreate(vnodeDOM: VnodeDOM<GiftCardRedeemAttrs>) {\n\t\tthis.dom = vnodeDOM.dom as HTMLElement\n\t}\n\n\tview(vnode: Vnode<GiftCardRedeemAttrs>): Children {\n\t\tconst a = vnode.attrs\n\n\t\tconst nextPage = (method: GetCredentialsMethod) => {\n\t\t\tlocator.logins.logout(false).then(() => {\n\t\t\t\ta.data.credentialsMethod = method\n\t\t\t\temitWizardEvent(this.dom, WizardEventType.SHOW_NEXT_PAGE)\n\t\t\t})\n\t\t}\n\n\t\treturn [\n\t\t\tm(\n\t\t\t\t\".flex-center.full-width.pt-l\",\n\t\t\t\tm(\n\t\t\t\t\t\".pt-l\", // Needed to center SVG\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\twidth: \"480px\",\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\trenderGiftCardSvg(parseFloat(a.data.giftCardInfo.value), null, a.data.message),\n\t\t\t\t),\n\t\t\t),\n\t\t\tm(\n\t\t\t\t\".flex-center.full-width.pt-l\",\n\t\t\t\tm(LoginButton, {\n\t\t\t\t\tlabel: \"existingAccount_label\",\n\t\t\t\t\tclass: \"small-login-button\",\n\t\t\t\t\tonclick: () => nextPage(GetCredentialsMethod.Login),\n\t\t\t\t}),\n\t\t\t),\n\t\t\tm(\n\t\t\t\t\".flex-center.full-width.pt-l.pb\",\n\t\t\t\tm(LoginButton, {\n\t\t\t\t\tlabel: \"register_label\",\n\t\t\t\t\tclass: \"small-login-button\",\n\t\t\t\t\tonclick: () => nextPage(GetCredentialsMethod.Signup),\n\t\t\t\t}),\n\t\t\t),\n\t\t]\n\t}\n}\n\n/**\n * This page will either show a signup or login form depending on how they choose to select their credentials\n * When they go to the next page the will be logged in.\n */\n\nclass GiftCardCredentialsPage implements WizardPageN<RedeemGiftCardModel> {\n\tprivate domElement: HTMLElement | null = null\n\tprivate loginFormHelpText = lang.get(\"emptyString_msg\")\n\tprivate mailAddress = stream<string>(\"\")\n\tprivate password = stream<string>(\"\")\n\n\toncreate(vnode: VnodeDOM<GiftCardRedeemAttrs>) {\n\t\tthis.domElement = vnode.dom as HTMLElement\n\t}\n\n\tview(vnode: Vnode<GiftCardRedeemAttrs>): Children {\n\t\tconst data = vnode.attrs.data\n\n\t\tswitch (data.credentialsMethod) {\n\t\t\tcase GetCredentialsMethod.Login:\n\t\t\t\treturn this.renderLoginPage(data)\n\n\t\t\tcase GetCredentialsMethod.Signup:\n\t\t\t\treturn this.renderSignupPage(data)\n\t\t}\n\t}\n\n\tonremove() {\n\t\tthis.password(\"\")\n\t}\n\n\tprivate renderLoginPage(model: RedeemGiftCardModel): Children {\n\t\treturn [\n\t\t\tm(\n\t\t\t\t\".flex-grow.flex-center.scroll\",\n\t\t\t\tm(\".flex-grow-shrink-auto.max-width-s.pt.plr-l\", [this.renderLoginForm(model), this.renderCredentialsSelector(model)]),\n\t\t\t),\n\t\t]\n\t}\n\n\tprivate renderLoginForm(model: RedeemGiftCardModel): Children {\n\t\treturn m(LoginForm, {\n\t\t\tonSubmit: async (mailAddress, password) => {\n\t\t\t\tif (mailAddress === \"\" || password === \"\") {\n\t\t\t\t\tthis.loginFormHelpText = lang.get(\"loginFailed_msg\")\n\t\t\t\t} else {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// If they try to login with a mail address that is stored, we want to swap out the old session with a new one\n\t\t\t\t\t\tawait showProgressDialog(\"pleaseWait_msg\", model.loginWithFormCredentials(this.mailAddress(), this.password()))\n\t\t\t\t\t\temitWizardEvent(this.domElement, WizardEventType.SHOW_NEXT_PAGE)\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tif (e instanceof UserError) {\n\t\t\t\t\t\t\tshowUserError(e)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.loginFormHelpText = lang.getTranslationText(getLoginErrorMessage(e, false))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tmailAddress: this.mailAddress,\n\t\t\tpassword: this.password,\n\t\t\thelpText: this.loginFormHelpText,\n\t\t})\n\t}\n\n\tprivate renderCredentialsSelector(model: RedeemGiftCardModel): Children {\n\t\tif (model.storedCredentials.length === 0) {\n\t\t\treturn null\n\t\t}\n\n\t\treturn m(CredentialsSelector, {\n\t\t\tcredentials: model.storedCredentials,\n\t\t\tonCredentialsSelected: async (encryptedCredentials) => {\n\t\t\t\ttry {\n\t\t\t\t\tawait showProgressDialog(\"pleaseWait_msg\", model.loginWithStoredCredentials(encryptedCredentials))\n\t\t\t\t\temitWizardEvent(this.domElement, WizardEventType.SHOW_NEXT_PAGE)\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (e instanceof UserError) {\n\t\t\t\t\t\tshowUserError(e)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.loginFormHelpText = lang.getTranslationText(getLoginErrorMessage(e, false))\n\t\t\t\t\t\thandleExpectedLoginError(e, noOp)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t})\n\t}\n\n\tprivate renderSignupPage(model: RedeemGiftCardModel): Children {\n\t\treturn m(SignupForm, {\n\t\t\t// After having an account created we log them in to be in the same state as if they had selected an existing account\n\t\t\tonComplete: (newAccountData) => {\n\t\t\t\tshowProgressDialog(\n\t\t\t\t\t\"pleaseWait_msg\",\n\t\t\t\t\tmodel\n\t\t\t\t\t\t.handleNewSignup(newAccountData)\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\temitWizardEvent(this.domElement, WizardEventType.SHOW_NEXT_PAGE)\n\t\t\t\t\t\t\tm.redraw()\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((e) => {\n\t\t\t\t\t\t\t// TODO when would login fail here and how does it get handled? can we attempt to login again?\n\t\t\t\t\t\t\tDialog.message(\"giftCardLoginError_msg\")\n\t\t\t\t\t\t\tm.route.set(\"/login\", {\n\t\t\t\t\t\t\t\tnoAutoLogin: true,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}),\n\t\t\t\t)\n\t\t\t},\n\t\t\tonChangePlan: () => {\n\t\t\t\temitWizardEvent(this.domElement, WizardEventType.SHOW_PREVIOUS_PAGE)\n\t\t\t},\n\t\t\treadonly: model.newAccountData != null,\n\t\t\tprefilledMailAddress: model.newAccountData ? model.newAccountData.mailAddress : \"\",\n\t\t\tisBusinessUse: () => false,\n\t\t\tisPaidSubscription: () => true,\n\t\t\tcampaign: () => null,\n\t\t})\n\t}\n}\n\nclass RedeemGiftCardPage implements WizardPageN<RedeemGiftCardModel> {\n\tprivate confirmed = false\n\tprivate showCountryDropdown: boolean\n\tprivate country: Country | null\n\tprivate dom!: HTMLElement\n\n\tconstructor({ attrs }: Vnode<GiftCardRedeemAttrs>) {\n\t\t// we expect that the accounting info is actually available by now,\n\t\t// but we optional chain because invoiceCountry is nullable anyway\n\t\tthis.country = mapNullable(attrs.data.accountingInfo?.invoiceCountry, getByAbbreviation)\n\n\t\t// if a country is already set, then we don't need to ask for one\n\t\tthis.showCountryDropdown = this.country == null\n\t}\n\n\toncreate(vnodeDOM: VnodeDOM<GiftCardRedeemAttrs>) {\n\t\tthis.dom = vnodeDOM.dom as HTMLElement\n\t}\n\n\tview(vnode: Vnode<GiftCardRedeemAttrs>): Children {\n\t\tconst model = vnode.attrs.data\n\t\tconst isFree = locator.logins.getUserController().isFreeAccount()\n\n\t\treturn m(\"\", [\n\t\t\tmapNullable(model.newAccountData?.recoverCode, (code) =>\n\t\t\t\tm(\n\t\t\t\t\t\".pt-l.plr-l\",\n\t\t\t\t\tm(RecoverCodeField, {\n\t\t\t\t\t\tshowMessage: true,\n\t\t\t\t\t\trecoverCode: code,\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t),\n\t\t\tisFree ? this.renderInfoForFreeAccounts(model) : this.renderInfoForPaidAccounts(model),\n\t\t\tm(\n\t\t\t\t\".flex-center.full-width.pt-l\",\n\t\t\t\tm(\n\t\t\t\t\t\"\",\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tmaxWidth: \"620px\",\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t[\n\t\t\t\t\t\tthis.showCountryDropdown\n\t\t\t\t\t\t\t? renderCountryDropdown({\n\t\t\t\t\t\t\t\t\tselectedCountry: this.country,\n\t\t\t\t\t\t\t\t\tonSelectionChanged: (country) => (this.country = country),\n\t\t\t\t\t\t\t\t\thelpLabel: () => lang.get(\"invoiceCountryInfoConsumer_msg\"),\n\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\trenderAcceptGiftCardTermsCheckbox(this.confirmed, (confirmed) => (this.confirmed = confirmed)),\n\t\t\t\t\t],\n\t\t\t\t),\n\t\t\t),\n\t\t\tm(\n\t\t\t\t\".flex-center.full-width.pt-s.pb\",\n\t\t\t\tm(LoginButton, {\n\t\t\t\t\tlabel: \"redeem_label\",\n\t\t\t\t\tclass: \"small-login-button\",\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tif (!this.confirmed) {\n\t\t\t\t\t\t\tDialog.message(\"termsAcceptedNeutral_msg\")\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmodel\n\t\t\t\t\t\t\t.redeemGiftCard(this.country)\n\t\t\t\t\t\t\t.then(() => emitWizardEvent(this.dom, WizardEventType.CLOSE_DIALOG))\n\t\t\t\t\t\t\t.catch(ofClass(UserError, showUserError))\n\t\t\t\t\t\t\t.catch(ofClass(CancelledError, noOp))\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t),\n\t\t])\n\t}\n\n\tprivate getCreditOrDebitMessage(model: RedeemGiftCardModel): string {\n\t\tconst remainingAmount = Number(model.giftCardInfo.value) - model.premiumPrice\n\t\tif (remainingAmount > 0) {\n\t\t\treturn `${lang.get(\"giftCardUpgradeNotifyCredit_msg\", {\n\t\t\t\t\"{price}\": formatPrice(model.premiumPrice, true),\n\t\t\t\t\"{amount}\": formatPrice(remainingAmount, true),\n\t\t\t})} ${lang.get(\"creditUsageOptions_msg\")}`\n\t\t} else if (remainingAmount < 0) {\n\t\t\treturn lang.get(\"giftCardUpgradeNotifyDebit_msg\", {\n\t\t\t\t\"{price}\": formatPrice(model.premiumPrice, true),\n\t\t\t\t\"{amount}\": formatPrice(remainingAmount * -1, true),\n\t\t\t})\n\t\t} else {\n\t\t\treturn \"\"\n\t\t}\n\t}\n\n\tprivate renderInfoForFreeAccounts(model: RedeemGiftCardModel): Children {\n\t\treturn [\n\t\t\tm(\".pt-l.plr-l\", `${lang.get(\"giftCardUpgradeNotifyRevolutionary_msg\")} ${this.getCreditOrDebitMessage(model)}`),\n\t\t\tm(\".center.h4.pt\", lang.get(\"upgradeConfirm_msg\")),\n\t\t\tm(\".flex-space-around.flex-wrap\", [\n\t\t\t\tm(\".flex-grow-shrink-half.plr-l\", [\n\t\t\t\t\tm(TextField, {\n\t\t\t\t\t\tlabel: \"subscription_label\",\n\t\t\t\t\t\tvalue: \"Revolutionary\",\n\t\t\t\t\t\tisReadOnly: true,\n\t\t\t\t\t}),\n\t\t\t\t\tm(TextField, {\n\t\t\t\t\t\tlabel: \"paymentInterval_label\",\n\t\t\t\t\t\tvalue: lang.get(\"pricing.yearly_label\"),\n\t\t\t\t\t\tisReadOnly: true,\n\t\t\t\t\t}),\n\t\t\t\t\tm(TextField, {\n\t\t\t\t\t\tlabel: \"price_label\",\n\t\t\t\t\t\tvalue: formatPrice(Number(model.premiumPrice), true) + \" \" + lang.get(\"pricing.perYear_label\"),\n\t\t\t\t\t\tisReadOnly: true,\n\t\t\t\t\t}),\n\t\t\t\t\tm(TextField, {\n\t\t\t\t\t\tlabel: \"paymentMethod_label\",\n\t\t\t\t\t\tvalue: getPaymentMethodName(model.paymentMethod),\n\t\t\t\t\t\tisReadOnly: true,\n\t\t\t\t\t}),\n\t\t\t\t]),\n\t\t\t\tm(\n\t\t\t\t\t\".flex-grow-shrink-half.plr-l.flex-center.items-end\",\n\t\t\t\t\tm(\"img[src=\" + HabReminderImage + \"].pt.bg-white.border-radius\", {\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\twidth: \"200px\",\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t]),\n\t\t]\n\t}\n\n\tprivate renderInfoForPaidAccounts(model: RedeemGiftCardModel): Children {\n\t\treturn [\n\t\t\tm(\n\t\t\t\t\".pt-l.plr-l.flex-center\",\n\t\t\t\t`${lang.get(\"giftCardCreditNotify_msg\", {\n\t\t\t\t\t\"{credit}\": formatPrice(Number(model.giftCardInfo.value), true),\n\t\t\t\t})} ${lang.get(\"creditUsageOptions_msg\")}`,\n\t\t\t),\n\t\t\tm(\n\t\t\t\t\".flex-grow-shrink-half.plr-l.flex-center.items-end\",\n\t\t\t\tm(\"img[src=\" + HabReminderImage + \"].pt.bg-white.border-radius\", {\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\twidth: \"200px\",\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t),\n\t\t]\n\t}\n}\n\nexport async function loadRedeemGiftCardWizard(hashFromUrl: string): Promise<Dialog> {\n\tconst model = await loadModel(hashFromUrl)\n\n\tconst wizardPages = [\n\t\twizardPageWrapper(GiftCardWelcomePage, {\n\t\t\tdata: model,\n\t\t\theaderTitle: () => \"giftCard_label\",\n\t\t\tnextAction: async () => true,\n\t\t\tisSkipAvailable: () => false,\n\t\t\tisEnabled: () => true,\n\t\t}),\n\t\twizardPageWrapper(GiftCardCredentialsPage, {\n\t\t\tdata: model,\n\t\t\theaderTitle: () => (model.credentialsMethod === GetCredentialsMethod.Signup ? \"register_label\" : \"login_label\"),\n\t\t\tnextAction: async () => true,\n\t\t\tisSkipAvailable: () => false,\n\t\t\tisEnabled: () => true,\n\t\t}),\n\t\twizardPageWrapper(RedeemGiftCardPage, {\n\t\t\tdata: model,\n\t\t\theaderTitle: () => \"redeem_label\",\n\t\t\tnextAction: async () => true,\n\t\t\tisSkipAvailable: () => false,\n\t\t\tisEnabled: () => true,\n\t\t}),\n\t]\n\treturn createWizardDialog(\n\t\tmodel,\n\t\twizardPages,\n\t\tasync () => {\n\t\t\tconst urlParams = model.mailAddress ? { loginWith: model.mailAddress, noAutoLogin: true } : {}\n\t\t\tm.route.set(\"/login\", urlParams)\n\t\t},\n\t\tDialogType.EditLarge,\n\t).dialog\n}\n\nasync function loadModel(hashFromUrl: string): Promise<RedeemGiftCardModel> {\n\tconst { id, key } = await getTokenFromUrl(hashFromUrl)\n\tconst giftCardInfo = await locator.giftCardFacade.getGiftCardInfo(id, key)\n\n\tconst storedCredentials = await locator.credentialsProvider.getInternalCredentialsInfos()\n\tconst pricesDataProvider = await PriceAndConfigProvider.getInitializedInstance(null, locator.serviceExecutor, null)\n\n\treturn new RedeemGiftCardModel(\n\t\t{\n\t\t\tgiftCardInfo,\n\t\t\tkey,\n\t\t\tpremiumPrice: pricesDataProvider.getSubscriptionPrice(PaymentInterval.Yearly, PlanType.Revolutionary, UpgradePriceType.PlanActualPrice),\n\t\t\tstoredCredentials,\n\t\t},\n\t\tlocator.giftCardFacade,\n\t\tlocator.credentialsProvider,\n\t\tlocator.secondFactorHandler,\n\t\tlocator.logins,\n\t\tlocator.entityClient,\n\t)\n}\n"]}