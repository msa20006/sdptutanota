{"version":3,"file":"CustomColorEditor.js","sourceRoot":"","sources":["../../../../../src/common/settings/whitelabel/CustomColorEditor.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Child, Children, Component, Vnode, VnodeDOM } from \"mithril\"\nimport type { TextFieldAttrs } from \"../../gui/base/TextField.js\"\nimport { TextField } from \"../../gui/base/TextField.js\"\nimport stream from \"mithril/stream\"\nimport Stream from \"mithril/stream\"\nimport { DropDownSelector } from \"../../gui/base/DropDownSelector.js\"\nimport { lang } from \"../../misc/LanguageViewModel\"\nimport type { CustomColor } from \"./CustomColorsEditorViewModel\"\nimport { CustomColorsEditorViewModel } from \"./CustomColorsEditorViewModel\"\nimport { ExpanderButton, ExpanderPanel } from \"../../gui/base/Expander\"\nimport { CustomColorEditorPreview } from \"./CustomColorEditorPreview\"\nimport { downcast } from \"@tutao/tutanota-utils\"\nimport { expandHexTriplet } from \"../../gui/base/Color\"\nimport { px } from \"../../gui/size\"\nimport { BaseThemeId } from \"../../gui/theme\"\n\nexport type SimpleCustomColorEditorAttrs = {\n\tmodel: CustomColorsEditorViewModel\n}\nexport type ColorCategories = {\n\tcontent: Array<CustomColor>\n\theader: Array<CustomColor>\n\tnavigation: Array<CustomColor>\n\tother: Array<CustomColor>\n}\nexport const COLOR_PICKER_WIDTH = 400\nexport const ADVANCED_TEXTFIELD_WIDTH = 344\nexport const CATEGORY_WIDTH = 750\n\n/**\n *  Editor that simplifies the existing whitelabel editor, allowing for easy changes to accent color and base theme, also showing a preview\n */\nexport class CustomColorEditor implements Component<SimpleCustomColorEditorAttrs> {\n\tprivate _colorPickerDom: HTMLInputElement | null = null\n\tprivate readonly _advancedSettingsEnabled: Stream<boolean>\n\n\tconstructor() {\n\t\tthis._advancedSettingsEnabled = stream<boolean>(false)\n\t}\n\n\tview(vnode: Vnode<SimpleCustomColorEditorAttrs>): Children {\n\t\tconst { model } = vnode.attrs\n\t\tconst simpleColorPickerAttrs: TextFieldAttrs = {\n\t\t\tlabel: \"accentColor_label\",\n\t\t\tvalue: vnode.attrs.model.accentColor,\n\t\t\tinjectionsRight: () =>\n\t\t\t\trenderColorPicker(\n\t\t\t\t\t(inputEvent) => {\n\t\t\t\t\t\tvnode.attrs.model.changeAccentColor(downcast<HTMLInputElement>(inputEvent.target).value)\n\t\t\t\t\t\tm.redraw()\n\t\t\t\t\t},\n\t\t\t\t\tvnode.attrs.model.accentColor,\n\t\t\t\t\t({ dom }) => (this._colorPickerDom = dom as HTMLInputElement),\n\t\t\t\t),\n\t\t\tmaxWidth: COLOR_PICKER_WIDTH,\n\t\t\tisReadOnly: true,\n\t\t}\n\n\t\t/*\n\tCurrently:\n\t\tButton:\n\t\tContent:\n\t\tElevated:\n\t\tHeader:\n\t\tList:\n\t\tModal:\n\t\tNavigation:\n\t\tThen:\n\t\tContent: Content, List\n\t\tHeader: Header\n\t\tNavigation: Navigation\n\t\tOther: Button, Elevated, Modal\n\t */\n\t\treturn m(\"\", [\n\t\t\tm(\"\", [\n\t\t\t\tm(\".flex\", [\n\t\t\t\t\tm(\".flex-grow\", m(TextField, simpleColorPickerAttrs)),\n\t\t\t\t\tm(\n\t\t\t\t\t\t\".ml-s.flex-grow\",\n\t\t\t\t\t\tm(DropDownSelector, {\n\t\t\t\t\t\t\tlabel: \"baseTheme_label\",\n\t\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: lang.get(\"light_label\"),\n\t\t\t\t\t\t\t\t\tvalue: \"light\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: lang.get(\"dark_label\"),\n\t\t\t\t\t\t\t\t\tvalue: \"dark\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tselectedValue: vnode.attrs.model.baseThemeId,\n\t\t\t\t\t\t\tselectionChangedHandler: (v: BaseThemeId) => {\n\t\t\t\t\t\t\t\tvnode.attrs.model.changeBaseTheme(v)\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t]),\n\t\t\t\tm(CustomColorEditorPreview),\n\t\t\t]),\n\t\t\tm(\"\", [\n\t\t\t\tm(ExpanderButton, {\n\t\t\t\t\tlabel: \"advanced_label\",\n\t\t\t\t\texpanded: this._advancedSettingsEnabled(),\n\t\t\t\t\tonExpandedChange: this._advancedSettingsEnabled,\n\t\t\t\t}),\n\t\t\t\tm(\n\t\t\t\t\tExpanderPanel,\n\t\t\t\t\t{\n\t\t\t\t\t\texpanded: this._advancedSettingsEnabled(),\n\t\t\t\t\t},\n\t\t\t\t\t[\n\t\t\t\t\t\tm(\".small.mt\", lang.get(\"customColorsInfo_msg\")),\n\t\t\t\t\t\tm(\".flex.flex-column\", [\n\t\t\t\t\t\t\tObject.entries(this._getGroupedColors(model.customColors)).map(([name, colors]) => {\n\t\t\t\t\t\t\t\treturn m(\"\", [\n\t\t\t\t\t\t\t\t\tm(\".h4.mt-l\", capitalizeFirstLetterOfString(name)),\n\t\t\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\t\t\".editor-border.text-break.wrapping-row\",\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t\t\tmaxWidth: px(CATEGORY_WIDTH),\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t[colors.map((c) => renderCustomColorField(model, c))],\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t]),\n\t\t\t\t\t],\n\t\t\t\t),\n\t\t\t]),\n\t\t])\n\t}\n\n\t/**\n\t *\n\t */\n\t_getGroupedColors(colors: ReadonlyArray<CustomColor>): ColorCategories {\n\t\tconst groupedColors: ColorCategories = {\n\t\t\tcontent: [],\n\t\t\theader: [],\n\t\t\tnavigation: [],\n\t\t\tother: [],\n\t\t}\n\n\t\tfor (const color of colors) {\n\t\t\tif (color.name.startsWith(\"content\") || color.name.startsWith(\"list\")) {\n\t\t\t\tgroupedColors.content.push(color)\n\t\t\t} else if (color.name.startsWith(\"header\")) {\n\t\t\t\tgroupedColors.header.push(color)\n\t\t\t} else if (color.name.startsWith(\"navigation\")) {\n\t\t\t\tgroupedColors.navigation.push(color)\n\t\t\t} else {\n\t\t\t\tgroupedColors.other.push(color)\n\t\t\t}\n\t\t}\n\n\t\treturn groupedColors\n\t}\n}\n\nfunction renderCustomColorField(model: CustomColorsEditorViewModel, { name, value, defaultValue, valid }: CustomColor): Child {\n\treturn m(\n\t\t\"\",\n\t\t{\n\t\t\tstyle: {\n\t\t\t\tmaxWidth: px(ADVANCED_TEXTFIELD_WIDTH),\n\t\t\t},\n\t\t},\n\t\t[\n\t\t\tm(TextField, {\n\t\t\t\tlabel: lang.makeTranslation(name, name),\n\t\t\t\tvalue: value,\n\t\t\t\tinjectionsRight: () =>\n\t\t\t\t\trenderColorPicker((event) => model.addCustomization(name, downcast<HTMLInputElement>(event.target).value), processColorInputValue(value)),\n\t\t\t\toninput: (val) => {\n\t\t\t\t\tmodel.addCustomization(name, val)\n\t\t\t\t},\n\t\t\t}),\n\t\t\trenderDefaultColorLine(defaultValue, valid),\n\t\t],\n\t)\n}\n\nfunction renderColorPicker(onInput: (arg0: Event) => unknown, value: string, oncreate?: (vnode: VnodeDOM<void>) => void): Child {\n\treturn m(\"input.color-picker.mb-xs\", {\n\t\ttype: \"color\",\n\t\tvalue: value,\n\t\toninput: onInput,\n\t\toncreate,\n\t})\n}\n\nfunction renderDefaultColorLine(defaultColor: string, valid: boolean): Child {\n\tif (valid) {\n\t\treturn m(\".small.flex-space-between\", [\n\t\t\tm(\n\t\t\t\t\"\",\n\t\t\t\tlang.get(\"defaultColor_label\", {\n\t\t\t\t\t\"{1}\": defaultColor,\n\t\t\t\t}),\n\t\t\t),\n\t\t\tm(\"\", {\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: \"100px\",\n\t\t\t\t\theight: \"10px\",\n\t\t\t\t\t\"margin-top\": \"2px\",\n\t\t\t\t\t\"background-color\": defaultColor,\n\t\t\t\t},\n\t\t\t}),\n\t\t])\n\t} else {\n\t\treturn m(\".small\", lang.get(\"invalidInputFormat_msg\"))\n\t}\n}\n\n/**\n * If the provided value is a 3-digit hex string, it expands it to a 6-digit one (#RGB #RRGGBB)\n * Otherwise, it returns the provided value\n */\nfunction processColorInputValue(value: string) {\n\tconst isHexTriplet = /^#[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F]$/.test(value)\n\n\tif (isHexTriplet) {\n\t\tconst withoutHash = value.slice(1)\n\t\treturn \"#\" + expandHexTriplet(withoutHash)\n\t} else {\n\t\treturn value\n\t}\n}\n\nfunction capitalizeFirstLetterOfString(string: string): string {\n\treturn string.charAt(0).toUpperCase() + string.slice(1)\n}\n"]}