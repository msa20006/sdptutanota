{"version":3,"file":"sys-v90.js","sourceRoot":"","sources":["../../../../../../../src/common/api/worker/offline/migrations/sys-v90.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,kBAAkB,EAAE,sBAAsB,EAAE,MAAM,0BAA0B,CAAA;AACrF,OAAO,EAAgB,mBAAmB,EAAQ,WAAW,EAAE,MAAM,mCAAmC,CAAA;AACxG,OAAO,EAAE,OAAO,EAAE,MAAM,sCAAsC,CAAA;AAE9D,MAAM,CAAC,MAAM,KAAK,GAAqB;IACtC,GAAG,EAAE,KAAK;IACV,OAAO,EAAE,EAAE;IACX,KAAK,CAAC,OAAO,CAAC,OAAuB;QACpC,iGAAiG;QACjG,4EAA4E;QAC5E,MAAM,sBAAsB,CAAC,mBAAmB,EAAE,OAAO,EAAE;YAC1D,CAAC,eAA6B,EAAE,EAAE;gBACjC,IAAI,eAAe,CAAC,UAAU,EAAE,CAAC;oBAChC,eAAe,CAAC,UAAU,CAAC,WAAW,GAAG,KAAK,CAAA;gBAC/C,CAAC;gBACD,OAAO,eAAe,CAAA;YACvB,CAAC;SACD,CAAC,CAAA;QAEF,6CAA6C;QAC7C,MAAM,kBAAkB,CAAC,WAAW,EAAE,OAAO,EAAE;YAC9C,CAAC,IAAU,EAAE,EAAE;gBACd,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC;oBACtB,IAAI,CAAC,UAAU,GAAG,OAAO,CAAC,MAAM,CAAA;gBACjC,CAAC;gBACD,OAAO,IAAI,CAAA;YACZ,CAAC;SACD,CAAC,CAAA;IACH,CAAC;CACD,CAAA","sourcesContent":["import { OfflineMigration } from \"../OfflineStorageMigrator.js\"\nimport { OfflineStorage } from \"../OfflineStorage.js\"\nimport { migrateAllElements, migrateAllListElements } from \"../StandardMigrations.js\"\nimport { CustomerInfo, CustomerInfoTypeRef, User, UserTypeRef } from \"../../../entities/sys/TypeRefs.js\"\nimport { KdfType } from \"../../../common/TutanotaConstants.js\"\n\nexport const sys90: OfflineMigration = {\n\tapp: \"sys\",\n\tversion: 90,\n\tasync migrate(storage: OfflineStorage) {\n\t\t// we've added a new field to PlanConfig and we want to make sure that it's correct in the future\n\t\t// anyone who has a custom plan at the moment does not have the contact list\n\t\tawait migrateAllListElements(CustomerInfoTypeRef, storage, [\n\t\t\t(oldCustomerInfo: CustomerInfo) => {\n\t\t\t\tif (oldCustomerInfo.customPlan) {\n\t\t\t\t\toldCustomerInfo.customPlan.contactList = false\n\t\t\t\t}\n\t\t\t\treturn oldCustomerInfo\n\t\t\t},\n\t\t])\n\n\t\t// we forgot to include this in v89 migration\n\t\tawait migrateAllElements(UserTypeRef, storage, [\n\t\t\t(user: User) => {\n\t\t\t\tif (!user.kdfVersion) {\n\t\t\t\t\tuser.kdfVersion = KdfType.Bcrypt\n\t\t\t\t}\n\t\t\t\treturn user\n\t\t\t},\n\t\t])\n\t},\n}\n"]}