{"version":3,"file":"TermsAndConditions.js","sourceRoot":"","sources":["../../../../src/common/subscription/TermsAndConditions.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * The most recently published version of the terms and conditions\n */\nimport m, { Children } from \"mithril\"\nimport { InfoLink, lang } from \"../misc/LanguageViewModel\"\nimport { isApp } from \"../api/common/Env\"\nimport { requestFromWebsite } from \"../misc/Website\"\nimport { Dialog } from \"../gui/base/Dialog\"\nimport { htmlSanitizer } from \"../misc/HtmlSanitizer\"\nimport { DialogHeaderBarAttrs } from \"../gui/base/DialogHeaderBar\"\nimport { ButtonType } from \"../gui/base/Button.js\"\nimport { locator } from \"../api/main/CommonLocator.js\"\n\n/**\n * The most up-to-date versions of the terms and conditions, privacy statement, and gift card terms\n * must be in sync with the website\n */\nexport const CURRENT_TERMS_VERSION = \"3.2\" as const\nexport const CURRENT_PRIVACY_VERSION = \"3.1\" as const\nexport const CURRENT_GIFT_CARD_TERMS_VERSION = \"1.0\" as const\n\n/**\n * Show a link to the terms and conditions page on the website.\n * In the mobile apps, it will instead open a dialog containing the text\n */\nexport function renderTermsAndConditionsButton(terms: TermsSection, version: string): Children {\n\tlet label\n\tlet link\n\tswitch (terms) {\n\t\tcase TermsSection.GiftCards:\n\t\t\tlabel = lang.get(\"giftCardTerms_label\")\n\t\t\tlink = InfoLink.GiftCardsTerms\n\t\t\tbreak\n\t\tcase TermsSection.Terms:\n\t\t\tlabel = lang.get(\"termsAndConditionsLink_label\")\n\t\t\tlink = InfoLink.Terms\n\t\t\tbreak\n\t\tcase TermsSection.Privacy:\n\t\t\tlabel = lang.get(\"privacyLink_label\")\n\t\t\tlink = InfoLink.Privacy\n\t\t\tbreak\n\t}\n\treturn m(\n\t\t`a[href=${link}][target=_blank]`,\n\t\t{\n\t\t\tonclick: (e: MouseEvent) => {\n\t\t\t\tif (isApp()) {\n\t\t\t\t\tshowServiceTerms(terms, version)\n\t\t\t\t\te.preventDefault()\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\tlabel,\n\t)\n}\n\n/**\n * An enum denoting a section of the tutanota terms to request.\n * The value of the enum is the path that is used in the request to the website\n */\nexport const enum TermsSection {\n\tTerms = \"terms-entries\",\n\tPrivacy = \"privacy-policy-entries\",\n\tGiftCards = \"giftCardsTerms-entries\",\n}\n\nexport async function showServiceTerms(section: TermsSection, version: string) {\n\tconst path = `/${section}/${version}.json`\n\tconst termsFromWebsite = await requestFromWebsite(path, locator.domainConfigProvider().getCurrentDomainConfig()).then((res) => res.json())\n\tlet visibleLang: \"en\" | \"de\" = lang.code.startsWith(\"de\") ? \"de\" : \"en\"\n\tlet dialog: Dialog\n\tlet sanitizedTerms: string\n\n\tfunction getSection(): string {\n\t\treturn htmlSanitizer.sanitizeHTML(termsFromWebsite[visibleLang], {\n\t\t\tblockExternalContent: false,\n\t\t}).html\n\t}\n\n\tlet headerBarAttrs: DialogHeaderBarAttrs = {\n\t\tleft: [\n\t\t\t{\n\t\t\t\tlabel: lang.makeTranslation(\"lang_toggle\", \"EN/DE\"),\n\t\t\t\tclick: () => {\n\t\t\t\t\tvisibleLang = visibleLang === \"de\" ? \"en\" : \"de\"\n\t\t\t\t\tsanitizedTerms = getSection()\n\t\t\t\t\tm.redraw()\n\t\t\t\t},\n\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t},\n\t\t],\n\t\tright: [\n\t\t\t{\n\t\t\t\tlabel: \"ok_action\",\n\t\t\t\tclick: () => dialog.close(),\n\t\t\t\ttype: ButtonType.Primary,\n\t\t\t},\n\t\t],\n\t}\n\tsanitizedTerms = getSection()\n\tdialog = Dialog.largeDialog(headerBarAttrs, {\n\t\tview: () => m(\".text-break\", m.trust(sanitizedTerms)),\n\t}).show()\n}\n"]}