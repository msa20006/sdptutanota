{"version":3,"file":"BubbleTextField.js","sourceRoot":"","sources":["../../../../../src/common/gui/base/BubbleTextField.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, ClassComponent, Vnode } from \"mithril\"\nimport { Autocomplete, TextField, TextFieldType } from \"./TextField.js\"\nimport { Translation, MaybeTranslation } from \"../../misc/LanguageViewModel\"\nimport { Keys } from \"../../api/common/TutanotaConstants\"\nimport { createAsyncDropdown, DropdownChildAttrs } from \"./Dropdown.js\"\nimport { lazy } from \"@tutao/tutanota-utils\"\nimport { BaseButton } from \"./buttons/BaseButton.js\"\n\nexport interface BubbleTextFieldAttrs {\n\tlabel: MaybeTranslation\n\titems: Array<string>\n\trenderBubbleText: (item: string) => Translation\n\tgetBubbleDropdownAttrs: (item: string) => Promise<DropdownChildAttrs[]>\n\ttext: string\n\tonInput: (text: string) => void\n\tonBackspace: () => boolean\n\tonEnterKey: () => boolean\n\tonUpKey: () => boolean\n\tonDownKey: () => boolean\n\tdisabled: boolean\n\tinjectionsRight?: Children | null\n\tonFocus: () => void\n\tonBlur: () => void\n\thelpLabel?: lazy<Children> | null\n}\n\nexport class BubbleTextField implements ClassComponent<BubbleTextFieldAttrs> {\n\tprivate active: boolean = false\n\tprivate domInput: HTMLInputElement | null = null\n\n\tview({ attrs }: Vnode<BubbleTextFieldAttrs>) {\n\t\treturn m(\".bubble-text-field\", [\n\t\t\tm(TextField, {\n\t\t\t\tlabel: attrs.label,\n\t\t\t\tdisabled: attrs.disabled,\n\t\t\t\tvalue: attrs.text,\n\t\t\t\toninput: attrs.onInput,\n\t\t\t\thelpLabel: attrs.helpLabel,\n\t\t\t\ttype: TextFieldType.Email,\n\t\t\t\tautocompleteAs: Autocomplete.off,\n\t\t\t\tinjectionsLeft: () => {\n\t\t\t\t\treturn attrs.items.map((item, idx, items) => {\n\t\t\t\t\t\t// We need overflow: hidden on both so that ellipsis on button works.\n\t\t\t\t\t\t// flex is for reserving space for the comma. align-items: end so that comma is pushed to the bottom.\n\t\t\t\t\t\tconst bubbleText = attrs.renderBubbleText(item)\n\t\t\t\t\t\treturn m(\".flex.overflow-hidden.items-end\", [\n\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\".flex-no-grow-shrink-auto.overflow-hidden\",\n\t\t\t\t\t\t\t\tm(BaseButton, {\n\t\t\t\t\t\t\t\t\tlabel: bubbleText,\n\t\t\t\t\t\t\t\t\ttext: bubbleText.text,\n\t\t\t\t\t\t\t\t\tclass: \"text-bubble button-content content-fg text-ellipsis flash\",\n\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t\"max-width\": \"100%\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tonclick: (e: MouseEvent) => {\n\t\t\t\t\t\t\t\t\t\te.stopPropagation() // do not focus the text field\n\t\t\t\t\t\t\t\t\t\tcreateAsyncDropdown({\n\t\t\t\t\t\t\t\t\t\t\tlazyButtons: () => attrs.getBubbleDropdownAttrs(item),\n\t\t\t\t\t\t\t\t\t\t\twidth: 250,\n\t\t\t\t\t\t\t\t\t\t})(e, e.target as HTMLElement)\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t// Comma is shown when there's text/another bubble afterwards or if the field is active\n\t\t\t\t\t\t\tthis.active || idx < items.length - 1 || attrs.text !== \"\" ? m(\"span.pr\", \",\") : null,\n\t\t\t\t\t\t])\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tinjectionsRight: () => attrs.injectionsRight ?? null,\n\t\t\t\toncreate: () => {\n\t\t\t\t\t// If the field is initialized with bubbles but the user did not edit it yet then field will not have correct size\n\t\t\t\t\t// and last bubble will not be on the same line with right injections (like \"show\" button). It is fixed after user\n\t\t\t\t\t// edits the field and autocompletion changes the field but before that it's broken. To avoid it we set the size\n\t\t\t\t\t// manually.\n\t\t\t\t\t//\n\t\t\t\t\t// This oncreate is run before the dom input's oncreate is run and sets the field so we have to access input on the\n\t\t\t\t\t// next frame. There's no other callback to use without requesting redraw.\n\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\tif (this.domInput) this.domInput.size = 1\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tonDomInputCreated: (dom) => (this.domInput = dom),\n\t\t\t\tonfocus: () => {\n\t\t\t\t\tthis.active = true\n\t\t\t\t\tattrs.onFocus()\n\t\t\t\t},\n\t\t\t\tonblur: () => {\n\t\t\t\t\tthis.active = false\n\t\t\t\t\tattrs.onBlur()\n\t\t\t\t},\n\t\t\t\tkeyHandler: (key) => {\n\t\t\t\t\tif (key.key != null) {\n\t\t\t\t\t\tswitch (key.key.toLowerCase()) {\n\t\t\t\t\t\t\tcase Keys.BACKSPACE.code:\n\t\t\t\t\t\t\t\treturn attrs.onBackspace()\n\n\t\t\t\t\t\t\tcase Keys.RETURN.code:\n\t\t\t\t\t\t\t\treturn attrs.onEnterKey()\n\n\t\t\t\t\t\t\tcase Keys.DOWN.code:\n\t\t\t\t\t\t\t\treturn attrs.onUpKey()\n\n\t\t\t\t\t\t\tcase Keys.UP.code:\n\t\t\t\t\t\t\t\treturn attrs.onDownKey()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn true\n\t\t\t\t},\n\t\t\t}),\n\t\t])\n\t}\n}\n"]}