{"version":3,"file":"sys-v102.js","sourceRoot":"","sources":["../../../../../../../src/common/api/worker/offline/migrations/sys-v102.ts"],"names":[],"mappings":"AAGA,OAAO,EAAE,qBAAqB,EAAE,MAAM,0BAA0B,CAAA;AAChE,OAAO,EAAE,YAAY,EAAE,oBAAoB,EAAE,WAAW,EAAE,MAAM,mCAAmC,CAAA;AAEnG,MAAM,CAAC,MAAM,MAAM,GAAqB;IACvC,GAAG,EAAE,KAAK;IACV,OAAO,EAAE,GAAG;IACZ,KAAK,CAAC,OAAO,CAAC,OAAuB,EAAE,eAAgC;QACtE,MAAM,qBAAqB,CAAC,OAAO,EAAE,oBAAoB,CAAC,CAAA,CAAC,sCAAsC;QACjG,MAAM,qBAAqB,CAAC,OAAO,EAAE,YAAY,CAAC,CAAA,CAAC,yCAAyC;QAC5F,yIAAyI;QACzI,MAAM,qBAAqB,CAAC,OAAO,EAAE,WAAW,CAAC,CAAA;IAClD,CAAC;CACD,CAAA","sourcesContent":["import { OfflineMigration } from \"../OfflineStorageMigrator.js\"\nimport { OfflineStorage } from \"../OfflineStorage.js\"\nimport { SqlCipherFacade } from \"../../../../native/common/generatedipc/SqlCipherFacade.js\"\nimport { deleteInstancesOfType } from \"../StandardMigrations.js\"\nimport { GroupTypeRef, UserGroupRootTypeRef, UserTypeRef } from \"../../../entities/sys/TypeRefs.js\"\n\nexport const sys102: OfflineMigration = {\n\tapp: \"sys\",\n\tversion: 102,\n\tasync migrate(storage: OfflineStorage, sqlCipherFacade: SqlCipherFacade) {\n\t\tawait deleteInstancesOfType(storage, UserGroupRootTypeRef) // to ensure keyRotations is populated\n\t\tawait deleteInstancesOfType(storage, GroupTypeRef) // to ensure formerGroupKeys is populated\n\t\t// We also delete UserType ref to disable offline login. Otherwise, clients will see an unexpected error message with pure offline login.\n\t\tawait deleteInstancesOfType(storage, UserTypeRef)\n\t},\n}\n"]}