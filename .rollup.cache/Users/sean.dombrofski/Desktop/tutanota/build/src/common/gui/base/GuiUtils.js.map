{"version":3,"file":"GuiUtils.js","sourceRoot":"","sources":["../../../../../src/common/gui/base/GuiUtils.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Country } from \"../../api/common/CountryList\"\nimport { Countries } from \"../../api/common/CountryList\"\nimport type { InfoLink, TranslationKey, MaybeTranslation } from \"../../misc/LanguageViewModel\"\nimport { lang } from \"../../misc/LanguageViewModel\"\nimport { ButtonColor } from \"./Button.js\"\nimport { Icons } from \"./icons/Icons\"\nimport type { DropdownChildAttrs } from \"./Dropdown.js\"\nimport { createAsyncDropdown } from \"./Dropdown.js\"\nimport type { $Promisable, lazy, MaybeLazy } from \"@tutao/tutanota-utils\"\nimport { assertNotNull, lazyMemoized, resolveMaybeLazy } from \"@tutao/tutanota-utils\"\nimport { Dialog } from \"./Dialog\"\nimport { ProgrammingError } from \"../../api/common/error/ProgrammingError\"\nimport m, { Children } from \"mithril\"\nimport { DropDownSelector } from \"./DropDownSelector.js\"\nimport { IconButtonAttrs } from \"./IconButton.js\"\nimport { LoginController } from \"../../api/main/LoginController.js\"\nimport { client } from \"../../misc/ClientDetector.js\"\nimport type { Contact } from \"../../api/entities/tutanota/TypeRefs.js\"\nimport { isColorLight } from \"./Color.js\"\n\nexport const enum DropType {\n\tExternalFile = \"ExternalFile\",\n\tMail = \"Mail\",\n}\n\nexport type MailDropData = {\n\tdropType: DropType.Mail\n\tmailId: string\n}\nexport type FileDropData = {\n\tdropType: DropType.ExternalFile\n\tfiles: Array<File>\n}\n\nexport type DropData = FileDropData | MailDropData\n\nexport type DropHandler = (dropData: DropData) => void\n// not all browsers have the actual button as e.currentTarget, but all of them send it as a second argument (see https://github.com/tutao/tutanota/issues/1110)\nexport type ClickHandler = (event: MouseEvent, dom: HTMLElement) => void\n\n// lazy because of global dependencies\nconst dropdownCountries = lazyMemoized(() => Countries.map((c) => ({ value: c, name: c.n })))\n\nexport function renderCountryDropdown(params: {\n\tselectedCountry: Country | null\n\tonSelectionChanged: (country: Country) => void\n\thelpLabel?: lazy<string>\n\tlabel?: MaybeTranslation\n}): Children {\n\treturn m(DropDownSelector, {\n\t\tlabel: params.label ?? \"invoiceCountry_label\",\n\t\thelpLabel: params.helpLabel,\n\t\titems: [\n\t\t\t...dropdownCountries(),\n\t\t\t{\n\t\t\t\tvalue: null,\n\t\t\t\tname: lang.get(\"choose_label\"),\n\t\t\t},\n\t\t],\n\t\tselectedValue: params.selectedCountry,\n\t\tselectionChangedHandler: params.onSelectionChanged,\n\t})\n}\n\nexport function createMoreActionButtonAttrs(\n\tlazyChildren: MaybeLazy<$Promisable<ReadonlyArray<DropdownChildAttrs | null>>>,\n\tdropdownWidth?: number,\n): IconButtonAttrs {\n\treturn {\n\t\ttitle: \"more_label\",\n\t\tcolors: ButtonColor.Nav,\n\t\ticon: Icons.More,\n\t\tclick: createAsyncDropdown({\n\t\t\twidth: dropdownWidth,\n\t\t\tlazyButtons: async () => resolveMaybeLazy(lazyChildren),\n\t\t}),\n\t}\n}\n\ntype Confirmation = {\n\tconfirmed: (_: () => unknown) => Confirmation\n\tcancelled: (_: () => unknown) => Confirmation\n\tresult: Promise<boolean>\n}\n\n/**\n * Wrapper around Dialog.confirm\n *\n * call getConfirmation(...).confirmed(() => doStuff()) or getConfirmation(...).cancelled(() => doStuff())\n * to handle confirmation or termination\n * @param message\n * @param confirmMessage\n * @returns {Confirmation}\n */\nexport function getConfirmation(message: MaybeTranslation, confirmMessage: TranslationKey = \"ok_action\"): Confirmation {\n\tconst confirmationPromise = Dialog.confirm(message, confirmMessage)\n\tconst confirmation: Confirmation = {\n\t\tconfirmed(action) {\n\t\t\tconfirmationPromise.then((ok) => {\n\t\t\t\tif (ok) {\n\t\t\t\t\taction()\n\t\t\t\t}\n\t\t\t})\n\t\t\treturn confirmation\n\t\t},\n\n\t\tcancelled(action) {\n\t\t\tconfirmationPromise.then((ok) => {\n\t\t\t\tif (!ok) {\n\t\t\t\t\taction()\n\t\t\t\t}\n\t\t\t})\n\t\t\treturn confirmation\n\t\t},\n\n\t\tresult: confirmationPromise,\n\t}\n\treturn confirmation\n}\n\n/**\n * Get either the coord of a mouseevent or the coord of the first touch of a touch event\n * @param event\n * @returns {{x: number, y: number}}\n */\nexport function getCoordsOfMouseOrTouchEvent(event: MouseEvent | TouchEvent): {\n\tx: number\n\ty: number\n} {\n\treturn event instanceof MouseEvent\n\t\t? {\n\t\t\t\tx: event.clientX,\n\t\t\t\ty: event.clientY,\n\t\t  }\n\t\t: {\n\t\t\t\t// Why would touches be empty?\n\t\t\t\tx: assertNotNull(event.touches.item(0)).clientX,\n\t\t\t\ty: assertNotNull(event.touches.item(0)).clientY,\n\t\t  }\n}\n\nexport function makeListSelectionChangedScrollHandler(scrollDom: HTMLElement, entryHeight: number, getSelectedEntryIndex: lazy<number>): () => void {\n\treturn function () {\n\t\tscrollListDom(scrollDom, entryHeight, getSelectedEntryIndex())\n\t}\n}\n\nexport function scrollListDom(scrollDom: HTMLElement, entryHeight: number, selectedIndex: number) {\n\tconst scrollWindowHeight = scrollDom.getBoundingClientRect().height\n\tconst scrollOffset = scrollDom.scrollTop\n\t// Actual position in the list\n\tconst selectedTop = entryHeight * selectedIndex\n\tconst selectedBottom = selectedTop + entryHeight\n\t// Relative to the top of the scroll window\n\tconst selectedRelativeTop = selectedTop - scrollOffset\n\tconst selectedRelativeBottom = selectedBottom - scrollOffset\n\n\t// clamp the selected item to stay between the top and bottom of the scroll window\n\tif (selectedRelativeTop < 0) {\n\t\tscrollDom.scrollTop = selectedTop\n\t} else if (selectedRelativeBottom > scrollWindowHeight) {\n\t\tscrollDom.scrollTop = selectedBottom - scrollWindowHeight\n\t}\n}\n\n/**\n * Executes the passed function if the user is allowed to see `tuta.com` links.\n * @param logins LoginController to ask about login information\n * @param linkId\n * @param render receives the resolved link\n * @returns {Children|null}\n */\nexport function ifAllowedTutaLinks(logins: LoginController, linkId: InfoLink, render: (linkId: InfoLink) => Children): Children | null {\n\t// this is currently in gui-base, preventing us from accessing logins ourselves.\n\t// may be subject to change\n\tif (canSeeTutaLinks(logins)) {\n\t\treturn render(linkId)\n\t}\n\treturn null\n}\n\n/**\n * Check if the user is allowed to see `tutanota.com` links or other major references to Tutanota.\n *\n * If the user is on whitelabel and they are not global admin, information like this should not be shown.\n * @param logins LoginController to ask about login information\n * @returns true if the user should see tutanota links or false if they should not\n */\nexport function canSeeTutaLinks(logins: LoginController): boolean {\n\treturn !logins.isWhitelabel() || logins.getUserController().isGlobalAdmin()\n}\n\nexport type MousePosAndBounds = {\n\tx: number\n\ty: number\n\ttargetWidth: number\n\ttargetHeight: number\n}\n\n/**\n * Get the mouse's x and y coordinates relative to the target, and the width and height of the target.\n * The currentTarget must be a HTMLElement or this throws an error\n * @param mouseEvent\n */\nexport function getPosAndBoundsFromMouseEvent({ currentTarget, x, y }: MouseEvent): MousePosAndBounds {\n\tif (currentTarget instanceof HTMLElement) {\n\t\tconst { height, width, left, top } = currentTarget.getBoundingClientRect()\n\t\treturn {\n\t\t\ttargetHeight: height,\n\t\t\ttargetWidth: width,\n\t\t\tx: x - left,\n\t\t\ty: y - top,\n\t\t}\n\t} else {\n\t\tthrow new ProgrammingError(\"Target is not a HTMLElement\")\n\t}\n}\n\n/** render two children either next to each other (on desktop devices) or above each other (mobile) */\nexport function renderTwoColumnsIfFits(left: Children, right: Children): Children {\n\tif (client.isMobileDevice()) {\n\t\treturn m(\".flex.col\", [m(\".flex\", left), m(\".flex\", right)])\n\t} else {\n\t\treturn m(\".flex\", [m(\".flex.flex-half.pr-s\", left), m(\".flex.flex-half.pl-s\", right)])\n\t}\n}\n\n/** Encode a SVG element into a CSS readable string */\nexport function encodeSVG(svg: string): string {\n\treturn (\n\t\t\"data:image/svg+xml;utf8,\" +\n\t\tsvg\n\t\t\t// the svg data string must contain ' instead of \" to avoid display errors in Edge (probably not relevant anymore but better be safe)\n\t\t\t.replace(/\"/g, \"'\")\n\t\t\t// '#' character is reserved in URL and FF won't display SVG otherwise\n\t\t\t.replace(/#/g, \"%23\")\n\t\t\t/// fold consecutive whitespace into a single one (useful for tests)\n\t\t\t.replace(/\\s+/g, \" \")\n\t)\n}\n\n// Returns the disabled style CSS classes seperated by spaces if `isDisabled` is true. A value of `null` or `undefined` is treated as `false`.\nexport function getOperatingClasses(isDisabled: boolean | null | undefined, cursorClass?: string): string {\n\tconst cursorClassOrDefault = cursorClass ? cursorClass : \"\"\n\treturn isDisabled ? \"disabled click-disabled\" : cursorClassOrDefault\n}\n\n/* Returns whether the change in a scroll position should be animated */\nexport function getIfLargeScroll(oldPosition: number | null, newPosition: number | null): boolean {\n\tif (oldPosition === null || newPosition === null) return false\n\tconst difference = Math.abs(oldPosition - newPosition)\n\treturn difference > 10\n}\n\nexport function getContactTitle(contact: Contact) {\n\tconst title = contact.title ? `${contact.title} ` : \"\"\n\tconst middleName = contact.middleName != null ? ` ${contact.middleName} ` : \" \"\n\tconst fullName = `${contact.firstName}${middleName}${contact.lastName} `\n\tconst suffix = contact.nameSuffix ?? \"\"\n\treturn (title + fullName + suffix).trim()\n}\n\nexport function colorForBg(color: string): string {\n\treturn isColorLight(color) ? \"black\" : \"white\"\n}\n"]}