{"version":3,"file":"ClientDetector.js","sourceRoot":"","sources":["../../../../src/common/misc/ClientDetector.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,oBAAoB,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,mBAAmB,CAAA;AACrE,OAAO,EAAE,OAAO,EAAwC,MAAM,mBAAmB,CAAA;AAEjF,oBAAoB,EAAE,CAAA;AAEtB,MAAM,OAAO,cAAc;IAC1B,SAAS,CAAS;IAClB,OAAO,CAAc;IACrB,cAAc,CAAS;IACvB,MAAM,CAAa;IACnB,YAAY,CAAS;IACrB,OAAO,CAAU;IACjB,OAAO,CAAU;IAEjB,gBAAe,CAAC;IAEhB,IAAI,CAAC,SAAiB,EAAE,QAAgB,EAAE,UAAmB,OAAO,CAAC,UAAU;QAC9E,IAAI,CAAC,SAAS,GAAG,SAAS,CAAA;QAC1B,IAAI,CAAC,OAAO,kCAAoB,CAAA;QAChC,IAAI,CAAC,cAAc,GAAG,CAAC,CAAA;QACvB,IAAI,CAAC,MAAM,qCAAqB,CAAA;QAChC,IAAI,CAAC,OAAO,GAAG,OAAO,CAAA;QAEtB,IAAI,CAAC,qBAAqB,EAAE,CAAA;QAE5B,IAAI,CAAC,cAAc,EAAE,CAAA;QAErB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,yBAAyB,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,MAAM,CAAA;QAC9F,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAA;IAC9C,CAAC;IAED;;OAEG;IACH,YAAY;QACX,gEAAgE;QAChE,IAAI,CAAC;YACJ,MAAM,aAAa,GAAG,GAAG,EAAE;gBAC1B,OAAO,CAAC,CAAA;YACT,CAAC,CAAA;YAED,IAAI,IAAI,GAAG,CAAC,CAAA;YAEZ,QAAQ,CAAC,CAAC,aAAa,KAAI,CAAC;YAE5B,KAAK,UAAU,SAAS,KAAI,CAAC;YAE7B,SAAS,eAAe,CAAC,CAAC,GAAG,CAAC,IAAG,CAAC;YAElC,aAAa,EAAE,CAAA;YACf,SAAS,EAAE,CAAA;YACX,eAAe,EAAE,CAAA;YACjB,MAAM,OAAO,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAA;YACzB,MAAM,WAAW,GAAG,CAAC,GAAG,OAAO,CAAC,CAAA;YAChC,MAAM,aAAa,GAAG,EAAE,CAAA;YACxB,MAAM,mBAAmB,GAAG,aAAa,EAAE,KAAK,IAAI,CAAA;YAEpD,IAAI,mBAAmB,EAAE,CAAC;gBACzB,MAAM,CAAC,aAAa,CAAC,CAAA;YACtB,CAAC;YAED,MAAM,YAAY,GAAG;gBACpB,CAAC,aAAa,CAAC,EAAE,IAAI;gBAErB,MAAM,KAAI,CAAC;gBAEX,IAAI,QAAQ;oBACX,OAAO,IAAI,CAAA;gBACZ,CAAC;gBAED,IAAI,QAAQ,CAAC,QAAQ,IAAG,CAAC;aACzB,CAAA;YACD,MAAM,cAAc,GAAG,QAAQ,aAAa,EAAE,CAAA;YAC9C,MAAM,CAAC,GAAG,CAAC,CAAA;YACX,MAAM,CAAC,GAAG,CAAC,CAAA;YACX,MAAM,iBAAiB,GAAG;gBACzB,CAAC;gBACD,CAAC;aACD,CAAA;YACD,MAAM,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,GAAG,iBAAiB,CAAA;YAC1C,MAAM,CAAC,EAAE,EAAE,EAAE,EAAE,GAAG,KAAK,CAAC,GAAG,OAAO,CAAA;YAElC,MAAM,gBAAgB;gBACrB,MAAM,CAAC,QAAQ,KAAI,CAAC;aACpB;YAED,KAAK,MAAM,IAAI,IAAI,aAAa,EAAE,EAAE,CAAC;gBACpC,WAAW;YACZ,CAAC;QACF,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACZ,WAAW;QACZ,CAAC;IACF,CAAC;IAED,YAAY;QACX,OAAO,CACN,OAAO,GAAG,KAAK,WAAW;YAC1B,OAAO,GAAG,KAAK,WAAW;YAC1B,OAAO,KAAK,CAAC,SAAS,CAAC,QAAQ,KAAK,UAAU;YAC9C,OAAO,MAAM,CAAC,OAAO,KAAK,UAAU;YACpC,OAAO,MAAM,CAAC,MAAM,KAAK,UAAU;YACnC,OAAO,MAAM,CAAC,WAAW,KAAK,UAAU;YACxC,OAAO,MAAM,KAAK,WAAW;YAC7B,OAAO,UAAU,KAAK,WAAW;YACjC,OAAO,KAAK,KAAK,WAAW;YAC5B,OAAO,OAAO,KAAK,WAAW;YAC9B,OAAO,OAAO,CAAC,SAAS,CAAC,OAAO,KAAK,WAAW;YAChD,OAAO,MAAM,CAAC,SAAS,CAAC,UAAU,KAAK,UAAU;YACjD,OAAO,MAAM,KAAK,WAAW,CAC7B,CAAA;IACF,CAAC;IAED,OAAO;QACN,IAAI,CAAC;YACJ,QAAQ,CAAC,aAAa,CAAC,uCAAuC,CAAC,CAAA;YAC/D,QAAQ,CAAC,gBAAgB,CAAC,oBAAoB,CAAC,CAAA;YAC/C,OAAO,IAAI,CAAA;QACZ,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACZ,OAAO,KAAK,CAAA;QACb,CAAC;IACF,CAAC;IAED;;OAEG;IACH,WAAW;QACV,IAAI,CAAC,YAAY,EAAE,CAAA;QACnB,OAAO,IAAI,CAAC,yBAAyB,EAAE,IAAI,IAAI,CAAC,YAAY,EAAE,IAAI,IAAI,CAAC,UAAU,EAAE,IAAI,IAAI,CAAC,OAAO,EAAE,CAAA;IACtG,CAAC;IAED,cAAc;QACb,OAAO,IAAI,CAAC,MAAM,uCAAuB,CAAA;IAC1C,CAAC;IAED,eAAe;QACd,OAAO,IAAI,CAAC,MAAM,uCAAuB,CAAA;IAC1C,CAAC;IAED;;OAEG;IACH,UAAU;QACT,OAAO,WAAW,IAAI,MAAM,IAAI,MAAM,CAAC,SAAS,CAAC,OAAO,KAAK,CAAC,CAAA;IAC/D,CAAC;IAED,YAAY;QACX,IAAI,CAAC;YACJ,OAAO,YAAY,IAAI,IAAI,CAAA;QAC5B,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACZ,qDAAqD;YACrD,OAAO,KAAK,CAAA;QACb,CAAC;IACF,CAAC;IAED;;;;OAIG;IACH,WAAW;QACV,OAAO,OAAO,WAAW,KAAK,QAAQ,IAAI,OAAO,WAAW,CAAC,WAAW,KAAK,UAAU,CAAA;IACxF,CAAC;IAED;;OAEG;IACH,OAAO;QACN,OAAO,MAAM,CAAC,OAAO,IAAI,WAAW,IAAI,MAAM,CAAC,OAAO,CAAA;IACvD,CAAC;IAED;;OAEG;IACH,IAAI;QACH,OAAO,gBAAgB,IAAI,MAAM,CAAA;IAClC,CAAC;IAED,SAAS;QACR,IAAI,CAAC;YACJ,OAAO,MAAM,CAAC,SAAS,IAAI,IAAI,CAAA;QAChC,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACZ,OAAO,KAAK,CAAA;QACb,CAAC;IACF,CAAC;IAED,qBAAqB;QACpB,MAAM,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,OAAO,CAAC,CAAA;QACnD,MAAM,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;QAClD,MAAM,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAU,CAAC,CAAA;QACvD,MAAM,aAAa,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,WAAW,CAAC,CAAA;QACzD,MAAM,cAAc,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,YAAY,CAAC,CAAA;QAC3D,MAAM,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,SAAS,CAAC,CAAA;QACrD,MAAM,cAAc,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAA;QACvD,MAAM,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,SAAS,CAAC,CAAA;QACrD,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA,CAAC,wEAAwE;QAEzH,MAAM,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,SAAS,CAAC,CAAA;QACtD,IAAI,YAAY,GAAG,CAAC,CAAC,CAAA;QAErB,IAAI,SAAS,KAAK,CAAC,CAAC,EAAE,CAAC;YACtB,IAAI,CAAC,OAAO,gCAAmB,CAAA;YAC/B,YAAY,GAAG,SAAS,GAAG,CAAC,CAAA;QAC7B,CAAC;aAAM,IAAI,WAAW,KAAK,CAAC,CAAC,EAAE,CAAC;YAC/B,IAAI,CAAC,OAAO,kCAAoB,CAAA;YAChC,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAU,CAAC,CAAA;YAEjD,IAAI,YAAY,KAAK,CAAC,CAAC,EAAE,CAAC;gBACzB,YAAY,IAAI,CAAC,CAAA;YAClB,CAAC;iBAAM,CAAC;gBACP,YAAY,GAAG,WAAW,GAAG,CAAC,CAAA;YAC/B,CAAC;QACF,CAAC;aAAM,IAAI,WAAW,KAAK,CAAC,CAAC,EAAE,CAAC;YAC/B,IAAI,CAAC,OAAO,kCAAoB,CAAA;YAChC,YAAY,GAAG,WAAW,GAAG,CAAC,CAAA;QAC/B,CAAC;aAAM,IAAI,CAAC,YAAY,KAAK,CAAC,CAAC,IAAI,cAAc,KAAK,CAAC,CAAC,CAAC,IAAI,WAAW,KAAK,CAAC,CAAC,IAAI,WAAW,KAAK,CAAC,CAAC,IAAI,aAAa,KAAK,CAAC,CAAC,EAAE,CAAC;YAC/H,oDAAoD;YACpD,IAAI,CAAC,OAAO,sCAAsB,CAAA;YAElC,IAAI,YAAY,KAAK,CAAC,CAAC,EAAE,CAAC;gBACzB,YAAY,GAAG,YAAY,GAAG,CAAC,CAAA;YAChC,CAAC;iBAAM,CAAC;gBACP,YAAY,GAAG,cAAc,GAAG,EAAE,CAAA;YACnC,CAAC;QACF,CAAC;aAAM,IAAI,WAAW,KAAK,CAAC,CAAC,EAAE,CAAC;YAC/B,IAAI,CAAC,OAAO,oCAAqB,CAAA;YACjC,YAAY,GAAG,WAAW,GAAG,CAAC,CAAA;QAC/B,CAAC;aAAM,IAAI,YAAY,KAAK,CAAC,CAAC,EAAE,CAAC;YAChC,0BAA0B;YAC1B,yHAAyH;YACzH,IAAI,CAAC,OAAO,sCAAsB,CAAA;YAClC,YAAY,GAAG,YAAY,GAAG,CAAC,CAAA;QAChC,CAAC;aAAM,IAAI,cAAc,KAAK,CAAC,CAAC,EAAE,CAAC;YAClC,IAAI,CAAC,OAAO,oCAAqB,CAAA;YACjC,YAAY,GAAG,cAAc,GAAG,CAAC,CAAA;QAClC,CAAC;aAAM,IAAI,WAAW,KAAK,CAAC,CAAC,IAAI,WAAW,KAAK,CAAC,CAAC,EAAE,CAAC;YACrD,iEAAiE;YACjE,IAAI,CAAC,OAAO,oCAAqB,CAAA;YACjC,6CAA6C;YAC7C,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAU,CAAC,CAAA;YAEjD,IAAI,YAAY,KAAK,CAAC,CAAC,EAAE,CAAC;gBACzB,YAAY,IAAI,CAAC,CAAA;YAClB,CAAC;iBAAM,CAAC;gBACP,2FAA2F;gBAC3F,IAAI,CAAC,iBAAiB,EAAE,CAAA;gBACxB,OAAM;YACP,CAAC;QACF,CAAC;aAAM,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,mBAAmB,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,qBAAqB,CAAC,EAAE,CAAC;YACrG,kJAAkJ;YAClJ,sDAAsD;YACtD,wIAAwI;YACxI,IAAI,CAAC,iBAAiB,EAAE,CAAA;YACxB,OAAM;QACP,CAAC;QAED,IAAI,YAAY,KAAK,CAAC,CAAC,EAAE,CAAC;YACzB,MAAM,mBAAmB,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,GAAG,EAAE,YAAY,CAAC,CAAA;YAErE,IAAI,mBAAmB,KAAK,CAAC,CAAC,EAAE,CAAC;gBAChC,IAAI,CAAC;oBACJ,IAAI,CAAC,cAAc,GAAG,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,YAAY,EAAE,mBAAmB,GAAG,CAAC,CAAC,CAAC,CAAA,CAAC,uCAAuC;gBACtI,CAAC;gBAAC,OAAO,CAAC,EAAE,CAAC;oBACZ,WAAW;gBACZ,CAAC;YACF,CAAC;QACF,CAAC;QAED,iFAAiF;QACjF,IAAI,IAAI,CAAC,cAAc,KAAK,CAAC,EAAE,CAAC;YAC/B,IAAI,CAAC,OAAO,kCAAoB,CAAA;QACjC,CAAC;IACF,CAAC;IAED,iBAAiB;QAChB,+GAA+G;QAC/G,4DAA4D;QAC5D,MAAM,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;QAEnD,IAAI,YAAY,KAAK,CAAC,CAAC,EAAE,CAAC;YACzB,IAAI,CAAC,OAAO,oCAAqB,CAAA;YAEjC,IAAI,CAAC;gBACJ,4EAA4E;gBAC5E,IAAI,GAAG,GAAG,YAAY,GAAG,CAAC,CAAA;gBAC1B,IAAI,MAAM,GAAG,KAAK,CAAA;gBAElB,OAAO,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC;oBACpC,GAAG,EAAE,CAAA;oBAEL,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC;wBAC/C,IAAI,MAAM,EAAE,CAAC;4BACZ,MAAK;wBACN,CAAC;6BAAM,CAAC;4BACP,MAAM,GAAG,IAAI,CAAA;wBACd,CAAC;oBACF,CAAC;gBACF,CAAC;gBAED,MAAM,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,YAAY,GAAG,CAAC,EAAE,GAAG,CAAC,CAAA;gBACpE,IAAI,CAAC,cAAc,GAAG,MAAM,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CAAA;YAC9D,CAAC;YAAC,OAAO,CAAC,EAAE,CAAC;gBACZ,WAAW;YACZ,CAAC;QACF,CAAC;IACF,CAAC;IAED,cAAc;QACb,IAAI,CAAC,MAAM,qCAAqB,CAAA;QAEhC,IACC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,mBAAmB,CAAC,IAAI,IAAI,IAAI,oGAAoG;YACzJ,yGAAyG;YACzG,CAAC,wCAAwC,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,MAAM,CAAC,UAAU,IAAI,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,KAAK,CAAC,EAClI,CAAC;YACF,IAAI,CAAC,MAAM,+BAAkB,CAAA;QAC9B,CAAC;aAAM,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,qBAAqB,CAAC,IAAI,IAAI,EAAE,CAAC;YAChE,IAAI,CAAC,MAAM,mCAAoB,CAAA;QAChC,CAAC;aAAM,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,IAAI,EAAE,CAAC;YACpD,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,IAAI,EAAE,CAAC;gBAC5C,IAAI,CAAC,MAAM,+CAA0B,CAAA;YACtC,CAAC;iBAAM,CAAC;gBACP,IAAI,CAAC,MAAM,qCAAqB,CAAA;YACjC,CAAC;QACF,CAAC;aAAM,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,YAAY,CAAC,IAAI,IAAI,EAAE,CAAC;YACvD,IAAI,CAAC,MAAM,qCAAqB,CAAA;QACjC,CAAC;aAAM,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,IAAI,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,IAAI,EAAE,CAAC;YAC7F,IAAI,CAAC,MAAM,+CAA0B,CAAA;QACtC,CAAC;IACF,CAAC;IAED,gBAAgB;QACf,OAAO,cAAc,IAAI,MAAM,CAAA;IAChC,CAAC;IAED,KAAK;QACJ,OAAO,IAAI,CAAC,MAAM,iCAAoB,IAAI,IAAI,CAAC,MAAM,qCAAsB,CAAA;IAC5E,CAAC;IAED,yBAAyB,CAAC,IAAY,EAAE,KAAa;QACpD,IAAI,CAAC,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAQ,CAAA;QAC5C,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,KAAK,CAAA;QACrB,OAAO,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,KAAK,CAAA;IAC/B,CAAC;IAED,aAAa;QACZ,IAAI,GAAG,CAAC,IAAI,KAAK,IAAI,CAAC,GAAG,EAAE,CAAC;YAC3B,IAAI,IAAI,CAAC,OAAO,KAAK,OAAO,CAAC,UAAU;gBAAE,MAAM,IAAI,KAAK,CAAC,mDAAmD,CAAC,CAAA;YAC7G,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,KAAK,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,UAAU,CAAA;YACnE,OAAO,GAAG,MAAM,CAAC,MAAM,IAAI,OAAO,MAAM,CAAA;QACzC,CAAC;aAAM,IAAI,GAAG,CAAC,IAAI,KAAK,IAAI,CAAC,OAAO,EAAE,CAAC;YACtC,OAAO,MAAM,CAAC,OAAO,GAAG,UAAU,CAAA;QACnC,CAAC;aAAM,IAAI,GAAG,CAAC,UAAU,KAAK,OAAO,EAAE,CAAC;YACvC,OAAO,eAAe,CAAA;QACvB,CAAC;aAAM,IAAI,GAAG,CAAC,UAAU,KAAK,QAAQ,EAAE,CAAC;YACxC,OAAO,aAAa,CAAA;QACrB,CAAC;aAAM,IAAI,GAAG,CAAC,UAAU,KAAK,OAAO,EAAE,CAAC;YACvC,OAAO,iBAAiB,CAAA;QACzB,CAAC;QAED,OAAO,SAAS,CAAA;IACjB,CAAC;IAED,yBAAyB;QACxB,OAAO,IAAI,CAAC,aAAa,EAAE,IAAI,IAAI,CAAC,YAAY,EAAE,CAAA;IACnD,CAAC;IAED,aAAa;QACZ,6CAA6C;QAC7C,+CAA+C;QAC/C,OAAO,IAAI,CAAC,OAAO,wCAAwB,IAAI,IAAI,CAAC,cAAc,GAAG,EAAE,CAAA;IACxE,CAAC;IAED,YAAY;QACX,OAAO,IAAI,CAAC,OAAO,sCAAuB,IAAI,IAAI,CAAC,cAAc,GAAG,EAAE,CAAA;IACvE,CAAC;IAED,kBAAkB;QACjB,OAAO,CACN,IAAI,CAAC,KAAK,EAAE;YACZ,IAAI,CAAC,OAAO,sCAAuB;YACnC,CAAC,IAAI,CAAC,OAAO,wCAAwB,IAAI,IAAI,CAAC,cAAc,IAAI,EAAE,CAAC;YACnE,CAAC,IAAI,CAAC,OAAO,sCAAuB,IAAI,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC,CACjE,CAAA;IACF,CAAC;IAED,mBAAmB;QAClB,OAAO,IAAI,CAAC,OAAO,sCAAuB,IAAI,IAAI,CAAC,cAAc,GAAG,IAAI,CAAA;IACzE,CAAC;IAED,WAAW;QACV,OAAO;YACN,kBAAkB,EAAE,IAAI,CAAC,kBAAkB,EAAE;YAC7C,mBAAmB,EAAE,IAAI,CAAC,mBAAmB,EAAE;YAC/C,kBAAkB,EAAE,IAAI,CAAC,SAAS,EAAE;SACpC,CAAA;IACF,CAAC;IAED,0BAA0B;QACzB,OAAO,OAAO,iBAAiB,KAAK,WAAW,CAAA;IAChD,CAAC;IAED,aAAa;QACZ,OAAO,KAAK,EAAE,IAAI,IAAI,CAAC,OAAO,KAAK,OAAO,CAAC,QAAQ,CAAA;IACpD,CAAC;IAED,SAAS;QACR,OAAO,KAAK,EAAE,IAAI,IAAI,CAAC,OAAO,KAAK,OAAO,CAAC,IAAI,CAAA;IAChD,CAAC;CACD;AAED,MAAM,CAAC,MAAM,MAAM,GAAmB,IAAI,cAAc,EAAE,CAAA","sourcesContent":["import { assertMainOrNodeBoot, isApp, Mode } from \"../api/common/Env\"\nimport { AppType, BrowserData, BrowserType, DeviceType } from \"./ClientConstants\"\n\nassertMainOrNodeBoot()\n\nexport class ClientDetector {\n\tuserAgent!: string\n\tbrowser!: BrowserType\n\tbrowserVersion!: number\n\tdevice!: DeviceType\n\toverflowAuto!: string\n\tisMacOS!: boolean\n\tappType!: AppType\n\n\tconstructor() {}\n\n\tinit(userAgent: string, platform: string, appType: AppType = AppType.Integrated) {\n\t\tthis.userAgent = userAgent\n\t\tthis.browser = BrowserType.OTHER\n\t\tthis.browserVersion = 0\n\t\tthis.device = DeviceType.DESKTOP\n\t\tthis.appType = appType\n\n\t\tthis._setBrowserAndVersion()\n\n\t\tthis._setDeviceInfo()\n\n\t\tthis.overflowAuto = this.cssPropertyValueSupported(\"overflow\", \"overlay\") ? \"overlay\" : \"auto\"\n\t\tthis.isMacOS = platform.indexOf(\"Mac\") !== -1\n\t}\n\n\t/**\n\t * This function uses syntax constructs which we want to make sure are supported. If they are not then this file cannot be imported.\n\t */\n\tsyntaxChecks() {\n\t\t// By default rollup disables tree-shaking inside the try-catch.\n\t\ttry {\n\t\t\tconst arrowFunction = () => {\n\t\t\t\treturn 1\n\t\t\t}\n\n\t\t\tlet aLet = 2\n\n\t\t\tfunction* testGenerator() {}\n\n\t\t\tasync function testAsync() {}\n\n\t\t\tfunction testDefaultArgs(a = 2) {}\n\n\t\t\ttestGenerator()\n\t\t\ttestAsync()\n\t\t\ttestDefaultArgs()\n\t\t\tconst anArray = [1, 2, 3]\n\t\t\tconst spreadArray = [...anArray]\n\t\t\tconst dynamicString = \"\"\n\t\t\tconst impossibleCondition = arrowFunction() === aLet\n\n\t\t\tif (impossibleCondition) {\n\t\t\t\timport(dynamicString)\n\t\t\t}\n\n\t\t\tconst objectSyntax = {\n\t\t\t\t[dynamicString]: true,\n\n\t\t\t\ttestFn() {},\n\n\t\t\t\tget accessor() {\n\t\t\t\t\treturn null\n\t\t\t\t},\n\n\t\t\t\tset accessor(newValue) {},\n\t\t\t}\n\t\t\tconst templateString = `test ${dynamicString}`\n\t\t\tconst x = 1\n\t\t\tconst y = 2\n\t\t\tconst propertyShorthand = {\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t}\n\t\t\tconst { x: x2, y: y2 } = propertyShorthand\n\t\t\tconst [a1, a2, ...arest] = anArray\n\n\t\t\tclass WithStatisMember {\n\t\t\t\tstatic aFuncton() {}\n\t\t\t}\n\n\t\t\tfor (const item of testGenerator()) {\n\t\t\t\t/* empty */\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t/* empty */\n\t\t}\n\t}\n\n\ttestBuiltins(): boolean {\n\t\treturn (\n\t\t\ttypeof Set !== \"undefined\" &&\n\t\t\ttypeof Map !== \"undefined\" &&\n\t\t\ttypeof Array.prototype.includes === \"function\" &&\n\t\t\ttypeof Object.entries === \"function\" &&\n\t\t\ttypeof Object.values === \"function\" &&\n\t\t\ttypeof Object.fromEntries === \"function\" &&\n\t\t\ttypeof Symbol !== \"undefined\" &&\n\t\t\ttypeof Uint8Array !== \"undefined\" &&\n\t\t\ttypeof Proxy !== \"undefined\" &&\n\t\t\ttypeof Reflect !== \"undefined\" &&\n\t\t\ttypeof Promise.prototype.finally !== \"undefined\" &&\n\t\t\ttypeof String.prototype.replaceAll === \"function\" &&\n\t\t\ttypeof BigInt !== \"undefined\"\n\t\t)\n\t}\n\n\ttestCss(): boolean {\n\t\ttry {\n\t\t\tdocument.querySelector(\"blockquote:not(blockquote blockquote)\")\n\t\t\tdocument.querySelectorAll(\":where(.mouse-nav)\")\n\t\t\treturn true\n\t\t} catch (e) {\n\t\t\treturn false\n\t\t}\n\t}\n\n\t/**\n\t * Browsers which support these features are supported\n\t */\n\tisSupported(): boolean {\n\t\tthis.syntaxChecks()\n\t\treturn this.isSupportedBrowserVersion() && this.testBuiltins() && this.websockets() && this.testCss()\n\t}\n\n\tisMobileDevice(): boolean {\n\t\treturn this.device !== DeviceType.DESKTOP\n\t}\n\n\tisDesktopDevice(): boolean {\n\t\treturn this.device === DeviceType.DESKTOP\n\t}\n\n\t/**\n\t * @see https://github.com/Modernizr/Modernizr/blob/5e3f359bfc9aa511543ece60bd8a6ea8aa7defd3/feature-detects/websockets.js\n\t */\n\twebsockets(): boolean {\n\t\treturn \"WebSocket\" in window && window.WebSocket.CLOSING === 2\n\t}\n\n\tlocalStorage(): boolean {\n\t\ttry {\n\t\t\treturn localStorage != null\n\t\t} catch (e) {\n\t\t\t// DOMException is thrown if all cookies are disabled\n\t\t\treturn false\n\t\t}\n\t}\n\n\t/**\n\t * We need WebAssembly for Argon2.\n\t *\n\t * @returns true if webassembly is supported\n\t */\n\twebassembly(): boolean {\n\t\treturn typeof WebAssembly === \"object\" && typeof WebAssembly.instantiate === \"function\"\n\t}\n\n\t/**\n\t * @see https://github.com/Modernizr/Modernizr/blob/master/feature-detects/history.js\n\t */\n\thistory(): boolean {\n\t\treturn window.history && \"pushState\" in window.history\n\t}\n\n\t/**\n\t * @see https://github.com/Modernizr/Modernizr/blob/master/feature-detects/network/xhr2.js\n\t */\n\txhr2(): boolean {\n\t\treturn \"XMLHttpRequest\" in window\n\t}\n\n\tindexedDb(): boolean {\n\t\ttry {\n\t\t\treturn window.indexedDB != null\n\t\t} catch (e) {\n\t\t\treturn false\n\t\t}\n\t}\n\n\t_setBrowserAndVersion() {\n\t\tconst operaIndex1 = this.userAgent.indexOf(\"Opera\")\n\t\tconst operaIndex2 = this.userAgent.indexOf(\"OPR/\")\n\t\tconst firefoxIndex = this.userAgent.indexOf(\"Firefox/\")\n\t\tconst paleMoonIndex = this.userAgent.indexOf(\"PaleMoon/\")\n\t\tconst iceweaselIndex = this.userAgent.indexOf(\"Iceweasel/\")\n\t\tconst chromeIndex = this.userAgent.indexOf(\"Chrome/\")\n\t\tconst chromeIosIndex = this.userAgent.indexOf(\"CriOS/\")\n\t\tconst safariIndex = this.userAgent.indexOf(\"Safari/\")\n\t\tconst edgeIndex = this.userAgent.indexOf(\"Edge\") // \"Old\" edge based on EdgeHTML, \"new\" one based on Blink has only \"Edg\"\n\n\t\tconst androidIndex = this.userAgent.indexOf(\"Android\")\n\t\tlet versionIndex = -1\n\n\t\tif (edgeIndex !== -1) {\n\t\t\tthis.browser = BrowserType.EDGE\n\t\t\tversionIndex = edgeIndex + 5\n\t\t} else if (operaIndex1 !== -1) {\n\t\t\tthis.browser = BrowserType.OPERA\n\t\t\tversionIndex = this.userAgent.indexOf(\"Version/\")\n\n\t\t\tif (versionIndex !== -1) {\n\t\t\t\tversionIndex += 8\n\t\t\t} else {\n\t\t\t\tversionIndex = operaIndex1 + 6\n\t\t\t}\n\t\t} else if (operaIndex2 !== -1) {\n\t\t\tthis.browser = BrowserType.OPERA\n\t\t\tversionIndex = operaIndex2 + 4\n\t\t} else if ((firefoxIndex !== -1 || iceweaselIndex !== -1) && operaIndex1 === -1 && operaIndex2 === -1 && paleMoonIndex === -1) {\n\t\t\t// Opera may pretend to be Firefox, so it is skipped\n\t\t\tthis.browser = BrowserType.FIREFOX\n\n\t\t\tif (firefoxIndex !== -1) {\n\t\t\t\tversionIndex = firefoxIndex + 8\n\t\t\t} else {\n\t\t\t\tversionIndex = iceweaselIndex + 10\n\t\t\t}\n\t\t} else if (chromeIndex !== -1) {\n\t\t\tthis.browser = BrowserType.CHROME\n\t\t\tversionIndex = chromeIndex + 7\n\t\t} else if (androidIndex !== -1) {\n\t\t\t// default android browser\n\t\t\t// keep this check after Chrome, Firefox and Opera, because the Android browser does not identify itself in any other way\n\t\t\tthis.browser = BrowserType.ANDROID\n\t\t\tversionIndex = androidIndex + 8\n\t\t} else if (chromeIosIndex !== -1) {\n\t\t\tthis.browser = BrowserType.CHROME\n\t\t\tversionIndex = chromeIosIndex + 6\n\t\t} else if (safariIndex !== -1 && chromeIndex === -1) {\n\t\t\t// Chrome and black berry pretends to be Safari, so it is skipped\n\t\t\tthis.browser = BrowserType.SAFARI\n\t\t\t// Safari prints its version after \"Version/\"\n\t\t\tversionIndex = this.userAgent.indexOf(\"Version/\")\n\n\t\t\tif (versionIndex !== -1) {\n\t\t\t\tversionIndex += 8\n\t\t\t} else {\n\t\t\t\t// Other browsers on iOS do not usually send Version/ and we can assume that they're Safari\n\t\t\t\tthis.extractIosVersion()\n\t\t\t\treturn\n\t\t\t}\n\t\t} else if (this.userAgent.match(/iPad.*AppleWebKit/) || this.userAgent.match(/iPhone.*AppleWebKit/)) {\n\t\t\t// iPad and iPhone do not send the Safari this.userAgent when HTML-apps are directly started from the homescreen a browser version is sent neither\n\t\t\t// after \"OS\" the iOS version is sent, so use that one\n\t\t\t// Also there are a lot of browsers on iOS but they all are based on Safari so we can use the same extraction mechanism for all of them.\n\t\t\tthis.extractIosVersion()\n\t\t\treturn\n\t\t}\n\n\t\tif (versionIndex !== -1) {\n\t\t\tconst mainVersionEndIndex = this.userAgent.indexOf(\".\", versionIndex)\n\n\t\t\tif (mainVersionEndIndex !== -1) {\n\t\t\t\ttry {\n\t\t\t\t\tthis.browserVersion = Number(this.userAgent.substring(versionIndex, mainVersionEndIndex + 2)) // we recognize one digit after the '.'\n\t\t\t\t} catch (e) {\n\t\t\t\t\t/* empty */\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// if the version is not valid, the browser type is not valid, so set it to other\n\t\tif (this.browserVersion === 0) {\n\t\t\tthis.browser = BrowserType.OTHER\n\t\t}\n\t}\n\n\textractIosVersion() {\n\t\t// Extracting version does not work with iPad OS WebView because it's not in the userAgent. We could look it up\n\t\t// from Webkit version but maybe we don't need that for now.\n\t\tconst versionIndex = this.userAgent.indexOf(\" OS \")\n\n\t\tif (versionIndex !== -1) {\n\t\t\tthis.browser = BrowserType.SAFARI\n\n\t\t\ttry {\n\t\t\t\t// in case of versions like 12_1_1 get substring 12_1 and convert it to 12.1\n\t\t\t\tlet pos = versionIndex + 4\n\t\t\t\tlet hadNan = false\n\n\t\t\t\twhile (pos < this.userAgent.length) {\n\t\t\t\t\tpos++\n\n\t\t\t\t\tif (isNaN(Number(this.userAgent.charAt(pos)))) {\n\t\t\t\t\t\tif (hadNan) {\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\thadNan = true\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst numberString = this.userAgent.substring(versionIndex + 4, pos)\n\t\t\t\tthis.browserVersion = Number(numberString.replace(/_/g, \".\"))\n\t\t\t} catch (e) {\n\t\t\t\t/* empty */\n\t\t\t}\n\t\t}\n\t}\n\n\t_setDeviceInfo() {\n\t\tthis.device = DeviceType.DESKTOP\n\n\t\tif (\n\t\t\tthis.userAgent.match(/iPad.*AppleWebKit/) != null || // iPadOS does not differ in UserAgent from Safari on macOS. Use hack with TouchEvent to detect iPad\n\t\t\t// Desktop Chrome has TouchEvent but it also has Chrome in it. Mobile iOS has CriOS in it and not Chrome.\n\t\t\t(/Macintosh; Intel Mac OS X.*AppleWebKit/.test(this.userAgent) && window.TouchEvent && /.*Chrome.*/.test(this.userAgent) === false)\n\t\t) {\n\t\t\tthis.device = DeviceType.IPAD\n\t\t} else if (this.userAgent.match(/iPhone.*AppleWebKit/) != null) {\n\t\t\tthis.device = DeviceType.IPHONE\n\t\t} else if (this.userAgent.match(/Android/) != null) {\n\t\t\tif (this.userAgent.match(/Ubuntu/) != null) {\n\t\t\t\tthis.device = DeviceType.OTHER_MOBILE\n\t\t\t} else {\n\t\t\t\tthis.device = DeviceType.ANDROID\n\t\t\t}\n\t\t} else if (this.userAgent.match(/Windows NT/) != null) {\n\t\t\tthis.device = DeviceType.DESKTOP\n\t\t} else if (this.userAgent.match(/Mobile/) != null || this.userAgent.match(/Tablet/) != null) {\n\t\t\tthis.device = DeviceType.OTHER_MOBILE\n\t\t}\n\t}\n\n\tisTouchSupported(): boolean {\n\t\treturn \"ontouchstart\" in window\n\t}\n\n\tisIos(): boolean {\n\t\treturn this.device === DeviceType.IPAD || this.device === DeviceType.IPHONE\n\t}\n\n\tcssPropertyValueSupported(prop: string, value: string): boolean {\n\t\tlet d = document.createElement(\"div\") as any\n\t\td.style[prop] = value\n\t\treturn d.style[prop] === value\n\t}\n\n\tgetIdentifier(): string {\n\t\tif (env.mode === Mode.App) {\n\t\t\tif (this.appType === AppType.Integrated) throw new Error(\"AppType.Integrated is not allowed for mobile apps\")\n\t\t\tconst appType = this.appType === AppType.Mail ? \"Mail\" : \"Calendar\"\n\t\t\treturn `${client.device} ${appType} App`\n\t\t} else if (env.mode === Mode.Browser) {\n\t\t\treturn client.browser + \" Browser\"\n\t\t} else if (env.platformId === \"linux\") {\n\t\t\treturn \"Linux Desktop\"\n\t\t} else if (env.platformId === \"darwin\") {\n\t\t\treturn \"Mac Desktop\"\n\t\t} else if (env.platformId === \"win32\") {\n\t\t\treturn \"Windows Desktop\"\n\t\t}\n\n\t\treturn \"Unknown\"\n\t}\n\n\tisSupportedBrowserVersion(): boolean {\n\t\treturn this.notOldFirefox() && this.notOldChrome()\n\t}\n\n\tnotOldFirefox(): boolean {\n\t\t// issue only occurs for old Firefox browsers\n\t\t// https://github.com/tutao/tutanota/issues/835\n\t\treturn this.browser !== BrowserType.FIREFOX || this.browserVersion > 40\n\t}\n\n\tnotOldChrome(): boolean {\n\t\treturn this.browser !== BrowserType.CHROME || this.browserVersion > 55\n\t}\n\n\tneedsMicrotaskHack(): boolean {\n\t\treturn (\n\t\t\tthis.isIos() ||\n\t\t\tthis.browser === BrowserType.SAFARI ||\n\t\t\t(this.browser === BrowserType.FIREFOX && this.browserVersion <= 60) ||\n\t\t\t(this.browser === BrowserType.CHROME && this.browserVersion < 59)\n\t\t)\n\t}\n\n\tneedsExplicitIDBIds(): boolean {\n\t\treturn this.browser === BrowserType.SAFARI && this.browserVersion < 12.2\n\t}\n\n\tbrowserData(): BrowserData {\n\t\treturn {\n\t\t\tneedsMicrotaskHack: this.needsMicrotaskHack(),\n\t\t\tneedsExplicitIDBIds: this.needsExplicitIDBIds(),\n\t\t\tindexedDbSupported: this.indexedDb(),\n\t\t}\n\t}\n\n\tcompressionStreamSupported(): boolean {\n\t\treturn typeof CompressionStream !== \"undefined\"\n\t}\n\n\tisCalendarApp() {\n\t\treturn isApp() && this.appType === AppType.Calendar\n\t}\n\n\tisMailApp() {\n\t\treturn isApp() && this.appType === AppType.Mail\n\t}\n}\n\nexport const client: ClientDetector = new ClientDetector()\n"]}