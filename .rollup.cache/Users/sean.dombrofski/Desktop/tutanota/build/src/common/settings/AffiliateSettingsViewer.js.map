{"version":3,"file":"AffiliateSettingsViewer.js","sourceRoot":"","sources":["../../../../src/common/settings/AffiliateSettingsViewer.ts"],"names":[],"mappings":"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","sourcesContent":["import m from \"mithril\"\nimport Mithril, { Children } from \"mithril\"\nimport { UpdatableSettingsViewer } from \"./Interfaces.js\"\nimport { EntityUpdateData } from \"../api/common/utils/EntityUpdateUtils.js\"\nimport { IconButton } from \"../gui/base/IconButton.js\"\nimport { Icons } from \"../gui/base/icons/Icons.js\"\nimport { ButtonSize } from \"../gui/base/ButtonSize.js\"\nimport { TextField } from \"../gui/base/TextField.js\"\nimport { formatPrice } from \"../subscription/PriceUtils.js\"\nimport { Button, ButtonType } from \"../gui/base/Button.js\"\nimport { ListColumnWrapper } from \"../gui/ListColumnWrapper.js\"\nimport { lang } from \"../misc/LanguageViewModel.js\"\nimport { locator } from \"../api/main/CommonLocator\"\nimport { copyToClipboard } from \"../misc/ClipboardUtils.js\"\nimport { mailLocator } from \"../../mail-app/mailLocator.js\"\nimport { showSnackBar } from \"../gui/base/SnackBar.js\"\nimport { LazyLoaded } from \"@tutao/tutanota-utils\"\nimport { AffiliateViewModel } from \"./AffiliateViewModel.js\"\n\n/**\n * Section in user settings to display the referral link and let users share it.\n */\nexport class AffiliateSettingsViewer implements UpdatableSettingsViewer {\n\tprivate readonly affiliateViewModel = new LazyLoaded<AffiliateViewModel>(async () => await mailLocator.affiliateViewModel())\n\tprivate readonly domainConfig = locator.domainConfigProvider().getCurrentDomainConfig()\n\n\tconstructor(private readonly getIsShowingKpis: () => boolean, private readonly toggleKpiColumn: () => unknown) {}\n\n\toninit(): any {\n\t\tthis.affiliateViewModel.getAsync().then((avm) => avm.load().finally(m.redraw))\n\t}\n\n\tview(): Children {\n\t\tif (this.affiliateViewModel.isLoaded()) {\n\t\t\tconst avm = this.affiliateViewModel.getSync() as AffiliateViewModel\n\t\t\tif (avm.isLoading) {\n\t\t\t\treturn m(ListColumnWrapper, m(\"p\", \"Loading...\"))\n\t\t\t}\n\n\t\t\tif (avm.data === null) {\n\t\t\t\treturn m(ListColumnWrapper, m(\"p\", \"Error\"))\n\t\t\t}\n\n\t\t\tconst shareUrl = `${this.domainConfig.websiteBaseUrl}?t-src=${avm.data.promotionId}`\n\n\t\t\treturn m(\n\t\t\t\tListColumnWrapper,\n\t\t\t\tm(\n\t\t\t\t\t\"section.fill-absolute.scroll.plr-l\",\n\t\t\t\t\tm(\"h4.mt-l\", lang.get(\"affiliateSettings_label\")),\n\t\t\t\t\tm(TextField, {\n\t\t\t\t\t\tisReadOnly: true,\n\t\t\t\t\t\tlabel: \"referralLink_label\",\n\t\t\t\t\t\tvalue: shareUrl,\n\t\t\t\t\t\tinjectionsRight: () =>\n\t\t\t\t\t\t\tm(IconButton, {\n\t\t\t\t\t\t\t\ttitle: \"copy_action\",\n\t\t\t\t\t\t\t\tclick: () => this.onCopyButtonClick(shareUrl),\n\t\t\t\t\t\t\t\ticon: Icons.Copy,\n\t\t\t\t\t\t\t\tsize: ButtonSize.Compact,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t}),\n\t\t\t\t\tm(TextField, {\n\t\t\t\t\t\tisReadOnly: true,\n\t\t\t\t\t\tlabel: \"affiliateSettingsAccumulated_label\",\n\t\t\t\t\t\thelpLabel: () => lang.get(\"affiliateSettingsAccumulated_msg\"),\n\t\t\t\t\t\tvalue: formatPrice(Number(avm!.data!.accumulatedCommission), true),\n\t\t\t\t\t}),\n\t\t\t\t\tm(TextField, {\n\t\t\t\t\t\tisReadOnly: true,\n\t\t\t\t\t\tlabel: \"affiliateSettingsCredited_label\",\n\t\t\t\t\t\thelpLabel: () => lang.get(\"affiliateSettingsCredited_msg\"),\n\t\t\t\t\t\tvalue: formatPrice(Number(avm!.data!.creditedCommission), true),\n\t\t\t\t\t}),\n\t\t\t\t\tm(\n\t\t\t\t\t\t\".flex.center-horizontally.mt-m\",\n\t\t\t\t\t\tm(Button, {\n\t\t\t\t\t\t\tlabel: this.getIsShowingKpis() ? \"affiliateSettingsHideKpis_label\" : \"affiliateSettingsShowKpis_label\",\n\t\t\t\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t\t\t\t\tclick: () => this.toggleKpiColumn(),\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t)\n\t\t} else {\n\t\t\treturn m(\"\")\n\t\t}\n\t}\n\n\tprivate onCopyButtonClick(shareUrl: string): void {\n\t\tcopyToClipboard(shareUrl).then(() => {\n\t\t\tshowSnackBar({\n\t\t\t\tmessage: \"linkCopied_msg\",\n\t\t\t\tbutton: {\n\t\t\t\t\tlabel: \"close_alt\",\n\t\t\t\t\tclick: () => {},\n\t\t\t\t},\n\t\t\t})\n\t\t})\n\t}\n\n\tasync entityEventsReceived(updates: ReadonlyArray<EntityUpdateData>): Promise<void> {\n\t\t// can be a noop because the referral code will never change once it was created\n\t\t// we trigger creation in the constructor if there is no code yet\n\t}\n}\n"]}