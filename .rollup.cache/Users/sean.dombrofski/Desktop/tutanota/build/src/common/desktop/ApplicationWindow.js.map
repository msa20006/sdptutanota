{"version":3,"file":"ApplicationWindow.js","sourceRoot":"","sources":["../../../../src/common/desktop/ApplicationWindow.ts"],"names":[],"mappings":"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","sourcesContent":["import type { BrowserWindow, ContextMenuParams, HandlerDetails, NativeImage, Result } from \"electron\"\nimport type { WindowBounds, WindowManager } from \"./DesktopWindowManager\"\nimport url from \"node:url\"\nimport type { lazy } from \"@tutao/tutanota-utils\"\nimport { capitalizeFirstLetter, noOp, typedEntries, typedKeys } from \"@tutao/tutanota-utils\"\nimport { Keys } from \"../api/common/TutanotaConstants\"\nimport type { Key } from \"../misc/KeyManager\"\nimport path from \"node:path\"\nimport type { TranslationKey } from \"../misc/LanguageViewModel\"\nimport { lang } from \"../misc/LanguageViewModel\"\nimport { log } from \"./DesktopLog\"\nimport { parseUrlOrNull } from \"./PathUtils\"\nimport type { LocalShortcutManager } from \"./electron-localshortcut/LocalShortcut\"\nimport { DesktopThemeFacade } from \"./DesktopThemeFacade\"\nimport { CancelledError } from \"../api/common/error/CancelledError\"\nimport { DesktopFacade } from \"../native/common/generatedipc/DesktopFacade.js\"\nimport { CommonNativeFacade } from \"../native/common/generatedipc/CommonNativeFacade.js\"\nimport { RemoteBridge, WindowCleanup } from \"./ipc/RemoteBridge.js\"\nimport { InterWindowEventFacadeSendDispatcher } from \"../native/common/generatedipc/InterWindowEventFacadeSendDispatcher.js\"\nimport { handleProtocols } from \"./net/ProtocolProxy.js\"\nimport { PerWindowSqlCipherFacade } from \"./db/PerWindowSqlCipherFacade.js\"\nimport { DesktopMailImportFacade } from \"./mailimport/DesktopMailImportFacade\"\n\nconst MINIMUM_WINDOW_SIZE: number = 350\nexport type UserInfo = {\n\tuserId: string\n\tmailAddress?: string\n}\ntype LocalShortcut = {\n\tkey: Key\n\t// undefined == false\n\tctrl?: boolean\n\t// undefined == false\n\talt?: boolean\n\t// undefined == false\n\tshift?: boolean\n\t// undefined == false\n\tmeta?: boolean\n\tenabled?: lazy<boolean>\n\t// must return true, if preventDefault should not be invoked\n\texec(): boolean | void\n\thelp: TranslationKey\n}\nconst TAG = \"[ApplicationWindow]\"\n\nconst VIRTUAL_APP_URL_BASE = \"asset://app\"\nconst VIRTUAL_APP_URL = VIRTUAL_APP_URL_BASE + \"/index-desktop.html\"\n\nexport class ApplicationWindow {\n\t// these depend on window and are initialized later\n\tprivate _desktopFacade!: DesktopFacade\n\tprivate _commonNativeFacade!: CommonNativeFacade\n\tprivate _interWindowEventSender!: InterWindowEventFacadeSendDispatcher\n\tprivate _desktopMailImportFacade!: DesktopMailImportFacade\n\tprivate windowCleanup!: WindowCleanup\n\n\t_browserWindow!: BrowserWindow\n\n\t/** User logged in in this window. Reset from WindowManager. */\n\tprivate userId: Id | null = null\n\tprivate setBoundsTimeout: ReturnType<typeof setTimeout> | null = null\n\tprivate findingInPage: boolean = false\n\tprivate skipNextSearchBarBlur: boolean = false\n\tprivate lastSearchRequest: [string, { forward: boolean; matchCase: boolean }] | null = null\n\tprivate lastSearchPromiseReject: (err: Error | null) => void\n\tprivate shortcuts: Array<LocalShortcut>\n\tid!: number\n\n\tconstructor(\n\t\twm: WindowManager,\n\t\t/** absolute path to web assets (html, js etc.) */\n\t\tprivate readonly absoluteAssetsPath: string,\n\t\ticon: NativeImage,\n\t\tprivate readonly electron: typeof Electron.CrossProcessExports,\n\t\tprivate readonly localShortcut: LocalShortcutManager,\n\t\tprivate readonly themeFacade: DesktopThemeFacade,\n\t\tprivate readonly remoteBridge: RemoteBridge,\n\t\tnoAutoLogin?: boolean | null,\n\t\tpreloadOverridePath?: string,\n\t) {\n\t\tthis.lastSearchPromiseReject = noOp\n\t\tconst isMac = process.platform === \"darwin\"\n\t\tthis.shortcuts = (\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\tkey: Keys.F,\n\t\t\t\t\tmeta: isMac,\n\t\t\t\t\tctrl: !isMac,\n\t\t\t\t\texec: () => this.openFindInPage(),\n\t\t\t\t\thelp: \"searchPage_label\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: Keys.P,\n\t\t\t\t\tmeta: isMac,\n\t\t\t\t\tctrl: !isMac,\n\t\t\t\t\texec: () => this.printMail(),\n\t\t\t\t\thelp: \"print_action\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: Keys.F12,\n\t\t\t\t\texec: () => this.toggleDevTools(),\n\t\t\t\t\thelp: \"toggleDevTools_action\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: Keys[\"0\"],\n\t\t\t\t\tmeta: isMac,\n\t\t\t\t\tctrl: !isMac,\n\t\t\t\t\texec: () => {\n\t\t\t\t\t\twm.changeZoom(1)\n\t\t\t\t\t},\n\t\t\t\t\thelp: \"resetZoomFactor_action\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: Keys.Q,\n\t\t\t\t\tctrl: !isMac,\n\t\t\t\t\tmeta: isMac,\n\t\t\t\t\tshift: !isMac,\n\t\t\t\t\texec: () => this.electron.app.quit(),\n\t\t\t\t\thelp: \"quit_action\",\n\t\t\t\t},\n\t\t\t] as Array<LocalShortcut>\n\t\t).concat(\n\t\t\tisMac\n\t\t\t\t? [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: Keys.F,\n\t\t\t\t\t\t\tmeta: true,\n\t\t\t\t\t\t\tctrl: true,\n\t\t\t\t\t\t\texec: () => this.toggleFullScreen(),\n\t\t\t\t\t\t\thelp: \"toggleFullScreen_action\",\n\t\t\t\t\t\t},\n\t\t\t\t  ]\n\t\t\t\t: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: Keys.F11,\n\t\t\t\t\t\t\texec: () => this.toggleFullScreen(),\n\t\t\t\t\t\t\thelp: \"toggleFullScreen_action\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: Keys.RIGHT,\n\t\t\t\t\t\t\talt: true,\n\t\t\t\t\t\t\texec: () => this._browserWindow.webContents.goForward(),\n\t\t\t\t\t\t\thelp: \"pageForward_label\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: Keys.LEFT,\n\t\t\t\t\t\t\talt: true,\n\t\t\t\t\t\t\texec: () => this.tryGoBack(),\n\t\t\t\t\t\t\thelp: \"pageBackward_label\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: Keys.H,\n\t\t\t\t\t\t\tctrl: true,\n\t\t\t\t\t\t\texec: () => wm.minimize(),\n\t\t\t\t\t\t\thelp: \"hideWindows_action\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: Keys.N,\n\t\t\t\t\t\t\tctrl: true,\n\t\t\t\t\t\t\texec: () => {\n\t\t\t\t\t\t\t\twm.newWindow(true)\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\thelp: \"openNewWindow_action\",\n\t\t\t\t\t\t},\n\t\t\t\t  ],\n\t\t)\n\t\tlog.debug(TAG, \"webAssetsPath: \", this.absoluteAssetsPath)\n\t\tconst preloadPath = preloadOverridePath ?? path.join(this.electron.app.getAppPath(), \"./desktop/preload.js\")\n\n\t\tthis.createBrowserWindow(wm, {\n\t\t\tpreloadPath,\n\t\t\ticon,\n\t\t})\n\t\tthis.initFacades()\n\n\t\tthis.loadInitialUrl(noAutoLogin ?? false)\n\n\t\tthis.electron.Menu.setApplicationMenu(null)\n\t}\n\n\tget desktopMailImportFacade(): DesktopMailImportFacade {\n\t\treturn this._desktopMailImportFacade\n\t}\n\n\tget desktopFacade(): DesktopFacade {\n\t\treturn this._desktopFacade\n\t}\n\n\tget commonNativeFacade(): CommonNativeFacade {\n\t\treturn this._commonNativeFacade\n\t}\n\n\tget interWindowEventSender(): InterWindowEventFacadeSendDispatcher {\n\t\treturn this._interWindowEventSender\n\t}\n\n\tprivate initFacades() {\n\t\tconst sendingFacades = this.remoteBridge.createBridge(this)\n\t\tthis._desktopFacade = sendingFacades.desktopFacade\n\t\tthis._commonNativeFacade = sendingFacades.commonNativeFacade\n\t\tthis._interWindowEventSender = sendingFacades.interWindowEventSender\n\t\tthis.windowCleanup = sendingFacades.windowCleanup\n\t}\n\n\tprivate async loadInitialUrl(noAutoLogin: boolean) {\n\t\tconst initialUrl = await this.getInitialUrl({\n\t\t\tnoAutoLogin,\n\t\t})\n\t\tawait this.updateBackgroundColor()\n\n\t\tthis._browserWindow.loadURL(initialUrl)\n\t}\n\n\tasync updateBackgroundColor() {\n\t\tconst theme = await this.themeFacade.getCurrentThemeWithFallback()\n\n\t\tif (theme) {\n\t\t\tthis._browserWindow.setBackgroundColor(theme.navigation_bg)\n\t\t}\n\t}\n\n\t//expose browserwindow api\n\t// on: (m, f: (arg0: Event) => void) => BrowserWindow = (m, f: (arg0: Event) => void) => this._browserWindow.on(m, f)\n\ton: typeof BrowserWindow.prototype.on = (...args) =>\n\t\t// @ts-ignore\n\t\tthis._browserWindow.on(...args)\n\tonce: typeof BrowserWindow.prototype.once = (...args) =>\n\t\t// @ts-ignore\n\t\tthis._browserWindow.once(...args)\n\tgetTitle: () => string = () => this._browserWindow.webContents.getTitle()\n\t// windows that get their zoom factor set from the config file don't report that\n\t// zoom factor back when queried via webContents.zoomFactor.\n\t// we set it ourselves in the renderer thread the same way we handle mouse wheel zoom\n\tsetZoomFactor: (f: number) => void = (f: number) => this._browserWindow.webContents.setZoomFactor(f)\n\tisFullScreen: () => boolean = () => this._browserWindow.isFullScreen()\n\tisMinimized: () => boolean = () => this._browserWindow.isMinimized()\n\tminimize: () => void = () => this._browserWindow.minimize()\n\thide: () => void = () => this._browserWindow.hide()\n\tcenter: () => void = () => this._browserWindow.center()\n\tshowInactive: () => void = () => this._browserWindow.showInactive()\n\tfocus: () => void = () => this._browserWindow.focus()\n\tisFocused: () => boolean = () => this._browserWindow.isFocused()\n\n\tshow() {\n\t\tif (!this._browserWindow) {\n\t\t\treturn\n\t\t}\n\n\t\tconst contents = this._browserWindow.webContents\n\t\tconst devToolsState = contents.isDevToolsOpened()\n\n\t\tthis._browserWindow.show()\n\n\t\tif (this._browserWindow.isMinimized()) {\n\t\t\tthis._browserWindow.restore()\n\n\t\t\t//TODO: there has to be a better way. fix for #691\n\t\t\tcontents.toggleDevTools()\n\n\t\t\tif (devToolsState) {\n\t\t\t\tcontents.openDevTools()\n\t\t\t} else {\n\t\t\t\tcontents.closeDevTools()\n\t\t\t}\n\t\t} else if (!this._browserWindow.isFocused()) {\n\t\t\tthis._browserWindow.focus()\n\t\t}\n\t}\n\n\tprivate createBrowserWindow(\n\t\twm: WindowManager,\n\t\topts: {\n\t\t\tpreloadPath: string\n\t\t\ticon: NativeImage\n\t\t},\n\t) {\n\t\tconst { preloadPath, icon } = opts\n\n\t\tthis._browserWindow = new this.electron.BrowserWindow({\n\t\t\ticon,\n\t\t\tshow: false,\n\t\t\tautoHideMenuBar: true,\n\t\t\twebPreferences: {\n\t\t\t\tnodeIntegration: false,\n\t\t\t\tnodeIntegrationInWorker: false,\n\t\t\t\tnodeIntegrationInSubFrames: false,\n\t\t\t\tsandbox: true,\n\t\t\t\tcontextIsolation: true,\n\t\t\t\twebSecurity: true,\n\t\t\t\t// @ts-ignore see: https://github.com/electron/electron/issues/30789\n\t\t\t\tenableRemoteModule: false,\n\t\t\t\tallowRunningInsecureContent: false,\n\t\t\t\tpreload: preloadPath,\n\t\t\t\twebgl: false,\n\t\t\t\tplugins: false,\n\t\t\t\texperimentalFeatures: false,\n\t\t\t\twebviewTag: false,\n\t\t\t\tdisableDialogs: true,\n\t\t\t\tnavigateOnDragDrop: false,\n\t\t\t\tautoplayPolicy: \"user-gesture-required\",\n\t\t\t\tenableWebSQL: false,\n\t\t\t\tspellcheck: true,\n\t\t\t},\n\t\t})\n\n\t\tconst session = this._browserWindow.webContents.session\n\t\tsession.setPermissionRequestHandler((webContents, permission, callback: (_: boolean) => void) => callback(false))\n\n\t\thandleProtocols(session, this.absoluteAssetsPath)\n\n\t\tthis._browserWindow.setMenuBarVisibility(false)\n\n\t\tthis._browserWindow.removeMenu()\n\n\t\tthis._browserWindow.setMinimumSize(MINIMUM_WINDOW_SIZE, MINIMUM_WINDOW_SIZE)\n\n\t\tthis.id = this._browserWindow.id\n\n\t\tthis._browserWindow\n\t\t\t.on(\"closed\", async () => {\n\t\t\t\tawait this.cleanup()\n\t\t\t})\n\t\t\t.on(\"focus\", () => this.localShortcut.enableAll(this._browserWindow))\n\t\t\t.on(\"blur\", (_: FocusEvent) => this.localShortcut.disableAll(this._browserWindow))\n\n\t\tthis._browserWindow.webContents\n\t\t\t.on(\"will-attach-webview\", (e) => e.preventDefault())\n\t\t\t.on(\"will-navigate\", (e, url) => {\n\t\t\t\t// >Emitted when a user or the page wants to start navigation. It can happen when the window.location object is changed or\n\t\t\t\t// a user clicks a link in the page.\n\t\t\t\t// >This event will not emit when the navigation is started programmatically with APIs like webContents.loadURL and\n\t\t\t\t// webContents.back.\n\t\t\t\t// >It is also not emitted for in-page navigations, such as clicking anchor links or updating the window.location.hash.\n\t\t\t\t// https://www.electronjs.org/docs/api/web-contents#event-will-navigate\n\t\t\t\t//\n\t\t\t\t// Basically the only scenarios left for us are:\n\t\t\t\t// Clicking on a link without target=\"_blank\"\n\t\t\t\t// Programmatically changing window.location to something else (we don't do this and it normally reloads the page)\n\t\t\t\t// In neither of those cases we want to navigate anywhere.\n\t\t\t\tlog.debug(TAG, \"will-navigate\", url)\n\t\t\t\te.preventDefault()\n\t\t\t})\n\t\t\t.on(\"before-input-event\", (ev, input) => {\n\t\t\t\tif (this.lastSearchRequest && this.findingInPage && input.type === \"keyDown\" && input.key === \"Enter\") {\n\t\t\t\t\tthis.skipNextSearchBarBlur = true\n\t\t\t\t\tconst [searchTerm, options] = this.lastSearchRequest\n\t\t\t\t\toptions.forward = true\n\n\t\t\t\t\tthis._browserWindow.webContents\n\t\t\t\t\t\t.once(\"found-in-page\", (ev, res) => {\n\t\t\t\t\t\t\tthis._desktopFacade.applySearchResultToOverlay(res)\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.findInPage(searchTerm, options)\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"did-finish-load\", () => {\n\t\t\t\t// This also covers the case when window was reloaded.\n\t\t\t\t// the webContents needs to know on which channel to listen\n\t\t\t\tthis.sendShortcutstoRender()\n\t\t\t})\n\t\t\t.on(\"did-fail-load\", (evt, errorCode, errorDesc, validatedURL) => {\n\t\t\t\tlog.debug(TAG, \"failed to load resource: \", validatedURL, errorDesc)\n\n\t\t\t\tif (errorDesc === \"ERR_FILE_NOT_FOUND\") {\n\t\t\t\t\tthis.getInitialUrl({\n\t\t\t\t\t\tnoAutoLogin: true,\n\t\t\t\t\t})\n\t\t\t\t\t\t.then((initialUrl) => {\n\t\t\t\t\t\t\tlog.debug(TAG, \"redirecting to start page...\", initialUrl)\n\t\t\t\t\t\t\treturn this._browserWindow.loadURL(initialUrl)\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(() => log.debug(TAG, \"...redirected\"))\n\t\t\t\t}\n\t\t\t})\n\t\t\t// @ts-ignore\n\t\t\t.on(\"remote-require\", (e) => e.preventDefault())\n\t\t\t// @ts-ignore\n\t\t\t.on(\"remote-get-global\", (e) => e.preventDefault())\n\t\t\t// @ts-ignore\n\t\t\t.on(\"remote-get-builtin\", (e) => e.preventDefault())\n\t\t\t// @ts-ignore\n\t\t\t.on(\"remote-get-current-web-contents\", (e) => e.preventDefault())\n\t\t\t// @ts-ignore\n\t\t\t.on(\"remote-get-current-window\", (e) => e.preventDefault())\n\t\t\t.on(\"did-navigate\", () => this._browserWindow.emit(\"did-navigate\"))\n\t\t\t.on(\"did-navigate-in-page\", () => this._browserWindow.emit(\"did-navigate\"))\n\t\t\t.on(\"zoom-changed\", (ev, direction: \"in\" | \"out\") => this._browserWindow.emit(\"zoom-changed\", ev, direction))\n\t\t\t.on(\"update-target-url\", (ev, url) => {\n\t\t\t\tthis._desktopFacade.updateTargetUrl(url, VIRTUAL_APP_URL_BASE)\n\t\t\t})\n\n\t\tthis._browserWindow.webContents.setWindowOpenHandler((details) => this.onNewWindow(details))\n\n\t\t// Shortcuts but be registered here, before \"focus\" or \"blur\" event fires, otherwise localShortcut fails\n\t\tthis.reRegisterShortcuts()\n\t}\n\n\tasync reload(queryParams: Record<string, string | boolean>) {\n\t\tawait this.cleanup()\n\t\t// try to do this asap as to not get the window destroyed on us\n\t\tthis.remoteBridge.unsubscribe(this._browserWindow.webContents.ipc)\n\t\tthis.userId = null\n\t\tthis.initFacades()\n\t\tconst url = await this.getInitialUrl(queryParams)\n\t\tawait this._browserWindow.loadURL(url)\n\t}\n\n\tprivate async cleanup() {\n\t\tif (this.userId) {\n\t\t\tawait this.windowCleanup.onCleanup(this.userId)\n\t\t}\n\t}\n\n\tprivate onNewWindow(details: HandlerDetails): { action: \"deny\" } {\n\t\tconst parsedUrl = parseUrlOrNull(details.url)\n\n\t\tif (parsedUrl == null) {\n\t\t\tlog.warn(TAG, \"Could not parse url for new-window, will not open\")\n\t\t} else if (parsedUrl.protocol === \"file:\") {\n\t\t\t// this also works for raw file paths without protocol\n\t\t\tlog.warn(TAG, \"prevented file url from being opened by shell\")\n\t\t} else if (parsedUrl.protocol !== \"http:\" && parsedUrl.protocol !== \"https:\") {\n\t\t\tthis.electron.dialog\n\t\t\t\t.showMessageBox({\n\t\t\t\t\ttype: \"warning\",\n\t\t\t\t\tbuttons: [lang.get(\"yes_label\"), lang.get(\"no_label\")],\n\t\t\t\t\ttitle: lang.get(\"suspiciousLink_title\"),\n\t\t\t\t\tmessage: lang.get(\"suspiciousLink_msg\", { \"{url}\": parsedUrl.toString() }),\n\t\t\t\t\tdefaultId: 1, // default button is \"no\"\n\t\t\t\t})\n\t\t\t\t.then(({ response }) => {\n\t\t\t\t\tif (response === 0) {\n\t\t\t\t\t\tthis.doOpenLink(parsedUrl, details)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t} else {\n\t\t\tthis.doOpenLink(parsedUrl, details)\n\t\t}\n\n\t\treturn {\n\t\t\taction: \"deny\",\n\t\t}\n\t}\n\n\tprivate doOpenLink(parsedUrl: URL, details: Electron.HandlerDetails) {\n\t\t// we never open any new windows directly from the renderer\n\t\t// except for links in mails etc. so open them in the browser\n\t\tthis.electron.shell.openExternal(parsedUrl.toString()).catch((e) => {\n\t\t\tlog.warn(\"failed to open external url\", details.url, e)\n\t\t\tthis.electron.dialog.showMessageBox({\n\t\t\t\ttitle: lang.get(\"showURL_alt\"),\n\t\t\t\tbuttons: [lang.get(\"ok_action\")],\n\t\t\t\tdefaultId: 0,\n\t\t\t\tmessage: lang.get(\"couldNotOpenLink_msg\", { \"{link}\": details.url }),\n\t\t\t\ttype: \"error\",\n\t\t\t})\n\t\t})\n\t}\n\n\tprivate reRegisterShortcuts() {\n\t\tthis.localShortcut.unregisterAll(this._browserWindow)\n\n\t\tfor (const s of this.shortcuts) {\n\t\t\t// build the accelerator string localShortcut understands\n\t\t\tlet shortcutString = \"\"\n\t\t\tshortcutString += s.meta ? \"Command+\" : \"\"\n\t\t\tshortcutString += s.ctrl ? \"Control+\" : \"\"\n\t\t\tshortcutString += s.alt ? \"Alt+\" : \"\"\n\t\t\tshortcutString += s.shift ? \"Shift+\" : \"\"\n\t\t\tshortcutString += capitalizeFirstLetter(typedKeys(Keys).filter((k) => s.key === Keys[k])[0])\n\n\t\t\tthis.localShortcut.register(this._browserWindow, shortcutString, s.exec)\n\t\t}\n\t}\n\n\tprivate sendShortcutstoRender(): void {\n\t\t// delete exec since functions don't cross IPC anyway.\n\t\t// it will be replaced by () => true in the renderer thread\n\t\tconst webShortcuts = this.shortcuts.map((s) =>\n\t\t\tObject.assign({}, s, {\n\t\t\t\texec: null,\n\t\t\t}),\n\t\t)\n\n\t\tthis._desktopFacade.addShortcuts(webShortcuts)\n\t}\n\n\tprivate tryGoBack(): void {\n\t\tconst parsedUrl = url.parse(this._browserWindow.webContents.getURL())\n\n\t\tif (parsedUrl.pathname && !parsedUrl.pathname.endsWith(\"login\")) {\n\t\t\tthis._browserWindow.webContents.goBack()\n\t\t} else {\n\t\t\tlog.debug(TAG, \"Ignore back events on login page\")\n\t\t}\n\t}\n\n\tasync openMailBox(info: UserInfo, path?: string | null): Promise<void> {\n\t\tawait this._commonNativeFacade.openMailBox(info.userId, info.mailAddress!, path ?? null)\n\t\tthis.show()\n\t}\n\n\t// open at date?\n\tasync openCalendar(info: UserInfo): Promise<void> {\n\t\tawait this._commonNativeFacade.openCalendar(info.userId)\n\t\tthis.show()\n\t}\n\n\tsetContextMenuHandler(handler: (arg0: ContextMenuParams) => void) {\n\t\tconst wc = this._browserWindow.webContents\n\t\twc.on(\"context-menu\", (e, params) => handler(params))\n\t}\n\n\tgetUserId(): Id | null {\n\t\treturn this.userId\n\t}\n\n\tsetUserId(id: Id | null) {\n\t\tthis.userId = id\n\t}\n\n\tfindInPage(searchTerm: string, forward: boolean, matchCase: boolean, findNext: boolean): Promise<Result | null> {\n\t\tconst options = { forward, matchCase, findNext }\n\t\tthis.findingInPage = true\n\n\t\tif (searchTerm !== \"\") {\n\t\t\tthis.lastSearchRequest = [searchTerm, options]\n\n\t\t\tthis._browserWindow.webContents.findInPage(searchTerm, options)\n\n\t\t\treturn new Promise((resolve: (_: Result) => void, reject) => {\n\t\t\t\t// if the last search request is still ongoing, this will reject that requests' promise\n\t\t\t\t// we obviously don't care about that requests' result since we are already handling a new one\n\t\t\t\t// if the last request is done, this is a noOp\n\t\t\t\tthis.lastSearchPromiseReject(new CancelledError(\"search request was superseded\"))\n\n\t\t\t\t// make sure we can cancel this promise if we get a new search request before this one is done.\n\t\t\t\tthis.lastSearchPromiseReject = reject\n\n\t\t\t\tthis._browserWindow.webContents // the last listener might not have fired yet\n\t\t\t\t\t.removeAllListeners(\"found-in-page\")\n\t\t\t\t\t.once(\"found-in-page\", (ev, res: Result) => {\n\t\t\t\t\t\tthis.lastSearchPromiseReject = noOp\n\t\t\t\t\t\tresolve(res)\n\t\t\t\t\t})\n\t\t\t}).catch((e) => {\n\t\t\t\t// findInPage might reject if requests come too quickly\n\t\t\t\t// if it's rejecting for another reason we'll have logs\n\t\t\t\tif (!(e instanceof CancelledError)) log.debug(\"findInPage reject: \", e)\n\t\t\t\treturn null\n\t\t\t})\n\t\t} else {\n\t\t\tthis.stopFindInPage()\n\t\t\treturn Promise.resolve(null)\n\t\t}\n\t}\n\n\tstopFindInPage() {\n\t\tthis.findingInPage = false\n\t\tthis.lastSearchRequest = null\n\n\t\tthis._browserWindow.webContents.stopFindInPage(\"keepSelection\")\n\t}\n\n\t/**\n\t * make it known to the window if the search overlay is focused.\n\t * used to check if enter events need to be caught to search the next result\n\t * @param state whether the search bar is focused right now\n\t * @param force ignores skipnextblur\n\t */\n\tsetSearchOverlayState(state: boolean, force: boolean) {\n\t\tif (!force && !state && this.skipNextSearchBarBlur) {\n\t\t\tthis.skipNextSearchBarBlur = false\n\t\t\treturn\n\t\t}\n\n\t\tthis.findingInPage = state\n\t}\n\n\tprivate toggleDevTools(): void {\n\t\tconst wc = this._browserWindow.webContents\n\n\t\tif (wc.isDevToolsOpened()) {\n\t\t\twc.closeDevTools()\n\t\t} else {\n\t\t\twc.openDevTools({\n\t\t\t\tmode: \"undocked\",\n\t\t\t})\n\t\t}\n\t}\n\n\tprivate toggleFullScreen(): void {\n\t\tthis._browserWindow.setFullScreen(!this._browserWindow.isFullScreen())\n\t}\n\n\tprivate printMail() {\n\t\tthis._desktopFacade.print()\n\t}\n\n\tprivate openFindInPage(): void {\n\t\tthis._desktopFacade.openFindInPage()\n\t}\n\n\tsetBounds(bounds: WindowBounds) {\n\t\tthis._browserWindow.setFullScreen(bounds.fullscreen)\n\n\t\tthis.setZoomFactor(bounds.scale)\n\t\tif (bounds.fullscreen) return\n\n\t\tthis._browserWindow.setBounds(bounds.rect)\n\n\t\tif (process.platform !== \"linux\") return\n\t\tif (this.setBoundsTimeout) clearTimeout(this.setBoundsTimeout)\n\t\tthis.setBoundsTimeout = setTimeout(() => {\n\t\t\tif (this._browserWindow.isDestroyed()) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst newRect = this._browserWindow.getBounds()\n\n\t\t\tif (bounds.rect.y !== newRect.y) {\n\t\t\t\t// window was moved by some bug/OS interaction, so we move it back twice the distance.\n\t\t\t\t// should end up right where we want it. https://github.com/electron/electron/issues/10388\n\t\t\t\tthis._browserWindow.setPosition(newRect.x, newRect.y + 2 * (bounds.rect.y - newRect.y))\n\t\t\t}\n\t\t}, 200)\n\t}\n\n\tgetBounds(): WindowBounds {\n\t\treturn {\n\t\t\tfullscreen: this._browserWindow.isFullScreen(),\n\t\t\trect: this._browserWindow.getBounds(),\n\t\t\tscale: 1, // turns out we can't really trust wc.getZoomFactor\n\t\t}\n\t}\n\n\tprivate async getInitialUrl(additionalQueryParams: Record<string, string | boolean>): Promise<string> {\n\t\tconst url = new URL(VIRTUAL_APP_URL)\n\n\t\tfor (const [key, value] of typedEntries(additionalQueryParams)) {\n\t\t\turl.searchParams.append(key, String(value))\n\t\t}\n\n\t\turl.searchParams.append(\"platformId\", process.platform)\n\t\tconst theme = await this.themeFacade.getCurrentThemeWithFallback()\n\t\turl.searchParams.append(\"theme\", JSON.stringify(theme))\n\t\treturn url.toString()\n\t}\n}\n"]}