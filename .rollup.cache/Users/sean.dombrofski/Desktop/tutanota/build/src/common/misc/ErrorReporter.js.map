{"version":3,"file":"ErrorReporter.js","sourceRoot":"","sources":["../../../../src/common/misc/ErrorReporter.ts"],"names":[],"mappings":"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","sourcesContent":["import stream from \"mithril/stream\"\nimport { TextField, TextFieldType } from \"../gui/base/TextField.js\"\nimport { lang } from \"./LanguageViewModel\"\nimport { Dialog, DialogType } from \"../gui/base/Dialog\"\nimport * as notificationOverlay from \"../gui/base/NotificationOverlay\"\nimport m from \"mithril\"\nimport { Checkbox } from \"../gui/base/Checkbox.js\"\nimport { Button, ButtonType } from \"../gui/base/Button.js\"\nimport { ExpanderButton, ExpanderPanel } from \"../gui/base/Expander\"\nimport { downcast, ErrorInfo, errorToString, neverNull, typedKeys, uint8ArrayToString } from \"@tutao/tutanota-utils\"\nimport { locator } from \"../api/main/CommonLocator\"\nimport { AccountType, ConversationType, Keys, MailMethod } from \"../api/common/TutanotaConstants\"\nimport { copyToClipboard } from \"./ClipboardUtils\"\nimport { px } from \"../gui/size\"\nimport { isApp, isDesktop, Mode } from \"../api/common/Env\"\nimport { RecipientType } from \"../api/common/recipients/Recipient.js\"\nimport { createLogFile } from \"../api/common/Logger.js\"\nimport { DataFile } from \"../api/common/DataFile.js\"\nimport { convertTextToHtml } from \"./Formatter.js\"\nimport { ReportErrorService } from \"../api/entities/monitor/Services.js\"\nimport { createErrorReportData, createErrorReportFile, createReportErrorIn } from \"../api/entities/monitor/TypeRefs.js\"\nimport { ErrorReportClientType } from \"./ClientConstants.js\"\nimport { client } from \"./ClientDetector.js\"\nimport { BubbleButton } from \"../gui/base/buttons/BubbleButton.js\"\nimport { getTimeZone } from \"../calendar/date/CalendarUtils.js\"\n\ntype FeedbackContent = {\n\tmessage: string\n\tsubject: string\n\tlogs: Array<DataFile>\n}\n\n/**\n * Displays a notification overlay that some error has occurred with an option to send an error report or dismiss the notification. In either case the\n * error can be ignored.\n *\n * If report is pressed then it shows a report dialog with message field and an overview of the sent data.\n */\nexport async function showErrorNotification(e: ErrorInfo): Promise<{ ignored: boolean }> {\n\tconst loggedIn = locator.logins.isUserLoggedIn()\n\n\tconst logs = await getLogAttachments()\n\n\tconst { decision, ignore } = await showErrorOverlay()\n\tif (decision === \"cancel\") {\n\t\treturn { ignored: ignore }\n\t}\n\n\tconst preparedContent = prepareFeedbackContent(e, loggedIn)\n\n\tconst reportDialogResult = await showReportDialog(preparedContent.subject, preparedContent.message, logs)\n\tif (reportDialogResult.decision === \"cancel\") {\n\t\treturn { ignored: ignore }\n\t}\n\tpreparedContent.logs = reportDialogResult.sendLogs ? logs : []\n\tpreparedContent.message = reportDialogResult.userMessage + \"\\n\" + preparedContent.message\n\n\tsendToServer(e, reportDialogResult.userMessage, reportDialogResult.sendLogs ? logs : [])\n\tsendFeedbackMail(preparedContent)\n\n\treturn { ignored: ignore }\n}\n\nasync function showErrorOverlay(): Promise<{ decision: \"send\" | \"cancel\"; ignore: boolean }> {\n\tlet ignore = false\n\tconst decision: \"send\" | \"cancel\" = await new Promise((resolve) => {\n\t\tnotificationOverlay.show(\n\t\t\t{\n\t\t\t\tview: () =>\n\t\t\t\t\tm(\"\", [\n\t\t\t\t\t\t\"An error occurred\",\n\t\t\t\t\t\tm(Checkbox, {\n\t\t\t\t\t\t\tlabel: () => \"Ignore the error for this session\",\n\t\t\t\t\t\t\tchecked: ignore,\n\t\t\t\t\t\t\tonChecked: (checked) => (ignore = checked),\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: \"close_alt\",\n\t\t\t\tclick: () => resolve(\"cancel\"),\n\t\t\t},\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\tlabel: \"sendReport_label\",\n\t\t\t\t\tclick: () => resolve(\"send\"),\n\t\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t\t},\n\t\t\t],\n\t\t)\n\t})\n\treturn { decision, ignore }\n}\n\nfunction showReportDialog(\n\tsubject: string,\n\tmessage: string,\n\tlogs: readonly DataFile[],\n): Promise<{ decision: \"send\"; sendLogs: boolean; userMessage: string } | { decision: \"cancel\" }> {\n\tlet sendLogs = true\n\tlet detailsExpanded = false\n\tlet userMessage = \"\"\n\n\tconst dialogContent = {\n\t\tview: () => {\n\t\t\treturn [\n\t\t\t\tm(TextField, {\n\t\t\t\t\tlabel: \"yourMessage_label\",\n\t\t\t\t\thelpLabel: () => lang.get(\"feedbackOnErrorInfo_msg\"),\n\t\t\t\t\tvalue: userMessage,\n\t\t\t\t\ttype: TextFieldType.Area,\n\t\t\t\t\toninput: (value) => (userMessage = value),\n\t\t\t\t}),\n\t\t\t\tm(Checkbox, {\n\t\t\t\t\tlabel: () => lang.get(\"sendLogs_action\"),\n\t\t\t\t\thelpLabel: \"sendLogsInfo_msg\",\n\t\t\t\t\tchecked: sendLogs,\n\t\t\t\t\tonChecked: (checked) => (sendLogs = checked),\n\t\t\t\t}),\n\t\t\t\tm(\n\t\t\t\t\t\".flex.flex-column.space-around.items-center\",\n\t\t\t\t\tlogs.map((l) =>\n\t\t\t\t\t\tm(BubbleButton, {\n\t\t\t\t\t\t\tlabel: lang.makeTranslation(\"filename\", l.name),\n\t\t\t\t\t\t\tonclick: () => showLogDialog(l.name, uint8ArrayToString(\"utf-8\", (l as DataFile).data)),\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t\tm(\n\t\t\t\t\t\".flex-end\",\n\t\t\t\t\tm(\n\t\t\t\t\t\t\".right\",\n\t\t\t\t\t\tm(ExpanderButton, {\n\t\t\t\t\t\t\tlabel: \"details_label\",\n\t\t\t\t\t\t\texpanded: detailsExpanded,\n\t\t\t\t\t\t\tonExpandedChange: (expanded) => (detailsExpanded = expanded),\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t\tm(\n\t\t\t\t\tExpanderPanel,\n\t\t\t\t\t{\n\t\t\t\t\t\texpanded: detailsExpanded,\n\t\t\t\t\t},\n\t\t\t\t\tm(\".selectable\", [m(\".selectable\", subject), message.split(\"\\n\").map((l) => (l.trim() === \"\" ? m(\".pb\", \"\") : m(\"\", l)))]),\n\t\t\t\t),\n\t\t\t]\n\t\t},\n\t}\n\n\treturn new Promise((resolve) => {\n\t\tDialog.showActionDialog({\n\t\t\tokActionTextId: \"send_action\",\n\t\t\ttitle: \"sendErrorReport_action\",\n\t\t\ttype: DialogType.EditMedium,\n\t\t\tchild: dialogContent,\n\t\t\tokAction: (dialog: Dialog) => {\n\t\t\t\tresolve({ decision: \"send\", sendLogs, userMessage })\n\t\t\t\tdialog.close()\n\t\t\t},\n\t\t\tcancelAction: () => resolve({ decision: \"cancel\" }),\n\t\t})\n\t})\n}\n\n/**\n * show the contents of a log file in a large dialog.\n * @param heading the title of the dialog\n * @param text the text to display\n */\nasync function showLogDialog(heading: string, text: string) {\n\tlet logDialog: Dialog\n\tconst closeLogDialog = () => logDialog?.close()\n\n\tlogDialog = Dialog.largeDialog(\n\t\t{\n\t\t\tright: [\n\t\t\t\t{\n\t\t\t\t\tlabel: \"ok_action\",\n\t\t\t\t\tclick: closeLogDialog,\n\t\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t\t},\n\t\t\t],\n\t\t\tmiddle: lang.makeTranslation(\"heading\", heading),\n\t\t},\n\t\t{\n\t\t\tview: () => m(\".white-space-pre.pt.pb.selectable\", text),\n\t\t},\n\t)\n\t\t.addShortcut({\n\t\t\tkey: Keys.ESC,\n\t\t\texec: closeLogDialog,\n\t\t\thelp: \"close_alt\",\n\t\t})\n\t\t.setCloseHandler(closeLogDialog)\n\t\t.show()\n}\n\nexport async function showErrorDialogNotLoggedIn(e: ErrorInfo): Promise<void> {\n\tconst content = prepareFeedbackContent(e, false)\n\tconst expanded = stream(false)\n\tconst message = content.subject + \"\\n\\n\" + content.message\n\n\tconst info = () => [\n\t\tm(\n\t\t\t\".flex.col.items-end.plr\",\n\t\t\t{\n\t\t\t\tstyle: {\n\t\t\t\t\tmarginTop: \"-16px\",\n\t\t\t\t},\n\t\t\t},\n\t\t\t[\n\t\t\t\tm(\n\t\t\t\t\t\"div.mr-negative-xs\",\n\t\t\t\t\tm(ExpanderButton, {\n\t\t\t\t\t\texpanded: expanded(),\n\t\t\t\t\t\tonExpandedChange: expanded,\n\t\t\t\t\t\tlabel: \"showMore_action\",\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t],\n\t\t),\n\t\tm(\n\t\t\tExpanderPanel,\n\t\t\t{\n\t\t\t\texpanded: expanded(),\n\t\t\t},\n\t\t\t[\n\t\t\t\tm(\n\t\t\t\t\t\".flex-end.plr\",\n\t\t\t\t\tm(Button, {\n\t\t\t\t\t\tlabel: \"copy_action\",\n\t\t\t\t\t\tclick: () => copyToClipboard(message),\n\t\t\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t\tm(\n\t\t\t\t\t\".plr.selectable.pb.scroll.text-pre\",\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\theight: px(200),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tmessage,\n\t\t\t\t),\n\t\t\t],\n\t\t),\n\t]\n\n\treturn Dialog.message(\"unknownError_msg\", info)\n}\n\nexport async function sendFeedbackMail(content: FeedbackContent): Promise<void> {\n\tconst name = \"\"\n\tconst mailAddress = \"reports@tutao.de\"\n\t// We want to treat what we have as text, not as HTML so we escape it. This is an easy way to do it.\n\tconst escapedBody = new Option(content.message).innerHTML\n\tconst logins = locator.logins\n\tconst draft = await locator.mailFacade.createDraft({\n\t\tsubject: content.subject,\n\t\tbodyText: convertTextToHtml(escapedBody),\n\t\tsenderMailAddress: neverNull(logins.getUserController().userGroupInfo.mailAddress),\n\t\tsenderName: \"\",\n\t\ttoRecipients: [\n\t\t\t{\n\t\t\t\tname,\n\t\t\t\taddress: mailAddress,\n\t\t\t},\n\t\t],\n\t\tccRecipients: [],\n\t\tbccRecipients: [],\n\t\tconversationType: ConversationType.NEW,\n\t\tpreviousMessageId: null,\n\t\tattachments: content.logs,\n\t\tconfidential: true,\n\t\treplyTos: [],\n\t\tmethod: MailMethod.NONE,\n\t})\n\tawait locator.mailFacade.sendDraft(\n\t\tdraft,\n\t\t[\n\t\t\t{\n\t\t\t\tname,\n\t\t\t\taddress: mailAddress,\n\t\t\t\ttype: RecipientType.INTERNAL,\n\t\t\t\tcontact: null,\n\t\t\t},\n\t\t],\n\t\t\"de\",\n\t)\n}\n\nasync function sendToServer(error: ErrorInfo, userMessage: string | null, logs: DataFile[]) {\n\tfunction getReportingClientType(): ErrorReportClientType {\n\t\tif (env.mode === Mode.Browser) {\n\t\t\treturn ErrorReportClientType.Browser\n\t\t} else {\n\t\t\tswitch (env.platformId) {\n\t\t\t\tcase \"ios\":\n\t\t\t\t\treturn ErrorReportClientType.Ios\n\t\t\t\tcase \"android\":\n\t\t\t\t\treturn ErrorReportClientType.Android\n\t\t\t\tcase \"darwin\":\n\t\t\t\t\treturn ErrorReportClientType.MacOS\n\t\t\t\tcase \"linux\":\n\t\t\t\t\treturn ErrorReportClientType.Linux\n\t\t\t\tcase \"win32\":\n\t\t\t\t\treturn ErrorReportClientType.Windows\n\t\t\t\tdefault:\n\t\t\t\t\treturn ErrorReportClientType.Linux\n\t\t\t}\n\t\t}\n\t}\n\n\tconst clientType = getReportingClientType()\n\n\tconst errorData = createReportErrorIn({\n\t\tdata: createErrorReportData({\n\t\t\tclientType,\n\t\t\tappVersion: env.versionNumber,\n\t\t\tuserId: locator.logins.getUserController().userId,\n\t\t\terrorClass: error.name ?? \"?\",\n\t\t\terrorMessage: error.message,\n\t\t\tuserMessage: userMessage,\n\t\t\tstackTrace: error.stack ?? \"\",\n\t\t\tadditionalInfo: client.userAgent,\n\t\t\ttime: new Date(),\n\t\t}),\n\t\tfiles: logs.map((log) => {\n\t\t\tconst stringData = uint8ArrayToString(\"utf-8\", log.data)\n\t\t\treturn createErrorReportFile({\n\t\t\t\tname: log.name,\n\t\t\t\tcontent: stringData,\n\t\t\t})\n\t\t}),\n\t})\n\tawait locator.serviceExecutor.post(ReportErrorService, errorData)\n}\n\nfunction prepareFeedbackContent(error: ErrorInfo, loggedIn: boolean): FeedbackContent {\n\tconst timestamp = new Date()\n\tlet { message, client, type } = clientInfoString(timestamp, loggedIn)\n\n\tif (error) {\n\t\tmessage += errorToString(error)\n\t}\n\n\tconst subject = `Feedback v${env.versionNumber} - ${error && error.name ? error.name : \"?\"} - ${type} - ${client}`\n\treturn {\n\t\tmessage,\n\t\tsubject,\n\t\tlogs: [],\n\t}\n}\n\nexport function clientInfoString(\n\ttimestamp: Date,\n\tloggedIn: boolean,\n): {\n\tmessage: string\n\tclient: string\n\ttype: string\n} {\n\tconst type = loggedIn\n\t\t? neverNull(typedKeys(AccountType).find((typeName) => AccountType[typeName] === locator.logins.getUserController().user.accountType))\n\t\t: \"UNKNOWN\"\n\n\tconst client = (() => {\n\t\tswitch (env.mode) {\n\t\t\tcase Mode.Browser:\n\t\t\tcase Mode.Test:\n\t\t\t\treturn env.mode\n\t\t\tdefault:\n\t\t\t\treturn env.platformId ?? \"\"\n\t\t}\n\t})()\n\n\tlet message = `\\n\\n Client: ${client}`\n\tmessage += `\\n Type: ${type}`\n\tmessage += `\\n Tutanota version: ${env.versionNumber}`\n\tmessage += `\\n Timestamp (UTC): ${timestamp.toUTCString()}`\n\tmessage += `\\n Time zone: ${getTimeZone()}`\n\tmessage += `\\n User agent: ${navigator.userAgent}\\n`\n\treturn {\n\t\tmessage,\n\t\tclient,\n\t\ttype,\n\t}\n}\n\nexport async function getLogAttachments(timestamp?: Date): Promise<Array<DataFile>> {\n\tconst logs: Array<DataFile> = []\n\tconst global = downcast<Window>(window)\n\n\tif (global.logger) {\n\t\tconst mainEntries = global.logger.getEntries()\n\t\tconst mainLogFile = createLogFile(mainEntries.join(\"\\n\"), \"main\", timestamp?.getTime())\n\t\tlogs.push(mainLogFile)\n\t\tconst workerLogEntries = await locator.workerFacade.getLog()\n\t\tconst workerLogFile = await createLogFile(workerLogEntries.join(\"\\n\"), \"worker\", timestamp?.getTime())\n\t\tlogs.push(workerLogFile)\n\t}\n\n\tif (isDesktop() || isApp()) {\n\t\tconst nativeLog = await locator.commonSystemFacade.getLog()\n\t\tconst nativeLogFile = createLogFile(nativeLog, isDesktop() ? \"desktop\" : \"device\", timestamp?.getTime())\n\t\tlogs.push(nativeLogFile)\n\t}\n\n\treturn logs\n}\n"]}