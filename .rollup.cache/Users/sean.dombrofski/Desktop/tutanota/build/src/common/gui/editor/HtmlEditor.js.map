{"version":3,"file":"HtmlEditor.js","sourceRoot":"","sources":["../../../../../src/common/gui/editor/HtmlEditor.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Component } from \"mithril\"\nimport stream from \"mithril/stream\"\nimport { Editor } from \"./Editor.js\"\nimport type { TranslationKey, MaybeTranslation } from \"../../misc/LanguageViewModel\"\nimport { lang } from \"../../misc/LanguageViewModel\"\nimport { px } from \"../size\"\nimport { htmlSanitizer } from \"../../misc/HtmlSanitizer\"\nimport { assertNotNull } from \"@tutao/tutanota-utils\"\nimport { DropDownSelector } from \"../base/DropDownSelector.js\"\nimport { RichTextToolbar, RichTextToolbarAttrs } from \"../base/RichTextToolbar.js\"\n\nexport enum HtmlEditorMode {\n\tHTML = \"html\",\n\tWYSIWYG = \"what you see is what you get\",\n}\n\nexport const HTML_EDITOR_LINE_HEIGHT: number = 24 // Height required for one line in the HTML editor\n\nexport class HtmlEditor implements Component {\n\teditor: Editor\n\tprivate mode = HtmlEditorMode.WYSIWYG\n\tprivate active = false\n\tprivate domTextArea: HTMLTextAreaElement | null = null\n\tprivate _showBorders = false\n\tprivate minHeight: number | null = null\n\tprivate placeholderId: TranslationKey | null = null\n\tprivate placeholderDomElement: HTMLElement | null = null\n\tprivate value = stream(\"\")\n\tprivate htmlMonospace = true\n\tprivate modeSwitcherLabel: MaybeTranslation | null = null\n\tprivate toolbarEnabled = false\n\tprivate toolbarAttrs: Omit<RichTextToolbarAttrs, \"editor\"> = {}\n\tprivate staticLineAmount: number | null = null // Static amount of lines the editor shall allow at all times\n\n\tconstructor(private label?: MaybeTranslation, private readonly injections?: () => Children) {\n\t\tthis.editor = new Editor(null, (html) => htmlSanitizer.sanitizeFragment(html, { blockExternalContent: false }).fragment, null)\n\t\tthis.view = this.view.bind(this)\n\t\tthis.initializeEditorListeners()\n\t}\n\n\tview(): Children {\n\t\tconst modeSwitcherLabel = this.modeSwitcherLabel\n\t\tlet borderClasses = this._showBorders\n\t\t\t? this.active && this.editor.isEnabled()\n\t\t\t\t? \".editor-border-active.border-radius\"\n\t\t\t\t: \".editor-border.border-radius.\" + (modeSwitcherLabel != null ? \".editor-no-top-border\" : \"\")\n\t\t\t: \"\"\n\n\t\tconst renderedInjections = this.injections?.() ?? null\n\n\t\tconst getPlaceholder = () =>\n\t\t\t!this.active && this.isEmpty()\n\t\t\t\t? m(\n\t\t\t\t\t\t\".abs.text-ellipsis.noselect.z1.i.pr-s\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toncreate: (vnode) => (this.placeholderDomElement = vnode.dom as HTMLElement),\n\t\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t\t\tthis.mode === HtmlEditorMode.WYSIWYG ? assertNotNull(this.editor.domElement).focus() : assertNotNull(this.domTextArea).focus(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tthis.placeholderId ? lang.get(this.placeholderId) : \"\",\n\t\t\t\t  )\n\t\t\t\t: null\n\n\t\treturn m(\".html-editor\" + (this.mode === HtmlEditorMode.WYSIWYG ? \".text-break\" : \"\"), { class: this.editor.isEnabled() ? \"\" : \"disabled\" }, [\n\t\t\tmodeSwitcherLabel != null\n\t\t\t\t? m(DropDownSelector, {\n\t\t\t\t\t\tlabel: modeSwitcherLabel,\n\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t{ name: lang.get(\"richText_label\"), value: HtmlEditorMode.WYSIWYG },\n\t\t\t\t\t\t\t{ name: lang.get(\"htmlSourceCode_label\"), value: HtmlEditorMode.HTML },\n\t\t\t\t\t\t],\n\t\t\t\t\t\tselectedValue: this.mode,\n\t\t\t\t\t\tselectionChangedHandler: (mode: HtmlEditorMode) => {\n\t\t\t\t\t\t\tthis.mode = mode\n\t\t\t\t\t\t\tthis.setValue(this.value())\n\t\t\t\t\t\t\tthis.initializeEditorListeners()\n\t\t\t\t\t\t},\n\t\t\t\t  })\n\t\t\t\t: null,\n\t\t\tthis.label ? m(\".small.mt-form\", lang.getTranslationText(this.label)) : null,\n\t\t\tm(borderClasses, [\n\t\t\t\tgetPlaceholder(),\n\t\t\t\tthis.mode === HtmlEditorMode.WYSIWYG\n\t\t\t\t\t? m(\".wysiwyg.rel.overflow-hidden.selectable\", [\n\t\t\t\t\t\t\tthis.editor.isEnabled() && (this.toolbarEnabled || renderedInjections)\n\t\t\t\t\t\t\t\t? [\n\t\t\t\t\t\t\t\t\t\tm(\".flex-end.sticky.pb-2\", [\n\t\t\t\t\t\t\t\t\t\t\tthis.toolbarEnabled ? m(RichTextToolbar, Object.assign({ editor: this.editor }, this.toolbarAttrs)) : null,\n\t\t\t\t\t\t\t\t\t\t\trenderedInjections,\n\t\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\t\tm(\"hr.hr.mb-s\"),\n\t\t\t\t\t\t\t\t  ]\n\t\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\t\tm(this.editor, {\n\t\t\t\t\t\t\t\toncreate: () => {\n\t\t\t\t\t\t\t\t\tthis.editor.initialized.promise.then(() => this.editor.setHTML(this.value()))\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonremove: () => {\n\t\t\t\t\t\t\t\t\tthis.value(this.getValue())\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t  ])\n\t\t\t\t\t: m(\n\t\t\t\t\t\t\t\".html\",\n\t\t\t\t\t\t\tm(\"textarea.input-area.selectable\", {\n\t\t\t\t\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\t\t\t\t\tthis.domTextArea = vnode.dom as HTMLTextAreaElement\n\t\t\t\t\t\t\t\t\tif (!this.isEmpty()) {\n\t\t\t\t\t\t\t\t\t\tthis.domTextArea.value = this.value()\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonfocus: () => this.focus(),\n\t\t\t\t\t\t\t\tonblur: () => this.blur(),\n\t\t\t\t\t\t\t\toninput: () => {\n\t\t\t\t\t\t\t\t\tif (this.domTextArea) {\n\t\t\t\t\t\t\t\t\t\tthis.domTextArea.style.height = \"0px\"\n\t\t\t\t\t\t\t\t\t\tthis.domTextArea.style.height = this.domTextArea.scrollHeight + \"px\"\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tstyle: this.staticLineAmount\n\t\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\t\t\"max-height\": px(this.staticLineAmount * HTML_EDITOR_LINE_HEIGHT),\n\t\t\t\t\t\t\t\t\t\t\t\"min-height\": px(this.staticLineAmount * HTML_EDITOR_LINE_HEIGHT),\n\t\t\t\t\t\t\t\t\t\t\toverflow: \"scroll\",\n\t\t\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t\t\t: {\n\t\t\t\t\t\t\t\t\t\t\t\"font-family\": this.htmlMonospace ? \"monospace\" : \"inherit\",\n\t\t\t\t\t\t\t\t\t\t\t\"min-height\": this.minHeight ? px(this.minHeight) : \"initial\",\n\t\t\t\t\t\t\t\t\t  },\n\t\t\t\t\t\t\t\tdisabled: !this.editor.isEnabled(),\n\t\t\t\t\t\t\t\treadonly: this.editor.isReadOnly(),\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t  ),\n\t\t\t]),\n\t\t])\n\t}\n\n\tprivate initializeEditorListeners() {\n\t\tthis.editor.initialized.promise.then(() => {\n\t\t\tconst dom = assertNotNull(this.editor?.domElement)\n\t\t\tdom.onfocus = () => this.focus()\n\t\t\tdom.onblur = () => this.blur()\n\t\t})\n\t}\n\n\tprivate focus() {\n\t\tthis.active = true\n\t\tm.redraw()\n\t}\n\n\tprivate blur() {\n\t\tthis.active = false\n\t\tif (this.mode === HtmlEditorMode.WYSIWYG) {\n\t\t\tthis.value(this.editor.getValue())\n\t\t} else {\n\t\t\tthis.value(assertNotNull(this.domTextArea).value)\n\t\t}\n\t}\n\n\tsetModeSwitcher(label: MaybeTranslation): this {\n\t\tthis.modeSwitcherLabel = label\n\t\treturn this\n\t}\n\n\tshowBorders(): HtmlEditor {\n\t\tthis._showBorders = true\n\t\treturn this\n\t}\n\n\tsetMinHeight(height: number): HtmlEditor {\n\t\tthis.minHeight = height\n\t\tthis.editor.setMinHeight(height)\n\t\treturn this\n\t}\n\n\t/**\n\t * Sets a static amount 'n' of lines the Editor should always render/allow.\n\t * When using n+1 lines, the editor will instead begin to be scrollable.\n\t * Currently, this overwrites min-height.\n\t */\n\tsetStaticNumberOfLines(numberOfLines: number): HtmlEditor {\n\t\tthis.staticLineAmount = numberOfLines\n\t\tthis.editor.setStaticNumberOfLines(numberOfLines)\n\t\treturn this\n\t}\n\n\tsetPlaceholderId(placeholderId: TranslationKey): HtmlEditor {\n\t\tthis.placeholderId = placeholderId\n\t\treturn this\n\t}\n\n\tgetValue(): string {\n\t\tif (this.mode === HtmlEditorMode.WYSIWYG) {\n\t\t\tif (this.editor.isAttached()) {\n\t\t\t\treturn this.editor.getHTML()\n\t\t\t} else {\n\t\t\t\treturn this.value()\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.domTextArea) {\n\t\t\t\treturn htmlSanitizer.sanitizeHTML(this.domTextArea.value, { blockExternalContent: false }).html\n\t\t\t} else {\n\t\t\t\treturn this.value()\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * squire HTML editor usually has some HTML when appearing empty, sometimes we don't want that content.\n\t */\n\tgetTrimmedValue(): string {\n\t\treturn this.isEmpty() ? \"\" : this.getValue()\n\t}\n\n\tsetValue(html: string): HtmlEditor {\n\t\tif (this.mode === HtmlEditorMode.WYSIWYG) {\n\t\t\tthis.editor.initialized.promise.then(() => this.editor.setHTML(html))\n\t\t} else if (this.domTextArea) {\n\t\t\tthis.domTextArea.value = html\n\t\t}\n\t\tthis.value(html)\n\t\treturn this\n\t}\n\n\tsetShowOutline(show: boolean) {\n\t\tthis.editor.setShowOutline(show)\n\t\treturn this\n\t}\n\n\tisActive(): boolean {\n\t\treturn this.active\n\t}\n\n\tisEmpty(): boolean {\n\t\t// either nothing or default squire content\n\t\treturn this.value() === \"\" || new RegExp(/^<div( dir=[\"'][A-z]*[\"'])?><br><\\/div>$/).test(this.value())\n\t}\n\n\t/** set whether the dialog should be editable.*/\n\tsetEnabled(enabled: boolean): HtmlEditor {\n\t\tthis.editor.setEnabled(enabled)\n\t\tif (this.domTextArea) {\n\t\t\tthis.domTextArea.disabled = !enabled\n\t\t}\n\t\treturn this\n\t}\n\n\tsetReadOnly(readOnly: boolean): this {\n\t\tthis.editor.setReadOnly(readOnly)\n\t\tif (this.domTextArea) {\n\t\t\tthis.domTextArea.readOnly = readOnly\n\t\t}\n\t\treturn this\n\t}\n\n\tsetMode(mode: HtmlEditorMode): HtmlEditor {\n\t\tthis.mode = mode\n\t\treturn this\n\t}\n\n\tsetHtmlMonospace(monospace: boolean): HtmlEditor {\n\t\tthis.htmlMonospace = monospace\n\t\treturn this\n\t}\n\n\t/** show the rich text toolbar */\n\tenableToolbar(): this {\n\t\tthis.toolbarEnabled = true\n\t\treturn this\n\t}\n\n\tisToolbarEnabled(): boolean {\n\t\treturn this.toolbarEnabled\n\t}\n\n\t/** toggle the visibility of the rich text toolbar */\n\ttoggleToolbar(): this {\n\t\tthis.toolbarEnabled = !this.toolbarEnabled\n\t\treturn this\n\t}\n\n\tsetToolbarOptions(attrs: Omit<RichTextToolbarAttrs, \"editor\">): this {\n\t\tthis.toolbarAttrs = attrs\n\t\treturn this\n\t}\n}\n"]}