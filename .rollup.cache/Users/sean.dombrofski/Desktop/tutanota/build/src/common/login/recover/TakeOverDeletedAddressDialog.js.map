{"version":3,"file":"TakeOverDeletedAddressDialog.js","sourceRoot":"","sources":["../../../../../src/common/login/recover/TakeOverDeletedAddressDialog.ts"],"names":[],"mappings":"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","sourcesContent":["import m from \"mithril\"\nimport stream from \"mithril/stream\"\nimport { AccessBlockedError, AccessDeactivatedError, InvalidDataError, NotAuthenticatedError, TooManyRequestsError } from \"../../api/common/error/RestError\"\nimport { showProgressDialog } from \"../../gui/dialogs/ProgressDialog\"\nimport { isMailAddress } from \"../../misc/FormatValidator.js\"\nimport { InfoLink, lang } from \"../../misc/LanguageViewModel.js\"\nimport { Autocomplete, TextField, TextFieldType } from \"../../gui/base/TextField.js\"\nimport { Dialog, DialogType } from \"../../gui/base/Dialog\"\nimport { HtmlEditor, HtmlEditorMode } from \"../../gui/editor/HtmlEditor\"\nimport { locator } from \"../../api/main/CommonLocator\"\nimport { assertMainOrNode } from \"../../api/common/Env\"\nimport { MoreInfoLink } from \"../../misc/news/MoreInfoLink.js\"\n\nassertMainOrNode()\n\nexport function showTakeOverDialog(mailAddress: string, password: string): Dialog {\n\tconst targetAccountAddress = stream(\"\")\n\tconst editor = new HtmlEditor(\"recoveryCode_label\")\n\teditor.setMode(HtmlEditorMode.HTML)\n\teditor.setHtmlMonospace(true)\n\teditor.setMinHeight(80)\n\teditor.showBorders()\n\tconst takeoverDialog = Dialog.showActionDialog({\n\t\ttitle: \"help_label\",\n\t\ttype: DialogType.EditSmall,\n\t\tchild: {\n\t\t\tview: () => {\n\t\t\t\treturn [\n\t\t\t\t\tm(\".mt\", lang.get(\"takeOverUnusedAddress_msg\")),\n\t\t\t\t\tm(MoreInfoLink, { link: InfoLink.InactiveAccounts }),\n\t\t\t\t\tm(TextField, {\n\t\t\t\t\t\tlabel: \"targetAddress_label\",\n\t\t\t\t\t\tvalue: targetAccountAddress(),\n\t\t\t\t\t\tautocompleteAs: Autocomplete.email,\n\t\t\t\t\t\ttype: TextFieldType.Email,\n\t\t\t\t\t\toninput: targetAccountAddress,\n\t\t\t\t\t}),\n\t\t\t\t\tm(editor),\n\t\t\t\t]\n\t\t\t},\n\t\t},\n\t\tokAction: () => {\n\t\t\tconst cleanTargetAccountAddress = targetAccountAddress().trim().toLowerCase()\n\t\t\tconst cleanMailAddress = mailAddress.trim().toLowerCase()\n\t\t\tconst cleanRecoveryCode = editor.getValue().replace(/\\s/g, \"\").toLowerCase()\n\n\t\t\tif (!isMailAddress(cleanMailAddress, true)) {\n\t\t\t\tDialog.message(\"mailAddressInvalid_msg\")\n\t\t\t} else if (!isMailAddress(cleanTargetAccountAddress, true)) {\n\t\t\t\tDialog.message(\"mailAddressInvalid_msg\")\n\t\t\t} else {\n\t\t\t\tshowProgressDialog(\n\t\t\t\t\t\"pleaseWait_msg\",\n\t\t\t\t\tlocator.loginFacade.takeOverDeletedAddress(cleanMailAddress, password, cleanRecoveryCode, cleanTargetAccountAddress),\n\t\t\t\t)\n\t\t\t\t\t.then(() => Dialog.message(\"takeoverSuccess_msg\"))\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\ttakeoverDialog.close()\n\t\t\t\t\t\tm.route.set(\"/login\", {\n\t\t\t\t\t\t\tloginWith: cleanTargetAccountAddress,\n\t\t\t\t\t\t\tnoAutoLogin: true,\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t\t.catch((e) => handleError(e))\n\t\t\t}\n\t\t},\n\t\tcancelAction: () =>\n\t\t\tm.route.set(\"/login\", {\n\t\t\t\tnoAutoLogin: true,\n\t\t\t}),\n\t})\n\treturn takeoverDialog\n}\n\nfunction handleError(e: Error) {\n\tif (e instanceof NotAuthenticatedError) {\n\t\tDialog.message(\"loginFailed_msg\")\n\t} else if (e instanceof AccessBlockedError || e instanceof AccessDeactivatedError) {\n\t\tDialog.message(\"loginFailedOften_msg\")\n\t} else if (e instanceof InvalidDataError) {\n\t\tDialog.message(\"takeoverAccountInvalid_msg\")\n\t} else if (e instanceof TooManyRequestsError) {\n\t\tDialog.message(\"tooManyAttempts_msg\")\n\t} else {\n\t\tthrow e\n\t}\n}\n"]}