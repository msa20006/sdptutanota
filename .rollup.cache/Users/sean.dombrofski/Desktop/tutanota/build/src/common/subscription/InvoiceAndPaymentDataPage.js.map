{"version":3,"file":"InvoiceAndPaymentDataPage.js","sourceRoot":"","sources":["../../../../src/common/subscription/InvoiceAndPaymentDataPage.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children, Vnode, VnodeDOM } from \"mithril\"\nimport { Dialog, DialogType } from \"../gui/base/Dialog\"\nimport { lang, type TranslationKey } from \"../misc/LanguageViewModel\"\nimport type { UpgradeSubscriptionData } from \"./UpgradeSubscriptionWizard\"\nimport { InvoiceDataInput, InvoiceDataInputLocation } from \"./InvoiceDataInput\"\nimport { PaymentMethodInput } from \"./PaymentMethodInput\"\nimport stream from \"mithril/stream\"\nimport Stream from \"mithril/stream\"\nimport {\n\tgetClientType,\n\tgetDefaultPaymentMethod,\n\tInvoiceData,\n\tKeys,\n\tPaymentData,\n\tPaymentDataResultType,\n\tPaymentMethodType,\n\tPaymentMethodTypeToName,\n} from \"../api/common/TutanotaConstants\"\nimport { showProgressDialog } from \"../gui/dialogs/ProgressDialog\"\nimport type { AccountingInfo, Braintree3ds2Request } from \"../api/entities/sys/TypeRefs.js\"\nimport { AccountingInfoTypeRef, InvoiceInfoTypeRef } from \"../api/entities/sys/TypeRefs.js\"\nimport { assertNotNull, neverNull, noOp, promiseMap } from \"@tutao/tutanota-utils\"\nimport { getLazyLoadedPayPalUrl, getPreconditionFailedPaymentMsg, PaymentErrorCode, UpgradeType } from \"./SubscriptionUtils\"\nimport { Button, ButtonType } from \"../gui/base/Button.js\"\nimport type { SegmentControlItem } from \"../gui/base/SegmentControl\"\nimport { SegmentControl } from \"../gui/base/SegmentControl\"\nimport type { WizardPageAttrs, WizardPageN } from \"../gui/base/WizardDialog.js\"\nimport { emitWizardEvent, WizardEventType } from \"../gui/base/WizardDialog.js\"\nimport type { Country } from \"../api/common/CountryList\"\nimport { DefaultAnimationTime } from \"../gui/animation/Animations\"\nimport { locator } from \"../api/main/CommonLocator\"\nimport { Credentials } from \"../misc/credentials/Credentials\"\nimport { SessionType } from \"../api/common/SessionType.js\"\nimport { UsageTest } from \"@tutao/tutanota-usagetests\"\nimport { PaymentInterval } from \"./PriceUtils.js\"\nimport { EntityUpdateData, isUpdateForTypeRef } from \"../api/common/utils/EntityUpdateUtils.js\"\nimport { EntityEventsListener } from \"../api/main/EventController.js\"\nimport { LoginButton } from \"../gui/base/buttons/LoginButton.js\"\nimport { client } from \"../misc/ClientDetector.js\"\n\n/**\n * Wizard page for editing invoice and payment data.\n */\nexport class InvoiceAndPaymentDataPage implements WizardPageN<UpgradeSubscriptionData> {\n\tprivate _paymentMethodInput: PaymentMethodInput | null = null\n\tprivate _invoiceDataInput: InvoiceDataInput | null = null\n\tprivate _availablePaymentMethods: Array<SegmentControlItem<PaymentMethodType>> | null = null\n\tprivate _selectedPaymentMethod: Stream<PaymentMethodType>\n\tprivate dom!: HTMLElement\n\tprivate __signupPaidTest?: UsageTest\n\tprivate __paymentPaypalTest?: UsageTest\n\n\tconstructor() {\n\t\tthis.__signupPaidTest = locator.usageTestController.getTest(\"signup.paid\")\n\t\tthis.__paymentPaypalTest = locator.usageTestController.getTest(\"payment.paypal\")\n\n\t\tthis._selectedPaymentMethod = stream()\n\n\t\tthis._selectedPaymentMethod.map((method) => neverNull(this._paymentMethodInput).updatePaymentMethod(method))\n\t}\n\n\tonremove(vnode: Vnode<WizardPageAttrs<UpgradeSubscriptionData>>) {\n\t\tconst data = vnode.attrs.data\n\n\t\t// TODO check if correct place to update these\n\t\tif (this._invoiceDataInput && this._paymentMethodInput) {\n\t\t\tdata.invoiceData = this._invoiceDataInput.getInvoiceData()\n\t\t\tdata.paymentData = this._paymentMethodInput.getPaymentData()\n\t\t}\n\t}\n\n\toncreate(vnode: VnodeDOM<WizardPageAttrs<UpgradeSubscriptionData>>) {\n\t\tthis.dom = vnode.dom as HTMLElement\n\t\tconst data = vnode.attrs.data\n\n\t\t// TODO check if correct place to update these\n\t\tif (this._invoiceDataInput && this._paymentMethodInput) {\n\t\t\tdata.invoiceData = this._invoiceDataInput.getInvoiceData()\n\t\t\tdata.paymentData = this._paymentMethodInput.getPaymentData()\n\t\t}\n\n\t\tlet login: Promise<Credentials | null> = Promise.resolve(null)\n\n\t\tif (!locator.logins.isUserLoggedIn()) {\n\t\t\tlogin = locator.logins\n\t\t\t\t.createSession(neverNull(data.newAccountData).mailAddress, neverNull(data.newAccountData).password, SessionType.Temporary)\n\t\t\t\t.then((newSessionData) => newSessionData.credentials)\n\t\t}\n\n\t\tlogin\n\t\t\t.then(() => {\n\t\t\t\tif (!data.accountingInfo || !data.customer) {\n\t\t\t\t\treturn locator.logins\n\t\t\t\t\t\t.getUserController()\n\t\t\t\t\t\t.loadCustomer()\n\t\t\t\t\t\t.then((customer) => {\n\t\t\t\t\t\t\tdata.customer = customer\n\t\t\t\t\t\t\treturn locator.logins.getUserController().loadCustomerInfo()\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then((customerInfo) =>\n\t\t\t\t\t\t\tlocator.entityClient.load(AccountingInfoTypeRef, customerInfo.accountingInfo).then((accountingInfo) => {\n\t\t\t\t\t\t\t\tdata.accountingInfo = accountingInfo\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(() => getDefaultPaymentMethod())\n\t\t\t.then((defaultPaymentMethod: PaymentMethodType) => {\n\t\t\t\tthis._invoiceDataInput = new InvoiceDataInput(data.options.businessUse(), data.invoiceData, InvoiceDataInputLocation.InWizard)\n\t\t\t\tlet payPalRequestUrl = getLazyLoadedPayPalUrl()\n\n\t\t\t\tif (locator.logins.isUserLoggedIn()) {\n\t\t\t\t\tlocator.logins.waitForFullLogin().then(() => payPalRequestUrl.getAsync())\n\t\t\t\t}\n\n\t\t\t\tthis._paymentMethodInput = new PaymentMethodInput(\n\t\t\t\t\tdata.options,\n\t\t\t\t\tthis._invoiceDataInput.selectedCountry,\n\t\t\t\t\tneverNull(data.accountingInfo),\n\t\t\t\t\tpayPalRequestUrl,\n\t\t\t\t\tdefaultPaymentMethod,\n\t\t\t\t)\n\t\t\t\tthis._availablePaymentMethods = this._paymentMethodInput.getVisiblePaymentMethods()\n\n\t\t\t\tthis._selectedPaymentMethod(data.paymentData.paymentMethod)\n\n\t\t\t\tthis._paymentMethodInput.updatePaymentMethod(data.paymentData.paymentMethod, data.paymentData)\n\t\t\t})\n\t}\n\n\tview(vnode: Vnode<WizardPageAttrs<UpgradeSubscriptionData>>): Children {\n\t\tconst a = vnode.attrs\n\n\t\tconst onNextClick = () => {\n\t\t\tconst invoiceDataInput = assertNotNull(this._invoiceDataInput)\n\t\t\tconst paymentMethodInput = assertNotNull(this._paymentMethodInput)\n\t\t\tlet error = invoiceDataInput.validateInvoiceData() || paymentMethodInput.validatePaymentData()\n\n\t\t\tif (error) {\n\t\t\t\treturn Dialog.message(error).then(() => null)\n\t\t\t} else {\n\t\t\t\ta.data.invoiceData = invoiceDataInput.getInvoiceData()\n\t\t\t\ta.data.paymentData = paymentMethodInput.getPaymentData()\n\t\t\t\treturn showProgressDialog(\n\t\t\t\t\t\"updatePaymentDataBusy_msg\",\n\t\t\t\t\tPromise.resolve()\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tlet customer = neverNull(a.data.customer)\n\n\t\t\t\t\t\t\tif (customer.businessUse !== a.data.options.businessUse()) {\n\t\t\t\t\t\t\t\tcustomer.businessUse = a.data.options.businessUse()\n\t\t\t\t\t\t\t\treturn locator.entityClient.update(customer)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(() =>\n\t\t\t\t\t\t\tupdatePaymentData(\n\t\t\t\t\t\t\t\ta.data.options.paymentInterval(),\n\t\t\t\t\t\t\t\ta.data.invoiceData,\n\t\t\t\t\t\t\t\ta.data.paymentData,\n\t\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\t\ta.data.upgradeType === UpgradeType.Signup,\n\t\t\t\t\t\t\t\tneverNull(a.data.price?.rawPrice),\n\t\t\t\t\t\t\t\tneverNull(a.data.accountingInfo),\n\t\t\t\t\t\t\t).then((success) => {\n\t\t\t\t\t\t\t\tif (success) {\n\t\t\t\t\t\t\t\t\t// Payment method confirmation (click on next), send selected payment method as an enum\n\t\t\t\t\t\t\t\t\tconst paymentMethodConfirmationStage = this.__signupPaidTest?.getStage(4)\n\t\t\t\t\t\t\t\t\tpaymentMethodConfirmationStage?.setMetric({\n\t\t\t\t\t\t\t\t\t\tname: \"paymentMethod\",\n\t\t\t\t\t\t\t\t\t\tvalue: PaymentMethodTypeToName[a.data.paymentData.paymentMethod],\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\tpaymentMethodConfirmationStage?.complete()\n\t\t\t\t\t\t\t\t\temitWizardEvent(this.dom, WizardEventType.SHOW_NEXT_PAGE)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t),\n\t\t\t\t)\n\t\t\t}\n\t\t}\n\n\t\treturn m(\n\t\t\t\".pt\",\n\t\t\tthis._availablePaymentMethods\n\t\t\t\t? [\n\t\t\t\t\t\tm(SegmentControl, {\n\t\t\t\t\t\t\titems: this._availablePaymentMethods,\n\t\t\t\t\t\t\tselectedValue: this._selectedPaymentMethod(),\n\t\t\t\t\t\t\tonValueSelected: this._selectedPaymentMethod,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tm(\".flex-space-around.flex-wrap.pt\", [\n\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\".flex-grow-shrink-half.plr-l\",\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\tminWidth: \"260px\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tm(neverNull(this._invoiceDataInput)),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\".flex-grow-shrink-half.plr-l\",\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\tminWidth: \"260px\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tm(neverNull(this._paymentMethodInput)),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t]),\n\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\".flex-center.full-width.pt-l\",\n\t\t\t\t\t\t\tm(LoginButton, {\n\t\t\t\t\t\t\t\tlabel: \"next_action\",\n\t\t\t\t\t\t\t\tclass: \"small-login-button\",\n\t\t\t\t\t\t\t\tonclick: onNextClick,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t),\n\t\t\t\t  ]\n\t\t\t\t: null,\n\t\t)\n\t}\n}\n\nexport class InvoiceAndPaymentDataPageAttrs implements WizardPageAttrs<UpgradeSubscriptionData> {\n\tdata: UpgradeSubscriptionData\n\t_enabled: () => boolean = () => true\n\n\tconstructor(upgradeData: UpgradeSubscriptionData) {\n\t\tthis.data = upgradeData\n\t}\n\n\tnextAction(showErrorDialog: boolean): Promise<boolean> {\n\t\treturn Promise.resolve(true)\n\t}\n\n\theaderTitle(): TranslationKey {\n\t\treturn \"adminPayment_action\"\n\t}\n\n\tisSkipAvailable(): boolean {\n\t\treturn false\n\t}\n\n\tisEnabled(): boolean {\n\t\treturn this._enabled()\n\t}\n\n\t/**\n\t * Set the enabled function for isEnabled\n\t * @param enabled\n\t */\n\tsetEnabledFunction<T>(enabled: () => boolean) {\n\t\tthis._enabled = enabled\n\t}\n}\n\nexport async function updatePaymentData(\n\tpaymentInterval: PaymentInterval,\n\tinvoiceData: InvoiceData,\n\tpaymentData: PaymentData | null,\n\tconfirmedCountry: Country | null,\n\tisSignup: boolean,\n\tprice: string | null,\n\taccountingInfo: AccountingInfo,\n): Promise<boolean> {\n\tconst paymentResult = await locator.customerFacade.updatePaymentData(paymentInterval, invoiceData, paymentData, confirmedCountry)\n\tconst statusCode = paymentResult.result\n\n\tif (statusCode === PaymentDataResultType.OK) {\n\t\t// show dialog\n\t\tlet braintree3ds = paymentResult.braintree3dsRequest\n\t\tif (braintree3ds) {\n\t\t\treturn verifyCreditCard(accountingInfo, braintree3ds, price!)\n\t\t} else {\n\t\t\treturn true\n\t\t}\n\t} else if (statusCode === PaymentDataResultType.COUNTRY_MISMATCH) {\n\t\tconst countryName = invoiceData.country ? invoiceData.country.n : \"\"\n\t\tconst confirmMessage = lang.getTranslation(\"confirmCountry_msg\", {\n\t\t\t\"{1}\": countryName,\n\t\t})\n\t\tconst confirmed = await Dialog.confirm(confirmMessage)\n\t\tif (confirmed) {\n\t\t\treturn updatePaymentData(paymentInterval, invoiceData, paymentData, invoiceData.country, isSignup, price, accountingInfo) // add confirmed invoice country\n\t\t} else {\n\t\t\treturn false\n\t\t}\n\t} else if (statusCode === PaymentDataResultType.INVALID_VATID_NUMBER) {\n\t\tawait Dialog.message(\n\t\t\tlang.makeTranslation(\"invalidVatIdNumber_msg\", lang.get(\"invalidVatIdNumber_msg\") + (isSignup ? \" \" + lang.get(\"accountWasStillCreated_msg\") : \"\")),\n\t\t)\n\t} else if (statusCode === PaymentDataResultType.CREDIT_CARD_DECLINED) {\n\t\tawait Dialog.message(\n\t\t\tlang.makeTranslation(\"creditCardDeclined_msg\", lang.get(\"creditCardDeclined_msg\") + (isSignup ? \" \" + lang.get(\"accountWasStillCreated_msg\") : \"\")),\n\t\t)\n\t} else if (statusCode === PaymentDataResultType.CREDIT_CARD_CVV_INVALID) {\n\t\tawait Dialog.message(\"creditCardCVVInvalid_msg\")\n\t} else if (statusCode === PaymentDataResultType.PAYMENT_PROVIDER_NOT_AVAILABLE) {\n\t\tawait Dialog.message(\n\t\t\tlang.makeTranslation(\n\t\t\t\t\"paymentProviderNotAvailableError_msg\",\n\t\t\t\tlang.get(\"paymentProviderNotAvailableError_msg\") + (isSignup ? \" \" + lang.get(\"accountWasStillCreated_msg\") : \"\"),\n\t\t\t),\n\t\t)\n\t} else if (statusCode === PaymentDataResultType.OTHER_PAYMENT_ACCOUNT_REJECTED) {\n\t\tawait Dialog.message(\n\t\t\tlang.makeTranslation(\n\t\t\t\t\"paymentAccountRejected_msg\",\n\t\t\t\tlang.get(\"paymentAccountRejected_msg\") + (isSignup ? \" \" + lang.get(\"accountWasStillCreated_msg\") : \"\"),\n\t\t\t),\n\t\t)\n\t} else if (statusCode === PaymentDataResultType.CREDIT_CARD_DATE_INVALID) {\n\t\tawait Dialog.message(\"creditCardExprationDateInvalid_msg\")\n\t} else if (statusCode === PaymentDataResultType.CREDIT_CARD_NUMBER_INVALID) {\n\t\tawait Dialog.message(\n\t\t\tlang.makeTranslation(\n\t\t\t\t\"creditCardNumberInvalid_msg\",\n\t\t\t\tlang.get(\"creditCardNumberInvalid_msg\") + (isSignup ? \" \" + lang.get(\"accountWasStillCreated_msg\") : \"\"),\n\t\t\t),\n\t\t)\n\t} else if (statusCode === PaymentDataResultType.COULD_NOT_VERIFY_VATID) {\n\t\tawait Dialog.message(\n\t\t\tlang.makeTranslation(\n\t\t\t\t\"invalidVatIdValidationFailed_msg\",\n\t\t\t\tlang.get(\"invalidVatIdValidationFailed_msg\") + (isSignup ? \" \" + lang.get(\"accountWasStillCreated_msg\") : \"\"),\n\t\t\t),\n\t\t)\n\t} else if (statusCode === PaymentDataResultType.CREDIT_CARD_VERIFICATION_LIMIT_REACHED) {\n\t\tawait Dialog.message(\n\t\t\tlang.makeTranslation(\n\t\t\t\t\"creditCardVerificationLimitReached_msg\",\n\t\t\t\tlang.get(\"creditCardVerificationLimitReached_msg\") + (isSignup ? \" \" + lang.get(\"accountWasStillCreated_msg\") : \"\"),\n\t\t\t),\n\t\t)\n\t} else {\n\t\tawait Dialog.message(\n\t\t\tlang.makeTranslation(\n\t\t\t\t\"otherPaymentProviderError_msg\",\n\t\t\t\tlang.get(\"otherPaymentProviderError_msg\") + (isSignup ? \" \" + lang.get(\"accountWasStillCreated_msg\") : \"\"),\n\t\t\t),\n\t\t)\n\t}\n\n\treturn false\n}\n\n/**\n * Displays a progress dialog that allows to cancel the verification and opens a new window to do the actual verification with the bank.\n */\nfunction verifyCreditCard(accountingInfo: AccountingInfo, braintree3ds: Braintree3ds2Request, price: string): Promise<boolean> {\n\treturn locator.entityClient.load(InvoiceInfoTypeRef, neverNull(accountingInfo.invoiceInfo)).then((invoiceInfo) => {\n\t\tlet invoiceInfoWrapper = {\n\t\t\tinvoiceInfo,\n\t\t}\n\t\tlet resolve: (arg0: boolean) => void\n\t\tlet progressDialogPromise: Promise<boolean> = new Promise((res) => (resolve = res))\n\t\tlet progressDialog: Dialog\n\n\t\tconst closeAction = () => {\n\t\t\t// user did not complete the 3ds dialog and PaymentDataService.POST was not invoked\n\t\t\tprogressDialog.close()\n\t\t\tsetTimeout(() => resolve(false), DefaultAnimationTime)\n\t\t}\n\n\t\tprogressDialog = new Dialog(DialogType.Alert, {\n\t\t\tview: () => [\n\t\t\t\tm(\".dialog-contentButtonsBottom.text-break.selectable\", lang.get(\"creditCardPendingVerification_msg\")),\n\t\t\t\tm(\n\t\t\t\t\t\".flex-center.dialog-buttons\",\n\t\t\t\t\tm(Button, {\n\t\t\t\t\t\tlabel: \"cancel_action\",\n\t\t\t\t\t\tclick: closeAction,\n\t\t\t\t\t\ttype: ButtonType.Primary,\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t],\n\t\t})\n\t\t\t.setCloseHandler(closeAction)\n\t\t\t.addShortcut({\n\t\t\t\tkey: Keys.RETURN,\n\t\t\t\tshift: false,\n\t\t\t\texec: closeAction,\n\t\t\t\thelp: \"close_alt\",\n\t\t\t})\n\t\t\t.addShortcut({\n\t\t\t\tkey: Keys.ESC,\n\t\t\t\tshift: false,\n\t\t\t\texec: closeAction,\n\t\t\t\thelp: \"close_alt\",\n\t\t\t})\n\t\tlet entityEventListener: EntityEventsListener = (updates: ReadonlyArray<EntityUpdateData>, eventOwnerGroupId: Id) => {\n\t\t\treturn promiseMap(updates, (update) => {\n\t\t\t\tif (isUpdateForTypeRef(InvoiceInfoTypeRef, update)) {\n\t\t\t\t\treturn locator.entityClient.load(InvoiceInfoTypeRef, update.instanceId).then((invoiceInfo) => {\n\t\t\t\t\t\tinvoiceInfoWrapper.invoiceInfo = invoiceInfo\n\t\t\t\t\t\tif (!invoiceInfo.paymentErrorInfo) {\n\t\t\t\t\t\t\t// user successfully verified the card\n\t\t\t\t\t\t\tprogressDialog.close()\n\t\t\t\t\t\t\tresolve(true)\n\t\t\t\t\t\t} else if (invoiceInfo.paymentErrorInfo && invoiceInfo.paymentErrorInfo.errorCode === \"card.3ds2_pending\") {\n\t\t\t\t\t\t\t// keep waiting. this error code is set before starting the 3DS2 verification and we just received the event very late\n\t\t\t\t\t\t} else if (invoiceInfo.paymentErrorInfo && invoiceInfo.paymentErrorInfo.errorCode !== null) {\n\t\t\t\t\t\t\t// verification error during 3ds verification\n\t\t\t\t\t\t\tlet error = \"3dsFailedOther\"\n\n\t\t\t\t\t\t\tswitch (invoiceInfo.paymentErrorInfo.errorCode as PaymentErrorCode) {\n\t\t\t\t\t\t\t\tcase \"card.cvv_invalid\":\n\t\t\t\t\t\t\t\t\terror = \"cvvInvalid\"\n\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\tcase \"card.number_invalid\":\n\t\t\t\t\t\t\t\t\terror = \"ccNumberInvalid\"\n\t\t\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\t\t\tcase \"card.date_invalid\":\n\t\t\t\t\t\t\t\t\terror = \"expirationDate\"\n\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\tcase \"card.insufficient_funds\":\n\t\t\t\t\t\t\t\t\terror = \"insufficientFunds\"\n\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\tcase \"card.expired_card\":\n\t\t\t\t\t\t\t\t\terror = \"cardExpired\"\n\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\tcase \"card.3ds2_failed\":\n\t\t\t\t\t\t\t\t\terror = \"3dsFailed\"\n\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tDialog.message(getPreconditionFailedPaymentMsg(invoiceInfo.paymentErrorInfo.errorCode))\n\t\t\t\t\t\t\tresolve(false)\n\t\t\t\t\t\t\tprogressDialog.close()\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tm.redraw()\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}).then(noOp)\n\t\t}\n\n\t\tlocator.eventController.addEntityListener(entityEventListener)\n\t\tconst app = client.isCalendarApp() ? \"calendar\" : \"mail\"\n\t\tlet params = `clientToken=${encodeURIComponent(braintree3ds.clientToken)}&nonce=${encodeURIComponent(braintree3ds.nonce)}&bin=${encodeURIComponent(\n\t\t\tbraintree3ds.bin,\n\t\t)}&price=${encodeURIComponent(price)}&message=${encodeURIComponent(lang.get(\"creditCardVerification_msg\"))}&clientType=${getClientType()}&app=${app}`\n\t\tDialog.message(\"creditCardVerificationNeededPopup_msg\").then(() => {\n\t\t\tconst paymentUrlString = locator.domainConfigProvider().getCurrentDomainConfig().paymentUrl\n\t\t\tconst paymentUrl = new URL(paymentUrlString)\n\t\t\tpaymentUrl.hash += params\n\t\t\twindow.open(paymentUrl)\n\t\t\tprogressDialog.show()\n\t\t})\n\t\treturn progressDialogPromise.finally(() => locator.eventController.removeEntityListener(entityEventListener))\n\t})\n}\n"]}