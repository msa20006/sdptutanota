{"version":3,"file":"PdfInvoiceGenerator.js","sourceRoot":"","sources":["../../../../../../src/common/api/worker/invoicegen/PdfInvoiceGenerator.ts"],"names":[],"mappings":"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","sourcesContent":["import { MARGIN_LEFT, MARGIN_TOP, PDF_FONTS, PDF_IMAGES, PdfDocument, TABLE_VERTICAL_SPACING, TableColumn } from \"../pdf/PdfDocument.js\"\nimport InvoiceTexts from \"./InvoiceTexts.js\"\nimport { PdfWriter } from \"../pdf/PdfWriter.js\"\nimport { InvoiceDataGetOut } from \"../../entities/sys/TypeRefs.js\"\nimport { countryUsesGerman, getInvoiceItemTypeName, InvoiceItemType, InvoiceType, PaymentMethod, VatType } from \"./InvoiceUtils.js\"\n\n/**\n * Object generating a PDF invoice document.\n * This generator is ONLY responsible for rendering the data it gets and formatting it in a way that does not change anything about it.\n * If adjustments to the data must be made prior to rendering, then these should take place within the RenderInvoice service.\n */\nexport class PdfInvoiceGenerator {\n\tprivate readonly doc: PdfDocument\n\tprivate readonly languageCode: \"de\" | \"en\" = \"en\"\n\tprivate readonly invoiceNumber: string\n\tprivate readonly customerId: string\n\tprivate invoice: InvoiceDataGetOut\n\n\tconstructor(pdfWriter: PdfWriter, invoice: InvoiceDataGetOut, invoiceNumber: string, customerId: string) {\n\t\tthis.invoice = invoice\n\t\tthis.invoiceNumber = invoiceNumber\n\t\tthis.customerId = customerId\n\t\tthis.languageCode = countryUsesGerman(this.invoice.country)\n\t\tthis.doc = new PdfDocument(pdfWriter)\n\t}\n\n\t/**\n\t * Generate the PDF document\n\t */\n\tasync generate(): Promise<Uint8Array> {\n\t\tawait this.doc.addPage()\n\t\tthis.doc.addImage(PDF_IMAGES.TUTA_LOGO, [25, MARGIN_TOP + 15.7], [45, 15.7])\n\t\tthis.renderSideBarInfo()\n\t\tawait this.renderAddressField()\n\t\tthis.renderInvoiceInfo()\n\t\tawait this.renderInvoiceTable()\n\t\tthis.renderAdditional()\n\t\tthis.renderLegalDisclaimer()\n\t\treturn await this.doc.create()\n\t}\n\n\t/**\n\t * The sidebar on the document in the top-right corner\n\t */\n\trenderSideBarInfo() {\n\t\tthis.doc\n\t\t\t.changeFont(PDF_FONTS.BOLD, 11)\n\t\t\t.addText(InvoiceTexts.universal.companyName, [MARGIN_LEFT + 125, MARGIN_TOP])\n\t\t\t.changeFont(PDF_FONTS.REGULAR, 11)\n\t\t\t.addLineBreak()\n\t\t\t.addText(InvoiceTexts.universal.addressStreet)\n\t\t\t.addLineBreak()\n\t\t\t.addText(InvoiceTexts[this.languageCode].addressPostal)\n\t\t\t.addLineBreak()\n\t\t\t.addText(InvoiceTexts[this.languageCode].addressCountry)\n\t\t\t.addLineBreak()\n\t\t\t.addLineBreak()\n\t\t\t.addText(InvoiceTexts[this.languageCode].tutaPhone)\n\t\t\t.addLineBreak()\n\t\t\t.addText(InvoiceTexts.universal.tutaFax)\n\t\t\t.addLineBreak()\n\t\t\t.addText(InvoiceTexts.universal.tutaEmail)\n\t\t\t.addLineBreak()\n\t\t\t.addText(InvoiceTexts.universal.tutaWebsite)\n\t\t\t.addLineBreak()\n\t\t\t.addLineBreak()\n\t\t\t.addText(InvoiceTexts[this.languageCode].yourCustomerId)\n\t\t\t.addLineBreak()\n\t\t\t.addText(this.customerId)\n\t\t\t.changeFontSize(12)\n\t\t\t.addText(`${InvoiceTexts[this.languageCode].addressCity}, ${this.formatInvoiceDate(this.invoice.date)}`, [MARGIN_LEFT + 125, MARGIN_TOP + 70])\n\t}\n\n\t/**\n\t * The short address field of Tuta and the address field of the customer below the image\n\t */\n\tasync renderAddressField() {\n\t\tthis.doc\n\t\t\t.changeFontSize(9)\n\t\t\t.addText(`${InvoiceTexts.universal.companyName} - ${InvoiceTexts.universal.addressStreet} - ${InvoiceTexts[this.languageCode].addressPostal}`, [\n\t\t\t\tMARGIN_LEFT,\n\t\t\t\tMARGIN_TOP + 35,\n\t\t\t])\n\t\t\t.addLineBreak()\n\t\t\t.changeFontSize(11)\n\t\t\t.addLineBreak()\n\t\tawait this.doc.addAddressField([MARGIN_LEFT, MARGIN_TOP + 82], this.invoice.address)\n\t}\n\n\t/**\n\t * The basic invoice info above the invoice table\n\t */\n\trenderInvoiceInfo() {\n\t\tthis.doc\n\t\t\t.changeFontSize(18)\n\t\t\t.addText(this.getInvoiceTypeName(this.invoice.invoiceType, this.invoice.grandTotal), [MARGIN_LEFT, MARGIN_TOP + 90])\n\t\t\t.changeFont(PDF_FONTS.BOLD, 12)\n\t\t\t.addText(`${InvoiceTexts[this.languageCode].invoiceNumber} ${this.invoiceNumber}`, [MARGIN_LEFT, MARGIN_TOP + 100])\n\t\t\t.changeFont(PDF_FONTS.REGULAR, 11)\n\t\tif (this.invoice.invoiceType === InvoiceType.INVOICE) {\n\t\t\tthis.doc.addText(InvoiceTexts[this.languageCode].asAgreedBlock, [MARGIN_LEFT, MARGIN_TOP + 110])\n\t\t}\n\t}\n\n\t/**\n\t * The table with all invoice items\n\t */\n\tasync renderInvoiceTable() {\n\t\t// Define headers and column widths\n\t\tconst columns: TableColumn[] = [\n\t\t\t{ headerName: InvoiceTexts[this.languageCode].quantity, columnWidth: 19.8 },\n\t\t\t{ headerName: InvoiceTexts[this.languageCode].item, columnWidth: 95.7 },\n\t\t\t{ headerName: InvoiceTexts[this.languageCode].singlePrice, columnWidth: 24.75 },\n\t\t\t{ headerName: InvoiceTexts[this.languageCode].totalPrice, columnWidth: 24.75 },\n\t\t]\n\t\tconst tableData: Array<Array<string>> = []\n\n\t\t// Fill table data (two entries at the time) and render it\n\t\tfor (const invoiceItem of this.invoice.items) {\n\t\t\t// Entry with all invoice info\n\t\t\ttableData.push([\n\t\t\t\tthis.formatAmount(invoiceItem.itemType, invoiceItem.amount),\n\t\t\t\tgetInvoiceItemTypeName(invoiceItem.itemType, this.languageCode),\n\t\t\t\tinvoiceItem.singlePrice == null ? \"\" : this.formatInvoiceCurrency(invoiceItem.singlePrice),\n\t\t\t\tthis.formatInvoiceCurrency(invoiceItem.totalPrice),\n\t\t\t])\n\t\t\t// Entry with date range\n\t\t\ttableData.push([\"\", `${this.formatInvoiceDate(invoiceItem.startDate)} - ${this.formatInvoiceDate(invoiceItem.endDate)}`, \"\", \"\"])\n\t\t}\n\t\tconst tableEndPoint = await this.doc.addTable([MARGIN_LEFT, MARGIN_TOP + 120], 165, columns, tableData, this.getTableRowsForFirstPage())\n\n\t\tthis.renderTableSummary(tableEndPoint, columns)\n\t\tthis.doc.changeTextCursorPosition([MARGIN_LEFT, tableEndPoint + 4 * TABLE_VERTICAL_SPACING])\n\t}\n\n\t/**\n\t * Summary of totals and applied VAT below the rendered table\n\t */\n\trenderTableSummary(tableEndPoint: number, columns: TableColumn[]) {\n\t\t// Line break that's to be removed if no VAT appears in the summary\n\t\tlet additionalVerticalSpace = 1\n\n\t\tthis.doc.changeFont(PDF_FONTS.REGULAR, 11)\n\n\t\t// Sub total\n\t\tthis.doc.addTableRow([MARGIN_LEFT, tableEndPoint], columns, [\n\t\t\t\"\",\n\t\t\t\"\",\n\t\t\tInvoiceTexts[this.languageCode].subTotal,\n\t\t\tthis.formatInvoiceCurrency(this.invoice.subTotal),\n\t\t])\n\t\t// VAT\n\t\tif (this.invoice.vatType === VatType.ADD_VAT) {\n\t\t\t// AddedVat\n\t\t\tthis.doc.addTableRow([MARGIN_LEFT, tableEndPoint + TABLE_VERTICAL_SPACING], columns, [\n\t\t\t\t\"\",\n\t\t\t\t\"\",\n\t\t\t\t`${InvoiceTexts[this.languageCode].addedVat} ${this.invoice.vatRate}${InvoiceTexts[this.languageCode].vatPercent}`,\n\t\t\t\tthis.formatInvoiceCurrency(this.invoice.vat),\n\t\t\t])\n\t\t} else if (this.invoice.vatType === VatType.VAT_INCLUDED_SHOWN) {\n\t\t\t// IncludedVat\n\t\t\tthis.doc.addTableRow([MARGIN_LEFT, tableEndPoint + TABLE_VERTICAL_SPACING], columns, [\n\t\t\t\t\"\",\n\t\t\t\t\"\",\n\t\t\t\t`${InvoiceTexts[this.languageCode].includedVat} ${this.invoice.vatRate}${InvoiceTexts[this.languageCode].vatPercent}`,\n\t\t\t\tthis.formatInvoiceCurrency(this.invoice.vat),\n\t\t\t])\n\t\t} else {\n\t\t\tadditionalVerticalSpace -= 1\n\t\t}\n\t\t// Grand total\n\t\tthis.doc.changeFont(PDF_FONTS.BOLD, 11)\n\t\tthis.doc.addTableRow([MARGIN_LEFT, tableEndPoint + (additionalVerticalSpace + 1) * TABLE_VERTICAL_SPACING], columns, [\n\t\t\t\"\",\n\t\t\t\"\",\n\t\t\tInvoiceTexts[this.languageCode].grandTotal,\n\t\t\t// in case of NO_VAT_CHARGE_TUTAO we must not show the VAT in the invoice, but we pay the taxes ourselves, so they need to be existing on the invoice\n\t\t\tthis.formatInvoiceCurrency(this.invoice.vatType == VatType.NO_VAT_CHARGE_TUTAO ? this.invoice.subTotal : this.invoice.grandTotal),\n\t\t])\n\t}\n\n\t/**\n\t * Additional blocks displayed below the table depending on invoice type, vat type and payment method\n\t */\n\trenderAdditional() {\n\t\tthis.doc.changeFont(PDF_FONTS.REGULAR, 11)\n\n\t\t// No VAT / VAT not shown in table\n\t\tswitch (this.invoice.vatType) {\n\t\t\tcase VatType.ADD_VAT:\n\t\t\tcase VatType.VAT_INCLUDED_SHOWN:\n\t\t\t\tbreak\n\t\t\tcase VatType.NO_VAT:\n\t\t\t\tif (this.invoice.vatIdNumber != null) {\n\t\t\t\t\tthis.doc\n\t\t\t\t\t\t.addText(InvoiceTexts[this.languageCode].reverseChargeVatIdNumber1)\n\t\t\t\t\t\t.addLineBreak()\n\t\t\t\t\t\t.addText(InvoiceTexts[this.languageCode].reverseChargeVatIdNumber2)\n\t\t\t\t\t\t.addLineBreak()\n\t\t\t\t\t\t.addText(`${InvoiceTexts[this.languageCode].yourVatId} `)\n\t\t\t\t\t\t.changeFont(PDF_FONTS.BOLD, 11)\n\t\t\t\t\t\t.addText(`${this.invoice.vatIdNumber}`)\n\t\t\t\t\t\t.changeFont(PDF_FONTS.REGULAR, 11)\n\t\t\t\t} else {\n\t\t\t\t\tthis.doc.addText(InvoiceTexts[this.languageCode].netPricesNoVatInGermany)\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tcase VatType.NO_VAT_CHARGE_TUTAO:\n\t\t\t\tthis.doc\n\t\t\t\t\t.addText(InvoiceTexts[this.languageCode].reverseChargeAffiliate)\n\t\t\t\t\t.addLineBreak()\n\t\t\t\t\t.addText(InvoiceTexts[this.languageCode].reverseChargeVatIdNumber2)\n\t\t\t\tif (this.invoice.vatIdNumber != null) {\n\t\t\t\t\tthis.doc\n\t\t\t\t\t\t.addLineBreak()\n\t\t\t\t\t\t.addText(`${InvoiceTexts[this.languageCode].yourVatId} `)\n\t\t\t\t\t\t.changeFont(PDF_FONTS.BOLD, 11)\n\t\t\t\t\t\t.addText(`${this.invoice.vatIdNumber}`)\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tcase VatType.VAT_INCLUDED_HIDDEN:\n\t\t\t\tthis.doc.addText(InvoiceTexts[this.languageCode].noVatInGermany)\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tthrow new Error(\"Unknown VatType \" + this.invoice.vatType)\n\t\t}\n\t\tthis.doc.addLineBreak()\n\t\tthis.doc.addLineBreak()\n\n\t\t// Payment info\n\t\tif (this.invoice.invoiceType === InvoiceType.INVOICE) {\n\t\t\tswitch (this.invoice.paymentMethod) {\n\t\t\t\tcase PaymentMethod.INVOICE:\n\t\t\t\t\tthis.doc\n\t\t\t\t\t\t.addText(InvoiceTexts[this.languageCode].paymentInvoiceDue1)\n\t\t\t\t\t\t.addLineBreak()\n\t\t\t\t\t\t.addText(InvoiceTexts[this.languageCode].paymentInvoiceDue2)\n\t\t\t\t\t\t.addLineBreak()\n\t\t\t\t\t\t.addLineBreak()\n\t\t\t\t\t\t.addText(InvoiceTexts[this.languageCode].paymentInvoiceHolder)\n\t\t\t\t\t\t.addLineBreak()\n\t\t\t\t\t\t.addText(InvoiceTexts[this.languageCode].paymentInvoiceBank)\n\t\t\t\t\t\t.addLineBreak()\n\t\t\t\t\t\t.addText(InvoiceTexts[this.languageCode].paymentInvoiceIBAN)\n\t\t\t\t\t\t.addLineBreak()\n\t\t\t\t\t\t.addText(InvoiceTexts[this.languageCode].paymentInvoiceBIC)\n\t\t\t\t\t\t.addLineBreak()\n\t\t\t\t\t\t.addText(InvoiceTexts[this.languageCode].paymentInvoiceProvideNumber1)\n\t\t\t\t\t\t.changeFont(PDF_FONTS.BOLD, 11)\n\t\t\t\t\t\t.addText(` ${this.invoiceNumber} `)\n\t\t\t\t\t\t.changeFont(PDF_FONTS.REGULAR, 11)\n\t\t\t\t\t\t.addLineBreak()\n\t\t\t\t\t\t.addText(InvoiceTexts[this.languageCode].paymentInvoiceProvideNumber2)\n\t\t\t\t\tbreak\n\t\t\t\tcase PaymentMethod.CREDIT_CARD:\n\t\t\t\t\tthis.doc.addText(InvoiceTexts[this.languageCode].paymentCreditCard)\n\t\t\t\t\tbreak\n\t\t\t\tcase PaymentMethod.PAYPAL:\n\t\t\t\t\tthis.doc.addText(InvoiceTexts[this.languageCode].paymentPaypal)\n\t\t\t\t\tbreak\n\t\t\t\tcase PaymentMethod.ACCOUNT_BALANCE:\n\t\t\t\t\tthis.doc.addText(InvoiceTexts[this.languageCode].paymentAccountBalance)\n\t\t\t\t\tbreak\n\t\t\t}\n\t\t\tthis.doc.addLineBreak().addLineBreak().addText(InvoiceTexts[this.languageCode].thankYou)\n\t\t}\n\t}\n\n\t/**\n\t * The legal disclaimer info at the bottom of the last page\n\t */\n\trenderLegalDisclaimer() {\n\t\tthis.doc\n\t\t\t.changeFont(PDF_FONTS.REGULAR, 10)\n\t\t\t.addText(InvoiceTexts[this.languageCode].legalNoSigned, [MARGIN_LEFT, MARGIN_TOP + 240])\n\t\t\t.addLineBreak()\n\t\t\t.addLineBreak()\n\t\t\t.changeTextGrayscale(0.5)\n\t\t\t.addText(InvoiceTexts[this.languageCode].legalRepresented, [MARGIN_LEFT, MARGIN_TOP + 250])\n\t\t\t.addLineBreak()\n\t\t\t.addText(InvoiceTexts[this.languageCode].legalRegistration)\n\t\t\t.addLineBreak()\n\t\t\t.addText(InvoiceTexts[this.languageCode].legalVatIdentification)\n\t\t\t.addLineBreak()\n\t\t\t.addText(InvoiceTexts[this.languageCode].legalBankAccount)\n\t}\n\n\t/**\n\t * Determines how many table rows (invoice items) can be rendered on the first page depending on the texts that follow after the table\n\t */\n\tgetTableRowsForFirstPage(): number {\n\t\tif (\n\t\t\tthis.invoice.paymentMethod === PaymentMethod.INVOICE &&\n\t\t\tthis.invoice.vatIdNumber != null &&\n\t\t\t// Needs fix @arm, @jug, @jop\n\t\t\t(this.invoice.vatType === VatType.NO_VAT || this.invoice.vatType === VatType.NO_VAT_CHARGE_TUTAO)\n\t\t) {\n\t\t\t// In these scenarios, there will be a lot of text after the table summary, so few rows can render\n\t\t\treturn 4\n\t\t} else {\n\t\t\t// In all other scenarios, there will be little text after the table summary, so more rows can render\n\t\t\treturn 8\n\t\t}\n\t}\n\n\t/**\n\t * Get the name of a given InvoiceType\n\t */\n\tgetInvoiceTypeName(type: NumberString, amount: NumberString): string {\n\t\tswitch (type) {\n\t\t\tcase InvoiceType.INVOICE:\n\t\t\t\treturn InvoiceTexts[this.languageCode].invoice\n\t\t\tcase InvoiceType.CREDIT:\n\t\t\t\treturn InvoiceTexts[this.languageCode].credit\n\t\t\tcase InvoiceType.REFERRAL_CREDIT:\n\t\t\t\tif (parseFloat(amount) >= 0) {\n\t\t\t\t\treturn InvoiceTexts[this.languageCode].credit\n\t\t\t\t} else {\n\t\t\t\t\treturn InvoiceTexts[this.languageCode].cancelCredit\n\t\t\t\t}\n\t\t\tdefault:\n\t\t\t\tthrow new Error(\"Invalid InvoiceType \" + type)\n\t\t}\n\t}\n\n\t/**\n\t * Format the date depending on document language (dd.mm.yyyy) / (dd. Mon yyyy)\n\t */\n\tformatInvoiceDate(date: Date | null): string {\n\t\tif (date == null) return \"\"\n\t\tif (this.languageCode === \"de\") {\n\t\t\treturn date.toLocaleDateString(\"de-DE\", {\n\t\t\t\tday: \"2-digit\",\n\t\t\t\tmonth: \"2-digit\",\n\t\t\t\tyear: \"numeric\",\n\t\t\t})\n\t\t} else {\n\t\t\treturn date.toLocaleDateString(\"en-UK\", {\n\t\t\t\tday: \"2-digit\",\n\t\t\t\tmonth: \"short\",\n\t\t\t\tyear: \"numeric\",\n\t\t\t})\n\t\t}\n\t}\n\n\t/**\n\t * Format the currency separator (dot, comma) depending on the country\n\t */\n\tformatInvoiceCurrency(price: string | number): string {\n\t\tprice = `${price} EUR`\n\t\treturn this.languageCode === \"de\" ? price.replace(\".\", \",\") : price\n\t}\n\n\t/**\n\t * Format the amount of storage into the appropriate byte unit if the item is a legacy storage package. Otherwise, return as is\n\t */\n\tformatAmount(itemType: string, amount: string): string {\n\t\tif (itemType === InvoiceItemType.StoragePackage || itemType === InvoiceItemType.StoragePackageUpgrade) {\n\t\t\tconst numAmount = Number(amount)\n\t\t\treturn numAmount < 1000 ? `${amount} GB` : `${numAmount / 1000} TB`\n\t\t} else {\n\t\t\treturn amount\n\t\t}\n\t}\n}\n"]}