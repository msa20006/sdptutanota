{"version":3,"file":"GiftCardMessageEditorField.js","sourceRoot":"","sources":["../../../../../src/common/subscription/giftcards/GiftCardMessageEditorField.ts"],"names":[],"mappings":"AAAA,OAAO,CAAiC,MAAM,SAAS,CAAA;AACvD,OAAO,EAAE,IAAI,EAAE,MAAM,8BAA8B,CAAA;AACnD,OAAO,EAAE,aAAa,EAAE,MAAM,uBAAuB,CAAA;AAGrD,MAAM,CAAC,MAAM,sBAAsB,GAAG,EAAE,CAAA;AACxC,MAAM,wBAAwB,GAAG,CAAC,CAAA;AAOlC;;GAEG;AACH,MAAM,OAAO,0BAA0B;IAC9B,WAAW,GAA+B,IAAI,CAAA;IAC9C,QAAQ,GAAY,KAAK,CAAA;IAEjC,IAAI,CAAC,KAA6C;QACjD,MAAM,CAAC,GAAG,KAAK,CAAC,KAAK,CAAA;QACrB,OAAO,CAAC,CAAC,+CAA+C,EAAE;YACzD,6FAA6F;YAC7F,IAAI,CAAC,GAAG,CAAC,mBAAmB,CAAC;YAC7B,CAAC,CAAC,iEAAiE,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,uBAAuB,CAAC,CAAC,CAAC,gBAAgB,CAAC,EAAE;gBACnI,IAAI,EAAE,MAAM;gBACZ,IAAI,EAAE,CAAC,CAAC,IAAI,IAAI,sBAAsB;gBACtC,IAAI,EAAE,CAAC,CAAC,IAAI,IAAI,wBAAwB;gBACxC,QAAQ,EAAE,CAAC,KAAK,EAAE,EAAE;oBACnB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC,GAA0B,CAAA;oBACnD,IAAI,CAAC,WAAW,CAAC,KAAK,GAAG,CAAC,CAAC,OAAO,CAAA;gBACnC,CAAC;gBACD,OAAO,EAAE,GAAG,EAAE;oBACb,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAA;gBACrB,CAAC;gBACD,MAAM,EAAE,GAAG,EAAE;oBACZ,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAA;gBACtB,CAAC;gBACD,OAAO,EAAE,GAAG,EAAE;oBACb,MAAM,WAAW,GAAG,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,CAAA;oBACnD,MAAM,SAAS,GAAG,WAAW,CAAC,cAAc,CAAA;oBAC5C,MAAM,OAAO,GAAG,WAAW,CAAC,YAAY,CAAA;oBAExC,iCAAiC;oBACjC,OAAO,WAAW,CAAC,YAAY,GAAG,WAAW,CAAC,YAAY,EAAE,CAAC;wBAC5D,WAAW,CAAC,KAAK,GAAG,WAAW,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,EAAE,WAAW,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAA;oBACjF,CAAC;oBAED,CAAC,CAAC,gBAAgB,CAAC,WAAW,CAAC,KAAK,CAAC,CAAA;oBAErC,wHAAwH;oBACxH,IAAI,WAAW,CAAC,cAAc,GAAG,SAAS,GAAG,CAAC,EAAE,CAAC;wBAChD,WAAW,CAAC,cAAc,GAAG,SAAS,CAAA;wBACtC,WAAW,CAAC,YAAY,GAAG,OAAO,CAAA;oBACnC,CAAC;gBACF,CAAC;aACD,CAAC;SACF,CAAC,CAAA;IACH,CAAC;CACD","sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { lang } from \"../../misc/LanguageViewModel\"\nimport { assertNotNull } from \"@tutao/tutanota-utils\"\nimport { px, size } from \"../../gui/size.js\"\n\nexport const GIFT_CARD_MESSAGE_COLS = 26\nconst GIFT_CARD_MESSAGE_HEIGHT = 5\ntype GiftCardMessageEditorFieldAttrs = {\n\tmessage: string\n\tonMessageChanged: (message: string) => void\n\tcols?: number\n\trows?: number\n}\n/**\n * A text area that allows you to edit some text that is limited to fit within a certain rows/columns boundary\n */\nexport class GiftCardMessageEditorField implements Component<GiftCardMessageEditorFieldAttrs> {\n\tprivate textAreaDom: HTMLTextAreaElement | null = null\n\tprivate isActive: boolean = false\n\n\tview(vnode: Vnode<GiftCardMessageEditorFieldAttrs>): Children {\n\t\tconst a = vnode.attrs\n\t\treturn m(\"label.small.mt-form.i.flex-center.flex-column\", [\n\t\t\t// Cannot wrap the label in a span to apply the `small` class as it will break screen readers\n\t\t\tlang.get(\"yourMessage_label\"),\n\t\t\tm(\"textarea.monospace.normal-font-size.overflow-hidden.resize-none\" + (this.isActive ? \".editor-border-active\" : \".editor-border\"), {\n\t\t\t\twrap: \"hard\",\n\t\t\t\tcols: a.cols || GIFT_CARD_MESSAGE_COLS,\n\t\t\t\trows: a.rows || GIFT_CARD_MESSAGE_HEIGHT,\n\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\tthis.textAreaDom = vnode.dom as HTMLTextAreaElement\n\t\t\t\t\tthis.textAreaDom.value = a.message\n\t\t\t\t},\n\t\t\t\tonfocus: () => {\n\t\t\t\t\tthis.isActive = true\n\t\t\t\t},\n\t\t\t\tonblur: () => {\n\t\t\t\t\tthis.isActive = false\n\t\t\t\t},\n\t\t\t\toninput: () => {\n\t\t\t\t\tconst textAreaDom = assertNotNull(this.textAreaDom)\n\t\t\t\t\tconst origStart = textAreaDom.selectionStart\n\t\t\t\t\tconst origEnd = textAreaDom.selectionEnd\n\n\t\t\t\t\t// remove characters from the end\n\t\t\t\t\twhile (textAreaDom.clientHeight < textAreaDom.scrollHeight) {\n\t\t\t\t\t\ttextAreaDom.value = textAreaDom.value.substring(0, textAreaDom.value.length - 1)\n\t\t\t\t\t}\n\n\t\t\t\t\ta.onMessageChanged(textAreaDom.value)\n\n\t\t\t\t\t// the cursor gets pushed to the end when we chew up tailing characters, so we put it back where it started in that case\n\t\t\t\t\tif (textAreaDom.selectionStart - origStart > 1) {\n\t\t\t\t\t\ttextAreaDom.selectionStart = origStart\n\t\t\t\t\t\ttextAreaDom.selectionEnd = origEnd\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t}),\n\t\t])\n\t}\n}\n"]}