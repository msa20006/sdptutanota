{"version":3,"file":"Dropdown.js","sourceRoot":"","sources":["../../../../../src/common/gui/base/Dropdown.ts"],"names":[],"mappings":"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","sourcesContent":["import m, { Children } from \"mithril\"\nimport { modal, ModalComponent } from \"./Modal\"\nimport { animations, opacity, transform, TransformEnum } from \"../animation/Animations\"\nimport { ease } from \"../animation/Easing\"\nimport { px, size } from \"../size\"\nimport { focusNext, focusPrevious, Shortcut } from \"../../misc/KeyManager\"\nimport type { ButtonAttrs } from \"./Button.js\"\nimport { lang, MaybeTranslation } from \"../../misc/LanguageViewModel\"\nimport { Keys, TabIndex } from \"../../api/common/TutanotaConstants\"\nimport { getSafeAreaInsetBottom, getSafeAreaInsetTop } from \"../HtmlUtils\"\nimport type { $Promisable, lazy, lazyAsync } from \"@tutao/tutanota-utils\"\nimport { assertNotNull, delay, downcast, filterNull, makeSingleUse, neverNull, noOp, Thunk } from \"@tutao/tutanota-utils\"\nimport { client } from \"../../misc/ClientDetector\"\nimport { pureComponent } from \"./PureComponent\"\nimport type { ClickHandler } from \"./GuiUtils\"\nimport { assertMainOrNode } from \"../../api/common/Env\"\nimport { IconButtonAttrs } from \"./IconButton.js\"\nimport { AllIcons } from \"./Icon.js\"\nimport { RowButton, RowButtonAttrs } from \"./buttons/RowButton.js\"\nimport { AriaRole } from \"../AriaUtils.js\"\nimport { BaseButton } from \"./buttons/BaseButton\"\n\nassertMainOrNode()\nexport type DropdownInfoAttrs = {\n\tinfo: string\n\tcenter: boolean\n\tbold: boolean\n}\n\nexport interface DropdownButtonAttrs {\n\t/** accessibility & tooltip description */\n\tlabel: MaybeTranslation\n\t/** visible text inside button */\n\ttext?: MaybeTranslation\n\ticon?: AllIcons\n\tclick?: ClickHandler\n\tselected?: boolean\n}\n\n/**\n * Renders small info message inside the dropdown.\n */\nconst DropdownInfo = pureComponent<DropdownInfoAttrs>(({ center, bold, info }) => {\n\treturn m(\".dropdown-info.text-break.selectable\" + (center ? \".center\" : \"\") + (bold ? \".b\" : \"\"), info)\n})\nexport type DropdownChildAttrs = DropdownInfoAttrs | DropdownButtonAttrs\n\nfunction isDropDownInfo(dropdownChild: DropdownChildAttrs): dropdownChild is DropdownInfoAttrs {\n\treturn Object.hasOwn(dropdownChild, \"info\") && Object.hasOwn(dropdownChild, \"center\") && Object.hasOwn(dropdownChild, \"bold\")\n}\n\nexport interface PosRect {\n\treadonly height: number\n\treadonly width: number\n\treadonly top: number\n\treadonly left: number\n\treadonly right: number\n\treadonly bottom: number\n}\n\n// Some Android WebViews still don't support DOMRect so we polyfill that\n// Implemented according to https://developer.mozilla.org/en-US/docs/Web/API/DOMRectReadOnly and common sense\nexport class DomRectReadOnlyPolyfilled implements PosRect {\n\tx: number\n\ty: number\n\twidth: number\n\theight: number\n\n\tconstructor(x: number, y: number, width: number, height: number) {\n\t\tthis.x = x\n\t\tthis.y = y\n\t\tthis.width = width\n\t\tthis.height = height\n\t}\n\n\tget top(): number {\n\t\treturn this.height > 0 ? this.y : this.y + this.height\n\t}\n\n\tget bottom(): number {\n\t\treturn this.height > 0 ? this.y + this.height : this.y\n\t}\n\n\tget left(): number {\n\t\treturn this.width > 0 ? this.x : this.x + this.width\n\t}\n\n\tget right(): number {\n\t\treturn this.width > 0 ? this.x + this.width : this.x\n\t}\n}\n\n// TODO: add resize listener like in the old Dropdown\nexport class Dropdown implements ModalComponent {\n\tprivate children: ReadonlyArray<DropdownChildAttrs>\n\tprivate domDropdown: HTMLElement | null = null\n\torigin: PosRect | null = null\n\toninit: ModalComponent[\"oninit\"]\n\tview: ModalComponent[\"view\"]\n\tprivate readonly width: number\n\tshortcuts: (...args: Array<any>) => any\n\tprivate filterString: string\n\tprivate domInput: HTMLInputElement | null = null\n\tprivate domContents: HTMLElement | null = null\n\tprivate isFilterable: boolean = false\n\tprivate maxHeight: number | null = null\n\tprivate closeHandler: Thunk | null = null\n\tprivate focusedBeforeShown: HTMLElement | null = document.activeElement as HTMLElement\n\n\tconstructor(lazyChildren: lazy<ReadonlyArray<DropdownChildAttrs | null>>, width: number) {\n\t\tthis.children = []\n\t\tthis.width = width\n\t\tthis.filterString = \"\"\n\n\t\tthis.oninit = () => {\n\t\t\tthis.children = filterNull(lazyChildren())\n\t\t\tthis.isFilterable = this.children.length > 10\n\t\t\tthis.children.map((child) => {\n\t\t\t\tif (isDropDownInfo(child)) {\n\t\t\t\t\treturn child\n\t\t\t\t}\n\n\t\t\t\tconst buttonChild: DropdownButtonAttrs = child\n\t\t\t\tbuttonChild.click = this.wrapClick(child.click ? child.click : () => null)\n\n\t\t\t\treturn child\n\t\t\t})\n\t\t}\n\n\t\tlet _shortcuts = this._createShortcuts()\n\n\t\tthis.shortcuts = () => {\n\t\t\treturn _shortcuts\n\t\t}\n\n\t\tconst inputField = () => {\n\t\t\treturn this.isFilterable\n\t\t\t\t? m(\n\t\t\t\t\t\t\"input.input.dropdown-bar.elevated-bg.doNotClose.button-height.button-min-height.pr-s\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tplaceholder: lang.get(\"typeToFilter_label\"),\n\t\t\t\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\t\t\t\tthis.domInput = downcast<HTMLInputElement>(vnode.dom)\n\t\t\t\t\t\t\t\tthis.domInput.value = this.filterString\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\toninput: () => {\n\t\t\t\t\t\t\t\tthis.filterString = neverNull(this.domInput).value\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\tpaddingLeft: px(size.hpad_large * 2),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tthis.filterString,\n\t\t\t\t  )\n\t\t\t\t: null\n\t\t}\n\n\t\tconst contents = () => {\n\t\t\tconst showingIcons = this.children.some((c) => \"icon\" in c && typeof c.icon !== \"undefined\")\n\t\t\t// We need to set the height to the height of the parent which already has the calculated and measured height, otherwise this element might\n\t\t\t// overflow the parent (the overall dropdown container) when there's not enough vertical space to display all items\n\t\t\treturn m(\n\t\t\t\t\".dropdown-content.scroll\",\n\t\t\t\t{\n\t\t\t\t\trole: AriaRole.Menu,\n\t\t\t\t\ttabindex: TabIndex.Programmatic,\n\t\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\t\tthis.domContents = vnode.dom as HTMLElement\n\t\t\t\t\t},\n\t\t\t\t\tonupdate: (vnode) => {\n\t\t\t\t\t\tif (this.maxHeight == null) {\n\t\t\t\t\t\t\tconst children = Array.from(vnode.dom.children) as Array<HTMLElement>\n\t\t\t\t\t\t\tthis.maxHeight = children.reduce((accumulator, children) => accumulator + children.offsetHeight, 0) + size.vpad\n\n\t\t\t\t\t\t\tif (this.origin) {\n\t\t\t\t\t\t\t\t// The dropdown-content element is added to the dom has a hidden element first.\n\t\t\t\t\t\t\t\t// The maxHeight is available after the first onupdate call. Then this promise will resolve and we can safely\n\t\t\t\t\t\t\t\t// show the dropdown.\n\t\t\t\t\t\t\t\t// Modal always schedules redraw in oncreate() of a component so we are guaranteed to have onupdate() call.\n\t\t\t\t\t\t\t\tshowDropdown(this.origin, assertNotNull(this.domDropdown), this.maxHeight, this.width).then(() => {\n\t\t\t\t\t\t\t\t\tconst firstButton = vnode.dom.getElementsByTagName(\"button\").item(0)\n\t\t\t\t\t\t\t\t\tif (this.domInput && !client.isMobileDevice()) {\n\t\t\t\t\t\t\t\t\t\tthis.domInput.focus()\n\t\t\t\t\t\t\t\t\t} else if (firstButton !== null) {\n\t\t\t\t\t\t\t\t\t\tfirstButton.focus()\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tthis.domContents?.focus()\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonscroll: (ev: EventRedraw<Event>) => {\n\t\t\t\t\t\tconst target = ev.target as HTMLElement\n\t\t\t\t\t\t// needed here to prevent flickering on ios\n\t\t\t\t\t\tev.redraw = this.domContents != null && target.scrollTop < 0 && target.scrollTop + this.domContents.offsetHeight > target.scrollHeight\n\t\t\t\t\t},\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\ttop: px(this.getFilterHeight()),\n\t\t\t\t\t\tbottom: 0,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tthis.visibleChildren().map((child) => {\n\t\t\t\t\tif (isDropDownInfo(child)) {\n\t\t\t\t\t\treturn m(DropdownInfo, child)\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn Dropdown.renderDropDownButton(child, showingIcons)\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t)\n\t\t}\n\t\tconst closeBtn = () => {\n\t\t\treturn m(BaseButton, {\n\t\t\t\tlabel: \"close_alt\",\n\t\t\t\ttext: lang.get(\"close_alt\"),\n\t\t\t\tclass: \"hidden-until-focus content-accent-fg button-content\",\n\t\t\t\tonclick: () => {\n\t\t\t\t\tthis.onClose()\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\n\t\tthis.view = (): Children => {\n\t\t\treturn m(\n\t\t\t\t\".dropdown-panel.elevated-bg.border-radius.dropdown-shadow.fit-content.flex-column.flex-start\",\n\t\t\t\t{\n\t\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\t\tthis.domDropdown = vnode.dom as HTMLElement\n\t\t\t\t\t\t// It is important to set initial opacity so that user doesn't see it with full opacity before animating.\n\t\t\t\t\t\tthis.domDropdown.style.opacity = \"0\"\n\t\t\t\t\t},\n\t\t\t\t\tonkeypress: () => {\n\t\t\t\t\t\tif (this.domInput) {\n\t\t\t\t\t\t\tthis.domInput.focus()\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[inputField(), contents(), closeBtn()],\n\t\t\t)\n\t\t}\n\t}\n\n\tprivate static renderDropDownButton(child: DropdownButtonAttrs, showingIcons: boolean) {\n\t\treturn m(RowButton, {\n\t\t\trole: AriaRole.Option,\n\t\t\tselected: child.selected,\n\t\t\tlabel: child.label,\n\t\t\ttext: child.text,\n\t\t\ticon: child.icon && showingIcons ? child.icon : showingIcons ? \"none\" : undefined,\n\t\t\tclass: \"dropdown-button\",\n\t\t\tonclick: child.click ? child.click : noOp,\n\t\t} satisfies RowButtonAttrs)\n\t}\n\n\twrapClick(fn: (event: MouseEvent, dom: HTMLElement) => unknown): (event: MouseEvent, dom: HTMLElement) => unknown {\n\t\treturn (e: MouseEvent, dom) => {\n\t\t\tconst r = fn(e, dom)\n\t\t\tthis.close()\n\t\t\treturn r\n\t\t}\n\t}\n\n\tbackgroundClick(e: MouseEvent) {\n\t\tif (\n\t\t\tthis.domDropdown &&\n\t\t\t!(e.target as HTMLElement).classList.contains(\"doNotClose\") &&\n\t\t\t(this.domDropdown.contains(e.target as HTMLElement) || this.domDropdown.parentNode === e.target)\n\t\t) {\n\t\t\tthis.onClose()\n\t\t}\n\t}\n\n\t_createShortcuts(): Array<Shortcut> {\n\t\treturn [\n\t\t\t{\n\t\t\t\tkey: Keys.ESC,\n\t\t\t\texec: () => this.onClose(),\n\t\t\t\thelp: \"close_alt\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.TAB,\n\t\t\t\tshift: true,\n\t\t\t\texec: () => (this.domDropdown ? focusPrevious(this.domDropdown) : false),\n\t\t\t\thelp: \"selectPrevious_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.TAB,\n\t\t\t\tshift: false,\n\t\t\t\texec: () => (this.domDropdown ? focusNext(this.domDropdown) : false),\n\t\t\t\thelp: \"selectNext_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.UP,\n\t\t\t\texec: () => (this.domDropdown ? focusPrevious(this.domDropdown) : false),\n\t\t\t\thelp: \"selectPrevious_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.DOWN,\n\t\t\t\texec: () => (this.domDropdown ? focusNext(this.domDropdown) : false),\n\t\t\t\thelp: \"selectNext_action\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: Keys.RETURN,\n\t\t\t\texec: () => this.chooseMatch(),\n\t\t\t\thelp: \"ok_action\",\n\t\t\t},\n\t\t]\n\t}\n\n\tsetOrigin(origin: PosRect): this {\n\t\tthis.origin = origin\n\t\treturn this\n\t}\n\n\tclose(): void {\n\t\tmodal.remove(this)\n\t}\n\n\tonClose(): void {\n\t\tif (this.closeHandler) {\n\t\t\tthis.closeHandler()\n\t\t} else {\n\t\t\tthis.close()\n\t\t}\n\t}\n\n\tpopState(e: Event): boolean {\n\t\tthis.onClose()\n\t\treturn false\n\t}\n\n\tcallingElement(): HTMLElement | null {\n\t\treturn this.focusedBeforeShown\n\t}\n\n\tchooseMatch: () => boolean = () => {\n\t\tconst filterString = this.filterString.toLowerCase()\n\n\t\tlet visibleElements: Array<ButtonAttrs> = downcast(this.visibleChildren().filter((b) => !isDropDownInfo(b)))\n\t\tlet matchingButton =\n\t\t\tvisibleElements.length === 1 ? visibleElements[0] : visibleElements.find((b) => lang.getTranslationText(b.label).toLowerCase() === filterString)\n\n\t\tif (this.domInput && document.activeElement === this.domInput && matchingButton && matchingButton.click) {\n\t\t\tmatchingButton.click(new MouseEvent(\"click\"), this.domInput)\n\t\t\treturn false\n\t\t}\n\n\t\treturn true\n\t}\n\n\t/**\n\t * Is invoked from modal as the two animations (background layer opacity and dropdown) should run in parallel\n\t */\n\thideAnimation(): Promise<void> {\n\t\treturn Promise.resolve()\n\t}\n\n\tsetCloseHandler(handler: Thunk): this {\n\t\tthis.closeHandler = handler\n\t\treturn this\n\t}\n\n\tprivate visibleChildren(): Array<DropdownChildAttrs> {\n\t\treturn this.children.filter((b) => {\n\t\t\tif (isDropDownInfo(b)) {\n\t\t\t\treturn b.info.includes(this.filterString.toLowerCase())\n\t\t\t} else if (this.isFilterable) {\n\t\t\t\tconst filterable = lang.getTranslationText(b.text ?? b.label)\n\t\t\t\treturn filterable.toLowerCase().includes(this.filterString.toLowerCase())\n\t\t\t} else {\n\t\t\t\treturn true\n\t\t\t}\n\t\t})\n\t}\n\n\tprivate getFilterHeight(): number {\n\t\treturn this.isFilterable ? size.button_height + size.vpad_xs : 0\n\t}\n}\n\nexport function createDropdown({\n\tlazyButtons,\n\toverrideOrigin,\n\twidth,\n\twithBackground,\n}: {\n\tlazyButtons: lazy<ReadonlyArray<DropdownChildAttrs | null>>\n\toverrideOrigin?: (original: PosRect) => PosRect\n\twidth?: number\n\twithBackground?: boolean\n}): ClickHandler {\n\treturn createAsyncDropdown({ lazyButtons: async () => lazyButtons(), overrideOrigin, width, withBackground })\n}\n\nexport function createAsyncDropdown({\n\tlazyButtons,\n\toverrideOrigin,\n\twidth = 200,\n\twithBackground = false,\n\tonClose = undefined,\n}: {\n\tlazyButtons: lazyAsync<ReadonlyArray<DropdownChildAttrs | null>>\n\toverrideOrigin?: (original: PosRect) => PosRect\n\twidth?: number\n\twithBackground?: boolean\n\tonClose?: Thunk\n}): ClickHandler {\n\t// not all browsers have the actual button as e.currentTarget, but all of them send it as a second argument (see https://github.com/tutao/tutanota/issues/1110)\n\treturn (_, dom) => {\n\t\tconst originalButtons = lazyButtons()\n\t\tlet buttonsResolved = false\n\t\toriginalButtons.then(() => {\n\t\t\tbuttonsResolved = true\n\t\t})\n\t\tlet buttons = originalButtons\n\t\t// If the promise is pending and does not resolve in 100ms, show progress dialog\n\t\tbuttons = Promise.race([\n\t\t\toriginalButtons,\n\t\t\tPromise.all([delay(100), import(\"../dialogs/ProgressDialog.js\")]).then(([_, module]) => {\n\t\t\t\tif (!buttonsResolved) {\n\t\t\t\t\treturn module.showProgressDialog(\"loading_msg\", originalButtons)\n\t\t\t\t} else {\n\t\t\t\t\treturn originalButtons\n\t\t\t\t}\n\t\t\t}),\n\t\t])\n\t\tbuttons.then((buttons) => {\n\t\t\tlet dropdown = new Dropdown(() => buttons, width)\n\t\t\tif (onClose) {\n\t\t\t\tdropdown.setCloseHandler(() => {\n\t\t\t\t\tonClose()\n\t\t\t\t\tdropdown.close()\n\t\t\t\t})\n\t\t\t}\n\t\t\tlet buttonRect\n\t\t\tif (overrideOrigin) {\n\t\t\t\tbuttonRect = overrideOrigin(dom.getBoundingClientRect())\n\t\t\t} else {\n\t\t\t\t// When new instance is created and the old DOM is detached we may have incorrect positioning\n\t\t\t\tbuttonRect = dom.getBoundingClientRect()\n\t\t\t}\n\t\t\tdropdown.setOrigin(buttonRect)\n\t\t\tmodal.displayUnique(dropdown, withBackground)\n\t\t})\n\t}\n}\n\nexport function showDropdownAtPosition(\n\tbuttons: ReadonlyArray<DropdownChildAttrs>,\n\txPos: number,\n\tyPos: number,\n\tcloseHandler: Thunk = noOp,\n\twidth: number = 200,\n) {\n\tconst dropdown = new Dropdown(() => buttons, width)\n\tconst close = makeSingleUse<void>(() => {\n\t\tcloseHandler()\n\t\tdropdown.close()\n\t})\n\tdropdown.setOrigin(new DomRectReadOnlyPolyfilled(xPos, yPos, 0, 0))\n\tdropdown.setCloseHandler(close)\n\tmodal.displayUnique(dropdown, false)\n}\n\ntype AttachDropdownParams = {\n\tmainButtonAttrs: Omit<IconButtonAttrs, \"click\">\n\tchildAttrs: lazy<$Promisable<ReadonlyArray<DropdownChildAttrs | null>>>\n\t/** called to determine if the dropdown actually needs to be shown */\n\tshowDropdown?: lazy<boolean>\n\twidth?: number\n\toverrideOrigin?: (original: PosRect) => PosRect\n\tonClose?: Thunk\n}\n\n/**\n *\n * @param mainButtonAttrs the attributes of the main button. if showDropdown returns false, nothing will happen.\n * @param childAttrs the attributes of the children shown in the dropdown\n * @param showDropdown this will be checked before showing the dropdown\n * @param width width of the dropdown\n * @param onClose callback that is called when the dropdown closes\n * @returns {ButtonAttrs} modified mainButtonAttrs that shows a dropdown on click or\n * button doesn't do anything if showDropdown returns false\n */\nexport function attachDropdown({\n\tmainButtonAttrs,\n\tchildAttrs,\n\tshowDropdown = () => true,\n\twidth,\n\toverrideOrigin,\n\tonClose,\n}: AttachDropdownParams): IconButtonAttrs {\n\treturn Object.assign({}, mainButtonAttrs, {\n\t\tclick: (e: MouseEvent, dom: HTMLElement) => {\n\t\t\tif (showDropdown()) {\n\t\t\t\tconst dropDownFn = createAsyncDropdown({\n\t\t\t\t\tlazyButtons: () => Promise.resolve(childAttrs()),\n\t\t\t\t\toverrideOrigin,\n\t\t\t\t\twidth,\n\t\t\t\t\tonClose,\n\t\t\t\t})\n\t\t\t\tdropDownFn(e, dom)\n\t\t\t\te.stopPropagation()\n\t\t\t}\n\t\t},\n\t})\n}\n\nexport const DROPDOWN_MARGIN = 4\n\nexport function showDropdown(\n\torigin: PosRect,\n\tdomDropdown: HTMLElement,\n\tcontentHeight: number,\n\tcontentWidth: number,\n\tposition?: \"top\" | \"bottom\",\n): Promise<unknown> {\n\t// |------------------|    |------------------|    |------------------|    |------------------|\n\t// |                  |    |                  |    |                  |    |                  |\n\t// |      |-------|   |    |  |-------|       |    |  |-----------^   |    |  ^-----------|   |\n\t// |      | elem  |   |    |  | elem  |       |    |  | dropdown  |   |    |  | dropdown  |   |\n\t// |      |-------|   |    |  |-------|       |    |  |<----------|   |    |  |---------->|   |\n\t// |  |<----------|   |    |  |---------->|   |    |      |-------|   |    |  |-------|       |\n\t// |  | dropdown  |   |    |  | dropdown  |   |    |      | elem  |   |    |  | elem  |       |\n\t// /  |-----------V   |    |  V-----------|   |    |      |-------|   |    |  |-------|       |\n\t//\n\t// Decide were to open dropdown. We open the dropdown depending on the position of the touched element.\n\t// For that we devide the screen into four parts which are upper/lower and right/left part of the screen.\n\t// If the element is in the upper right part for example we try to open the dropdown below the touched element\n\t// starting from the right edge of the touched element.\n\t// If the element is in the lower left part of the screen we open the dropdown above the element\n\t// starting from the left edge of the touched element.\n\t// If the dropdown width does not fit from its calculated starting position we open it from the edge of the screen.\n\tconst leftEdgeOfElement = origin.left\n\tconst rightEdgeOfElement = origin.right\n\tconst bottomEdgeOfElement = origin.bottom\n\tconst topEdgeOfElement = origin.top\n\tconst upperSpace = origin.top - getSafeAreaInsetTop()\n\tconst lowerSpace = window.innerHeight - origin.bottom - getSafeAreaInsetBottom()\n\tconst leftSpace = origin.left\n\tconst rightSpace = window.innerWidth - origin.right\n\tlet transformOrigin = \"\"\n\tlet maxHeight\n\n\tconst showBelow = (!position && lowerSpace > upperSpace) || position === \"bottom\"\n\tif (showBelow) {\n\t\t// element is in the upper part of the screen, dropdown should be below the element\n\t\ttransformOrigin += \"top\"\n\t\tdomDropdown.style.top = bottomEdgeOfElement + \"px\"\n\t\tdomDropdown.style.bottom = \"\"\n\t\tmaxHeight = Math.min(contentHeight, lowerSpace)\n\t} else {\n\t\t// element is in the lower part of the screen, dropdown should be above the element\n\t\ttransformOrigin += \"bottom\"\n\t\tdomDropdown.style.top = \"\"\n\t\t// position bottom is defined from the bottom edge of the screen\n\t\t// and not like the viewport origin which starts at top/left\n\t\tdomDropdown.style.bottom = px(window.innerHeight - topEdgeOfElement)\n\t\tmaxHeight = Math.min(contentHeight, upperSpace)\n\t}\n\n\ttransformOrigin += leftSpace < rightSpace ? \" left\" : \" right\"\n\tconst dropdownMaxWidth = window.innerWidth - DROPDOWN_MARGIN * 2\n\tconst dropdownWidth = Math.max(contentWidth, domDropdown.getBoundingClientRect().width)\n\tlet width = dropdownWidth\n\tlet leftStyle: number | null = null\n\tlet rightStyle: number | null = null\n\n\tif (width >= dropdownMaxWidth) {\n\t\t// If the dropdown is wider than the viewport, it takes the entire width (- margins) and text is cut off\n\t\tdomDropdown.classList.remove(\"fit-content\")\n\t\tleftStyle = DROPDOWN_MARGIN\n\t\twidth = dropdownMaxWidth\n\t} else if (leftSpace < rightSpace) {\n\t\t// element is in the left part of the screen, dropdown should extend to the right from the element\n\t\tconst availableSpaceForDropdown = window.innerWidth - leftEdgeOfElement\n\t\tlet leftEdgeOfDropdown = leftEdgeOfElement\n\n\t\tif (availableSpaceForDropdown < dropdownWidth) {\n\t\t\t// If the dropdown does not fit, we shift it by the required amount\n\t\t\tconst shiftForDropdown = leftEdgeOfDropdown + dropdownWidth - window.innerWidth + DROPDOWN_MARGIN\n\t\t\tleftEdgeOfDropdown = leftEdgeOfElement - shiftForDropdown\n\t\t}\n\n\t\tleftStyle = Math.max(DROPDOWN_MARGIN, leftEdgeOfDropdown)\n\t} else {\n\t\t// element is in the right part of the screen, dropdown should extend to the left from the element\n\t\tconst availableSpaceForDropdown = origin.right\n\t\tlet rightEdgeOfDropdown = rightEdgeOfElement\n\n\t\tif (availableSpaceForDropdown < dropdownWidth) {\n\t\t\t// If the dropdown does not fit, we shift it by the required amount. If it still does not fit, we reduce the width.\n\t\t\tconst shiftForDropdown = dropdownWidth - rightEdgeOfDropdown + DROPDOWN_MARGIN\n\t\t\trightEdgeOfDropdown = rightEdgeOfElement + shiftForDropdown\n\t\t}\n\n\t\t// position right is defined from the right edge of the screen\n\t\t// and not like the viewport origin which starts at top/left\n\t\trightStyle = Math.max(DROPDOWN_MARGIN, window.innerWidth - rightEdgeOfDropdown)\n\t}\n\n\tdomDropdown.style.left = leftStyle != null ? px(leftStyle) : \"\"\n\tdomDropdown.style.right = rightStyle != null ? px(rightStyle) : \"\"\n\tdomDropdown.style.width = px(width)\n\tdomDropdown.style.height = px(maxHeight)\n\tdomDropdown.style.transformOrigin = transformOrigin\n\treturn animations.add(domDropdown, [opacity(0, 1, true), transform(TransformEnum.Scale, 0.5, 1)], {\n\t\teasing: ease.out,\n\t})\n}\n"]}