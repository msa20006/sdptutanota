{"version":3,"file":"ReferralLinkNews.js","sourceRoot":"","sources":["../../../../../../src/common/misc/news/items/ReferralLinkNews.ts"],"names":[],"mappings":"AACA,OAAO,CAAe,MAAM,SAAS,CAAA;AAErC,OAAO,EAAE,MAAM,EAA2B,MAAM,6BAA6B,CAAA;AAE7E,OAAO,EAAE,eAAe,EAAE,kBAAkB,EAAE,MAAM,yBAAyB,CAAA;AAE7E,OAAO,EAAE,sBAAsB,EAAE,MAAM,0CAA0C,CAAA;AACjF,OAAO,EAAE,aAAa,EAAE,SAAS,EAAE,MAAM,uBAAuB,CAAA;AAGhE,MAAM,oCAAoC,GAAG,CAAC,CAAA;AAE9C;;;;GAIG;AACH,MAAM,OAAO,gBAAgB;IAGC;IAAuC;IAA6C;IAFzG,YAAY,GAAW,EAAE,CAAA;IAEjC,YAA6B,SAAoB,EAAmB,YAA0B,EAAmB,cAA8B;QAAlH,cAAS,GAAT,SAAS,CAAW;QAAmB,iBAAY,GAAZ,YAAY,CAAc;QAAmB,mBAAc,GAAd,cAAc,CAAgB;IAAG,CAAC;IAEnJ,KAAK,CAAC,OAAO;QACZ,qFAAqF;QACrF,IAAI,CAAC,MAAM,IAAI,CAAC,cAAc,CAAC,YAAY,EAAE,CAAC,CAAC,WAAW,KAAK,IAAI,EAAE,CAAC;YACrE,OAAO,KAAK,CAAA;QACb,CAAC;QAED,2BAA2B;QAC3B,IAAI,CAAC,YAAY,GAAG,MAAM,eAAe,CAAC,IAAI,CAAC,cAAc,CAAC,CAAA;QAE9D,2EAA2E;QAC3E,MAAM,mBAAmB,GAAG,sBAAsB,CAAC,SAAS,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAA;QAChG,OAAO,CACN,IAAI,CAAC,cAAc,CAAC,aAAa,EAAE;YACnC,aAAa,CAAC,IAAI,IAAI,CAAC,mBAAmB,CAAC,EAAE,oCAAoC,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,CAAC,CACvH,CAAA;IACF,CAAC;IAED,MAAM,CAAC,MAAc;QACpB,MAAM,WAAW,GAAuB;YACvC;gBACC,KAAK,EAAE,WAAW;gBAClB,KAAK,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC;gBAC7E,IAAI,wCAAsB;aAC1B;SACD,CAAA;QAED,OAAO,CAAC,CAAC,aAAa,EAAE;YACvB,CAAC,CAAC,kBAAkB,EAAE,EAAE,YAAY,EAAE,IAAI,CAAC,YAAY,EAAE,CAAC;YAC1D,CAAC,CACA,iDAAiD,EACjD,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,CACpC;SACD,CAAC,CAAA;IACH,CAAC;CACD","sourcesContent":["import { NewsListItem } from \"../NewsListItem.js\"\nimport m, { Children } from \"mithril\"\nimport { NewsId } from \"../../../api/entities/tutanota/TypeRefs.js\"\nimport { Button, ButtonAttrs, ButtonType } from \"../../../gui/base/Button.js\"\nimport { NewsModel } from \"../NewsModel.js\"\nimport { getReferralLink, ReferralLinkViewer } from \"./ReferralLinkViewer.js\"\nimport { DateProvider } from \"../../../api/common/DateProvider.js\"\nimport { generatedIdToTimestamp } from \"../../../api/common/utils/EntityUtils.js\"\nimport { getDayShifted, neverNull } from \"@tutao/tutanota-utils\"\nimport { UserController } from \"../../../api/main/UserController.js\"\n\nconst REFERRAL_NEWS_DISPLAY_THRESHOLD_DAYS = 7\n\n/**\n * News item that informs users about option to refer friends. Only shown after the customer exists at least 7 days.\n *\n * Not shown for non-admin users.\n */\nexport class ReferralLinkNews implements NewsListItem {\n\tprivate referralLink: string = \"\"\n\n\tconstructor(private readonly newsModel: NewsModel, private readonly dateProvider: DateProvider, private readonly userController: UserController) {}\n\n\tasync isShown(): Promise<boolean> {\n\t\t// Do not show this for business customers yet (not allowed to create referral links)\n\t\tif ((await this.userController.loadCustomer()).businessUse === true) {\n\t\t\treturn false\n\t\t}\n\n\t\t// Create the referral link\n\t\tthis.referralLink = await getReferralLink(this.userController)\n\n\t\t// Decode the date the user was generated from the timestamp in the user ID\n\t\tconst customerCreatedTime = generatedIdToTimestamp(neverNull(this.userController.user.customer))\n\t\treturn (\n\t\t\tthis.userController.isGlobalAdmin() &&\n\t\t\tgetDayShifted(new Date(customerCreatedTime), REFERRAL_NEWS_DISPLAY_THRESHOLD_DAYS) <= new Date(this.dateProvider.now())\n\t\t)\n\t}\n\n\trender(newsId: NewsId): Children {\n\t\tconst buttonAttrs: Array<ButtonAttrs> = [\n\t\t\t{\n\t\t\t\tlabel: \"close_alt\",\n\t\t\t\tclick: () => this.newsModel.acknowledgeNews(newsId.newsItemId).then(m.redraw),\n\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t},\n\t\t]\n\n\t\treturn m(\".full-width\", [\n\t\t\tm(ReferralLinkViewer, { referralLink: this.referralLink }),\n\t\t\tm(\n\t\t\t\t\".flex-end.flex-no-grow-no-shrink-auto.flex-wrap\",\n\t\t\t\tbuttonAttrs.map((a) => m(Button, a)),\n\t\t\t),\n\t\t])\n\t}\n}\n"]}