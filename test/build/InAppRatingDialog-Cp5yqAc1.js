
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { mithril_default } from "./mithril-Csg4iNnm.js";
import { neverNull, resolveMaybeLazy } from "./dist-CJHwsXKY.js";
import { isIOSApp } from "./Env-D5xGlXfw.js";
import { lang } from "./LanguageViewModel-BNC5ekpO.js";
import { DefaultAnimationTime, px, size, theme } from "./HtmlUtils-C-ecR7U7.js";
import { client } from "./ClientDetector-D0v6Vqu6.js";
import { Keys } from "./TutanotaConstants-3bwAESYA.js";
import { BaseButton, Button, ButtonType } from "./Icon-BuqNK7vz.js";
import { Dialog, DialogType } from "./Dialog-B6-HFvZd.js";
import { DateTime } from "./luxon-D6cgmg6Q.js";
import { locator$1 as locator } from "./CommonLocator-Csg4iNnm.js";
import { deviceConfig } from "./DeviceConfig-payZM407.js";
import { RatingCheckResult, createEvent, getRatingAllowed, isEventHappyMoment } from "./InAppRatingUtils-DwsFPPTC.js";

//#region ../src/common/ratings/InAppRatingDialog.ts
var AppRatingValue = function(AppRatingValue$1) {
	AppRatingValue$1["Happy"] = "happy";
	AppRatingValue$1["Unhappy"] = "unhappy";
	AppRatingValue$1["NotNow"] = "notNow";
	return AppRatingValue$1;
}(AppRatingValue || {});
async function showAppRatingDialog() {
	const selectedValue = await new Promise((resolve) => {
		const choose = (choice) => {
			dialog.close();
			setTimeout(() => resolve(choice), DefaultAnimationTime);
		};
		const headerBarProps = { right: [{
			label: "notNow_label",
			click: () => choose(AppRatingValue.NotNow),
			type: ButtonType.Secondary
		}] };
		const columnClass = ".flex-half.overflow-hidden";
		const dialog = new Dialog(DialogType.EditSmall, { view: () => mithril_default("", [mithril_default(".dialog-header.plr-l.flex-space-between.dialog-header-line-height", [mithril_default(columnClass + ".ml-negative-s"), mithril_default(columnClass + ".mr-negative-s.flex.justify-end", resolveMaybeLazy(neverNull(headerBarProps.right)).map((a) => mithril_default(Button, a)))]), mithril_default(".plr-l.pb-ml.text-break", mithril_default(".flex.flex-column", [mithril_default("#dialog-message.dialog-max-height.text-break.text-prewrap.selectable.scroll", mithril_default("", mithril_default(".flex-center.mt-m", mithril_default("img.pb.pt.block.height-100p", {
			src: `${window.tutao.appState.prefixWithoutFile}/images/rating/${client.isCalendarApp() ? "calendar" : "mail"}.png`,
			alt: "",
			rel: "noreferrer",
			loading: "lazy",
			decoding: "async",
			style: { width: "80%" }
		})), mithril_default("h1.text-center", lang.get("ratingHowAreWeDoing_title")), mithril_default("p.text-center", lang.get("ratingExplanation_msg")))), mithril_default(".flex.flex-column.mt", { style: { gap: "1em" } }, mithril_default(BaseButton, {
			label: "ratingLoveIt_label",
			text: lang.get("ratingLoveIt_label"),
			onclick: () => choose(AppRatingValue.Happy),
			class: `full-width border-radius-small center b flash accent-bg button-content`,
			style: { height: px(size.button_height + size.vpad_xs * 1.5) }
		}), mithril_default(BaseButton, {
			label: "ratingNeedsWork_label",
			text: lang.get("ratingNeedsWork_label"),
			onclick: () => choose(AppRatingValue.Unhappy),
			class: `full-width border-radius-small center b flash`,
			style: {
				border: `2px solid ${theme.content_accent}`,
				height: px(size.button_height + size.vpad_xs * 1.5),
				color: theme.content_accent
			}
		}))]))]) }).addShortcut({
			help: "close_alt",
			key: Keys.ESC,
			exec: () => choose(AppRatingValue.NotNow)
		});
		dialog.show();
	});
	handleRatingDialogSelection(selectedValue);
}
function handleRatingDialogSelection(selectedValue) {
	switch (selectedValue) {
		case AppRatingValue.Unhappy:
			deviceConfig.setLastRatingPromptedDate(new Date());
			break;
		case AppRatingValue.NotNow:
			deviceConfig.setRetryRatingPromptAfter(DateTime.now().plus({ months: 1 }).toJSDate());
			break;
		case AppRatingValue.Happy: {
			deviceConfig.setLastRatingPromptedDate(new Date());
			void locator.systemFacade.requestInAppRating();
			break;
		}
	}
}
async function handleRatingByEvent() {
	const isTheIOSApp = isIOSApp();
	if (isTheIOSApp) createEvent(deviceConfig);
	const now = new Date();
	if (await getRatingAllowed(now, deviceConfig, isTheIOSApp) === RatingCheckResult.RATING_ALLOWED) {
		if (isEventHappyMoment(now, deviceConfig)) void showAppRatingDialog();
	}
}

//#endregion
export { handleRatingByEvent, showAppRatingDialog };
//# sourceMappingURL=InAppRatingDialog-Cp5yqAc1.js.map