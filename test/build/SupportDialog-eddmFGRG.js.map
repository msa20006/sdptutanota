{"version":3,"file":"SupportDialog-eddmFGRG.js","names":["logins: LoginController","searchResult: Array<FaqEntry>","closeButton: ButtonAttrs","value: string","header: DialogHeaderBarAttrs","child: Component"],"sources":["../../src/common/support/SupportDialog.ts"],"sourcesContent":["import { Dialog } from \"../gui/base/Dialog\"\nimport type { DialogHeaderBarAttrs } from \"../gui/base/DialogHeaderBar\"\nimport type { ButtonAttrs } from \"../gui/base/Button.js\"\nimport { ButtonType } from \"../gui/base/Button.js\"\nimport { lang } from \"../misc/LanguageViewModel\"\nimport { TextField } from \"../gui/base/TextField.js\"\nimport m, { Component } from \"mithril\"\nimport stream from \"mithril/stream\"\nimport { faq, FaqEntry } from \"./FaqModel\"\nimport { Keys } from \"../api/common/TutanotaConstants\"\nimport { clear, debounce } from \"@tutao/tutanota-utils\"\nimport { writeSupportMail } from \"../../mail-app/mail/editor/MailEditor\"\nimport { assertMainOrNode } from \"../api/common/Env\"\nimport { LoginController } from \"../api/main/LoginController.js\"\nimport { locator } from \"../api/main/CommonLocator.js\"\nimport { LoginButton } from \"../gui/base/buttons/LoginButton.js\"\n\nassertMainOrNode()\n\nexport async function showSupportDialog(logins: LoginController) {\n\tconst canHaveEmailSupport = logins.isInternalUserLoggedIn()\n\tconst searchValue = stream(\"\")\n\tconst searchResult: Array<FaqEntry> = []\n\tlet searchExecuted = false\n\tconst closeButton: ButtonAttrs = {\n\t\tlabel: \"close_alt\",\n\t\ttype: ButtonType.Secondary,\n\t\tclick: () => {\n\t\t\tcloseAction()\n\t\t},\n\t}\n\n\tconst closeAction = () => {\n\t\tsearchValue(\"\")\n\t\tclear(searchResult)\n\t\tdialog.close()\n\t}\n\n\tconst debouncedSearch = debounce(200, async (value: string) => {\n\t\tclear(searchResult)\n\t\tfor await (const result of faq.search(value)) {\n\t\t\t// if the search query changed, we don't want to continue\n\t\t\t// sanitizing entries, we'll get called again in 200ms\n\t\t\tif (searchValue() != value) break\n\t\t\tsearchResult.push(result)\n\t\t\t// delay first redraw until the bottom of the result list is likely to be below the\n\t\t\t// visible area to prevent flashes while the list is built up\n\t\t\tif (searchResult.length > 3) m.redraw()\n\t\t}\n\t\tm.redraw()\n\t\tsearchExecuted = value.trim() !== \"\"\n\t})\n\n\tsearchValue.map(debouncedSearch)\n\n\tconst header: DialogHeaderBarAttrs = {\n\t\tleft: [closeButton],\n\t\tmiddle: \"supportMenu_label\",\n\t}\n\tconst child: Component = {\n\t\tview: () => {\n\t\t\treturn [\n\t\t\t\tm(\".pt\"),\n\t\t\t\tm(\".h1 .text-center\", lang.get(\"howCanWeHelp_title\")),\n\t\t\t\tm(TextField, {\n\t\t\t\t\tlabel: \"describeProblem_msg\",\n\t\t\t\t\tvalue: searchValue(),\n\t\t\t\t\toninput: searchValue,\n\t\t\t\t}),\n\t\t\t\tm(\n\t\t\t\t\t\".pt\",\n\t\t\t\t\tsearchResult.map((value) => {\n\t\t\t\t\t\treturn m(\".pb.faq-items\", [\n\t\t\t\t\t\t\t// we can trust the faq entry here because it is sanitized in update-translations.js from the website project\n\t\t\t\t\t\t\t// trust is required because the search results are marked with <mark> tag and the faq entries contain html elements.\n\t\t\t\t\t\t\tm(\".b\", m.trust(value.title)),\n\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\".flex-start.flex-wrap\",\n\t\t\t\t\t\t\t\tvalue.tags.filter((tag) => tag !== \"\").map((tag) => m(\".keyword-bubble.plr-button\", m.trust(tag.trim()))),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tm(\".list-border-bottom.pb\", m.trust(value.text)),\n\t\t\t\t\t\t])\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t\tsearchExecuted && canHaveEmailSupport\n\t\t\t\t\t? m(\".pb\", [\n\t\t\t\t\t\t\tm(\".h1 .text-center\", lang.get(\"noSolution_msg\")),\n\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\".flex.center-horizontally.pt\",\n\t\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\t\".flex-grow-shrink-auto.max-width-200\",\n\t\t\t\t\t\t\t\t\tm(LoginButton, {\n\t\t\t\t\t\t\t\t\t\tlabel: \"contactSupport_action\",\n\t\t\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\t\t\twriteSupportMail(searchValue().trim()).then((isSuccessful) => {\n\t\t\t\t\t\t\t\t\t\t\t\tif (isSuccessful) closeAction()\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t  ])\n\t\t\t\t\t: null,\n\t\t\t]\n\t\t},\n\t}\n\tawait faq.init(locator.domainConfigProvider().getCurrentDomainConfig().websiteBaseUrl)\n\tconst dialog = Dialog.largeDialog(header, child).addShortcut({\n\t\tkey: Keys.ESC,\n\t\texec: () => {\n\t\t\tcloseAction()\n\t\t},\n\t\thelp: \"close_alt\",\n\t})\n\tdialog.show()\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiBA,kBAAkB;AAEX,eAAe,kBAAkBA,QAAyB;CAChE,MAAM,sBAAsB,OAAO,wBAAwB;CAC3D,MAAM,cAAc,2BAAO,GAAG;CAC9B,MAAMC,eAAgC,CAAE;CACxC,IAAI,iBAAiB;CACrB,MAAMC,cAA2B;EAChC,OAAO;EACP,MAAM,WAAW;EACjB,OAAO,MAAM;AACZ,gBAAa;EACb;CACD;CAED,MAAM,cAAc,MAAM;AACzB,cAAY,GAAG;AACf,QAAM,aAAa;AACnB,SAAO,OAAO;CACd;CAED,MAAM,kBAAkB,SAAS,KAAK,OAAOC,UAAkB;AAC9D,QAAM,aAAa;AACnB,aAAW,MAAM,UAAU,IAAI,OAAO,MAAM,EAAE;AAG7C,OAAI,aAAa,IAAI,MAAO;AAC5B,gBAAa,KAAK,OAAO;AAGzB,OAAI,aAAa,SAAS,EAAG,iBAAE,QAAQ;EACvC;AACD,kBAAE,QAAQ;AACV,mBAAiB,MAAM,MAAM,KAAK;CAClC,EAAC;AAEF,aAAY,IAAI,gBAAgB;CAEhC,MAAMC,SAA+B;EACpC,MAAM,CAAC,WAAY;EACnB,QAAQ;CACR;CACD,MAAMC,QAAmB,EACxB,MAAM,MAAM;AACX,SAAO;GACN,gBAAE,MAAM;GACR,gBAAE,oBAAoB,KAAK,IAAI,qBAAqB,CAAC;GACrD,gBAAE,WAAW;IACZ,OAAO;IACP,OAAO,aAAa;IACpB,SAAS;GACT,EAAC;GACF,gBACC,OACA,aAAa,IAAI,CAAC,UAAU;AAC3B,WAAO,gBAAE,iBAAiB;KAGzB,gBAAE,MAAM,gBAAE,MAAM,MAAM,MAAM,CAAC;KAC7B,gBACC,yBACA,MAAM,KAAK,OAAO,CAAC,QAAQ,QAAQ,GAAG,CAAC,IAAI,CAAC,QAAQ,gBAAE,8BAA8B,gBAAE,MAAM,IAAI,MAAM,CAAC,CAAC,CAAC,CACzG;KACD,gBAAE,0BAA0B,gBAAE,MAAM,MAAM,KAAK,CAAC;IAChD,EAAC;GACF,EAAC,CACF;GACD,kBAAkB,sBACf,gBAAE,OAAO,CACT,gBAAE,oBAAoB,KAAK,IAAI,iBAAiB,CAAC,EACjD,gBACC,gCACA,gBACC,wCACA,gBAAE,aAAa;IACd,OAAO;IACP,SAAS,MAAM;AACd,sBAAiB,aAAa,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC,iBAAiB;AAC7D,UAAI,aAAc,cAAa;KAC/B,EAAC;IACF;GACD,EAAC,CACF,CACD,AACA,EAAC,GACF;EACH;CACD,EACD;AACD,OAAM,IAAI,KAAK,QAAQ,sBAAsB,CAAC,wBAAwB,CAAC,eAAe;CACtF,MAAM,SAAS,OAAO,YAAY,QAAQ,MAAM,CAAC,YAAY;EAC5D,KAAK,KAAK;EACV,MAAM,MAAM;AACX,gBAAa;EACb;EACD,MAAM;CACN,EAAC;AACF,QAAO,MAAM;AACb"}