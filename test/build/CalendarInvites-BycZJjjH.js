
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { assert, assertNotNull, clone } from "./dist-CJHwsXKY.js";
import { lang } from "./LanguageViewModel-BNC5ekpO.js";
import { CalendarAttendeeStatus, CalendarMethod, ConversationType, getAsEnumValue } from "./TutanotaConstants-3bwAESYA.js";
import { Dialog } from "./Dialog-B6-HFvZd.js";
import { findAttendeeInAddresses } from "./CommonCalendarUtils-DKaO7v1K.js";
import { findFirstPrivateCalendar } from "./CalendarUtils-C6jeYrj9.js";
import { locator$1 as locator } from "./CommonLocator-Csg4iNnm.js";
import { UserError } from "./UserError-DfXlMLTl.js";
import { RecipientField } from "./SharedMailUtils-AmFaSJP6.js";
import { ResolveMode } from "./RecipientsModel-DxwXuUvL.js";
import { CalendarNotificationModel, EventType, getEventType } from "./CalendarGuiUtils-CkzhFM1K.js";
import { parseCalendarFile } from "./CalendarImporter-DjgWaF1e.js";

//#region ../src/calendar-app/calendar/view/CalendarInvites.ts
async function getParsedEvent(fileData) {
	try {
		const { contents, method } = await parseCalendarFile(fileData);
		const uid = contents[0].event.uid;
		if (uid == null) return null;
		assert(!contents.some((c) => c.event.uid !== uid), "received invite with multiple events, but mismatched UIDs");
		return {
			events: contents.map((c) => c.event),
			uid,
			method: getAsEnumValue(CalendarMethod, method) || CalendarMethod.PUBLISH
		};
	} catch (e) {
		console.log(e);
		return null;
	}
}
async function getEventsFromFile(file, invitedConfidentially) {
	const dataFile = await locator.fileController.getAsDataFile(file);
	const contents = await getParsedEvent(dataFile);
	for (const event of contents?.events ?? []) event.invitedConfidentially = invitedConfidentially;
	return contents;
}
let ReplyResult = function(ReplyResult$1) {
	ReplyResult$1[ReplyResult$1["ReplyNotSent"] = 0] = "ReplyNotSent";
	ReplyResult$1[ReplyResult$1["ReplySent"] = 1] = "ReplySent";
	return ReplyResult$1;
}({});
var CalendarInviteHandler = class {
	constructor(mailboxModel, calendarModel, logins, calendarNotificationSender, sendMailModelFactory) {
		this.mailboxModel = mailboxModel;
		this.calendarModel = calendarModel;
		this.logins = logins;
		this.calendarNotificationSender = calendarNotificationSender;
		this.sendMailModelFactory = sendMailModelFactory;
	}
	/**
	* Sends a quick reply for the given event and saves the event to the first private calendar.
	* @param event the CalendarEvent to respond to, will be serialized and sent back with updated status, then saved.
	* @param attendee the attendee that should respond to the mail
	* @param decision the new status of the attendee
	* @param previousMail the mail to respond to
	*/
	async replyToEventInvitation(event, attendee, decision, previousMail, mailboxDetails) {
		const eventClone = clone(event);
		const foundAttendee = assertNotNull(findAttendeeInAddresses(eventClone.attendees, [attendee.address.address]), "attendee was not found in event clone");
		foundAttendee.status = decision;
		const notificationModel = new CalendarNotificationModel(this.calendarNotificationSender, this.logins);
		const responseModel = await this.getResponseModelForMail(previousMail, mailboxDetails, attendee.address.address);
		try {
			await notificationModel.send(eventClone, [], {
				responseModel,
				inviteModel: null,
				cancelModel: null,
				updateModel: null
			});
		} catch (e) {
			if (e instanceof UserError) {
				await Dialog.message(lang.makeTranslation("confirm_msg", e.message));
				return ReplyResult.ReplyNotSent;
			} else throw e;
		}
		const calendars = await this.calendarModel.getCalendarInfos();
		const type = getEventType(event, calendars, [attendee.address.address], this.logins.getUserController());
		if (type === EventType.SHARED_RO || type === EventType.LOCKED) return ReplyResult.ReplySent;
		const calendar = findFirstPrivateCalendar(calendars);
		if (calendar == null) return ReplyResult.ReplyNotSent;
		if (decision !== CalendarAttendeeStatus.DECLINED && eventClone.uid != null) {
			const dbEvents = await this.calendarModel.getEventsByUid(eventClone.uid);
			await this.calendarModel.processCalendarEventMessage(previousMail.sender.address, CalendarMethod.REQUEST, eventClone, [], dbEvents ?? {
				ownerGroup: calendar.group._id,
				progenitor: null,
				alteredInstances: []
			});
		}
		return ReplyResult.ReplySent;
	}
	async getResponseModelForMail(previousMail, mailboxDetails, responder) {
		const mailboxProperties = await this.mailboxModel.getMailboxProperties(mailboxDetails.mailboxGroupRoot);
		const model = await this.sendMailModelFactory(mailboxDetails, mailboxProperties);
		await model.initAsResponse({
			previousMail,
			conversationType: ConversationType.REPLY,
			senderMailAddress: responder,
			recipients: [],
			attachments: [],
			subject: "",
			bodyText: "",
			replyTos: []
		}, new Map());
		await model.addRecipient(RecipientField.TO, previousMail.sender, ResolveMode.Eager);
		model.setConfidential(previousMail.confidential);
		return model;
	}
};

//#endregion
export { CalendarInviteHandler, ReplyResult, getEventsFromFile };
//# sourceMappingURL=CalendarInvites-BycZJjjH.js.map