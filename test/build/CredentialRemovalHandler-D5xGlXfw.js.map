{"version":3,"file":"CredentialRemovalHandler-D5xGlXfw.js","names":["_: CredentialsInfo","pushApp: NativePushServiceApp","configFacade: ConfigurationDatabase","appSpecificCredentialRemovalActions: (login: string, userId: string) => Promise<void>"],"sources":["../../src/common/login/CredentialRemovalHandler.ts"],"sourcesContent":["import { NativePushServiceApp } from \"../native/main/NativePushServiceApp.js\"\nimport { ConfigurationDatabase } from \"../api/worker/facades/lazy/ConfigurationDatabase.js\"\nimport { CredentialsInfo } from \"../native/common/generatedipc/CredentialsInfo.js\"\nimport { DeviceStorageUnavailableError } from \"../api/common/error/DeviceStorageUnavailableError\"\n\nexport interface CredentialRemovalHandler {\n\tonCredentialsRemoved(credentialInfo: CredentialsInfo): Promise<void>\n}\n\nexport class NoopCredentialRemovalHandler implements CredentialRemovalHandler {\n\tasync onCredentialsRemoved(_: CredentialsInfo): Promise<void> {}\n}\n\nexport class AppsCredentialRemovalHandler implements CredentialRemovalHandler {\n\tconstructor(\n\t\tprivate readonly pushApp: NativePushServiceApp,\n\t\tprivate readonly configFacade: ConfigurationDatabase,\n\t\tprivate readonly appSpecificCredentialRemovalActions: (login: string, userId: string) => Promise<void>,\n\t) {}\n\n\tasync onCredentialsRemoved({ login, userId }: CredentialsInfo) {\n\t\tawait this.pushApp.invalidateAlarmsForUser(userId)\n\t\ttry {\n\t\t\tawait this.pushApp.removeUserFromNotifications(userId)\n\t\t} catch (e) {\n\t\t\tif (e instanceof DeviceStorageUnavailableError) {\n\t\t\t\tconsole.warn(\"Could not remove SSE data: \", e)\n\t\t\t} else {\n\t\t\t\tthrow e\n\t\t\t}\n\t\t}\n\t\tawait this.configFacade.delete(userId)\n\n\t\tawait this.appSpecificCredentialRemovalActions(login, userId)\n\t}\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IASa,+BAAN,MAAuE;CAC7E,MAAM,qBAAqBA,GAAmC,CAAE;AAChE;IAEY,+BAAN,MAAuE;CAC7E,YACkBC,SACAC,cACAC,qCAChB;EAkBF,KArBkB;EAqBjB,KApBiB;EAoBhB,KAnBgB;CACd;CAEJ,MAAM,qBAAqB,EAAE,OAAO,QAAyB,EAAE;AAC9D,QAAM,KAAK,QAAQ,wBAAwB,OAAO;AAClD,MAAI;AACH,SAAM,KAAK,QAAQ,4BAA4B,OAAO;EACtD,SAAQ,GAAG;AACX,OAAI,aAAa,8BAChB,SAAQ,KAAK,+BAA+B,EAAE;IAE9C,OAAM;EAEP;AACD,QAAM,KAAK,aAAa,OAAO,OAAO;AAEtC,QAAM,KAAK,oCAAoC,OAAO,OAAO;CAC7D;AACD"}