
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { mithril_default } from "./mithril-Csg4iNnm.js";
import { decodeBase64, noOp, ofClass } from "./dist-CJHwsXKY.js";
import "./dist-Rk9U8Iqn.js";
import "./ProgrammingError-D8yJGVtm.js";
import { isDesktop } from "./Env-D5xGlXfw.js";
import "./WhitelabelCustomizations-D1L5qbZi.js";
import { lang } from "./LanguageViewModel-BNC5ekpO.js";
import "./HtmlUtils-C-ecR7U7.js";
import { AppType } from "./ClientDetector-D0v6Vqu6.js";
import { HighestTierPlans } from "./TutanotaConstants-3bwAESYA.js";
import "./Icon-BuqNK7vz.js";
import "./Icons-Dl3nFav5.js";
import "./KeyManager-B0OGXEyJ.js";
import "./WindowFacade-B9kSBKw7.js";
import "./Modal-g4c-b9IU.js";
import { Dialog } from "./Dialog-B6-HFvZd.js";
import "./CountryList-DkVQtcTj.js";
import "./IconButton-DsU60HJ_.js";
import "./RestError-D17JEBMr.js";
import "./SuspensionError-okvIjE4H.js";
import "./LoginIncompleteError-CpiW0a0l.js";
import "./CryptoError-PqdvQky4.js";
import "./error-DDmy0eAT.js";
import "./ErrorUtils-o1-v67Dd.js";
import "./RecipientsNotFoundError-D8oGE7A_.js";
import "./OfflineDbClosedError-CAwHTI6J.js";
import "./OutOfSyncError-Ck2yBBO8.js";
import "./DbError-CcwZaPG2.js";
import "./QuotaExceededError-nFM6SdTn.js";
import { CancelledError } from "./CancelledError-FjP5S_cR.js";
import "./FileOpenError-C1_8yoXr.js";
import "./DeviceStorageUnavailableError-m4Jk_0xN.js";
import "./MailBodyTooLargeError-C2i0rX_0.js";
import "./ImportError-CIXw37Kv.js";
import "./PermissionError-BGDsHuAh.js";
import "./KeyPermanentlyInvalidatedError-DJjt81rl.js";
import "./ParserCombinator-D38ofgFx.js";
import "./ExportError-DzgStBnl.js";
import "./stream-u2PttBAC.js";
import "./EntityUtils-RQxXZlcV.js";
import "./CommonCalendarUtils-DKaO7v1K.js";
import "./Formatter-zB15D6XI.js";
import "./TypeModels-XIXYys8J.js";
import { ContactTypeRef } from "./TypeRefs-CR3TLWn0.js";
import "./TypeModels-BktRFNDN.js";
import "./TypeRefs-BP1jvX9p.js";
import { locator$1 as locator } from "./CommonLocator-Csg4iNnm.js";
import "./FormatValidator-2BBermUe.js";
import { UserError } from "./UserError-DfXlMLTl.js";
import "./MailAddressParser-BgYy6oyp.js";
import "./GroupUtils-0ZkLIAeC.js";
import "./DataFile-CY7uuk9j.js";
import "./FileUtils-W-u2-gZz.js";
import "./ProgressDialog-CJfJjh62.js";
import "./BlobUtils-D5ADcckZ.js";
import "./SharedMailUtils-AmFaSJP6.js";
import "./PasswordUtils-C4jlV9GF.js";
import "./ToggleButton-DxuDa0rS.js";
import "./BubbleButton-DGGInJMg.js";
import "./PasswordField-CPKPoLq8.js";
import { showRequestPasswordDialog } from "./PasswordRequestDialog-B7ZIVTVw.js";
import { AttachmentType, getAttachmentType } from "./AttachmentBubble-CloIefNF.js";

//#region ../src/common/native/main/WebCommonNativeFacade.ts
var WebCommonNativeFacade = class {
	constructor(logins, mailboxModel, usageTestController, fileApp, pushService, fileImportHandler, openMailBox, openCalendar, appType, openSettings) {
		this.logins = logins;
		this.mailboxModel = mailboxModel;
		this.usageTestController = usageTestController;
		this.fileApp = fileApp;
		this.pushService = pushService;
		this.fileImportHandler = fileImportHandler;
		this.openMailBox = openMailBox;
		this.openCalendar = openCalendar;
		this.appType = appType;
		this.openSettings = openSettings;
	}
	async openContactEditor(contactId) {
		await this.logins.waitForFullLogin();
		const { ContactEditor } = await import("./ContactEditor-BkD_PWvl.js");
		const decodedContactId = decodeBase64("utf-8", contactId);
		const idParts = decodedContactId.split("/");
		try {
			const contact = await locator.entityClient.load(ContactTypeRef, [idParts[0], idParts[1]]);
			const editor = new ContactEditor(locator.entityClient, contact);
			return editor.show();
		} catch (err) {
			console.error(err);
			return Dialog.message("contactNotFound_msg");
		}
	}
	/**
	* create a mail editor as requested from the native side, ie because a
	* mailto-link was clicked or the "Send as mail" option
	* in LibreOffice/Windows Explorer was used.
	*
	* if a mailtoUrl is given:
	*  * the other arguments will be ignored.
	*  * confidential will be set to false
	*
	*/
	async createMailEditor(filesUris, text, addresses, subject, mailToUrlString) {
		const { newMailEditorFromTemplate, newMailtoUrlMailEditor } = await import("./MailEditor-BuqlXNUT.js");
		const signatureModule = await import("./Signature-BcT8dcyW.js");
		await this.logins.waitForPartialLogin();
		const mailboxDetails = await this.mailboxModel.getUserMailboxDetails();
		let editor;
		try {
			if (mailToUrlString) {
				editor = await newMailtoUrlMailEditor(mailToUrlString, false, mailboxDetails).catch(ofClass(CancelledError, noOp));
				if (!editor) return;
				editor.show();
			} else {
				const fileApp = await this.fileApp();
				const files = await fileApp.getFilesMetaData(filesUris);
				const allFilesAreVCards = files.length > 0 && files.every((file) => getAttachmentType(file.mimeType) === AttachmentType.CONTACT);
				const allFilesAreICS = files.length > 0 && files.every((file) => getAttachmentType(file.mimeType) === AttachmentType.CALENDAR);
				const allFilesAreMail = files.length > 0 && files.every((file) => getAttachmentType(file.mimeType) === AttachmentType.MAIL);
				if (this.appType === AppType.Calendar) {
					if (!allFilesAreICS) return Dialog.message("invalidCalendarFile_msg");
					return this.handleFileImport(filesUris);
				}
				let willImport = false;
				if (allFilesAreVCards) willImport = await Dialog.choice("vcardInSharingFiles_msg", [{
					text: "import_action",
					value: true
				}, {
					text: "attachFiles_action",
					value: false
				}]);
else if (allFilesAreICS) willImport = await Dialog.choice("icsInSharingFiles_msg", [{
					text: "import_action",
					value: true
				}, {
					text: "attachFiles_action",
					value: false
				}]);
else if (isDesktop() && allFilesAreMail) {
					const currentPlanType = await locator.logins.getUserController().getPlanType();
					const isHighestTierPlan = HighestTierPlans.includes(currentPlanType);
					let importAction = {
						text: "import_action",
						value: true
					};
					let attachFilesAction = {
						text: "attachFiles_action",
						value: false
					};
					willImport = isHighestTierPlan && await Dialog.choice("emlOrMboxInSharingFiles_msg", [importAction, attachFilesAction]);
				}
				if (willImport) await this.handleFileImport(filesUris);
else {
					const address = addresses && addresses[0] || "";
					const recipients = address ? { to: [{
						name: "",
						address
					}] } : {};
					editor = await newMailEditorFromTemplate(mailboxDetails, recipients, subject || (files.length > 0 ? files[0].name : ""), signatureModule.appendEmailSignature(text || "", this.logins.getUserController().props), files, undefined, undefined, true);
					editor.show();
				}
			}
		} catch (e) {
			if (e instanceof UserError) Dialog.message(lang.makeTranslation("error_msg", e.message));
			throw e;
		}
	}
	async invalidateAlarms() {
		const pushService = await this.pushService();
		await pushService.reRegister();
	}
	async showAlertDialog(translationKey) {
		const { Dialog: Dialog$1 } = await import("./Dialog-ByuTWlAb.js");
		return Dialog$1.message(translationKey);
	}
	async updateTheme() {
		await locator.themeController.reloadTheme();
	}
	/**
	* largely modeled after ChangePasswordOkAction, except that we're never changing the password with it and
	* don't support bcrypt for this one.
	*/
	async promptForNewPassword(title, oldPassword) {
		const [{ Dialog: Dialog$1 }, { PasswordForm, PasswordModel }] = await Promise.all([import("./Dialog-ByuTWlAb.js"), import("./PasswordForm-CsSGe8m5.js")]);
		const model = new PasswordModel(this.usageTestController, this.logins, {
			checkOldPassword: false,
			enforceStrength: false
		});
		return new Promise((resolve, reject) => {
			const changePasswordOkAction = async (dialog) => {
				const error = model.getErrorMessageId();
				if (error) Dialog$1.message(error);
else {
					resolve(model.getNewPassword());
					dialog.close();
				}
			};
			Dialog$1.showActionDialog({
				title: lang.makeTranslation(title, title),
				child: () => mithril_default(PasswordForm, { model }),
				validator: () => model.getErrorMessageId(),
				okAction: changePasswordOkAction,
				cancelAction: () => reject(new CancelledError("user cancelled operation")),
				allowCancel: true
			});
		});
	}
	async promptForPassword(title) {
		const { Dialog: Dialog$1 } = await import("./Dialog-ByuTWlAb.js");
		return new Promise((resolve, reject) => {
			const dialog = showRequestPasswordDialog({
				title: lang.makeTranslation(title, title),
				action: async (pw) => {
					resolve(pw);
					dialog.close();
					return "";
				},
				cancel: {
					textId: "cancel_action",
					action: () => reject(new CancelledError("user cancelled operation"))
				}
			});
		});
	}
	/**
	* Parse and handle files given a list of files URI.
	* @param filesUris List of files URI to be parsed
	*/
	async handleFileImport(filesUris) {
		await this.logins.waitForFullLogin();
		await this.fileImportHandler(filesUris);
	}
};

//#endregion
export { WebCommonNativeFacade };
//# sourceMappingURL=WebCommonNativeFacade-RpKaxJ1a.js.map