{"version":3,"file":"ProgressDialog-CJfJjh62.js","names":["messageIdOrMessageFunction: MaybeLazy<MaybeTranslation>","action: Promise<T>","progressStream?: Stream<number>","isCancelable?: boolean","headerBarAttrs?: DialogHeaderBarAttrs"],"sources":["../../src/common/gui/CompletenessIndicator.ts","../../src/common/gui/dialogs/ProgressDialog.ts"],"sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { theme } from \"./theme.js\"\n\nexport interface CompletenessIndicatorAttrs {\n\tpercentageCompleted: number\n\twidth?: string\n\tclass?: string\n}\n\nexport class CompletenessIndicator implements Component<CompletenessIndicatorAttrs> {\n\tview({ attrs }: Vnode<CompletenessIndicatorAttrs>): Children {\n\t\treturn m(\n\t\t\t\"\",\n\t\t\t{\n\t\t\t\tclass: attrs.class,\n\t\t\t\tstyle: {\n\t\t\t\t\tborder: `1px solid ${theme.content_button}`,\n\t\t\t\t\twidth: attrs.width ?? \"100px\",\n\t\t\t\t\theight: \"10px\",\n\t\t\t\t},\n\t\t\t},\n\t\t\tm(\"\", {\n\t\t\t\tstyle: {\n\t\t\t\t\t\"background-color\": theme.content_button,\n\t\t\t\t\twidth: attrs.percentageCompleted + \"%\",\n\t\t\t\t\theight: \"100%\",\n\t\t\t\t},\n\t\t\t}),\n\t\t)\n\t}\n}\n","import m from \"mithril\"\nimport { assertMainOrNode, isAdminClient } from \"../../api/common/Env\"\nimport { Dialog, DialogType } from \"../base/Dialog\"\nimport { DefaultAnimationTime } from \"../animation/Animations\"\nimport type { MaybeTranslation } from \"../../misc/LanguageViewModel\"\nimport { lang } from \"../../misc/LanguageViewModel\"\nimport { progressIcon } from \"../base/Icon\"\nimport { CompletenessIndicator } from \"../CompletenessIndicator.js\"\nimport Stream from \"mithril/stream\"\nimport { TabIndex } from \"../../api/common/TutanotaConstants\"\nimport { delay, MaybeLazy, resolveMaybeLazy } from \"@tutao/tutanota-utils\"\nimport { DialogHeaderBar, DialogHeaderBarAttrs } from \"../base/DialogHeaderBar.js\"\n\nassertMainOrNode()\n\nexport async function showProgressDialog<T>(\n\tmessageIdOrMessageFunction: MaybeLazy<MaybeTranslation>,\n\taction: Promise<T>,\n\tprogressStream?: Stream<number>,\n\tisCancelable?: boolean,\n\theaderBarAttrs?: DialogHeaderBarAttrs,\n): Promise<T> {\n\tif (progressStream != null) {\n\t\tprogressStream.map(() => {\n\t\t\tm.redraw()\n\t\t})\n\t}\n\n\tconst progressDialog = new Dialog(DialogType.Progress, {\n\t\tview: () => {\n\t\t\tlet title = resolveMaybeLazy(messageIdOrMessageFunction)\n\t\t\treturn m(\"\", [\n\t\t\t\tisCancelable && headerBarAttrs\n\t\t\t\t\t? m(DialogHeaderBar, {\n\t\t\t\t\t\t\t...headerBarAttrs,\n\t\t\t\t\t\t\tclass: \"mb-l mt-negative-l mr-negative-l ml-negative-l\",\n\t\t\t\t\t  })\n\t\t\t\t\t: null,\n\t\t\t\tm(\n\t\t\t\t\t\".hide-outline\",\n\t\t\t\t\t{\n\t\t\t\t\t\t// We make this element focusable so that the screen reader announces the dialog\n\t\t\t\t\t\ttabindex: TabIndex.Default,\n\n\t\t\t\t\t\toncreate(vnode) {\n\t\t\t\t\t\t\t// We need to delay so that the eelement is attached to the parent\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t;(vnode.dom as HTMLElement).focus()\n\t\t\t\t\t\t\t}, 10)\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t[\n\t\t\t\t\t\tm(\".flex-center\", progressStream ? m(CompletenessIndicator, { percentageCompleted: progressStream() }) : progressIcon()),\n\t\t\t\t\t\tm(\"p#dialog-title\", lang.getTranslationText(title)),\n\t\t\t\t\t],\n\t\t\t\t),\n\t\t\t])\n\t\t},\n\t}).setCloseHandler(() => {\n\t\t// do not close progress on onClose event\n\t})\n\tprogressDialog.show()\n\tlet start = new Date().getTime()\n\tlet minDialogVisibilityMillis = isAdminClient() ? 0 : 1000\n\ttry {\n\t\treturn await action\n\t} finally {\n\t\tconst diff = Date.now() - start\n\t\tawait delay(Math.max(minDialogVisibilityMillis - diff, 0))\n\t\tprogressDialog.close()\n\t\tawait delay(DefaultAnimationTime)\n\t}\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IASa,wBAAN,MAA6E;CACnF,KAAK,EAAE,OAA0C,EAAY;AAC5D,SAAO,gBACN,IACA;GACC,OAAO,MAAM;GACb,OAAO;IACN,SAAS,YAAY,MAAM,eAAe;IAC1C,OAAO,MAAM,SAAS;IACtB,QAAQ;GACR;EACD,GACD,gBAAE,IAAI,EACL,OAAO;GACN,oBAAoB,MAAM;GAC1B,OAAO,MAAM,sBAAsB;GACnC,QAAQ;EACR,EACD,EAAC,CACF;CACD;AACD;;;;ACjBD,kBAAkB;AAEX,eAAe,mBACrBA,4BACAC,QACAC,gBACAC,cACAC,gBACa;AACb,KAAI,kBAAkB,KACrB,gBAAe,IAAI,MAAM;AACxB,kBAAE,QAAQ;CACV,EAAC;CAGH,MAAM,iBAAiB,IAAI,OAAO,WAAW,UAAU,EACtD,MAAM,MAAM;EACX,IAAI,QAAQ,iBAAiB,2BAA2B;AACxD,SAAO,gBAAE,IAAI,CACZ,gBAAgB,iBACb,gBAAE,iBAAiB;GACnB,GAAG;GACH,OAAO;EACN,EAAC,GACF,MACH,gBACC,iBACA;GAEC,UAAU,SAAS;GAEnB,SAAS,OAAO;AAEf,eAAW,MAAM;AACf,KAAC,MAAM,IAAoB,OAAO;IACnC,GAAE,GAAG;GACN;EACD,GACD,CACC,gBAAE,gBAAgB,iBAAiB,gBAAE,uBAAuB,EAAE,qBAAqB,gBAAgB,CAAE,EAAC,GAAG,cAAc,CAAC,EACxH,gBAAE,kBAAkB,KAAK,mBAAmB,MAAM,CAAC,AACnD,EACD,AACD,EAAC;CACF,EACD,GAAE,gBAAgB,MAAM,CAExB,EAAC;AACF,gBAAe,MAAM;CACrB,IAAI,QAAQ,IAAI,OAAO,SAAS;CAChC,IAAI,4BAA4B,eAAe,GAAG,IAAI;AACtD,KAAI;AACH,SAAO,MAAM;CACb,UAAS;EACT,MAAM,OAAO,KAAK,KAAK,GAAG;AAC1B,QAAM,MAAM,KAAK,IAAI,4BAA4B,MAAM,EAAE,CAAC;AAC1D,iBAAe,OAAO;AACtB,QAAM,MAAM,qBAAqB;CACjC;AACD"}