{"version":3,"file":"PasswordField-CPKPoLq8.js","names":["vnode: Vnode<StatusFieldAttrs>","vnode: Vnode<PasswordFieldAttrs>","isPasswordRevealed: boolean","onRevealToggled: (value: boolean) => unknown","value: string","strength: number | undefined","status: StatusSetting | undefined","helpLabel: lazy<Children> | null","password: string","strength: number"],"sources":["../../src/common/gui/base/StatusField.ts","../../src/common/misc/passwords/PasswordField.ts"],"sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { lang } from \"../../misc/LanguageViewModel\"\nimport type { TranslationKey } from \"../../misc/LanguageViewModel\"\nimport { assertMainOrNode } from \"../../api/common/Env\"\n\nassertMainOrNode()\nexport type StatusType = \"neutral\" | \"valid\" | \"invalid\"\nexport type StatusFieldAttrs = {\n\tstatus: Status\n}\n\nexport class StatusField implements Component<StatusFieldAttrs> {\n\tview(vnode: Vnode<StatusFieldAttrs>): Children {\n\t\tconst { status } = vnode.attrs\n\t\tif (!status) return null\n\t\treturn m(\"\", lang.get(status.text))\n\t}\n}\n\nexport type Status = {\n\ttype: StatusType\n\ttext: TranslationKey\n}\n","import m, { Children, Component, Vnode } from \"mithril\"\nimport { ToggleButton } from \"../../gui/base/buttons/ToggleButton.js\"\nimport { Icons } from \"../../gui/base/icons/Icons.js\"\nimport { ButtonSize } from \"../../gui/base/ButtonSize.js\"\nimport { Autocomplete, TextField, TextFieldAttrs, TextFieldType } from \"../../gui/base/TextField.js\"\nimport { CompletenessIndicator } from \"../../gui/CompletenessIndicator.js\"\nimport { isSecurePassword, scaleToVisualPasswordStrength } from \"./PasswordUtils.js\"\nimport { Status, StatusField } from \"../../gui/base/StatusField.js\"\nimport type { lazy } from \"@tutao/tutanota-utils\"\nimport type { TranslationKey, MaybeTranslation } from \"../LanguageViewModel.js\"\n\ntype StatusSetting = Status | \"auto\"\n\nexport interface PasswordFieldAttrs extends Omit<TextFieldAttrs, \"label\" | \"type\"> {\n\tlabel?: MaybeTranslation\n\tpasswordStrength?: number\n\tstatus?: StatusSetting\n}\n\nexport class PasswordField implements Component<PasswordFieldAttrs> {\n\tprivate isPasswordRevealed: boolean = false\n\n\tview(vnode: Vnode<PasswordFieldAttrs>) {\n\t\tconst attrs = vnode.attrs\n\t\t// Separate and pass the generic `TextFieldAttrs` attributes so the user can still use all of `TextFields` properties\n\t\tconst { passwordStrength, status, label, ...textFieldAttrs } = attrs\n\t\treturn m(TextField, {\n\t\t\t...textFieldAttrs,\n\t\t\tlabel: label === undefined ? \"password_label\" : label,\n\t\t\tautocompleteAs: attrs.autocompleteAs ? attrs.autocompleteAs : Autocomplete.currentPassword,\n\t\t\ttype: this.isPasswordRevealed ? TextFieldType.Text : TextFieldType.Password,\n\t\t\thelpLabel: () => PasswordField.renderHelpLabel(textFieldAttrs.value, passwordStrength, status, textFieldAttrs.helpLabel ?? null),\n\t\t\tinjectionsRight: () => {\n\t\t\t\treturn [\n\t\t\t\t\tPasswordField.renderRevealIcon(this.isPasswordRevealed, (newValue) => (this.isPasswordRevealed = newValue)),\n\t\t\t\t\ttextFieldAttrs.injectionsRight ? textFieldAttrs.injectionsRight() : null,\n\t\t\t\t]\n\t\t\t},\n\t\t})\n\t}\n\n\tprivate static renderRevealIcon(isPasswordRevealed: boolean, onRevealToggled: (value: boolean) => unknown): Children {\n\t\treturn m(ToggleButton, {\n\t\t\ttitle: isPasswordRevealed ? \"concealPassword_action\" : \"revealPassword_action\",\n\t\t\ttoggled: isPasswordRevealed,\n\t\t\tonToggled: (value, e) => {\n\t\t\t\tonRevealToggled(value)\n\t\t\t\te.stopPropagation()\n\t\t\t},\n\t\t\ticon: isPasswordRevealed ? Icons.NoEye : Icons.Eye,\n\t\t\tsize: ButtonSize.Compact,\n\t\t})\n\t}\n\n\tprivate static renderHelpLabel(value: string, strength: number | undefined, status: StatusSetting | undefined, helpLabel: lazy<Children> | null): Children {\n\t\tconst displayedStatus = PasswordField.parseStatusSetting(status, value, strength)\n\t\treturn m(\".mt-xs\", [\n\t\t\tm(\".flex.items-center\", [\n\t\t\t\tstrength != undefined\n\t\t\t\t\t? m(CompletenessIndicator, {\n\t\t\t\t\t\t\tclass: \"mr-s\",\n\t\t\t\t\t\t\tpercentageCompleted: scaleToVisualPasswordStrength(strength),\n\t\t\t\t\t  })\n\t\t\t\t\t: null,\n\t\t\t\tdisplayedStatus ? m(StatusField, { status: displayedStatus }) : null,\n\t\t\t]),\n\t\t\thelpLabel ? helpLabel() : null,\n\t\t])\n\t}\n\n\tprivate static parseStatusSetting(status: StatusSetting | undefined, password: string, strength: number | undefined): Status | null {\n\t\tif (status === \"auto\" && strength != undefined) {\n\t\t\treturn PasswordField.getPasswordStatus(password, strength!)\n\t\t} else if (status && typeof status !== \"string\") {\n\t\t\treturn status\n\t\t} else {\n\t\t\treturn null\n\t\t}\n\t}\n\n\tprivate static getPasswordStatus(password: string, strength: number): Status {\n\t\tif (password === \"\") {\n\t\t\treturn {\n\t\t\t\ttype: \"neutral\",\n\t\t\t\ttext: \"password1Neutral_msg\",\n\t\t\t}\n\t\t} else if (isSecurePassword(strength)) {\n\t\t\treturn {\n\t\t\t\ttype: \"valid\",\n\t\t\t\ttext: \"passwordValid_msg\",\n\t\t\t}\n\t\t} else {\n\t\t\treturn {\n\t\t\t\ttype: \"invalid\",\n\t\t\t\ttext: \"password1InvalidUnsecure_msg\",\n\t\t\t}\n\t\t}\n\t}\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKA,kBAAkB;IAML,cAAN,MAAyD;CAC/D,KAAKA,OAA0C;EAC9C,MAAM,EAAE,QAAQ,GAAG,MAAM;AACzB,OAAK,OAAQ,QAAO;AACpB,SAAO,gBAAE,IAAI,KAAK,IAAI,OAAO,KAAK,CAAC;CACnC;AACD;;;;ICEY,gBAAN,MAAM,cAAuD;CACnE,AAAQ,qBAA8B;CAEtC,KAAKC,OAAkC;EACtC,MAAM,QAAQ,MAAM;EAEpB,MAAM,EAAE,kBAAkB,QAAQ,MAAO,GAAG,gBAAgB,GAAG;AAC/D,SAAO,gBAAE,WAAW;GACnB,GAAG;GACH,OAAO,UAAU,YAAY,mBAAmB;GAChD,gBAAgB,MAAM,iBAAiB,MAAM,iBAAiB,aAAa;GAC3E,MAAM,KAAK,qBAAqB,cAAc,OAAO,cAAc;GACnE,WAAW,MAAM,cAAc,gBAAgB,eAAe,OAAO,kBAAkB,QAAQ,eAAe,aAAa,KAAK;GAChI,iBAAiB,MAAM;AACtB,WAAO,CACN,cAAc,iBAAiB,KAAK,oBAAoB,CAAC,aAAc,KAAK,qBAAqB,SAAU,EAC3G,eAAe,kBAAkB,eAAe,iBAAiB,GAAG,IACpE;GACD;EACD,EAAC;CACF;CAED,OAAe,iBAAiBC,oBAA6BC,iBAAwD;AACpH,SAAO,gBAAE,cAAc;GACtB,OAAO,qBAAqB,2BAA2B;GACvD,SAAS;GACT,WAAW,CAAC,OAAO,MAAM;AACxB,oBAAgB,MAAM;AACtB,MAAE,iBAAiB;GACnB;GACD,MAAM,qBAAqB,MAAM,QAAQ,MAAM;GAC/C,MAAM,WAAW;EACjB,EAAC;CACF;CAED,OAAe,gBAAgBC,OAAeC,UAA8BC,QAAmCC,WAA4C;EAC1J,MAAM,kBAAkB,cAAc,mBAAmB,QAAQ,OAAO,SAAS;AACjF,SAAO,gBAAE,UAAU,CAClB,gBAAE,sBAAsB,CACvB,YAAY,YACT,gBAAE,uBAAuB;GACzB,OAAO;GACP,qBAAqB,8BAA8B,SAAS;EAC3D,EAAC,GACF,MACH,kBAAkB,gBAAE,aAAa,EAAE,QAAQ,gBAAiB,EAAC,GAAG,IAChE,EAAC,EACF,YAAY,WAAW,GAAG,IAC1B,EAAC;CACF;CAED,OAAe,mBAAmBD,QAAmCE,UAAkBH,UAA6C;AACnI,MAAI,WAAW,UAAU,YAAY,UACpC,QAAO,cAAc,kBAAkB,UAAU,SAAU;SACjD,iBAAiB,WAAW,SACtC,QAAO;IAEP,QAAO;CAER;CAED,OAAe,kBAAkBG,UAAkBC,UAA0B;AAC5E,MAAI,aAAa,GAChB,QAAO;GACN,MAAM;GACN,MAAM;EACN;SACS,iBAAiB,SAAS,CACpC,QAAO;GACN,MAAM;GACN,MAAM;EACN;IAED,QAAO;GACN,MAAM;GACN,MAAM;EACN;CAEF;AACD"}