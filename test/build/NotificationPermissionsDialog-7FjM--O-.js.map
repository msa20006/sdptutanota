{"version":3,"file":"NotificationPermissionsDialog-7FjM--O-.js","names":["text: TranslationKey","onclick: ClickHandler","isDisabled?: boolean","classes?: string","event: MouseEvent","dom: HTMLElement","permissionName: TranslationKey","isPermissionGranted: boolean","onclick: ClickHandler","onClose: () => void","headerBarAttrs: DialogHeaderBarAttrs"],"sources":["../../src/common/settings/SettingsBannerButton.ts","../../src/common/settings/NotificationPermissionsDialog.ts"],"sourcesContent":["import { TranslationKey } from \"../misc/LanguageViewModel.js\"\nimport { ClickHandler } from \"../gui/base/GuiUtils.js\"\nimport m from \"mithril\"\nimport { BannerButton } from \"../gui/base/buttons/BannerButton.js\"\nimport { theme } from \"../gui/theme.js\"\n\n/// Renders a banner button used in the onboarding wizard and notification permission dialog\nexport function renderSettingsBannerButton(text: TranslationKey, onclick: ClickHandler, isDisabled?: boolean, classes?: string) {\n\treturn m(BannerButton, {\n\t\ttext,\n\t\tborderColor: theme.content_accent,\n\t\tcolor: theme.content_accent,\n\t\tclass: \"b full-width button-content \" + classes,\n\t\tclick: (event: MouseEvent, dom: HTMLElement) => {\n\t\t\tonclick(event, dom)\n\t\t},\n\t\tdisabled: isDisabled ?? undefined,\n\t})\n}\n","import m, { Component, Vnode } from \"mithril\"\nimport { lang, TranslationKey } from \"../misc/LanguageViewModel.js\"\nimport { isAndroidApp } from \"../api/common/Env.js\"\nimport { Dialog } from \"../gui/base/Dialog.js\"\nimport { DialogHeaderBarAttrs } from \"../gui/base/DialogHeaderBar.js\"\nimport { ButtonType } from \"../gui/base/Button.js\"\nimport { ClickHandler } from \"../gui/base/GuiUtils.js\"\nimport { PermissionType } from \"../native/common/generatedipc/PermissionType.js\"\nimport { locator } from \"../api/main/CommonLocator.js\"\nimport { renderSettingsBannerButton } from \"./SettingsBannerButton.js\"\n\nfunction renderPermissionButton(permissionName: TranslationKey, isPermissionGranted: boolean, onclick: ClickHandler) {\n\treturn renderSettingsBannerButton(isPermissionGranted ? \"granted_msg\" : permissionName, onclick, isPermissionGranted)\n}\n\n/// Shows a dialog that allows the user to set the notification and battery permissions on mobile.\n/// It shows the same screen as the notifications page in the onboarding wizard\nexport async function renderNotificationPermissionsDialog(onClose: () => void) {\n\tlet isNotificationPermissionGranted = await locator.systemPermissionHandler.hasPermission(PermissionType.Notification)\n\tlet isBatteryPermissionGranted = await locator.systemPermissionHandler.hasPermission(PermissionType.IgnoreBatteryOptimization)\n\n\tconst headerBarAttrs: DialogHeaderBarAttrs = {\n\t\tleft: [\n\t\t\t{\n\t\t\t\tlabel: \"close_alt\",\n\t\t\t\tclick: () => dialog.close(),\n\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t},\n\t\t],\n\t\tmiddle: \"permissions_label\",\n\t\tremove: () => onClose(),\n\t}\n\tconst dialog = Dialog.editSmallDialog(headerBarAttrs, () =>\n\t\tm(NotificationPermissionsBody, {\n\t\t\tisNotificationPermissionGranted,\n\t\t\tisBatteryPermissionGranted,\n\t\t\taskForNotificationPermission: (isGranted) => {\n\t\t\t\tisNotificationPermissionGranted = isGranted\n\t\t\t\tm.redraw()\n\t\t\t},\n\t\t\taskForBatteryNotificationPermission: async (isGranted) => {\n\t\t\t\tisBatteryPermissionGranted = isGranted\n\t\t\t\tm.redraw()\n\t\t\t},\n\t\t}),\n\t)\n\tdialog.show()\n}\n\nexport interface NotificationPermissionsBodyAttrs {\n\tisNotificationPermissionGranted: boolean\n\tisBatteryPermissionGranted: boolean\n\taskForNotificationPermission: (isGranted: boolean) => void\n\taskForBatteryNotificationPermission: (isGranted: boolean) => void\n}\n\n/// Displays buttons to grant the notification and battery permissions with explaining paragraphs\nexport class NotificationPermissionsBody implements Component<NotificationPermissionsBodyAttrs> {\n\tview({ attrs }: Vnode<NotificationPermissionsBodyAttrs>) {\n\t\treturn [\n\t\t\tm(\"p.mb-s\", lang.get(\"allowNotifications_msg\")),\n\t\t\trenderPermissionButton(\"grant_notification_permission_action\", attrs.isNotificationPermissionGranted, async () => {\n\t\t\t\t// Ask for the notification permission\n\t\t\t\tconst isNotificationPermissionGranted = await locator.systemPermissionHandler.requestPermission(\n\t\t\t\t\tPermissionType.Notification,\n\t\t\t\t\t\"grant_notification_permission_action\",\n\t\t\t\t)\n\t\t\t\t// Register the push notifications if granted\n\t\t\t\tif (isNotificationPermissionGranted) {\n\t\t\t\t\tlocator.pushService.register()\n\t\t\t\t}\n\t\t\t\tattrs.askForNotificationPermission(isNotificationPermissionGranted)\n\t\t\t}),\n\t\t\t!isAndroidApp()\n\t\t\t\t? null\n\t\t\t\t: m(\"section.mt-s.mb\", [\n\t\t\t\t\t\tm(\"p.mb-s.mt-s\", lang.get(\"allowBatteryPermission_msg\")),\n\t\t\t\t\t\trenderPermissionButton(\"grant_battery_permission_action\", attrs.isBatteryPermissionGranted, async () => {\n\t\t\t\t\t\t\t// Ask for permission to disable battery optimisations\n\t\t\t\t\t\t\tconst isBatteryPermissionGranted = await locator.systemPermissionHandler.requestPermission(\n\t\t\t\t\t\t\t\tPermissionType.IgnoreBatteryOptimization,\n\t\t\t\t\t\t\t\t\"allowBatteryPermission_msg\",\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\tattrs.askForBatteryNotificationPermission(isBatteryPermissionGranted)\n\t\t\t\t\t\t}),\n\t\t\t\t  ]),\n\t\t]\n\t}\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOO,SAAS,2BAA2BA,MAAsBC,SAAuBC,YAAsBC,SAAkB;AAC/H,QAAO,gBAAE,cAAc;EACtB;EACA,aAAa,MAAM;EACnB,OAAO,MAAM;EACb,OAAO,iCAAiC;EACxC,OAAO,CAACC,OAAmBC,QAAqB;AAC/C,WAAQ,OAAO,IAAI;EACnB;EACD,UAAU,cAAc;CACxB,EAAC;AACF;;;;ACPD,SAAS,uBAAuBC,gBAAgCC,qBAA8BC,SAAuB;AACpH,QAAO,2BAA2B,sBAAsB,gBAAgB,gBAAgB,SAAS,oBAAoB;AACrH;AAIM,eAAe,oCAAoCC,SAAqB;CAC9E,IAAI,kCAAkC,MAAM,QAAQ,wBAAwB,cAAc,eAAe,aAAa;CACtH,IAAI,6BAA6B,MAAM,QAAQ,wBAAwB,cAAc,eAAe,0BAA0B;CAE9H,MAAMC,iBAAuC;EAC5C,MAAM,CACL;GACC,OAAO;GACP,OAAO,MAAM,OAAO,OAAO;GAC3B,MAAM,WAAW;EACjB,CACD;EACD,QAAQ;EACR,QAAQ,MAAM,SAAS;CACvB;CACD,MAAM,SAAS,OAAO,gBAAgB,gBAAgB,MACrD,gBAAE,6BAA6B;EAC9B;EACA;EACA,8BAA8B,CAAC,cAAc;AAC5C,qCAAkC;AAClC,mBAAE,QAAQ;EACV;EACD,qCAAqC,OAAO,cAAc;AACzD,gCAA6B;AAC7B,mBAAE,QAAQ;EACV;CACD,EAAC,CACF;AACD,QAAO,MAAM;AACb;IAUY,8BAAN,MAAyF;CAC/F,KAAK,EAAE,OAAgD,EAAE;AACxD,SAAO;GACN,gBAAE,UAAU,KAAK,IAAI,yBAAyB,CAAC;GAC/C,uBAAuB,wCAAwC,MAAM,iCAAiC,YAAY;IAEjH,MAAM,kCAAkC,MAAM,QAAQ,wBAAwB,kBAC7E,eAAe,cACf,uCACA;AAED,QAAI,gCACH,SAAQ,YAAY,UAAU;AAE/B,UAAM,6BAA6B,gCAAgC;GACnE,EAAC;IACD,cAAc,GACZ,OACA,gBAAE,mBAAmB,CACrB,gBAAE,eAAe,KAAK,IAAI,6BAA6B,CAAC,EACxD,uBAAuB,mCAAmC,MAAM,4BAA4B,YAAY;IAEvG,MAAM,6BAA6B,MAAM,QAAQ,wBAAwB,kBACxE,eAAe,2BACf,6BACA;AACD,UAAM,oCAAoC,2BAA2B;GACrE,EAAC,AACD,EAAC;EACL;CACD;AACD"}