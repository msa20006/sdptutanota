
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { groupBy, isNotEmpty, partition } from "./dist-CJHwsXKY.js";
import { MailSetKind, isFolder } from "./TutanotaConstants-3bwAESYA.js";
import { elementIdPart, getElementId, getListId, isSameId } from "./EntityUtils-RQxXZlcV.js";

//#region ../src/common/api/common/mail/FolderSystem.ts
var FolderSystem = class {
	systemSubtrees;
	customSubtrees;
	importedMailSet;
	constructor(mailSets) {
		const [folders, nonFolders] = partition(mailSets, (f) => isFolder(f));
		const folderByParent = groupBy(folders, (folder) => folder.parentFolder ? elementIdPart(folder.parentFolder) : null);
		const topLevelFolders = folders.filter((f) => f.parentFolder == null);
		const [systemFolders, customFolders] = partition(topLevelFolders, (f) => f.folderType !== MailSetKind.CUSTOM);
		this.importedMailSet = nonFolders.find((f) => f.folderType === MailSetKind.Imported) || null;
		this.systemSubtrees = systemFolders.sort(compareSystem).map((f) => this.makeSubtree(folderByParent, f, compareCustom));
		this.customSubtrees = customFolders.sort(compareCustom).map((f) => this.makeSubtree(folderByParent, f, compareCustom));
	}
	getIndentedList(excludeFolder = null) {
		return [...this.getIndentedFolderList(this.systemSubtrees, excludeFolder), ...this.getIndentedFolderList(this.customSubtrees, excludeFolder)];
	}
	/** Search for a specific folder type. Some mailboxes might not have some system folders! */
	getSystemFolderByType(type) {
		return this.systemSubtrees.find((f) => f.folder.folderType === type)?.folder ?? null;
	}
	getFolderById(folderId) {
		const subtree = this.getFolderByIdInSubtrees(this.systemSubtrees, folderId) ?? this.getFolderByIdInSubtrees(this.customSubtrees, folderId);
		return subtree?.folder ?? null;
	}
	getFolderByMail(mail) {
		const sets = mail.sets;
		if (isNotEmpty(sets)) {
			for (const setId of sets) {
				const folder = this.getFolderById(elementIdPart(setId));
				if (folder != null) return folder;
			}
			return null;
		} else return this.getFolderByMailListIdLegacy(getListId(mail));
	}
	getFolderByMailListIdLegacy(mailListId) {
		const subtree = this.getFolderByMailListIdInSubtrees(this.systemSubtrees, mailListId) ?? this.getFolderByMailListIdInSubtrees(this.customSubtrees, mailListId);
		return subtree?.folder ?? null;
	}
	/**
	* Returns the children of a parent (applies only to custom folders)
	* if no parent is given, the top level custom folders are returned
	*/
	getCustomFoldersOfParent(parent) {
		if (parent) {
			const parentFolder = this.getFolderByIdInSubtrees([...this.customSubtrees, ...this.systemSubtrees], elementIdPart(parent));
			return parentFolder ? parentFolder.children.map((child) => child.folder) : [];
		} else return this.customSubtrees.map((subtree) => subtree.folder);
	}
	getDescendantFoldersOfParent(parent) {
		const parentFolder = this.getFolderByIdInSubtrees([...this.customSubtrees, ...this.systemSubtrees], elementIdPart(parent));
		if (parentFolder) return this.getIndentedFolderList([parentFolder]).slice(1);
else return [];
	}
	/** returns all parents of the folder, including the folder itself */
	getPathToFolder(folderId) {
		return this.getPathToFolderInSubtrees(this.systemSubtrees, folderId) ?? this.getPathToFolderInSubtrees(this.customSubtrees, folderId) ?? [];
	}
	checkFolderForAncestor(folder, potentialAncestorId) {
		let currentFolderPointer = folder;
		while (true) {
			if (currentFolderPointer?.parentFolder == null) return false;
else if (isSameId(currentFolderPointer.parentFolder, potentialAncestorId)) return true;
			currentFolderPointer = this.getFolderById(elementIdPart(currentFolderPointer.parentFolder));
		}
	}
	getIndentedFolderList(subtrees, excludeFolder = null, currentLevel = 0) {
		const plainList = [];
		for (const subtree of subtrees) if (!excludeFolder || !isSameId(subtree.folder._id, excludeFolder._id)) {
			plainList.push({
				level: currentLevel,
				folder: subtree.folder
			});
			plainList.push(...this.getIndentedFolderList(subtree.children, excludeFolder, currentLevel + 1));
		}
		return plainList;
	}
	getIndentedSystemList() {
		return this.systemSubtrees.map((subtree) => {
			return {
				level: 0,
				folder: subtree.folder
			};
		});
	}
	getFolderByIdInSubtrees(systems, folderId) {
		return this.getFolderBy(systems, (system) => isSameId(getElementId(system.folder), folderId));
	}
	getFolderByMailListIdInSubtrees(systems, mailListId) {
		return this.getFolderBy(systems, (subtree) => isSameId(subtree.folder.mails, mailListId));
	}
	getFolderBy(systems, predicate) {
		const topLevel = systems.find(predicate);
		if (topLevel) return topLevel;
else for (const topLevelSystem of systems) {
			const found = this.getFolderBy(topLevelSystem.children, predicate);
			if (found) return found;
		}
		return null;
	}
	getPathToFolderInSubtrees(systems, folderId) {
		for (const system of systems) {
			if (isSameId(system.folder._id, folderId)) return [system.folder];
			const subpath = this.getPathToFolderInSubtrees(system.children, folderId);
			if (subpath) return [system.folder].concat(...subpath);
		}
		return null;
	}
	makeSubtree(folderByParent, parent, comparator) {
		const childrenFolders = folderByParent.get(getElementId(parent));
		if (childrenFolders) {
			const childSystems = childrenFolders.slice().sort(comparator).map((child) => this.makeSubtree(folderByParent, child, comparator));
			return {
				folder: parent,
				children: childSystems
			};
		} else return {
			folder: parent,
			children: []
		};
	}
};
function compareCustom(folder1, folder2) {
	return folder1.name.localeCompare(folder2.name);
}
const folderTypeToOrder = {
	[MailSetKind.INBOX]: 0,
	[MailSetKind.DRAFT]: 1,
	[MailSetKind.SENT]: 2,
	[MailSetKind.TRASH]: 4,
	[MailSetKind.ARCHIVE]: 5,
	[MailSetKind.SPAM]: 6,
	[MailSetKind.ALL]: 7
};
function compareSystem(folder1, folder2) {
	const order1 = folderTypeToOrder[folder1.folderType] ?? 7;
	const order2 = folderTypeToOrder[folder2.folderType] ?? 7;
	return order1 - order2;
}

//#endregion
export { FolderSystem };
//# sourceMappingURL=FolderSystem-DLrUB8MO.js.map