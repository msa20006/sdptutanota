
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { assertNotNull, downcast, incrementDate, mapAndFilterNull, neverNull, pad, stringToUtf8Uint8Array } from "./dist-CJHwsXKY.js";
import { EndType, RepeatPeriod, SECOND_MS, assertEnumValue } from "./TutanotaConstants-3bwAESYA.js";
import { DateTime } from "./luxon-D6cgmg6Q.js";
import { getLetId } from "./EntityUtils-RQxXZlcV.js";
import { getAllDayDateLocal, isAllDayEvent } from "./CommonCalendarUtils-DKaO7v1K.js";
import { createFile } from "./TypeRefs-CR3TLWn0.js";
import { AlarmIntervalUnit, generateUid, getTimeZone, parseAlarmInterval } from "./CalendarUtils-C6jeYrj9.js";
import { calendarAttendeeStatusToParstat, iCalReplacements, repeatPeriodToIcalFrequency } from "./ImportExportUtils-B1MoOmZ0.js";
import { convertToDataFile } from "./DataFile-CY7uuk9j.js";
import { CALENDAR_MIME_TYPE } from "./SharedMailUtils-AmFaSJP6.js";

//#region ../src/calendar-app/calendar/export/CalendarExporter.ts
function makeInvitationCalendarFile(event, method, now, zone) {
	const stringValue = makeInvitationCalendar(env.versionNumber, event, method, now, zone);
	const data = stringToUtf8Uint8Array(stringValue);
	const date = new Date();
	const tmpFile = createFile({
		name: `${method.toLowerCase()}-${date.getFullYear()}${date.getMonth() + 1}${date.getDate()}.ics`,
		mimeType: CALENDAR_MIME_TYPE,
		size: String(data.byteLength),
		cid: null,
		blobs: [],
		parent: null,
		subFiles: null
	});
	return convertToDataFile(tmpFile, data);
}
function serializeCalendar(versionNumber, events, now, zone) {
	return wrapIntoCalendar(versionNumber, "PUBLISH", events.map(({ event, alarms }) => serializeEvent(event, alarms, now, zone)).flat());
}
function serializeEvent(event, alarms, now, timeZone) {
	const repeatRule = event.repeatRule;
	const isAllDay = isAllDayEvent(event);
	const localZone = getTimeZone();
	let dateStart, dateEnd;
	if (isAllDay) {
		dateStart = `DTSTART;VALUE=DATE:${formatDate(getAllDayDateLocal(event.startTime), localZone)}`;
		dateEnd = `DTEND;VALUE=DATE:${formatDate(getAllDayDateLocal(event.endTime), localZone)}`;
	} else if (repeatRule) {
		dateStart = `DTSTART;TZID=${repeatRule.timeZone}:${formatDateTime(event.startTime, repeatRule.timeZone)}`;
		dateEnd = `DTEND;TZID=${repeatRule.timeZone}:${formatDateTime(event.endTime, repeatRule.timeZone)}`;
	} else {
		dateStart = `DTSTART:${formatDateTimeUTC(event.startTime)}`;
		dateEnd = `DTEND:${formatDateTimeUTC(event.endTime)}`;
	}
	return [
		"BEGIN:VEVENT",
		dateStart,
		dateEnd,
		`DTSTAMP:${formatDateTimeUTC(now)}`,
		`UID:${event.uid ? event.uid : generateUid(assertNotNull(event._ownerGroup), now.getTime())}`,
		`SEQUENCE:${event.sequence}`,
		`SUMMARY:${serializeIcalText(event.summary)}`
	].concat(event.recurrenceId != null ? isAllDay ? `RECURRENCE-ID;VALUE=DATE:${formatDate(getAllDayDateLocal(event.recurrenceId), localZone)}` : `RECURRENCE-ID;VALUE=DATETIME:${formatDateTimeUTC(event.recurrenceId)}` : []).concat(event.description && event.description !== "" ? `DESCRIPTION:${serializeIcalText(event.description)}` : []).concat(event.recurrenceId == null ? serializeRepeatRule(repeatRule, isAllDay, timeZone) : []).concat(event.location && event.location.length > 0 ? `LOCATION:${serializeIcalText(event.location)}` : []).concat(...mapAndFilterNull(alarms, (alarm) => {
		try {
			return serializeAlarm(event, alarm);
		} catch (e) {
			console.log(`error serializing alarm ${getLetId(alarm).toString()} for event ${getLetId(event).toString()}:`, e);
			return null;
		}
	})).concat(serializeParticipants(event)).concat("END:VEVENT");
}
function serializeRepeatRule(repeatRule, isAllDayEvent$1, localTimeZone) {
	if (repeatRule) {
		let endType = "";
		if (repeatRule.endType === EndType.Count) endType = `;COUNT=${neverNull(repeatRule.endValue)}`;
else if (repeatRule.endType === EndType.UntilDate) {
			const date = new Date(Number(repeatRule.endValue));
			const value = isAllDayEvent$1 ? formatDate(incrementDate(date, -1), localTimeZone) : formatDateTimeUTC(new Date(date.getTime() - SECOND_MS));
			endType = `;UNTIL=${value}`;
		}
		const excludedDates = serializeExcludedDates(repeatRule.excludedDates, repeatRule.timeZone);
		return [`RRULE:FREQ=${repeatPeriodToIcalFrequency(assertEnumValue(RepeatPeriod, repeatRule.frequency))}` + `;INTERVAL=${repeatRule.interval}` + endType].concat(excludedDates);
	} else return [];
}
function serializeExcludedDates(excludedDates, timeZone) {
	if (excludedDates.length > 0) {
		let dates = "";
		for (let i = 0; i < excludedDates.length; i++) {
			dates += formatDateTime(excludedDates[i].date, timeZone);
			if (i < excludedDates.length - 1) dates += ",";
		}
		return [`EXDATE;TZID=${timeZone}:${dates}`];
	} else return [];
}
function formatDateTimeUTC(date) {
	return `${date.getUTCFullYear()}${pad2(date.getUTCMonth() + 1)}${pad2(date.getUTCDate())}T${pad2(date.getUTCHours())}${pad2(date.getUTCMinutes())}${pad2(date.getUTCSeconds())}Z`;
}
function formatDateTime(date, timeZone) {
	const dateTime = DateTime.fromJSDate(date, { zone: timeZone });
	return `${dateTime.year}${pad2(dateTime.month)}${pad2(dateTime.day)}T${pad2(dateTime.hour)}${pad2(dateTime.minute)}${pad2(dateTime.second)}`;
}
function formatDate(date, timeZone) {
	const dateTime = DateTime.fromJSDate(date, { zone: timeZone });
	return `${dateTime.year}${pad2(dateTime.month)}${pad2(dateTime.day)}`;
}
function makeInvitationCalendar(versionNumber, event, method, now, zone) {
	const eventSerialized = serializeEvent(event, [], now, zone);
	return wrapIntoCalendar(versionNumber, method, eventSerialized);
}
function serializeTrigger(dbAlarmInterval) {
	const alarmInterval = parseAlarmInterval(dbAlarmInterval);
	let timeMarker = "";
	if (alarmInterval.unit === AlarmIntervalUnit.MINUTE || alarmInterval.unit === AlarmIntervalUnit.HOUR) timeMarker += "T";
	return "-P" + timeMarker + alarmInterval.value.toString() + alarmInterval.unit;
}
function serializeParticipants(event) {
	const { organizer, attendees } = event;
	if (attendees.length === 0 && organizer == null) return [];
	const lines = [];
	if (organizer) {
		const namePart = organizer.name ? `;CN=${quotedString(organizer.name)}` : "";
		lines.push(`ORGANIZER${namePart};EMAIL=${organizer.address}:mailto:${organizer.address}`);
	}
	const attendeesProperties = attendees.map(({ address, status }) => {
		const namePart = address.name ? `;CN=${quotedString(address.name)}` : "";
		const partstat = calendarAttendeeStatusToParstat[downcast(status)];
		return `ATTENDEE;CUTYPE=INDIVIDUAL;ROLE=REQ-PARTICIPANT;PARTSTAT=${partstat}` + `;RSVP=TRUE${namePart};EMAIL=${address.address}:mailto:${address.address}`;
	});
	return lines.concat(attendeesProperties);
}
/**
* Create an ical quoted-string param-value
* double quotes are not allowed inside of param-value properties so they are removed
*/
function quotedString(input) {
	return `"${input.replace(/"/g, "")}"`;
}
/**
* Serialize text properties according to the iCal standard.
* https://icalendar.org/iCalendar-RFC-5545/3-3-11-text.html
*/
function serializeIcalText(value) {
	let text = value;
	for (const rawEscape in iCalReplacements) text = text.replaceAll(rawEscape, iCalReplacements[rawEscape]);
	return text;
}
function pad2(number) {
	return pad(number, 2);
}
function wrapIntoCalendar(versionNumber, method, contents) {
	let value = [
		"BEGIN:VCALENDAR",
		`PRODID:-//Tutao GmbH//Tutanota ${versionNumber}//EN`,
		"VERSION:2.0",
		"CALSCALE:GREGORIAN",
		`METHOD:${method}`
	];
	value.push(...contents);
	value.push("END:VCALENDAR");
	return value.join("\r\n");
}
function serializeAlarm(event, alarm) {
	return [
		"BEGIN:VALARM",
		"ACTION:DISPLAY",
		"DESCRIPTION:This is an event reminder",
		`TRIGGER:${serializeTrigger(alarm.alarmInfo.trigger)}`,
		"END:VALARM"
	];
}

//#endregion
export { formatDateTimeUTC, makeInvitationCalendarFile, serializeCalendar, serializeEvent, serializeExcludedDates, serializeRepeatRule, serializeTrigger };
//# sourceMappingURL=CalendarExporter-BXenr-zb.js.map