
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { assertNotNull, downcast, getFromMap } from "./dist-CJHwsXKY.js";
import { ProgrammingError } from "./ProgrammingError-D8yJGVtm.js";
import { isIOSApp } from "./Env-D5xGlXfw.js";
import { assertTranslation, lang } from "./LanguageViewModel-BNC5ekpO.js";
import { AvailablePlans, Const, PaymentMethodType, PlanType, PlanTypeToName } from "./TutanotaConstants-3bwAESYA.js";
import { DateTime, Interval } from "./luxon-D6cgmg6Q.js";
import { createUpgradePriceServiceData } from "./TypeRefs-BP1jvX9p.js";
import { UpgradePriceService } from "./Services-CZFE0084.js";
import { locator$1 as locator } from "./CommonLocator-Csg4iNnm.js";
import { UserError } from "./UserError-DfXlMLTl.js";

//#region ../src/common/subscription/FeatureListProvider.ts
let dataProvider = null;
const IOS_EXCLUDED_FEATURES = ["pricing.family_label"];
var FeatureListProvider = class FeatureListProvider {
	featureList = null;
	constructor(domainConfig) {
		this.domainConfig = domainConfig;
	}
	async init() {
		if ("undefined" === typeof fetch) return;
		const listResourceUrl = `${this.domainConfig.websiteBaseUrl}/resources/data/features.json`;
		try {
			const featureList = await fetch(listResourceUrl).then((r) => r.json());
			if (isIOSApp()) this.stripUnsupportedIosFeatures(featureList);
			this.countFeatures([
				...featureList.Free.categories,
				...featureList.Revolutionary.categories,
				...featureList.Legend.categories
			]);
			this.countFeatures([
				...featureList.Essential.categories,
				...featureList.Advanced.categories,
				...featureList.Unlimited.categories
			]);
			this.featureList = featureList;
		} catch (e) {
			console.warn(`failed to fetch feature list from  ${listResourceUrl}`, e);
		}
	}
	countFeatures(categories) {
		const featureCounts = new Map();
		for (const category of categories) {
			const count = featureCounts.get(category.title);
			const numberOfFeatures = category.features.length;
			if (count == null || numberOfFeatures > count.max) featureCounts.set(category.title, { max: numberOfFeatures });
		}
		for (const category of categories) category.featureCount = getFromMap(featureCounts, category.title, () => {
			return { max: 0 };
		});
	}
	static async getInitializedInstance(domainConfig) {
		if (dataProvider == null) {
			dataProvider = new FeatureListProvider(domainConfig);
			await dataProvider.init();
		}
		return dataProvider;
	}
	getFeatureList(targetSubscription) {
		if (this.featureList == null) return {
			subtitle: "emptyString_msg",
			categories: []
		};
else return this.featureList[PlanTypeToName[targetSubscription]];
	}
	featureLoadingDone() {
		return this.featureList != null;
	}
	/**
	* Remove features from the feature list that are unsupported for iOS and shouldn't be displayed to iOS users.
	* @param featureList feature list obtained from the server
	* @private
	*/
	stripUnsupportedIosFeatures(featureList) {
		for (const plan of AvailablePlans) {
			const features = featureList[PlanTypeToName[plan]];
			for (const category of features.categories) category.features = category.features.filter(({ text }) => {
				return !IOS_EXCLUDED_FEATURES.includes(text);
			});
		}
	}
};
function getDisplayNameOfPlanType(planType) {
	switch (planType) {
		case PlanType.PremiumBusiness: return downcast(PlanTypeToName[PlanType.Premium]);
		case PlanType.TeamsBusiness: return downcast(PlanTypeToName[PlanType.Teams]);
		default: return downcast(PlanTypeToName[planType]);
	}
}
let UpgradePriceType = function(UpgradePriceType$1) {
	UpgradePriceType$1["PlanReferencePrice"] = "0";
	UpgradePriceType$1["PlanActualPrice"] = "1";
	UpgradePriceType$1["PlanNextYearsPrice"] = "2";
	UpgradePriceType$1["AdditionalUserPrice"] = "3";
	UpgradePriceType$1["ContactFormPrice_UNUSED"] = "4";
	return UpgradePriceType$1;
}({});

//#endregion
//#region ../src/common/misc/CyberMondayUtils.ts
function isReferenceDateWithinCyberMondayCampaign(referenceDate) {
	const startIso = "2024-11-15T10:00:00+01:00";
	const endIso = "2024-12-05T10:00:00+01:00";
	const cyberMonday2024Interval = Interval.fromDateTimes(DateTime.fromISO(startIso), DateTime.fromISO(endIso));
	return cyberMonday2024Interval.contains(DateTime.fromJSDate(referenceDate));
}

//#endregion
//#region ../src/common/subscription/PriceUtils.ts
let PaymentInterval = function(PaymentInterval$1) {
	PaymentInterval$1[PaymentInterval$1["Monthly"] = 1] = "Monthly";
	PaymentInterval$1[PaymentInterval$1["Yearly"] = 12] = "Yearly";
	return PaymentInterval$1;
}({});
function asPaymentInterval(paymentInterval) {
	if (typeof paymentInterval === "string") paymentInterval = Number(paymentInterval);
	switch (paymentInterval) {
		case Number(PaymentInterval.Monthly): return PaymentInterval.Monthly;
		case Number(PaymentInterval.Yearly): return PaymentInterval.Yearly;
		default: throw new ProgrammingError(`invalid payment interval: ${paymentInterval}`);
	}
}
function getPaymentMethodName(paymentMethod) {
	if (paymentMethod === PaymentMethodType.Invoice) return lang.get("paymentMethodOnAccount_label");
else if (paymentMethod === PaymentMethodType.CreditCard) return lang.get("paymentMethodCreditCard_label");
else if (paymentMethod === PaymentMethodType.Sepa) return "SEPA";
else if (paymentMethod === PaymentMethodType.Paypal) return "PayPal";
else if (paymentMethod === PaymentMethodType.AccountBalance) return lang.get("paymentMethodAccountBalance_label");
else if (paymentMethod === PaymentMethodType.AppStore) return "App Store";
else return "<" + lang.get("comboBoxSelectionNone_msg") + ">";
}
function formatPrice(value, includeCurrency) {
	value = Math.round(value * 100) / 100;
	if (includeCurrency) return value % 1 !== 0 ? lang.formats.priceWithCurrency.format(value) : lang.formats.priceWithCurrencyWithoutFractionDigits.format(value);
else return value % 1 !== 0 ? lang.formats.priceWithoutCurrency.format(value) : lang.formats.priceWithoutCurrencyWithoutFractionDigits.format(value);
}
function formatMonthlyPrice(subscriptionPrice, paymentInterval) {
	const monthlyPrice = paymentInterval === PaymentInterval.Yearly ? subscriptionPrice / Number(PaymentInterval.Yearly) : subscriptionPrice;
	return formatPrice(monthlyPrice, true);
}
function formatPriceWithInfo(formattedPrice, paymentInterval, taxIncluded) {
	const netOrGross = taxIncluded ? lang.get("gross_label") : lang.get("net_label");
	const yearlyOrMonthly = paymentInterval === PaymentInterval.Yearly ? lang.get("pricing.perYear_label") : lang.get("pricing.perMonth_label");
	return `${formattedPrice} ${yearlyOrMonthly} (${netOrGross})`;
}
var PriceAndConfigProvider = class PriceAndConfigProvider {
	upgradePriceData = null;
	planPrices = null;
	isReferralCodeSignup = false;
	mobilePrices = null;
	constructor() {}
	async init(registrationDataId, serviceExecutor, referralCode) {
		const data = createUpgradePriceServiceData({
			date: Const.CURRENT_DATE,
			campaign: registrationDataId,
			referralCode
		});
		this.upgradePriceData = await serviceExecutor.get(UpgradePriceService, data);
		if (isIOSApp()) {
			this.mobilePrices = new Map();
			const allPrices = await locator.mobilePaymentsFacade.getPlanPrices();
			for (const plan of allPrices) this.mobilePrices.set(plan.name, plan);
		}
		this.isReferralCodeSignup = referralCode != null;
		this.planPrices = this.upgradePriceData.plans;
	}
	static async getInitializedInstance(registrationDataId, serviceExecutor, referralCode) {
		if (referralCode != null && registrationDataId != null) throw new UserError("referralSignupCampaignError_msg");
		const priceDataProvider = new PriceAndConfigProvider();
		await priceDataProvider.init(registrationDataId, serviceExecutor, referralCode);
		return priceDataProvider;
	}
	getSubscriptionPrice(paymentInterval, subscription, type) {
		return paymentInterval === PaymentInterval.Yearly ? this.getYearlySubscriptionPrice(subscription, type) : this.getMonthlySubscriptionPrice(subscription, type);
	}
	/**
	* Returns the subscription price with the currency formatting on iOS and as a plain period seperated number on other platforms
	*/
	getSubscriptionPriceWithCurrency(paymentInterval, subscription, type) {
		const price = this.getSubscriptionPrice(paymentInterval, subscription, type);
		const rawPrice = price.toString();
		if (isIOSApp()) return this.getAppStorePaymentsSubscriptionPrice(subscription, paymentInterval, rawPrice, type);
else {
			const price$1 = this.getSubscriptionPrice(paymentInterval, subscription, type);
			return {
				displayPrice: formatPrice(price$1, true),
				rawPrice: price$1.toString()
			};
		}
	}
	getAppStorePaymentsSubscriptionPrice(subscription, paymentInterval, rawPrice, type) {
		const planName = PlanTypeToName[subscription];
		const applePrices = this.getMobilePrices().get(planName.toLowerCase());
		if (!applePrices) throw new Error(`no such iOS plan ${planName}`);
		const isCyberMonday = isReferenceDateWithinCyberMondayCampaign(Const.CURRENT_DATE ?? new Date());
		switch (paymentInterval) {
			case PaymentInterval.Monthly: return {
				displayPrice: applePrices.displayMonthlyPerMonth,
				rawPrice: applePrices.rawMonthlyPerMonth
			};
			case PaymentInterval.Yearly: return {
				displayPrice: applePrices.displayYearlyPerYear,
				rawPrice: applePrices.rawYearlyPerYear
			};
		}
	}
	getRawPricingData() {
		return assertNotNull(this.upgradePriceData);
	}
	getYearlySubscriptionPrice(subscription, upgrade) {
		const prices = this.getPlanPricesForPlan(subscription);
		const monthlyPrice = getPriceForUpgradeType(upgrade, prices);
		const discount = upgrade === UpgradePriceType.PlanActualPrice ? Number(prices.firstYearDiscount) : 0;
		return monthlyPrice * 10 - discount;
	}
	getMonthlySubscriptionPrice(subscription, upgrade) {
		const prices = this.getPlanPricesForPlan(subscription);
		return getPriceForUpgradeType(upgrade, prices);
	}
	getMobilePrices() {
		return assertNotNull(this.mobilePrices);
	}
	getPlanPricesForPlan(subscription) {
		const planPrices = assertNotNull(this.planPrices, "called getPlanPricesForPlan before init");
		return assertNotNull(planPrices.find((prices) => PlanTypeToName[subscription] === prices.planName), "plan type not found");
	}
	getPriceInfoMessage() {
		const rawData = this.getRawPricingData();
		const bonusMonthMessage = getReasonForBonusMonths(Number(rawData.bonusMonthsForYearlyPlan), this.isReferralCodeSignup);
		if (bonusMonthMessage) return bonusMonthMessage;
else if (rawData.messageTextId) return assertTranslation(rawData.messageTextId);
else return null;
	}
};
function getPriceForUpgradeType(upgrade, prices) {
	switch (upgrade) {
		case UpgradePriceType.PlanReferencePrice: return Number(prices.monthlyReferencePrice);
		case UpgradePriceType.PlanActualPrice:
		case UpgradePriceType.PlanNextYearsPrice: return Number(prices.monthlyPrice);
		case UpgradePriceType.AdditionalUserPrice: return Number(prices.additionalUserPriceMonthly);
		case UpgradePriceType.ContactFormPrice_UNUSED: throw new ProgrammingError("invalid price type");
	}
}
/**
* Helper function to determine the reason for bonus months that have be provided by the UpgradePriceService
* @param bonusMonths The amount of bonus month
* @param isReferralCodeSignup Indication if a referral code has been used to query the bonus months.
*/
function getReasonForBonusMonths(bonusMonths, isReferralCodeSignup) {
	if (bonusMonths == 12) return "chooseYearlyForOffer_msg";
else if (bonusMonths == 1) return "referralSignup_msg";
else if (bonusMonths == 0 && isReferralCodeSignup) return "referralSignupInvalid_msg";
else return null;
}

//#endregion
export { FeatureListProvider, PaymentInterval, PriceAndConfigProvider, UpgradePriceType, asPaymentInterval, formatMonthlyPrice, formatPrice, formatPriceWithInfo, getDisplayNameOfPlanType, getPaymentMethodName, isReferenceDateWithinCyberMondayCampaign };
//# sourceMappingURL=PriceUtils-DA-dFW8L.js.map