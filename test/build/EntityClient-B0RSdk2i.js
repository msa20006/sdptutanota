
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { downcast, groupByAndMap, last, pMap } from "./dist-CJHwsXKY.js";
import { NotAuthorizedError, NotFoundError } from "./RestError-D17JEBMr.js";
import { CUSTOM_MIN_ID, GENERATED_MIN_ID, RANGE_ITEM_LIMIT, Type, ValueType, elementIdPart, firstBiggerThanSecond, getElementId, getLetId, listIdPart } from "./EntityUtils-RQxXZlcV.js";
import { RootInstanceTypeRef } from "./TypeRefs-BP1jvX9p.js";
import { resolveTypeReference } from "./EntityFunctions-l6CncM5C.js";

//#region ../src/common/api/common/EntityClient.ts
var EntityClient = class {
	_target;
	constructor(target) {
		this._target = target;
	}
	/**
	* Important: we can't pass functions through the bridge, so we can't pass ownerKeyProvider from the page context.
	*/
	load(typeRef, id, opts = {}) {
		return this._target.load(typeRef, id, opts);
	}
	async loadAll(typeRef, listId, start) {
		const typeModel = await resolveTypeReference(typeRef);
		if (!start) start = typeModel.values["_id"].type === ValueType.GeneratedId ? GENERATED_MIN_ID : CUSTOM_MIN_ID;
		const elements = await this.loadRange(typeRef, listId, start, RANGE_ITEM_LIMIT, false);
		if (elements.length === RANGE_ITEM_LIMIT) {
			let lastElementId = getLetId(elements[elements.length - 1])[1];
			const nextElements = await this.loadAll(typeRef, listId, lastElementId);
			return elements.concat(nextElements);
		} else return elements;
	}
	async loadReverseRangeBetween(typeRef, listId, start, end, rangeItemLimit = RANGE_ITEM_LIMIT) {
		const typeModel = await resolveTypeReference(typeRef);
		if (typeModel.type !== Type.ListElement) throw new Error("only ListElement types are permitted");
		const loadedEntities = await this._target.loadRange(typeRef, listId, start, rangeItemLimit, true);
		const filteredEntities = loadedEntities.filter((entity) => firstBiggerThanSecond(getElementId(entity), end, typeModel));
		if (filteredEntities.length === rangeItemLimit) {
			const lastElementId = getElementId(filteredEntities[loadedEntities.length - 1]);
			const { elements: remainingEntities, loadedCompletely } = await this.loadReverseRangeBetween(typeRef, listId, lastElementId, end, rangeItemLimit);
			return {
				elements: filteredEntities.concat(remainingEntities),
				loadedCompletely
			};
		} else return {
			elements: filteredEntities,
			loadedCompletely: wasReverseRangeCompletelyLoaded(rangeItemLimit, loadedEntities, filteredEntities)
		};
	}
	loadRange(typeRef, listId, start, count, reverse, opts = {}) {
		return this._target.loadRange(typeRef, listId, start, count, reverse, opts);
	}
	/**
	* load multiple does not guarantee order or completeness of returned elements.
	*/
	loadMultiple(typeRef, listId, elementIds, ownerEncSessionKeyProvider, opts = {}) {
		return this._target.loadMultiple(typeRef, listId, elementIds, ownerEncSessionKeyProvider, opts);
	}
	setup(listId, instance, extraHeaders, options) {
		return this._target.setup(listId, instance, extraHeaders, options);
	}
	setupMultipleEntities(listId, instances) {
		return this._target.setupMultiple(listId, instances);
	}
	update(instance, options) {
		return this._target.update(instance, options);
	}
	erase(instance, options) {
		return this._target.erase(instance, options);
	}
	async loadRoot(typeRef, groupId, opts = {}) {
		const typeModel = await resolveTypeReference(typeRef);
		const rootId = [groupId, typeModel.rootId];
		const root = await this.load(RootInstanceTypeRef, rootId, opts);
		return this.load(typeRef, downcast(root.reference), opts);
	}
};
function wasReverseRangeCompletelyLoaded(rangeItemLimit, loadedEntities, filteredEntities) {
	if (loadedEntities.length < rangeItemLimit) {
		const lastLoaded = last(loadedEntities);
		const lastFiltered = last(filteredEntities);
		if (!lastLoaded) return true;
		return lastLoaded === lastFiltered;
	}
	return false;
}
async function loadMultipleFromLists(type, entityClient, toLoad) {
	if (toLoad.length === 0) return [];
	const indexedEventIds = groupByAndMap(toLoad, listIdPart, elementIdPart);
	return (await pMap(indexedEventIds, async ([listId, elementIds]) => {
		try {
			return await entityClient.loadMultiple(type, listId, elementIds);
		} catch (e) {
			if (e instanceof NotFoundError || e instanceof NotAuthorizedError) {
				console.log(`could not load entities of type ${type} from list ${listId}: ${e.name}`);
				return [];
			} else throw e;
		}
	}, { concurrency: 3 })).flat();
}

//#endregion
export { EntityClient, loadMultipleFromLists };
//# sourceMappingURL=EntityClient-B0RSdk2i.js.map