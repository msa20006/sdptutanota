{"version":3,"file":"RichNotificationsNews-CuMQbODn.js","names":["vnode: Vnode<NotificationContentSelectorAttrs>","newsModel: NewsModel","pushApp: NativePushServiceApp | null","_newsId: NewsId","newsId: NewsId"],"sources":["../../src/mail-app/settings/NotificationContentSelector.ts","../../src/common/misc/news/items/RichNotificationsNews.ts"],"sourcesContent":["import m, { Component, Vnode } from \"mithril\"\nimport { DropDownSelector, DropDownSelectorAttrs } from \"../../common/gui/base/DropDownSelector.js\"\nimport { lang } from \"../../common/misc/LanguageViewModel.js\"\nimport { ExtendedNotificationMode } from \"../../common/native/common/generatedipc/ExtendedNotificationMode.js\"\nimport { isApp, isDesktop } from \"../../common/api/common/Env.js\"\nimport { PermissionType } from \"../../common/native/common/generatedipc/PermissionType.js\"\nimport { locator } from \"../../common/api/main/CommonLocator.js\"\nimport { renderNotificationPermissionsDialog } from \"../../common/settings/NotificationPermissionsDialog.js\"\n\nexport interface NotificationContentSelectorAttrs {\n\textendedNotificationMode: ExtendedNotificationMode\n\tonChange: (value: ExtendedNotificationMode) => void\n}\n\nexport class NotificationContentSelector implements Component<NotificationContentSelectorAttrs> {\n\tview(vnode: Vnode<NotificationContentSelectorAttrs>) {\n\t\treturn m(DropDownSelector, {\n\t\t\tlabel: \"notificationContent_label\",\n\t\t\t// Subject is not available on desktop at the moment.\n\t\t\titems: isDesktop()\n\t\t\t\t? [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: lang.get(\"notificationPreferenceNoSenderOrSubject_action\"),\n\t\t\t\t\t\t\tvalue: ExtendedNotificationMode.NoSenderOrSubject,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: lang.get(\"notificationPreferenceOnlySender_action\"),\n\t\t\t\t\t\t\tvalue: ExtendedNotificationMode.OnlySender,\n\t\t\t\t\t\t},\n\t\t\t\t  ]\n\t\t\t\t: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: lang.get(\"notificationPreferenceNoSenderOrSubject_action\"),\n\t\t\t\t\t\t\tvalue: ExtendedNotificationMode.NoSenderOrSubject,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: lang.get(\"notificationPreferenceOnlySender_action\"),\n\t\t\t\t\t\t\tvalue: ExtendedNotificationMode.OnlySender,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: lang.get(\"notificationPreferenceSenderAndSubject_action\"),\n\t\t\t\t\t\t\tvalue: ExtendedNotificationMode.SenderAndSubject,\n\t\t\t\t\t\t},\n\t\t\t\t  ],\n\t\t\tselectedValue: vnode.attrs.extendedNotificationMode,\n\t\t\tselectionChangedHandler: async (newValue) => {\n\t\t\t\t// Permissions only exist on mobile, so we should not check on other platforms\n\t\t\t\tif (isApp()) {\n\t\t\t\t\tconst isNotificationPermissionGranted = await locator.systemPermissionHandler.hasPermission(PermissionType.Notification)\n\t\t\t\t\tif (isNotificationPermissionGranted) {\n\t\t\t\t\t\tvnode.attrs.onChange(newValue)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tawait renderNotificationPermissionsDialog(() => {\n\t\t\t\t\t\t\t// Switch to the targeted setting regardless of whether the permission was granted\n\t\t\t\t\t\t\tvnode.attrs.onChange(newValue)\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tvnode.attrs.onChange(newValue)\n\t\t\t\t}\n\t\t\t},\n\t\t\tdropdownWidth: 250,\n\t\t} satisfies DropDownSelectorAttrs<ExtendedNotificationMode>)\n\t}\n}\n","import { NewsListItem } from \"../NewsListItem.js\"\nimport { NewsId } from \"../../../api/entities/tutanota/TypeRefs.js\"\nimport m, { Children } from \"mithril\"\nimport { NewsModel } from \"../NewsModel.js\"\nimport { NativePushServiceApp } from \"../../../native/main/NativePushServiceApp.js\"\nimport { ExtendedNotificationMode } from \"../../../native/common/generatedipc/ExtendedNotificationMode.js\"\nimport { assertNotNull } from \"@tutao/tutanota-utils\"\nimport { Button, ButtonType } from \"../../../gui/base/Button.js\"\nimport { lang } from \"../../LanguageViewModel.js\"\nimport { NotificationContentSelector } from \"../../../../mail-app/settings/NotificationContentSelector.js\"\nimport { isApp } from \"../../../api/common/Env.js\"\n\nexport class RichNotificationsNews implements NewsListItem {\n\tprivate notificationMode: ExtendedNotificationMode | null = null\n\n\tconstructor(private readonly newsModel: NewsModel, private readonly pushApp: NativePushServiceApp | null) {}\n\n\tasync isShown(_newsId: NewsId): Promise<boolean> {\n\t\treturn (\n\t\t\tisApp() &&\n\t\t\tthis.pushApp != null &&\n\t\t\t(this.notificationMode = await this.pushApp.getExtendedNotificationMode()) != ExtendedNotificationMode.SenderAndSubject\n\t\t)\n\t}\n\n\trender(newsId: NewsId): Children {\n\t\t// if we got here then we must have it\n\t\tconst pushApp = assertNotNull(this.pushApp)\n\t\treturn m(\".full-width\", [\n\t\t\tm(\".h4\", { style: { \"text-transform\": \"capitalize\" } }, lang.get(\"richNotifications_title\")),\n\t\t\tm(\"p\", lang.get(\"richNotificationsNewsItem_msg\")),\n\t\t\tm(\n\t\t\t\t\".max-width-s\",\n\t\t\t\tm(NotificationContentSelector, {\n\t\t\t\t\textendedNotificationMode: this.notificationMode ?? ExtendedNotificationMode.NoSenderOrSubject,\n\t\t\t\t\tonChange: (mode) => {\n\t\t\t\t\t\tthis.notificationMode = mode\n\t\t\t\t\t\tpushApp.setExtendedNotificationMode(mode)\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t),\n\t\t\tm(\n\t\t\t\t\".flex-end\",\n\t\t\t\tm(Button, {\n\t\t\t\t\tlabel: \"close_alt\",\n\t\t\t\t\tclick: () => this.acknowledge(newsId),\n\t\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t\t}),\n\t\t\t),\n\t\t])\n\t}\n\n\tprivate async acknowledge(newsId: NewsId) {\n\t\tawait this.newsModel.acknowledgeNews(newsId.newsItemId)\n\t\tm.redraw()\n\t}\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAca,8BAAN,MAAyF;CAC/F,KAAKA,OAAgD;AACpD,SAAO,gBAAE,kBAAkB;GAC1B,OAAO;GAEP,OAAO,WAAW,GACf,CACA;IACC,MAAM,KAAK,IAAI,iDAAiD;IAChE,OAAO,yBAAyB;GAChC,GACD;IACC,MAAM,KAAK,IAAI,0CAA0C;IACzD,OAAO,yBAAyB;GAChC,CACA,IACD;IACA;KACC,MAAM,KAAK,IAAI,iDAAiD;KAChE,OAAO,yBAAyB;IAChC;IACD;KACC,MAAM,KAAK,IAAI,0CAA0C;KACzD,OAAO,yBAAyB;IAChC;IACD;KACC,MAAM,KAAK,IAAI,gDAAgD;KAC/D,OAAO,yBAAyB;IAChC;GACA;GACJ,eAAe,MAAM,MAAM;GAC3B,yBAAyB,OAAO,aAAa;AAE5C,QAAI,OAAO,EAAE;KACZ,MAAM,kCAAkC,MAAM,QAAQ,wBAAwB,cAAc,eAAe,aAAa;AACxH,SAAI,gCACH,OAAM,MAAM,SAAS,SAAS;IAE9B,OAAM,oCAAoC,MAAM;AAE/C,YAAM,MAAM,SAAS,SAAS;KAC9B,EAAC;IAEH,MACA,OAAM,MAAM,SAAS,SAAS;GAE/B;GACD,eAAe;EACf,EAA2D;CAC5D;AACD;;;;ICpDY,wBAAN,MAAoD;CAC1D,AAAQ,mBAAoD;CAE5D,YAA6BC,WAAuCC,SAAsC;EA0C1G,KA1C6B;EA0C5B,KA1CmE;CAAwC;CAE5G,MAAM,QAAQC,SAAmC;AAChD,SACC,OAAO,IACP,KAAK,WAAW,SACf,KAAK,mBAAmB,MAAM,KAAK,QAAQ,6BAA6B,KAAK,yBAAyB;CAExG;CAED,OAAOC,QAA0B;EAEhC,MAAM,UAAU,cAAc,KAAK,QAAQ;AAC3C,SAAO,gBAAE,eAAe;GACvB,gBAAE,OAAO,EAAE,OAAO,EAAE,kBAAkB,aAAc,EAAE,GAAE,KAAK,IAAI,0BAA0B,CAAC;GAC5F,gBAAE,KAAK,KAAK,IAAI,gCAAgC,CAAC;GACjD,gBACC,gBACA,gBAAE,6BAA6B;IAC9B,0BAA0B,KAAK,oBAAoB,yBAAyB;IAC5E,UAAU,CAAC,SAAS;AACnB,UAAK,mBAAmB;AACxB,aAAQ,4BAA4B,KAAK;IACzC;GACD,EAAC,CACF;GACD,gBACC,aACA,gBAAE,QAAQ;IACT,OAAO;IACP,OAAO,MAAM,KAAK,YAAY,OAAO;IACrC,MAAM,WAAW;GACjB,EAAC,CACF;EACD,EAAC;CACF;CAED,MAAc,YAAYA,QAAgB;AACzC,QAAM,KAAK,UAAU,gBAAgB,OAAO,WAAW;AACvD,kBAAE,QAAQ;CACV;AACD"}