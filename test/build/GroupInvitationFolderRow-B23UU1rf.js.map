{"version":3,"file":"GroupInvitationFolderRow-B23UU1rf.js","names":["vnode: Vnode<ColorPickerViewAttrs>","expanded: boolean","attrs: ColorPickerViewAttrs","variantIndex: number | undefined","inputValue: string","attrs: {\n\t\tcolor: string\n\t\tindex: number\n\t\tselectedColor: ColorPickerViewAttrs[\"value\"]\n\t\tonselect: ColorPickerViewAttrs[\"onselect\"]\n\t\tclassName?: string\n\t\tstyle?: Record<string, string>\n\t}","e: KeyboardEvent","onselect: ColorPickerViewAttrs[\"onselect\"]","e: InputEvent","e: PointerEvent | TouchEvent","e","show: boolean","hueImgDom: HTMLElement","hueSliderDom: HTMLElement","invitation: ReceivedGroupInvitation","alarmsStream: stream<AlarmInterval[]>","dialog: Dialog","selectedColourValue: Stream<string>","alarmsStream: Stream<AlarmInterval[]>","texts: GroupSharingTexts","vnode: Vnode<GroupInvitationFolderRowAttrs>"],"sources":["../../src/common/gui/base/colorPicker/ColorPickerView.ts","../../src/common/sharing/view/ReceivedGroupInvitationDialog.ts","../../src/common/sharing/view/GroupInvitationFolderRow.ts"],"sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { px, size } from \"../../size.js\"\nimport { ExpanderButton, ExpanderPanel } from \"../Expander.js\"\nimport { TextField } from \"../TextField.js\"\nimport { lang } from \"../../../misc/LanguageViewModel.js\"\nimport { hexToHSL, hslToHex, isColorLight, isValidCSSHexColor, MAX_HUE_ANGLE, normalizeHueAngle } from \"../Color.js\"\nimport { ColorPickerModel } from \"./ColorPickerModel.js\"\nimport { client } from \"../../../misc/ClientDetector.js\"\nimport { theme } from \"../../theme.js\"\nimport { assertNotNull, clamp, filterInt } from \"@tutao/tutanota-utils\"\nimport { Keys, TabIndex } from \"../../../api/common/TutanotaConstants\"\nimport { isKeyPressed } from \"../../../misc/KeyManager\"\n\nconst HUE_GRADIENT_BORDER_WIDTH = 1\nconst HUE_GRADIENT_HEIGHT = 40\n\nconst enum PaletteIndex {\n\tdefaultVariant = 2,\n\tcustomVariant = -1,\n}\n\nexport type ColorPickerViewAttrs = {\n\t/**\n\t * Initial value can be empty, a random color will be generated by the ColorPicker\n\t * */\n\tvalue: string\n\t/**\n\t * Called whenever the selected color changes\n\t */\n\tonselect: (color: string) => void\n}\n\nexport class ColorPickerView implements Component<ColorPickerViewAttrs> {\n\tprivate readonly palette = Array<string | null>(ColorPickerModel.PALETTE_SIZE).fill(null)\n\tprivate readonly model: ColorPickerModel = new ColorPickerModel(!isColorLight(theme.content_bg))\n\tprivate selectedHueAngle = Math.floor(Math.random() * MAX_HUE_ANGLE)\n\tprivate fallbackVariantIndex: number = PaletteIndex.defaultVariant\n\tprivate isAdvanced = false\n\tprivate customColorHex = \"\"\n\n\tprivate huePickerDom: HTMLElement | null = null\n\tprivate hueImgDom: HTMLElement | null = null\n\tprivate hueSliderDom: HTMLElement | null = null\n\tprivate hueWindowDom: HTMLElement | null = null\n\n\tconstructor(vnode: Vnode<ColorPickerViewAttrs>) {\n\t\tconst { value: selectedColor, onselect } = vnode.attrs\n\n\t\tif (selectedColor) {\n\t\t\tconst { h, s, l } = hexToHSL(selectedColor)\n\t\t\tconst variantIndex = this.model.getVariantIndexBySL(s, l)\n\n\t\t\t// in case of palette color, selectedHueAngle is the one that was used to generate the palette\n\t\t\tthis.selectedHueAngle = variantIndex != null ? normalizeHueAngle(h - this.model.paletteSchema.hueShift[variantIndex]) : h\n\t\t\tthis.generatePalette()\n\t\t\tthis.customColorHex = selectedColor\n\t\t\tif (variantIndex != null) {\n\t\t\t\tthis.fallbackVariantIndex = variantIndex\n\t\t\t}\n\n\t\t\tthis.isAdvanced = variantIndex == null || this.palette[variantIndex] !== selectedColor\n\t\t} else {\n\t\t\tthis.generatePalette()\n\t\t\tconst defaultColor = assertNotNull(this.palette[PaletteIndex.defaultVariant], \"no default palette color variant\")\n\t\t\tthis.customColorHex = defaultColor\n\t\t\tonselect(defaultColor)\n\t\t}\n\t}\n\n\tview(vnode: Vnode<ColorPickerViewAttrs>): Children {\n\t\tconst attrs = vnode.attrs\n\n\t\treturn m(\".color-picker\", [\n\t\t\tthis.renderHuePicker(attrs.onselect),\n\t\t\tm(\n\t\t\t\t\".flex.wrap.full-width.items-center.justify-between.p0.plr-s\",\n\t\t\t\t{\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\trowGap: px(size.vpad_xs),\n\t\t\t\t\t\tmarginTop: px(12),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tthis.palette.map((color, i) =>\n\t\t\t\t\tthis.renderColorOption({\n\t\t\t\t\t\tcolor: assertNotNull(color, `palette color ${i} not generated`),\n\t\t\t\t\t\tindex: i,\n\t\t\t\t\t\tselectedColor: attrs.value,\n\t\t\t\t\t\tonselect: attrs.onselect,\n\t\t\t\t\t\t// add right divider to first color option\n\t\t\t\t\t\tclassName: i === 0 ? \".pr-vpad-s.mr-hpad-small\" : undefined,\n\t\t\t\t\t\tstyle:\n\t\t\t\t\t\t\ti === 0\n\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\tborderRight: `2px solid ${theme.content_border}`,\n\t\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t),\n\t\t\tm(\"\", [\n\t\t\t\tm(ExpanderButton, {\n\t\t\t\t\tlabel: \"advanced_label\",\n\t\t\t\t\texpanded: this.isAdvanced,\n\t\t\t\t\tonExpandedChange: (expanded) => this.handleOnExpandedChange(expanded, attrs),\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tmarginLeft: \"auto\",\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tm(\n\t\t\t\t\tExpanderPanel,\n\t\t\t\t\t{\n\t\t\t\t\t\texpanded: this.isAdvanced,\n\t\t\t\t\t},\n\t\t\t\t\tthis.renderCustomColorContainer(attrs),\n\t\t\t\t),\n\t\t\t]),\n\t\t])\n\t}\n\n\tprivate handleOnExpandedChange(expanded: boolean, attrs: ColorPickerViewAttrs) {\n\t\tif (expanded && isValidCSSHexColor(this.customColorHex)) {\n\t\t\tattrs.onselect(this.customColorHex)\n\t\t} else {\n\t\t\tlet variantIndex: number | undefined = undefined\n\t\t\tif (isValidCSSHexColor(this.customColorHex)) {\n\t\t\t\tconst { s, l } = hexToHSL(this.customColorHex)\n\t\t\t\tvariantIndex = this.model.getVariantIndexBySL(s, l)\n\t\t\t}\n\n\t\t\tconst fallbackColor = assertNotNull(\n\t\t\t\tthis.palette[variantIndex ?? this.fallbackVariantIndex],\n\t\t\t\t`no fallback color at [${variantIndex} ?? ${this.fallbackVariantIndex}]`,\n\t\t\t)\n\t\t\tattrs.onselect(fallbackColor)\n\t\t}\n\t\tthis.isAdvanced = expanded\n\t}\n\n\tprivate renderCustomColorContainer(attrs: ColorPickerViewAttrs) {\n\t\treturn m(\".custom-color-container.flex.items-start.gap-hpad\", [\n\t\t\tm(\"\", [\n\t\t\t\tm(TextField, {\n\t\t\t\t\tvalue: this.customColorHex.replace(\"#\", \"\"),\n\t\t\t\t\tlabel: \"hexCode_label\",\n\t\t\t\t\toninput: (v) => this.handleCustomHexInput(v, attrs),\n\t\t\t\t}),\n\t\t\t\t!isValidCSSHexColor(this.customColorHex) && m(\".small\", lang.get(\"invalidInputFormat_msg\")),\n\t\t\t]),\n\t\t\tthis.renderColorOption({\n\t\t\t\tcolor: this.customColorHex,\n\t\t\t\tindex: PaletteIndex.customVariant,\n\t\t\t\tselectedColor: attrs.value,\n\t\t\t\tonselect: (color) => {\n\t\t\t\t\tthis.postionSliderOnHue(assertNotNull(this.hueImgDom), assertNotNull(this.hueSliderDom))\n\t\t\t\t\tattrs.onselect(color)\n\t\t\t\t},\n\t\t\t\tclassName: \".mt-m\",\n\t\t\t}),\n\t\t])\n\t}\n\n\tprivate handleCustomHexInput(inputValue: string, attrs: ColorPickerViewAttrs) {\n\t\tconst newValue = inputValue.trim().replaceAll(\"#\", \"\").slice(0, 6)\n\t\tconst hexCode = \"#\" + newValue\n\t\tthis.customColorHex = hexCode\n\n\t\tif (!isValidCSSHexColor(hexCode)) {\n\t\t\tattrs.onselect(assertNotNull(this.palette[this.fallbackVariantIndex], `no fallback color at ${this.fallbackVariantIndex}`))\n\t\t\treturn\n\t\t}\n\n\t\tconst { h, s, l } = hexToHSL(hexCode)\n\t\tconst variantIndex = this.model.getVariantIndexBySL(s, l)\n\n\t\tif (variantIndex != null) {\n\t\t\tthis.fallbackVariantIndex = variantIndex\n\t\t}\n\n\t\tthis.selectedHueAngle = variantIndex != null ? normalizeHueAngle(h - this.model.paletteSchema.hueShift[variantIndex]) : h\n\t\tthis.postionSliderOnHue(assertNotNull(this.hueImgDom), assertNotNull(this.hueSliderDom))\n\t\tthis.generatePalette()\n\t\tattrs.onselect(hexCode)\n\t}\n\n\tprivate renderColorOption(attrs: {\n\t\tcolor: string\n\t\tindex: number\n\t\tselectedColor: ColorPickerViewAttrs[\"value\"]\n\t\tonselect: ColorPickerViewAttrs[\"onselect\"]\n\t\tclassName?: string\n\t\tstyle?: Record<string, string>\n\t}): Children {\n\t\tconst { color, index, selectedColor, className, style } = attrs\n\n\t\tconst isOptionSelected = color === selectedColor\n\t\tlet isColorValid = true\n\t\tif (index === PaletteIndex.customVariant) {\n\t\t\tisColorValid = isValidCSSHexColor(color)\n\t\t}\n\n\t\tconst handleSelection = () => {\n\t\t\tif (!isColorValid) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (index === PaletteIndex.customVariant && isColorValid) {\n\t\t\t\tconst { h, s, l } = hexToHSL(color)\n\t\t\t\tconst variantIndex = this.model.getVariantIndexBySL(s, l)\n\n\t\t\t\tthis.selectedHueAngle = variantIndex != null ? normalizeHueAngle(h - this.model.paletteSchema.hueShift[variantIndex]) : h\n\t\t\t\tthis.generatePalette()\n\t\t\t} else {\n\t\t\t\tthis.fallbackVariantIndex = index\n\t\t\t\tthis.customColorHex = color\n\t\t\t}\n\n\t\t\tattrs.onselect(color)\n\t\t}\n\n\t\treturn m(\n\t\t\t`.color-option${className ?? \"\"}`,\n\t\t\t{\n\t\t\t\tclassName: isOptionSelected ? \"selected\" : \"\",\n\t\t\t\tstyle,\n\t\t\t},\n\t\t\tm(\n\t\t\t\t\".border-radius-m\",\n\t\t\t\t{\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tpadding: \"1px\",\n\t\t\t\t\t\tborderWidth: \"2px\",\n\t\t\t\t\t\tborderStyle: \"solid\",\n\t\t\t\t\t\tborderColor: isOptionSelected ? theme.content_button_selected : \"transparent\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tm(\".border-radius\", {\n\t\t\t\t\ttabIndex: TabIndex.Default,\n\t\t\t\t\trole: \"radio\",\n\t\t\t\t\tariaLabel: index === PaletteIndex.customVariant ? lang.get(\"customColor_label\") : `${lang.get(\"variant_label\")} ${index}`,\n\t\t\t\t\tariaChecked: isOptionSelected,\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\twidth: px(30),\n\t\t\t\t\t\theight: px(30),\n\t\t\t\t\t\tborderWidth: \"1px\",\n\t\t\t\t\t\tborderStyle: \"solid\",\n\t\t\t\t\t\tborderColor: isOptionSelected ? \"transparent\" : theme.content_border,\n\t\t\t\t\t\tbackgroundColor: isColorValid ? color : theme.content_border,\n\t\t\t\t\t},\n\t\t\t\t\tonkeydown: (e: KeyboardEvent) => {\n\t\t\t\t\t\tif (isKeyPressed(e.key, Keys.SPACE)) {\n\t\t\t\t\t\t\te.preventDefault()\n\t\t\t\t\t\t\thandleSelection()\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonclick: handleSelection,\n\t\t\t\t}),\n\t\t\t),\n\t\t)\n\t}\n\n\tprivate renderHuePicker(onselect: ColorPickerViewAttrs[\"onselect\"]): Children {\n\t\tconst a11yHueShiftStep = 5\n\n\t\treturn m(\n\t\t\t\".rel.overflow-hidden\",\n\t\t\t{\n\t\t\t\tstyle: {\n\t\t\t\t\tposition: \"relative\",\n\t\t\t\t},\n\t\t\t\tonkeydown: (e: KeyboardEvent) => {\n\t\t\t\t\te.preventDefault()\n\t\t\t\t\tconst isRightMove = isKeyPressed(e.key, Keys.RIGHT)\n\t\t\t\t\tconst isLeftMove = isKeyPressed(e.key, Keys.LEFT)\n\t\t\t\t\tconst isStill = isLeftMove && isRightMove\n\n\t\t\t\t\tif (!isStill && (isRightMove || isLeftMove)) {\n\t\t\t\t\t\t// holding down shift allows finer hue adjustment\n\t\t\t\t\t\tconst step = e.shiftKey ? 1 : a11yHueShiftStep\n\t\t\t\t\t\tlet hueStep = isLeftMove ? -step : step\n\t\t\t\t\t\tthis.selectedHueAngle = normalizeHueAngle(this.selectedHueAngle + hueStep)\n\n\t\t\t\t\t\tthis.postionSliderOnHue(assertNotNull(this.hueImgDom), assertNotNull(this.hueSliderDom))\n\t\t\t\t\t\tthis.toggleHueWindow(true)\n\t\t\t\t\t\tthis.generatePalette()\n\n\t\t\t\t\t\tif (!this.isAdvanced || !isValidCSSHexColor(this.customColorHex)) {\n\t\t\t\t\t\t\tonselect(assertNotNull(this.palette[this.fallbackVariantIndex], `no fallback color at ${this.fallbackVariantIndex}`))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonkeyup: () => this.toggleHueWindow(false),\n\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\tthis.huePickerDom = vnode.dom as HTMLElement\n\t\t\t\t},\n\t\t\t},\n\t\t\t[\n\t\t\t\t// range input used to allow hue to be easily changed on a screen reader\n\t\t\t\tm(\"input.fill-absolute.no-hover\", {\n\t\t\t\t\ttype: \"range\",\n\t\t\t\t\tmin: 0,\n\t\t\t\t\tmax: MAX_HUE_ANGLE,\n\t\t\t\t\tstep: a11yHueShiftStep,\n\t\t\t\t\ttabIndex: TabIndex.Default,\n\t\t\t\t\trole: \"slider\",\n\t\t\t\t\tariaLabel: lang.get(\"hue_label\"),\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t},\n\t\t\t\t\tvalue: `${this.selectedHueAngle}`,\n\t\t\t\t\toninput: (e: InputEvent) => {\n\t\t\t\t\t\tthis.selectedHueAngle = filterInt((e.target as HTMLInputElement).value)\n\n\t\t\t\t\t\tthis.postionSliderOnHue(assertNotNull(this.hueImgDom), assertNotNull(this.hueSliderDom))\n\t\t\t\t\t\tthis.generatePalette()\n\t\t\t\t\t\tif (!this.isAdvanced || !isValidCSSHexColor(this.customColorHex)) {\n\t\t\t\t\t\t\tonselect(assertNotNull(this.palette[this.fallbackVariantIndex], `no fallback color at ${this.fallbackVariantIndex}`))\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\t// hueGradient\n\t\t\t\tm(\n\t\t\t\t\t\".full-width.border-radius.overflow-hidden\",\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tborderStyle: \"solid\",\n\t\t\t\t\t\t\tborderColor: theme.content_border,\n\t\t\t\t\t\t\tbackgroundColor: theme.content_border,\n\t\t\t\t\t\t\tborderWidth: px(HUE_GRADIENT_BORDER_WIDTH),\n\t\t\t\t\t\t\theight: px(HUE_GRADIENT_HEIGHT),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tm(\"img.block.full-width\", {\n\t\t\t\t\t\tsrc: `${window.tutao.appState.prefixWithoutFile}/images/color-hue-picker/hue-gradient-${\n\t\t\t\t\t\t\t!isColorLight(theme.content_bg) ? \"dark\" : \"light\"\n\t\t\t\t\t\t}.png`,\n\t\t\t\t\t\talt: \"\",\n\t\t\t\t\t\tdraggable: false,\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\theight: px(HUE_GRADIENT_HEIGHT),\n\t\t\t\t\t\t},\n\t\t\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\t\t\tthis.hueImgDom = vnode.dom as HTMLElement\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonupdate: (vnode) => {\n\t\t\t\t\t\t\tif (this.hueSliderDom != null && !this.hueSliderDom.style.left) {\n\t\t\t\t\t\t\t\t// sets the position of the hueSlider on first render. to do it we need hueImgDom's width\n\t\t\t\t\t\t\t\tconst hueImgDom = vnode.dom as HTMLElement\n\t\t\t\t\t\t\t\tthis.postionSliderOnHue(hueImgDom, this.hueSliderDom)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t[client.isTouchSupported() ? \"ontouchstart\" : \"onpointerdown\"]: (e: PointerEvent | TouchEvent) => {\n\t\t\t\t\t\t\tconst abortController = new AbortController()\n\t\t\t\t\t\t\tconst hueImgDom = e.target as HTMLElement\n\n\t\t\t\t\t\t\thueImgDom.addEventListener(client.isTouchSupported() ? \"touchmove\" : \"pointermove\", (e) => this.handleHueChange(e, hueImgDom), {\n\t\t\t\t\t\t\t\tsignal: abortController.signal,\n\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\tconst endListener = () => {\n\t\t\t\t\t\t\t\tabortController.abort()\n\t\t\t\t\t\t\t\tthis.generatePalette()\n\t\t\t\t\t\t\t\tthis.toggleHueWindow(false)\n\n\t\t\t\t\t\t\t\tif (!this.isAdvanced || !isValidCSSHexColor(this.customColorHex)) {\n\t\t\t\t\t\t\t\t\tonselect(assertNotNull(this.palette[this.fallbackVariantIndex], `no fallback color at ${this.fallbackVariantIndex}`))\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tm.redraw()\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\thueImgDom.addEventListener(client.isTouchSupported() ? \"touchcancel\" : \"pointercancel\", endListener, {\n\t\t\t\t\t\t\t\tsignal: abortController.signal,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tdocument.addEventListener(client.isTouchSupported() ? \"touchend\" : \"pointerup\", endListener, { signal: abortController.signal })\n\n\t\t\t\t\t\t\tthis.handleHueChange(e, hueImgDom)\n\t\t\t\t\t\t\tthis.toggleHueWindow(true)\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t\t// hueSlider\n\t\t\t\tm(\n\t\t\t\t\t\".abs\",\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\twidth: \"0px\",\n\t\t\t\t\t\t\tbottom: px(HUE_GRADIENT_BORDER_WIDTH),\n\t\t\t\t\t\t},\n\t\t\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\t\t\tthis.hueSliderDom = vnode.dom as HTMLElement\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t[\n\t\t\t\t\t\t// hueWindow\n\t\t\t\t\t\tm(\".border.circle\", {\n\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\twidth: px(24),\n\t\t\t\t\t\t\t\theight: px(24),\n\t\t\t\t\t\t\t\ttransform: \"translateX(-50%)\",\n\t\t\t\t\t\t\t\tbackgroundColor: this.model.getHueWindowColor(this.selectedHueAngle) ?? theme.content_border,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\t\t\t\tthis.hueWindowDom = vnode.dom as HTMLElement\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t// hueStem\n\t\t\t\t\t\tm(\"\", {\n\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\twidth: px(2),\n\t\t\t\t\t\t\t\theight: px(HUE_GRADIENT_HEIGHT),\n\t\t\t\t\t\t\t\ttransform: \"translateX(-50%)\",\n\t\t\t\t\t\t\t\tbackgroundColor: theme.content_border,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t),\n\t\t\t],\n\t\t)\n\t}\n\n\tprivate toggleHueWindow(show: boolean) {\n\t\tassertNotNull(this.huePickerDom).style.overflow = show ? \"visible\" : \"hidden\"\n\t}\n\n\tprivate postionSliderOnHue(hueImgDom: HTMLElement, hueSliderDom: HTMLElement) {\n\t\tconst hueGradientWidth = hueImgDom.getBoundingClientRect().width\n\t\thueSliderDom.style.left = `${Math.floor((this.selectedHueAngle / MAX_HUE_ANGLE) * hueGradientWidth) + HUE_GRADIENT_BORDER_WIDTH}px`\n\t\tassertNotNull(this.hueWindowDom).style.backgroundColor = this.model.getHueWindowColor(this.selectedHueAngle)\n\t}\n\n\tprivate handleHueChange = (e: PointerEvent | TouchEvent, hueImgDom: HTMLElement) => {\n\t\tconst hueImgDomRect = hueImgDom.getBoundingClientRect()\n\t\tconst eClientX = \"clientX\" in e ? e.clientX : e.touches[0].clientX\n\t\tconst posX = clamp(eClientX - hueImgDomRect.left + HUE_GRADIENT_BORDER_WIDTH, HUE_GRADIENT_BORDER_WIDTH, hueImgDomRect.width)\n\t\tthis.selectedHueAngle = Math.floor((posX / hueImgDomRect.width) * MAX_HUE_ANGLE)\n\n\t\tif (this.hueSliderDom) {\n\t\t\tthis.hueSliderDom.style.left = `${posX}px`\n\t\t}\n\t\tif (this.hueWindowDom) {\n\t\t\tthis.hueWindowDom.style.backgroundColor = this.model.getHueWindowColor(this.selectedHueAngle)\n\t\t}\n\t}\n\n\tprivate generatePalette() {\n\t\tfor (let i = 0; i < ColorPickerModel.PALETTE_SIZE; i++) {\n\t\t\tthis.palette[i] = hslToHex(this.model.getColor(this.selectedHueAngle, i))\n\t\t}\n\t}\n}\n","import { createDefaultAlarmInfo, createGroupSettings } from \"../../api/entities/tutanota/TypeRefs.js\"\nimport m, { Children } from \"mithril\"\nimport { lang } from \"../../misc/LanguageViewModel.js\"\nimport { TextField } from \"../../gui/base/TextField.js\"\nimport stream from \"mithril/stream\"\nimport Stream from \"mithril/stream\"\nimport { downcast } from \"@tutao/tutanota-utils\"\nimport { Dialog } from \"../../gui/base/Dialog.js\"\nimport { ReceivedGroupInvitation } from \"../../api/entities/sys/TypeRefs.js\"\nimport { isSameId } from \"../../api/common/utils/EntityUtils.js\"\nimport { sendAcceptNotificationEmail, sendRejectNotificationEmail } from \"../GroupSharingUtils.js\"\nimport { getCapabilityText, getDefaultGroupName, getInvitationGroupType, isTemplateGroup } from \"../GroupUtils.js\"\nimport { showPlanUpgradeRequiredDialog } from \"../../misc/SubscriptionDialogs.js\"\nimport type { GroupSharingTexts } from \"../GroupGuiUtils.js\"\nimport { getTextsForGroupType } from \"../GroupGuiUtils.js\"\nimport { GroupType } from \"../../api/common/TutanotaConstants.js\"\nimport { locator } from \"../../api/main/CommonLocator.js\"\nimport { LoginButton } from \"../../gui/base/buttons/LoginButton.js\"\nimport { AlarmInterval } from \"../../calendar/date/CalendarUtils.js\"\nimport { getMailAddressDisplayText } from \"../../mailFunctionality/SharedMailUtils.js\"\nimport { serializeAlarmInterval } from \"../../api/common/utils/CommonCalendarUtils.js\"\nimport { ColorPickerView } from \"../../gui/base/colorPicker/ColorPickerView\"\n\nexport function showGroupInvitationDialog(invitation: ReceivedGroupInvitation) {\n\tconst groupType = getInvitationGroupType(invitation)\n\tconst texts = getTextsForGroupType(groupType)\n\tconst userSettingsGroupRoot = locator.logins.getUserController().userSettingsGroupRoot\n\tconst existingGroupSettings = userSettingsGroupRoot.groupSettings.find((gc) => gc.group === invitation.sharedGroup)\n\tconst color = existingGroupSettings ? \"#\" + existingGroupSettings.color : \"\"\n\tconst colorStream = stream(color)\n\tconst isDefaultGroupName = invitation.sharedGroupName === getDefaultGroupName(downcast(invitation.groupType))\n\tconst nameStream = stream(isDefaultGroupName ? texts.sharedGroupDefaultCustomName(invitation) : invitation.sharedGroupName)\n\tconst alarmsStream: stream<AlarmInterval[]> = stream([])\n\n\tconst isMember = locator.logins\n\t\t.getUserController()\n\t\t.getCalendarMemberships()\n\t\t.some((ms) => isSameId(ms.group, invitation.sharedGroup))\n\tlet dialog: Dialog\n\n\tconst onAcceptClicked = () => {\n\t\tcheckCanAcceptGroupInvitation(invitation).then((canAccept) => {\n\t\t\tif (canAccept) {\n\t\t\t\tacceptInvite(invitation, texts).then(() => {\n\t\t\t\t\tdialog.close()\n\t\t\t\t\tconst newColor = colorStream().substring(1) // color is stored without #\n\n\t\t\t\t\tconst newName = nameStream()\n\n\t\t\t\t\tif (existingGroupSettings) {\n\t\t\t\t\t\texistingGroupSettings.color = newColor\n\t\t\t\t\t\texistingGroupSettings.name = newName\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst groupSettings = createGroupSettings({\n\t\t\t\t\t\t\tgroup: invitation.sharedGroup,\n\t\t\t\t\t\t\tcolor: newColor,\n\t\t\t\t\t\t\tname: newName,\n\t\t\t\t\t\t\tdefaultAlarmsList: alarmsStream().map((alarm) => createDefaultAlarmInfo({ trigger: serializeAlarmInterval(alarm) })),\n\t\t\t\t\t\t\tsourceUrl: null,\n\t\t\t\t\t\t})\n\t\t\t\t\t\tuserSettingsGroupRoot.groupSettings.push(groupSettings)\n\t\t\t\t\t}\n\n\t\t\t\t\tlocator.entityClient.update(userSettingsGroupRoot)\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t}\n\n\tdialog = Dialog.showActionDialog({\n\t\ttitle: \"invitation_label\",\n\t\tchild: {\n\t\t\tview: () =>\n\t\t\t\tm(\".flex.col\", [\n\t\t\t\t\tm(\".mb\", [\n\t\t\t\t\t\tm(\".pt.selectable\", isMember ? lang.getTranslationText(texts.alreadyGroupMemberMessage) : texts.receivedGroupInvitationMessage),\n\t\t\t\t\t\tm(TextField, {\n\t\t\t\t\t\t\tvalue: nameStream(),\n\t\t\t\t\t\t\toninput: nameStream,\n\t\t\t\t\t\t\tlabel: texts.groupNameLabel,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tm(TextField, {\n\t\t\t\t\t\t\tvalue: getMailAddressDisplayText(invitation.inviterName, invitation.inviterMailAddress, false),\n\t\t\t\t\t\t\tlabel: \"sender_label\",\n\t\t\t\t\t\t\tisReadOnly: true,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tm(TextField, {\n\t\t\t\t\t\t\tvalue: invitation.inviteeMailAddress,\n\t\t\t\t\t\t\tlabel: \"to_label\",\n\t\t\t\t\t\t\tisReadOnly: true,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tm(TextField, {\n\t\t\t\t\t\t\tvalue: getCapabilityText(downcast(invitation.capability)),\n\t\t\t\t\t\t\tlabel: \"permissions_label\",\n\t\t\t\t\t\t\tisReadOnly: true,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tgroupType === GroupType.Calendar ? renderCalendarGroupInvitationFields(invitation, colorStream, alarmsStream) : null,\n\t\t\t\t\t]),\n\t\t\t\t\tisMember\n\t\t\t\t\t\t? null\n\t\t\t\t\t\t: m(LoginButton, {\n\t\t\t\t\t\t\t\tlabel: \"acceptInvitation_action\",\n\t\t\t\t\t\t\t\tonclick: onAcceptClicked,\n\t\t\t\t\t\t  }),\n\t\t\t\t]),\n\t\t},\n\t\tokActionTextId: \"decline_action\",\n\t\tokAction: (dialog: Dialog) => {\n\t\t\tdialog.close()\n\t\t\tdeclineInvite(invitation, texts)\n\t\t},\n\t\tcancelActionTextId: \"close_alt\",\n\t})\n}\n\n/**\n * Checks if the logged-in user is able to accept the group invitation.\n * This is necessary because to be part of some kinds of groups you must have certain features.\n * Currently, there are two kinds of group invitations:\n * 1. Calendar: any paid account can accept invitations\n * 2. Template: only accounts with the templates feature can accept invitations\n * @param invitation\n */\nasync function checkCanAcceptGroupInvitation(invitation: ReceivedGroupInvitation): Promise<boolean> {\n\tconst SubscriptionDialogUtils = await import(\"../../misc/SubscriptionDialogs.js\")\n\tconst allowed = await SubscriptionDialogUtils.checkPaidSubscription()\n\tif (!allowed) {\n\t\treturn false\n\t}\n\tconst planConfig = await locator.logins.getUserController().getPlanConfig()\n\tif (isTemplateGroup(getInvitationGroupType(invitation)) && !planConfig.templates) {\n\t\tconst { getAvailablePlansWithTemplates } = await import(\"../../subscription/SubscriptionUtils.js\")\n\t\tconst plans = await getAvailablePlansWithTemplates()\n\t\treturn showPlanUpgradeRequiredDialog(plans)\n\t} else {\n\t\treturn true\n\t}\n}\n\nfunction renderCalendarGroupInvitationFields(\n\tinvitation: ReceivedGroupInvitation,\n\tselectedColourValue: Stream<string>,\n\talarmsStream: Stream<AlarmInterval[]>,\n): Children {\n\tlet alarms = alarmsStream()\n\treturn [\n\t\tm(\".small.mt.mb-xs\", lang.get(\"color_label\")),\n\t\tm(ColorPickerView, {\n\t\t\tvalue: selectedColourValue(),\n\t\t\tonselect: selectedColourValue,\n\t\t}),\n\t]\n}\n\nfunction acceptInvite(invitation: ReceivedGroupInvitation, texts: GroupSharingTexts): Promise<void> {\n\treturn locator.shareFacade.acceptGroupInvitation(invitation).then(() => {\n\t\tsendAcceptNotificationEmail(invitation, texts)\n\t})\n}\n\nfunction declineInvite(invitation: ReceivedGroupInvitation, texts: GroupSharingTexts): Promise<void> {\n\treturn locator.shareFacade.rejectOrCancelGroupInvitation(invitation._id).then(() => {\n\t\tsendRejectNotificationEmail(invitation, texts)\n\t})\n}\n","import m, { Children, Component, Vnode } from \"mithril\"\nimport { size } from \"../../gui/size\"\nimport { getCapabilityText } from \"../GroupUtils\"\nimport { downcast } from \"@tutao/tutanota-utils\"\nimport { showGroupInvitationDialog } from \"./ReceivedGroupInvitationDialog.js\"\nimport { Icons } from \"../../gui/base/icons/Icons\"\nimport type { ReceivedGroupInvitation } from \"../../api/entities/sys/TypeRefs.js\"\nimport type { AllIcons } from \"../../gui/base/Icon\"\nimport { IconButton } from \"../../gui/base/IconButton.js\"\nimport { getMailAddressDisplayText } from \"../../mailFunctionality/SharedMailUtils.js\"\n\nexport type GroupInvitationFolderRowAttrs = {\n\tinvitation: ReceivedGroupInvitation\n\ticon?: AllIcons\n}\n\nexport class GroupInvitationFolderRow implements Component<GroupInvitationFolderRowAttrs> {\n\tview(vnode: Vnode<GroupInvitationFolderRowAttrs>): Children {\n\t\tconst { invitation, icon } = vnode.attrs\n\t\treturn [\n\t\t\tm(\".folder-row.flex-start.plr-l\", [\n\t\t\t\tm(\n\t\t\t\t\t\".flex-v-center.flex-grow.button-height\",\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t// It's kinda hard to tell this element to not eat up all the row and truncate text instead because it\n\t\t\t\t\t\t\t// is vertical flex. With this it will stop at 80% of what it could be and that's enough for the button.\n\t\t\t\t\t\t\t\"max-width\": `calc(100% - ${size.button_height}px)`,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t[\n\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\".b.text-ellipsis\",\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: getCapabilityText(downcast(invitation.capability)),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tinvitation.sharedGroupName,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\".small.text-ellipsis\",\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: invitation.inviterMailAddress,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tgetMailAddressDisplayText(invitation.inviterName, invitation.inviterMailAddress, true),\n\t\t\t\t\t\t),\n\t\t\t\t\t],\n\t\t\t\t),\n\t\t\t\tm(IconButton, {\n\t\t\t\t\ttitle: \"show_action\",\n\t\t\t\t\tclick: () => showGroupInvitationDialog(invitation),\n\t\t\t\t\ticon: icon ?? Icons.Eye,\n\t\t\t\t}),\n\t\t\t]),\n\t\t]\n\t}\n}\n"],"mappings":"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"}