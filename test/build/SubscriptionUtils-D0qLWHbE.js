
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { LazyLoaded, isEmpty } from "./dist-CJHwsXKY.js";
import { ProgrammingError } from "./ProgrammingError-D8yJGVtm.js";
import { BookingItemFeatureType, NewPaidPlans, PaymentMethodType, PlanTypeToName, getClientType, getPaymentMethodType } from "./TutanotaConstants-3bwAESYA.js";
import { createPaymentDataServiceGetData } from "./TypeRefs-BP1jvX9p.js";
import { PaymentDataService } from "./Services-CZFE0084.js";
import { locator$1 as locator } from "./CommonLocator-Csg4iNnm.js";

//#region ../src/common/subscription/SubscriptionUtils.ts
let UpgradeType = function(UpgradeType$1) {
	UpgradeType$1["Signup"] = "Signup";
	UpgradeType$1["Initial"] = "Initial";
	UpgradeType$1["Switch"] = "Switch";
	return UpgradeType$1;
}({});
function getCurrentCount(featureType, booking) {
	if (booking) {
		let bookingItem = booking.items.find((item) => item.featureType === featureType);
		return bookingItem ? Number(bookingItem.currentCount) : 0;
	} else return 0;
}
function isWhitelabelActive(lastBooking, planConfig) {
	return getCurrentCount(BookingItemFeatureType.Whitelabel, lastBooking) !== 0 || planConfig.whitelabel;
}
function getPreconditionFailedPaymentMsg(data) {
	switch (data) {
		case "paypal.change": return "payChangeError_msg";
		case "paypal.confirm_again": return "payPaypalConfirmAgainError_msg";
		case "paypal.other_source": return "payPaypalChangeSourceError_msg";
		case "card.contact_bank": return "payCardContactBankError_msg";
		case "card.insufficient_funds": return "payCardInsufficientFundsError_msg";
		case "card.expired_card": return "payCardExpiredError_msg";
		case "card.change": return "payChangeError_msg";
		case "card.3ds2_needed": return "creditCardPaymentErrorVerificationNeeded_msg";
		case "card.3ds2_pending": return "creditCardPendingVerification_msg";
		case "card.3ds2_failed": return "creditCardVerificationFailed_msg";
		case "card.cvv_invalid": return "creditCardCVVInvalid_msg";
		case "card.number_invalid": return "creditCardNumberInvalid_msg";
		case "card.date_invalid": return "creditCardExprationDateInvalid_msg";
		default: return "payContactUsError_msg";
	}
}
function getLazyLoadedPayPalUrl() {
	return new LazyLoaded(async () => {
		const clientType = getClientType();
		const result = await locator.serviceExecutor.get(PaymentDataService, createPaymentDataServiceGetData({ clientType }));
		return result.loginUrl;
	});
}
async function getAvailableMatchingPlans(serviceExecutor, predicate) {
	const { PriceAndConfigProvider } = await import("./PriceUtils-BW-wjJnJ.js");
	const priceAndConfigProvider = await PriceAndConfigProvider.getInitializedInstance(null, serviceExecutor, null);
	return NewPaidPlans.filter((p) => {
		const config = priceAndConfigProvider.getPlanPricesForPlan(p).planConfiguration;
		return predicate(config);
	});
}
/**
* Filter for plans a customer can upgrade to that include a feature, assuming that the feature must be available on at least one plan.
* @param predicate the criterion to select plans by
* @param errorMessage the error message to throw in case no plan satisfies the criterion
*/
async function getAtLeastOneAvailableMatchingPlan(predicate, errorMessage) {
	const plans = await getAvailableMatchingPlans(locator.serviceExecutor, predicate);
	if (isEmpty(plans)) throw new ProgrammingError(errorMessage);
	return plans;
}
async function getAvailablePlansWithWhitelabel() {
	return getAtLeastOneAvailableMatchingPlan((config) => config.whitelabel, "no available plan with the Whitelabel feature");
}
async function getAvailablePlansWithTemplates() {
	return getAtLeastOneAvailableMatchingPlan((config) => config.templates, "no available plan with the Templates feature");
}
async function getAvailablePlansWithSharing() {
	return getAtLeastOneAvailableMatchingPlan((config) => config.sharing, "no available plan with the Sharing feature");
}
async function getAvailablePlansWithEventInvites() {
	return getAtLeastOneAvailableMatchingPlan((config) => config.eventInvites, "no available plan with the Event Invites feature");
}
async function getAvailablePlansWithContactList() {
	return getAtLeastOneAvailableMatchingPlan((config) => config.contactList, "no available plan with the Contact List feature");
}
async function getAvailablePlansWithCalendarInvites() {
	return getAtLeastOneAvailableMatchingPlan((config) => config.eventInvites, "no available plan with the Calendar Invite feature");
}
function appStorePlanName(planType) {
	return PlanTypeToName[planType].toLowerCase();
}
function hasRunningAppStoreSubscription(accountingInfo) {
	return getPaymentMethodType(accountingInfo) === PaymentMethodType.AppStore && accountingInfo.appStoreSubscription != null;
}
async function queryAppStoreSubscriptionOwnership(userIdBytes) {
	return await locator.mobilePaymentsFacade.queryAppStoreSubscriptionOwnership(userIdBytes);
}

//#endregion
export { UpgradeType, appStorePlanName, getAvailableMatchingPlans, getAvailablePlansWithCalendarInvites, getAvailablePlansWithContactList, getAvailablePlansWithEventInvites, getAvailablePlansWithSharing, getAvailablePlansWithTemplates, getAvailablePlansWithWhitelabel, getCurrentCount, getLazyLoadedPayPalUrl, getPreconditionFailedPaymentMsg, hasRunningAppStoreSubscription, isWhitelabelActive, queryAppStoreSubscriptionOwnership };
//# sourceMappingURL=SubscriptionUtils-D0qLWHbE.js.map