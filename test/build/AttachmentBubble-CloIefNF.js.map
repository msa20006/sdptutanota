{"version":3,"file":"AttachmentBubble-CloIefNF.js","names":["vnode: Vnode<AttachmentBubbleAttrs>","vnode: VnodeDOM<AttachmentBubbleAttrs>","dom: HTMLElement","attrs: AttachmentBubbleAttrs","type: AttachmentType","mimeType: string","targetRect: PosRect","targetWidth: number","action: Thunk | null","e: MouseEvent","e: Event","fn: Thunk"],"sources":["../../src/common/gui/AttachmentBubble.ts"],"sourcesContent":["import m, { Children, Component, Vnode, VnodeDOM } from \"mithril\"\nimport { Attachment } from \"../mailFunctionality/SendMailModel.js\"\nimport { Button, ButtonType } from \"./base/Button.js\"\nimport { Icons } from \"./base/icons/Icons.js\"\nimport { formatStorageSize } from \"../misc/Formatter.js\"\nimport { defer, DeferredObject, noOp, Thunk } from \"@tutao/tutanota-utils\"\nimport { modal, ModalComponent } from \"./base/Modal.js\"\nimport { focusNext, focusPrevious, Shortcut } from \"../misc/KeyManager.js\"\nimport { PosRect } from \"./base/Dropdown.js\"\nimport { Keys } from \"../api/common/TutanotaConstants.js\"\nimport { px } from \"./size.js\"\nimport { AllIcons, Icon } from \"./base/Icon.js\"\nimport { theme } from \"./theme.js\"\nimport { animations, height, opacity, transform, TransformEnum, width } from \"./animation/Animations.js\"\nimport { ease } from \"./animation/Easing.js\"\nimport { getFileBaseName, getFileExtension, isTutanotaFile } from \"../api/common/utils/FileUtils.js\"\nimport { getSafeAreaInsetBottom } from \"./HtmlUtils.js\"\nimport { hasError } from \"../api/common/utils/ErrorUtils.js\"\nimport { BubbleButton, bubbleButtonHeight, bubbleButtonPadding } from \"./base/buttons/BubbleButton.js\"\nimport { BootIcons } from \"./base/icons/BootIcons.js\"\nimport { CALENDAR_MIME_TYPE, MAIL_MIME_TYPES, VCARD_MIME_TYPES } from \"../file/FileController.js\"\nimport { lang } from \"../misc/LanguageViewModel.js\"\n\nexport enum AttachmentType {\n\tGENERIC,\n\tCONTACT,\n\tCALENDAR,\n\tMAIL,\n}\n\nexport type AttachmentBubbleAttrs = {\n\tattachment: Attachment\n\tdownload: Thunk | null\n\topen: Thunk | null\n\tremove: Thunk | null\n\tfileImport: Thunk | null\n\ttype: AttachmentType\n}\n\nexport class AttachmentBubble implements Component<AttachmentBubbleAttrs> {\n\tprivate dom: HTMLElement | null = null\n\n\tview(vnode: Vnode<AttachmentBubbleAttrs>): Children {\n\t\tconst { attachment } = vnode.attrs\n\t\tif (isTutanotaFile(attachment) && hasError(attachment)) {\n\t\t\treturn m(BubbleButton, {\n\t\t\t\tlabel: \"emptyString_msg\",\n\t\t\t\ttext: \"corrupted_msg\",\n\t\t\t\ticon: Icons.Warning,\n\t\t\t\tonclick: noOp,\n\t\t\t})\n\t\t} else {\n\t\t\tconst extension = getFileExtension(attachment.name)\n\t\t\tconst rest = getFileBaseName(attachment.name)\n\t\t\treturn m(\n\t\t\t\tBubbleButton,\n\t\t\t\t{\n\t\t\t\t\tlabel: lang.makeTranslation(\"attachment_name\", attachment.name),\n\t\t\t\t\ttext: lang.makeTranslation(\"attachment_base_name\", rest),\n\t\t\t\t\ticon: getAttachmentIcon(vnode.attrs.type),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tshowAttachmentDetailsPopup(this.dom!, vnode.attrs).then(() => this.dom?.focus())\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t`${extension}, ${formatStorageSize(Number(attachment.size))}`,\n\t\t\t)\n\t\t}\n\t}\n\n\toncreate(vnode: VnodeDOM<AttachmentBubbleAttrs>): void {\n\t\tthis.dom = vnode.dom as HTMLElement\n\t}\n}\n\nasync function showAttachmentDetailsPopup(dom: HTMLElement, attrs: AttachmentBubbleAttrs): Promise<void> {\n\tconst parentRect = dom.getBoundingClientRect()\n\tconst panel = new AttachmentDetailsPopup(parentRect, parentRect.width, attrs)\n\tpanel.show()\n\treturn panel.deferAfterClose\n}\n\nfunction getAttachmentIcon(type: AttachmentType): AllIcons {\n\tswitch (type) {\n\t\tcase AttachmentType.CONTACT:\n\t\t\treturn Icons.People\n\t\tcase AttachmentType.CALENDAR:\n\t\t\treturn BootIcons.Calendar\n\t\tdefault:\n\t\t\treturn Icons.Attachment\n\t}\n}\n\nexport function getAttachmentType(mimeType: string) {\n\tif (Object.values<string>(VCARD_MIME_TYPES).includes(mimeType)) {\n\t\treturn AttachmentType.CONTACT\n\t} else if (mimeType === CALENDAR_MIME_TYPE) {\n\t\treturn AttachmentType.CALENDAR\n\t} else if (Object.values<string>(MAIL_MIME_TYPES).includes(mimeType)) {\n\t\treturn AttachmentType.MAIL\n\t}\n\n\treturn AttachmentType.GENERIC\n}\n\nexport class AttachmentDetailsPopup implements ModalComponent {\n\tprivate readonly _shortcuts: Array<Shortcut> = []\n\tprivate domContent: HTMLElement | null = null\n\tprivate domPanel: HTMLElement | null = null\n\tprivate closeDefer: DeferredObject<void> = defer()\n\tprivate focusedBeforeShown: HTMLElement | null = null\n\n\tget deferAfterClose(): Promise<void> {\n\t\treturn this.closeDefer.promise\n\t}\n\n\tconstructor(private readonly targetRect: PosRect, private readonly targetWidth: number, private readonly attrs: AttachmentBubbleAttrs) {\n\t\tthis._shortcuts.push({\n\t\t\tkey: Keys.ESC,\n\t\t\texec: () => this.onClose(),\n\t\t\thelp: \"close_alt\",\n\t\t})\n\t\tthis._shortcuts.push({\n\t\t\tkey: Keys.TAB,\n\t\t\tshift: true,\n\t\t\texec: () => (this.domContent ? focusPrevious(this.domContent) : false),\n\t\t\thelp: \"selectPrevious_action\",\n\t\t})\n\t\tthis._shortcuts.push({\n\t\t\tkey: Keys.TAB,\n\t\t\tshift: false,\n\t\t\texec: () => (this.domContent ? focusNext(this.domContent) : false),\n\t\t\thelp: \"selectNext_action\",\n\t\t})\n\t\tif (attrs.open) {\n\t\t\tthis._shortcuts.push({\n\t\t\t\tkey: Keys.O,\n\t\t\t\texec: () => this.thenClose(attrs.open),\n\t\t\t\thelp: \"open_action\",\n\t\t\t})\n\t\t}\n\t\tif (attrs.download) {\n\t\t\tthis._shortcuts.push({\n\t\t\t\tkey: Keys.D,\n\t\t\t\texec: () => this.thenClose(attrs.download),\n\t\t\t\thelp: \"download_action\",\n\t\t\t})\n\t\t}\n\t\tif (attrs.remove) {\n\t\t\tthis._shortcuts.push({\n\t\t\t\tkey: Keys.DELETE,\n\t\t\t\texec: () => this.thenClose(attrs.remove),\n\t\t\t\thelp: \"remove_action\",\n\t\t\t})\n\t\t}\n\t\tif (attrs.fileImport) {\n\t\t\tthis._shortcuts.push({\n\t\t\t\tkey: Keys.I,\n\t\t\t\texec: () => this.thenClose(attrs.fileImport),\n\t\t\t\thelp: \"import_action\",\n\t\t\t})\n\t\t}\n\t\tthis.view = this.view.bind(this)\n\t}\n\n\tview(): Children {\n\t\treturn m(\n\t\t\t\".abs.bubble-color.border-radius.overflow-hidden.flex.flex-column\",\n\t\t\t{\n\t\t\t\tclass: bubbleButtonPadding(),\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: px(this.targetWidth),\n\t\t\t\t\t// see hack description below. if #5587 persists, we might try visibility: hidden instead?\n\t\t\t\t\topacity: \"0\",\n\t\t\t\t},\n\t\t\t\toncreate: (vnode) => {\n\t\t\t\t\tthis.domPanel = vnode.dom as HTMLElement\n\t\t\t\t\t// This is a hack to get \"natural\" view size but render it invisibly first and then show the panel with inferred size.\n\t\t\t\t\t// also focus the first tabbable element in the content after the panel opens.\n\t\t\t\t\tdeferToNextFrame(() => this.animatePanel().then(() => this.domContent && focusNext(this.domContent)))\n\t\t\t\t},\n\t\t\t\tonclick: () => this.onClose(),\n\t\t\t},\n\t\t\tthis.renderContent(),\n\t\t)\n\t}\n\n\tprivate renderContent(): Children {\n\t\t// We are trying to make some contents look like the attachment button to make the transition look smooth.\n\t\t// It is somewhat harder as it looks different with mobile layout.\n\t\tconst { remove, open, download, attachment, fileImport, type } = this.attrs\n\t\treturn m(\n\t\t\t\".flex.mb-s.pr\",\n\t\t\t{\n\t\t\t\toncreate: (vnode) => (this.domContent = vnode.dom as HTMLElement),\n\t\t\t},\n\t\t\t[\n\t\t\t\tm(Icon, {\n\t\t\t\t\ticon: getAttachmentIcon(type),\n\t\t\t\t\tclass: \"pr-s flex items-center\",\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tfill: theme.button_bubble_fg,\n\t\t\t\t\t\t\"background-color\": \"initial\",\n\t\t\t\t\t\tminHeight: px(bubbleButtonHeight()),\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\t//  flex-grow to cover the bubble in case it's bigger than our content\n\t\t\t\tm(\n\t\t\t\t\t\".flex.col.flex-grow\",\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tminHeight: px(bubbleButtonHeight()),\n\t\t\t\t\t\t\t// set line-height to position the text like in the button\n\t\t\t\t\t\t\tlineHeight: px(bubbleButtonHeight()),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tm(\".span.break-all.smaller\", attachment.name),\n\t\t\t\t\t// bottom info is inside the same column as file text to align them\n\t\t\t\t\tm(\".flex.row.justify-between.items-center\", [\n\t\t\t\t\t\tm(\"span.smaller\", `${formatStorageSize(Number(attachment.size))}`),\n\t\t\t\t\t\tm(\".flex.no-wrap\", [\n\t\t\t\t\t\t\tremove ? m(Button, { type: ButtonType.Secondary, label: \"remove_action\", click: () => this.thenClose(remove) }) : null,\n\t\t\t\t\t\t\tfileImport\n\t\t\t\t\t\t\t\t? m(Button, {\n\t\t\t\t\t\t\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t\t\t\t\t\t\t\tlabel: \"import_action\",\n\t\t\t\t\t\t\t\t\t\tclick: () => this.thenClose(fileImport),\n\t\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\t\topen ? m(Button, { type: ButtonType.Secondary, label: \"open_action\", click: () => this.thenClose(open) }) : null,\n\t\t\t\t\t\t\tdownload ? m(Button, { type: ButtonType.Secondary, label: \"download_action\", click: () => this.thenClose(download) }) : null,\n\t\t\t\t\t\t]),\n\t\t\t\t\t]),\n\t\t\t\t),\n\t\t\t],\n\t\t)\n\t}\n\n\tprivate thenClose(action: Thunk | null): void {\n\t\taction?.()\n\t\tthis.onClose()\n\t}\n\n\tprivate async animatePanel(): Promise<void> {\n\t\tconst { targetRect, domPanel, domContent } = this\n\t\tif (domPanel == null || domContent == null) return\n\t\tconst initialHeight = bubbleButtonHeight()\n\t\t// there is a possibility that we get 0 here in some circumstances, but it's unclear when.\n\t\t// might have something to do with the opacity: 0 hack above or because the original 24ms\n\t\t// delay was not enough. https://github.com/tutao/tutanota/issues/5587\n\t\t// 85 is a value that fits for a single line of attachment name, but looks weird for more while\n\t\t// keeping the buttons accessible.\n\t\t// if the reports continue, we can ask for logs.\n\t\tconst targetHeight = domContent.offsetHeight === 0 ? 85 : domContent.offsetHeight\n\t\tif (domContent.offsetHeight === 0) {\n\t\t\tconsole.log(\n\t\t\t\t\"got offsetHeight 0, panel contains content:\",\n\t\t\t\tdomPanel.contains(domContent),\n\t\t\t\t\"content style:\",\n\t\t\t\tdomContent.style,\n\t\t\t\t\"panel style:\",\n\t\t\t\tdomPanel.style,\n\t\t\t)\n\t\t}\n\t\t// for very short attachment bubbles, we need to set a min width so the buttons fit.\n\t\tconst targetWidth = Math.max(targetRect.width, 300)\n\t\tdomPanel.style.width = px(targetRect.width)\n\t\tdomPanel.style.height = px(initialHeight)\n\t\t// add half the difference between .button height of 44px and 30px for pixel-perfect positioning\n\t\tdomPanel.style.top = px(targetRect.top)\n\n\t\t//Verify if the attachment bubble is going to overflow the screen\n\t\t//if yes, invert the side of the margin and discount the bubble width\n\t\tif (targetRect.left + targetWidth > window.innerWidth) {\n\t\t\tdomPanel.style.right = px(24)\n\t\t} else {\n\t\t\tdomPanel.style.left = px(targetRect.left)\n\t\t}\n\n\t\tconst mutations = [opacity(0, 1, true), height(initialHeight, targetHeight)]\n\t\tif (targetRect.width !== targetWidth) {\n\t\t\tmutations.push(width(targetRect.width, targetWidth))\n\t\t}\n\t\t// space below the panel after it fully extends minus a bit.\n\t\tconst spaceBelow = window.innerHeight - getSafeAreaInsetBottom() - targetRect.top - targetHeight - initialHeight\n\t\tif (spaceBelow < 0) {\n\t\t\tmutations.push(transform(TransformEnum.TranslateY, 0, spaceBelow))\n\t\t}\n\n\t\tawait animations.add(domPanel, mutations, {\n\t\t\teasing: ease.out,\n\t\t})\n\t}\n\n\tshow() {\n\t\tthis.focusedBeforeShown = document.activeElement as HTMLElement\n\t\tmodal.displayUnique(this, true)\n\t}\n\n\tbackgroundClick(e: MouseEvent): void {\n\t\tmodal.remove(this)\n\t}\n\n\tasync hideAnimation(): Promise<void> {\n\t\tif (this.domPanel == null) return\n\t\tconst startHeight = this.domPanel.offsetHeight\n\t\tconst startWidth = this.domPanel.offsetWidth\n\t\tawait animations.add(this.domPanel, [height(startHeight, 30), width(startWidth, this.targetWidth), opacity(1, 0, false)], {\n\t\t\teasing: ease.out,\n\t\t})\n\t}\n\n\tonClose(): void {\n\t\tmodal.remove(this)\n\t\tthis.closeDefer.resolve()\n\t}\n\n\tshortcuts(): Shortcut[] {\n\t\treturn this._shortcuts\n\t}\n\n\tpopState(e: Event): boolean {\n\t\tmodal.remove(this)\n\t\treturn false\n\t}\n\n\tcallingElement(): HTMLElement | null {\n\t\treturn this.focusedBeforeShown\n\t}\n}\n\n/** try and execute stuff after the next rendering frame */\nconst deferToNextFrame = (fn: Thunk) => {\n\twindow.requestAnimationFrame(() => {\n\t\twindow.requestAnimationFrame(fn)\n\t})\n}\n"],"mappings":"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"}