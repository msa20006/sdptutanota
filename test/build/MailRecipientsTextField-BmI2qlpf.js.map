{"version":3,"file":"MailRecipientsTextField-BmI2qlpf.js","names":["e: MouseEvent","attrs: SearchDropDownAttrs<T>","idx: number","attrs: MailRecipientsTextFieldAttrs","address: string","selectSuggestion: boolean","index: number","idx: number","text: string","result: ParsedInput"],"sources":["../../src/common/gui/base/BubbleTextField.ts","../../src/common/gui/SearchDropDown.ts","../../src/common/gui/MailRecipientsTextField.ts"],"sourcesContent":["import m, { Children, ClassComponent, Vnode } from \"mithril\"\nimport { Autocomplete, TextField, TextFieldType } from \"./TextField.js\"\nimport { Translation, MaybeTranslation } from \"../../misc/LanguageViewModel\"\nimport { Keys } from \"../../api/common/TutanotaConstants\"\nimport { createAsyncDropdown, DropdownChildAttrs } from \"./Dropdown.js\"\nimport { lazy } from \"@tutao/tutanota-utils\"\nimport { BaseButton } from \"./buttons/BaseButton.js\"\n\nexport interface BubbleTextFieldAttrs {\n\tlabel: MaybeTranslation\n\titems: Array<string>\n\trenderBubbleText: (item: string) => Translation\n\tgetBubbleDropdownAttrs: (item: string) => Promise<DropdownChildAttrs[]>\n\ttext: string\n\tonInput: (text: string) => void\n\tonBackspace: () => boolean\n\tonEnterKey: () => boolean\n\tonUpKey: () => boolean\n\tonDownKey: () => boolean\n\tdisabled: boolean\n\tinjectionsRight?: Children | null\n\tonFocus: () => void\n\tonBlur: () => void\n\thelpLabel?: lazy<Children> | null\n}\n\nexport class BubbleTextField implements ClassComponent<BubbleTextFieldAttrs> {\n\tprivate active: boolean = false\n\tprivate domInput: HTMLInputElement | null = null\n\n\tview({ attrs }: Vnode<BubbleTextFieldAttrs>) {\n\t\treturn m(\".bubble-text-field\", [\n\t\t\tm(TextField, {\n\t\t\t\tlabel: attrs.label,\n\t\t\t\tdisabled: attrs.disabled,\n\t\t\t\tvalue: attrs.text,\n\t\t\t\toninput: attrs.onInput,\n\t\t\t\thelpLabel: attrs.helpLabel,\n\t\t\t\ttype: TextFieldType.Email,\n\t\t\t\tautocompleteAs: Autocomplete.off,\n\t\t\t\tinjectionsLeft: () => {\n\t\t\t\t\treturn attrs.items.map((item, idx, items) => {\n\t\t\t\t\t\t// We need overflow: hidden on both so that ellipsis on button works.\n\t\t\t\t\t\t// flex is for reserving space for the comma. align-items: end so that comma is pushed to the bottom.\n\t\t\t\t\t\tconst bubbleText = attrs.renderBubbleText(item)\n\t\t\t\t\t\treturn m(\".flex.overflow-hidden.items-end\", [\n\t\t\t\t\t\t\tm(\n\t\t\t\t\t\t\t\t\".flex-no-grow-shrink-auto.overflow-hidden\",\n\t\t\t\t\t\t\t\tm(BaseButton, {\n\t\t\t\t\t\t\t\t\tlabel: bubbleText,\n\t\t\t\t\t\t\t\t\ttext: bubbleText.text,\n\t\t\t\t\t\t\t\t\tclass: \"text-bubble button-content content-fg text-ellipsis flash\",\n\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t\"max-width\": \"100%\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tonclick: (e: MouseEvent) => {\n\t\t\t\t\t\t\t\t\t\te.stopPropagation() // do not focus the text field\n\t\t\t\t\t\t\t\t\t\tcreateAsyncDropdown({\n\t\t\t\t\t\t\t\t\t\t\tlazyButtons: () => attrs.getBubbleDropdownAttrs(item),\n\t\t\t\t\t\t\t\t\t\t\twidth: 250,\n\t\t\t\t\t\t\t\t\t\t})(e, e.target as HTMLElement)\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t// Comma is shown when there's text/another bubble afterwards or if the field is active\n\t\t\t\t\t\t\tthis.active || idx < items.length - 1 || attrs.text !== \"\" ? m(\"span.pr\", \",\") : null,\n\t\t\t\t\t\t])\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tinjectionsRight: () => attrs.injectionsRight ?? null,\n\t\t\t\toncreate: () => {\n\t\t\t\t\t// If the field is initialized with bubbles but the user did not edit it yet then field will not have correct size\n\t\t\t\t\t// and last bubble will not be on the same line with right injections (like \"show\" button). It is fixed after user\n\t\t\t\t\t// edits the field and autocompletion changes the field but before that it's broken. To avoid it we set the size\n\t\t\t\t\t// manually.\n\t\t\t\t\t//\n\t\t\t\t\t// This oncreate is run before the dom input's oncreate is run and sets the field so we have to access input on the\n\t\t\t\t\t// next frame. There's no other callback to use without requesting redraw.\n\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\tif (this.domInput) this.domInput.size = 1\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tonDomInputCreated: (dom) => (this.domInput = dom),\n\t\t\t\tonfocus: () => {\n\t\t\t\t\tthis.active = true\n\t\t\t\t\tattrs.onFocus()\n\t\t\t\t},\n\t\t\t\tonblur: () => {\n\t\t\t\t\tthis.active = false\n\t\t\t\t\tattrs.onBlur()\n\t\t\t\t},\n\t\t\t\tkeyHandler: (key) => {\n\t\t\t\t\tif (key.key != null) {\n\t\t\t\t\t\tswitch (key.key.toLowerCase()) {\n\t\t\t\t\t\t\tcase Keys.BACKSPACE.code:\n\t\t\t\t\t\t\t\treturn attrs.onBackspace()\n\n\t\t\t\t\t\t\tcase Keys.RETURN.code:\n\t\t\t\t\t\t\t\treturn attrs.onEnterKey()\n\n\t\t\t\t\t\t\tcase Keys.DOWN.code:\n\t\t\t\t\t\t\t\treturn attrs.onUpKey()\n\n\t\t\t\t\t\t\tcase Keys.UP.code:\n\t\t\t\t\t\t\t\treturn attrs.onDownKey()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn true\n\t\t\t\t},\n\t\t\t}),\n\t\t])\n\t}\n}\n","import m, { Children, ClassComponent, Vnode } from \"mithril\"\nimport { scrollListDom } from \"./base/GuiUtils.js\"\nimport { px, size } from \"./size.js\"\nimport { windowFacade } from \"../misc/WindowFacade.js\"\n\nconst EntryHeight = 60\n\nexport interface SearchDropDownAttrs<T extends Suggestion> {\n\tsuggestions: ReadonlyArray<T>\n\tselectedSuggestionIndex: number\n\tonSuggestionSelected: (idx: number) => void\n\n\t/** max amount of suggestions that can be visible without scrolling */\n\tmaxHeight: number | null\n}\n\nexport interface Suggestion {\n\tfirstRow: Children\n\tsecondRow: string\n\tdisplay?: boolean\n}\n\nexport class SearchDropDown<T extends Suggestion> implements ClassComponent<SearchDropDownAttrs<T>> {\n\tprivate domSuggestions!: HTMLElement\n\tprivate keyboardHeight: number = 0\n\n\toncreate() {\n\t\twindowFacade.addKeyboardSizeListener((newSize) => {\n\t\t\t// *-------------------*  -\n\t\t\t// |                   |  |\n\t\t\t// |   -------------   |  - <- top\n\t\t\t// |   |           |   |\n\t\t\t// |   |-----------|   |\n\t\t\t// |-------------------|  - <- keyboardHeight\n\t\t\t// | q w e r t z u i o |  |\n\t\t\t// | a s d f g h j k l |  -\n\t\t\t//\n\t\t\t// On iOS screen is not resized when keyboard is opened. Instead we send a signal to WebView with keyboard height.\n\t\t\tthis.keyboardHeight = newSize\n\t\t})\n\t}\n\n\tview({ attrs }: Vnode<SearchDropDownAttrs<T>>): Children {\n\t\tif (attrs.selectedSuggestionIndex !== attrs.selectedSuggestionIndex && this.domSuggestions) {\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tscrollListDom(this.domSuggestions, EntryHeight, attrs.selectedSuggestionIndex)\n\t\t\t})\n\t\t}\n\n\t\t// We need to calculate how much space can be actually used for the dropdown. We cannot just add margin like we do with dialog\n\t\t// because the suggestions dropdown is absolutely positioned.\n\t\tlet dropdownHeight = EntryHeight * Math.min(attrs.maxHeight ?? Number.MAX_VALUE, attrs.suggestions.length)\n\t\tif (this.domSuggestions) {\n\t\t\tconst top = this.domSuggestions.getBoundingClientRect().top\n\t\t\tconst availableHeight = window.innerHeight - top - this.keyboardHeight - size.vpad\n\t\t\tdropdownHeight = Math.min(availableHeight, dropdownHeight)\n\t\t}\n\n\t\treturn m(\n\t\t\t`.abs.z4.full-width.elevated-bg.scroll.text-ellipsis${attrs.suggestions.length ? \".dropdown-shadow\" : \"\"}`,\n\t\t\t{\n\t\t\t\toncreate: (vnode) => (this.domSuggestions = vnode.dom as HTMLElement),\n\t\t\t\tstyle: {\n\t\t\t\t\ttransition: \"height 0.2s\",\n\t\t\t\t\theight: px(dropdownHeight),\n\t\t\t\t},\n\t\t\t},\n\t\t\tattrs.suggestions.map((suggestion, idx) => this.renderSuggestion(attrs, suggestion, idx)),\n\t\t)\n\t}\n\n\tprivate renderSuggestion(attrs: SearchDropDownAttrs<T>, { firstRow, secondRow, display }: T, idx: number): Children {\n\t\tconst selected = idx === attrs.selectedSuggestionIndex\n\n\t\tif (display !== undefined && !display) {\n\t\t\treturn null\n\t\t}\n\n\t\treturn m(\n\t\t\t\".pt-s.pb-s.click.content-hover\",\n\t\t\t{\n\t\t\t\tclass: selected ? \"content-accent-fg row-selected icon-accent\" : \"\",\n\t\t\t\tonmousedown: () => attrs.onSuggestionSelected(idx),\n\t\t\t\tstyle: {\n\t\t\t\t\t\"padding-left\": selected ? px(size.hpad_large - 3) : px(size.hpad_large),\n\t\t\t\t\t\"border-left\": selected ? \"3px solid\" : null,\n\t\t\t\t\theight: px(EntryHeight),\n\t\t\t\t},\n\t\t\t},\n\t\t\t[m(\".small.full-width.text-ellipsis\", firstRow), m(\".name.full-width.text-ellipsis\", secondRow)],\n\t\t)\n\t}\n}\n","import m, { Children, ClassComponent, Vnode } from \"mithril\"\nimport { BubbleTextField } from \"./base/BubbleTextField.js\"\nimport { Recipient } from \"../api/common/recipients/Recipient.js\"\nimport { px, size } from \"./size.js\"\nimport { Icon, progressIcon } from \"./base/Icon.js\"\nimport { lang, TranslationKey } from \"../misc/LanguageViewModel.js\"\nimport { stringToNameAndMailAddress } from \"../misc/parsing/MailAddressParser.js\"\nimport { DropdownChildAttrs } from \"./base/Dropdown.js\"\nimport { Contact } from \"../api/entities/tutanota/TypeRefs.js\"\nimport { RecipientsSearchModel } from \"../misc/RecipientsSearchModel.js\"\nimport { getFirstOrThrow, lazy } from \"@tutao/tutanota-utils\"\nimport { Dialog } from \"./base/Dialog.js\"\nimport { SearchDropDown } from \"./SearchDropDown.js\"\nimport { findRecipientWithAddress } from \"../api/common/utils/CommonCalendarUtils.js\"\nimport { Icons } from \"./base/icons/Icons.js\"\nimport { theme } from \"./theme.js\"\nimport { getMailAddressDisplayText } from \"../mailFunctionality/SharedMailUtils.js\"\n\nexport interface MailRecipientsTextFieldAttrs {\n\tlabel: TranslationKey\n\ttext: string\n\tonTextChanged: (text: string) => void\n\trecipients: ReadonlyArray<Recipient>\n\tonRecipientAdded: (address: string, name: string | null, contact: Contact | null) => void\n\tonRecipientRemoved: (address: string) => void\n\tgetRecipientClickedDropdownAttrs?: (address: string) => Promise<DropdownChildAttrs[]>\n\tinjectionsRight?: Children | null\n\tdisabled: boolean\n\tsearch: RecipientsSearchModel\n\t/** Limit the search dropdown to this number of suggestions before starting to scroll */\n\tmaxSuggestionsToShow?: number\n\thelpLabel?: lazy<Children> | null\n}\n\n/**\n * A component for inputting a list of recipients\n * recipients are represented as bubbles, and a contact search dropdown is shown as the user types\n */\nexport class MailRecipientsTextField implements ClassComponent<MailRecipientsTextFieldAttrs> {\n\t// don't access me directly, use getter and setter\n\tprivate selectedSuggestionIdx = 0\n\tprivate focused = false\n\n\tview({ attrs }: Vnode<MailRecipientsTextFieldAttrs>): Children {\n\t\treturn [this.renderTextField(attrs), this.focused ? this.renderSuggestions(attrs) : null]\n\t}\n\n\tprivate renderTextField(attrs: MailRecipientsTextFieldAttrs): Children {\n\t\treturn m(BubbleTextField, {\n\t\t\tlabel: attrs.label,\n\t\t\ttext: attrs.text,\n\t\t\thelpLabel: attrs.helpLabel,\n\t\t\tonInput: (text) => {\n\t\t\t\tattrs.search.search(text).then(() => m.redraw())\n\n\t\t\t\t// if the new text length is more than one character longer,\n\t\t\t\t// it means the user pasted the text in, so we want to try and resolve a list of contacts\n\t\t\t\tconst { remainingText, newRecipients, errors } = text.length - attrs.text.length > 1 ? parsePastedInput(text) : parseTypedInput(text)\n\n\t\t\t\tfor (const { address, name } of newRecipients) {\n\t\t\t\t\tattrs.onRecipientAdded(address, name, null)\n\t\t\t\t}\n\n\t\t\t\tif (errors.length === 1 && newRecipients.length === 0) {\n\t\t\t\t\t// if there was a single recipient and it was invalid then just pretend nothing happened\n\t\t\t\t\tattrs.onTextChanged(getFirstOrThrow(errors))\n\t\t\t\t} else {\n\t\t\t\t\tif (errors.length > 0) {\n\t\t\t\t\t\tDialog.message(\n\t\t\t\t\t\t\tlang.makeTranslation(\"invalidPastedRecipients_msg\", `${lang.get(\"invalidPastedRecipients_msg\")}\\n\\n${errors.join(\"\\n\")}`),\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t\tattrs.onTextChanged(remainingText)\n\t\t\t\t}\n\t\t\t},\n\t\t\titems: attrs.recipients.map((recipient) => recipient.address),\n\t\t\trenderBubbleText: (address: string) => {\n\t\t\t\tconst name = findRecipientWithAddress(attrs.recipients, address)?.name ?? null\n\t\t\t\treturn lang.makeTranslation(address, getMailAddressDisplayText(name, address, false))\n\t\t\t},\n\t\t\tgetBubbleDropdownAttrs: async (address) => (await attrs.getRecipientClickedDropdownAttrs?.(address)) ?? [],\n\t\t\tonBackspace: () => {\n\t\t\t\tif (attrs.text === \"\" && attrs.recipients.length > 0) {\n\t\t\t\t\tconst { address } = attrs.recipients.slice().pop()!\n\t\t\t\t\tattrs.onTextChanged(address)\n\t\t\t\t\tattrs.onRecipientRemoved(address)\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\treturn true\n\t\t\t},\n\t\t\tonEnterKey: () => {\n\t\t\t\tthis.resolveInput(attrs, true)\n\t\t\t\treturn true\n\t\t\t},\n\t\t\tonUpKey: () => {\n\t\t\t\tthis.setSelectedSuggestionIdx(this.getSelectedSuggestionIdx(attrs) + 1)\n\t\t\t\treturn false\n\t\t\t},\n\t\t\tonDownKey: () => {\n\t\t\t\tthis.setSelectedSuggestionIdx(this.getSelectedSuggestionIdx(attrs) - 1)\n\t\t\t\treturn false\n\t\t\t},\n\t\t\tonFocus: () => {\n\t\t\t\tthis.focused = true\n\t\t\t},\n\t\t\tonBlur: () => {\n\t\t\t\tthis.focused = false\n\t\t\t\tthis.resolveInput(attrs, false)\n\t\t\t\treturn true\n\t\t\t},\n\t\t\tdisabled: attrs.disabled,\n\t\t\tinjectionsRight: m(\".flex.items-center\", [\n\t\t\t\t// Placeholder element for the suggestion progress icon with a fixed width and height to avoid flickering.\n\t\t\t\t// when reaching the end of the input line and when entering a text into the second line.\n\t\t\t\tm(\n\t\t\t\t\t\".flex.align-right.mr-s.flex.items-end.pb-s\",\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\twidth: px(20), // in case the progress icon is not shown we reserve the width of the progress icon\n\t\t\t\t\t\t\theight: px(size.button_height_compact),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tattrs.search.isLoading() ? progressIcon() : null,\n\t\t\t\t),\n\t\t\t\tattrs.injectionsRight,\n\t\t\t]),\n\t\t})\n\t}\n\n\tprivate renderSuggestions(attrs: MailRecipientsTextFieldAttrs): Children {\n\t\treturn m(\n\t\t\t\".rel\",\n\t\t\tm(SearchDropDown, {\n\t\t\t\tsuggestions: attrs.search.results().map((suggestion) => {\n\t\t\t\t\tif (suggestion.type === \"recipient\") {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tfirstRow: suggestion.value.name,\n\t\t\t\t\t\t\tsecondRow: suggestion.value.address,\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tfirstRow: m(Icon, {\n\t\t\t\t\t\t\t\ticon: Icons.People,\n\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\tfill: theme.content_fg,\n\t\t\t\t\t\t\t\t\t\"aria-describedby\": lang.get(\"contactListName_label\"),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tsecondRow: suggestion.value.name,\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tselectedSuggestionIndex: this.getSelectedSuggestionIdx(attrs),\n\t\t\t\tonSuggestionSelected: (idx) => this.selectSuggestion(attrs, idx),\n\t\t\t\tmaxHeight: attrs.maxSuggestionsToShow ?? null,\n\t\t\t}),\n\t\t)\n\t}\n\n\t/**\n\t * Resolves a typed in mail address or one of the suggested ones.\n\t * @param selectSuggestion boolean value indicating whether a suggestion should be selected or not. Should be true if a suggestion is explicitly selected by\n\t * for example hitting the enter key and false e.g. if the dialog is closed\n\t */\n\tprivate resolveInput(attrs: MailRecipientsTextFieldAttrs, selectSuggestion: boolean) {\n\t\tconst suggestions = attrs.search.results()\n\t\tif (suggestions.length > 0 && selectSuggestion) {\n\t\t\tthis.selectSuggestion(attrs, this.getSelectedSuggestionIdx(attrs))\n\t\t} else {\n\t\t\tconst parsed = parseMailAddress(attrs.text)\n\t\t\tif (parsed != null) {\n\t\t\t\tattrs.onRecipientAdded(parsed.address, parsed.name, null)\n\t\t\t\tattrs.onTextChanged(\"\")\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async selectSuggestion(attrs: MailRecipientsTextFieldAttrs, index: number) {\n\t\tconst selection = attrs.search.results()[index]\n\t\tif (selection == null) {\n\t\t\treturn\n\t\t}\n\n\t\tif (selection.type === \"recipient\") {\n\t\t\tconst { address, name, contact } = selection.value\n\t\t\tattrs.onRecipientAdded(address, name, contact)\n\t\t\tattrs.search.clear()\n\t\t\tattrs.onTextChanged(\"\")\n\t\t} else {\n\t\t\tattrs.search.clear()\n\t\t\tattrs.onTextChanged(\"\")\n\t\t\tconst recipients = await attrs.search.resolveContactList(selection.value)\n\t\t\tfor (const { address, name, contact } of recipients) {\n\t\t\t\tattrs.onRecipientAdded(address, name, contact)\n\t\t\t}\n\t\t\tm.redraw()\n\t\t}\n\t}\n\n\tprivate getSelectedSuggestionIdx(attrs: MailRecipientsTextFieldAttrs): number {\n\t\treturn Math.min(Math.max(this.selectedSuggestionIdx, 0), attrs.search.results().length - 1)\n\t}\n\n\tprivate setSelectedSuggestionIdx(idx: number) {\n\t\tthis.selectedSuggestionIdx = idx\n\t}\n}\n\ninterface ParsedInput {\n\tremainingText: string\n\tnewRecipients: Array<{ address: string; name: string | null }>\n\terrors: Array<string>\n}\n\n/**\n * Parse a list of valid mail addresses separated by either a semicolon or a comma.\n * Invalid addresses will be returned as a separate list\n */\nexport function parsePastedInput(text: string): ParsedInput {\n\tconst separator = text.indexOf(\";\") !== -1 ? \";\" : \",\"\n\tconst textParts = text.split(separator).map((part) => part.trim())\n\n\tconst result: ParsedInput = {\n\t\tremainingText: \"\",\n\t\tnewRecipients: [],\n\t\terrors: [],\n\t}\n\n\tfor (let part of textParts) {\n\t\tpart = part.trim()\n\n\t\tif (part.length !== 0) {\n\t\t\tconst parsed = parseMailAddress(part)\n\n\t\t\tif (!parsed) {\n\t\t\t\tresult.errors.push(part)\n\t\t\t} else {\n\t\t\t\tresult.newRecipients.push(parsed)\n\t\t\t}\n\t\t}\n\t}\n\n\treturn result\n}\n\n/**\n * Parse text when it is typed by the user\n * When the final character is an expected delimiter (';', ',', ' '),\n * then we attempt to parse the preceding text. If it is a valid mail address,\n * it is successfully parsed\n * invalid input gets returned in `remainingText`, `errors` is always empty\n * @param text\n */\nexport function parseTypedInput(text: string): ParsedInput {\n\tconst lastCharacter = text.slice(-1)\n\n\t// on semicolon, comman or space we want to try to resolve the input text\n\tif (lastCharacter === \";\" || lastCharacter === \",\" || lastCharacter === \" \") {\n\t\tconst textMinusLast = text.slice(0, -1)\n\n\t\tconst result = parseMailAddress(textMinusLast)\n\t\tconst remainingText = result != null ? \"\" : textMinusLast\n\n\t\treturn {\n\t\t\tremainingText,\n\t\t\tnewRecipients: result ? [result] : [],\n\t\t\terrors: [],\n\t\t}\n\t} else {\n\t\treturn {\n\t\t\tremainingText: text,\n\t\t\tnewRecipients: [],\n\t\t\terrors: [],\n\t\t}\n\t}\n}\n\nexport function parseMailAddress(text: string): { address: string; name: string | null } | null {\n\ttext = text.trim()\n\n\tif (text === \"\") return null\n\n\tconst nameAndMailAddress = stringToNameAndMailAddress(text)\n\n\tif (nameAndMailAddress) {\n\t\tconst name = nameAndMailAddress.name ? nameAndMailAddress.name : null\n\n\t\treturn { name, address: nameAndMailAddress.mailAddress }\n\t} else {\n\t\treturn null\n\t}\n}\n"],"mappings":"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"}