
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { isAdminClient, isBrowser } from "./Env-D5xGlXfw.js";
import { CredentialType } from "./CredentialType-DXeA2MQH.js";

//#region ../src/common/misc/credentials/CredentialsProvider.ts
var CredentialsProvider = class {
	constructor(credentialsFacade, sqliteCipherFacade, interWindowEventSender) {
		this.credentialsFacade = credentialsFacade;
		this.sqliteCipherFacade = sqliteCipherFacade;
		this.interWindowEventSender = interWindowEventSender;
	}
	/**
	* Stores credentials. If credentials already exist for login, they will be overwritten.
	*/
	async store(credentials) {
		return this.credentialsFacade.store(credentials);
	}
	/**
	* Change the encrypted password for the stored credentials.
	*/
	async replacePassword(credentials, encryptedPassword, encryptedPassphraseKey) {
		const encryptedCredentials = await this.getCredentialsByUserId(credentials.userId);
		if (encryptedCredentials == null) throw new Error(`Trying to replace password for credentials but credentials are not persisted: ${credentials.userId}`);
		const newEncryptedCredentials = {
			...encryptedCredentials,
			encryptedPassword,
			encryptedPassphraseKey
		};
		await this.credentialsFacade.storeEncrypted(newEncryptedCredentials);
	}
	async getCredentialsInfoByUserId(userId) {
		return (await this.getCredentialsByUserId(userId))?.credentialInfo ?? null;
	}
	async getAllInternalCredentials() {
		return this.credentialsFacade.loadAll();
	}
	async getCredentialsByUserId(userId) {
		const allCredentials = await this.credentialsFacade.loadAll();
		return allCredentials.find((credential) => credential.credentialInfo.userId === userId) ?? null;
	}
	/**
	* Returns the full credentials for the userId passed in.
	* @param userId
	*/
	async getDecryptedCredentialsByUserId(userId) {
		return this.credentialsFacade.loadByUserId(userId);
	}
	/**
	* Returns the stored credentials infos of all internal users, i.e. users that have a "real" tutanota account and not the ones that
	* have a secure external mailbox. The returned array will be sorted by login.
	*/
	async getInternalCredentialsInfos() {
		const allCredentials = await this.credentialsFacade.loadAll();
		return allCredentials.filter((credential) => credential.credentialInfo.type === CredentialType.Internal).map((credential) => credential.credentialInfo).sort((a, b) => a.login.localeCompare(b.login));
	}
	/**
	* Deletes stored credentials with specified userId.
	* No-op if credentials are not there.
	* @param opts.deleteOfflineDb whether to delete offline database. Will delete by default.
	*/
	async deleteByUserId(userId, opts = { deleteOfflineDb: true }) {
		await this.interWindowEventSender?.localUserDataInvalidated(userId);
		if (opts.deleteOfflineDb) await this.sqliteCipherFacade?.deleteDb(userId);
		await this.credentialsFacade.deleteByUserId(userId);
	}
	/**
	* Sets the credentials encryption mode, i.e. how the intermediate key used for encrypting credentials is protected.
	* @param encryptionMode
	* @throws KeyPermanentlyInvalidatedError
	* @throws CredentialAuthenticationError
	*/
	async setCredentialEncryptionMode(encryptionMode) {
		await this.credentialsFacade.setCredentialEncryptionMode(encryptionMode);
		this.interWindowEventSender?.reloadDeviceConfig();
	}
	/**
	* Returns the credentials encryption mode, i.e. how the intermediate key used for encrypting credentials is protected.
	*/
	getCredentialEncryptionMode() {
		return this.credentialsFacade.getCredentialEncryptionMode();
	}
	/**
	* Returns all credentials encryption modes that are supported by the device.
	*/
	async getSupportedEncryptionModes() {
		return await this.credentialsFacade.getSupportedEncryptionModes();
	}
	/**
	* Removes all stored credentials as well as any settings associated with credentials encryption.
	*/
	async clearCredentials(reason) {
		console.warn("clearing all stored credentials:", reason);
		await this.credentialsFacade.clear();
	}
};
function usingKeychainAuthenticationWithOptions() {
	return !isBrowser() && !isAdminClient();
}

//#endregion
export { CredentialsProvider, usingKeychainAuthenticationWithOptions };
//# sourceMappingURL=CredentialsProvider-HbB_U0ec.js.map