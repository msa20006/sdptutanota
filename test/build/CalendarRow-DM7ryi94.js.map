{"version":3,"file":"CalendarRow-DM7ryi94.js","names":["domElement: HTMLElement","event: CalendarEvent","selected: boolean","isInMultiSelect: boolean","vnode: VnodeDOM","dom: HTMLElement","item: CalendarEvent"],"sources":["../../src/calendar-app/calendar/gui/CalendarRow.ts"],"sourcesContent":["import type { CalendarEvent } from \"../../../common/api/entities/tutanota/TypeRefs.js\"\nimport { locator } from \"../../../common/api/main/CommonLocator.js\"\nimport m, { Children, VnodeDOM } from \"mithril\"\n\nimport { SelectableRowContainer, SelectableRowContainerAttrs, SelectableRowSelectedSetter } from \"../../../common/gui/SelectableRowContainer.js\"\nimport { VirtualRow } from \"../../../common/gui/base/ListUtils.js\"\nimport { getTimeZone } from \"../../../common/calendar/date/CalendarUtils.js\"\nimport { ViewHolder } from \"../../../common/gui/base/List.js\"\nimport { styles } from \"../../../common/gui/styles.js\"\nimport { DefaultAnimationTime } from \"../../../common/gui/animation/Animations.js\"\n\nimport { formatEventDuration, getClientOnlyColors, getDisplayEventTitle, getEventColor, getGroupColors } from \"./CalendarGuiUtils.js\"\nimport { GroupColors } from \"../view/CalendarView.js\"\n\nexport class CalendarRow implements VirtualRow<CalendarEvent> {\n\ttop: number\n\n\tentity: CalendarEvent | null\n\tcolors: GroupColors\n\n\tprivate selectionSetter!: SelectableRowSelectedSetter\n\tprivate calendarIndicatorDom!: HTMLElement\n\tprivate summaryDom!: HTMLElement\n\tprivate durationDom!: HTMLElement\n\n\tconstructor(readonly domElement: HTMLElement) {\n\t\tthis.top = 0\n\t\tthis.entity = null\n\n\t\tconst clientOnlyColors = getClientOnlyColors(locator.logins.getUserController().userId, locator.deviceConfig.getClientOnlyCalendars())\n\t\tconst groupColors = getGroupColors(locator.logins.getUserController().userSettingsGroupRoot)\n\t\tfor (let [calendarId, color] of clientOnlyColors.entries()) {\n\t\t\tgroupColors.set(calendarId, color)\n\t\t}\n\n\t\tthis.colors = groupColors\n\t}\n\n\tupdate(event: CalendarEvent, selected: boolean, isInMultiSelect: boolean): void {\n\t\tthis.entity = event\n\t\tthis.summaryDom.innerText = getDisplayEventTitle(event.summary)\n\t\tthis.calendarIndicatorDom.style.backgroundColor = `#${getEventColor(event, this.colors)}`\n\t\tthis.durationDom.innerText = formatEventDuration(this.entity, getTimeZone(), false)\n\n\t\tthis.selectionSetter(selected, isInMultiSelect)\n\t}\n\n\t/**\n\t * Only the structure is managed by mithril. We set all contents on our own (see update) in order to avoid the vdom overhead (not negligible on mobiles)\n\t */\n\trender(): Children {\n\t\treturn m(\n\t\t\tSelectableRowContainer,\n\t\t\t{\n\t\t\t\tonSelectedChangeRef: (changer) => {\n\t\t\t\t\tthis.selectionSetter = changer\n\t\t\t\t},\n\t\t\t} satisfies SelectableRowContainerAttrs,\n\t\t\tm(\n\t\t\t\t\".flex.items-center.gap-vpad.click.border-radius\",\n\t\t\t\t{\n\t\t\t\t\tclass: (styles.isDesktopLayout() ? \"\" : \"state-bg\") + \"limit-width full-width\",\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\ttransition: `background ${DefaultAnimationTime}ms`,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[\n\t\t\t\t\tm(\"\", {\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tminWidth: \"16px\",\n\t\t\t\t\t\t\tminHeight: \"16px\",\n\t\t\t\t\t\t\tborderRadius: \"50%\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\toncreate: (vnode: VnodeDOM) => {\n\t\t\t\t\t\t\tthis.calendarIndicatorDom = vnode.dom as HTMLElement\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tm(\".flex.col\", { class: \"min-width-0\" }, [\n\t\t\t\t\t\tm(\"p.b.m-0.badge-line-height\", {\n\t\t\t\t\t\t\tclass: \"text-ellipsis\",\n\t\t\t\t\t\t\toncreate: (vnode: VnodeDOM) => {\n\t\t\t\t\t\t\t\tthis.summaryDom = vnode.dom as HTMLElement\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tm(\".smaller\", {\n\t\t\t\t\t\t\toncreate: (vnode: VnodeDOM) => {\n\t\t\t\t\t\t\t\tthis.durationDom = vnode.dom as HTMLElement\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t],\n\t\t\t),\n\t\t)\n\t}\n}\n\nexport class KindaCalendarRow implements ViewHolder<CalendarEvent> {\n\treadonly cr: CalendarRow\n\tdomElement: HTMLElement\n\tentity: CalendarEvent | null = null\n\n\tconstructor(dom: HTMLElement) {\n\t\tthis.cr = new CalendarRow(dom)\n\t\tthis.domElement = dom\n\t\tm.render(dom, this.cr.render())\n\t}\n\n\tupdate(item: CalendarEvent, selected: boolean, isInMultiSelect: boolean) {\n\t\tthis.entity = item\n\t\tthis.cr.update(item, selected, isInMultiSelect)\n\t}\n\n\trender(): Children {\n\t\treturn this.cr.render()\n\t}\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAca,cAAN,MAAuD;CAC7D;CAEA;CACA;CAEA,AAAQ;CACR,AAAQ;CACR,AAAQ;CACR,AAAQ;CAER,YAAqBA,YAAyB;EA2F9C,KA3FqB;AACpB,OAAK,MAAM;AACX,OAAK,SAAS;EAEd,MAAM,mBAAmB,oBAAoB,QAAQ,OAAO,mBAAmB,CAAC,QAAQ,QAAQ,aAAa,wBAAwB,CAAC;EACtI,MAAM,cAAc,eAAe,QAAQ,OAAO,mBAAmB,CAAC,sBAAsB;AAC5F,OAAK,IAAI,CAAC,YAAY,MAAM,IAAI,iBAAiB,SAAS,CACzD,aAAY,IAAI,YAAY,MAAM;AAGnC,OAAK,SAAS;CACd;CAED,OAAOC,OAAsBC,UAAmBC,iBAAgC;AAC/E,OAAK,SAAS;AACd,OAAK,WAAW,YAAY,qBAAqB,MAAM,QAAQ;AAC/D,OAAK,qBAAqB,MAAM,mBAAmB,GAAG,cAAc,OAAO,KAAK,OAAO,CAAC;AACxF,OAAK,YAAY,YAAY,oBAAoB,KAAK,QAAQ,aAAa,EAAE,MAAM;AAEnF,OAAK,gBAAgB,UAAU,gBAAgB;CAC/C;;;;CAKD,SAAmB;AAClB,SAAO,gBACN,wBACA,EACC,qBAAqB,CAAC,YAAY;AACjC,QAAK,kBAAkB;EACvB,EACD,GACD,gBACC,mDACA;GACC,QAAQ,OAAO,iBAAiB,GAAG,KAAK,cAAc;GACtD,OAAO,EACN,aAAa,aAAa,qBAAqB,IAC/C;EACD,GACD,CACC,gBAAE,IAAI;GACL,OAAO;IACN,UAAU;IACV,WAAW;IACX,cAAc;GACd;GACD,UAAU,CAACC,UAAoB;AAC9B,SAAK,uBAAuB,MAAM;GAClC;EACD,EAAC,EACF,gBAAE,aAAa,EAAE,OAAO,cAAe,GAAE,CACxC,gBAAE,6BAA6B;GAC9B,OAAO;GACP,UAAU,CAACA,UAAoB;AAC9B,SAAK,aAAa,MAAM;GACxB;EACD,EAAC,EACF,gBAAE,YAAY,EACb,UAAU,CAACA,UAAoB;AAC9B,QAAK,cAAc,MAAM;EACzB,EACD,EAAC,AACF,EAAC,AACF,EACD,CACD;CACD;AACD;IAEY,mBAAN,MAA4D;CAClE,AAAS;CACT;CACA,SAA+B;CAE/B,YAAYC,KAAkB;AAC7B,OAAK,KAAK,IAAI,YAAY;AAC1B,OAAK,aAAa;AAClB,kBAAE,OAAO,KAAK,KAAK,GAAG,QAAQ,CAAC;CAC/B;CAED,OAAOC,MAAqBJ,UAAmBC,iBAA0B;AACxE,OAAK,SAAS;AACd,OAAK,GAAG,OAAO,MAAM,UAAU,gBAAgB;CAC/C;CAED,SAAmB;AAClB,SAAO,KAAK,GAAG,QAAQ;CACvB;AACD"}