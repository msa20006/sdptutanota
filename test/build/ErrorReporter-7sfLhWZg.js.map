{"version":3,"file":"ErrorReporter-7sfLhWZg.js","names":["dateProvider: () => Date","level: string","args: Array<any>","date: Date","content: string","scope: string","timestamp?: number","e: ErrorInfo","decision: \"send\" | \"cancel\"","subject: string","message: string","logs: readonly DataFile[]","dialog: Dialog","heading: string","text: string","logDialog: Dialog","content: FeedbackContent","error: ErrorInfo","userMessage: string | null","logs: DataFile[]","loggedIn: boolean","client","timestamp: Date","timestamp?: Date","logs: Array<DataFile>"],"sources":["../../src/common/api/common/Logger.ts","../../src/common/misc/ErrorReporter.ts"],"sourcesContent":["//@bundleInto:common-min\n\nimport { errorToString, stringToUtf8Uint8Array } from \"@tutao/tutanota-utils\"\nimport { DataFile } from \"./DataFile\"\n\nexport const LOG_SIZE = 1000\n\nexport class Logger {\n\t// Circular buffer with next writable position pointed by _index\n\t_entries: Array<Array<any>>\n\t_index: number\n\t_dateProvider: () => Date\n\n\tconstructor(dateProvider: () => Date = () => new Date()) {\n\t\tthis._entries = new Array(LOG_SIZE)\n\t\tthis._index = 0\n\t\tthis._dateProvider = dateProvider\n\t}\n\n\tlogInfo(...args: Array<any>) {\n\t\tthis.log(\"I\", args)\n\t}\n\n\tlogError(...args: Array<any>) {\n\t\tthis.log(\"E\", args)\n\t}\n\n\tlogWarn(...args: Array<any>) {\n\t\tthis.log(\"W\", args)\n\t}\n\n\tlog(level: string, args: Array<any>) {\n\t\tconst entry = [this._dateProvider(), level]\n\t\tentry.push(...args)\n\t\tthis._entries[this._index] = entry\n\t\tthis._index++\n\n\t\tif (this._index === LOG_SIZE) {\n\t\t\tthis._index = 0\n\t\t}\n\t}\n\n\tformatLogEntry(date: Date, level: string, ...rest: Array<any>): string {\n\t\tconst formattedArgs = rest.map((obj) => {\n\t\t\ttry {\n\t\t\t\treturn obj instanceof Error ? errorToString(Object.assign({ stack: null }, obj)) : JSON.stringify(obj)\n\t\t\t} catch (e) {\n\t\t\t\treturn \"[cyclic object]\"\n\t\t\t}\n\t\t})\n\t\tconst message = formattedArgs.join(\",\")\n\t\treturn `${date.toISOString()} ${level} ${message}`\n\t}\n\n\tgetEntries(): Array<string> {\n\t\tconst newerPart = this._entries.slice(0, this._index)\n\n\t\tconst olderPart = this._entries.slice(this._index)\n\n\t\treturn olderPart\n\t\t\t.concat(newerPart)\n\t\t\t.filter(Boolean)\n\t\t\t.map(([date, level, ...rest]) => {\n\t\t\t\treturn this.formatLogEntry(date, level, ...rest)\n\t\t\t})\n\t}\n}\n\nexport function createLogFile(content: string, scope: string, timestamp?: number): DataFile {\n\tconst data = stringToUtf8Uint8Array(content)\n\tconst timestampString = timestamp ? timestamp + \"_\" : \"\"\n\treturn {\n\t\t_type: \"DataFile\",\n\t\tname: timestampString + scope + \"_tutanota.log\",\n\t\tmimeType: \"text/plain\",\n\t\tdata,\n\t\tsize: data.byteLength,\n\t\tid: undefined,\n\t}\n}\n\nexport function replaceNativeLogger(global: any, loggerInstance: Logger, force: boolean = false) {\n\t// Replace native logger only when enabled because we lose line numbers\n\tif (force || global.env.dist || global.debug) {\n\t\tglobal.logger = loggerInstance\n\t\tconst globalConsole = global.console\n\t\tglobal.console = {\n\t\t\tlog(...args: any[]) {\n\t\t\t\tglobalConsole.log(...args)\n\t\t\t\tloggerInstance.logInfo(...args)\n\t\t\t},\n\n\t\t\twarn(...args: any[]) {\n\t\t\t\tglobalConsole.warn(...args)\n\t\t\t\tloggerInstance.logWarn(...args)\n\t\t\t},\n\n\t\t\terror(...args: any[]) {\n\t\t\t\tglobalConsole.error(...args)\n\t\t\t\tloggerInstance.logError(...args)\n\t\t\t},\n\n\t\t\ttrace(...args: any[]) {\n\t\t\t\tglobalConsole.trace(...args)\n\t\t\t},\n\t\t\tinfo(...args: any[]) {\n\t\t\t\tglobalConsole.info(...args)\n\t\t\t},\n\t\t}\n\t}\n}\n","import stream from \"mithril/stream\"\nimport { TextField, TextFieldType } from \"../gui/base/TextField.js\"\nimport { lang } from \"./LanguageViewModel\"\nimport { Dialog, DialogType } from \"../gui/base/Dialog\"\nimport * as notificationOverlay from \"../gui/base/NotificationOverlay\"\nimport m from \"mithril\"\nimport { Checkbox } from \"../gui/base/Checkbox.js\"\nimport { Button, ButtonType } from \"../gui/base/Button.js\"\nimport { ExpanderButton, ExpanderPanel } from \"../gui/base/Expander\"\nimport { downcast, ErrorInfo, errorToString, neverNull, typedKeys, uint8ArrayToString } from \"@tutao/tutanota-utils\"\nimport { locator } from \"../api/main/CommonLocator\"\nimport { AccountType, ConversationType, Keys, MailMethod } from \"../api/common/TutanotaConstants\"\nimport { copyToClipboard } from \"./ClipboardUtils\"\nimport { px } from \"../gui/size\"\nimport { isApp, isDesktop, Mode } from \"../api/common/Env\"\nimport { RecipientType } from \"../api/common/recipients/Recipient.js\"\nimport { createLogFile } from \"../api/common/Logger.js\"\nimport { DataFile } from \"../api/common/DataFile.js\"\nimport { convertTextToHtml } from \"./Formatter.js\"\nimport { ReportErrorService } from \"../api/entities/monitor/Services.js\"\nimport { createErrorReportData, createErrorReportFile, createReportErrorIn } from \"../api/entities/monitor/TypeRefs.js\"\nimport { ErrorReportClientType } from \"./ClientConstants.js\"\nimport { client } from \"./ClientDetector.js\"\nimport { BubbleButton } from \"../gui/base/buttons/BubbleButton.js\"\n\ntype FeedbackContent = {\n\tmessage: string\n\tsubject: string\n\tlogs: Array<DataFile>\n}\n\n/**\n * Displays a notification overlay that some error has occurred with an option to send an error report or dismiss the notification. In either case the\n * error can be ignored.\n *\n * If report is pressed then it shows a report dialog with message field and an overview of the sent data.\n */\nexport async function showErrorNotification(e: ErrorInfo): Promise<{ ignored: boolean }> {\n\tconst loggedIn = locator.logins.isUserLoggedIn()\n\n\tconst logs = await getLogAttachments()\n\n\tconst { decision, ignore } = await showErrorOverlay()\n\tif (decision === \"cancel\") {\n\t\treturn { ignored: ignore }\n\t}\n\n\tconst preparedContent = prepareFeedbackContent(e, loggedIn)\n\n\tconst reportDialogResult = await showReportDialog(preparedContent.subject, preparedContent.message, logs)\n\tif (reportDialogResult.decision === \"cancel\") {\n\t\treturn { ignored: ignore }\n\t}\n\tpreparedContent.logs = reportDialogResult.sendLogs ? logs : []\n\tpreparedContent.message = reportDialogResult.userMessage + \"\\n\" + preparedContent.message\n\n\tsendToServer(e, reportDialogResult.userMessage, reportDialogResult.sendLogs ? logs : [])\n\tsendFeedbackMail(preparedContent)\n\n\treturn { ignored: ignore }\n}\n\nasync function showErrorOverlay(): Promise<{ decision: \"send\" | \"cancel\"; ignore: boolean }> {\n\tlet ignore = false\n\tconst decision: \"send\" | \"cancel\" = await new Promise((resolve) => {\n\t\tnotificationOverlay.show(\n\t\t\t{\n\t\t\t\tview: () =>\n\t\t\t\t\tm(\"\", [\n\t\t\t\t\t\t\"An error occurred\",\n\t\t\t\t\t\tm(Checkbox, {\n\t\t\t\t\t\t\tlabel: () => \"Ignore the error for this session\",\n\t\t\t\t\t\t\tchecked: ignore,\n\t\t\t\t\t\t\tonChecked: (checked) => (ignore = checked),\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: \"close_alt\",\n\t\t\t\tclick: () => resolve(\"cancel\"),\n\t\t\t},\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\tlabel: \"sendReport_label\",\n\t\t\t\t\tclick: () => resolve(\"send\"),\n\t\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t\t},\n\t\t\t],\n\t\t)\n\t})\n\treturn { decision, ignore }\n}\n\nfunction showReportDialog(\n\tsubject: string,\n\tmessage: string,\n\tlogs: readonly DataFile[],\n): Promise<{ decision: \"send\"; sendLogs: boolean; userMessage: string } | { decision: \"cancel\" }> {\n\tlet sendLogs = true\n\tlet detailsExpanded = false\n\tlet userMessage = \"\"\n\n\tconst dialogContent = {\n\t\tview: () => {\n\t\t\treturn [\n\t\t\t\tm(TextField, {\n\t\t\t\t\tlabel: \"yourMessage_label\",\n\t\t\t\t\thelpLabel: () => lang.get(\"feedbackOnErrorInfo_msg\"),\n\t\t\t\t\tvalue: userMessage,\n\t\t\t\t\ttype: TextFieldType.Area,\n\t\t\t\t\toninput: (value) => (userMessage = value),\n\t\t\t\t}),\n\t\t\t\tm(Checkbox, {\n\t\t\t\t\tlabel: () => lang.get(\"sendLogs_action\"),\n\t\t\t\t\thelpLabel: \"sendLogsInfo_msg\",\n\t\t\t\t\tchecked: sendLogs,\n\t\t\t\t\tonChecked: (checked) => (sendLogs = checked),\n\t\t\t\t}),\n\t\t\t\tm(\n\t\t\t\t\t\".flex.flex-column.space-around.items-center\",\n\t\t\t\t\tlogs.map((l) =>\n\t\t\t\t\t\tm(BubbleButton, {\n\t\t\t\t\t\t\tlabel: lang.makeTranslation(\"filename\", l.name),\n\t\t\t\t\t\t\tonclick: () => showLogDialog(l.name, uint8ArrayToString(\"utf-8\", (l as DataFile).data)),\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t\tm(\n\t\t\t\t\t\".flex-end\",\n\t\t\t\t\tm(\n\t\t\t\t\t\t\".right\",\n\t\t\t\t\t\tm(ExpanderButton, {\n\t\t\t\t\t\t\tlabel: \"details_label\",\n\t\t\t\t\t\t\texpanded: detailsExpanded,\n\t\t\t\t\t\t\tonExpandedChange: (expanded) => (detailsExpanded = expanded),\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t\tm(\n\t\t\t\t\tExpanderPanel,\n\t\t\t\t\t{\n\t\t\t\t\t\texpanded: detailsExpanded,\n\t\t\t\t\t},\n\t\t\t\t\tm(\".selectable\", [m(\".selectable\", subject), message.split(\"\\n\").map((l) => (l.trim() === \"\" ? m(\".pb\", \"\") : m(\"\", l)))]),\n\t\t\t\t),\n\t\t\t]\n\t\t},\n\t}\n\n\treturn new Promise((resolve) => {\n\t\tDialog.showActionDialog({\n\t\t\tokActionTextId: \"send_action\",\n\t\t\ttitle: \"sendErrorReport_action\",\n\t\t\ttype: DialogType.EditMedium,\n\t\t\tchild: dialogContent,\n\t\t\tokAction: (dialog: Dialog) => {\n\t\t\t\tresolve({ decision: \"send\", sendLogs, userMessage })\n\t\t\t\tdialog.close()\n\t\t\t},\n\t\t\tcancelAction: () => resolve({ decision: \"cancel\" }),\n\t\t})\n\t})\n}\n\n/**\n * show the contents of a log file in a large dialog.\n * @param heading the title of the dialog\n * @param text the text to display\n */\nasync function showLogDialog(heading: string, text: string) {\n\tlet logDialog: Dialog\n\tconst closeLogDialog = () => logDialog?.close()\n\n\tlogDialog = Dialog.largeDialog(\n\t\t{\n\t\t\tright: [\n\t\t\t\t{\n\t\t\t\t\tlabel: \"ok_action\",\n\t\t\t\t\tclick: closeLogDialog,\n\t\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t\t},\n\t\t\t],\n\t\t\tmiddle: lang.makeTranslation(\"heading\", heading),\n\t\t},\n\t\t{\n\t\t\tview: () => m(\".white-space-pre.pt.pb.selectable\", text),\n\t\t},\n\t)\n\t\t.addShortcut({\n\t\t\tkey: Keys.ESC,\n\t\t\texec: closeLogDialog,\n\t\t\thelp: \"close_alt\",\n\t\t})\n\t\t.setCloseHandler(closeLogDialog)\n\t\t.show()\n}\n\nexport async function showErrorDialogNotLoggedIn(e: ErrorInfo): Promise<void> {\n\tconst content = prepareFeedbackContent(e, false)\n\tconst expanded = stream(false)\n\tconst message = content.subject + \"\\n\\n\" + content.message\n\n\tconst info = () => [\n\t\tm(\n\t\t\t\".flex.col.items-end.plr\",\n\t\t\t{\n\t\t\t\tstyle: {\n\t\t\t\t\tmarginTop: \"-16px\",\n\t\t\t\t},\n\t\t\t},\n\t\t\t[\n\t\t\t\tm(\n\t\t\t\t\t\"div.mr-negative-xs\",\n\t\t\t\t\tm(ExpanderButton, {\n\t\t\t\t\t\texpanded: expanded(),\n\t\t\t\t\t\tonExpandedChange: expanded,\n\t\t\t\t\t\tlabel: \"showMore_action\",\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t],\n\t\t),\n\t\tm(\n\t\t\tExpanderPanel,\n\t\t\t{\n\t\t\t\texpanded: expanded(),\n\t\t\t},\n\t\t\t[\n\t\t\t\tm(\n\t\t\t\t\t\".flex-end.plr\",\n\t\t\t\t\tm(Button, {\n\t\t\t\t\t\tlabel: \"copy_action\",\n\t\t\t\t\t\tclick: () => copyToClipboard(message),\n\t\t\t\t\t\ttype: ButtonType.Secondary,\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t\tm(\n\t\t\t\t\t\".plr.selectable.pb.scroll.text-pre\",\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\theight: px(200),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tmessage,\n\t\t\t\t),\n\t\t\t],\n\t\t),\n\t]\n\n\treturn Dialog.message(\"unknownError_msg\", info)\n}\n\nexport async function sendFeedbackMail(content: FeedbackContent): Promise<void> {\n\tconst name = \"\"\n\tconst mailAddress = \"reports@tutao.de\"\n\t// We want to treat what we have as text, not as HTML so we escape it. This is an easy way to do it.\n\tconst escapedBody = new Option(content.message).innerHTML\n\tconst logins = locator.logins\n\tconst draft = await locator.mailFacade.createDraft({\n\t\tsubject: content.subject,\n\t\tbodyText: convertTextToHtml(escapedBody),\n\t\tsenderMailAddress: neverNull(logins.getUserController().userGroupInfo.mailAddress),\n\t\tsenderName: \"\",\n\t\ttoRecipients: [\n\t\t\t{\n\t\t\t\tname,\n\t\t\t\taddress: mailAddress,\n\t\t\t},\n\t\t],\n\t\tccRecipients: [],\n\t\tbccRecipients: [],\n\t\tconversationType: ConversationType.NEW,\n\t\tpreviousMessageId: null,\n\t\tattachments: content.logs,\n\t\tconfidential: true,\n\t\treplyTos: [],\n\t\tmethod: MailMethod.NONE,\n\t})\n\tawait locator.mailFacade.sendDraft(\n\t\tdraft,\n\t\t[\n\t\t\t{\n\t\t\t\tname,\n\t\t\t\taddress: mailAddress,\n\t\t\t\ttype: RecipientType.INTERNAL,\n\t\t\t\tcontact: null,\n\t\t\t},\n\t\t],\n\t\t\"de\",\n\t)\n}\n\nasync function sendToServer(error: ErrorInfo, userMessage: string | null, logs: DataFile[]) {\n\tfunction getReportingClientType(): ErrorReportClientType {\n\t\tif (env.mode === Mode.Browser) {\n\t\t\treturn ErrorReportClientType.Browser\n\t\t} else {\n\t\t\tswitch (env.platformId) {\n\t\t\t\tcase \"ios\":\n\t\t\t\t\treturn ErrorReportClientType.Ios\n\t\t\t\tcase \"android\":\n\t\t\t\t\treturn ErrorReportClientType.Android\n\t\t\t\tcase \"darwin\":\n\t\t\t\t\treturn ErrorReportClientType.MacOS\n\t\t\t\tcase \"linux\":\n\t\t\t\t\treturn ErrorReportClientType.Linux\n\t\t\t\tcase \"win32\":\n\t\t\t\t\treturn ErrorReportClientType.Windows\n\t\t\t\tdefault:\n\t\t\t\t\treturn ErrorReportClientType.Linux\n\t\t\t}\n\t\t}\n\t}\n\n\tconst clientType = getReportingClientType()\n\n\tconst errorData = createReportErrorIn({\n\t\tdata: createErrorReportData({\n\t\t\tclientType,\n\t\t\tappVersion: env.versionNumber,\n\t\t\tuserId: locator.logins.getUserController().userId,\n\t\t\terrorClass: error.name ?? \"?\",\n\t\t\terrorMessage: error.message,\n\t\t\tuserMessage: userMessage,\n\t\t\tstackTrace: error.stack ?? \"\",\n\t\t\tadditionalInfo: client.userAgent,\n\t\t\ttime: new Date(),\n\t\t}),\n\t\tfiles: logs.map((log) => {\n\t\t\tconst stringData = uint8ArrayToString(\"utf-8\", log.data)\n\t\t\treturn createErrorReportFile({\n\t\t\t\tname: log.name,\n\t\t\t\tcontent: stringData,\n\t\t\t})\n\t\t}),\n\t})\n\tawait locator.serviceExecutor.post(ReportErrorService, errorData)\n}\n\nfunction prepareFeedbackContent(error: ErrorInfo, loggedIn: boolean): FeedbackContent {\n\tconst timestamp = new Date()\n\tlet { message, client, type } = clientInfoString(timestamp, loggedIn)\n\n\tif (error) {\n\t\tmessage += errorToString(error)\n\t}\n\n\tconst subject = `Feedback v${env.versionNumber} - ${error && error.name ? error.name : \"?\"} - ${type} - ${client}`\n\treturn {\n\t\tmessage,\n\t\tsubject,\n\t\tlogs: [],\n\t}\n}\n\nexport function clientInfoString(\n\ttimestamp: Date,\n\tloggedIn: boolean,\n): {\n\tmessage: string\n\tclient: string\n\ttype: string\n} {\n\tconst type = loggedIn\n\t\t? neverNull(typedKeys(AccountType).find((typeName) => AccountType[typeName] === locator.logins.getUserController().user.accountType))\n\t\t: \"UNKNOWN\"\n\n\tconst client = (() => {\n\t\tswitch (env.mode) {\n\t\t\tcase Mode.Browser:\n\t\t\tcase Mode.Test:\n\t\t\t\treturn env.mode\n\t\t\tdefault:\n\t\t\t\treturn env.platformId ?? \"\"\n\t\t}\n\t})()\n\n\tlet message = `\\n\\n Client: ${client}`\n\tmessage += `\\n Type: ${type}`\n\tmessage += `\\n Tutanota version: ${env.versionNumber}`\n\tmessage += `\\n Timestamp (UTC): ${timestamp.toUTCString()}`\n\tmessage += `\\n User agent:\\n${navigator.userAgent}` + \"\\n\"\n\treturn {\n\t\tmessage,\n\t\tclient,\n\t\ttype,\n\t}\n}\n\nexport async function getLogAttachments(timestamp?: Date): Promise<Array<DataFile>> {\n\tconst logs: Array<DataFile> = []\n\tconst global = downcast<Window>(window)\n\n\tif (global.logger) {\n\t\tconst mainEntries = global.logger.getEntries()\n\t\tconst mainLogFile = createLogFile(mainEntries.join(\"\\n\"), \"main\", timestamp?.getTime())\n\t\tlogs.push(mainLogFile)\n\t\tconst workerLogEntries = await locator.workerFacade.getLog()\n\t\tconst workerLogFile = await createLogFile(workerLogEntries.join(\"\\n\"), \"worker\", timestamp?.getTime())\n\t\tlogs.push(workerLogFile)\n\t}\n\n\tif (isDesktop() || isApp()) {\n\t\tconst nativeLog = await locator.commonSystemFacade.getLog()\n\t\tconst nativeLogFile = createLogFile(nativeLog, isDesktop() ? \"desktop\" : \"device\", timestamp?.getTime())\n\t\tlogs.push(nativeLogFile)\n\t}\n\n\treturn logs\n}\n"],"mappings":"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"}