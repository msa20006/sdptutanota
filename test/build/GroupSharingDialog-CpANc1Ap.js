
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { __toESM } from "./chunk-D_5_n1c4.js";
import { mithril_default } from "./mithril-Csg4iNnm.js";
import { assert, assertNotNull, downcast, findAndRemove, neverNull, noOp, ofClass, pMap, remove } from "./dist-CJHwsXKY.js";
import "./dist-Rk9U8Iqn.js";
import { ProgrammingError } from "./ProgrammingError-D8yJGVtm.js";
import "./Env-D5xGlXfw.js";
import "./WhitelabelCustomizations-D1L5qbZi.js";
import { lang } from "./LanguageViewModel-BNC5ekpO.js";
import "./HtmlUtils-C-ecR7U7.js";
import "./ClientDetector-D0v6Vqu6.js";
import { OperationType, ShareCapability } from "./TutanotaConstants-3bwAESYA.js";
import { ButtonType } from "./Icon-BuqNK7vz.js";
import { Icons } from "./Icons-Dl3nFav5.js";
import "./KeyManager-B0OGXEyJ.js";
import "./WindowFacade-B9kSBKw7.js";
import "./Modal-g4c-b9IU.js";
import { Dialog, DialogType, DropDownSelector, TextField, getConfirmation } from "./Dialog-B6-HFvZd.js";
import "./CountryList-DkVQtcTj.js";
import "./IconButton-DsU60HJ_.js";
import { NotFoundError, PreconditionFailedError, TooManyRequestsError } from "./RestError-D17JEBMr.js";
import "./SuspensionError-okvIjE4H.js";
import "./LoginIncompleteError-CpiW0a0l.js";
import "./CryptoError-PqdvQky4.js";
import "./error-DDmy0eAT.js";
import "./ErrorUtils-o1-v67Dd.js";
import { RecipientsNotFoundError } from "./RecipientsNotFoundError-D8oGE7A_.js";
import "./OfflineDbClosedError-CAwHTI6J.js";
import "./OutOfSyncError-Ck2yBBO8.js";
import "./DbError-CcwZaPG2.js";
import "./QuotaExceededError-nFM6SdTn.js";
import "./CancelledError-FjP5S_cR.js";
import "./FileOpenError-C1_8yoXr.js";
import "./DeviceStorageUnavailableError-m4Jk_0xN.js";
import "./MailBodyTooLargeError-C2i0rX_0.js";
import "./ImportError-CIXw37Kv.js";
import "./PermissionError-BGDsHuAh.js";
import "./KeyPermanentlyInvalidatedError-DJjt81rl.js";
import "./ParserCombinator-D38ofgFx.js";
import "./ExportError-DzgStBnl.js";
import { require_stream } from "./stream-u2PttBAC.js";
import { getElementId, getEtId, isSameId } from "./EntityUtils-RQxXZlcV.js";
import { cleanMailAddress, findRecipientWithAddress } from "./CommonCalendarUtils-DKaO7v1K.js";
import "./Formatter-zB15D6XI.js";
import "./TypeModels-XIXYys8J.js";
import "./TypeRefs-CR3TLWn0.js";
import "./TypeModels-BktRFNDN.js";
import { GroupMemberTypeRef, GroupTypeRef, SentGroupInvitationTypeRef } from "./TypeRefs-BP1jvX9p.js";
import "./TypeModels-ZqCk-pGw.js";
import { isUpdateForTypeRef } from "./EntityUpdateUtils-B5iTKMk4.js";
import { getCapabilityText, getMemberCapability, getSharedGroupName, hasCapabilityOnGroup, isShareableGroupType, isSharedGroupOwner, loadGroupInfoForMember, loadGroupMembers } from "./GroupUtils-CpT2lvVS.js";
import { locator$1 as locator } from "./CommonLocator-Csg4iNnm.js";
import "./FormatValidator-2BBermUe.js";
import { UserError } from "./UserError-DfXlMLTl.js";
import "./MailAddressParser-BgYy6oyp.js";
import "./GroupUtils-0ZkLIAeC.js";
import "./DataFile-CY7uuk9j.js";
import "./FileUtils-W-u2-gZz.js";
import { showProgressDialog } from "./ProgressDialog-CJfJjh62.js";
import "./BlobUtils-D5ADcckZ.js";
import { getMailAddressDisplayText } from "./SharedMailUtils-AmFaSJP6.js";
import "./PasswordUtils-C4jlV9GF.js";
import { RecipientType } from "./Recipient-BFxhfecW.js";
import "./BirthdayUtils-BcCMglSq.js";
import "./ContactUtils-Bbon2oOk.js";
import { ResolveMode } from "./RecipientsModel-DxwXuUvL.js";
import "./SubscriptionDialogs-DAlWs68I.js";
import "./ToggleButton-DxuDa0rS.js";
import { MailRecipientsTextField } from "./MailRecipientsTextField-BmI2qlpf.js";
import "./SnackBar-CoP3lSVs.js";
import "./Credentials-BM35X_na.js";
import "./NotificationOverlay-C-YNCUiT.js";
import "./Checkbox-WCw-l_7A.js";
import "./Expander-Bautb1_0.js";
import "./ClipboardUtils-mz40UK5S.js";
import "./ErrorReporter-7sfLhWZg.js";
import "./Services-CupYet_j.js";
import "./BubbleButton-DGGInJMg.js";
import "./SessionType-rxSDsswH.js";
import "./PasswordField-CPKPoLq8.js";
import "./PasswordRequestDialog-B7ZIVTVw.js";
import { showUserError } from "./ErrorHandlerImpl-DRpk8tE9.js";
import { getTextsForGroupType, sendShareNotificationEmail } from "./GroupGuiUtils-DvJ2EOCj.js";
import "./InfoIcon-BCwidYvN.js";
import { ColumnWidth, Table } from "./Table-CTZm031N.js";

//#region ../src/common/sharing/model/GroupSharingModel.ts
var import_stream$1 = __toESM(require_stream(), 1);
var GroupSharingModel = class GroupSharingModel {
	info;
	group;
	memberInfos;
	sentGroupInvitations;
	eventController;
	entityClient;
	logins;
	onEntityUpdate;
	_mailFacade;
	_shareFacade;
	_groupManagementFacade;
	constructor(groupInfo, group, memberInfos, sentGroupInvitations, eventController, entityClient, logins, mailFacade, shareFacade, groupManagementFacade, recipientsModel) {
		this.recipientsModel = recipientsModel;
		this.info = groupInfo;
		this.group = group;
		this.memberInfos = memberInfos;
		this.sentGroupInvitations = sentGroupInvitations;
		this.eventController = eventController;
		this.entityClient = entityClient;
		this.logins = logins;
		this._mailFacade = mailFacade;
		this._shareFacade = shareFacade;
		this._groupManagementFacade = groupManagementFacade;
		this.onEntityUpdate = (0, import_stream$1.default)();
		this.eventController.addEntityListener(this.onEntityEvents);
	}
	onEntityEvents = (events, id) => this.entityEventsReceived(events, id);
	static newAsync(info, eventController, entityClient, logins, mailFacade, shareFacade, groupManagementFacade, recipientsModel) {
		return entityClient.load(GroupTypeRef, info.group).then((group) => Promise.all([entityClient.loadAll(SentGroupInvitationTypeRef, group.invitations), loadGroupMembers(group, entityClient)]).then(([sentGroupInvitations, memberInfos]) => new GroupSharingModel(info, group, memberInfos, sentGroupInvitations, eventController, entityClient, logins, mailFacade, shareFacade, groupManagementFacade, recipientsModel)));
	}
	dispose() {
		this.eventController.removeEntityListener(this.onEntityEvents);
	}
	/**
	* Whether or not a given member can be removed from the group by the current user
	*/
	canRemoveGroupMember(member) {
		return (hasCapabilityOnGroup(this.logins.getUserController().user, this.group, ShareCapability.Invite) || this.memberIsSelf(member)) && !isSharedGroupOwner(this.group, member.user);
	}
	removeGroupMember(member) {
		return this.canRemoveGroupMember(member) ? this._groupManagementFacade.removeUserFromGroup(member.user, getEtId(this.group)) : Promise.reject(new ProgrammingError("User does not have permission to remove this member from the group"));
	}
	/**
	* Whether or not a given invitation can be cancelled by the current user
	* @param group
	* @param sentGroupInvitation
	* @returns {boolean}
	*/
	canCancelInvitation(sentGroupInvitation) {
		return hasCapabilityOnGroup(this.logins.getUserController().user, this.group, ShareCapability.Invite) || isSharedGroupOwner(this.group, this.logins.getUserController().user._id);
	}
	memberIsSelf(member) {
		return isSameId(this.logins.getUserController().user._id, member.user);
	}
	cancelInvitation(invitation) {
		return this.canCancelInvitation(invitation) && invitation.receivedInvitation ? this._shareFacade.rejectOrCancelGroupInvitation(invitation.receivedInvitation) : Promise.reject(new Error("User does not have permission to cancel this invitation"));
	}
	async sendGroupInvitation(sharedGroupInfo, recipients, capability) {
		const externalRecipients = [];
		for (let recipient of recipients) {
			const resolved = await this.recipientsModel.resolve(recipient, ResolveMode.Eager).resolved();
			if (resolved.type !== RecipientType.INTERNAL) externalRecipients.push(resolved.address);
		}
		if (externalRecipients.length) throw new UserError(lang.makeTranslation("featureTutanotaOnly_msg", lang.get("featureTutanotaOnly_msg") + " " + lang.get("invalidRecipients_msg") + "\n" + externalRecipients.join("\n")));
		let groupInvitationReturn;
		try {
			groupInvitationReturn = await this._shareFacade.sendGroupInvitation(sharedGroupInfo, recipients.map((r) => r.address), capability);
		} catch (e) {
			if (e instanceof RecipientsNotFoundError) throw new UserError(lang.makeTranslation("tutanotaAddressDoesNotExist_msg", `${lang.get("tutanotaAddressDoesNotExist_msg")} ${lang.get("invalidRecipients_msg")}\n${e.message}`));
else throw e;
		}
		if (groupInvitationReturn.existingMailAddresses.length > 0 || groupInvitationReturn.invalidMailAddresses.length > 0) {
			const existingMailAddresses = groupInvitationReturn.existingMailAddresses.map((ma) => ma.address).join("\n");
			const invalidMailAddresses = groupInvitationReturn.invalidMailAddresses.map((ma) => ma.address).join("\n");
			let msg = "";
			msg += existingMailAddresses.length === 0 ? "" : lang.get("existingMailAddress_msg") + "\n" + existingMailAddresses;
			msg += existingMailAddresses.length === 0 && invalidMailAddresses.length === 0 ? "" : "\n\n";
			msg += invalidMailAddresses.length === 0 ? "" : lang.get("invalidMailAddress_msg") + "\n" + invalidMailAddresses;
			throw new UserError(lang.makeTranslation("group_invitation_err", msg));
		}
		return groupInvitationReturn.invitedMailAddresses;
	}
	entityEventsReceived(updates, eventOwnerGroupId) {
		return pMap(updates, (update) => {
			if (!isSameId(eventOwnerGroupId, getEtId(this.group))) return;
			if (isUpdateForTypeRef(SentGroupInvitationTypeRef, update)) {
				if (update.operation === OperationType.CREATE && isSameId(update.instanceListId, this.group.invitations)) return this.entityClient.load(SentGroupInvitationTypeRef, [update.instanceListId, update.instanceId]).then((instance) => {
					if (instance) {
						this.sentGroupInvitations.push(instance);
						this.onEntityUpdate();
					}
				}).catch(ofClass(NotFoundError, (e) => console.log("sent invitation not found", update)));
				if (update.operation === OperationType.DELETE) {
					findAndRemove(this.sentGroupInvitations, (sentGroupInvitation) => isSameId(getElementId(sentGroupInvitation), update.instanceId));
					this.onEntityUpdate();
				}
			} else if (isUpdateForTypeRef(GroupMemberTypeRef, update)) {
				console.log("update received in share dialog", update);
				if (update.operation === OperationType.CREATE && isSameId(update.instanceListId, this.group.members)) return this.entityClient.load(GroupMemberTypeRef, [update.instanceListId, update.instanceId]).then((instance) => {
					if (instance) return loadGroupInfoForMember(instance, this.entityClient).then((groupMemberInfo) => {
						console.log("new member", groupMemberInfo);
						this.memberInfos.push(groupMemberInfo);
						this.onEntityUpdate();
					});
				}).catch(ofClass(NotFoundError, (e) => console.log("group member not found", update)));
				if (update.operation === OperationType.DELETE) {
					findAndRemove(this.memberInfos, (memberInfo) => isSameId(getElementId(memberInfo.member), update.instanceId));
					this.onEntityUpdate();
				}
			}
		}).then(noOp);
	}
};

//#endregion
//#region ../src/common/sharing/view/GroupSharingDialog.ts
var import_stream = __toESM(require_stream(), 1);
async function showGroupSharingDialog(groupInfo, allowGroupNameOverride) {
	const groupType = downcast(assertNotNull(groupInfo.groupType));
	assert(isShareableGroupType(groupInfo.groupType), `Group type "${groupType}" must be shareable`);
	const texts = getTextsForGroupType(groupType);
	const recipientsModel = await locator.recipientsModel();
	showProgressDialog("loading_msg", GroupSharingModel.newAsync(groupInfo, locator.eventController, locator.entityClient, locator.logins, locator.mailFacade, locator.shareFacade, locator.groupManagementFacade, recipientsModel)).then((model) => {
		model.onEntityUpdate.map(mithril_default.redraw.bind(mithril_default));
		let dialog = Dialog.showActionDialog({
			title: "sharing_label",
			type: DialogType.EditMedium,
			child: () => mithril_default(GroupSharingDialogContent, {
				model,
				allowGroupNameOverride,
				texts,
				dialog
			}),
			okAction: null,
			cancelAction: () => model.dispose(),
			cancelActionTextId: "close_alt"
		});
	});
}
var GroupSharingDialogContent = class {
	view(vnode) {
		const { model, allowGroupNameOverride, texts, dialog } = vnode.attrs;
		const groupName = getSharedGroupName(model.info, model.logins.getUserController(), allowGroupNameOverride);
		return mithril_default(".flex.col.pt-s", [mithril_default(Table, {
			columnHeading: [lang.makeTranslation("column_heading", texts.participantsLabel(groupName))],
			columnWidths: [ColumnWidth.Largest, ColumnWidth.Largest],
			lines: this._renderMemberInfos(model, texts, groupName, dialog).concat(this._renderGroupInvitations(model, texts, groupName)),
			showActionButtonColumn: true,
			addButtonAttrs: hasCapabilityOnGroup(locator.logins.getUserController().user, model.group, ShareCapability.Invite) ? {
				title: "addParticipant_action",
				click: () => showAddParticipantDialog(model, texts),
				icon: Icons.Add
			} : null
		})]);
	}
	_renderGroupInvitations(model, texts, groupName) {
		return model.sentGroupInvitations.map((sentGroupInvitation) => {
			let iconBtn = {
				title: "remove_action",
				click: () => {
					getConfirmation(lang.makeTranslation("confirmation_msg", texts.removeMemberMessage(groupName, sentGroupInvitation.inviteeMailAddress))).confirmed(async () => {
						await model.cancelInvitation(sentGroupInvitation);
						mithril_default.redraw();
					});
				},
				icon: Icons.Cancel
			};
			return {
				cells: () => [{
					main: sentGroupInvitation.inviteeMailAddress,
					info: [`${lang.get("invited_label")}, ${getCapabilityText(downcast(sentGroupInvitation.capability))}`],
					mainStyle: ".i"
				}],
				actionButtonAttrs: model.canCancelInvitation(sentGroupInvitation) ? iconBtn : null
			};
		});
	}
	_renderMemberInfos(model, texts, groupName, dialog) {
		return model.memberInfos.map((memberInfo) => {
			return {
				cells: () => [{
					main: getMailAddressDisplayText(memberInfo.info.name, neverNull(memberInfo.info.mailAddress), false),
					info: [(isSharedGroupOwner(model.group, memberInfo.member.user) ? lang.get("owner_label") : lang.get("participant_label")) + ", " + getCapabilityText(getMemberCapability(memberInfo, model.group))]
				}],
				actionButtonAttrs: model.canRemoveGroupMember(memberInfo.member) ? {
					title: "delete_action",
					icon: Icons.Cancel,
					click: () => {
						getConfirmation(lang.makeTranslation("confirmation_msg", texts.removeMemberMessage(groupName, downcast(memberInfo.info.mailAddress)))).confirmed(async () => {
							await model.removeGroupMember(memberInfo.member);
							if (model.memberIsSelf(memberInfo.member)) dialog.close();
							mithril_default.redraw();
						});
					}
				} : null
			};
		});
	}
};
async function showAddParticipantDialog(model, texts) {
	const recipientsText = (0, import_stream.default)("");
	const recipients = [];
	const capability = (0, import_stream.default)(ShareCapability.Read);
	const realGroupName = getSharedGroupName(model.info, locator.logins.getUserController(), false);
	const customGroupName = getSharedGroupName(model.info, locator.logins.getUserController(), true);
	const search = await locator.recipientsSearchModel();
	const recipientsModel = await locator.recipientsModel();
	let dialog = Dialog.showActionDialog({
		type: DialogType.EditMedium,
		title: "addParticipant_action",
		child: () => [
			mithril_default(".rel", mithril_default(MailRecipientsTextField, {
				label: "shareWithEmailRecipient_label",
				text: recipientsText(),
				recipients,
				disabled: false,
				getRecipientClickedDropdownAttrs: async (address) => [{
					info: address,
					center: false,
					bold: false
				}, {
					label: "remove_action",
					type: ButtonType.Secondary,
					click: () => {
						const bubbleToRemove = findRecipientWithAddress(recipients, address);
						if (bubbleToRemove) remove(recipients, bubbleToRemove);
					}
				}],
				onRecipientAdded: (address, name, contact) => recipients.push(recipientsModel.resolve({
					address,
					name,
					contact
				}, ResolveMode.Eager).whenResolved(() => mithril_default.redraw())),
				onRecipientRemoved: (address) => findAndRemove(recipients, (recipient) => cleanMailAddress(recipient.address) === cleanMailAddress(address)),
				onTextChanged: recipientsText,
				search,
				maxSuggestionsToShow: 3
			})),
			mithril_default(DropDownSelector, {
				label: "permissions_label",
				items: [
					{
						name: getCapabilityText(ShareCapability.Invite),
						value: ShareCapability.Invite
					},
					{
						name: getCapabilityText(ShareCapability.Write),
						value: ShareCapability.Write
					},
					{
						name: getCapabilityText(ShareCapability.Read),
						value: ShareCapability.Read
					}
				],
				selectedValue: capability(),
				selectionChangedHandler: capability,
				dropdownWidth: 300
			}),
			mithril_default(TextField, {
				value: realGroupName,
				label: texts.groupNameLabel,
				isReadOnly: true,
				helpLabel: () => {
					return mithril_default("", customGroupName === realGroupName ? null : texts.yourCustomNameLabel(customGroupName));
				}
			}),
			mithril_default(".pt", texts.addMemberMessage(customGroupName || realGroupName))
		],
		okAction: async () => {
			if (recipients.length === 0) return Dialog.message("noRecipients_msg");
			const { checkPaidSubscription, showPlanUpgradeRequiredDialog } = await import("./SubscriptionDialogs-QAObqjg0.js");
			if (await checkPaidSubscription()) try {
				const invitedMailAddresses = await showProgressDialog("calendarInvitationProgress_msg", model.sendGroupInvitation(model.info, recipients, capability()));
				dialog.close();
				await sendShareNotificationEmail(model.info, invitedMailAddresses, texts);
			} catch (e) {
				if (e instanceof PreconditionFailedError) if (locator.logins.getUserController().isGlobalAdmin()) {
					const { getAvailablePlansWithSharing } = await import("./SubscriptionUtils-j-oFQxhJ.js");
					const plans = await getAvailablePlansWithSharing();
					await showPlanUpgradeRequiredDialog(plans);
				} else Dialog.message("contactAdmin_msg");
else if (e instanceof UserError) showUserError(e);
else if (e instanceof TooManyRequestsError) Dialog.message("tooManyAttempts_msg");
else throw e;
			}
		},
		okActionTextId: "invite_alt"
	}).setCloseHandler(() => {
		dialog.close();
	});
}

//#endregion
export { showGroupSharingDialog };
//# sourceMappingURL=GroupSharingDialog-CpANc1Ap.js.map