
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { defer, noOp } from "./dist-CJHwsXKY.js";
import "./dist-Rk9U8Iqn.js";
import "./ProgrammingError-D8yJGVtm.js";
import "./Env-D5xGlXfw.js";
import "./TutanotaConstants-3bwAESYA.js";
import { ResourceError } from "./RestError-D17JEBMr.js";
import "./SuspensionError-okvIjE4H.js";
import "./CryptoError-PqdvQky4.js";
import "./CancelledError-FjP5S_cR.js";
import "./EntityUtils-RQxXZlcV.js";
import "./TypeModels-XIXYys8J.js";
import "./TypeModels-BktRFNDN.js";
import { HttpMethod, MediaType } from "./EntityFunctions-l6CncM5C.js";
import "./TypeModels-ZqCk-pGw.js";
import "./ModelInfo-DEa-Yxv2.js";
import "./dist-DcZ1Y4qd.js";
import { RestClient, isSuspensionResponse } from "./RestClient-CmoHrId4.js";
import "./IndexTables-C5S9WDY9.js";
import "./IndexUtils-K27esrGs.js";
import "./IndexerCore-CrLYpsA5.js";
import { dist_default } from "./dist-Ci1bEzYU.js";
import "./testdouble-IbRSnrC0.js";
import "./dist-BY49f75m.js";
import { domainConfigStub } from "./TestUtils-f_4UhLVE.js";
import express from "express";
import bodyParser from "body-parser";

//#region tests/api/worker/rest/RestClientTest.ts
const SERVER_TIME_IN_HEADER = "Mon, 12 Jul 2021 13:18:39 GMT";
const SERVER_TIMESTAMP = 1626095919e3;
dist_default.spec("RestClient", function() {
	const suspensionHandlerMock = {
		activateSuspensionIfInactive: noOp,
		isSuspended: () => false,
		deferRequest: (request) => request()
	};
	const restClient = new RestClient(suspensionHandlerMock, domainConfigStub);
	dist_default.spec("integration tests", function() {
		let app = express();
		let server;
		let port;
		let baseUrl;
		dist_default.before(async function() {
			server = await new Promise((resolve) => {
				const s = app.listen(0, () => resolve(s));
			});
			port = server.address().port;
			baseUrl = `http://localhost:${port}`;
		});
		dist_default.after(async function() {
			const s = server;
			if (s) await new Promise((resolve) => s.close(function(err) {
				if (err) console.log(err);
				resolve();
			}));
		});
		dist_default("GET json", async function() {
			dist_default.timeout(400);
			let responseText = "{\"msg\":\"Hello Client\"}";
			app.get("/get/json", (req, res$1) => {
				dist_default(req.method).equals("GET");
				dist_default(req.headers["content-type"]).equals(undefined);
				dist_default(req.headers["accept"]).equals("application/json");
				res$1.send(responseText);
			});
			const res = await restClient.request("/get/json", HttpMethod.GET, {
				responseType: MediaType.Json,
				baseUrl
			});
			dist_default(res).equals(responseText);
		});
		dist_default("GET with body (converted to query parameter)", async function() {
			dist_default.timeout(200);
			let request = "{get: true}";
			const deferred = defer();
			app.get("/get/with-body", (req, res) => {
				dist_default(req.method).equals("GET");
				dist_default(req.query._body).equals(request);
				res.send();
				deferred.resolve();
			});
			restClient.request("/get/with-body", HttpMethod.GET, {
				body: request,
				responseType: MediaType.Json,
				baseUrl
			});
			await deferred.promise;
		});
		dist_default("GET binary", async function() {
			dist_default.timeout(200);
			let response = new Buffer([
				1,
				50,
				83,
				250
			]);
			app.get("/get/binary", (req, res$1) => {
				dist_default(req.method).equals("GET");
				dist_default(req.headers["content-type"]).equals(undefined);
				dist_default(req.headers["accept"]).equals("application/octet-stream");
				res$1.send(response);
			});
			const res = await restClient.request("/get/binary", HttpMethod.GET, {
				queryParams: {},
				responseType: MediaType.Binary,
				baseUrl
			});
			dist_default(res instanceof Uint8Array).equals(true);
			dist_default(Array.from(res)).deepEquals(Array.from(response));
		});
		dist_default("POST json", testJson("POST"));
		dist_default("PUT json", testJson("PUT"));
		dist_default("DELETE json", testJson("DELETE"));
		function testJson(method) {
			return async function() {
				dist_default.timeout(200);
				let requestText = "{\"msg\":\"Dear Server\"}";
				let responseText = "{\"msg\":\"Hello Client\"}";
				let url = "/" + method + "/json";
				app.use(bodyParser.json());
				app[method.toLowerCase()](url, (req, res$1) => {
					dist_default(req.method).equals(method);
					dist_default(req.headers["content-type"]).equals("application/json");
					dist_default(req.headers["accept"]).equals("application/json");
					dist_default(req.body).deepEquals(JSON.parse(requestText));
					dist_default(req.query["_"]).equals(undefined);
					res$1.send(responseText);
				});
				const res = await restClient.request(url, method, {
					body: requestText,
					responseType: MediaType.Json,
					baseUrl
				});
				dist_default(res).equals(responseText);
			};
		}
		dist_default("POST binary", testBinary("POST"));
		dist_default("PUT binary", testBinary("PUT"));
		dist_default("DELETE binary", testBinary("DELETE"));
		function testBinary(method) {
			return async function() {
				dist_default.timeout(200);
				let request = new Buffer([
					8,
					5,
					2,
					183
				]);
				let response = new Buffer([
					1,
					50,
					83,
					250
				]);
				let url = "/" + method + "/binary";
				app.use(bodyParser.raw());
				app[method.toLowerCase()](url, (req, res$1) => {
					dist_default(req.method).equals(method);
					dist_default(req.headers["content-type"]).equals("application/octet-stream");
					dist_default(req.headers["accept"]).equals("application/octet-stream");
					dist_default(Array.from(req.body)).deepEquals(Array.from(request));
					dist_default(req.query["_"]).equals(undefined);
					res$1.send(response);
				});
				const res = await restClient.request(url, method, {
					body: new Uint8Array(request),
					responseType: MediaType.Binary,
					baseUrl
				});
				dist_default(res instanceof Uint8Array).equals(true);
				dist_default(Array.from(res)).deepEquals(Array.from(response));
			};
		}
		dist_default.test("GET empty body", testEmptyBody("GET"));
		dist_default.test("POST empty body", testEmptyBody("POST"));
		dist_default.test("PUT empty body", testEmptyBody("PUT"));
		dist_default.test("DELETE empty body", testEmptyBody("DELETE"));
		function testEmptyBody(method) {
			return async function() {
				dist_default.timeout(200);
				let url = "/" + method + "/empty-body";
				app[method.toLowerCase()](url, (req, res$1) => {
					dist_default(req.headers["content-type"]).equals(undefined);
					dist_default(req.headers["accept"]).equals(undefined);
					res$1.set("Date", SERVER_TIME_IN_HEADER);
					res$1.send();
				});
				const res = await restClient.request(url, method, { baseUrl });
				dist_default(res).equals(null);
			};
		}
		dist_default("GET empty body error", testError("GET"));
		dist_default("POST empty body error", testError("POST"));
		dist_default("PUT empty body error", testError("PUT"));
		dist_default("DELETE empty body error", testError("DELETE"));
		function testError(method) {
			return async function() {
				let url = "/" + method + "/error";
				app[method.toLowerCase()](url, (req, res) => {
					res.set("Date", SERVER_TIME_IN_HEADER);
					res.status(205).send();
				});
				await dist_default(() => restClient.request(url, method, { baseUrl })).asyncThrows(ResourceError);
			};
		}
		dist_default("get time successful request", async () => {
			const test = testEmptyBody("GET");
			await test();
			const timestamp = restClient.getServerTimestampMs();
			dist_default(Math.abs(timestamp - SERVER_TIMESTAMP) < 10).equals(true)("Timestamp on the server was too different");
		});
		dist_default("get time error request", async () => {
			const test = testError("GET");
			await test();
			const timestamp = restClient.getServerTimestampMs();
			dist_default(Math.abs(timestamp - SERVER_TIMESTAMP) < 10).equals(true)("Timestamp on the server was too different");
		});
	});
	dist_default("isSuspensionResponse", () => {
		dist_default(isSuspensionResponse(503, "1")).equals(true);
		dist_default(isSuspensionResponse(429, "100")).equals(true);
		dist_default(isSuspensionResponse(0, "2")).equals(false);
		dist_default(isSuspensionResponse(503, "0")).equals(false);
		dist_default(isSuspensionResponse(503, null)).equals(false);
		dist_default(isSuspensionResponse(503, null)).equals(false);
	});
});

//#endregion
//# sourceMappingURL=RestClientTest-CxYRvl-k.js.map