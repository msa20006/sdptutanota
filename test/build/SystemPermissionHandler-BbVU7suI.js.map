{"version":3,"file":"SystemPermissionHandler-BbVU7suI.js","names":["systemFacade: MobileSystemFacade","permissions: PermissionType[]","permissionsStatus: Map<PermissionType, boolean>","permission: PermissionType","deniedMessage: TranslationKey"],"sources":["../../src/common/native/main/SystemPermissionHandler.ts"],"sourcesContent":["import { MobileSystemFacade } from \"../common/generatedipc/MobileSystemFacade.js\"\nimport { PermissionType } from \"../common/generatedipc/PermissionType.js\"\nimport { isIOSApp } from \"../../api/common/Env.js\"\nimport { TranslationKey } from \"../../misc/LanguageViewModel.js\"\nimport { PermissionError } from \"../../api/common/error/PermissionError.js\"\nimport { Dialog } from \"../../gui/base/Dialog.js\"\n\nexport class SystemPermissionHandler {\n\tconstructor(private readonly systemFacade: MobileSystemFacade) {}\n\n\tasync queryPermissionsState(permissions: PermissionType[]) {\n\t\tconst permissionsStatus: Map<PermissionType, boolean> = new Map()\n\n\t\tfor (const permission of permissions) {\n\t\t\tpermissionsStatus.set(permission, await this.hasPermission(permission))\n\t\t}\n\n\t\treturn permissionsStatus\n\t}\n\n\tasync hasPermission(permission: PermissionType): Promise<boolean> {\n\t\tif (permission === PermissionType.IgnoreBatteryOptimization && isIOSApp()) {\n\t\t\treturn true\n\t\t}\n\n\t\treturn await this.systemFacade.hasPermission(permission)\n\t}\n\n\tasync requestPermission(permission: PermissionType, deniedMessage: TranslationKey): Promise<boolean> {\n\t\ttry {\n\t\t\tawait this.systemFacade.requestPermission(permission)\n\t\t\treturn true\n\t\t} catch (e) {\n\t\t\tif (e instanceof PermissionError) {\n\t\t\t\tconsole.warn(\"Permission denied for\", permission)\n\t\t\t\tDialog.confirm(deniedMessage).then((confirmed) => {\n\t\t\t\t\tif (confirmed) {\n\t\t\t\t\t\tthis.systemFacade.goToSettings()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\treturn false\n\t\t\t}\n\t\t\tthrow e\n\t\t}\n\t}\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAOa,0BAAN,MAA8B;CACpC,YAA6BA,cAAkC;EAsC/D,KAtC6B;CAAoC;CAEjE,MAAM,sBAAsBC,aAA+B;EAC1D,MAAMC,oBAAkD,IAAI;AAE5D,OAAK,MAAM,cAAc,YACxB,mBAAkB,IAAI,YAAY,MAAM,KAAK,cAAc,WAAW,CAAC;AAGxE,SAAO;CACP;CAED,MAAM,cAAcC,YAA8C;AACjE,MAAI,eAAe,eAAe,6BAA6B,UAAU,CACxE,QAAO;AAGR,SAAO,MAAM,KAAK,aAAa,cAAc,WAAW;CACxD;CAED,MAAM,kBAAkBA,YAA4BC,eAAiD;AACpG,MAAI;AACH,SAAM,KAAK,aAAa,kBAAkB,WAAW;AACrD,UAAO;EACP,SAAQ,GAAG;AACX,OAAI,aAAa,iBAAiB;AACjC,YAAQ,KAAK,yBAAyB,WAAW;AACjD,WAAO,QAAQ,cAAc,CAAC,KAAK,CAAC,cAAc;AACjD,SAAI,UACH,MAAK,aAAa,cAAc;IAEjC,EAAC;AACF,WAAO;GACP;AACD,SAAM;EACN;CACD;AACD"}