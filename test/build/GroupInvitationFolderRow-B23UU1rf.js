
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { __toESM } from "./chunk-D_5_n1c4.js";
import { mithril_default } from "./mithril-Csg4iNnm.js";
import { assertNotNull, clamp, downcast, filterInt } from "./dist-CJHwsXKY.js";
import "./dist-Rk9U8Iqn.js";
import "./ProgrammingError-D8yJGVtm.js";
import "./Env-D5xGlXfw.js";
import "./WhitelabelCustomizations-D1L5qbZi.js";
import { lang } from "./LanguageViewModel-BNC5ekpO.js";
import { MAX_HUE_ANGLE, hexToHSL, hslToHex, isColorLight, isValidCSSHexColor, normalizeHueAngle, px, size, theme } from "./HtmlUtils-C-ecR7U7.js";
import { client } from "./ClientDetector-D0v6Vqu6.js";
import { GroupType, Keys, TabIndex } from "./TutanotaConstants-3bwAESYA.js";
import "./Icon-BuqNK7vz.js";
import { Icons } from "./Icons-Dl3nFav5.js";
import { isKeyPressed } from "./KeyManager-B0OGXEyJ.js";
import "./WindowFacade-B9kSBKw7.js";
import "./Modal-g4c-b9IU.js";
import { Dialog, TextField } from "./Dialog-B6-HFvZd.js";
import "./CountryList-DkVQtcTj.js";
import { IconButton } from "./IconButton-DsU60HJ_.js";
import "./RestError-D17JEBMr.js";
import "./SuspensionError-okvIjE4H.js";
import "./LoginIncompleteError-CpiW0a0l.js";
import "./CryptoError-PqdvQky4.js";
import "./error-DDmy0eAT.js";
import "./ErrorUtils-o1-v67Dd.js";
import "./RecipientsNotFoundError-D8oGE7A_.js";
import "./OfflineDbClosedError-CAwHTI6J.js";
import "./OutOfSyncError-Ck2yBBO8.js";
import "./DbError-CcwZaPG2.js";
import "./QuotaExceededError-nFM6SdTn.js";
import "./CancelledError-FjP5S_cR.js";
import "./FileOpenError-C1_8yoXr.js";
import "./DeviceStorageUnavailableError-m4Jk_0xN.js";
import "./MailBodyTooLargeError-C2i0rX_0.js";
import "./ImportError-CIXw37Kv.js";
import "./PermissionError-BGDsHuAh.js";
import "./KeyPermanentlyInvalidatedError-DJjt81rl.js";
import "./ParserCombinator-D38ofgFx.js";
import "./ExportError-DzgStBnl.js";
import { require_stream } from "./stream-u2PttBAC.js";
import { isSameId } from "./EntityUtils-RQxXZlcV.js";
import { serializeAlarmInterval } from "./CommonCalendarUtils-DKaO7v1K.js";
import "./Formatter-zB15D6XI.js";
import "./TypeModels-XIXYys8J.js";
import { createDefaultAlarmInfo, createGroupSettings } from "./TypeRefs-CR3TLWn0.js";
import "./TypeModels-BktRFNDN.js";
import "./TypeRefs-BP1jvX9p.js";
import { getCapabilityText, getDefaultGroupName, getInvitationGroupType, isTemplateGroup } from "./GroupUtils-CpT2lvVS.js";
import { locator$1 as locator } from "./CommonLocator-Csg4iNnm.js";
import "./FormatValidator-2BBermUe.js";
import "./MailAddressParser-BgYy6oyp.js";
import "./GroupUtils-0ZkLIAeC.js";
import "./DataFile-CY7uuk9j.js";
import "./FileUtils-W-u2-gZz.js";
import "./ProgressDialog-CJfJjh62.js";
import "./BlobUtils-D5ADcckZ.js";
import { getMailAddressDisplayText } from "./SharedMailUtils-AmFaSJP6.js";
import { ColorPickerModel } from "./ColorPickerModel-C1q3CWkL.js";
import { showPlanUpgradeRequiredDialog } from "./SubscriptionDialogs-DAlWs68I.js";
import { ExpanderButton, ExpanderPanel } from "./Expander-Bautb1_0.js";
import { LoginButton } from "./LoginButton-DzCRy0Yt.js";
import { getTextsForGroupType, sendAcceptNotificationEmail, sendRejectNotificationEmail } from "./GroupGuiUtils-DvJ2EOCj.js";

//#region ../src/common/gui/base/colorPicker/ColorPickerView.ts
const HUE_GRADIENT_BORDER_WIDTH = 1;
const HUE_GRADIENT_HEIGHT = 40;
var PaletteIndex = function(PaletteIndex$1) {
	PaletteIndex$1[PaletteIndex$1["defaultVariant"] = 2] = "defaultVariant";
	PaletteIndex$1[PaletteIndex$1["customVariant"] = -1] = "customVariant";
	return PaletteIndex$1;
}(PaletteIndex || {});
var ColorPickerView = class {
	palette = Array(ColorPickerModel.PALETTE_SIZE).fill(null);
	model = new ColorPickerModel(!isColorLight(theme.content_bg));
	selectedHueAngle = Math.floor(Math.random() * MAX_HUE_ANGLE);
	fallbackVariantIndex = PaletteIndex.defaultVariant;
	isAdvanced = false;
	customColorHex = "";
	huePickerDom = null;
	hueImgDom = null;
	hueSliderDom = null;
	hueWindowDom = null;
	constructor(vnode) {
		const { value: selectedColor, onselect } = vnode.attrs;
		if (selectedColor) {
			const { h, s, l } = hexToHSL(selectedColor);
			const variantIndex = this.model.getVariantIndexBySL(s, l);
			this.selectedHueAngle = variantIndex != null ? normalizeHueAngle(h - this.model.paletteSchema.hueShift[variantIndex]) : h;
			this.generatePalette();
			this.customColorHex = selectedColor;
			if (variantIndex != null) this.fallbackVariantIndex = variantIndex;
			this.isAdvanced = variantIndex == null || this.palette[variantIndex] !== selectedColor;
		} else {
			this.generatePalette();
			const defaultColor = assertNotNull(this.palette[PaletteIndex.defaultVariant], "no default palette color variant");
			this.customColorHex = defaultColor;
			onselect(defaultColor);
		}
	}
	view(vnode) {
		const attrs = vnode.attrs;
		return mithril_default(".color-picker", [
			this.renderHuePicker(attrs.onselect),
			mithril_default(".flex.wrap.full-width.items-center.justify-between.p0.plr-s", { style: {
				rowGap: px(size.vpad_xs),
				marginTop: px(12)
			} }, this.palette.map((color, i) => this.renderColorOption({
				color: assertNotNull(color, `palette color ${i} not generated`),
				index: i,
				selectedColor: attrs.value,
				onselect: attrs.onselect,
				className: i === 0 ? ".pr-vpad-s.mr-hpad-small" : undefined,
				style: i === 0 ? { borderRight: `2px solid ${theme.content_border}` } : undefined
			}))),
			mithril_default("", [mithril_default(ExpanderButton, {
				label: "advanced_label",
				expanded: this.isAdvanced,
				onExpandedChange: (expanded) => this.handleOnExpandedChange(expanded, attrs),
				style: { marginLeft: "auto" }
			}), mithril_default(ExpanderPanel, { expanded: this.isAdvanced }, this.renderCustomColorContainer(attrs))])
		]);
	}
	handleOnExpandedChange(expanded, attrs) {
		if (expanded && isValidCSSHexColor(this.customColorHex)) attrs.onselect(this.customColorHex);
else {
			let variantIndex = undefined;
			if (isValidCSSHexColor(this.customColorHex)) {
				const { s, l } = hexToHSL(this.customColorHex);
				variantIndex = this.model.getVariantIndexBySL(s, l);
			}
			const fallbackColor = assertNotNull(this.palette[variantIndex ?? this.fallbackVariantIndex], `no fallback color at [${variantIndex} ?? ${this.fallbackVariantIndex}]`);
			attrs.onselect(fallbackColor);
		}
		this.isAdvanced = expanded;
	}
	renderCustomColorContainer(attrs) {
		return mithril_default(".custom-color-container.flex.items-start.gap-hpad", [mithril_default("", [mithril_default(TextField, {
			value: this.customColorHex.replace("#", ""),
			label: "hexCode_label",
			oninput: (v) => this.handleCustomHexInput(v, attrs)
		}), !isValidCSSHexColor(this.customColorHex) && mithril_default(".small", lang.get("invalidInputFormat_msg"))]), this.renderColorOption({
			color: this.customColorHex,
			index: PaletteIndex.customVariant,
			selectedColor: attrs.value,
			onselect: (color) => {
				this.postionSliderOnHue(assertNotNull(this.hueImgDom), assertNotNull(this.hueSliderDom));
				attrs.onselect(color);
			},
			className: ".mt-m"
		})]);
	}
	handleCustomHexInput(inputValue, attrs) {
		const newValue = inputValue.trim().replaceAll("#", "").slice(0, 6);
		const hexCode = "#" + newValue;
		this.customColorHex = hexCode;
		if (!isValidCSSHexColor(hexCode)) {
			attrs.onselect(assertNotNull(this.palette[this.fallbackVariantIndex], `no fallback color at ${this.fallbackVariantIndex}`));
			return;
		}
		const { h, s, l } = hexToHSL(hexCode);
		const variantIndex = this.model.getVariantIndexBySL(s, l);
		if (variantIndex != null) this.fallbackVariantIndex = variantIndex;
		this.selectedHueAngle = variantIndex != null ? normalizeHueAngle(h - this.model.paletteSchema.hueShift[variantIndex]) : h;
		this.postionSliderOnHue(assertNotNull(this.hueImgDom), assertNotNull(this.hueSliderDom));
		this.generatePalette();
		attrs.onselect(hexCode);
	}
	renderColorOption(attrs) {
		const { color, index, selectedColor, className, style } = attrs;
		const isOptionSelected = color === selectedColor;
		let isColorValid = true;
		if (index === PaletteIndex.customVariant) isColorValid = isValidCSSHexColor(color);
		const handleSelection = () => {
			if (!isColorValid) return;
			if (index === PaletteIndex.customVariant && isColorValid) {
				const { h, s, l } = hexToHSL(color);
				const variantIndex = this.model.getVariantIndexBySL(s, l);
				this.selectedHueAngle = variantIndex != null ? normalizeHueAngle(h - this.model.paletteSchema.hueShift[variantIndex]) : h;
				this.generatePalette();
			} else {
				this.fallbackVariantIndex = index;
				this.customColorHex = color;
			}
			attrs.onselect(color);
		};
		return mithril_default(`.color-option${className ?? ""}`, {
			className: isOptionSelected ? "selected" : "",
			style
		}, mithril_default(".border-radius-m", { style: {
			padding: "1px",
			borderWidth: "2px",
			borderStyle: "solid",
			borderColor: isOptionSelected ? theme.content_button_selected : "transparent"
		} }, mithril_default(".border-radius", {
			tabIndex: TabIndex.Default,
			role: "radio",
			ariaLabel: index === PaletteIndex.customVariant ? lang.get("customColor_label") : `${lang.get("variant_label")} ${index}`,
			ariaChecked: isOptionSelected,
			style: {
				width: px(30),
				height: px(30),
				borderWidth: "1px",
				borderStyle: "solid",
				borderColor: isOptionSelected ? "transparent" : theme.content_border,
				backgroundColor: isColorValid ? color : theme.content_border
			},
			onkeydown: (e) => {
				if (isKeyPressed(e.key, Keys.SPACE)) {
					e.preventDefault();
					handleSelection();
				}
			},
			onclick: handleSelection
		})));
	}
	renderHuePicker(onselect) {
		const a11yHueShiftStep = 5;
		return mithril_default(".rel.overflow-hidden", {
			style: { position: "relative" },
			onkeydown: (e) => {
				e.preventDefault();
				const isRightMove = isKeyPressed(e.key, Keys.RIGHT);
				const isLeftMove = isKeyPressed(e.key, Keys.LEFT);
				const isStill = isLeftMove && isRightMove;
				if (!isStill && (isRightMove || isLeftMove)) {
					const step = e.shiftKey ? 1 : a11yHueShiftStep;
					let hueStep = isLeftMove ? -step : step;
					this.selectedHueAngle = normalizeHueAngle(this.selectedHueAngle + hueStep);
					this.postionSliderOnHue(assertNotNull(this.hueImgDom), assertNotNull(this.hueSliderDom));
					this.toggleHueWindow(true);
					this.generatePalette();
					if (!this.isAdvanced || !isValidCSSHexColor(this.customColorHex)) onselect(assertNotNull(this.palette[this.fallbackVariantIndex], `no fallback color at ${this.fallbackVariantIndex}`));
				}
			},
			onkeyup: () => this.toggleHueWindow(false),
			oncreate: (vnode) => {
				this.huePickerDom = vnode.dom;
			}
		}, [
			mithril_default("input.fill-absolute.no-hover", {
				type: "range",
				min: 0,
				max: MAX_HUE_ANGLE,
				step: a11yHueShiftStep,
				tabIndex: TabIndex.Default,
				role: "slider",
				ariaLabel: lang.get("hue_label"),
				style: { opacity: 0 },
				value: `${this.selectedHueAngle}`,
				oninput: (e) => {
					this.selectedHueAngle = filterInt(e.target.value);
					this.postionSliderOnHue(assertNotNull(this.hueImgDom), assertNotNull(this.hueSliderDom));
					this.generatePalette();
					if (!this.isAdvanced || !isValidCSSHexColor(this.customColorHex)) onselect(assertNotNull(this.palette[this.fallbackVariantIndex], `no fallback color at ${this.fallbackVariantIndex}`));
				}
			}),
			mithril_default(".full-width.border-radius.overflow-hidden", { style: {
				borderStyle: "solid",
				borderColor: theme.content_border,
				backgroundColor: theme.content_border,
				borderWidth: px(HUE_GRADIENT_BORDER_WIDTH),
				height: px(HUE_GRADIENT_HEIGHT)
			} }, mithril_default("img.block.full-width", {
				src: `${window.tutao.appState.prefixWithoutFile}/images/color-hue-picker/hue-gradient-${!isColorLight(theme.content_bg) ? "dark" : "light"}.png`,
				alt: "",
				draggable: false,
				style: { height: px(HUE_GRADIENT_HEIGHT) },
				oncreate: (vnode) => {
					this.hueImgDom = vnode.dom;
				},
				onupdate: (vnode) => {
					if (this.hueSliderDom != null && !this.hueSliderDom.style.left) {
						const hueImgDom = vnode.dom;
						this.postionSliderOnHue(hueImgDom, this.hueSliderDom);
					}
				},
				[client.isTouchSupported() ? "ontouchstart" : "onpointerdown"]: (e) => {
					const abortController = new AbortController();
					const hueImgDom = e.target;
					hueImgDom.addEventListener(client.isTouchSupported() ? "touchmove" : "pointermove", (e$1) => this.handleHueChange(e$1, hueImgDom), { signal: abortController.signal });
					const endListener = () => {
						abortController.abort();
						this.generatePalette();
						this.toggleHueWindow(false);
						if (!this.isAdvanced || !isValidCSSHexColor(this.customColorHex)) onselect(assertNotNull(this.palette[this.fallbackVariantIndex], `no fallback color at ${this.fallbackVariantIndex}`));
						mithril_default.redraw();
					};
					hueImgDom.addEventListener(client.isTouchSupported() ? "touchcancel" : "pointercancel", endListener, { signal: abortController.signal });
					document.addEventListener(client.isTouchSupported() ? "touchend" : "pointerup", endListener, { signal: abortController.signal });
					this.handleHueChange(e, hueImgDom);
					this.toggleHueWindow(true);
				}
			})),
			mithril_default(".abs", {
				style: {
					width: "0px",
					bottom: px(HUE_GRADIENT_BORDER_WIDTH)
				},
				oncreate: (vnode) => {
					this.hueSliderDom = vnode.dom;
				}
			}, [mithril_default(".border.circle", {
				style: {
					width: px(24),
					height: px(24),
					transform: "translateX(-50%)",
					backgroundColor: this.model.getHueWindowColor(this.selectedHueAngle) ?? theme.content_border
				},
				oncreate: (vnode) => {
					this.hueWindowDom = vnode.dom;
				}
			}), mithril_default("", { style: {
				width: px(2),
				height: px(HUE_GRADIENT_HEIGHT),
				transform: "translateX(-50%)",
				backgroundColor: theme.content_border
			} })])
		]);
	}
	toggleHueWindow(show) {
		assertNotNull(this.huePickerDom).style.overflow = show ? "visible" : "hidden";
	}
	postionSliderOnHue(hueImgDom, hueSliderDom) {
		const hueGradientWidth = hueImgDom.getBoundingClientRect().width;
		hueSliderDom.style.left = `${Math.floor(this.selectedHueAngle / MAX_HUE_ANGLE * hueGradientWidth) + HUE_GRADIENT_BORDER_WIDTH}px`;
		assertNotNull(this.hueWindowDom).style.backgroundColor = this.model.getHueWindowColor(this.selectedHueAngle);
	}
	handleHueChange = (e, hueImgDom) => {
		const hueImgDomRect = hueImgDom.getBoundingClientRect();
		const eClientX = "clientX" in e ? e.clientX : e.touches[0].clientX;
		const posX = clamp(eClientX - hueImgDomRect.left + HUE_GRADIENT_BORDER_WIDTH, HUE_GRADIENT_BORDER_WIDTH, hueImgDomRect.width);
		this.selectedHueAngle = Math.floor(posX / hueImgDomRect.width * MAX_HUE_ANGLE);
		if (this.hueSliderDom) this.hueSliderDom.style.left = `${posX}px`;
		if (this.hueWindowDom) this.hueWindowDom.style.backgroundColor = this.model.getHueWindowColor(this.selectedHueAngle);
	};
	generatePalette() {
		for (let i = 0; i < ColorPickerModel.PALETTE_SIZE; i++) this.palette[i] = hslToHex(this.model.getColor(this.selectedHueAngle, i));
	}
};

//#endregion
//#region ../src/common/sharing/view/ReceivedGroupInvitationDialog.ts
var import_stream = __toESM(require_stream(), 1);
function showGroupInvitationDialog(invitation) {
	const groupType = getInvitationGroupType(invitation);
	const texts = getTextsForGroupType(groupType);
	const userSettingsGroupRoot = locator.logins.getUserController().userSettingsGroupRoot;
	const existingGroupSettings = userSettingsGroupRoot.groupSettings.find((gc) => gc.group === invitation.sharedGroup);
	const color = existingGroupSettings ? "#" + existingGroupSettings.color : "";
	const colorStream = (0, import_stream.default)(color);
	const isDefaultGroupName = invitation.sharedGroupName === getDefaultGroupName(downcast(invitation.groupType));
	const nameStream = (0, import_stream.default)(isDefaultGroupName ? texts.sharedGroupDefaultCustomName(invitation) : invitation.sharedGroupName);
	const alarmsStream = (0, import_stream.default)([]);
	const isMember = locator.logins.getUserController().getCalendarMemberships().some((ms) => isSameId(ms.group, invitation.sharedGroup));
	let dialog;
	const onAcceptClicked = () => {
		checkCanAcceptGroupInvitation(invitation).then((canAccept) => {
			if (canAccept) acceptInvite(invitation, texts).then(() => {
				dialog.close();
				const newColor = colorStream().substring(1);
				const newName = nameStream();
				if (existingGroupSettings) {
					existingGroupSettings.color = newColor;
					existingGroupSettings.name = newName;
				} else {
					const groupSettings = createGroupSettings({
						group: invitation.sharedGroup,
						color: newColor,
						name: newName,
						defaultAlarmsList: alarmsStream().map((alarm) => createDefaultAlarmInfo({ trigger: serializeAlarmInterval(alarm) })),
						sourceUrl: null
					});
					userSettingsGroupRoot.groupSettings.push(groupSettings);
				}
				locator.entityClient.update(userSettingsGroupRoot);
			});
		});
	};
	dialog = Dialog.showActionDialog({
		title: "invitation_label",
		child: { view: () => mithril_default(".flex.col", [mithril_default(".mb", [
			mithril_default(".pt.selectable", isMember ? lang.getTranslationText(texts.alreadyGroupMemberMessage) : texts.receivedGroupInvitationMessage),
			mithril_default(TextField, {
				value: nameStream(),
				oninput: nameStream,
				label: texts.groupNameLabel
			}),
			mithril_default(TextField, {
				value: getMailAddressDisplayText(invitation.inviterName, invitation.inviterMailAddress, false),
				label: "sender_label",
				isReadOnly: true
			}),
			mithril_default(TextField, {
				value: invitation.inviteeMailAddress,
				label: "to_label",
				isReadOnly: true
			}),
			mithril_default(TextField, {
				value: getCapabilityText(downcast(invitation.capability)),
				label: "permissions_label",
				isReadOnly: true
			}),
			groupType === GroupType.Calendar ? renderCalendarGroupInvitationFields(invitation, colorStream, alarmsStream) : null
		]), isMember ? null : mithril_default(LoginButton, {
			label: "acceptInvitation_action",
			onclick: onAcceptClicked
		})]) },
		okActionTextId: "decline_action",
		okAction: (dialog$1) => {
			dialog$1.close();
			declineInvite(invitation, texts);
		},
		cancelActionTextId: "close_alt"
	});
}
/**
* Checks if the logged-in user is able to accept the group invitation.
* This is necessary because to be part of some kinds of groups you must have certain features.
* Currently, there are two kinds of group invitations:
* 1. Calendar: any paid account can accept invitations
* 2. Template: only accounts with the templates feature can accept invitations
* @param invitation
*/
async function checkCanAcceptGroupInvitation(invitation) {
	const SubscriptionDialogUtils = await import("./SubscriptionDialogs-QAObqjg0.js");
	const allowed = await SubscriptionDialogUtils.checkPaidSubscription();
	if (!allowed) return false;
	const planConfig = await locator.logins.getUserController().getPlanConfig();
	if (isTemplateGroup(getInvitationGroupType(invitation)) && !planConfig.templates) {
		const { getAvailablePlansWithTemplates } = await import("./SubscriptionUtils-j-oFQxhJ.js");
		const plans = await getAvailablePlansWithTemplates();
		return showPlanUpgradeRequiredDialog(plans);
	} else return true;
}
function renderCalendarGroupInvitationFields(invitation, selectedColourValue, alarmsStream) {
	let alarms = alarmsStream();
	return [mithril_default(".small.mt.mb-xs", lang.get("color_label")), mithril_default(ColorPickerView, {
		value: selectedColourValue(),
		onselect: selectedColourValue
	})];
}
function acceptInvite(invitation, texts) {
	return locator.shareFacade.acceptGroupInvitation(invitation).then(() => {
		sendAcceptNotificationEmail(invitation, texts);
	});
}
function declineInvite(invitation, texts) {
	return locator.shareFacade.rejectOrCancelGroupInvitation(invitation._id).then(() => {
		sendRejectNotificationEmail(invitation, texts);
	});
}

//#endregion
//#region ../src/common/sharing/view/GroupInvitationFolderRow.ts
var GroupInvitationFolderRow = class {
	view(vnode) {
		const { invitation, icon } = vnode.attrs;
		return [mithril_default(".folder-row.flex-start.plr-l", [mithril_default(".flex-v-center.flex-grow.button-height", { style: { "max-width": `calc(100% - ${size.button_height}px)` } }, [mithril_default(".b.text-ellipsis", { title: getCapabilityText(downcast(invitation.capability)) }, invitation.sharedGroupName), mithril_default(".small.text-ellipsis", { title: invitation.inviterMailAddress }, getMailAddressDisplayText(invitation.inviterName, invitation.inviterMailAddress, true))]), mithril_default(IconButton, {
			title: "show_action",
			click: () => showGroupInvitationDialog(invitation),
			icon: icon ?? Icons.Eye
		})])];
	}
};

//#endregion
export { GroupInvitationFolderRow };
//# sourceMappingURL=GroupInvitationFolderRow-B23UU1rf.js.map