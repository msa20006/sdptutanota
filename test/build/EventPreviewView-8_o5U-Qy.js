
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { mithril_default } from "./mithril-Csg4iNnm.js";
import { downcast, memoized } from "./dist-CJHwsXKY.js";
import { lang } from "./LanguageViewModel-BNC5ekpO.js";
import { theme } from "./HtmlUtils-C-ecR7U7.js";
import { CalendarAttendeeStatus, EndType, RepeatPeriod, getAttendeeStatus } from "./TutanotaConstants-3bwAESYA.js";
import { BootIcons, Icon, IconSize } from "./Icon-BuqNK7vz.js";
import { Icons } from "./Icons-Dl3nFav5.js";
import { pureComponent } from "./Dialog-B6-HFvZd.js";
import { hasError } from "./ErrorUtils-o1-v67Dd.js";
import { cleanMailAddress, findAttendeeInAddresses, isAllDayEvent } from "./CommonCalendarUtils-DKaO7v1K.js";
import { formatDateWithMonth } from "./Formatter-zB15D6XI.js";
import { createCalendarEventAttendee, createEncryptedMailAddress } from "./TypeRefs-CR3TLWn0.js";
import { getRepeatEndTimeForDisplay, getTimeZone } from "./CalendarUtils-C6jeYrj9.js";
import { createRepeatRuleFrequencyValues, formatEventDuration, getDisplayEventTitle, iconForAttendeeStatus } from "./CalendarGuiUtils-CkzhFM1K.js";
import { UpgradeRequiredError } from "./UpgradeRequiredError-CbZr7beN.js";
import { BannerButton } from "./BannerButton-BeplPQdI.js";
import { showPlanUpgradeRequiredDialog } from "./SubscriptionDialogs-DAlWs68I.js";
import { ExternalLink } from "./ExternalLink-rsCBSC7U.js";

//#region ../src/calendar-app/calendar/gui/eventpopup/EventPreviewView.ts
const ReplyButtons = pureComponent((participation) => {
	const colors = {
		borderColor: theme.content_button,
		color: theme.content_fg
	};
	const highlightColors = {
		borderColor: theme.content_accent,
		color: theme.content_accent
	};
	const makeStatusButtonAttrs = (status, text) => Object.assign({
		text,
		class: "width-min-content",
		click: async () => {
			try {
				await participation.setParticipation(status);
			} catch (e) {
				if (e instanceof UpgradeRequiredError) {
					const ordered = await showPlanUpgradeRequiredDialog(e.plans, e.message);
					if (!ordered) return;
					await participation.setParticipation(status);
				} else throw e;
			}
		}
	}, participation.ownAttendee.status === status ? highlightColors : colors);
	return mithril_default(".flex.col", [mithril_default(".small", lang.get("invitedToEvent_msg")), mithril_default(".flex.items-center.mt-s", [
		mithril_default(BannerButton, makeStatusButtonAttrs(CalendarAttendeeStatus.ACCEPTED, "yes_label")),
		mithril_default(BannerButton, makeStatusButtonAttrs(CalendarAttendeeStatus.TENTATIVE, "maybe_label")),
		mithril_default(BannerButton, makeStatusButtonAttrs(CalendarAttendeeStatus.DECLINED, "no_label"))
	])]);
});
var EventPreviewView = class {
	getLocationUrl;
	constructor() {
		this.getLocationUrl = memoized(getLocationUrl);
	}
	view(vnode) {
		const { event, sanitizedDescription, participation } = vnode.attrs;
		const attendees = prepareAttendees(event.attendees, event.organizer);
		const eventTitle = getDisplayEventTitle(event.summary);
		return mithril_default(".flex.col.smaller.scroll.visible-scrollbar", [
			this.renderRow(BootIcons.Calendar, [mithril_default("span.h3", eventTitle)]),
			this.renderRow(Icons.Time, [formatEventDuration(event, getTimeZone(), false), this.renderRepeatRule(event.repeatRule, isAllDayEvent(event))]),
			this.renderLocation(event.location),
			this.renderAttendeesSection(attendees, participation),
			this.renderAttendanceSection(event, attendees, participation),
			this.renderDescription(sanitizedDescription)
		]);
	}
	renderRow(headerIcon, children, isAlignedLeft) {
		return mithril_default(".flex.pb-s", { class: isAlignedLeft ? "items-start" : "items-center" }, [this.renderSectionIndicator(headerIcon, isAlignedLeft ? { marginTop: "2px" } : undefined), mithril_default(".selectable.text-break.full-width", children)]);
	}
	renderSectionIndicator(icon, style = {}) {
		return mithril_default(Icon, {
			icon,
			class: "pr",
			size: IconSize.Medium,
			style: Object.assign({
				fill: theme.content_button,
				display: "block"
			}, style)
		});
	}
	renderRepeatRule(rule, isAllDay) {
		if (rule == null) return null;
		const frequency = formatRepetitionFrequency(rule);
		if (frequency) return mithril_default("", frequency + formatRepetitionEnd(rule, isAllDay));
else return mithril_default("", lang.get("unknownRepetition_msg"));
	}
	renderLocation(location) {
		if (location == null || location.trim().length === 0) return null;
		return this.renderRow(Icons.Pin, [mithril_default(".text-ellipsis.selectable", mithril_default(ExternalLink, {
			href: this.getLocationUrl(location.trim()).toString(),
			text: location,
			isCompanySite: false
		}))]);
	}
	renderAttendeesSection(attendees, participation) {
		if (attendees.length === 0) return null;
		return this.renderRow(Icons.People, [mithril_default(".flex-wrap", attendees.map((a) => this.renderAttendee(a, participation)))], true);
	}
	/**
	* if we're an attendee of this event, this renders a selector to be able to set our own attendance.
	* @param event if the event is not in a calendar, we don't want to set our attendance from here.
	* @param attendees list of attendees (including the organizer)
	* @param participation
	* @private
	*/
	renderAttendanceSection(event, attendees, participation) {
		if (attendees.length === 0 || participation == null || event._ownerGroup == null) return null;
		return mithril_default(".flex.pb-s", [this.renderSectionIndicator(BootIcons.Contacts), mithril_default(ReplyButtons, participation)]);
	}
	renderAttendee(attendee, participation) {
		const attendeeField = hasError(attendee.address) ? lang.get("corruptedValue_msg") : attendee.address.address;
		/** we might have a more current local attendance for ourselves. */
		const status = participation != null && cleanMailAddress(attendee.address.address) === participation.ownAttendee.address.address ? getAttendeeStatus(participation.ownAttendee) : getAttendeeStatus(attendee);
		return mithril_default(".flex.items-center", [mithril_default(Icon, {
			icon: iconForAttendeeStatus[status],
			style: { fill: theme.content_fg },
			class: "mr-s"
		}), mithril_default(".span.line-break-anywhere.selectable", attendeeField)]);
	}
	renderDescription(sanitizedDescription) {
		if (sanitizedDescription == null || sanitizedDescription.length === 0) return null;
		return this.renderRow(Icons.AlignLeft, [mithril_default.trust(sanitizedDescription)], true);
	}
};
function getLocationUrl(text) {
	const osmHref = `https://www.openstreetmap.org/search?query=${text}`;
	let url;
	try {
		url = new URL(text);
	} catch {
		url = new URL(osmHref);
	}
	return url;
}
function formatRepetitionFrequency(repeatRule) {
	if (repeatRule.interval === "1") {
		const frequency = createRepeatRuleFrequencyValues().find((frequency$1) => frequency$1.value === repeatRule.frequency);
		if (frequency) return frequency.name;
	} else return lang.get("repetition_msg", {
		"{interval}": repeatRule.interval,
		"{timeUnit}": getFrequencyTimeUnit(downcast(repeatRule.frequency))
	});
	return null;
}
function formatRepetitionEnd(repeatRule, isAllDay) {
	switch (repeatRule.endType) {
		case EndType.Count:
			if (!repeatRule.endValue) return "";
			return ", " + lang.get("times_msg", { "{amount}": repeatRule.endValue });
		case EndType.UntilDate: {
			const repeatEndTime = getRepeatEndTimeForDisplay(repeatRule, isAllDay, getTimeZone());
			return " " + lang.get("until_label") + " " + formatDateWithMonth(repeatEndTime);
		}
		default: return "";
	}
}
function getFrequencyTimeUnit(frequency) {
	switch (frequency) {
		case RepeatPeriod.DAILY: return lang.get("days_label");
		case RepeatPeriod.WEEKLY: return lang.get("weeks_label");
		case RepeatPeriod.MONTHLY: return lang.get("pricing.months_label");
		case RepeatPeriod.ANNUALLY: return lang.get("years_label");
		default: throw new Error("Unknown calendar event repeat rule frequency: " + frequency);
	}
}
function prepareAttendees(attendees, organizer) {
	const attendeesCopy = attendees.slice();
	if (organizer != null && attendeesCopy.length > 0 && !findAttendeeInAddresses(attendeesCopy, [organizer.address])) attendeesCopy.unshift(createCalendarEventAttendee({
		address: createEncryptedMailAddress({
			address: organizer.address,
			name: ""
		}),
		status: CalendarAttendeeStatus.ADDED
	}));
	return attendeesCopy;
}

//#endregion
export { EventPreviewView, formatRepetitionEnd, formatRepetitionFrequency };
//# sourceMappingURL=EventPreviewView-8_o5U-Qy.js.map