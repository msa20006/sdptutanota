{"version":3,"file":"TakeOverDeletedAddressDialog-CvG2R-Cb.js","names":["mailAddress: string","password: string","e: Error"],"sources":["../../src/common/login/recover/TakeOverDeletedAddressDialog.ts"],"sourcesContent":["import m from \"mithril\"\nimport stream from \"mithril/stream\"\nimport { AccessBlockedError, AccessDeactivatedError, InvalidDataError, NotAuthenticatedError, TooManyRequestsError } from \"../../api/common/error/RestError\"\nimport { showProgressDialog } from \"../../gui/dialogs/ProgressDialog\"\nimport { isMailAddress } from \"../../misc/FormatValidator.js\"\nimport { InfoLink, lang } from \"../../misc/LanguageViewModel.js\"\nimport { Autocomplete, TextField, TextFieldType } from \"../../gui/base/TextField.js\"\nimport { Dialog, DialogType } from \"../../gui/base/Dialog\"\nimport { HtmlEditor, HtmlEditorMode } from \"../../gui/editor/HtmlEditor\"\nimport { locator } from \"../../api/main/CommonLocator\"\nimport { assertMainOrNode } from \"../../api/common/Env\"\nimport { MoreInfoLink } from \"../../misc/news/MoreInfoLink.js\"\n\nassertMainOrNode()\n\nexport function showTakeOverDialog(mailAddress: string, password: string): Dialog {\n\tconst targetAccountAddress = stream(\"\")\n\tconst editor = new HtmlEditor(\"recoveryCode_label\")\n\teditor.setMode(HtmlEditorMode.HTML)\n\teditor.setHtmlMonospace(true)\n\teditor.setMinHeight(80)\n\teditor.showBorders()\n\tconst takeoverDialog = Dialog.showActionDialog({\n\t\ttitle: \"help_label\",\n\t\ttype: DialogType.EditSmall,\n\t\tchild: {\n\t\t\tview: () => {\n\t\t\t\treturn [\n\t\t\t\t\tm(\".mt\", lang.get(\"takeOverUnusedAddress_msg\")),\n\t\t\t\t\tm(MoreInfoLink, { link: InfoLink.InactiveAccounts }),\n\t\t\t\t\tm(TextField, {\n\t\t\t\t\t\tlabel: \"targetAddress_label\",\n\t\t\t\t\t\tvalue: targetAccountAddress(),\n\t\t\t\t\t\tautocompleteAs: Autocomplete.email,\n\t\t\t\t\t\ttype: TextFieldType.Email,\n\t\t\t\t\t\toninput: targetAccountAddress,\n\t\t\t\t\t}),\n\t\t\t\t\tm(editor),\n\t\t\t\t]\n\t\t\t},\n\t\t},\n\t\tokAction: () => {\n\t\t\tconst cleanTargetAccountAddress = targetAccountAddress().trim().toLowerCase()\n\t\t\tconst cleanMailAddress = mailAddress.trim().toLowerCase()\n\t\t\tconst cleanRecoveryCode = editor.getValue().replace(/\\s/g, \"\").toLowerCase()\n\n\t\t\tif (!isMailAddress(cleanMailAddress, true)) {\n\t\t\t\tDialog.message(\"mailAddressInvalid_msg\")\n\t\t\t} else if (!isMailAddress(cleanTargetAccountAddress, true)) {\n\t\t\t\tDialog.message(\"mailAddressInvalid_msg\")\n\t\t\t} else {\n\t\t\t\tshowProgressDialog(\n\t\t\t\t\t\"pleaseWait_msg\",\n\t\t\t\t\tlocator.loginFacade.takeOverDeletedAddress(cleanMailAddress, password, cleanRecoveryCode, cleanTargetAccountAddress),\n\t\t\t\t)\n\t\t\t\t\t.then(() => Dialog.message(\"takeoverSuccess_msg\"))\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\ttakeoverDialog.close()\n\t\t\t\t\t\tm.route.set(\"/login\", {\n\t\t\t\t\t\t\tloginWith: cleanTargetAccountAddress,\n\t\t\t\t\t\t\tnoAutoLogin: true,\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t\t.catch((e) => handleError(e))\n\t\t\t}\n\t\t},\n\t\tcancelAction: () =>\n\t\t\tm.route.set(\"/login\", {\n\t\t\t\tnoAutoLogin: true,\n\t\t\t}),\n\t})\n\treturn takeoverDialog\n}\n\nfunction handleError(e: Error) {\n\tif (e instanceof NotAuthenticatedError) {\n\t\tDialog.message(\"loginFailed_msg\")\n\t} else if (e instanceof AccessBlockedError || e instanceof AccessDeactivatedError) {\n\t\tDialog.message(\"loginFailedOften_msg\")\n\t} else if (e instanceof InvalidDataError) {\n\t\tDialog.message(\"takeoverAccountInvalid_msg\")\n\t} else if (e instanceof TooManyRequestsError) {\n\t\tDialog.message(\"tooManyAttempts_msg\")\n\t} else {\n\t\tthrow e\n\t}\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAaA,kBAAkB;AAEX,SAAS,mBAAmBA,aAAqBC,UAA0B;CACjF,MAAM,uBAAuB,2BAAO,GAAG;CACvC,MAAM,SAAS,IAAI,WAAW;AAC9B,QAAO,QAAQ,eAAe,KAAK;AACnC,QAAO,iBAAiB,KAAK;AAC7B,QAAO,aAAa,GAAG;AACvB,QAAO,aAAa;CACpB,MAAM,iBAAiB,OAAO,iBAAiB;EAC9C,OAAO;EACP,MAAM,WAAW;EACjB,OAAO,EACN,MAAM,MAAM;AACX,UAAO;IACN,gBAAE,OAAO,KAAK,IAAI,4BAA4B,CAAC;IAC/C,gBAAE,cAAc,EAAE,MAAM,SAAS,iBAAkB,EAAC;IACpD,gBAAE,WAAW;KACZ,OAAO;KACP,OAAO,sBAAsB;KAC7B,gBAAgB,aAAa;KAC7B,MAAM,cAAc;KACpB,SAAS;IACT,EAAC;IACF,gBAAE,OAAO;GACT;EACD,EACD;EACD,UAAU,MAAM;GACf,MAAM,4BAA4B,sBAAsB,CAAC,MAAM,CAAC,aAAa;GAC7E,MAAM,mBAAmB,YAAY,MAAM,CAAC,aAAa;GACzD,MAAM,oBAAoB,OAAO,UAAU,CAAC,QAAQ,OAAO,GAAG,CAAC,aAAa;AAE5E,QAAK,cAAc,kBAAkB,KAAK,CACzC,QAAO,QAAQ,yBAAyB;UAC7B,cAAc,2BAA2B,KAAK,CACzD,QAAO,QAAQ,yBAAyB;IAExC,oBACC,kBACA,QAAQ,YAAY,uBAAuB,kBAAkB,UAAU,mBAAmB,0BAA0B,CACpH,CACC,KAAK,MAAM,OAAO,QAAQ,sBAAsB,CAAC,CACjD,KAAK,MAAM;AACX,mBAAe,OAAO;AACtB,oBAAE,MAAM,IAAI,UAAU;KACrB,WAAW;KACX,aAAa;IACb,EAAC;GACF,EAAC,CACD,MAAM,CAAC,MAAM,YAAY,EAAE,CAAC;EAE/B;EACD,cAAc,MACb,gBAAE,MAAM,IAAI,UAAU,EACrB,aAAa,KACb,EAAC;CACH,EAAC;AACF,QAAO;AACP;AAED,SAAS,YAAYC,GAAU;AAC9B,KAAI,aAAa,sBAChB,QAAO,QAAQ,kBAAkB;SACvB,aAAa,sBAAsB,aAAa,uBAC1D,QAAO,QAAQ,uBAAuB;SAC5B,aAAa,iBACvB,QAAO,QAAQ,6BAA6B;SAClC,aAAa,qBACvB,QAAO,QAAQ,sBAAsB;IAErC,OAAM;AAEP"}