
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { BoundedExecutor, LazyLoaded } from "./dist-CJHwsXKY.js";
import { cleanMailAddress } from "./CommonCalendarUtils-DKaO7v1K.js";
import { ContactTypeRef } from "./TypeRefs-CR3TLWn0.js";
import { createNewContact, isTutaMailAddress } from "./SharedMailUtils-AmFaSJP6.js";
import { RecipientType } from "./Recipient-BFxhfecW.js";
import { getContactDisplayName } from "./ContactUtils-Bbon2oOk.js";

//#region ../src/common/api/main/RecipientsModel.ts
let ResolveMode = function(ResolveMode$1) {
	ResolveMode$1[ResolveMode$1["Lazy"] = 0] = "Lazy";
	ResolveMode$1[ResolveMode$1["Eager"] = 1] = "Eager";
	return ResolveMode$1;
}({});
var RecipientsModel = class {
	executor = new BoundedExecutor(5);
	constructor(contactModel, loginController, mailFacade, entityClient) {
		this.contactModel = contactModel;
		this.loginController = loginController;
		this.mailFacade = mailFacade;
		this.entityClient = entityClient;
	}
	/**
	* Start resolving a recipient
	* If resolveLazily === true, Then resolution will not be initiated (i.e. no server calls will be made) until the first call to `resolved`
	*/
	resolve(recipient, resolveMode) {
		return new ResolvableRecipientImpl(recipient, this.contactModel, this.loginController, (mailAddress) => this.executor.run(this.resolveRecipientType(mailAddress)), this.entityClient, resolveMode);
	}
	resolveRecipientType = (mailAddress) => async () => {
		const keyData = await this.mailFacade.getRecipientKeyData(mailAddress);
		return keyData == null ? RecipientType.EXTERNAL : RecipientType.INTERNAL;
	};
};
var ResolvableRecipientImpl = class {
	_address;
	_name;
	lazyType;
	lazyContact;
	initialType = RecipientType.UNKNOWN;
	initialContact = null;
	overrideContact = null;
	get address() {
		return this._address;
	}
	get name() {
		return this._name ?? "";
	}
	get type() {
		return this.lazyType.getSync() ?? this.initialType;
	}
	get contact() {
		return this.lazyContact.getSync() ?? this.initialContact;
	}
	constructor(arg, contactModel, loginController, typeResolver, entityClient, resolveMode) {
		this.contactModel = contactModel;
		this.loginController = loginController;
		this.typeResolver = typeResolver;
		this.entityClient = entityClient;
		if (isTutaMailAddress(arg.address) || arg.type === RecipientType.INTERNAL) {
			this.initialType = RecipientType.INTERNAL;
			this._address = cleanMailAddress(arg.address);
		} else if (arg.type) {
			this.initialType = arg.type;
			this._address = arg.address;
		} else this._address = arg.address;
		this._name = arg.name ?? null;
		if (!(arg.contact instanceof Array)) this.initialContact = arg.contact ?? null;
		this.lazyType = new LazyLoaded(() => this.resolveType());
		this.lazyContact = new LazyLoaded(async () => {
			const contact = await this.resolveContact(arg.contact);
			if (contact != null && (this._name == null || this._name === "")) this._name = getContactDisplayName(contact);
			return contact;
		});
		if (resolveMode === ResolveMode.Eager) {
			this.lazyType.load();
			this.lazyContact.load();
		}
	}
	setName(newName) {
		this._name = newName;
	}
	setContact(newContact) {
		this.overrideContact = newContact;
		this.lazyContact.reload();
	}
	async resolved() {
		await Promise.all([this.lazyType.getAsync(), this.lazyContact.getAsync()]);
		return {
			address: this.address,
			name: this.name,
			type: this.type,
			contact: this.contact
		};
	}
	isResolved() {
		return this.lazyType.isLoaded() && this.lazyContact.isLoaded();
	}
	whenResolved(handler) {
		this.resolved().then(handler);
		return this;
	}
	/**
	* Determine whether recipient is INTERNAL or EXTERNAL based on the existence of key data (external recipients don't have any)
	*/
	async resolveType() {
		if (this.initialType === RecipientType.UNKNOWN) {
			const cleanedAddress = cleanMailAddress(this.address);
			const recipientType = await this.typeResolver(cleanedAddress);
			if (recipientType === RecipientType.INTERNAL) this._address = cleanedAddress;
			return recipientType;
		} else return this.initialType;
	}
	/**
	* Resolve the recipients contact.
	* If {@param contact} is an Id, the contact will be loaded directly
	* Otherwise, the contact will be searched for in the ContactModel
	*/
	async resolveContact(contact) {
		try {
			if (this.overrideContact) return this.overrideContact;
else if (await this.contactModel.getContactListId() == null) {
				console.log("can't resolve contacts for users with no contact list id");
				return null;
			} else if (contact instanceof Array) return await this.entityClient.load(ContactTypeRef, contact);
else if (contact == null) {
				const foundContact = await this.contactModel.searchForContact(this.address);
				if (foundContact) return foundContact;
else {
					await this.lazyType;
					return createNewContact(this.loginController.getUserController().user, this.address, this.name);
				}
			} else return contact;
		} catch (e) {
			console.log("error resolving contact", e);
			return null;
		}
	}
};

//#endregion
export { RecipientsModel, ResolveMode };
//# sourceMappingURL=RecipientsModel-DxwXuUvL.js.map