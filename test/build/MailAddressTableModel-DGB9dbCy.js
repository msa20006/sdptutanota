
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { assertNotNull, lazyMemoized } from "./dist-CJHwsXKY.js";
import { OperationType } from "./TutanotaConstants-3bwAESYA.js";
import { LimitReachedError } from "./RestError-D17JEBMr.js";
import { MailboxPropertiesTypeRef } from "./TypeRefs-CR3TLWn0.js";
import { GroupInfoTypeRef } from "./TypeRefs-BP1jvX9p.js";
import { isUpdateFor, isUpdateForTypeRef } from "./EntityUpdateUtils-B5iTKMk4.js";
import { UserError } from "./UserError-DfXlMLTl.js";
import { isTutaMailAddress } from "./SharedMailUtils-AmFaSJP6.js";
import { UpgradeRequiredError } from "./UpgradeRequiredError-CbZr7beN.js";
import { getAvailableMatchingPlans } from "./SubscriptionUtils-D0qLWHbE.js";
import { getAvailableDomains } from "./MailAddressesUtils-yYLKhrr9.js";

//#region ../src/common/settings/mailaddress/MailAddressTableModel.ts
let AddressStatus = function(AddressStatus$1) {
	AddressStatus$1[AddressStatus$1["Primary"] = 0] = "Primary";
	AddressStatus$1[AddressStatus$1["Alias"] = 1] = "Alias";
	AddressStatus$1[AddressStatus$1["DisabledAlias"] = 2] = "DisabledAlias";
	AddressStatus$1[AddressStatus$1["Custom"] = 3] = "Custom";
	return AddressStatus$1;
}({});
var MailAddressTableModel = class {
	nameMappings = null;
	onLegacyPlan = false;
	aliasCount = null;
	init = lazyMemoized(async () => {
		this.eventController.addEntityListener(this.entityEventsReceived);
		const userController = this.logins.getUserController();
		this.onLegacyPlan = userController.isLegacyPlan(await userController.getPlanType());
		await this.loadNames();
		this.redraw();
		await this.loadAliasCount();
		this.redraw();
	});
	constructor(entityClient, serviceExecutor, mailAddressFacade, logins, eventController, userGroupInfo, nameChanger, redraw) {
		this.entityClient = entityClient;
		this.serviceExecutor = serviceExecutor;
		this.mailAddressFacade = mailAddressFacade;
		this.logins = logins;
		this.eventController = eventController;
		this.userGroupInfo = userGroupInfo;
		this.nameChanger = nameChanger;
		this.redraw = redraw;
	}
	dispose() {
		this.eventController.removeEntityListener(this.entityEventsReceived);
	}
	userCanModifyAliases() {
		return this.logins.getUserController().isGlobalAdmin();
	}
	aliasLimitIncludesCustomDomains() {
		return this.onLegacyPlan;
	}
	addresses() {
		const { nameMappings } = this;
		if (nameMappings == null) return [];
		const primaryAddress = assertNotNull(this.userGroupInfo.mailAddress);
		const primaryAddressInfo = {
			name: nameMappings.get(primaryAddress) ?? "",
			address: primaryAddress,
			status: AddressStatus.Primary
		};
		const aliasesInfo = this.userGroupInfo.mailAddressAliases.slice().sort((a, b) => a.mailAddress > b.mailAddress ? 1 : -1).map(({ mailAddress, enabled }) => {
			const status = isTutaMailAddress(mailAddress) ? enabled ? AddressStatus.Alias : AddressStatus.DisabledAlias : AddressStatus.Custom;
			return {
				name: nameMappings.get(mailAddress) ?? "",
				address: mailAddress,
				status
			};
		});
		return [primaryAddressInfo, ...aliasesInfo];
	}
	async setAliasName(address, senderName) {
		this.nameMappings = await this.nameChanger.setSenderName(address, senderName);
		this.redraw();
	}
	/**
	* Add an alias.
	* @throws if an error occurred, such as a LimitReachedError if too many aliases were added
	*/
	async addAlias(alias, senderName) {
		try {
			await this.mailAddressFacade.addMailAlias(this.userGroupInfo.group, alias);
			await this.setAliasName(alias, senderName);
		} catch (e) {
			if (e instanceof LimitReachedError) await this.handleTooManyAliases();
			throw e;
		}
	}
	getAvailableDomains() {
		return getAvailableDomains(this.logins);
	}
	async setAliasStatus(address, restore) {
		await this.mailAddressFacade.setMailAliasStatus(this.userGroupInfo.group, address, restore);
		this.redraw();
		this.nameMappings = await this.nameChanger.removeSenderName(address);
		this.redraw();
	}
	defaultSenderName() {
		return this.userGroupInfo.name;
	}
	entityEventsReceived = async (updates) => {
		for (const update of updates) if (isUpdateForTypeRef(MailboxPropertiesTypeRef, update) && update.operation === OperationType.UPDATE) await this.loadNames();
else if (isUpdateFor(this.userGroupInfo, update) && update.operation === OperationType.UPDATE) {
			this.userGroupInfo = await this.entityClient.load(GroupInfoTypeRef, this.userGroupInfo._id);
			await this.loadAliasCount();
		}
		this.redraw();
	};
	async loadNames() {
		this.nameMappings = await this.nameChanger.getSenderNames();
	}
	async loadAliasCount() {
		this.aliasCount = await this.mailAddressFacade.getAliasCounters(this.userGroupInfo.group);
	}
	/**
	* Chooses the correct error to throw.
	* @throws UpgradeRequiredError if the customer can upgrade to a plan with more aliases
	* @throws UserError if the customer cannot add more aliases
	*/
	async handleTooManyAliases() {
		const plansWithMoreAliases = await getAvailableMatchingPlans(this.serviceExecutor, (config) => Number(config.nbrOfAliases) > this.userGroupInfo.mailAddressAliases.length);
		if (plansWithMoreAliases.length > 0) throw new UpgradeRequiredError("moreAliasesRequired_msg", plansWithMoreAliases);
else throw new UserError("adminMaxNbrOfAliasesReached_msg");
	}
};

//#endregion
export { AddressStatus, MailAddressTableModel };
//# sourceMappingURL=MailAddressTableModel-DGB9dbCy.js.map