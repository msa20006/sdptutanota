
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { ProgrammingError } from "./ProgrammingError-D8yJGVtm.js";
import { assertWorkerOrNode, isMainOrNode } from "./Env-D5xGlXfw.js";
import { NotAuthenticatedError } from "./RestError-D17JEBMr.js";
import { CryptoError } from "./CryptoError-PqdvQky4.js";
import { random } from "./dist-DcZ1Y4qd.js";
import { WebWorkerTransport, exposeLocalDelayed, exposeRemote } from "./EntityRestClient--6dT7ZRF.js";
import { MessageDispatcher, Request, errorToObj } from "./MessageDispatcher-wJwFhXWv.js";
import { initLocator, locator, resetLocator } from "./WorkerLocator-vHg_-eJs.js";

//#region ../src/mail-app/workerUtils/worker/WorkerImpl.ts
assertWorkerOrNode();
var WorkerImpl = class {
	_scope;
	_dispatcher;
	constructor(self) {
		this._scope = self;
		this._dispatcher = new MessageDispatcher(new WebWorkerTransport(this._scope), this.queueCommands(this.exposedInterface), "worker-main");
	}
	async init(browserData) {
		await initLocator(this, browserData);
		const workerScope = this._scope;
		if (workerScope && !isMainOrNode()) {
			workerScope.addEventListener("unhandledrejection", (event) => {
				this.sendError(event.reason);
			});
			workerScope.onerror = (e, source, lineno, colno, error) => {
				console.error("workerImpl.onerror", e, source, lineno, colno, error);
				if (error instanceof Error) this.sendError(error);
else {
					const err = new Error(e);
					err.lineNumber = lineno;
					err.columnNumber = colno;
					err.fileName = source;
					this.sendError(err);
				}
				return true;
			};
		}
	}
	get exposedInterface() {
		return {
			async loginFacade() {
				return locator.login;
			},
			async customerFacade() {
				return locator.customer();
			},
			async giftCardFacade() {
				return locator.giftCards();
			},
			async groupManagementFacade() {
				return locator.groupManagement();
			},
			async configFacade() {
				return locator.configFacade();
			},
			async calendarFacade() {
				return locator.calendar();
			},
			async mailFacade() {
				return locator.mail();
			},
			async shareFacade() {
				return locator.share();
			},
			async cacheManagementFacade() {
				return locator.cacheManagement();
			},
			async counterFacade() {
				return locator.counters();
			},
			async indexerFacade() {
				return locator.indexer();
			},
			async searchFacade() {
				return locator.search();
			},
			async bookingFacade() {
				return locator.booking();
			},
			async mailAddressFacade() {
				return locator.mailAddress();
			},
			async blobAccessTokenFacade() {
				return locator.blobAccessToken;
			},
			async blobFacade() {
				return locator.blob();
			},
			async userManagementFacade() {
				return locator.userManagement();
			},
			async recoverCodeFacade() {
				return locator.recoverCode();
			},
			async restInterface() {
				return locator.cache;
			},
			async serviceExecutor() {
				return locator.serviceExecutor;
			},
			async cryptoWrapper() {
				return locator.cryptoWrapper;
			},
			async asymmetricCryptoFacade() {
				return locator.asymmetricCrypto;
			},
			async cryptoFacade() {
				return locator.crypto;
			},
			async cacheStorage() {
				return locator.cacheStorage;
			},
			async sqlCipherFacade() {
				return locator.sqlCipherFacade;
			},
			async random() {
				return { async generateRandomNumber(nbrOfBytes) {
					return random.generateRandomNumber(nbrOfBytes);
				} };
			},
			async eventBus() {
				return locator.eventBusClient;
			},
			async entropyFacade() {
				return locator.entropyFacade;
			},
			async workerFacade() {
				return locator.workerFacade;
			},
			async contactFacade() {
				return locator.contactFacade();
			},
			async bulkMailLoader() {
				return locator.bulkMailLoader();
			},
			async mailExportFacade() {
				return locator.mailExportFacade();
			}
		};
	}
	queueCommands(exposedWorker) {
		return {
			setup: async (message) => {
				console.error("WorkerImpl: setup was called after bootstrap! message: ", message);
			},
			testEcho: (message) => Promise.resolve({ msg: ">>> " + message.args[0].msg }),
			testError: (message) => {
				const errorTypes = {
					ProgrammingError,
					CryptoError,
					NotAuthenticatedError
				};
				let ErrorType = errorTypes[message.args[0].errorType];
				return Promise.reject(new ErrorType(`wtf: ${message.args[0].errorType}`));
			},
			reset: (message) => {
				return resetLocator();
			},
			restRequest: (message) => {
				const args = message.args;
				let [path, method, options] = args;
				options = options ?? {};
				options.headers = {
					...locator.user.createAuthHeaders(),
					...options.headers
				};
				return locator.restClient.request(path, method, options);
			},
			facade: exposeLocalDelayed(exposedWorker)
		};
	}
	invokeNative(requestType, args) {
		return this._dispatcher.postRequest(new Request("execNative", [requestType, args]));
	}
	getMainInterface() {
		return exposeRemote((request) => this._dispatcher.postRequest(request));
	}
	sendError(e) {
		return this._dispatcher.postRequest(new Request("error", [errorToObj(e)]));
	}
};

//#endregion
export { WorkerImpl };
//# sourceMappingURL=WorkerImpl-DIBtyULv.js.map