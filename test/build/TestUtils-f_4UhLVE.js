
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { __toESM } from "./chunk-D_5_n1c4.js";
import { assertNotNull, deepEqual, defer } from "./dist-CJHwsXKY.js";
import { Cardinality, ValueType, create } from "./EntityUtils-RQxXZlcV.js";
import { typeModels } from "./EntityFunctions-l6CncM5C.js";
import { aes256RandomKey, fixedIv, uint8ArrayToKey } from "./dist-DcZ1Y4qd.js";
import { IndexerCore } from "./IndexerCore-CrLYpsA5.js";
import { require_testdouble } from "./testdouble-IbRSnrC0.js";
import { mock } from "./dist-BY49f75m.js";

//#region tests/TestUtils.ts
var import_testdouble = __toESM(require_testdouble(), 1);
const browserDataStub = {
	needsMicrotaskHack: false,
	needsExplicitIDBIds: false,
	indexedDbSupported: true
};
function makeCore(args, mocker) {
	const safeArgs = args ?? {};
	const { transaction } = safeArgs;
	const defaultDb = {
		key: aes256RandomKey(),
		iv: fixedIv,
		dbFacade: { createTransaction: () => Promise.resolve(transaction) },
		initialized: Promise.resolve()
	};
	const defaultQueue = {};
	const { db, queue, browserData } = {
		...{
			db: defaultDb,
			browserData: browserDataStub,
			queue: defaultQueue
		},
		...safeArgs
	};
	const core = new IndexerCore(db, queue, browserData);
	if (mocker) mock(core, mocker);
	return core;
}
function makeKeyStoreFacade(uint8ArrayKey) {
	const o = (0, import_testdouble.object)();
	(0, import_testdouble.when)(o.getDeviceKey()).thenResolve(uint8ArrayToKey(uint8ArrayKey));
	(0, import_testdouble.when)(o.getKeyChainKey()).thenResolve(uint8ArrayToKey(uint8ArrayKey));
	return o;
}
var SchedulerMock = class {
	alarmId = 0;
	/** key is the time */
	scheduledAt = new Map();
	scheduledAfter = new Map();
	cancelledAt = new Set();
	scheduledPeriodic = new Map();
	cancelledPeriodic = new Set();
	scheduleAt(callback, date) {
		const id = this._incAlarmId();
		this.scheduledAt.set(date.getTime(), {
			id,
			thunk: callback
		});
		return id;
	}
	getThunkAt(time) {
		return assertNotNull(this.scheduledAt.get(time), "No thunk scheduled at " + time).thunk;
	}
	getThunkAfter(time) {
		return assertNotNull(this.scheduledAfter.get(time), "No thunk scheduled after " + time).thunk;
	}
	scheduleAfter(thunk, after) {
		const id = this._incAlarmId();
		this.scheduledAfter.set(after, {
			id,
			thunk
		});
		return id;
	}
	unscheduleTimeout(id) {
		this.cancelledAt.add(id);
	}
	schedulePeriodic(thunk, period) {
		const id = this._incAlarmId();
		this.scheduledPeriodic.set(period, {
			id,
			thunk
		});
		return id;
	}
	getThunkPeriodic(period) {
		return assertNotNull(this.scheduledPeriodic.get(period), "No thunk scheduled each " + period).thunk;
	}
	getAllPeriodThunks() {
		return Array.from(this.scheduledPeriodic.values()).map((idThunk) => idThunk.thunk);
	}
	unschedulePeriodic(id) {
		this.cancelledPeriodic.add(id);
	}
	_incAlarmId() {
		return this.alarmId++;
	}
};
const domainConfigStub = {
	firstPartyDomain: true,
	partneredDomainTransitionUrl: "",
	apiUrl: "",
	u2fAppId: "",
	webauthnRpId: "",
	referralBaseUrl: "",
	giftCardBaseUrl: "",
	paymentUrl: "",
	webauthnUrl: "",
	legacyWebauthnUrl: "",
	webauthnMobileUrl: "",
	legacyWebauthnMobileUrl: "",
	websiteBaseUrl: ""
};
function resolveTypeReference(typeRef) {
	const modelMap = typeModels[typeRef.app];
	const typeModel = modelMap[typeRef.type];
	if (typeModel == null) throw new Error("Cannot find TypeRef: " + JSON.stringify(typeRef));
else return typeModel;
}
function getDefaultTestValue(valueName, value) {
	if (valueName === "_format") return "0";
else if (valueName === "_id") return null;
else if (valueName === "_permissions") return null;
else if (value.cardinality === Cardinality.ZeroOrOne) return null;
else switch (value.type) {
		case ValueType.Bytes: return new Uint8Array(0);
		case ValueType.Date: return new Date(0);
		case ValueType.Number: return "0";
		case ValueType.String: return "";
		case ValueType.Boolean: return false;
		case ValueType.CustomId:
		case ValueType.GeneratedId: return null;
	}
}
function createTestEntity(typeRef, values) {
	const typeModel = resolveTypeReference(typeRef);
	const entity = create(typeModel, typeRef, getDefaultTestValue);
	if (values) return Object.assign(entity, values);
else return entity;
}
function mockFetchRequest(mock$1, url, headers, status, jsonObject) {
	const response = (0, import_testdouble.object)();
	response.ok = status >= 200 && status < 300;
	response.status = status;
	const jsonDefer = defer();
	(0, import_testdouble.when)(response.json()).thenDo(() => {
		jsonDefer.resolve();
		return Promise.resolve(jsonObject);
	});
	(0, import_testdouble.when)(mock$1(import_testdouble.matchers.argThat((urlArg) => urlArg.toString() === url), import_testdouble.matchers.argThat((options) => {
		return deepEqual(options.headers, headers);
	}))).thenResolve(response);
	return jsonDefer.promise;
}
function textIncludes(match) {
	return (text) => text.includes(match) ? { pass: true } : {
		pass: false,
		message: `should include: "${match}"`
	};
}

//#endregion
export { SchedulerMock, browserDataStub, createTestEntity, domainConfigStub, makeCore, makeKeyStoreFacade, mockFetchRequest, textIncludes };
//# sourceMappingURL=TestUtils-f_4UhLVE.js.map