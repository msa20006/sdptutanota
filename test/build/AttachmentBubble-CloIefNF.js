
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { mithril_default } from "./mithril-Csg4iNnm.js";
import { defer, noOp } from "./dist-CJHwsXKY.js";
import { lang } from "./LanguageViewModel-BNC5ekpO.js";
import { TransformEnum, animations, ease, getSafeAreaInsetBottom, height, opacity, px, theme, transform, width } from "./HtmlUtils-C-ecR7U7.js";
import { Keys } from "./TutanotaConstants-3bwAESYA.js";
import { BootIcons, Button, ButtonType, Icon } from "./Icon-BuqNK7vz.js";
import { Icons } from "./Icons-Dl3nFav5.js";
import { focusNext, focusPrevious } from "./KeyManager-B0OGXEyJ.js";
import { modal } from "./Modal-g4c-b9IU.js";
import { hasError } from "./ErrorUtils-o1-v67Dd.js";
import { formatStorageSize } from "./Formatter-zB15D6XI.js";
import { getFileBaseName, getFileExtension, isTutanotaFile } from "./FileUtils-W-u2-gZz.js";
import { CALENDAR_MIME_TYPE, MAIL_MIME_TYPES, VCARD_MIME_TYPES } from "./SharedMailUtils-AmFaSJP6.js";
import { BubbleButton, bubbleButtonHeight, bubbleButtonPadding } from "./BubbleButton-DGGInJMg.js";

//#region ../src/common/gui/AttachmentBubble.ts
let AttachmentType = function(AttachmentType$1) {
	AttachmentType$1[AttachmentType$1["GENERIC"] = 0] = "GENERIC";
	AttachmentType$1[AttachmentType$1["CONTACT"] = 1] = "CONTACT";
	AttachmentType$1[AttachmentType$1["CALENDAR"] = 2] = "CALENDAR";
	AttachmentType$1[AttachmentType$1["MAIL"] = 3] = "MAIL";
	return AttachmentType$1;
}({});
var AttachmentBubble = class {
	dom = null;
	view(vnode) {
		const { attachment } = vnode.attrs;
		if (isTutanotaFile(attachment) && hasError(attachment)) return mithril_default(BubbleButton, {
			label: "emptyString_msg",
			text: "corrupted_msg",
			icon: Icons.Warning,
			onclick: noOp
		});
else {
			const extension = getFileExtension(attachment.name);
			const rest = getFileBaseName(attachment.name);
			return mithril_default(BubbleButton, {
				label: lang.makeTranslation("attachment_name", attachment.name),
				text: lang.makeTranslation("attachment_base_name", rest),
				icon: getAttachmentIcon(vnode.attrs.type),
				onclick: () => {
					showAttachmentDetailsPopup(this.dom, vnode.attrs).then(() => this.dom?.focus());
				}
			}, `${extension}, ${formatStorageSize(Number(attachment.size))}`);
		}
	}
	oncreate(vnode) {
		this.dom = vnode.dom;
	}
};
async function showAttachmentDetailsPopup(dom, attrs) {
	const parentRect = dom.getBoundingClientRect();
	const panel = new AttachmentDetailsPopup(parentRect, parentRect.width, attrs);
	panel.show();
	return panel.deferAfterClose;
}
function getAttachmentIcon(type) {
	switch (type) {
		case AttachmentType.CONTACT: return Icons.People;
		case AttachmentType.CALENDAR: return BootIcons.Calendar;
		default: return Icons.Attachment;
	}
}
function getAttachmentType(mimeType) {
	if (Object.values(VCARD_MIME_TYPES).includes(mimeType)) return AttachmentType.CONTACT;
else if (mimeType === CALENDAR_MIME_TYPE) return AttachmentType.CALENDAR;
else if (Object.values(MAIL_MIME_TYPES).includes(mimeType)) return AttachmentType.MAIL;
	return AttachmentType.GENERIC;
}
var AttachmentDetailsPopup = class {
	_shortcuts = [];
	domContent = null;
	domPanel = null;
	closeDefer = defer();
	focusedBeforeShown = null;
	get deferAfterClose() {
		return this.closeDefer.promise;
	}
	constructor(targetRect, targetWidth, attrs) {
		this.targetRect = targetRect;
		this.targetWidth = targetWidth;
		this.attrs = attrs;
		this._shortcuts.push({
			key: Keys.ESC,
			exec: () => this.onClose(),
			help: "close_alt"
		});
		this._shortcuts.push({
			key: Keys.TAB,
			shift: true,
			exec: () => this.domContent ? focusPrevious(this.domContent) : false,
			help: "selectPrevious_action"
		});
		this._shortcuts.push({
			key: Keys.TAB,
			shift: false,
			exec: () => this.domContent ? focusNext(this.domContent) : false,
			help: "selectNext_action"
		});
		if (attrs.open) this._shortcuts.push({
			key: Keys.O,
			exec: () => this.thenClose(attrs.open),
			help: "open_action"
		});
		if (attrs.download) this._shortcuts.push({
			key: Keys.D,
			exec: () => this.thenClose(attrs.download),
			help: "download_action"
		});
		if (attrs.remove) this._shortcuts.push({
			key: Keys.DELETE,
			exec: () => this.thenClose(attrs.remove),
			help: "remove_action"
		});
		if (attrs.fileImport) this._shortcuts.push({
			key: Keys.I,
			exec: () => this.thenClose(attrs.fileImport),
			help: "import_action"
		});
		this.view = this.view.bind(this);
	}
	view() {
		return mithril_default(".abs.bubble-color.border-radius.overflow-hidden.flex.flex-column", {
			class: bubbleButtonPadding(),
			style: {
				width: px(this.targetWidth),
				opacity: "0"
			},
			oncreate: (vnode) => {
				this.domPanel = vnode.dom;
				deferToNextFrame(() => this.animatePanel().then(() => this.domContent && focusNext(this.domContent)));
			},
			onclick: () => this.onClose()
		}, this.renderContent());
	}
	renderContent() {
		const { remove, open, download, attachment, fileImport, type } = this.attrs;
		return mithril_default(".flex.mb-s.pr", { oncreate: (vnode) => this.domContent = vnode.dom }, [mithril_default(Icon, {
			icon: getAttachmentIcon(type),
			class: "pr-s flex items-center",
			style: {
				fill: theme.button_bubble_fg,
				"background-color": "initial",
				minHeight: px(bubbleButtonHeight())
			}
		}), mithril_default(
			".flex.col.flex-grow",
			{ style: {
				minHeight: px(bubbleButtonHeight()),
				lineHeight: px(bubbleButtonHeight())
			} },
			mithril_default(".span.break-all.smaller", attachment.name),
			// bottom info is inside the same column as file text to align them
			mithril_default(".flex.row.justify-between.items-center", [mithril_default("span.smaller", `${formatStorageSize(Number(attachment.size))}`), mithril_default(".flex.no-wrap", [
				remove ? mithril_default(Button, {
					type: ButtonType.Secondary,
					label: "remove_action",
					click: () => this.thenClose(remove)
				}) : null,
				fileImport ? mithril_default(Button, {
					type: ButtonType.Secondary,
					label: "import_action",
					click: () => this.thenClose(fileImport)
				}) : null,
				open ? mithril_default(Button, {
					type: ButtonType.Secondary,
					label: "open_action",
					click: () => this.thenClose(open)
				}) : null,
				download ? mithril_default(Button, {
					type: ButtonType.Secondary,
					label: "download_action",
					click: () => this.thenClose(download)
				}) : null
			])])
)]);
	}
	thenClose(action) {
		action?.();
		this.onClose();
	}
	async animatePanel() {
		const { targetRect, domPanel, domContent } = this;
		if (domPanel == null || domContent == null) return;
		const initialHeight = bubbleButtonHeight();
		const targetHeight = domContent.offsetHeight === 0 ? 85 : domContent.offsetHeight;
		if (domContent.offsetHeight === 0) console.log("got offsetHeight 0, panel contains content:", domPanel.contains(domContent), "content style:", domContent.style, "panel style:", domPanel.style);
		const targetWidth = Math.max(targetRect.width, 300);
		domPanel.style.width = px(targetRect.width);
		domPanel.style.height = px(initialHeight);
		domPanel.style.top = px(targetRect.top);
		if (targetRect.left + targetWidth > window.innerWidth) domPanel.style.right = px(24);
else domPanel.style.left = px(targetRect.left);
		const mutations = [opacity(0, 1, true), height(initialHeight, targetHeight)];
		if (targetRect.width !== targetWidth) mutations.push(width(targetRect.width, targetWidth));
		const spaceBelow = window.innerHeight - getSafeAreaInsetBottom() - targetRect.top - targetHeight - initialHeight;
		if (spaceBelow < 0) mutations.push(transform(TransformEnum.TranslateY, 0, spaceBelow));
		await animations.add(domPanel, mutations, { easing: ease.out });
	}
	show() {
		this.focusedBeforeShown = document.activeElement;
		modal.displayUnique(this, true);
	}
	backgroundClick(e) {
		modal.remove(this);
	}
	async hideAnimation() {
		if (this.domPanel == null) return;
		const startHeight = this.domPanel.offsetHeight;
		const startWidth = this.domPanel.offsetWidth;
		await animations.add(this.domPanel, [
			height(startHeight, 30),
			width(startWidth, this.targetWidth),
			opacity(1, 0, false)
		], { easing: ease.out });
	}
	onClose() {
		modal.remove(this);
		this.closeDefer.resolve();
	}
	shortcuts() {
		return this._shortcuts;
	}
	popState(e) {
		modal.remove(this);
		return false;
	}
	callingElement() {
		return this.focusedBeforeShown;
	}
};
/** try and execute stuff after the next rendering frame */
const deferToNextFrame = (fn) => {
	window.requestAnimationFrame(() => {
		window.requestAnimationFrame(fn);
	});
};

//#endregion
export { AttachmentBubble, AttachmentType, getAttachmentType };
//# sourceMappingURL=AttachmentBubble-CloIefNF.js.map