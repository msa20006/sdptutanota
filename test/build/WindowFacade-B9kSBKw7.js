
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { mithril_default } from "./mithril-Csg4iNnm.js";
import { noOp, remove } from "./dist-CJHwsXKY.js";
import { Mode, assertMainOrNodeBoot, isApp, isElectronClient, isIOSApp } from "./Env-D5xGlXfw.js";
import { lang } from "./LanguageViewModel-BNC5ekpO.js";
import { client } from "./ClientDetector-D0v6Vqu6.js";

//#region ../src/common/misc/WindowFacade.ts
assertMainOrNodeBoot();
var WindowFacade = class {
	_windowSizeListeners;
	resizeTimeout;
	windowCloseConfirmation;
	_windowCloseListeners;
	_historyStateEventListeners = [];
	indexerFacade = null;
	_keyboardSize = 0;
	_keyboardSizeListeners = [];
	_ignoreNextPopstate = false;
	connectivityModel;
	logins = null;
	appBasedVisibilityChage = noOp;
	constructor() {
		this._windowSizeListeners = [];
		this.resizeTimeout = null;
		this.windowCloseConfirmation = false;
		this._windowCloseListeners = new Set();
		const onresize = () => {
			if (!this.resizeTimeout) {
				const cb = () => {
					this.resizeTimeout = null;
					this._resize();
				};
				this.resizeTimeout = client.isMobileDevice() ? setTimeout(cb, 66) : requestAnimationFrame(cb);
			}
		};
		window.onresize = onresize;
		window.onorientationchange = onresize;
	}
	/**
	* Add a window resize listener with a listenerId
	* @param listener Provides the new width and height of the window if the values change.
	*/
	addResizeListener(listener) {
		this._windowSizeListeners.push(listener);
	}
	removeResizeListener(listener) {
		remove(this._windowSizeListeners, listener);
	}
	addWindowCloseListener(listener) {
		this._windowCloseListeners.add(listener);
		this._checkWindowClosing(this._windowCloseListeners.size > 0);
		return () => {
			this._windowCloseListeners.delete(listener);
			this._checkWindowClosing(this._windowCloseListeners.size > 0);
		};
	}
	_notifyCloseListeners(e) {
		for (const f of this._windowCloseListeners) f(e);
	}
	addKeyboardSizeListener(listener) {
		this._keyboardSizeListeners.push(listener);
		listener(this._keyboardSize);
	}
	removeKeyboardSizeListener(listener) {
		remove(this._keyboardSizeListeners, listener);
	}
	openLink(href) {
		if (env.mode === Mode.App) window.open(href, "_system");
else window.open(href, "_blank");
	}
	init(logins, connectivityModel, appBasedVisibilityChage) {
		this.logins = logins;
		if (window.addEventListener && !isApp()) {
			window.addEventListener("beforeunload", (e) => this._beforeUnload(e));
			window.addEventListener("popstate", (e) => this._popState(e));
			window.addEventListener("unload", (e) => this._onUnload());
		}
		this.appBasedVisibilityChage = appBasedVisibilityChage ?? noOp;
		this.connectivityModel = connectivityModel;
		if (env.mode === Mode.App || env.mode === Mode.Desktop || env.mode === Mode.Admin) this.addPageInBackgroundListener();
		if (env.mode === Mode.Desktop && client.isMacOS && window.addEventListener) window.addEventListener("keydown", (e) => {
			if (!e.metaKey || e.key === "Meta") return;
			const target = e.target;
			if (target?.tagName === "INPUT" || target?.contentEditable === "true") e.stopPropagation();
else if (e.key === "ArrowLeft") window.history.back();
else if (e.key === "ArrowRight") window.history.forward();
		});
		this._resize();
	}
	_resize() {
		try {
			for (const listener of this._windowSizeListeners) listener(window.innerWidth, window.innerHeight);
		} finally {
			mithril_default.redraw();
		}
	}
	_checkWindowClosing(enable) {
		this.windowCloseConfirmation = enable;
	}
	_beforeUnload(e) {
		console.log("windowfacade._beforeUnload");
		this._notifyCloseListeners(e);
		if (this.windowCloseConfirmation) {
			let m = lang.get("closeWindowConfirmation_msg");
			e.returnValue = m;
			return m;
		} else {
			this.logins?.logout(true);
			return null;
		}
	}
	/**
	* add a function to call when onpopstate event occurs
	* @param listener: return true if this popstate may go ahead
	* @returns {Function}
	*/
	addHistoryEventListener(listener) {
		this._historyStateEventListeners.push(listener);
		return () => {
			const index = this._historyStateEventListeners.indexOf(listener);
			if (index !== -1) this._historyStateEventListeners.splice(index, 1);
		};
	}
	removeHistoryEventListener(listener) {
		remove(this._historyStateEventListeners, listener);
	}
	/**
	* calls the last history event listener that was added
	* and reverts the state change if it returns false
	* TODO: this also fires for forward-events and when the user jumps around in the history
	* TODO: by long-clicking the back/forward buttons.
	* TODO: solving this requires extensive bookkeeping because the events are indistinguishable by default
	* @param e: popstate DOM event
	* @private
	*/
	_popState(e) {
		const len = this._historyStateEventListeners.length;
		if (len === 0) return;
		if (this._ignoreNextPopstate) {
			this._ignoreNextPopstate = false;
			return;
		}
		if (!this._historyStateEventListeners[len - 1](e)) {
			this._ignoreNextPopstate = true;
			history.go(1);
		}
	}
	_onUnload() {
		if (this.windowCloseConfirmation && this.logins) this.logins.logout(true);
	}
	addOnlineListener(listener) {
		window.addEventListener("online", listener);
	}
	addOfflineListener(listener) {
		window.addEventListener("offline", listener);
	}
	async reload(args) {
		if (isApp() || isElectronClient()) {
			if (!Object.hasOwn(args, "noAutoLogin")) args.noAutoLogin = true;
			const { locator } = await import("./CommonLocator-CdidEYr7.js");
			const stringifiedArgs = {};
			for (const [k, v] of Object.entries(args)) if (v != null) stringifiedArgs[k] = String(v);
			await locator.commonSystemFacade.reload(stringifiedArgs);
		} else window.location.reload();
	}
	addPageInBackgroundListener() {
		if (isIOSApp()) document.addEventListener("visibilitychange", () => {
			console.log("Visibility change, hidden: ", document.hidden);
			this.appBasedVisibilityChage(!document.hidden);
			if (!document.hidden) setTimeout(() => this.connectivityModel?.tryReconnect(false, true), 100);
		});
	}
	onKeyboardSizeChanged(size) {
		this._keyboardSize = size;
		for (let listener of this._keyboardSizeListeners) listener(size);
		if (size > 0) {
			const body = document.body;
			body.style.position = "unset";
			setTimeout(() => {
				body.style.position = "fixed";
			}, 200);
		}
	}
};
const windowFacade = new WindowFacade();

//#endregion
export { WindowFacade, windowFacade };
//# sourceMappingURL=WindowFacade-B9kSBKw7.js.map