{"version":3,"file":"stream-u2PttBAC.js","names":["value","s","stream","streams"],"sources":["../../libs/stream.js"],"sourcesContent":["/* eslint-disable */\n;(function() {\n\"use strict\"\n/* eslint-enable */\nStream.SKIP = {}\nStream.lift = lift\nStream.scan = scan\nStream.merge = merge\nStream.combine = combine\nStream.scanMerge = scanMerge\nStream[\"fantasy-land/of\"] = Stream\n\nvar warnedHalt = false\nObject.defineProperty(Stream, \"HALT\", {\n\tget: function() {\n\t\twarnedHalt || console.log(\"HALT is deprecated and has been renamed to SKIP\");\n\t\twarnedHalt = true\n\t\treturn Stream.SKIP\n\t}\n})\n\nfunction Stream(value) {\n\tvar dependentStreams = []\n\tvar dependentFns = []\n\n\tfunction stream(v) {\n\t\tif (arguments.length && v !== Stream.SKIP) {\n\t\t\tvalue = v\n\t\t\tif (open(stream)) {\n\t\t\t\tstream._changing()\n\t\t\t\tstream._state = \"active\"\n\t\t\t\t// Cloning the list to ensure it's still iterated in intended\n\t\t\t\t// order\n\t\t\t\tdependentStreams.slice().forEach(function(s, i) {\n\t\t\t\t\tif (open(s)) s(this[i](value))\n\t\t\t\t}, dependentFns.slice())\n\t\t\t}\n\t\t}\n\n\t\treturn value\n\t}\n\n\tstream.constructor = Stream\n\tstream._state = arguments.length && value !== Stream.SKIP ? \"active\" : \"pending\"\n\tstream._parents = []\n\n\tstream._changing = function() {\n\t\tif (open(stream)) stream._state = \"changing\"\n\t\tdependentStreams.forEach(function(s) {\n\t\t\ts._changing()\n\t\t})\n\t}\n\n\tstream._map = function(fn, ignoreInitial) {\n\t\tvar target = ignoreInitial ? Stream() : Stream(fn(value))\n\t\ttarget._parents.push(stream)\n\t\tdependentStreams.push(target)\n\t\tdependentFns.push(fn)\n\t\treturn target\n\t}\n\n\tstream.map = function(fn) {\n\t\treturn stream._map(fn, stream._state !== \"active\")\n\t}\n\n\tvar end\n\tfunction createEnd() {\n\t\tend = Stream()\n\t\tend.map(function(value) {\n\t\t\tif (value === true) {\n\t\t\t\tstream._parents.forEach(function (p) {p._unregisterChild(stream)})\n\t\t\t\tstream._state = \"ended\"\n\t\t\t\tstream._parents.length = dependentStreams.length = dependentFns.length = 0\n\t\t\t}\n\t\t\treturn value\n\t\t})\n\t\treturn end\n\t}\n\n\tstream.toJSON = function() { return value != null && typeof value.toJSON === \"function\" ? value.toJSON() : value }\n\n\tstream[\"fantasy-land/map\"] = stream.map\n\tstream[\"fantasy-land/ap\"] = function(x) { return combine(function(s1, s2) { return s1()(s2()) }, [x, stream]) }\n\n\tstream._unregisterChild = function(child) {\n\t\tvar childIndex = dependentStreams.indexOf(child)\n\t\tif (childIndex !== -1) {\n\t\t\tdependentStreams.splice(childIndex, 1)\n\t\t\tdependentFns.splice(childIndex, 1)\n\t\t}\n\t}\n\n\tObject.defineProperty(stream, \"end\", {\n\t\tget: function() { return end || createEnd() }\n\t})\n\n\treturn stream\n}\n\nfunction combine(fn, streams) {\n\tvar ready = streams.every(function(s) {\n\t\tif (s.constructor !== Stream)\n\t\t\tthrow new Error(\"Ensure that each item passed to stream.combine/stream.merge/lift is a stream.\")\n\t\treturn s._state === \"active\"\n\t})\n\tvar stream = ready\n\t\t? Stream(fn.apply(null, streams.concat([streams])))\n\t\t: Stream()\n\n\tvar changed = []\n\n\tvar mappers = streams.map(function(s) {\n\t\treturn s._map(function(value) {\n\t\t\tchanged.push(s)\n\t\t\tif (ready || streams.every(function(s) { return s._state !== \"pending\" })) {\n\t\t\t\tready = true\n\t\t\t\tstream(fn.apply(null, streams.concat([changed])))\n\t\t\t\tchanged = []\n\t\t\t}\n\t\t\treturn value\n\t\t}, true)\n\t})\n\n\tvar endStream = stream.end.map(function(value) {\n\t\tif (value === true) {\n\t\t\tmappers.forEach(function(mapper) { mapper.end(true) })\n\t\t\tendStream.end(true)\n\t\t}\n\t\treturn undefined\n\t})\n\n\treturn stream\n}\n\nfunction merge(streams) {\n\treturn combine(function() { return streams.map(function(s) { return s() }) }, streams)\n}\n\nfunction scan(fn, acc, origin) {\n\tvar stream = origin.map(function(v) {\n\t\tvar next = fn(acc, v)\n\t\tif (next !== Stream.SKIP) acc = next\n\t\treturn next\n\t})\n\tstream(acc)\n\treturn stream\n}\n\nfunction scanMerge(tuples, seed) {\n\tvar streams = tuples.map(function(tuple) { return tuple[0] })\n\n\tvar stream = combine(function() {\n\t\tvar changed = arguments[arguments.length - 1]\n\t\tstreams.forEach(function(stream, i) {\n\t\t\tif (changed.indexOf(stream) > -1)\n\t\t\t\tseed = tuples[i][1](seed, stream())\n\t\t})\n\n\t\treturn seed\n\t}, streams)\n\n\tstream(seed)\n\n\treturn stream\n}\n\nfunction lift() {\n\tvar fn = arguments[0]\n\tvar streams = Array.prototype.slice.call(arguments, 1)\n\treturn merge(streams).map(function(streams) {\n\t\treturn fn.apply(undefined, streams)\n\t})\n}\n\nfunction open(s) {\n\treturn s._state === \"pending\" || s._state === \"active\" || s._state === \"changing\"\n}\n\nif (typeof module !== \"undefined\") module[\"exports\"] = Stream\nelse if (typeof window.m === \"function\" && !(\"stream\" in window.m)) window.m.stream = Stream\nelse window.m = {stream : Stream}\n\n}());\n"],"mappings":"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"}