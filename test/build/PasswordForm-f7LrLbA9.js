
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { mithril_default } from "./mithril-Csg4iNnm.js";
import { assert } from "./dist-CJHwsXKY.js";
import { assertMainOrNode } from "./Env-D5xGlXfw.js";
import { InfoLink, lang } from "./LanguageViewModel-BNC5ekpO.js";
import { px, size, theme } from "./HtmlUtils-C-ecR7U7.js";
import { Button, ButtonType } from "./Icon-BuqNK7vz.js";
import { Autocomplete, Dialog } from "./Dialog-B6-HFvZd.js";
import { locator$1 as locator } from "./CommonLocator-Csg4iNnm.js";
import { getEnabledMailAddressesForGroupInfo } from "./GroupUtils-0ZkLIAeC.js";
import { getPasswordStrength, isSecurePassword } from "./PasswordUtils-C4jlV9GF.js";
import { ExternalLink } from "./ExternalLink-rsCBSC7U.js";
import { copyToClipboard } from "./ClipboardUtils-mz40UK5S.js";
import { PasswordField } from "./PasswordField-CPKPoLq8.js";
import { LoginButton } from "./LoginButton-DzCRy0Yt.js";

//#region ../src/common/misc/passwords/PasswordGenerator.ts
assertMainOrNode();
const NUMBER_OF_BYTES = 2;
const BYTE_RANGE = Math.pow(2, 8 * NUMBER_OF_BYTES);
var PasswordGenerator = class {
	constructor(randomizer, dictionary$1) {
		this.randomizer = randomizer;
		this.dictionary = dictionary$1;
	}
	async generateRandomPassphrase() {
		const usedWords = new Set();
		while (usedWords.size < 6) {
			const word = await this.pickRandomWordFromDictionary();
			usedWords.add(word);
		}
		return Array.from(usedWords).join(" ");
	}
	async pickRandomWordFromDictionary() {
		const length = this.dictionary.length;
		return this.dictionary[await this.generateRandomNumberInRange(length)];
	}
	async generateRandomNumberInRange(range) {
		assert(range > 0, "range must be greater than 0");
		const byteNumber = await this.randomizer.generateRandomNumber(NUMBER_OF_BYTES);
		return Math.floor(byteNumber / BYTE_RANGE * range);
	}
};

//#endregion
//#region ../src/common/misc/passwords/PasswordGeneratorDialog.ts
let dictionary = null;
async function showPasswordGeneratorDialog() {
	if (dictionary == null) {
		const appState = window.tutao.appState;
		const baseUrl = location.protocol + "//" + location.hostname + (location.port ? ":" + location.port : "") + appState.prefixWithoutFile;
		dictionary = await fetch(baseUrl + "/wordlibrary.json").then((response) => response.json());
	}
	let password = "";
	const pwGenerator = new PasswordGenerator(locator.random, dictionary);
	return new Promise((resolve) => {
		const insertPasswordOkAction = () => {
			resolve(password);
			dialog.close();
		};
		const updateAction = async () => {
			password = await pwGenerator.generateRandomPassphrase();
			mithril_default.redraw();
		};
		updateAction();
		const dialog = Dialog.showActionDialog({
			title: "passphrase_label",
			child: { view: () => mithril_default(PasswordGeneratorDialog, {
				okAction: insertPasswordOkAction,
				updateAction,
				password
			}) },
			okAction: null
		});
	});
}
var PasswordGeneratorDialog = class {
	view(vnode) {
		const { updateAction, okAction, password } = vnode.attrs;
		return mithril_default("", [
			mithril_default(".editor-border.mt.flex.center-horizontally.center-vertically", { style: { minHeight: px(65) } }, mithril_default(".center.b.monospace", password)),
			mithril_default(".small.mt-xs", [
				lang.get("passphraseGeneratorHelp_msg"),
				" ",
				mithril_default(ExternalLink, {
					href: InfoLink.PasswordGenerator,
					text: lang.get("faqEntry_label"),
					isCompanySite: true
				})
			]),
			mithril_default(".flex-end", [mithril_default(Button, {
				label: "regeneratePassword_action",
				click: () => updateAction(),
				type: ButtonType.Secondary
			}), mithril_default(Button, {
				click: () => copyToClipboard(password),
				label: "copy_action",
				type: ButtonType.Secondary
			})]),
			mithril_default(".flex", mithril_default(LoginButton, {
				label: "apply_action",
				onclick: () => okAction()
			}))
		]);
	}
};

//#endregion
//#region ../src/common/settings/PasswordForm.ts
assertMainOrNode();
var PasswordFieldType = function(PasswordFieldType$1) {
	PasswordFieldType$1[PasswordFieldType$1["Old"] = 0] = "Old";
	PasswordFieldType$1[PasswordFieldType$1["New"] = 1] = "New";
	PasswordFieldType$1[PasswordFieldType$1["Confirm"] = 2] = "Confirm";
	return PasswordFieldType$1;
}(PasswordFieldType || {});
var PasswordModel = class {
	newPassword = "";
	oldPassword = "";
	repeatedPassword = "";
	passwordStrength;
	__mailValid;
	__signupFreeTest;
	__signupPaidTest;
	constructor(usageTestController, logins, config, mailValid) {
		this.usageTestController = usageTestController;
		this.logins = logins;
		this.config = config;
		this.passwordStrength = this.calculatePasswordStrength();
		this.__mailValid = mailValid;
		this.__signupFreeTest = this.usageTestController.getTest("signup.free");
		this.__signupPaidTest = this.usageTestController.getTest("signup.paid");
	}
	_checkBothValidAndSendPing() {
		if (this.getNewPasswordStatus().type === "valid" && this.getRepeatedPasswordStatus().type === "valid") {
			this.__signupFreeTest?.getStage(3).complete();
			this.__signupPaidTest?.getStage(2).complete();
		}
	}
	getNewPassword() {
		return this.newPassword;
	}
	setNewPassword(newPassword) {
		if (this.__mailValid && this.__mailValid()) {
			this.__signupFreeTest?.getStage(2).complete();
			this.__signupPaidTest?.getStage(1).complete();
		}
		this.newPassword = newPassword;
		this.recalculatePasswordStrength();
	}
	/**
	* Might be needed when reserved strings change in the config
	*/
	recalculatePasswordStrength() {
		this.passwordStrength = this.calculatePasswordStrength();
		this._checkBothValidAndSendPing();
	}
	getOldPassword() {
		return this.oldPassword;
	}
	setOldPassword(oldPassword) {
		this.oldPassword = oldPassword;
		this.passwordStrength = this.calculatePasswordStrength();
	}
	getRepeatedPassword() {
		return this.repeatedPassword;
	}
	setRepeatedPassword(repeatedPassword) {
		this.repeatedPassword = repeatedPassword;
		this.passwordStrength = this.calculatePasswordStrength();
		this._checkBothValidAndSendPing();
	}
	clear() {
		this.newPassword = "";
		this.oldPassword = "";
		this.repeatedPassword = "";
		this.passwordStrength = this.calculatePasswordStrength();
	}
	getErrorMessageId() {
		return this.getErrorFromStatus(this.getOldPasswordStatus()) ?? this.getErrorFromStatus(this.getNewPasswordStatus()) ?? this.getErrorFromStatus(this.getRepeatedPasswordStatus());
	}
	getOldPasswordStatus() {
		if (this.config.checkOldPassword && this.oldPassword === "") return {
			type: "neutral",
			text: "oldPasswordNeutral_msg"
		};
else return {
			type: "valid",
			text: "emptyString_msg"
		};
	}
	getNewPasswordStatus() {
		if (this.newPassword === "") return {
			type: "neutral",
			text: "password1Neutral_msg"
		};
else if (this.config.checkOldPassword && this.oldPassword === this.newPassword) return {
			type: "invalid",
			text: "password1InvalidSame_msg"
		};
else if (this.isPasswordInsecure()) if (this.config.enforceStrength) return {
			type: "invalid",
			text: "password1InvalidUnsecure_msg"
		};
else return {
			type: "valid",
			text: "password1InvalidUnsecure_msg"
		};
else return {
			type: "valid",
			text: "passwordValid_msg"
		};
	}
	getRepeatedPasswordStatus() {
		if (this.config.hideConfirmation) return {
			type: "valid",
			text: "passwordValid_msg"
		};
		const repeatedPassword = this.repeatedPassword;
		const newPassword = this.newPassword;
		if (repeatedPassword === "") return {
			type: "neutral",
			text: "password2Neutral_msg"
		};
else if (repeatedPassword !== newPassword) return {
			type: "invalid",
			text: "password2Invalid_msg"
		};
else return {
			type: "valid",
			text: "passwordValid_msg"
		};
	}
	isPasswordInsecure() {
		return !isSecurePassword(this.getPasswordStrength());
	}
	getPasswordStrength() {
		return this.passwordStrength;
	}
	getErrorFromStatus(status) {
		if (!status) return null;
		return status.type !== "valid" ? status.text : null;
	}
	calculatePasswordStrength() {
		let reserved = this.config.reservedStrings ? this.config.reservedStrings() : [];
		if (this.logins.isUserLoggedIn()) reserved = reserved.concat(getEnabledMailAddressesForGroupInfo(this.logins.getUserController().userGroupInfo)).concat(this.logins.getUserController().userGroupInfo.name);
		return getPasswordStrength(this.newPassword, reserved);
	}
};
var PasswordForm = class {
	view({ attrs }) {
		return mithril_default("", { onremove: () => attrs.model.clear() }, [
			attrs.model.config.checkOldPassword ? mithril_default(PasswordField, {
				label: "oldPassword_label",
				value: attrs.model.getOldPassword(),
				status: attrs.model.getOldPasswordStatus(),
				oninput: (input) => attrs.model.setOldPassword(input),
				autocompleteAs: Autocomplete.currentPassword,
				fontSize: px(size.font_size_smaller)
			}) : null,
			mithril_default(PasswordField, {
				label: "newPassword_label",
				value: attrs.model.getNewPassword(),
				passwordStrength: attrs.model.getPasswordStrength(),
				helpLabel: () => this.renderPasswordGeneratorHelp(attrs),
				status: attrs.model.getNewPasswordStatus(),
				oninput: (input) => attrs.model.setNewPassword(input),
				autocompleteAs: Autocomplete.newPassword,
				fontSize: px(size.font_size_smaller)
			}),
			attrs.model.config.hideConfirmation ? null : mithril_default(PasswordField, {
				label: "repeatedPassword_label",
				value: attrs.model.getRepeatedPassword(),
				autocompleteAs: Autocomplete.newPassword,
				status: attrs.model.getRepeatedPasswordStatus(),
				oninput: (input) => attrs.model.setRepeatedPassword(input),
				fontSize: px(size.font_size_smaller)
			}),
			attrs.passwordInfoKey ? mithril_default(".small.mt-s", lang.get(attrs.passwordInfoKey)) : null
		]);
	}
	renderPasswordGeneratorHelp(attrs) {
		return mithril_default("button.b.mr-xs.hover.click.darkest-hover.mt-xs", {
			style: {
				display: "inline-block",
				color: theme.navigation_button_selected
			},
			onclick: async () => {
				attrs.model.setNewPassword(await showPasswordGeneratorDialog());
				mithril_default.redraw();
			}
		}, lang.get("generatePassphrase_action"));
	}
};

//#endregion
export { BYTE_RANGE, PasswordForm, PasswordGenerator, PasswordModel };
//# sourceMappingURL=PasswordForm-f7LrLbA9.js.map