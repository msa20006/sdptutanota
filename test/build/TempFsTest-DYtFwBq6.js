
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { __toESM } from "./chunk-D_5_n1c4.js";
import { base64ToBase64Url, base64ToUint8Array, base64UrlToBase64, uint8ArrayToBase64, uint8ArrayToHex } from "./dist-CJHwsXKY.js";
import { dist_default } from "./dist-Ci1bEzYU.js";
import { require_testdouble } from "./testdouble-IbRSnrC0.js";
import path from "node:path";

//#region ../src/common/desktop/files/TempFs.ts
var TempFs = class {
	topLevelTempDir = "tutanota";
	/** we store all temporary files in a directory with a random name, so that the download location is not predictable */
	randomDirectoryName;
	constructor(fs, electron, cryptoFunctions) {
		this.fs = fs;
		this.electron = electron;
		this.cryptoFunctions = cryptoFunctions;
		this.randomDirectoryName = base64ToBase64Url(uint8ArrayToBase64(cryptoFunctions.randomBytes(16)));
	}
	clear() {
		const topLvlTmpDir = path.join(this.electron.app.getPath("temp"), this.topLevelTempDir);
		try {
			const tmps = this.fs.readdirSync(topLvlTmpDir);
			for (const tmp of tmps) {
				const tmpSubPath = path.join(topLvlTmpDir, tmp);
				try {
					this.fs.rmSync(tmpSubPath, { recursive: true });
				} catch (e) {
					if (e.code !== "ENOENT" && e.code !== "EACCES") throw e;
				}
			}
		} catch (e) {
			if (e.code !== "ENOENT") throw e;
		}
	}
	/**
	* Get a path to the tutanota temporary directory
	* the hierarchy is
	* [electron tmp dir]
	* [tutanota tmp]
	*
	* the directory will be created if it doesn't already exist
	*
	* a randomly named subdirectory will be included
	*
	* if `noRandomDirectory` then random directory will not be included in the path,
	* and the whole directory will not be created
	* @returns {string}
	*/
	getTutanotaTempPath() {
		const directory = path.join(this.electron.app.getPath("temp"), this.topLevelTempDir, this.randomDirectoryName);
		this.fs.mkdirSync(directory, {
			recursive: true,
			mode: 448
		});
		return path.join(directory);
	}
	async acquireSingleInstanceLock() {
		const lockfilePath = this.getLockFilePath();
		try {
			await this.fs.promises.writeFile(lockfilePath, this.electron.app.getVersion(), "utf8");
		} catch (e) {}
		return this.electron.app.requestSingleInstanceLock();
	}
	getLockFilePath() {
		return path.join(this.electron.app.getPath("temp"), "tutanota_desktop_lockfile");
	}
	/**
	* reads the lockfile and then writes the own version into the lockfile
	* @returns {Promise<boolean>} whether the lock was overridden by another version since the last read
	*/
	async singleInstanceLockOverridden() {
		const lockfilePath = this.getLockFilePath();
		const version = await this.fs.promises.readFile(lockfilePath, "utf8");
		try {
			await this.fs.promises.writeFile(lockfilePath, this.electron.app.getVersion(), "utf8");
			return version !== this.electron.app.getVersion();
		} catch (e) {
			return false;
		}
	}
	/**
	* Writes contents with a random file name into the tmp directory
	* @param contents the contents of the file to write
	* @param subfolder the subfolder of the tmp files to write to
	* @param option the options for write file as encoding and file permissions
	* @returns path to the written file
	*/
	async writeToDisk(contents, subfolder, option) {
		const tmpPath = path.join(this.getTutanotaTempPath(), subfolder);
		await this.fs.promises.mkdir(tmpPath, { recursive: true });
		const filename = uint8ArrayToHex(this.cryptoFunctions.randomBytes(12));
		const filePath = path.join(tmpPath, filename);
		await this.fs.promises.writeFile(filePath, contents, option);
		return filePath;
	}
	/** removes the given subfolder of our tmp directory with all its contents */
	async clearTmpSub(subFolder) {
		const tmpPath = path.join(this.getTutanotaTempPath(), subFolder);
		this.fs.rmSync(tmpPath, {
			force: true,
			recursive: true,
			maxRetries: 3
		});
	}
	async ensureEncryptedDir() {
		const downloadDirectory = this.getEncryptedTempDir();
		await this.fs.promises.mkdir(downloadDirectory, { recursive: true });
		return downloadDirectory;
	}
	async ensureUnencrytpedDir() {
		const downloadDirectory = this.getUnencryptedTempDir();
		await this.fs.promises.mkdir(downloadDirectory, { recursive: true });
		return downloadDirectory;
	}
	getEncryptedTempDir() {
		return path.join(this.getTutanotaTempPath(), "encrypted");
	}
	getUnencryptedTempDir() {
		return path.join(this.getTutanotaTempPath(), "decrypted");
	}
};

//#endregion
//#region tests/desktop/files/TempFsTest.ts
var import_testdouble = __toESM(require_testdouble(), 1);
dist_default.spec("TempFsTest", function() {
	dist_default("delete tutanotaTempDir can handle multiple subfolders, some of which aren't ours", function() {
		const fs = (0, import_testdouble.object)();
		const app = (0, import_testdouble.object)();
		const electron = { app };
		const cryptoFns = (0, import_testdouble.object)();
		(0, import_testdouble.when)(cryptoFns.randomBytes(import_testdouble.matchers.anything())).thenReturn(base64ToUint8Array(base64UrlToBase64("9E9u8bnXUGWYCk05eF0Xjw")));
		(0, import_testdouble.when)(app.getPath("temp")).thenReturn("/tmp");
		(0, import_testdouble.when)(fs.readdirSync("/tmp/tutanota")).thenReturn([
			"mine",
			"thine",
			"anothermine",
			"removed",
			"lastmine"
		]);
		(0, import_testdouble.when)(fs.rmSync("/tmp/tutanota/thine", { recursive: true })).thenThrow({ code: "EACCES" });
		(0, import_testdouble.when)(fs.rmSync("/tmp/tutanota/mine", { recursive: true })).thenReturn(null);
		(0, import_testdouble.when)(fs.rmSync("/tmp/tutanota/anothermine", { recursive: true })).thenReturn(null);
		(0, import_testdouble.when)(fs.rmSync("/tmp/tutanota/removed", { recursive: true })).thenThrow({ code: "ENOENT" });
		(0, import_testdouble.when)(fs.rmSync("/tmp/tutanota/lastmine", { recursive: true })).thenReturn(null);
		const tfs = new TempFs(fs, electron, cryptoFns);
		tfs.clear();
		(0, import_testdouble.verify)(fs.rmSync(import_testdouble.matchers.anything(), { recursive: true }), { times: 5 });
	});
});

//#endregion
//# sourceMappingURL=TempFsTest-DYtFwBq6.js.map