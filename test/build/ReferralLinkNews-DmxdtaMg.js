
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { mithril_default } from "./mithril-Csg4iNnm.js";
import { getDayShifted, neverNull } from "./dist-CJHwsXKY.js";
import { isApp } from "./Env-D5xGlXfw.js";
import { InfoLink, lang } from "./LanguageViewModel-BNC5ekpO.js";
import { BootIcons, Button, ButtonType } from "./Icon-BuqNK7vz.js";
import { Icons } from "./Icons-Dl3nFav5.js";
import { TextField, ifAllowedTutaLinks } from "./Dialog-B6-HFvZd.js";
import { ButtonSize, IconButton } from "./IconButton-DsU60HJ_.js";
import { generatedIdToTimestamp } from "./EntityUtils-RQxXZlcV.js";
import { createReferralCodePostIn } from "./TypeRefs-BP1jvX9p.js";
import { ReferralCodeService } from "./Services-CZFE0084.js";
import { locator$1 as locator } from "./CommonLocator-Csg4iNnm.js";
import { showSnackBar } from "./SnackBar-CoP3lSVs.js";
import { copyToClipboard } from "./ClipboardUtils-mz40UK5S.js";
import { MoreInfoLink } from "./MoreInfoLink-CySwGi3Q.js";

//#region ../src/common/misc/news/items/ReferralLinkViewer.ts
var ReferralLinkViewer = class {
	view(vnode) {
		return mithril_default(".scroll", [
			mithril_default(".h4", lang.get("referralSettings_label")),
			mithril_default("", lang.get("referralLinkLong_msg")),
			mithril_default(TextField, this.getReferralLinkTextFieldAttrs(vnode.attrs.referralLink))
		]);
	}
	getReferralLinkTextFieldAttrs(referralLink) {
		return {
			isReadOnly: true,
			label: "referralLink_label",
			value: referralLink,
			injectionsRight: () => this.renderButtons(referralLink),
			helpLabel: () => ifAllowedTutaLinks(locator.logins, InfoLink.ReferralLink, (link) => [mithril_default(MoreInfoLink, { link })])
		};
	}
	renderButtons(referralLink) {
		if (referralLink === "") return [];
		return [mithril_default(IconButton, {
			title: "copy_action",
			click: () => this.copyAction(referralLink),
			icon: Icons.Copy,
			size: ButtonSize.Compact
		}), mithril_default(IconButton, {
			title: "share_action",
			click: () => this.shareAction(referralLink),
			icon: BootIcons.Share,
			size: ButtonSize.Compact
		})];
	}
	async copyAction(referralLink) {
		await copyToClipboard(referralLink);
		await showSnackBar({
			message: "linkCopied_msg",
			button: {
				label: "close_alt",
				click: () => {}
			}
		});
	}
	async shareAction(referralLink) {
		if (isApp()) {
			const shareMessage = this.getReferralLinkMessage(referralLink);
			return locator.systemFacade.shareText(shareMessage, lang.get("referralSettings_label")).then();
		} else import("./MailEditor-BuqlXNUT.js").then((mailEditorModule) => mailEditorModule.writeInviteMail(referralLink));
	}
	getReferralLinkMessage(referralLink) {
		return lang.get("referralLinkShare_msg", { "{referralLink}": referralLink });
	}
};
async function getReferralLink(userController) {
	const customer = await userController.loadCustomer();
	const referralCode = customer.referralCode ? customer.referralCode : await requestNewReferralCode();
	const referralBaseUrl = locator.domainConfigProvider().getCurrentDomainConfig().referralBaseUrl;
	const referralUrl = new URL(referralBaseUrl);
	referralUrl.searchParams.set("ref", referralCode);
	return referralUrl.href;
}
async function requestNewReferralCode() {
	const { referralCode } = await locator.serviceExecutor.post(ReferralCodeService, createReferralCodePostIn({}));
	return referralCode;
}

//#endregion
//#region ../src/common/misc/news/items/ReferralLinkNews.ts
const REFERRAL_NEWS_DISPLAY_THRESHOLD_DAYS = 7;
var ReferralLinkNews = class {
	referralLink = "";
	constructor(newsModel, dateProvider, userController) {
		this.newsModel = newsModel;
		this.dateProvider = dateProvider;
		this.userController = userController;
	}
	async isShown() {
		if ((await this.userController.loadCustomer()).businessUse === true) return false;
		this.referralLink = await getReferralLink(this.userController);
		const customerCreatedTime = generatedIdToTimestamp(neverNull(this.userController.user.customer));
		return this.userController.isGlobalAdmin() && getDayShifted(new Date(customerCreatedTime), REFERRAL_NEWS_DISPLAY_THRESHOLD_DAYS) <= new Date(this.dateProvider.now());
	}
	render(newsId) {
		const buttonAttrs = [{
			label: "close_alt",
			click: () => this.newsModel.acknowledgeNews(newsId.newsItemId).then(mithril_default.redraw),
			type: ButtonType.Secondary
		}];
		return mithril_default(".full-width", [mithril_default(ReferralLinkViewer, { referralLink: this.referralLink }), mithril_default(".flex-end.flex-no-grow-no-shrink-auto.flex-wrap", buttonAttrs.map((a) => mithril_default(Button, a)))]);
	}
};

//#endregion
export { ReferralLinkNews };
//# sourceMappingURL=ReferralLinkNews-DmxdtaMg.js.map