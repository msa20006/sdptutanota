{"version":3,"file":"ContactEditor-qV5wi7tT.js","names":["vnode: VnodeDOM<AggregateEditorAttrs<any>>","vnode: Vnode<AggregateEditorAttrs<any>>","attrs: AggregateEditorAttrs<any>","attrs: AggregateEditorAttrs<unknown>","domElement: HTMLElement","fadein: boolean","entityClient: EntityClient","contact: Contact | null","listId?: Id","newContactIdReceiver: ((contactId: Id) => unknown) | null","entity: { _id: Id }","id: Id","allowCancel: boolean","date: CompleteCustomDate","typeLabels: Array<[ContactCustomDateType, TranslationKey]>","mailAddress: ContactMailAddress","helpLabel: TranslationKey","typeLabels: Array<[ContactAddressType, TranslationKey]>","phoneNumber: ContactPhoneNumber","address: ContactAddress","socialId: ContactSocialId","website: ContactWebsite","relationship: ContactRelationship","messengerHandle: ContactMessengerHandle","pronouns: ContactPronouns","fieldName: keyof Contact","label: TranslationKey","value: string","isCustom: boolean","key: K","aggregate: T","headerBarAttrs: DialogHeaderBarAttrs"],"sources":["../../src/mail-app/contacts/ContactAggregateEditor.ts","../../src/mail-app/contacts/ContactEditor.ts"],"sourcesContent":["import { Autocapitalize, TextField, TextFieldType } from \"../../common/gui/base/TextField.js\"\nimport { lang, TranslationKey, MaybeTranslation } from \"../../common/misc/LanguageViewModel\"\nimport m, { Children, Component, Vnode, VnodeDOM } from \"mithril\"\nimport { Icons } from \"../../common/gui/base/icons/Icons\"\nimport { animations, height, opacity } from \"../../common/gui/animation/Animations\"\nimport { attachDropdown } from \"../../common/gui/base/Dropdown.js\"\nimport { IconButton } from \"../../common/gui/base/IconButton.js\"\nimport { BootIcons } from \"../../common/gui/base/icons/BootIcons.js\"\nimport { ButtonSize } from \"../../common/gui/base/ButtonSize.js\"\n\nexport type AggregateEditorAttrs<AggregateType> = {\n\tvalue: string\n\tcancelAction: () => unknown\n\tkey: string\n\tanimateCreate?: boolean\n\tanimateCancel?: boolean\n\tallowCancel?: boolean\n\tfieldType: TextFieldType\n\tonUpdate: (newValue: string) => unknown\n\tlabel: MaybeTranslation\n\thelpLabel: MaybeTranslation\n\ttypeLabels: ReadonlyArray<[AggregateType, TranslationKey]>\n\tonTypeSelected: (arg0: AggregateType) => unknown\n\tautocapitalizeTextField?: Autocapitalize\n}\n\nexport class ContactAggregateEditor implements Component<AggregateEditorAttrs<any>> {\n\toncreate(vnode: VnodeDOM<AggregateEditorAttrs<any>>) {\n\t\tconst animate = typeof vnode.attrs.animateCreate === \"boolean\" ? vnode.attrs.animateCreate : true\n\t\tif (animate) this.animate(vnode.dom as HTMLElement, true)\n\t}\n\n\tasync onbeforeremove(vnode: VnodeDOM<AggregateEditorAttrs<any>>): Promise<void> {\n\t\tawait this.animate(vnode.dom as HTMLElement, false)\n\t}\n\n\tview(vnode: Vnode<AggregateEditorAttrs<any>>): Children {\n\t\tconst attrs = vnode.attrs\n\t\treturn m(\".flex.items-center.child-grow\", [\n\t\t\tm(TextField, {\n\t\t\t\tvalue: attrs.value,\n\t\t\t\tlabel: attrs.label,\n\t\t\t\ttype: attrs.fieldType,\n\t\t\t\tautocapitalize: attrs.autocapitalizeTextField,\n\t\t\t\thelpLabel: () => lang.getTranslationText(attrs.helpLabel),\n\t\t\t\tinjectionsRight: () => this._moreButtonFor(attrs),\n\t\t\t\toninput: (value) => attrs.onUpdate(value),\n\t\t\t}),\n\t\t\tthis._cancelButtonFor(attrs),\n\t\t])\n\t}\n\n\t_doesAllowCancel(attrs: AggregateEditorAttrs<any>): boolean {\n\t\treturn typeof attrs.allowCancel === \"boolean\" ? attrs.allowCancel : true\n\t}\n\n\t_cancelButtonFor(attrs: AggregateEditorAttrs<unknown>): Children {\n\t\tif (this._doesAllowCancel(attrs)) {\n\t\t\treturn m(IconButton, {\n\t\t\t\ttitle: \"remove_action\",\n\t\t\t\tclick: () => attrs.cancelAction(),\n\t\t\t\ticon: Icons.Cancel,\n\t\t\t})\n\t\t} else {\n\t\t\t// placeholder so that the text field does not jump around\n\t\t\treturn m(\".icon-button\")\n\t\t}\n\t}\n\n\t_moreButtonFor(attrs: AggregateEditorAttrs<any>): Children {\n\t\treturn m(\n\t\t\tIconButton,\n\t\t\tattachDropdown({\n\t\t\t\tmainButtonAttrs: {\n\t\t\t\t\ttitle: \"more_label\",\n\t\t\t\t\ticon: BootIcons.Expand,\n\t\t\t\t\tsize: ButtonSize.Compact,\n\t\t\t\t},\n\t\t\t\tchildAttrs: () =>\n\t\t\t\t\tattrs.typeLabels.map(([key, value]) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tlabel: value,\n\t\t\t\t\t\t\tclick: () => attrs.onTypeSelected(key),\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t}),\n\t\t)\n\t}\n\n\tanimate(domElement: HTMLElement, fadein: boolean): Promise<any> {\n\t\tlet childHeight = domElement.offsetHeight\n\n\t\tif (fadein) {\n\t\t\tdomElement.style.opacity = \"0\"\n\t\t}\n\n\t\tconst opacityP = animations.add(domElement, fadein ? opacity(0, 1, true) : opacity(1, 0, true))\n\t\tconst heightP = animations.add(domElement, fadein ? height(0, childHeight) : height(childHeight, 0))\n\t\theightP.then(() => {\n\t\t\tdomElement.style.height = \"\"\n\t\t})\n\t\treturn Promise.all([opacityP, heightP])\n\t}\n}\n","import m, { Children, Component, Vnode } from \"mithril\"\nimport { Dialog } from \"../../common/gui/base/Dialog\"\nimport type { Translation, TranslationKey } from \"../../common/misc/LanguageViewModel\"\nimport { lang } from \"../../common/misc/LanguageViewModel\"\nimport { isMailAddress } from \"../../common/misc/FormatValidator\"\nimport { formatBirthdayNumeric, formatContactDate } from \"../../common/contactsFunctionality/ContactUtils.js\"\nimport {\n\tContactAddressType,\n\tContactCustomDateType,\n\tContactMessengerHandleType,\n\tContactPhoneNumberType,\n\tContactRelationshipType,\n\tContactSocialType,\n\tContactWebsiteType,\n\tGroupType,\n\tKeys,\n} from \"../../common/api/common/TutanotaConstants\"\nimport {\n\tContact,\n\tContactAddress,\n\tContactCustomDate,\n\tContactMailAddress,\n\tContactMessengerHandle,\n\tContactPhoneNumber,\n\tContactPronouns,\n\tContactRelationship,\n\tContactSocialId,\n\tContactWebsite,\n\tcreateBirthday,\n\tcreateContact,\n\tcreateContactAddress,\n\tcreateContactCustomDate,\n\tcreateContactMailAddress,\n\tcreateContactMessengerHandle,\n\tcreateContactPhoneNumber,\n\tcreateContactPronouns,\n\tcreateContactRelationship,\n\tcreateContactSocialId,\n\tcreateContactWebsite,\n} from \"../../common/api/entities/tutanota/TypeRefs.js\"\nimport { assertNotNull, clone, downcast, findAndRemove, lastIndex, lastThrow, noOp, typedEntries } from \"@tutao/tutanota-utils\"\nimport { assertMainOrNode } from \"../../common/api/common/Env\"\nimport { windowFacade } from \"../../common/misc/WindowFacade\"\nimport { LockedError, NotFoundError, PayloadTooLargeError } from \"../../common/api/common/error/RestError\"\nimport type { ButtonAttrs } from \"../../common/gui/base/Button.js\"\nimport { ButtonType } from \"../../common/gui/base/Button.js\"\nimport { birthdayToIsoDate } from \"../../common/api/common/utils/BirthdayUtils\"\nimport {\n\tContactCustomDateTypeToLabel,\n\tContactCustomWebsiteTypeToLabel,\n\tContactMailAddressTypeToLabel,\n\tContactMessengerHandleTypeToLabel,\n\tContactPhoneNumberTypeToLabel,\n\tContactRelationshipTypeToLabel,\n\tContactSocialTypeToLabel,\n\tgetContactAddressTypeLabel,\n\tgetContactCustomDateTypeToLabel,\n\tgetContactCustomWebsiteTypeToLabel,\n\tgetContactMessengerHandleTypeToLabel,\n\tgetContactPhoneNumberTypeLabel,\n\tgetContactRelationshipTypeToLabel,\n\tgetContactSocialTypeLabel,\n} from \"./view/ContactGuiUtils\"\nimport { parseBirthday } from \"../../common/misc/DateParser\"\nimport type { TextFieldAttrs } from \"../../common/gui/base/TextField.js\"\nimport { Autocapitalize, Autocomplete, TextField, TextFieldType } from \"../../common/gui/base/TextField.js\"\nimport { EntityClient } from \"../../common/api/common/EntityClient\"\nimport { timestampToGeneratedId } from \"../../common/api/common/utils/EntityUtils\"\nimport { AggregateEditorAttrs, ContactAggregateEditor } from \"./ContactAggregateEditor\"\nimport { DefaultAnimationTime } from \"../../common/gui/animation/Animations\"\nimport { DialogHeaderBarAttrs } from \"../../common/gui/base/DialogHeaderBar\"\nimport { ProgrammingError } from \"../../common/api/common/error/ProgrammingError.js\"\nimport { locator } from \"../../common/api/main/CommonLocator.js\"\nimport { formatDate } from \"../../common/misc/Formatter.js\"\nimport { PasswordField } from \"../../common/misc/passwords/PasswordField.js\"\n\nassertMainOrNode()\n\nconst TAG = \"[ContactEditor]\"\n\ninterface CompleteCustomDate extends ContactCustomDate {\n\tdate: string\n\tisValid: boolean\n}\n\nexport class ContactEditor {\n\tprivate readonly dialog: Dialog\n\tprivate hasInvalidBirthday: boolean\n\tprivate readonly mailAddresses: Array<[ContactMailAddress, Id]>\n\tprivate readonly phoneNumbers: Array<[ContactPhoneNumber, Id]>\n\tprivate readonly addresses: Array<[ContactAddress, Id]>\n\tprivate readonly socialIds: Array<[ContactSocialId, Id]>\n\tprivate readonly websites: Array<[ContactWebsite, Id]>\n\tprivate readonly relationships: Array<[ContactRelationship, Id]>\n\tprivate readonly messengerHandles: Array<[ContactMessengerHandle, Id]>\n\tprivate readonly pronouns: Array<[ContactPronouns, Id]>\n\tprivate readonly customDates: Array<[CompleteCustomDate, Id]>\n\tprivate birthday: string\n\twindowCloseUnsubscribe: () => unknown\n\tprivate readonly isNewContact: boolean\n\tprivate readonly contact: Contact\n\tprivate readonly listId: Id\n\n\tprivate saving: boolean = false\n\n\t/*\n\t * The contact that should be update or the contact list that the new contact should be written to must be provided\n\t * @param entityClient\n\t * @param contact An existing or new contact. If null a new contact is created.\n\t * @param listId The list id of the new contact.\n\t * @param newContactIdReceiver. Is called receiving the contact id as soon as the new contact was saved.\n\t */\n\tconstructor(\n\t\tprivate readonly entityClient: EntityClient,\n\t\tcontact: Contact | null,\n\t\tlistId?: Id,\n\t\tprivate readonly newContactIdReceiver: ((contactId: Id) => unknown) | null = null,\n\t) {\n\t\tthis.contact = contact\n\t\t\t? clone(contact)\n\t\t\t: createContact({\n\t\t\t\t\tmailAddresses: [],\n\t\t\t\t\ttitle: null,\n\t\t\t\t\tsocialIds: [],\n\t\t\t\t\trole: \"\",\n\t\t\t\t\tpresharedPassword: null,\n\t\t\t\t\tphoto: null,\n\t\t\t\t\tphoneNumbers: [],\n\t\t\t\t\toldBirthdayDate: null,\n\t\t\t\t\tnickname: null,\n\t\t\t\t\tlastName: \"\",\n\t\t\t\t\tfirstName: \"\",\n\t\t\t\t\tcompany: \"\",\n\t\t\t\t\tcomment: \"\",\n\t\t\t\t\tbirthdayIso: null,\n\t\t\t\t\taddresses: [],\n\t\t\t\t\toldBirthdayAggregate: null,\n\t\t\t\t\tdepartment: null,\n\t\t\t\t\tmiddleName: null,\n\t\t\t\t\tnameSuffix: null,\n\t\t\t\t\tphoneticFirst: null,\n\t\t\t\t\tphoneticLast: null,\n\t\t\t\t\tphoneticMiddle: null,\n\t\t\t\t\tcustomDate: [],\n\t\t\t\t\tmessengerHandles: [],\n\t\t\t\t\tpronouns: [],\n\t\t\t\t\trelationships: [],\n\t\t\t\t\twebsites: [],\n\t\t\t  })\n\t\tthis.isNewContact = contact?._id == null\n\n\t\tif (this.isNewContact && listId == null) {\n\t\t\tthrow new ProgrammingError(\"must provide contact with Id to edit or listId for the new contact\")\n\t\t} else {\n\t\t\tthis.listId = listId ? listId : assertNotNull(contact, \"got an existing contact without id\")._id[0]\n\t\t}\n\n\t\tconst id = (entity: { _id: Id }) => entity._id || this.newId()\n\n\t\tthis.mailAddresses = this.contact.mailAddresses.map((address) => [address, id(address)])\n\t\tthis.mailAddresses.push(this.newMailAddress())\n\t\tthis.phoneNumbers = this.contact.phoneNumbers.map((phoneNumber) => [phoneNumber, id(phoneNumber)])\n\t\tthis.phoneNumbers.push(this.newPhoneNumber())\n\t\tthis.addresses = this.contact.addresses.map((address) => [address, id(address)])\n\t\tthis.addresses.push(this.newAddress())\n\t\tthis.socialIds = this.contact.socialIds.map((socialId) => [socialId, id(socialId)])\n\t\tthis.socialIds.push(this.newSocialId())\n\n\t\tthis.websites = this.contact.websites.map((website) => [website, id(website)])\n\t\tthis.websites.push(this.newWebsite())\n\t\tthis.relationships = this.contact.relationships.map((relation) => [relation, id(relation)])\n\t\tthis.relationships.push(this.newRelationship())\n\t\tthis.messengerHandles = this.contact.messengerHandles.map((handler) => [handler, id(handler)])\n\t\tthis.messengerHandles.push(this.newMessengerHandler())\n\t\tthis.pronouns = this.contact.pronouns.map((pronoun) => [pronoun, id(pronoun)])\n\t\tthis.pronouns.push(this.newPronoun())\n\t\tthis.customDates = this.contact.customDate.map((date) => [\n\t\t\t{\n\t\t\t\t...date,\n\t\t\t\tdate: formatContactDate(date.dateIso),\n\t\t\t\tisValid: true,\n\t\t\t},\n\t\t\tid(date),\n\t\t])\n\t\tthis.customDates.push(this.newCustomDate())\n\n\t\tthis.hasInvalidBirthday = false\n\t\tthis.birthday = formatContactDate(this.contact.birthdayIso) || \"\"\n\t\tthis.dialog = this.createDialog()\n\t\tthis.windowCloseUnsubscribe = noOp\n\t}\n\n\toncreate() {\n\t\tthis.windowCloseUnsubscribe = windowFacade.addWindowCloseListener(() => {})\n\t}\n\n\tonremove() {\n\t\tthis.windowCloseUnsubscribe()\n\t}\n\n\tview(): Children {\n\t\treturn m(\"#contact-editor\", [\n\t\t\tm(\".wrapping-row\", [this.renderFirstNameField(), this.renderLastNameField()]),\n\t\t\tm(\".wrapping-row\", [this.renderField(\"middleName\", \"middleName_placeholder\"), this.renderTitleField()]),\n\t\t\tm(\".wrapping-row\", [this.renderField(\"nameSuffix\", \"nameSuffix_placeholder\"), this.renderField(\"phoneticFirst\", \"phoneticFirst_placeholder\")]),\n\t\t\tm(\".wrapping-row\", [\n\t\t\t\tthis.renderField(\"phoneticMiddle\", \"phoneticMiddle_placeholder\"),\n\t\t\t\tthis.renderField(\"phoneticLast\", \"phoneticLast_placeholder\"),\n\t\t\t]),\n\t\t\tm(\".wrapping-row\", [this.renderField(\"nickname\", \"nickname_placeholder\"), this.renderBirthdayField()]),\n\t\t\tm(\".wrapping-row\", [\n\t\t\t\tthis.renderRoleField(),\n\t\t\t\tthis.renderField(\"department\", \"department_placeholder\"),\n\t\t\t\tthis.renderCompanyField(),\n\t\t\t\tthis.renderCommentField(),\n\t\t\t]),\n\t\t\tm(\".wrapping-row\", [\n\t\t\t\tm(\".custom-dates.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"dates_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.customDates.map(([date, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.customDates)\n\t\t\t\t\t\t\treturn this.renderCustomDatesEditor(id, !lastEditor, date)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t\tm(\".mail.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"email_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.mailAddresses.map(([address, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.mailAddresses)\n\t\t\t\t\t\t\treturn this.renderMailAddressesEditor(id, !lastEditor, address)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t\tm(\".phone.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"phone_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.phoneNumbers.map(([phoneNumber, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.phoneNumbers)\n\t\t\t\t\t\t\treturn this.renderPhonesEditor(id, !lastEditor, phoneNumber)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t\tm(\".relationship.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"relationships_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.relationships.map(([relationship, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.relationships)\n\t\t\t\t\t\t\treturn this.renderRelationshipsEditor(id, !lastEditor, relationship)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t\tm(\".address.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"address_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.addresses.map(([address, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.addresses)\n\t\t\t\t\t\t\treturn this.renderAddressesEditor(id, !lastEditor, address)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t]),\n\t\t\tm(\".wrapping-row\", [\n\t\t\t\tm(\".pronouns.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"pronouns_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.pronouns.map(([pronouns, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.pronouns)\n\t\t\t\t\t\t\treturn this.renderPronounsEditor(id, !lastEditor, pronouns)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t\tm(\".social.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"social_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.socialIds.map(([socialId, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.socialIds)\n\t\t\t\t\t\t\treturn this.renderSocialsEditor(id, !lastEditor, socialId)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t\tm(\".website.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"websites_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.websites.map(([website, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.websites)\n\t\t\t\t\t\t\treturn this.renderWebsitesEditor(id, !lastEditor, website)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t\tm(\".instant-message.mt-xl\", [\n\t\t\t\t\tm(\".h4\", lang.get(\"messenger_handles_label\")),\n\t\t\t\t\tm(\".aggregateEditors\", [\n\t\t\t\t\t\tthis.messengerHandles.map(([handle, id], index) => {\n\t\t\t\t\t\t\tconst lastEditor = index === lastIndex(this.messengerHandles)\n\t\t\t\t\t\t\treturn this.renderMessengerHandleEditor(id, !lastEditor, handle)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t]),\n\t\t\tthis.renderPresharedPasswordField(),\n\t\t\tm(\".pb\"),\n\t\t])\n\t}\n\n\tshow() {\n\t\tthis.dialog.show()\n\t}\n\n\tprivate close() {\n\t\tthis.dialog.close()\n\t}\n\n\t/**\n\t * * validate the input data\n\t * * create or update the contact, depending on status\n\t * * if successful, close the dialog.\n\t *\n\t * will not call the save function again if the operation is already running\n\t * @private\n\t */\n\tprivate async validateAndSave(): Promise<void> {\n\t\tif (this.hasInvalidBirthday) {\n\t\t\treturn Dialog.message(\"invalidBirthday_msg\")\n\t\t}\n\n\t\tif (this.saving) {\n\t\t\t// not showing a message. if the resource is locked, we'll show one when appropriate.\n\t\t\treturn\n\t\t}\n\t\tthis.saving = true\n\n\t\tthis.contact.mailAddresses = this.mailAddresses.map((e) => e[0]).filter((e) => e.address.trim().length > 0)\n\t\tthis.contact.phoneNumbers = this.phoneNumbers.map((e) => e[0]).filter((e) => e.number.trim().length > 0)\n\t\tthis.contact.addresses = this.addresses.map((e) => e[0]).filter((e) => e.address.trim().length > 0)\n\t\tthis.contact.socialIds = this.socialIds.map((e) => e[0]).filter((e) => e.socialId.trim().length > 0)\n\t\tthis.contact.customDate = this.customDates.map((e) => e[0] as ContactCustomDate).filter((e) => e.dateIso.trim().length > 0)\n\t\tthis.contact.relationships = this.relationships.map((e) => e[0]).filter((e) => e.person.trim().length > 0)\n\t\tthis.contact.websites = this.websites.map((e) => e[0]).filter((e) => e.url.length > 0)\n\t\tthis.contact.messengerHandles = this.messengerHandles.map((e) => e[0]).filter((e) => e.handle.length > 0)\n\t\tthis.contact.pronouns = this.pronouns.map((e) => e[0]).filter((e) => e.pronouns.length > 0)\n\t\ttry {\n\t\t\tif (this.isNewContact) {\n\t\t\t\tawait this.saveNewContact()\n\t\t\t} else {\n\t\t\t\tawait this.updateExistingContact()\n\t\t\t}\n\t\t\tthis.close()\n\t\t} catch (e) {\n\t\t\tthis.saving = false\n\t\t\tif (e instanceof PayloadTooLargeError) {\n\t\t\t\treturn Dialog.message(\"requestTooLarge_msg\")\n\t\t\t}\n\t\t\tif (e instanceof LockedError) {\n\t\t\t\treturn Dialog.message(\"operationStillActive_msg\")\n\t\t\t}\n\t\t}\n\t\t// if we got here, we're closing the dialog and don't have to reset this.saving\n\t}\n\n\tprivate async updateExistingContact(): Promise<void> {\n\t\ttry {\n\t\t\tawait this.entityClient.update(this.contact)\n\t\t} catch (e) {\n\t\t\tif (e instanceof NotFoundError) {\n\t\t\t\tconsole.log(TAG, `could not update contact ${this.contact._id}: not found`)\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async saveNewContact(): Promise<void> {\n\t\tthis.contact._ownerGroup = assertNotNull(\n\t\t\tlocator.logins.getUserController().user.memberships.find((m) => m.groupType === GroupType.Contact),\n\t\t\t\"did not find contact group membership\",\n\t\t).group\n\t\tconst contactId = await this.entityClient.setup(this.listId, this.contact)\n\t\tif (this.newContactIdReceiver) {\n\t\t\tthis.newContactIdReceiver(contactId)\n\t\t}\n\t}\n\n\tprivate renderCustomDatesEditor(id: Id, allowCancel: boolean, date: CompleteCustomDate): Children {\n\t\tlet dateHelpText = (): Translation => {\n\t\t\tlet bday = createBirthday({\n\t\t\t\tday: \"22\",\n\t\t\t\tmonth: \"9\",\n\t\t\t\tyear: \"2000\",\n\t\t\t})\n\t\t\treturn !date.isValid\n\t\t\t\t? lang.getTranslation(\"invalidDateFormat_msg\", {\n\t\t\t\t\t\t\"{1}\": formatBirthdayNumeric(bday),\n\t\t\t\t  })\n\t\t\t\t: lang.getTranslation(\"emptyString_msg\")\n\t\t}\n\n\t\tconst typeLabels: Array<[ContactCustomDateType, TranslationKey]> = typedEntries(ContactCustomDateTypeToLabel)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: date.date,\n\t\t\tfieldType: TextFieldType.Text,\n\t\t\tlabel: getContactCustomDateTypeToLabel(downcast(date.type), date.customTypeName),\n\t\t\thelpLabel: dateHelpText(),\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.customDates, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\tdate.date = value\n\t\t\t\tif (value.trim().length > 0) {\n\t\t\t\t\tlet parsedDate = parseBirthday(value, (referenceDate) => formatDate(referenceDate))\n\n\t\t\t\t\tif (parsedDate) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tdate.dateIso = birthdayToIsoDate(parsedDate)\n\t\t\t\t\t\t\tif (date === lastThrow(this.customDates)[0]) this.customDates.push(this.newCustomDate())\n\t\t\t\t\t\t\tdate.isValid = true\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tdate.isValid = false\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdate.isValid = false\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdate.isValid = true\n\t\t\t\t}\n\t\t\t},\n\t\t\tanimateCreate: !date.dateIso,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: (type) => this.onTypeSelected(type === ContactCustomDateType.CUSTOM, type, date),\n\t\t} satisfies AggregateEditorAttrs<any>)\n\t}\n\n\tprivate renderMailAddressesEditor(id: Id, allowCancel: boolean, mailAddress: ContactMailAddress): Children {\n\t\tlet helpLabel: TranslationKey\n\n\t\tif (mailAddress.address.trim().length > 0 && !isMailAddress(mailAddress.address.trim(), false)) {\n\t\t\thelpLabel = \"invalidInputFormat_msg\"\n\t\t} else {\n\t\t\thelpLabel = \"emptyString_msg\"\n\t\t}\n\n\t\tconst typeLabels: Array<[ContactAddressType, TranslationKey]> = typedEntries(ContactMailAddressTypeToLabel)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: mailAddress.address,\n\t\t\tfieldType: TextFieldType.Email,\n\t\t\tlabel: getContactAddressTypeLabel(downcast(mailAddress.type), mailAddress.customTypeName),\n\t\t\thelpLabel,\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.mailAddresses, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\tmailAddress.address = value\n\t\t\t\tif (mailAddress === lastThrow(this.mailAddresses)[0]) this.mailAddresses.push(this.newAddress())\n\t\t\t},\n\t\t\tanimateCreate: !mailAddress.address,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: (type) => this.onTypeSelected(type === ContactAddressType.CUSTOM, type, mailAddress),\n\t\t})\n\t}\n\n\tprivate renderPhonesEditor(id: Id, allowCancel: boolean, phoneNumber: ContactPhoneNumber): Children {\n\t\tconst typeLabels = typedEntries(ContactPhoneNumberTypeToLabel)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: phoneNumber.number,\n\t\t\tfieldType: TextFieldType.Text,\n\t\t\tlabel: getContactPhoneNumberTypeLabel(downcast(phoneNumber.type), phoneNumber.customTypeName),\n\t\t\thelpLabel: \"emptyString_msg\",\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.phoneNumbers, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\tphoneNumber.number = value\n\t\t\t\tif (phoneNumber === lastThrow(this.phoneNumbers)[0]) this.phoneNumbers.push(this.newPhoneNumber())\n\t\t\t},\n\t\t\tanimateCreate: !phoneNumber.number,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: (type) => this.onTypeSelected(type === ContactPhoneNumberType.CUSTOM, type, phoneNumber),\n\t\t})\n\t}\n\n\tprivate renderAddressesEditor(id: Id, allowCancel: boolean, address: ContactAddress): Children {\n\t\tconst typeLabels = typedEntries(ContactMailAddressTypeToLabel)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: address.address,\n\t\t\tfieldType: TextFieldType.Area,\n\t\t\tlabel: getContactAddressTypeLabel(downcast(address.type), address.customTypeName),\n\t\t\thelpLabel: \"emptyString_msg\",\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.addresses, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\taddress.address = value\n\t\t\t\tif (address === lastThrow(this.addresses)[0]) this.addresses.push(this.newAddress())\n\t\t\t},\n\t\t\tanimateCreate: !address.address,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: (type) => this.onTypeSelected(type === ContactAddressType.CUSTOM, type, address),\n\t\t})\n\t}\n\n\tprivate renderSocialsEditor(id: Id, allowCancel: boolean, socialId: ContactSocialId): Children {\n\t\tconst typeLabels = typedEntries(ContactSocialTypeToLabel)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: socialId.socialId,\n\t\t\tfieldType: TextFieldType.Text,\n\t\t\tlabel: getContactSocialTypeLabel(downcast<ContactSocialType>(socialId.type), socialId.customTypeName),\n\t\t\thelpLabel: \"emptyString_msg\",\n\t\t\tautocapitalizeTextField: Autocapitalize.none,\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.socialIds, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\tsocialId.socialId = value\n\t\t\t\tif (socialId === lastThrow(this.socialIds)[0]) this.socialIds.push(this.newSocialId())\n\t\t\t},\n\t\t\tanimateCreate: !socialId.socialId,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: (type) => this.onTypeSelected(type === ContactSocialType.CUSTOM, type, socialId),\n\t\t})\n\t}\n\n\tprivate renderWebsitesEditor(id: Id, allowCancel: boolean, website: ContactWebsite): Children {\n\t\tconst typeLabels = typedEntries(ContactCustomWebsiteTypeToLabel)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: website.url,\n\t\t\tfieldType: TextFieldType.Text,\n\t\t\tlabel: getContactCustomWebsiteTypeToLabel(downcast<ContactWebsiteType>(website.type), website.customTypeName),\n\t\t\thelpLabel: \"emptyString_msg\",\n\t\t\tautocapitalizeTextField: Autocapitalize.none,\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.websites, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\twebsite.url = value\n\t\t\t\tif (website === lastThrow(this.websites)[0]) this.websites.push(this.newWebsite())\n\t\t\t},\n\t\t\tanimateCreate: !website.url,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: (type) => this.onTypeSelected(type === ContactWebsiteType.CUSTOM, type, website),\n\t\t})\n\t}\n\n\tprivate renderRelationshipsEditor(id: Id, allowCancel: boolean, relationship: ContactRelationship): Children {\n\t\tconst typeLabels = typedEntries(ContactRelationshipTypeToLabel)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: relationship.person,\n\t\t\tfieldType: TextFieldType.Text,\n\t\t\tlabel: getContactRelationshipTypeToLabel(downcast<ContactRelationshipType>(relationship.type), relationship.customTypeName),\n\t\t\thelpLabel: \"emptyString_msg\",\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.relationships, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\trelationship.person = value\n\t\t\t\tif (relationship === lastThrow(this.relationships)[0]) this.relationships.push(this.newRelationship())\n\t\t\t},\n\t\t\tanimateCreate: !relationship.person,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: (type) => this.onTypeSelected(type === ContactRelationshipType.CUSTOM, type, relationship),\n\t\t})\n\t}\n\n\tprivate renderMessengerHandleEditor(id: Id, allowCancel: boolean, messengerHandle: ContactMessengerHandle): Children {\n\t\tconst typeLabels = typedEntries(ContactMessengerHandleTypeToLabel)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: messengerHandle.handle,\n\t\t\tfieldType: TextFieldType.Text,\n\t\t\tlabel: getContactMessengerHandleTypeToLabel(downcast<ContactMessengerHandleType>(messengerHandle.type), messengerHandle.customTypeName),\n\t\t\thelpLabel: \"emptyString_msg\",\n\t\t\tautocapitalizeTextField: Autocapitalize.none,\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.messengerHandles, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\tmessengerHandle.handle = value\n\t\t\t\tif (messengerHandle === lastThrow(this.messengerHandles)[0]) this.messengerHandles.push(this.newMessengerHandler())\n\t\t\t},\n\t\t\tanimateCreate: !messengerHandle.handle,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: (type) => this.onTypeSelected(type === ContactMessengerHandleType.CUSTOM, type, messengerHandle),\n\t\t})\n\t}\n\n\tprivate renderPronounsEditor(id: Id, allowCancel: boolean, pronouns: ContactPronouns): Children {\n\t\tconst typeLabels = typedEntries({ \"0\": \"language_label\" } as Record<string, TranslationKey>)\n\t\treturn m(ContactAggregateEditor, {\n\t\t\tvalue: pronouns.pronouns,\n\t\t\tfieldType: TextFieldType.Text,\n\t\t\tlabel: lang.makeTranslation(\"lang\", pronouns.language),\n\t\t\thelpLabel: \"emptyString_msg\",\n\t\t\tautocapitalizeTextField: Autocapitalize.none,\n\t\t\tcancelAction: () => {\n\t\t\t\tfindAndRemove(this.pronouns, (t) => t[1] === id)\n\t\t\t},\n\t\t\tonUpdate: (value) => {\n\t\t\t\tpronouns.pronouns = value\n\t\t\t\tif (pronouns === lastThrow(this.pronouns)[0]) this.pronouns.push(this.newPronoun())\n\t\t\t},\n\t\t\tanimateCreate: !pronouns.pronouns,\n\t\t\tallowCancel,\n\t\t\tkey: id,\n\t\t\ttypeLabels,\n\t\t\tonTypeSelected: () => this.onLanguageSelect(pronouns),\n\t\t})\n\t}\n\n\tprivate renderCommentField(): Children {\n\t\treturn m(StandaloneField, {\n\t\t\tlabel: \"comment_label\",\n\t\t\tvalue: this.contact.comment,\n\t\t\toninput: (value) => (this.contact.comment = value),\n\t\t\ttype: TextFieldType.Area,\n\t\t})\n\t}\n\n\tprivate renderFirstNameField(): Children {\n\t\treturn m(StandaloneField, {\n\t\t\tlabel: \"firstName_placeholder\",\n\t\t\tvalue: this.contact.firstName,\n\t\t\toninput: (value) => (this.contact.firstName = value),\n\t\t})\n\t}\n\n\tprivate renderField(fieldName: keyof Contact, label: TranslationKey): Children {\n\t\treturn m(StandaloneField, {\n\t\t\tlabel,\n\t\t\tvalue: (this.contact[fieldName] ?? \"\") as string,\n\t\t\toninput: (value: string) => {\n\t\t\t\t// Typescript will complain about it as an Unnecessary type check, but when the code gets\n\t\t\t\t// transpiled to javascript, without the check, we can pass any value\n\t\t\t\tif (typeof value === \"string\") {\n\t\t\t\t\tthis.contact[fieldName] = downcast(value)\n\t\t\t\t}\n\t\t\t},\n\t\t} satisfies TextFieldAttrs)\n\t}\n\n\tprivate renderLastNameField(): Children {\n\t\treturn m(StandaloneField, {\n\t\t\tlabel: \"lastName_placeholder\",\n\t\t\tvalue: this.contact.lastName,\n\t\t\toninput: (value) => (this.contact.lastName = value),\n\t\t})\n\t}\n\n\tprivate renderBirthdayField(): Children {\n\t\tlet birthdayHelpText = () => {\n\t\t\tlet bday = createBirthday({\n\t\t\t\tday: \"22\",\n\t\t\t\tmonth: \"9\",\n\t\t\t\tyear: \"2000\",\n\t\t\t})\n\t\t\treturn this.hasInvalidBirthday\n\t\t\t\t? lang.get(\"invalidDateFormat_msg\", {\n\t\t\t\t\t\t\"{1}\": formatBirthdayNumeric(bday),\n\t\t\t\t  })\n\t\t\t\t: \"\"\n\t\t}\n\n\t\treturn m(StandaloneField, {\n\t\t\tlabel: \"birthday_alt\",\n\t\t\tvalue: this.birthday,\n\t\t\thelpLabel: birthdayHelpText,\n\t\t\toninput: (value) => {\n\t\t\t\tthis.birthday = value\n\t\t\t\tif (value.trim().length === 0) {\n\t\t\t\t\tthis.contact.birthdayIso = null\n\t\t\t\t\tthis.hasInvalidBirthday = false\n\t\t\t\t} else {\n\t\t\t\t\tlet birthday = parseBirthday(value, (referenceDate) => formatDate(referenceDate))\n\n\t\t\t\t\tif (birthday) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.contact.birthdayIso = birthdayToIsoDate(birthday)\n\t\t\t\t\t\t\tthis.hasInvalidBirthday = false\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthis.hasInvalidBirthday = true\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.hasInvalidBirthday = true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t})\n\t}\n\n\tprivate renderCompanyField(): Children {\n\t\treturn m(StandaloneField, {\n\t\t\tlabel: \"company_label\",\n\t\t\tvalue: this.contact.company,\n\t\t\toninput: (value) => (this.contact.company = value),\n\t\t})\n\t}\n\n\tprivate renderRoleField(): Children {\n\t\treturn m(StandaloneField, {\n\t\t\tlabel: \"role_placeholder\",\n\t\t\tvalue: this.contact.role,\n\t\t\toninput: (value) => (this.contact.role = value),\n\t\t})\n\t}\n\n\tprivate renderTitleField(): Children {\n\t\treturn m(StandaloneField, {\n\t\t\tlabel: \"title_placeholder\",\n\t\t\tvalue: this.contact.title || \"\",\n\t\t\toninput: (value) => (this.contact.title = value),\n\t\t})\n\t}\n\n\tprivate renderPresharedPasswordField(): Children {\n\t\tif (!this.isNewContact && !this.contact.presharedPassword) {\n\t\t\treturn null\n\t\t}\n\n\t\treturn m(\".wrapping-row\", [\n\t\t\tm(\".passwords.mt-xl\", [\n\t\t\t\tm(\".h4\", lang.get(\"presharedPassword_label\")),\n\t\t\t\tm(PasswordField, {\n\t\t\t\t\tvalue: this.contact.presharedPassword ?? \"\",\n\t\t\t\t\tautocompleteAs: Autocomplete.newPassword,\n\t\t\t\t\toninput: (value) => (this.contact.presharedPassword = value),\n\t\t\t\t}),\n\t\t\t]),\n\t\t\tm(\".spacer\"),\n\t\t])\n\t}\n\n\tprivate createCloseButtonAttrs(): ButtonAttrs {\n\t\treturn {\n\t\t\tlabel: \"close_alt\",\n\t\t\tclick: () => this.close(),\n\t\t\ttype: ButtonType.Secondary,\n\t\t}\n\t}\n\n\tprivate newPhoneNumber(): [ContactPhoneNumber, Id] {\n\t\tconst phoneNumber = createContactPhoneNumber({\n\t\t\ttype: ContactPhoneNumberType.MOBILE,\n\t\t\tcustomTypeName: \"\",\n\t\t\tnumber: \"\",\n\t\t})\n\t\treturn [phoneNumber, this.newId()]\n\t}\n\n\tprivate newMailAddress(): [ContactMailAddress, Id] {\n\t\tconst mailAddress = createContactMailAddress({\n\t\t\ttype: ContactAddressType.WORK,\n\t\t\tcustomTypeName: \"\",\n\t\t\taddress: \"\",\n\t\t})\n\t\treturn [mailAddress, this.newId()]\n\t}\n\n\tprivate newAddress(): [ContactAddress, Id] {\n\t\tconst address = createContactAddress({\n\t\t\ttype: ContactAddressType.WORK,\n\t\t\tcustomTypeName: \"\",\n\t\t\taddress: \"\",\n\t\t})\n\t\treturn [address, this.newId()]\n\t}\n\n\tprivate newSocialId(): [ContactSocialId, Id] {\n\t\tconst socialId = createContactSocialId({\n\t\t\ttype: ContactSocialType.TWITTER,\n\t\t\tcustomTypeName: \"\",\n\t\t\tsocialId: \"\",\n\t\t})\n\t\treturn [socialId, this.newId()]\n\t}\n\n\tprivate newRelationship(): [ContactRelationship, Id] {\n\t\tconst relationship = createContactRelationship({\n\t\t\tperson: \"\",\n\t\t\ttype: ContactRelationshipType.ASSISTANT,\n\t\t\tcustomTypeName: \"\",\n\t\t})\n\t\treturn [relationship, this.newId()]\n\t}\n\n\tprivate newMessengerHandler(): [ContactMessengerHandle, Id] {\n\t\tconst messengerHandler = createContactMessengerHandle({\n\t\t\thandle: \"\",\n\t\t\ttype: ContactMessengerHandleType.SIGNAL,\n\t\t\tcustomTypeName: \"\",\n\t\t})\n\t\treturn [messengerHandler, this.newId()]\n\t}\n\n\tprivate newPronoun(): [ContactPronouns, Id] {\n\t\tconst contactPronouns = createContactPronouns({\n\t\t\tlanguage: \"\",\n\t\t\tpronouns: \"\",\n\t\t})\n\t\treturn [contactPronouns, this.newId()]\n\t}\n\n\tprivate newCustomDate(): [CompleteCustomDate, Id] {\n\t\tconst contactDate = createContactCustomDate({\n\t\t\tdateIso: \"\",\n\t\t\ttype: ContactCustomDateType.ANNIVERSARY,\n\t\t\tcustomTypeName: \"\",\n\t\t})\n\t\treturn [{ ...contactDate, date: \"\", isValid: true }, this.newId()]\n\t}\n\n\tprivate newWebsite(): [ContactWebsite, Id] {\n\t\tconst website = createContactWebsite({\n\t\t\ttype: ContactWebsiteType.PRIVATE,\n\t\t\turl: \"\",\n\t\t\tcustomTypeName: \"\",\n\t\t})\n\t\treturn [website, this.newId()]\n\t}\n\n\tprivate newId(): Id {\n\t\treturn timestampToGeneratedId(Date.now())\n\t}\n\n\tprivate onTypeSelected<\n\t\tK,\n\t\tT extends {\n\t\t\ttype: K\n\t\t\tcustomTypeName: string\n\t\t},\n\t>(isCustom: boolean, key: K, aggregate: T): void {\n\t\tif (isCustom) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tDialog.showTextInputDialog({\n\t\t\t\t\ttitle: \"customLabel_label\",\n\t\t\t\t\tlabel: \"customLabel_label\",\n\t\t\t\t\tdefaultValue: aggregate.customTypeName,\n\t\t\t\t}).then((name) => {\n\t\t\t\t\taggregate.customTypeName = name\n\t\t\t\t\taggregate.type = key\n\t\t\t\t})\n\t\t\t}, DefaultAnimationTime) // wait till the dropdown is hidden\n\t\t} else {\n\t\t\taggregate.type = key\n\t\t}\n\t}\n\n\tprivate onLanguageSelect(pronouns: ContactPronouns): void {\n\t\tsetTimeout(() => {\n\t\t\tDialog.showTextInputDialog({\n\t\t\t\ttitle: \"language_label\",\n\t\t\t\tlabel: \"language_label\",\n\t\t\t\tdefaultValue: pronouns.language.length > 0 ? pronouns.language : \"\",\n\t\t\t}).then((name) => {\n\t\t\t\tpronouns.language = name\n\t\t\t})\n\t\t}, DefaultAnimationTime) // wait till the dropdown is hidden\n\t}\n\n\tprivate createDialog(): Dialog {\n\t\tconst headerBarAttrs: DialogHeaderBarAttrs = {\n\t\t\tleft: [this.createCloseButtonAttrs()],\n\t\t\tmiddle: lang.makeTranslation(\"name\", this.contact.firstName + \" \" + this.contact.lastName),\n\t\t\tright: [\n\t\t\t\t{\n\t\t\t\t\tlabel: \"save_action\",\n\t\t\t\t\tclick: () => this.validateAndSave(),\n\t\t\t\t\ttype: ButtonType.Primary,\n\t\t\t\t},\n\t\t\t],\n\t\t}\n\t\treturn Dialog.largeDialog(headerBarAttrs, this)\n\t\t\t.addShortcut({\n\t\t\t\tkey: Keys.ESC,\n\t\t\t\texec: () => this.close(),\n\t\t\t\thelp: \"close_alt\",\n\t\t\t})\n\t\t\t.addShortcut({\n\t\t\t\tkey: Keys.S,\n\t\t\t\tctrlOrCmd: true,\n\t\t\t\texec: () => {\n\t\t\t\t\t// noinspection JSIgnoredPromiseFromCall\n\t\t\t\t\tthis.validateAndSave()\n\t\t\t\t},\n\t\t\t\thelp: \"save_action\",\n\t\t\t})\n\t\t\t.setCloseHandler(() => this.close())\n\t}\n}\n\n/** Renders TextField with wrapper and padding element to align them all. */\nclass StandaloneField implements Component<TextFieldAttrs> {\n\tview({ attrs }: Vnode<TextFieldAttrs>): Children {\n\t\treturn m(\".flex.child-grow\", [m(TextField, attrs), m(\".icon-button\")])\n\t}\n}\n"],"mappings":"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"}