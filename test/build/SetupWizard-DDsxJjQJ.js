
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { mithril_default } from "./mithril-Csg4iNnm.js";
import { defer } from "./dist-CJHwsXKY.js";
import "./dist-Rk9U8Iqn.js";
import "./ProgrammingError-D8yJGVtm.js";
import { isAndroidApp } from "./Env-D5xGlXfw.js";
import "./WhitelabelCustomizations-D1L5qbZi.js";
import { lang } from "./LanguageViewModel-BNC5ekpO.js";
import { themeOptions } from "./HtmlUtils-C-ecR7U7.js";
import { client } from "./ClientDetector-D0v6Vqu6.js";
import "./TutanotaConstants-3bwAESYA.js";
import { BaseButton } from "./Icon-BuqNK7vz.js";
import "./Icons-Dl3nFav5.js";
import "./KeyManager-B0OGXEyJ.js";
import "./WindowFacade-B9kSBKw7.js";
import "./Modal-g4c-b9IU.js";
import { Dialog, DialogType, liveDataAttrs } from "./Dialog-B6-HFvZd.js";
import "./CountryList-DkVQtcTj.js";
import "./IconButton-DsU60HJ_.js";
import "./RestError-D17JEBMr.js";
import "./SuspensionError-okvIjE4H.js";
import "./LoginIncompleteError-CpiW0a0l.js";
import "./CryptoError-PqdvQky4.js";
import "./error-DDmy0eAT.js";
import { CredentialAuthenticationError } from "./ErrorUtils-o1-v67Dd.js";
import "./RecipientsNotFoundError-D8oGE7A_.js";
import "./OfflineDbClosedError-CAwHTI6J.js";
import "./OutOfSyncError-Ck2yBBO8.js";
import "./DbError-CcwZaPG2.js";
import "./QuotaExceededError-nFM6SdTn.js";
import { CancelledError } from "./CancelledError-FjP5S_cR.js";
import "./FileOpenError-C1_8yoXr.js";
import "./DeviceStorageUnavailableError-m4Jk_0xN.js";
import "./MailBodyTooLargeError-C2i0rX_0.js";
import "./ImportError-CIXw37Kv.js";
import "./PermissionError-BGDsHuAh.js";
import "./KeyPermanentlyInvalidatedError-DJjt81rl.js";
import "./ParserCombinator-D38ofgFx.js";
import "./ExportError-DzgStBnl.js";
import "./stream-u2PttBAC.js";
import { locator$1 as locator } from "./CommonLocator-Csg4iNnm.js";
import "./BannerButton-BeplPQdI.js";
import { LoginButton } from "./LoginButton-DzCRy0Yt.js";
import { AppLockMethod } from "./AppLockMethod-FYee_oY4.js";
import { RadioSelector } from "./RadioSelector-DRfVlwef.js";
import { PermissionType$1 as PermissionType } from "./PermissionType-Bwii3hCe.js";
import { NotificationPermissionsBody, renderSettingsBannerButton } from "./NotificationPermissionsDialog-7FjM--O-.js";
import { WizardEventType, createWizardDialog, emitWizardEvent, wizardPageWrapper } from "./WizardDialog-DYBfLN1U.js";

//#region ../src/common/native/main/wizard/setupwizardpages/SetupPageLayout.ts
var SetupPageLayout = class {
	view({ attrs, children }) {
		return mithril_default("section.center.flex.flex-column.dialog-height-small.mt", [
			mithril_default("img.onboarding-logo.center-h", {
				src: `${window.tutao.appState.prefixWithoutFile}/images/onboarding-wizard/${attrs.image}.svg`,
				alt: "",
				rel: "noreferrer",
				loading: "lazy",
				decoding: "async",
				class: attrs.class
			}),
			children,
			mithril_default(LoginButton, {
				label: attrs.buttonLabel ?? "next_action",
				class: "wizard-next-button",
				onclick: (_, dom) => {
					emitWizardEvent(dom, WizardEventType.SHOW_NEXT_PAGE);
				}
			})
		]);
	}
};

//#endregion
//#region ../src/common/native/main/wizard/setupwizardpages/SetupCongraulationsPage.ts
var SetupCongratulationsPage = class {
	view() {
		return mithril_default(SetupPageLayout, {
			image: "congratulations",
			class: "onboarding-logo-large"
		}, [mithril_default("h2.mt-l.b", lang.get("welcome_text")), mithril_default("p.mt-s.full-width", lang.get("onboarding_text"))]);
	}
};
var SetupCongratulationsPageAttrs = class {
	preventGoBack = true;
	hidePagingButtonForPage = false;
	data = null;
	headerTitle() {
		return "welcome_label";
	}
	nextAction(showDialogs) {
		return Promise.resolve(true);
	}
	isSkipAvailable() {
		return false;
	}
	isEnabled() {
		return true;
	}
};

//#endregion
//#region ../src/common/native/main/wizard/setupwizardpages/SetupNotificationsPage.ts
var SetupNotificationsPage = class {
	view({ attrs }) {
		return mithril_default(SetupPageLayout, { image: "notifications" }, mithril_default(NotificationPermissionsBody, {
			isNotificationPermissionGranted: attrs.data.isNotificationPermissionGranted,
			isBatteryPermissionGranted: attrs.data.isBatteryPermissionGranted,
			askForNotificationPermission: (isGranted) => attrs.setIsNotificationPermissionGranted(isGranted),
			askForBatteryNotificationPermission: (isGranted) => attrs.setIsBatteryNotificationPermissionGranted(isGranted)
		}));
	}
};
var SetupNotificationsPageAttrs = class {
	hidePagingButtonForPage = false;
	data;
	isPageVisible;
	constructor(permissionData, visiblityStream, systemPermissionHandler) {
		this.systemPermissionHandler = systemPermissionHandler;
		this.isPageVisible = this.isPageNeeded(permissionData);
		this.data = permissionData;
		visiblityStream.map((isVisible) => {
			if (isVisible) this.systemPermissionHandler.queryPermissionsState([PermissionType.Notification, PermissionType.IgnoreBatteryOptimization]).then((permissionState) => {
				this.data = {
					isNotificationPermissionGranted: permissionState.get(PermissionType.Notification) ?? false,
					isBatteryPermissionGranted: permissionState.get(PermissionType.IgnoreBatteryOptimization) ?? false
				};
				mithril_default.redraw();
			});
		});
	}
	setIsNotificationPermissionGranted(isGranted) {
		this.data = {
			...this.data,
			isNotificationPermissionGranted: isGranted
		};
		mithril_default.redraw();
	}
	setIsBatteryNotificationPermissionGranted(isGranted) {
		this.data = {
			...this.data,
			isBatteryPermissionGranted: isGranted
		};
		mithril_default.redraw();
	}
	isPageNeeded(data) {
		if (isAndroidApp()) return !data.isNotificationPermissionGranted || !data.isBatteryPermissionGranted;
		return !data.isNotificationPermissionGranted;
	}
	headerTitle() {
		return "notificationSettings_action";
	}
	nextAction(showDialogs) {
		return Promise.resolve(true);
	}
	isSkipAvailable() {
		return false;
	}
	isEnabled() {
		return this.isPageVisible;
	}
};

//#endregion
//#region ../src/common/native/main/wizard/setupwizardpages/SetupThemePage.ts
var SetupThemePage = class {
	customThemes = null;
	oninit() {
		locator.themeController.getCustomThemes().then((customThemes) => {
			this.customThemes = customThemes.map((themeId) => {
				return {
					name: lang.makeTranslation(themeId, themeId),
					value: themeId
				};
			});
			mithril_default.redraw();
		});
	}
	view() {
		return mithril_default(
			SetupPageLayout,
			{ image: "theme" },
			mithril_default("p.full-width", lang.get("theme_title")),
			// We need to await the promise from `themeController.getCustomThemes()`, so we delay rendering the `RadioSelector` until it does.
			this.customThemes == null ? null : mithril_default(RadioSelector, {
				name: "theme_label",
				options: [...themeOptions(client.isCalendarApp()), ...this.customThemes],
				class: "mb-s",
				selectedOption: locator.themeController.themePreference,
				onOptionSelected: (option) => {
					locator.themeController.setThemePreference(option, true);
				}
			})
);
	}
};
var SetupThemePageAttrs = class {
	hidePagingButtonForPage = false;
	data = null;
	headerTitle() {
		return "appearanceSettings_label";
	}
	nextAction(showDialogs) {
		return Promise.resolve(true);
	}
	isSkipAvailable() {
		return false;
	}
	isEnabled() {
		return true;
	}
};

//#endregion
//#region ../src/common/native/main/wizard/setupwizardpages/SetupContactsPage.ts
var SetupContactsPage = class {
	view({ attrs }) {
		return mithril_default(SetupPageLayout, { image: "contacts" }, this.renderImportAndSyncButtons(attrs));
	}
	renderImportAndSyncButtons(attrs) {
		const isContactSyncEnabled = attrs.syncManager.isEnabled();
		return [
			mithril_default("p.mb-s", lang.get("importContacts_msg")),
			renderSettingsBannerButton("import_action", () => {
				attrs.contactImporter.importContactsFromDeviceSafely();
			}),
			mithril_default("p.mb-s", lang.get("allowContactSynchronization")),
			renderSettingsBannerButton(isContactSyncEnabled ? "activated_label" : "activate_action", () => {
				this.enableSync(attrs);
			}, isContactSyncEnabled, "mb-l")
		];
	}
	async enableSync(attrs) {
		const success = await attrs.syncManager.enableSync();
		if (!success) {
			await attrs.syncManager.disableSync();
			await Dialog.message("allowContactReadWrite_msg");
			await attrs.mobileSystemFacade.goToSettings();
		}
	}
};
var SetupContactsPageAttrs = class {
	hidePagingButtonForPage = false;
	data = null;
	constructor(syncManager, contactImporter, mobileSystemFacade, allowContactSyncAndImport) {
		this.syncManager = syncManager;
		this.contactImporter = contactImporter;
		this.mobileSystemFacade = mobileSystemFacade;
		this.allowContactSyncAndImport = allowContactSyncAndImport;
	}
	headerTitle() {
		return "contacts_label";
	}
	nextAction(showDialogs) {
		return Promise.resolve(true);
	}
	isSkipAvailable() {
		return false;
	}
	isEnabled() {
		return this.allowContactSyncAndImport;
	}
};

//#endregion
//#region ../src/common/native/main/SelectAppLockMethodDialog.ts
var SelectAppLockMethodView = class {
	currentMethod;
	constructor({ attrs }) {
		this.currentMethod = attrs.previousSelection;
	}
	view({ attrs }) {
		const options = this.getSupportedOptions(attrs);
		const { onConfirm } = attrs;
		return [mithril_default(".flex.col", { class: attrs.class }, [
			attrs.error ? mithril_default(".small.center.statusTextColor.pb-s", liveDataAttrs(), attrs.error) : null,
			mithril_default("", lang.get("credentialsEncryptionModeSelection_msg")),
			mithril_default(".mt", mithril_default(RadioSelector, {
				name: "credentialsEncryptionMode_label",
				options,
				selectedOption: this.currentMethod,
				onOptionSelected: (mode) => {
					this.currentMethod = mode;
					attrs.onModeSelected?.(mode);
				}
			}))
		]), onConfirm ? this.renderSelectButton(() => onConfirm(this.currentMethod)) : null];
	}
	getSupportedOptions(attrs) {
		const generateOption = (name, value) => ({
			name,
			value
		});
		const options = [
			generateOption("credentialsEncryptionModeDeviceLock_label", AppLockMethod.None),
			generateOption("credentialsEncryptionModeDeviceCredentials_label", AppLockMethod.SystemPassOrBiometrics),
			generateOption("credentialsEncryptionModeBiometrics_label", AppLockMethod.Biometrics)
		];
		return options.filter((option) => attrs.supportedModes.includes(option.value));
	}
	renderSelectButton(onclick) {
		return mithril_default(BaseButton, {
			label: "ok_action",
			text: lang.get("ok_action"),
			class: "uppercase accent-bg full-width center b content-fg flash",
			style: { height: "60px" },
			onclick
		});
	}
};

//#endregion
//#region ../src/common/native/main/wizard/setupwizardpages/SetupLockPage.ts
var SetupLockPage = class {
	view({ attrs }) {
		return mithril_default(SetupPageLayout, {
			image: "lock",
			buttonLabel: "finish_action"
		}, [mithril_default(SelectAppLockMethodView, {
			class: "mt",
			error: attrs.error,
			supportedModes: attrs.supportedModes,
			previousSelection: attrs.currentMode,
			onConfirm: null,
			onModeSelected: (mode) => attrs.currentMode = mode
		})]);
	}
};
var SetupLockPageAttrs = class {
	hidePagingButtonForPage = false;
	data = null;
	error = null;
	supportedModes = [];
	currentMode = AppLockMethod.None;
	constructor(mobileSystemFacade) {
		this.mobileSystemFacade = mobileSystemFacade;
		mobileSystemFacade.getSupportedAppLockMethods().then((supportedMethods) => {
			this.supportedModes = supportedMethods;
			mithril_default.redraw();
		});
		this.mobileSystemFacade.getAppLockMethod().then((appLockMethod) => {
			this.currentMode = appLockMethod;
			mithril_default.redraw();
		});
	}
	headerTitle() {
		return "credentialsEncryptionMode_label";
	}
	async nextAction(showDialogs) {
		try {
			await this.mobileSystemFacade.enforceAppLock(this.currentMode);
			await this.mobileSystemFacade.setAppLockMethod(this.currentMode);
		} catch (e) {
			if (e instanceof CredentialAuthenticationError) {
				this.error = e.message;
				mithril_default.redraw();
				return false;
			} else if (e instanceof CancelledError) return false;
else throw e;
		}
		return true;
	}
	isSkipAvailable() {
		return false;
	}
	isEnabled() {
		return this.supportedModes.length > 1;
	}
};

//#endregion
//#region ../src/common/native/main/wizard/SetupWizard.ts
async function showSetupWizard(systemPermissionHandler, webMobileFacade, contactImporter, systemFacade, credentialsProvider, contactSyncManager, deviceConfig, allowContactSyncAndImport) {
	const permissionStatus = await systemPermissionHandler.queryPermissionsState([
		PermissionType.Contacts,
		PermissionType.Notification,
		PermissionType.IgnoreBatteryOptimization
	]);
	let wizardPages = [];
	wizardPages.push(wizardPageWrapper(SetupCongratulationsPage, new SetupCongratulationsPageAttrs()));
	wizardPages.push(wizardPageWrapper(SetupNotificationsPage, new SetupNotificationsPageAttrs({
		isNotificationPermissionGranted: permissionStatus.get(PermissionType.Notification) ?? false,
		isBatteryPermissionGranted: permissionStatus.get(PermissionType.IgnoreBatteryOptimization) ?? false
	}, webMobileFacade.getIsAppVisible(), systemPermissionHandler)));
	wizardPages.push(wizardPageWrapper(SetupThemePage, new SetupThemePageAttrs()));
	if (allowContactSyncAndImport && contactSyncManager && contactImporter) wizardPages.push(wizardPageWrapper(SetupContactsPage, new SetupContactsPageAttrs(contactSyncManager, contactImporter, systemFacade, allowContactSyncAndImport)));
	wizardPages.push(wizardPageWrapper(SetupLockPage, new SetupLockPageAttrs(locator.systemFacade)));
	const deferred = defer();
	const wizardBuilder = createWizardDialog(null, wizardPages, async () => {
		deviceConfig.setIsSetupComplete(true);
		deferred.resolve();
	}, DialogType.EditSmall);
	wizardBuilder.dialog.show();
	return deferred.promise;
}

//#endregion
export { showSetupWizard };
//# sourceMappingURL=SetupWizard-DDsxJjQJ.js.map