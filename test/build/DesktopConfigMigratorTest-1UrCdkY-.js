
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { __export } from "./chunk-D_5_n1c4.js";
import { downcast } from "./dist-CJHwsXKY.js";
import "./dist-Rk9U8Iqn.js";
import "./ProgrammingError-D8yJGVtm.js";
import "./Env-D5xGlXfw.js";
import "./TutanotaConstants-3bwAESYA.js";
import "./CryptoError-PqdvQky4.js";
import "./CancelledError-FjP5S_cR.js";
import "./EntityUtils-RQxXZlcV.js";
import "./TypeModels-XIXYys8J.js";
import "./TypeModels-BktRFNDN.js";
import "./EntityFunctions-l6CncM5C.js";
import "./TypeModels-ZqCk-pGw.js";
import "./ModelInfo-DEa-Yxv2.js";
import "./dist-DcZ1Y4qd.js";
import "./IndexTables-C5S9WDY9.js";
import "./IndexUtils-K27esrGs.js";
import { DesktopConfigKey } from "./ConfigKeys-B1UD5FwS.js";
import { log } from "./DesktopLog-yAgEoQsh.js";
import "./IndexerCore-CrLYpsA5.js";
import { dist_default } from "./dist-Ci1bEzYU.js";
import "./testdouble-IbRSnrC0.js";
import "./dist-BY49f75m.js";
import { makeKeyStoreFacade } from "./TestUtils-f_4UhLVE.js";

//#region ../src/common/desktop/config/migrations/migration-0000.ts
var migration_0000_exports = {};
__export(migration_0000_exports, {
	migrateAdmin: () => migrateAdmin$9,
	migrateClient: () => migrateClient$9
});
async function migrate$6(oldConfig) {
	Object.assign(oldConfig, { desktopConfigVersion: 0 });
}
const migrateClient$9 = migrate$6;
const migrateAdmin$9 = migrate$6;

//#endregion
//#region ../src/common/desktop/config/migrations/migration-0001.ts
var migration_0001_exports = {};
__export(migration_0001_exports, {
	migrateAdmin: () => migrateAdmin$8,
	migrateClient: () => migrateClient$8
});
async function migrate$5(oldConfig) {
	Object.assign(oldConfig, {
		desktopConfigVersion: 1,
		showAutoUpdateOption: true
	});
}
const migrateClient$8 = migrate$5;
const migrateAdmin$8 = migrate$5;

//#endregion
//#region ../src/common/desktop/config/migrations/migration-0002.ts
var migration_0002_exports = {};
__export(migration_0002_exports, {
	migrateAdmin: () => migrateAdmin$7,
	migrateClient: () => migrateClient$7
});
async function migrate$4(oldConfig) {
	Object.assign(oldConfig, {
		desktopConfigVersion: 2,
		mailExportMode: process.platform === "win32" ? "msg" : "eml"
	});
}
const migrateClient$7 = migrate$4;
const migrateAdmin$7 = migrate$4;

//#endregion
//#region ../src/common/desktop/config/migrations/migration-0003.ts
var migration_0003_exports = {};
__export(migration_0003_exports, {
	migrateAdmin: () => migrateAdmin$6,
	migrateClient: () => migrateClient$6
});
async function migrate$3(oldConfig, crypto, keyStoreFacade) {
	Object.assign(oldConfig, { desktopConfigVersion: 3 });
	if (oldConfig.pushIdentifier) {
		try {
			const deviceKey = await keyStoreFacade.getDeviceKey();
			Object.assign(oldConfig, { sseInfo: crypto.aesEncryptObject(deviceKey, downcast(oldConfig.pushIdentifier)) });
		} catch (e) {
			log.warn("migration003: could not read device key, will not save sseInfo", e);
		}
		delete oldConfig.pushIdentifier;
	}
}
const migrateClient$6 = migrate$3;
const migrateAdmin$6 = migrate$3;

//#endregion
//#region ../src/common/desktop/config/migrations/migration-0004.ts
var migration_0004_exports = {};
__export(migration_0004_exports, {
	migrateAdmin: () => migrateAdmin$5,
	migrateClient: () => migrateClient$5
});
async function migrateSpellcheckTrue(oldConfig) {
	Object.assign(oldConfig, {
		desktopConfigVersion: 4,
		spellcheck: true
	});
}
async function migrateSpellcheckFalse(oldConfig) {
	Object.assign(oldConfig, {
		desktopConfigVersion: 4,
		spellcheck: false
	});
}
const migrateClient$5 = migrateSpellcheckTrue;
const migrateAdmin$5 = migrateSpellcheckFalse;

//#endregion
//#region ../src/common/desktop/config/migrations/migration-0005.ts
var migration_0005_exports = {};
__export(migration_0005_exports, {
	migrateAdmin: () => migrateAdmin$4,
	migrateClient: () => migrateClient$4
});
async function migrateSpellcheck(oldConfig, electron) {
	const currentLang = electron.session.defaultSession.getSpellCheckerLanguages()[0];
	const spellcheckActivated = oldConfig.spellcheck === true;
	Object.assign(oldConfig, {
		desktopConfigVersion: 5,
		spellcheck: spellcheckActivated && currentLang ? currentLang : ""
	});
}
const migrateClient$4 = migrateSpellcheck;
const migrateAdmin$4 = migrateSpellcheck;

//#endregion
//#region ../src/common/desktop/config/migrations/migration-0006.ts
var migration_0006_exports = {};
__export(migration_0006_exports, {
	migrateAdmin: () => migrateAdmin$3,
	migrateClient: () => migrateClient$3
});
async function migrate$2(oldConfig) {
	Object.assign(oldConfig, {
		desktopConfigVersion: 6,
		offlineStorageEnabled: false
	});
}
const migrateClient$3 = migrate$2;
const migrateAdmin$3 = migrate$2;

//#endregion
//#region ../src/common/desktop/config/migrations/migration-0007.ts
var migration_0007_exports = {};
__export(migration_0007_exports, {
	migrateAdmin: () => migrateAdmin$2,
	migrateClient: () => migrateClient$2
});
const newDefault = {
	rect: {
		x: 200,
		y: 200,
		width: 1200,
		height: 700
	},
	fullscreen: false,
	scale: 1
};
async function migrate$1(oldConfig) {
	let oldBounds = oldConfig[DesktopConfigKey.lastBounds];
	if (oldBounds == null) oldBounds = newDefault;
else if (oldBounds.rect.width === 800 && oldBounds.rect.height === 600) {
		oldBounds.rect.width = newDefault.rect.width;
		oldBounds.rect.height = newDefault.rect.height;
	}
	Object.assign(oldConfig, {
		lastBounds: oldBounds,
		desktopConfigVersion: 7
	});
}
const migrateClient$2 = migrate$1;
const migrateAdmin$2 = migrate$1;

//#endregion
//#region ../src/common/desktop/config/migrations/migration-0008.ts
var migration_0008_exports = {};
__export(migration_0008_exports, {
	migrateAdmin: () => migrateAdmin$1,
	migrateClient: () => migrateClient$1
});
/** add the appPin default value to the config */
async function migrate(oldConfig) {
	Object.assign(oldConfig, {
		desktopConfigVersion: 8,
		[DesktopConfigKey.appPassSalt]: null
	});
}
const migrateClient$1 = migrate;
const migrateAdmin$1 = migrate;

//#endregion
//#region ../src/common/desktop/config/migrations/migration-0009.ts
var migration_0009_exports = {};
__export(migration_0009_exports, {
	migrateAdmin: () => migrateAdmin,
	migrateClient: () => migrateClient
});
const migrateClient = async function(oldConfig) {
	Object.assign(oldConfig, {
		desktopConfigVersion: 9,
		[DesktopConfigKey.mailboxExportState]: {}
	});
};
const migrateAdmin = async (oldConfig) => {
	Object.assign(oldConfig, { desktopConfigVersion: 9 });
};

//#endregion
//#region ../src/common/desktop/config/migrations/DesktopConfigMigrator.ts
var DesktopConfigMigrator = class {
	crypto;
	_keyStoreFacade;
	_electron;
	constructor(crypto, keyStoreFacade, electron) {
		this.crypto = crypto;
		this._keyStoreFacade = keyStoreFacade;
		this._electron = electron;
	}
	async applyMigrations(migrationFunction, oldConfig) {
		switch (oldConfig.desktopConfigVersion) {
			case undefined: await applyMigration(migration_0000_exports[migrationFunction], oldConfig);
			case 0: await applyMigration(migration_0001_exports[migrationFunction], oldConfig);
			case 1: await applyMigration(migration_0002_exports[migrationFunction], oldConfig);
			case 2: await applyMigration((config) => migration_0003_exports[migrationFunction](config, this.crypto, this._keyStoreFacade), oldConfig);
			case 3: await applyMigration(migration_0004_exports[migrationFunction], oldConfig);
			case 4: await applyMigration((config) => migration_0005_exports[migrationFunction](config, this._electron), oldConfig);
			case 5: await applyMigration(migration_0006_exports[migrationFunction], oldConfig);
			case 6: await applyMigration(migration_0007_exports[migrationFunction], oldConfig);
			case 7: await applyMigration(migration_0008_exports[migrationFunction], oldConfig);
			case 8: await applyMigration(migration_0009_exports[migrationFunction], oldConfig);
			case 9:
				log.debug("config up to date");
				break;
			default: throw new Error(`unknown config version ${String(oldConfig.desktopConfigVersion)}`);
		}
		return oldConfig;
	}
};
/**
* @param migration name of the function to use for migration
* @param config default config to use if oldConfig is invalid
*/
async function applyMigration(migration, config) {
	const oldVersion = Object.freeze(config.desktopConfigVersion);
	await migration(config);
	const newVersion = config.desktopConfigVersion;
	if (newVersion === undefined || Number(oldVersion) >= Number(newVersion)) {
		console.error("config migration did not increment desktopConfigVersion! aborting.");
		process.exit(1);
	}
}

//#endregion
//#region tests/desktop/config/migrations/DesktopConfigMigratorTest.ts
dist_default.spec("DesktopConfigMigrator", function() {
	let migrator;
	let crypto;
	let keyStoreFacade;
	const key = new Uint8Array([
		1,
		2,
		3
	]);
	dist_default.before(function() {
		crypto = downcast({ aesEncryptObject: (encryptionKey, object) => {
			return JSON.stringify(object);
		} });
		const electron = downcast({ session: { defaultSession: { getSpellCheckerLanguages: () => ["de-DE"] } } });
		keyStoreFacade = makeKeyStoreFacade(key);
		migrator = new DesktopConfigMigrator(crypto, keyStoreFacade, electron);
	});
	dist_default("migrations result in correct default config, client", async function() {
		const oldConfig = {
			heartbeatTimeoutInSeconds: 30,
			defaultDownloadPath: null,
			enableAutoUpdate: true,
			runAsTrayApp: true,
			desktopConfigVersion: 1,
			showAutoUpdateOption: true,
			pushIdentifier: {
				identifier: "some identifier",
				sseOrigin: "some orign",
				userIds: ["userId1", "userId2"]
			}
		};
		const requiredResult = {
			heartbeatTimeoutInSeconds: 30,
			defaultDownloadPath: null,
			enableAutoUpdate: true,
			runAsTrayApp: true,
			desktopConfigVersion: 9,
			showAutoUpdateOption: true,
			spellcheck: "de-DE",
			offlineStorageEnabled: false,
			mailExportMode: "eml",
			sseInfo: JSON.stringify(oldConfig.pushIdentifier),
			lastBounds: {
				rect: {
					x: 200,
					y: 200,
					width: 1200,
					height: 700
				},
				fullscreen: false,
				scale: 1
			},
			appPassSalt: null,
			[DesktopConfigKey.mailboxExportState]: {}
		};
		dist_default(await migrator.applyMigrations("migrateClient", oldConfig)).deepEquals(requiredResult);
	});
	dist_default("migrations result in correct default config, admin", async function() {
		const oldConfig = { runAsTrayApp: true };
		const requiredResult = {
			appPassSalt: null,
			runAsTrayApp: true,
			desktopConfigVersion: 9,
			showAutoUpdateOption: true,
			mailExportMode: "eml",
			spellcheck: "",
			offlineStorageEnabled: false,
			lastBounds: {
				rect: {
					x: 200,
					y: 200,
					width: 1200,
					height: 700
				},
				fullscreen: false,
				scale: 1
			}
		};
		dist_default(await migrator.applyMigrations("migrateAdmin", oldConfig)).deepEquals(requiredResult);
	});
});

//#endregion
//# sourceMappingURL=DesktopConfigMigratorTest-1UrCdkY-.js.map