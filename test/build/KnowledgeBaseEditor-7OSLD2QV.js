
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { __toESM } from "./chunk-D_5_n1c4.js";
import { mithril_default } from "./mithril-Csg4iNnm.js";
import { LazyLoaded, clone, deduplicate, localeCompare, noOp, ofClass } from "./dist-CJHwsXKY.js";
import "./dist-Rk9U8Iqn.js";
import "./ProgrammingError-D8yJGVtm.js";
import "./Env-D5xGlXfw.js";
import "./WhitelabelCustomizations-D1L5qbZi.js";
import { lang } from "./LanguageViewModel-BNC5ekpO.js";
import "./HtmlUtils-C-ecR7U7.js";
import "./ClientDetector-D0v6Vqu6.js";
import "./TutanotaConstants-3bwAESYA.js";
import { ButtonColor, ButtonType } from "./Icon-BuqNK7vz.js";
import { Icons } from "./Icons-Dl3nFav5.js";
import "./KeyManager-B0OGXEyJ.js";
import "./WindowFacade-B9kSBKw7.js";
import "./Modal-g4c-b9IU.js";
import { Dialog, TextField, createAsyncDropdown } from "./Dialog-B6-HFvZd.js";
import "./CountryList-DkVQtcTj.js";
import { ButtonSize } from "./IconButton-DsU60HJ_.js";
import { NotFoundError } from "./RestError-D17JEBMr.js";
import "./SuspensionError-okvIjE4H.js";
import "./LoginIncompleteError-CpiW0a0l.js";
import "./CryptoError-PqdvQky4.js";
import "./error-DDmy0eAT.js";
import "./ErrorUtils-o1-v67Dd.js";
import "./RecipientsNotFoundError-D8oGE7A_.js";
import "./OfflineDbClosedError-CAwHTI6J.js";
import "./OutOfSyncError-Ck2yBBO8.js";
import "./DbError-CcwZaPG2.js";
import "./QuotaExceededError-nFM6SdTn.js";
import "./CancelledError-FjP5S_cR.js";
import "./FileOpenError-C1_8yoXr.js";
import "./DeviceStorageUnavailableError-m4Jk_0xN.js";
import "./MailBodyTooLargeError-C2i0rX_0.js";
import "./ImportError-CIXw37Kv.js";
import "./PermissionError-BGDsHuAh.js";
import "./KeyPermanentlyInvalidatedError-DJjt81rl.js";
import "./ParserCombinator-D38ofgFx.js";
import "./ExportError-DzgStBnl.js";
import { require_stream } from "./stream-u2PttBAC.js";
import { elementIdPart, getLetId, listIdPart } from "./EntityUtils-RQxXZlcV.js";
import "./CommonCalendarUtils-DKaO7v1K.js";
import "./Formatter-zB15D6XI.js";
import "./TypeModels-XIXYys8J.js";
import { EmailTemplateTypeRef, createKnowledgeBaseEntry, createKnowledgeBaseEntryKeyword } from "./TypeRefs-CR3TLWn0.js";
import "./TypeModels-BktRFNDN.js";
import "./TypeRefs-BP1jvX9p.js";
import "./TypeModels-ZqCk-pGw.js";
import "./EntityUpdateUtils-B5iTKMk4.js";
import { locator$1 as locator } from "./CommonLocator-Csg4iNnm.js";
import "./FormatValidator-2BBermUe.js";
import { UserError } from "./UserError-DfXlMLTl.js";
import "./MailAddressParser-BgYy6oyp.js";
import "./GroupUtils-0ZkLIAeC.js";
import "./DataFile-CY7uuk9j.js";
import "./FileUtils-W-u2-gZz.js";
import "./ProgressDialog-CJfJjh62.js";
import "./BlobUtils-D5ADcckZ.js";
import "./SharedMailUtils-AmFaSJP6.js";
import "./PasswordUtils-C4jlV9GF.js";
import "./Recipient-BFxhfecW.js";
import "./SubscriptionDialogs-DAlWs68I.js";
import "./ToggleButton-DxuDa0rS.js";
import "./SnackBar-CoP3lSVs.js";
import "./Credentials-BM35X_na.js";
import "./NotificationOverlay-C-YNCUiT.js";
import "./Checkbox-WCw-l_7A.js";
import "./Expander-Bautb1_0.js";
import "./ClipboardUtils-mz40UK5S.js";
import "./ErrorReporter-7sfLhWZg.js";
import "./Services-CupYet_j.js";
import "./BubbleButton-DGGInJMg.js";
import "./SessionType-rxSDsswH.js";
import "./PasswordField-CPKPoLq8.js";
import "./PasswordRequestDialog-B7ZIVTVw.js";
import { showUserError } from "./ErrorHandlerImpl-DRpk8tE9.js";
import { HtmlEditor } from "./HtmlEditor-DkqWVGt0.js";
import "./HtmlSanitizer-CA1YjlPp.js";
import { TEMPLATE_SHORTCUT_PREFIX } from "./TemplatePopupModel-Bv3eIGgN.js";

//#region ../src/mail-app/settings/KnowledgeBaseEditorModel.ts
var import_stream = __toESM(require_stream(), 1);
var KnowledgeBaseEditorModel = class {
	title;
	keywords;
	_entityClient;
	_templateGroupRoot;
	entry;
	availableTemplates;
	_descriptionProvider;
	constructor(entry, templateGroupInstances, entityClient) {
		this.title = (0, import_stream.default)(entry ? entry.title : "");
		this.keywords = (0, import_stream.default)(entry ? keywordsToString(entry.keywords) : "");
		this._entityClient = entityClient;
		this._templateGroupRoot = templateGroupInstances;
		this.entry = entry ? clone(entry) : createKnowledgeBaseEntry({
			description: "",
			title: "",
			keywords: []
		});
		this._descriptionProvider = null;
		this.availableTemplates = new LazyLoaded(() => {
			return this._entityClient.loadAll(EmailTemplateTypeRef, this._templateGroupRoot.templates);
		}, []);
	}
	isUpdate() {
		return this.entry._id != null;
	}
	save() {
		if (!this.title()) return Promise.reject(new UserError("emptyTitle_msg"));
		this.entry.title = this.title();
		this.entry.keywords = stringToKeywords(this.keywords());
		if (this._descriptionProvider) this.entry.description = this._descriptionProvider();
		if (this.entry._id) return this._entityClient.update(this.entry).catch(ofClass(NotFoundError, noOp));
else {
			this.entry._ownerGroup = this._templateGroupRoot._id;
			return this._entityClient.setup(this._templateGroupRoot.knowledgeBase, this.entry);
		}
	}
	setDescriptionProvider(provider) {
		this._descriptionProvider = provider;
	}
};
/**
* get keywords as a space separated string
* @param keywords
*/
function keywordsToString(keywords) {
	return keywords.map((keyword) => keyword.keyword).join(" ");
}
function stringToKeywords(keywords) {
	return deduplicate(keywords.split(" ").filter(Boolean)).sort(localeCompare).map((keyword) => createKnowledgeBaseEntryKeyword({ keyword }));
}

//#endregion
//#region ../src/mail-app/settings/KnowledgeBaseEditor.ts
function showKnowledgeBaseEditor(entry, templateGroupRoot) {
	const { entityClient } = locator;
	const editorModel = new KnowledgeBaseEditorModel(entry, templateGroupRoot, entityClient);
	const closeDialog = () => {
		dialog.close();
	};
	const saveAction = () => {
		editorModel.save().then(closeDialog).catch(ofClass(UserError, showUserError));
	};
	const headerBarAttrs = {
		left: [{
			label: "cancel_action",
			click: closeDialog,
			type: ButtonType.Secondary
		}],
		right: [{
			label: "save_action",
			click: saveAction,
			type: ButtonType.Primary
		}],
		middle: editorModel.entry._id ? "editEntry_label" : "createEntry_action"
	};
	const dialog = Dialog.editDialog(headerBarAttrs, KnowledgeBaseEditor, editorModel);
	dialog.show();
}
var KnowledgeBaseEditor = class {
	entryContentEditor;
	linkedTemplateButtonAttrs;
	constructor(vnode) {
		const model = vnode.attrs;
		this.linkedTemplateButtonAttrs = {
			title: "linkTemplate_label",
			icon: Icons.Add,
			colors: ButtonColor.Elevated,
			click: (e, dom) => {
				e.stopPropagation();
				createAsyncDropdown({ lazyButtons: () => this._createDropdownChildAttrs(model) })(e, dom);
			},
			size: ButtonSize.Compact
		};
		this.entryContentEditor = new HtmlEditor("content_label").showBorders().setMinHeight(500).enableToolbar().setToolbarOptions({ customButtonAttrs: [this.linkedTemplateButtonAttrs] });
		model.setDescriptionProvider(() => {
			return this.entryContentEditor.getValue();
		});
		if (model.isUpdate()) this.entryContentEditor.setValue(model.entry.description);
	}
	_createDropdownChildAttrs(model) {
		return model.availableTemplates.getAsync().then((templates) => {
			if (templates.length > 0) return templates.map((template) => {
				return {
					label: lang.makeTranslation("tag", template.tag),
					click: () => this.entryContentEditor.editor.insertHTML(createTemplateLink(template))
				};
			});
else return [{
				label: "noEntries_msg",
				click: noOp
			}];
		});
	}
	view(vnode) {
		const model = vnode.attrs;
		return mithril_default("", [
			mithril_default(TextField, {
				label: "title_placeholder",
				value: model.title(),
				oninput: model.title
			}),
			mithril_default(TextField, {
				label: "keywords_label",
				value: model.keywords(),
				oninput: model.keywords
			}),
			mithril_default(this.entryContentEditor)
		]);
	}
};
function createTemplateLink(template) {
	const listId = listIdPart(getLetId(template));
	const elementId = elementIdPart(getLetId(template));
	return `<a href="tutatemplate:${listId}/${elementId}">${TEMPLATE_SHORTCUT_PREFIX + template.tag}</a>`;
}

//#endregion
export { showKnowledgeBaseEditor };
//# sourceMappingURL=KnowledgeBaseEditor-7OSLD2QV.js.map