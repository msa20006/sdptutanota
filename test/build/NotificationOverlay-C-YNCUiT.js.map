{"version":3,"file":"NotificationOverlay-C-YNCUiT.js","names":["notificationQueue: QueueItem[]","currentAnimationTimeout: TimeoutID | null","vnode: Vnode<NotificationOverlayAttrs>","message: Component","closeButtonAttrs: Partial<ButtonAttrs>","buttons: Array<ButtonAttrs>","originClickHandler: ClickHandler | undefined","closeFinalAttrs: ButtonAttrs"],"sources":["../../src/common/gui/base/NotificationOverlay.ts"],"sourcesContent":["import m, { Children, Component, Vnode } from \"mithril\"\nimport { px } from \"../size\"\nimport { DefaultAnimationTime } from \"../animation/Animations\"\nimport { displayOverlay } from \"./Overlay\"\nimport type { ButtonAttrs } from \"./Button.js\"\nimport { Button, ButtonType } from \"./Button.js\"\nimport { assertMainOrNode } from \"../../api/common/Env\"\nimport { ClickHandler } from \"./GuiUtils\"\n\nassertMainOrNode()\n\ninterface NotificationOverlayAttrs {\n\tmessage: Component\n\tbuttons: Array<ButtonAttrs>\n}\n\ninterface QueueItem extends NotificationOverlayAttrs {\n\tcloseButtonAttrs: Partial<ButtonAttrs>\n}\n\nconst notificationQueue: QueueItem[] = []\nlet currentAnimationTimeout: TimeoutID | null = null\n\nclass NotificationOverlay implements Component<NotificationOverlayAttrs> {\n\tview(vnode: Vnode<NotificationOverlayAttrs>): Children {\n\t\treturn m(\".notification-overlay-content.flex.flex-column.flex-space-between\", [\n\t\t\tm(vnode.attrs.message),\n\t\t\tm(\n\t\t\t\t\".flex.justify-end.flex-wrap\",\n\t\t\t\tvnode.attrs.buttons.map((b) => m(Button, b)),\n\t\t\t),\n\t\t])\n\t}\n}\n\n/**\n * @param message What will be shown inside notification\n * @param closeButtonAttrs To define the close button in the notification\n * @param buttons The postpone button is automatically added and does not have to be passed from outside\n */\n\nexport function show(message: Component, closeButtonAttrs: Partial<ButtonAttrs>, buttons: Array<ButtonAttrs>) {\n\tnotificationQueue.push({\n\t\tmessage,\n\t\tbuttons,\n\t\tcloseButtonAttrs,\n\t})\n\n\tif (notificationQueue.length > 1) {\n\t\t// another notification is already visible. Next notification will be shown when closing current notification\n\t\treturn\n\t}\n\n\tshowNextNotification()\n}\n\nfunction showNextNotification() {\n\tconst { message, buttons, closeButtonAttrs } = notificationQueue[0]\n\tcurrentAnimationTimeout = null\n\tconst width = window.innerWidth\n\tconst margin = (width - Math.min(400, width)) / 2\n\tconst allButtons = buttons.slice()\n\tconst overlayRect = {\n\t\twidth: \"fit-content\",\n\t\ttop: px(0),\n\t\tleft: px(0),\n\t\tright: px(0),\n\t}\n\tconst closeFunction = displayOverlay(\n\t\t() => overlayRect,\n\t\t{\n\t\t\tview: () =>\n\t\t\t\tm(NotificationOverlay, {\n\t\t\t\t\tmessage,\n\t\t\t\t\tbuttons: allButtons,\n\t\t\t\t}),\n\t\t},\n\t\t\"slide-top\",\n\t\tundefined,\n\t\t\"dropdown-shadow center-h notification-min-width\",\n\t)\n\n\tconst closeAndOpenNext = () => {\n\t\tif (currentAnimationTimeout !== null) {\n\t\t\treturn\n\t\t}\n\n\t\tcloseFunction()\n\t\tnotificationQueue.shift()\n\n\t\tif (notificationQueue.length > 0) {\n\t\t\tcurrentAnimationTimeout = setTimeout(showNextNotification, 2 * DefaultAnimationTime)\n\t\t}\n\t}\n\n\t// close the notification by default when pressing any button\n\tfor (const b of allButtons) {\n\t\tconst originClickHandler: ClickHandler | undefined = b.click\n\n\t\tb.click = (e, dom) => {\n\t\t\toriginClickHandler?.(e, dom)\n\t\t\tcloseAndOpenNext()\n\t\t}\n\t}\n\t// add the postpone button\n\tconst closeFinalAttrs: ButtonAttrs = Object.assign(\n\t\t{},\n\t\t{\n\t\t\tlabel: \"close_alt\",\n\t\t\tclick: closeAndOpenNext,\n\t\t\ttype: ButtonType.Secondary,\n\t\t},\n\t\tcloseButtonAttrs,\n\t)\n\n\tcloseFinalAttrs.click = (e, dom) => {\n\t\tcloseButtonAttrs.click?.(e, dom)\n\t\tcloseAndOpenNext()\n\t}\n\n\tallButtons.unshift(closeFinalAttrs)\n\tm.redraw()\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASA,kBAAkB;AAWlB,MAAMA,oBAAiC,CAAE;AACzC,IAAIC,0BAA4C;IAE1C,sBAAN,MAAyE;CACxE,KAAKC,OAAkD;AACtD,SAAO,gBAAE,qEAAqE,CAC7E,gBAAE,MAAM,MAAM,QAAQ,EACtB,gBACC,+BACA,MAAM,MAAM,QAAQ,IAAI,CAAC,MAAM,gBAAE,QAAQ,EAAE,CAAC,CAC5C,AACD,EAAC;CACF;AACD;AAQM,SAAS,KAAKC,SAAoBC,kBAAwCC,SAA6B;AAC7G,mBAAkB,KAAK;EACtB;EACA;EACA;CACA,EAAC;AAEF,KAAI,kBAAkB,SAAS,EAE9B;AAGD,uBAAsB;AACtB;AAED,SAAS,uBAAuB;CAC/B,MAAM,EAAE,SAAS,SAAS,kBAAkB,GAAG,kBAAkB;AACjE,2BAA0B;CAC1B,MAAM,QAAQ,OAAO;CACrB,MAAM,UAAU,QAAQ,KAAK,IAAI,KAAK,MAAM,IAAI;CAChD,MAAM,aAAa,QAAQ,OAAO;CAClC,MAAM,cAAc;EACnB,OAAO;EACP,KAAK,GAAG,EAAE;EACV,MAAM,GAAG,EAAE;EACX,OAAO,GAAG,EAAE;CACZ;CACD,MAAM,gBAAgB,eACrB,MAAM,aACN,EACC,MAAM,MACL,gBAAE,qBAAqB;EACtB;EACA,SAAS;CACT,EAAC,CACH,GACD,aACA,WACA,kDACA;CAED,MAAM,mBAAmB,MAAM;AAC9B,MAAI,4BAA4B,KAC/B;AAGD,iBAAe;AACf,oBAAkB,OAAO;AAEzB,MAAI,kBAAkB,SAAS,EAC9B,2BAA0B,WAAW,sBAAsB,IAAI,qBAAqB;CAErF;AAGD,MAAK,MAAM,KAAK,YAAY;EAC3B,MAAMC,qBAA+C,EAAE;AAEvD,IAAE,QAAQ,CAAC,GAAG,QAAQ;AACrB,wBAAqB,GAAG,IAAI;AAC5B,qBAAkB;EAClB;CACD;CAED,MAAMC,kBAA+B,OAAO,OAC3C,CAAE,GACF;EACC,OAAO;EACP,OAAO;EACP,MAAM,WAAW;CACjB,GACD,iBACA;AAED,iBAAgB,QAAQ,CAAC,GAAG,QAAQ;AACnC,mBAAiB,QAAQ,GAAG,IAAI;AAChC,oBAAkB;CAClB;AAED,YAAW,QAAQ,gBAAgB;AACnC,iBAAE,QAAQ;AACV"}