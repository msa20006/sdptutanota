{"version":3,"file":"PasswordRequestDialog-B7ZIVTVw.js","names":["props: {\n\ttitle?: MaybeTranslation\n\tmessageText?: string\n\taction: (pw: string) => Promise<string>\n\tcancel: {\n\t\ttextId: TranslationKey\n\t\taction: () => void\n\t} | null\n}","state: { type: \"progress\" } | { type: \"idle\"; message: string }","key: KeyPress","dom: HTMLElement"],"sources":["../../src/common/misc/passwords/PasswordRequestDialog.ts"],"sourcesContent":["/**\n * Requests a password from the user. Stays open until the caller sets the error message to \"\".\n * @param props.action will be executed as an attempt to apply new password. Error message is the return value.\n */\nimport { PasswordField, PasswordFieldAttrs } from \"./PasswordField.js\"\nimport { TranslationKey, MaybeTranslation } from \"../LanguageViewModel.js\"\nimport { Dialog, INPUT } from \"../../gui/base/Dialog.js\"\nimport m from \"mithril\"\nimport { Autocomplete } from \"../../gui/base/TextField.js\"\nimport { isKeyPressed, KeyPress } from \"../KeyManager.js\"\nimport { Keys } from \"../../api/common/TutanotaConstants.js\"\nimport { Icon } from \"../../gui/base/Icon.js\"\nimport { BootIcons } from \"../../gui/base/icons/BootIcons.js\"\n\nexport function showRequestPasswordDialog(props: {\n\ttitle?: MaybeTranslation\n\tmessageText?: string\n\taction: (pw: string) => Promise<string>\n\tcancel: {\n\t\ttextId: TranslationKey\n\t\taction: () => void\n\t} | null\n}): Dialog {\n\tconst title = props.title ? props.title : \"password_label\"\n\tlet value = \"\"\n\tlet state: { type: \"progress\" } | { type: \"idle\"; message: string } = { type: \"idle\", message: \"\" }\n\n\tconst doAction = async () => {\n\t\tstate = { type: \"progress\" }\n\t\tm.redraw()\n\t\tconst errorMessage = await props.action(value)\n\t\tstate = { type: \"idle\", message: errorMessage }\n\t\tm.redraw()\n\t}\n\n\tconst child = {\n\t\tview: () => {\n\t\t\tconst savedState = state\n\t\t\treturn savedState.type == \"idle\"\n\t\t\t\t? m(\"\", [\n\t\t\t\t\t\tprops.messageText ? m(\".pt\", props.messageText) : null,\n\t\t\t\t\t\tm(PasswordField, {\n\t\t\t\t\t\t\tlabel: title,\n\t\t\t\t\t\t\thelpLabel: () => savedState.message,\n\t\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\t\toninput: (newValue) => (value = newValue),\n\t\t\t\t\t\t\tautocompleteAs: Autocomplete.off,\n\t\t\t\t\t\t\tkeyHandler: (key: KeyPress) => {\n\t\t\t\t\t\t\t\tif (isKeyPressed(key.key, Keys.RETURN)) {\n\t\t\t\t\t\t\t\t\tdoAction()\n\t\t\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t} satisfies PasswordFieldAttrs),\n\t\t\t\t  ])\n\t\t\t\t: m(Icon, {\n\t\t\t\t\t\ticon: BootIcons.Progress,\n\t\t\t\t\t\tclass: \"icon-xl icon-progress block mt mb\",\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tmarginLeft: \"auto\",\n\t\t\t\t\t\t\tmarginRight: \"auto\",\n\t\t\t\t\t\t},\n\t\t\t\t  })\n\t\t},\n\t}\n\tconst dialog = Dialog.showActionDialog({\n\t\ttitle,\n\t\tchild: child,\n\t\tallowOkWithReturn: true,\n\t\tokAction: () => doAction(),\n\t\tcancelActionTextId: props.cancel?.textId,\n\t\tallowCancel: props.cancel != null,\n\t\tcancelAction: () => {\n\t\t\tprops?.cancel?.action?.()\n\t\t\tdialog.close()\n\t\t},\n\t})\n\n\t// the password form contains some dummy inputs that would be focused by\n\t// the default focusOnLoad\n\tdialog.setFocusOnLoadFunction((dom: HTMLElement) => {\n\t\tconst inputs = Array.from(dom.querySelectorAll(INPUT)) as Array<HTMLElement>\n\t\tinputs[inputs.length - 1].focus()\n\t})\n\treturn dialog\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAcO,SAAS,0BAA0BA,OAQ/B;CACV,MAAM,QAAQ,MAAM,QAAQ,MAAM,QAAQ;CAC1C,IAAI,QAAQ;CACZ,IAAIC,QAAkE;EAAE,MAAM;EAAQ,SAAS;CAAI;CAEnG,MAAM,WAAW,YAAY;AAC5B,UAAQ,EAAE,MAAM,WAAY;AAC5B,kBAAE,QAAQ;EACV,MAAM,eAAe,MAAM,MAAM,OAAO,MAAM;AAC9C,UAAQ;GAAE,MAAM;GAAQ,SAAS;EAAc;AAC/C,kBAAE,QAAQ;CACV;CAED,MAAM,QAAQ,EACb,MAAM,MAAM;EACX,MAAM,aAAa;AACnB,SAAO,WAAW,QAAQ,SACvB,gBAAE,IAAI,CACN,MAAM,cAAc,gBAAE,OAAO,MAAM,YAAY,GAAG,MAClD,gBAAE,eAAe;GAChB,OAAO;GACP,WAAW,MAAM,WAAW;GACrB;GACP,SAAS,CAAC,aAAc,QAAQ;GAChC,gBAAgB,aAAa;GAC7B,YAAY,CAACC,QAAkB;AAC9B,QAAI,aAAa,IAAI,KAAK,KAAK,OAAO,EAAE;AACvC,eAAU;AACV,YAAO;IACP;AAED,WAAO;GACP;EACD,EAA8B,AAC9B,EAAC,GACF,gBAAE,MAAM;GACR,MAAM,UAAU;GAChB,OAAO;GACP,OAAO;IACN,YAAY;IACZ,aAAa;GACb;EACA,EAAC;CACL,EACD;CACD,MAAM,SAAS,OAAO,iBAAiB;EACtC;EACO;EACP,mBAAmB;EACnB,UAAU,MAAM,UAAU;EAC1B,oBAAoB,MAAM,QAAQ;EAClC,aAAa,MAAM,UAAU;EAC7B,cAAc,MAAM;AACnB,UAAO,QAAQ,UAAU;AACzB,UAAO,OAAO;EACd;CACD,EAAC;AAIF,QAAO,uBAAuB,CAACC,QAAqB;EACnD,MAAM,SAAS,MAAM,KAAK,IAAI,iBAAiB,MAAM,CAAC;AACtD,SAAO,OAAO,SAAS,GAAG,OAAO;CACjC,EAAC;AACF,QAAO;AACP"}