
globalThis.env = {
  "staticUrl": "http://localhost:9000",
  "versionNumber": "264.250130.1",
  "dist": false,
  "mode": "Test",
  "timeout": 20000,
  "domainConfigs": {
    "mail.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.tuta.com",
      "apiUrl": "https://mail.tutanota.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "test.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.test.tuta.com",
      "apiUrl": "https://test.tutanota.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://test.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://tutanota.com"
    },
    "app.local.tutanota.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tuta.com:9000",
      "apiUrl": "https://app.local.tutanota.com:9000",
      "paymentUrl": "https://local.tutanota.com:9000/client/build/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/client/build/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/client/build/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/client/build/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/client/build/webauthnmobile",
      "webauthnRpId": "tutanota.com",
      "u2fAppId": "https://local.tutanota.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tutanota.com:9000"
    },
    "app.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://mail.tutanota.com",
      "apiUrl": "https://app.tuta.com",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://mail.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://mail.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "app.test.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://test.tutanota.com",
      "apiUrl": "https://app.test.tuta.com",
      "paymentUrl": "https://pay.test.tutanota.com/braintree.html",
      "webauthnUrl": "https://app.test.tuta.com/webauthn",
      "legacyWebauthnUrl": "https://test.tutanota.com/webauthn",
      "webauthnMobileUrl": "https://app.test.tuta.com/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://test.tutanota.com/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.test.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.test.tuta.com/giftcard",
      "referralBaseUrl": "https://app.test.tuta.com/signup",
      "websiteBaseUrl": "https://test.tuta.com"
    },
    "app.local.tuta.com": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "https://app.local.tutanota.com:9000",
      "apiUrl": "https://app.local.tuta.com:9000",
      "paymentUrl": "https://app.local.tuta.com:9000/braintree.html",
      "webauthnUrl": "https://app.local.tuta.com:9000/webauthn",
      "legacyWebauthnUrl": "https://local.tutanota.com:9000/webauthn",
      "webauthnMobileUrl": "https://app.local.tuta.com:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "https://local.tutanota.com:9000/webauthnmobile",
      "webauthnRpId": "tuta.com",
      "u2fAppId": "https://app.local.tuta.com/u2f-appid.json",
      "giftCardBaseUrl": "https://app.local.tuta.com:9000/giftcard",
      "referralBaseUrl": "https://app.local.tuta.com:9000/signup",
      "websiteBaseUrl": "https://local.tuta.com:9000"
    },
    "localhost": {
      "firstPartyDomain": true,
      "partneredDomainTransitionUrl": "http://localhost:9000",
      "apiUrl": "http://localhost:9000",
      "paymentUrl": "http://localhost:9000/braintree.html",
      "webauthnUrl": "http://localhost:9000/webauthn",
      "legacyWebauthnUrl": "http://localhost:9000/webauthn",
      "webauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "legacyWebauthnMobileUrl": "http://localhost:9000/webauthnmobile",
      "webauthnRpId": "localhost",
      "u2fAppId": "http://localhost:9000/u2f-appid.json",
      "giftCardBaseUrl": "http://localhost:9000/giftcard",
      "referralBaseUrl": "http://localhost:9000/signup",
      "websiteBaseUrl": "https://tuta.com"
    },
    "{hostname}": {
      "firstPartyDomain": false,
      "partneredDomainTransitionUrl": "{protocol}//{hostname}",
      "apiUrl": "{protocol}//{hostname}",
      "paymentUrl": "https://pay.tutanota.com/braintree.html",
      "webauthnUrl": "{protocol}//{hostname}/webauthn",
      "legacyWebauthnUrl": "{protocol}//{hostname}/webauthn",
      "webauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "legacyWebauthnMobileUrl": "{protocol}//{hostname}/webauthnmobile",
      "webauthnRpId": "{hostname}",
      "u2fAppId": "{protocol}//{hostname}/u2f-appid.json",
      "giftCardBaseUrl": "https://app.tuta.com/giftcard",
      "referralBaseUrl": "https://app.tuta.com/signup",
      "websiteBaseUrl": "https://tuta.com"
    }
  },
  "platformId": null
};
const __NODE_GYP_better_sqlite3 = `./better-sqlite3.darwin-${typeof process !== 'undefined' ? process.arch : "unknown"}.node`
import { mithril_default } from "./mithril-Csg4iNnm.js";
import { insideRect, makeSingleUse, remove } from "./dist-CJHwsXKY.js";
import { assertMainOrNodeBoot, isApp } from "./Env-D5xGlXfw.js";
import { AlphaEnum, alpha, animations, getSafeAreaInsetBottom, px, size, styles, theme } from "./HtmlUtils-C-ecR7U7.js";
import { Keys } from "./TutanotaConstants-3bwAESYA.js";
import { isKeyPressed, keyManager } from "./KeyManager-B0OGXEyJ.js";
import { windowFacade } from "./WindowFacade-B9kSBKw7.js";

//#region ../src/common/gui/base/Overlay.ts
assertMainOrNodeBoot();
const overlays = new Map();
let key = 0;
function displayOverlay(position, component, createAnimation, closeAnimation, shadowClass = "dropdown-shadow") {
	if (createAnimation != null && closeAnimation == null) closeAnimation = `${createAnimation} animation-reverse`;
	const overlayKey = key++;
	const pair = {
		position,
		component,
		createAnimation,
		closeAnimation,
		shadowClass
	};
	overlays.set(overlayKey, pair);
	return makeSingleUse(() => {
		if (!overlays.delete(overlayKey)) console.warn(`Missing overlay with key:${overlayKey}!`);
	});
}
const overlay = { view: () => mithril_default(
	// we want the overlays to position relative to the overlay parent
	// the overlay parent also should fill the root
	"#overlay.fill-absolute.noprint",
	{
		style: {
			display: overlays.size > 0 ? "" : "none",
			"margin-top": "env(safe-area-inset-top)",
			"margin-bottom": styles.isUsingBottomNavigation() ? px(size.bottom_nav_bar + getSafeAreaInsetBottom()) : "unset",
			"margin-left": "env(safe-area-inset-left)",
			"margin-right": "env(safe-area-inset-right)"
		},
		"aria-hidden": overlays.size === 0
	},
	Array.from(overlays.entries()).map((overlay$1) => {
		const [key$1, attrs] = overlay$1;
		const position = attrs.position();
		const baseClasses = "abs elevated-bg " + attrs.shadowClass;
		const classes = attrs.createAnimation == null ? baseClasses : baseClasses + " " + attrs.createAnimation;
		return mithril_default("", {
			key: key$1,
			class: classes,
			style: {
				width: position.width,
				top: position.top,
				bottom: position.bottom,
				right: position.right,
				left: position.left,
				height: position.height,
				"z-index": position.zIndex != null ? position.zIndex : LayerType.Overlay
			},
			onbeforeremove: (vnode) => {
				if (attrs.closeAnimation != null) {
					const dom = vnode.dom;
					dom.className = baseClasses;
					void dom.offsetWidth;
					dom.className = baseClasses + " " + attrs.closeAnimation;
					return new Promise(function(resolve) {
						dom.addEventListener("animationend", resolve);
					});
				}
			}
		}, mithril_default(attrs.component));
	})
) };

//#endregion
//#region ../src/RootView.ts
assertMainOrNodeBoot();
let LayerType = function(LayerType$1) {
	LayerType$1[LayerType$1["View"] = 0] = "View";
	LayerType$1[LayerType$1["LowPriorityOverlay"] = 100] = "LowPriorityOverlay";
	LayerType$1[LayerType$1["LowPriorityNotification"] = 150] = "LowPriorityNotification";
	LayerType$1[LayerType$1["ForegroundMenu"] = 200] = "ForegroundMenu";
	LayerType$1[LayerType$1["Modal"] = 300] = "Modal";
	LayerType$1[LayerType$1["Overlay"] = 400] = "Overlay";
	return LayerType$1;
}({});
let PrimaryNavigationType = function(PrimaryNavigationType$1) {
	PrimaryNavigationType$1[PrimaryNavigationType$1["Keyboard"] = 0] = "Keyboard";
	PrimaryNavigationType$1[PrimaryNavigationType$1["Touch"] = 1] = "Touch";
	PrimaryNavigationType$1[PrimaryNavigationType$1["Mouse"] = 2] = "Mouse";
	return PrimaryNavigationType$1;
}({});
let currentNavigationType = isApp() ? PrimaryNavigationType.Touch : PrimaryNavigationType.Mouse;
var RootView = class {
	dom = null;
	constructor() {
		this.view = this.view.bind(this);
	}
	view(vnode) {
		return mithril_default("#root" + (styles.isUsingBottomNavigation() ? ".mobile" : ""), {
			oncreate: (vnode$1) => {
				this.dom = vnode$1.dom;
			},
			onpointerup: (e) => {
				if (e.pointerType === "mouse") this.switchNavType(PrimaryNavigationType.Mouse);
else this.switchNavType(PrimaryNavigationType.Touch);
				e.redraw = false;
			},
			onkeyup: (e) => {
				if (isKeyPressed(e.key, Keys.TAB, Keys.UP, Keys.DOWN, Keys.J, Keys.K)) this.switchNavType(PrimaryNavigationType.Keyboard);
				e.redraw = false;
			},
			class: this.classForType(),
			style: { height: "100%" }
		}, [
			mithril_default(overlay),
			mithril_default(modal),
			vnode.children
		]);
	}
	switchNavType(newType) {
		if (currentNavigationType === newType) return;
		this.dom?.classList.remove(this.classForType());
		currentNavigationType = newType;
		this.dom?.classList.add(this.classForType());
	}
	classForType() {
		switch (currentNavigationType) {
			case PrimaryNavigationType.Keyboard: return "keyboard-nav";
			case PrimaryNavigationType.Mouse: return "mouse-nav";
			case PrimaryNavigationType.Touch: return "touch-nav";
		}
	}
};
const root = new RootView();

//#endregion
//#region ../src/common/gui/base/Modal.ts
assertMainOrNodeBoot();
var Modal = class {
	components;
	uniqueComponent;
	view;
	visible;
	currentKey;
	closingComponents;
	historyEventListener = (e) => this.popState(e);
	constructor() {
		this.currentKey = 0;
		this.components = [];
		this.visible = false;
		this.uniqueComponent = null;
		this.closingComponents = [];
		this.view = () => {
			return mithril_default("#modal.fill-absolute", {
				oncreate: (_) => {},
				style: {
					"z-index": LayerType.Modal,
					display: this.visible ? "" : "none"
				}
			}, this.components.map((wrapper, i, array) => {
				return mithril_default(".fill-absolute", {
					key: wrapper.key,
					oncreate: (vnode) => {
						this.visible = true;
						mithril_default.redraw();
						if (wrapper.needsBg) this.addAnimation(vnode.dom, true);
					},
					onclick: (event) => {
						const element = event.currentTarget;
						const child = element.firstElementChild;
						if (child) {
							const childRect = child.getBoundingClientRect();
							if (!insideRect(event, childRect)) wrapper.component.backgroundClick(event);
						}
					},
					style: { zIndex: LayerType.Modal + 1 + i },
					onbeforeremove: (vnode) => {
						if (wrapper.needsBg) {
							this.closingComponents.push(wrapper.component);
							return Promise.all([this.addAnimation(vnode.dom, false).then(() => {
								remove(this.closingComponents, wrapper.component);
								if (this.components.length === 0 && this.closingComponents.length === 0) this.visible = false;
							}), wrapper.component.hideAnimation()]).then(() => {
								mithril_default.redraw();
							});
						} else {
							if (this.components.length === 0 && this.closingComponents.length === 0) this.visible = false;
							return wrapper.component.hideAnimation().then(() => mithril_default.redraw());
						}
					}
				}, mithril_default(wrapper.component));
			}));
		};
	}
	display(component, needsBg = true) {
		windowFacade.removeHistoryEventListener(this.historyEventListener);
		windowFacade.addHistoryEventListener(this.historyEventListener);
		if (this.components.length > 0) keyManager.unregisterModalShortcuts(this.components[this.components.length - 1].component.shortcuts());
		const existingIndex = this.components.findIndex((shownComponent) => shownComponent.component === component);
		if (existingIndex !== -1) {
			console.warn("Attempting to display the same modal component multiple times!");
			this.components.splice(existingIndex, 1);
		}
		this.components.push({
			key: this.currentKey++,
			component,
			needsBg
		});
		mithril_default.redraw();
		keyManager.registerModalShortcuts(component.shortcuts());
	}
	/**
	* notify components that a history state was popped. The Component Stack is notified from the top and the first
	* Component to return false will stop underlying components from receiving the notification.
	* Components that return true are expected to remove themselves from the Modal stack, eg dropdowns.
	* @param e: the DOM Event
	* @private
	*/
	popState(e) {
		console.log("modal popstate");
		const len = this.components.length;
		if (len === 0) {
			console.log("no modals to close");
			return true;
		}
		const keys = this.components.map((c) => c.key);
		for (let i = len - 1; i >= 0; i--) {
			const component = this.getComponentByKey(keys[i]);
			if (!component) {
				console.log("component went AWOL, continuing");
				continue;
			}
			if (!component.popState(e)) {
				console.log("component handled popstate");
				return false;
			}
		}
		return true;
	}
	/**
	* used for modal components that should only be opened once
	* multiple calls will be ignored if the first component is still visible
	* @param component
	*/
	displayUnique(component, needsBg = true) {
		if (this.uniqueComponent) {
			console.log("tried to open unique component while another was open!");
			return;
		}
		this.display(component, needsBg);
		this.uniqueComponent = component;
	}
	getComponentByKey(key$1) {
		const entry = this.components.find((c) => c.key === key$1);
		return entry?.component ?? null;
	}
	remove(component) {
		const componentIndex = this.components.findIndex((wrapper) => wrapper.component === component);
		if (componentIndex === -1) {
			console.log("can't remove non existing component from modal");
			return;
		}
		const componentIsTopmostComponent = componentIndex === this.components.length - 1;
		if (componentIsTopmostComponent) {
			console.log("removed topmost modal component");
			keyManager.unregisterModalShortcuts(component.shortcuts());
		}
		this.components.splice(componentIndex, 1);
		if (this.uniqueComponent === component) this.uniqueComponent = null;
		mithril_default.redraw();
		if (this.components.length > 0 && componentIsTopmostComponent) keyManager.registerModalShortcuts(this.components[this.components.length - 1].component.shortcuts());
		component.callingElement()?.focus();
	}
	/**
	* adds an animation to the topmost component
	*/
	addAnimation(domLayer, fadein) {
		const start = 0;
		const end = .5;
		return animations.add(domLayer, alpha(AlphaEnum.BackgroundColor, theme.modal_bg, fadein ? start : end, fadein ? end : start));
	}
};
const modal = new Modal();

//#endregion
export { LayerType, PrimaryNavigationType, currentNavigationType, displayOverlay, modal };
//# sourceMappingURL=Modal-g4c-b9IU.js.map