import { assertMainOrNode, isDesktop } from "./Env-chunk.js";
import { mithril_default } from "./mithril-chunk.js";
import { lazyStringValue, neverNull } from "./dist2-chunk.js";
import { lang } from "./LanguageViewModel-chunk.js";
import { styles } from "./styles-chunk.js";
import { stateBgHover, theme } from "./theme-chunk.js";
import { Keys } from "./TutanotaConstants-chunk.js";
import { isKeyPressed } from "./KeyManager-chunk.js";
import { px, size } from "./size-chunk.js";
import { handleUncaughtError } from "./ErrorHandler-chunk.js";
import { DropType } from "./Dialog-chunk.js";
import { Icon } from "./Icon-chunk.js";
import { fileListToArray } from "./FileUtils-chunk.js";

//#region src/common/gui/base/NavButton.ts
assertMainOrNode();
var NavButton = class {
	_domButton;
	_draggedOver;
	_dropCounter;
	constructor() {
		this._draggedOver = false;
		this._dropCounter = 0;
	}
	view(vnode) {
		const a = vnode.attrs;
		const linkAttrs = this.createButtonAttributes(a);
		const icon = a.icon?.();
		const children = [
			a.leftInjection?.() ?? null,
			icon ? mithril_default(Icon, {
				icon,
				class: this._getIconClass(a),
				style: { fill: isNavButtonSelected(a) || this._draggedOver ? getColors(a.colors).button_selected : getColors(a.colors).button }
			}) : null,
			!a.hideLabel ? mithril_default("span.label.click.text-ellipsis" + (!a.vertical && icon ? ".pl-m" : ""), lang.getTranslationText(a.label)) : null
		];
		if (this._isExternalUrl(a.href)) return mithril_default(this._getNavButtonClass(a), linkAttrs, children);
else return mithril_default(mithril_default.route.Link, linkAttrs, children);
	}
	_getUrl(href) {
		return lazyStringValue(href);
	}
	_getNavButtonClass(a) {
		return "a.nav-button.noselect.items-center.click.plr-button.no-text-decoration.button-height.border-radius" + (a.vertical ? ".col" : "") + (!a.centred ? ".flex-start" : ".flex-center") + (a.disableHoverBackground ? "" : ".state-bg") + (a.disabled ? ".no-hover" : "") + (a.fillSpaceAround ?? true ? ".flex-no-shrink" : "");
	}
	_getIconClass(a) {
		const isSelected = isNavButtonSelected(a);
		if (a.colors === NavButtonColor.Header && !styles.isDesktopLayout()) return "flex-end items-center icon-xl" + (isSelected ? " selected" : "");
else if (a.small === true) return "flex-center items-center icon" + (isSelected ? " selected" : "");
else return "flex-center items-center icon-large" + (isSelected ? " selected" : "");
	}
	_isExternalUrl(href) {
		let url = this._getUrl(href);
		return url != null ? url.indexOf("http") === 0 : false;
	}
	createButtonAttributes(a) {
		let attr = {
			role: "button",
			href: this._getUrl(a.href),
			style: {
				color: isNavButtonSelected(a) || this._draggedOver ? getColors(a.colors).button_selected : getColors(a.colors).button,
				"font-size": a.fontSize ? px(a.fontSize) : "",
				background: isNavButtonSelected(a) && a.persistentBackground || this._draggedOver ? stateBgHover : ""
			},
			title: lang.getTranslationText(a.label),
			target: this._isExternalUrl(a.href) ? "_blank" : undefined,
			selector: this._getNavButtonClass(a),
			onclick: (e) => this.click(e, a, e.target),
			onkeyup: (e, dom) => {
				if (isKeyPressed(e.key, Keys.SPACE)) this.click(e, a, dom);
			},
			onfocus: a.onfocus,
			onblur: a.onblur,
			onkeydown: a.onkeydown,
			"data-testid": `btn:${lang.getTestId(a.label)}`
		};
		if (a.dropHandler) {
			attr.ondragenter = (ev) => {
				this._dropCounter++;
				this._draggedOver = true;
				ev.preventDefault();
			};
			attr.ondragleave = (ev) => {
				this._dropCounter--;
				if (this._dropCounter === 0) this._draggedOver = false;
				ev.preventDefault();
			};
			attr.ondragover = (ev) => {
				ev.preventDefault();
			};
			attr.ondrop = (ev) => {
				this._dropCounter = 0;
				this._draggedOver = false;
				ev.preventDefault();
				ev.stopPropagation();
				if (ev.dataTransfer?.getData(DropType.Mail)) {
					let dropData = {
						dropType: DropType.Mail,
						mailId: ev.dataTransfer.getData(DropType.Mail)
					};
					neverNull(a.dropHandler)(dropData);
				} else if (isDesktop() && ev.dataTransfer?.files && ev.dataTransfer.files.length > 0) neverNull(a.dropHandler)({
					dropType: DropType.ExternalFile,
					files: fileListToArray(ev.dataTransfer.files)
				});
else console.error("received onDrop DragEvent has invalid DropType or is unsupported on this platform!");
			};
		}
		return attr;
	}
	click(event, a, dom) {
		if (!this._isExternalUrl(a.href)) {
			mithril_default.route.set(this._getUrl(a.href));
			try {
				if (a.click != null) a.click(event, dom);
				event.preventDefault();
			} catch (e) {
				handleUncaughtError(e);
			}
		}
	}
	getHeight() {
		return size.button_height;
	}
};
let NavButtonColor = function(NavButtonColor$1) {
	NavButtonColor$1["Header"] = "header";
	NavButtonColor$1["Nav"] = "nav";
	NavButtonColor$1["Content"] = "content";
	return NavButtonColor$1;
}({});
function getColors(buttonColors) {
	switch (buttonColors) {
		case NavButtonColor.Header: return {
			button: styles.isDesktopLayout() ? theme.header_button : theme.content_accent,
			button_selected: styles.isDesktopLayout() ? theme.header_button_selected : theme.content_accent
		};
		case NavButtonColor.Nav: return {
			button: theme.navigation_button,
			button_selected: theme.navigation_button_selected
		};
		default: return {
			button: theme.content_button,
			button_selected: theme.content_button_selected
		};
	}
}
function isNavButtonSelected(a) {
	if (typeof a.isSelectedPrefix === "boolean") return a.isSelectedPrefix;
	const selectedPrefix = a.isSelectedPrefix || lazyStringValue(a.href);
	return isSelectedPrefix(selectedPrefix);
}
function isSelectedPrefix(href) {
	const current = mithril_default.route.get();
	return href !== "" && (current === href || current.indexOf(href + "/") === 0 || current.indexOf(href + "?") === 0);
}

//#endregion
export { NavButton, NavButtonColor, isNavButtonSelected, isSelectedPrefix };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTmF2QnV0dG9uLWNodW5rLmpzIiwibmFtZXMiOlsidm5vZGU6IFZub2RlPE5hdkJ1dHRvbkF0dHJzPiIsIm0iLCJocmVmOiBzdHJpbmcgfCBsYXp5PHN0cmluZz4iLCJhOiBOYXZCdXR0b25BdHRycyIsImF0dHI6IFJvdXRlTGlua0F0dHJzIiwiZTogTW91c2VFdmVudCIsImU6IEtleWJvYXJkRXZlbnQiLCJkb206IEhUTUxFbGVtZW50IiwiZXY6IERyYWdFdmVudCIsImRyb3BEYXRhOiBEcm9wRGF0YSIsImV2ZW50OiBFdmVudCIsImJ1dHRvbkNvbG9yczogTmF2QnV0dG9uQ29sb3IgfCBudWxsIHwgdW5kZWZpbmVkIiwiaHJlZjogc3RyaW5nIl0sInNvdXJjZXMiOlsiLi4vc3JjL2NvbW1vbi9ndWkvYmFzZS9OYXZCdXR0b24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG0sIHsgQ2hpbGRyZW4sIENvbXBvbmVudCwgUm91dGVMaW5rQXR0cnMsIFZub2RlIH0gZnJvbSBcIm1pdGhyaWxcIlxuaW1wb3J0IHsgaGFuZGxlVW5jYXVnaHRFcnJvciB9IGZyb20gXCIuLi8uLi9taXNjL0Vycm9ySGFuZGxlclwiXG5pbXBvcnQgeyBweCwgc2l6ZSB9IGZyb20gXCIuLi9zaXplXCJcbmltcG9ydCB0eXBlIHsgbGF6eSB9IGZyb20gXCJAdHV0YW8vdHV0YW5vdGEtdXRpbHNcIlxuaW1wb3J0IHsgbGF6eVN0cmluZ1ZhbHVlLCBuZXZlck51bGwgfSBmcm9tIFwiQHR1dGFvL3R1dGFub3RhLXV0aWxzXCJcbmltcG9ydCB0eXBlIHsgbGF6eUljb24gfSBmcm9tIFwiLi9JY29uXCJcbmltcG9ydCB7IEljb24gfSBmcm9tIFwiLi9JY29uXCJcbmltcG9ydCB7IHRoZW1lIH0gZnJvbSBcIi4uL3RoZW1lXCJcbmltcG9ydCB7IHN0eWxlcyB9IGZyb20gXCIuLi9zdHlsZXNcIlxuaW1wb3J0IHR5cGUgeyBNYXliZVRyYW5zbGF0aW9uIH0gZnJvbSBcIi4uLy4uL21pc2MvTGFuZ3VhZ2VWaWV3TW9kZWxcIlxuaW1wb3J0IHsgbGFuZyB9IGZyb20gXCIuLi8uLi9taXNjL0xhbmd1YWdlVmlld01vZGVsXCJcbmltcG9ydCB7IEtleXMgfSBmcm9tIFwiLi4vLi4vYXBpL2NvbW1vbi9UdXRhbm90YUNvbnN0YW50c1wiXG5pbXBvcnQgeyBpc0tleVByZXNzZWQgfSBmcm9tIFwiLi4vLi4vbWlzYy9LZXlNYW5hZ2VyXCJcbmltcG9ydCB7IERyb3BEYXRhLCBEcm9wSGFuZGxlciwgRHJvcFR5cGUgfSBmcm9tIFwiLi9HdWlVdGlsc1wiXG5pbXBvcnQgeyBhc3NlcnRNYWluT3JOb2RlLCBpc0Rlc2t0b3AgfSBmcm9tIFwiLi4vLi4vYXBpL2NvbW1vbi9FbnZcIlxuaW1wb3J0IHsgc3RhdGVCZ0hvdmVyIH0gZnJvbSBcIi4uL2J1aWx0aW5UaGVtZXMuanNcIlxuaW1wb3J0IHsgZmlsZUxpc3RUb0FycmF5IH0gZnJvbSBcIi4uLy4uL2FwaS9jb21tb24vdXRpbHMvRmlsZVV0aWxzLmpzXCJcblxuYXNzZXJ0TWFpbk9yTm9kZSgpXG5leHBvcnQgdHlwZSBOYXZCdXR0b25BdHRycyA9IHtcblx0bGFiZWw6IE1heWJlVHJhbnNsYXRpb25cblx0aWNvbj86IGxhenlJY29uXG5cdGhyZWY6IHN0cmluZyB8IGxhenk8c3RyaW5nPlxuXHRpc1NlbGVjdGVkUHJlZml4Pzogc3RyaW5nIHwgYm9vbGVhblxuXHRjbGljaz86IChldmVudDogRXZlbnQsIGRvbTogSFRNTEVsZW1lbnQpID0+IHVua25vd25cblx0Y29sb3JzPzogTmF2QnV0dG9uQ29sb3Jcblx0ZHJvcEhhbmRsZXI/OiBEcm9wSGFuZGxlclxuXHRoaWRlTGFiZWw/OiBib29sZWFuXG5cdHZlcnRpY2FsPzogYm9vbGVhblxuXHRmb250U2l6ZT86IG51bWJlclxuXHRzbWFsbD86IGJvb2xlYW5cblx0Y2VudHJlZD86IGJvb2xlYW5cblx0bGVmdEluamVjdGlvbj86ICgpID0+IENoaWxkcmVuXG5cdGRpc2FibGVIb3ZlckJhY2tncm91bmQ/OiBib29sZWFuXG5cdGRpc2FibGVkPzogYm9vbGVhblxuXHRwZXJzaXN0ZW50QmFja2dyb3VuZD86IGJvb2xlYW5cblx0b25mb2N1cz86ICgpID0+IHVua25vd25cblx0b25ibHVyPzogKCkgPT4gdW5rbm93blxuXHRvbmtleWRvd24/OiAoZXZlbnQ6IEtleWJvYXJkRXZlbnQpID0+IHVua25vd25cblx0ZmlsbFNwYWNlQXJvdW5kPzogYm9vbGVhblxufVxuXG5leHBvcnQgY2xhc3MgTmF2QnV0dG9uIGltcGxlbWVudHMgQ29tcG9uZW50PE5hdkJ1dHRvbkF0dHJzPiB7XG5cdHByaXZhdGUgX2RvbUJ1dHRvbiE6IEhUTUxFbGVtZW50XG5cdHByaXZhdGUgX2RyYWdnZWRPdmVyOiBib29sZWFuXG5cdHByaXZhdGUgX2Ryb3BDb3VudGVyOiBudW1iZXIgLy8gd2UgYWxzbyBnZXQgZHJhZyBlbnRlci9sZWF2ZSBldmVudHMgZnJvbSBzdWJlbGVtZW50cywgc28gd2UgbmVlZCB0byBjb3VudCB0byBrbm93IHdoZW4gdGhlIGRyYWcgbGVhdmVzIHRoaXMgYnV0dG9uXG5cblx0Y29uc3RydWN0b3IoKSB7XG5cdFx0dGhpcy5fZHJhZ2dlZE92ZXIgPSBmYWxzZVxuXHRcdHRoaXMuX2Ryb3BDb3VudGVyID0gMFxuXHR9XG5cblx0dmlldyh2bm9kZTogVm5vZGU8TmF2QnV0dG9uQXR0cnM+KTogQ2hpbGRyZW4ge1xuXHRcdGNvbnN0IGEgPSB2bm9kZS5hdHRyc1xuXG5cdFx0Y29uc3QgbGlua0F0dHJzID0gdGhpcy5jcmVhdGVCdXR0b25BdHRyaWJ1dGVzKGEpXG5cdFx0Y29uc3QgaWNvbiA9IGEuaWNvbj8uKClcblx0XHRjb25zdCBjaGlsZHJlbiA9IFtcblx0XHRcdGEubGVmdEluamVjdGlvbj8uKCkgPz8gbnVsbCxcblx0XHRcdGljb25cblx0XHRcdFx0PyBtKEljb24sIHtcblx0XHRcdFx0XHRcdGljb24sXG5cdFx0XHRcdFx0XHRjbGFzczogdGhpcy5fZ2V0SWNvbkNsYXNzKGEpLFxuXHRcdFx0XHRcdFx0c3R5bGU6IHtcblx0XHRcdFx0XHRcdFx0ZmlsbDogaXNOYXZCdXR0b25TZWxlY3RlZChhKSB8fCB0aGlzLl9kcmFnZ2VkT3ZlciA/IGdldENvbG9ycyhhLmNvbG9ycykuYnV0dG9uX3NlbGVjdGVkIDogZ2V0Q29sb3JzKGEuY29sb3JzKS5idXR0b24sXG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHQgIH0pXG5cdFx0XHRcdDogbnVsbCxcblx0XHRcdCFhLmhpZGVMYWJlbCA/IG0oXCJzcGFuLmxhYmVsLmNsaWNrLnRleHQtZWxsaXBzaXNcIiArICghYS52ZXJ0aWNhbCAmJiBpY29uID8gXCIucGwtbVwiIDogXCJcIiksIGxhbmcuZ2V0VHJhbnNsYXRpb25UZXh0KGEubGFiZWwpKSA6IG51bGwsXG5cdFx0XVxuXG5cdFx0Ly8gYWxsb3cgbmF2IGJ1dHRvbiB3aXRob3V0IGxhYmVsIGZvciByZWdpc3RyYXRpb24gYnV0dG9uIG9uIG1vYmlsZSBkZXZpY2VzXG5cdFx0aWYgKHRoaXMuX2lzRXh0ZXJuYWxVcmwoYS5ocmVmKSkge1xuXHRcdFx0cmV0dXJuIG0odGhpcy5fZ2V0TmF2QnV0dG9uQ2xhc3MoYSksIGxpbmtBdHRycywgY2hpbGRyZW4pXG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiBtKG0ucm91dGUuTGluaywgbGlua0F0dHJzLCBjaGlsZHJlbilcblx0XHR9XG5cdH1cblxuXHRfZ2V0VXJsKGhyZWY6IHN0cmluZyB8IGxhenk8c3RyaW5nPik6IHN0cmluZyB7XG5cdFx0cmV0dXJuIGxhenlTdHJpbmdWYWx1ZShocmVmKVxuXHR9XG5cblx0X2dldE5hdkJ1dHRvbkNsYXNzKGE6IE5hdkJ1dHRvbkF0dHJzKTogc3RyaW5nIHtcblx0XHRyZXR1cm4gKFxuXHRcdFx0XCJhLm5hdi1idXR0b24ubm9zZWxlY3QuaXRlbXMtY2VudGVyLmNsaWNrLnBsci1idXR0b24ubm8tdGV4dC1kZWNvcmF0aW9uLmJ1dHRvbi1oZWlnaHQuYm9yZGVyLXJhZGl1c1wiICtcblx0XHRcdChhLnZlcnRpY2FsID8gXCIuY29sXCIgOiBcIlwiKSArXG5cdFx0XHQoIWEuY2VudHJlZCA/IFwiLmZsZXgtc3RhcnRcIiA6IFwiLmZsZXgtY2VudGVyXCIpICtcblx0XHRcdChhLmRpc2FibGVIb3ZlckJhY2tncm91bmQgPyBcIlwiIDogXCIuc3RhdGUtYmdcIikgK1xuXHRcdFx0KGEuZGlzYWJsZWQgPyBcIi5uby1ob3ZlclwiIDogXCJcIikgK1xuXHRcdFx0KGEuZmlsbFNwYWNlQXJvdW5kID8/IHRydWUgPyBcIi5mbGV4LW5vLXNocmlua1wiIDogXCJcIilcblx0XHQpXG5cdH1cblxuXHRfZ2V0SWNvbkNsYXNzKGE6IE5hdkJ1dHRvbkF0dHJzKTogc3RyaW5nIHtcblx0XHRjb25zdCBpc1NlbGVjdGVkID0gaXNOYXZCdXR0b25TZWxlY3RlZChhKVxuXG5cdFx0aWYgKGEuY29sb3JzID09PSBOYXZCdXR0b25Db2xvci5IZWFkZXIgJiYgIXN0eWxlcy5pc0Rlc2t0b3BMYXlvdXQoKSkge1xuXHRcdFx0cmV0dXJuIFwiZmxleC1lbmQgaXRlbXMtY2VudGVyIGljb24teGxcIiArIChpc1NlbGVjdGVkID8gXCIgc2VsZWN0ZWRcIiA6IFwiXCIpXG5cdFx0fSBlbHNlIGlmIChhLnNtYWxsID09PSB0cnVlKSB7XG5cdFx0XHRyZXR1cm4gXCJmbGV4LWNlbnRlciBpdGVtcy1jZW50ZXIgaWNvblwiICsgKGlzU2VsZWN0ZWQgPyBcIiBzZWxlY3RlZFwiIDogXCJcIilcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIFwiZmxleC1jZW50ZXIgaXRlbXMtY2VudGVyIGljb24tbGFyZ2VcIiArIChpc1NlbGVjdGVkID8gXCIgc2VsZWN0ZWRcIiA6IFwiXCIpXG5cdFx0fVxuXHR9XG5cblx0X2lzRXh0ZXJuYWxVcmwoaHJlZjogc3RyaW5nIHwgbGF6eTxzdHJpbmc+KTogYm9vbGVhbiB7XG5cdFx0bGV0IHVybCA9IHRoaXMuX2dldFVybChocmVmKVxuXG5cdFx0cmV0dXJuIHVybCAhPSBudWxsID8gdXJsLmluZGV4T2YoXCJodHRwXCIpID09PSAwIDogZmFsc2Vcblx0fVxuXG5cdGNyZWF0ZUJ1dHRvbkF0dHJpYnV0ZXMoYTogTmF2QnV0dG9uQXR0cnMpOiBSb3V0ZUxpbmtBdHRycyB7XG5cdFx0bGV0IGF0dHI6IFJvdXRlTGlua0F0dHJzID0ge1xuXHRcdFx0cm9sZTogXCJidXR0b25cIixcblx0XHRcdC8vIHJvbGUgYnV0dG9uIGZvciBzY3JlZW4gcmVhZGVyc1xuXHRcdFx0aHJlZjogdGhpcy5fZ2V0VXJsKGEuaHJlZiksXG5cdFx0XHRzdHlsZToge1xuXHRcdFx0XHRjb2xvcjogaXNOYXZCdXR0b25TZWxlY3RlZChhKSB8fCB0aGlzLl9kcmFnZ2VkT3ZlciA/IGdldENvbG9ycyhhLmNvbG9ycykuYnV0dG9uX3NlbGVjdGVkIDogZ2V0Q29sb3JzKGEuY29sb3JzKS5idXR0b24sXG5cdFx0XHRcdFwiZm9udC1zaXplXCI6IGEuZm9udFNpemUgPyBweChhLmZvbnRTaXplKSA6IFwiXCIsXG5cdFx0XHRcdGJhY2tncm91bmQ6IChpc05hdkJ1dHRvblNlbGVjdGVkKGEpICYmIGEucGVyc2lzdGVudEJhY2tncm91bmQpIHx8IHRoaXMuX2RyYWdnZWRPdmVyID8gc3RhdGVCZ0hvdmVyIDogXCJcIixcblx0XHRcdH0sXG5cdFx0XHR0aXRsZTogbGFuZy5nZXRUcmFuc2xhdGlvblRleHQoYS5sYWJlbCksXG5cdFx0XHR0YXJnZXQ6IHRoaXMuX2lzRXh0ZXJuYWxVcmwoYS5ocmVmKSA/IFwiX2JsYW5rXCIgOiB1bmRlZmluZWQsXG5cdFx0XHRzZWxlY3RvcjogdGhpcy5fZ2V0TmF2QnV0dG9uQ2xhc3MoYSksXG5cdFx0XHRvbmNsaWNrOiAoZTogTW91c2VFdmVudCkgPT4gdGhpcy5jbGljayhlLCBhLCBlLnRhcmdldCBhcyBIVE1MRWxlbWVudCksXG5cdFx0XHRvbmtleXVwOiAoZTogS2V5Ym9hcmRFdmVudCwgZG9tOiBIVE1MRWxlbWVudCkgPT4ge1xuXHRcdFx0XHRpZiAoaXNLZXlQcmVzc2VkKGUua2V5LCBLZXlzLlNQQUNFKSkge1xuXHRcdFx0XHRcdHRoaXMuY2xpY2soZSwgYSwgZG9tKVxuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXHRcdFx0b25mb2N1czogYS5vbmZvY3VzLFxuXHRcdFx0b25ibHVyOiBhLm9uYmx1cixcblx0XHRcdG9ua2V5ZG93bjogYS5vbmtleWRvd24sXG5cdFx0XHRcImRhdGEtdGVzdGlkXCI6IGBidG46JHtsYW5nLmdldFRlc3RJZChhLmxhYmVsKX1gLFxuXHRcdH1cblxuXHRcdGlmIChhLmRyb3BIYW5kbGVyKSB7XG5cdFx0XHRhdHRyLm9uZHJhZ2VudGVyID0gKGV2OiBEcmFnRXZlbnQpID0+IHtcblx0XHRcdFx0dGhpcy5fZHJvcENvdW50ZXIrK1xuXHRcdFx0XHR0aGlzLl9kcmFnZ2VkT3ZlciA9IHRydWVcblx0XHRcdFx0ZXYucHJldmVudERlZmF1bHQoKVxuXHRcdFx0fVxuXG5cdFx0XHRhdHRyLm9uZHJhZ2xlYXZlID0gKGV2OiBEcmFnRXZlbnQpID0+IHtcblx0XHRcdFx0dGhpcy5fZHJvcENvdW50ZXItLVxuXG5cdFx0XHRcdGlmICh0aGlzLl9kcm9wQ291bnRlciA9PT0gMCkge1xuXHRcdFx0XHRcdHRoaXMuX2RyYWdnZWRPdmVyID0gZmFsc2Vcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGV2LnByZXZlbnREZWZhdWx0KClcblx0XHRcdH1cblxuXHRcdFx0YXR0ci5vbmRyYWdvdmVyID0gKGV2OiBEcmFnRXZlbnQpID0+IHtcblx0XHRcdFx0Ly8gbmVlZGVkIHRvIGFsbG93IGRyb3BwaW5nXG5cdFx0XHRcdGV2LnByZXZlbnREZWZhdWx0KClcblx0XHRcdH1cblxuXHRcdFx0YXR0ci5vbmRyb3AgPSAoZXY6IERyYWdFdmVudCkgPT4ge1xuXHRcdFx0XHR0aGlzLl9kcm9wQ291bnRlciA9IDBcblx0XHRcdFx0dGhpcy5fZHJhZ2dlZE92ZXIgPSBmYWxzZVxuXHRcdFx0XHRldi5wcmV2ZW50RGVmYXVsdCgpXG5cdFx0XHRcdGV2LnN0b3BQcm9wYWdhdGlvbigpXG5cblx0XHRcdFx0aWYgKGV2LmRhdGFUcmFuc2Zlcj8uZ2V0RGF0YShEcm9wVHlwZS5NYWlsKSkge1xuXHRcdFx0XHRcdGxldCBkcm9wRGF0YTogRHJvcERhdGEgPSB7XG5cdFx0XHRcdFx0XHRkcm9wVHlwZTogRHJvcFR5cGUuTWFpbCxcblx0XHRcdFx0XHRcdG1haWxJZDogZXYuZGF0YVRyYW5zZmVyLmdldERhdGEoRHJvcFR5cGUuTWFpbCksXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdG5ldmVyTnVsbChhLmRyb3BIYW5kbGVyKShkcm9wRGF0YSlcblx0XHRcdFx0fSBlbHNlIGlmIChpc0Rlc2t0b3AoKSAmJiBldi5kYXRhVHJhbnNmZXI/LmZpbGVzICYmIGV2LmRhdGFUcmFuc2Zlci5maWxlcy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0bmV2ZXJOdWxsKGEuZHJvcEhhbmRsZXIpKHtcblx0XHRcdFx0XHRcdGRyb3BUeXBlOiBEcm9wVHlwZS5FeHRlcm5hbEZpbGUsXG5cdFx0XHRcdFx0XHRmaWxlczogZmlsZUxpc3RUb0FycmF5KGV2LmRhdGFUcmFuc2Zlci5maWxlcyksXG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKFwicmVjZWl2ZWQgb25Ecm9wIERyYWdFdmVudCBoYXMgaW52YWxpZCBEcm9wVHlwZSBvciBpcyB1bnN1cHBvcnRlZCBvbiB0aGlzIHBsYXRmb3JtIVwiKVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGF0dHJcblx0fVxuXG5cdGNsaWNrKGV2ZW50OiBFdmVudCwgYTogTmF2QnV0dG9uQXR0cnMsIGRvbTogSFRNTEVsZW1lbnQpIHtcblx0XHRpZiAoIXRoaXMuX2lzRXh0ZXJuYWxVcmwoYS5ocmVmKSkge1xuXHRcdFx0bS5yb3V0ZS5zZXQodGhpcy5fZ2V0VXJsKGEuaHJlZikpXG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdGlmIChhLmNsaWNrICE9IG51bGwpIHtcblx0XHRcdFx0XHRhLmNsaWNrKGV2ZW50LCBkb20pXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpXG5cdFx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHRcdGhhbmRsZVVuY2F1Z2h0RXJyb3IoZSlcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRnZXRIZWlnaHQoKTogbnVtYmVyIHtcblx0XHRyZXR1cm4gc2l6ZS5idXR0b25faGVpZ2h0XG5cdH1cbn1cblxuZXhwb3J0IGNvbnN0IGVudW0gTmF2QnV0dG9uQ29sb3Ige1xuXHRIZWFkZXIgPSBcImhlYWRlclwiLFxuXHROYXYgPSBcIm5hdlwiLFxuXHRDb250ZW50ID0gXCJjb250ZW50XCIsXG59XG5cbmZ1bmN0aW9uIGdldENvbG9ycyhidXR0b25Db2xvcnM6IE5hdkJ1dHRvbkNvbG9yIHwgbnVsbCB8IHVuZGVmaW5lZCkge1xuXHRzd2l0Y2ggKGJ1dHRvbkNvbG9ycykge1xuXHRcdGNhc2UgTmF2QnV0dG9uQ29sb3IuSGVhZGVyOlxuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0YnV0dG9uOiBzdHlsZXMuaXNEZXNrdG9wTGF5b3V0KCkgPyB0aGVtZS5oZWFkZXJfYnV0dG9uIDogdGhlbWUuY29udGVudF9hY2NlbnQsXG5cdFx0XHRcdGJ1dHRvbl9zZWxlY3RlZDogc3R5bGVzLmlzRGVza3RvcExheW91dCgpID8gdGhlbWUuaGVhZGVyX2J1dHRvbl9zZWxlY3RlZCA6IHRoZW1lLmNvbnRlbnRfYWNjZW50LFxuXHRcdFx0fVxuXG5cdFx0Y2FzZSBOYXZCdXR0b25Db2xvci5OYXY6XG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRidXR0b246IHRoZW1lLm5hdmlnYXRpb25fYnV0dG9uLFxuXHRcdFx0XHRidXR0b25fc2VsZWN0ZWQ6IHRoZW1lLm5hdmlnYXRpb25fYnV0dG9uX3NlbGVjdGVkLFxuXHRcdFx0fVxuXG5cdFx0ZGVmYXVsdDpcblx0XHRcdC8vIGZvciBuYXYgYnV0dG9ucyBpbiB0aGUgbW9yZSBkcm9wZG93biBtZW51XG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRidXR0b246IHRoZW1lLmNvbnRlbnRfYnV0dG9uLFxuXHRcdFx0XHRidXR0b25fc2VsZWN0ZWQ6IHRoZW1lLmNvbnRlbnRfYnV0dG9uX3NlbGVjdGVkLFxuXHRcdFx0fVxuXHR9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc05hdkJ1dHRvblNlbGVjdGVkKGE6IE5hdkJ1dHRvbkF0dHJzKTogYm9vbGVhbiB7XG5cdGlmICh0eXBlb2YgYS5pc1NlbGVjdGVkUHJlZml4ID09PSBcImJvb2xlYW5cIikge1xuXHRcdHJldHVybiBhLmlzU2VsZWN0ZWRQcmVmaXhcblx0fVxuXG5cdGNvbnN0IHNlbGVjdGVkUHJlZml4ID0gYS5pc1NlbGVjdGVkUHJlZml4IHx8IGxhenlTdHJpbmdWYWx1ZShhLmhyZWYpXG5cdHJldHVybiBpc1NlbGVjdGVkUHJlZml4KHNlbGVjdGVkUHJlZml4KVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNTZWxlY3RlZFByZWZpeChocmVmOiBzdHJpbmcpOiBib29sZWFuIHtcblx0Y29uc3QgY3VycmVudCA9IG0ucm91dGUuZ2V0KClcblx0Ly8gZG9uJ3QganVzdCBjaGVjayBjdXJyZW50LmluZGV4T2YoYnV0dG9uSHJlZikgYmVjYXVzZSBvdGhlciBidXR0b25zIG1heSBhbHNvIHN0YXJ0IHdpdGggdGhpcyBocmVmXG5cdHJldHVybiBocmVmICE9PSBcIlwiICYmIChjdXJyZW50ID09PSBocmVmIHx8IGN1cnJlbnQuaW5kZXhPZihocmVmICsgXCIvXCIpID09PSAwIHx8IGN1cnJlbnQuaW5kZXhPZihocmVmICsgXCI/XCIpID09PSAwKVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFrQkEsa0JBQWtCO0lBd0JMLFlBQU4sTUFBcUQ7Q0FDM0QsQUFBUTtDQUNSLEFBQVE7Q0FDUixBQUFRO0NBRVIsY0FBYztBQUNiLE9BQUssZUFBZTtBQUNwQixPQUFLLGVBQWU7Q0FDcEI7Q0FFRCxLQUFLQSxPQUF3QztFQUM1QyxNQUFNLElBQUksTUFBTTtFQUVoQixNQUFNLFlBQVksS0FBSyx1QkFBdUIsRUFBRTtF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