import { assertNotNull, downcast, incrementDate, mapAndFilterNull, neverNull, pad, stringToUtf8Uint8Array } from "./dist2-chunk.js";
import { EndType, RepeatPeriod, SECOND_MS, assertEnumValue } from "./TutanotaConstants-chunk.js";
import { DateTime } from "./luxon-chunk.js";
import { getLetId } from "./EntityUtils-chunk.js";
import { createFile } from "./TypeRefs-chunk.js";
import { getAllDayDateLocal, isAllDayEvent } from "./CommonCalendarUtils-chunk.js";
import { AlarmIntervalUnit, generateUid, getTimeZone, parseAlarmInterval } from "./CalendarUtils-chunk.js";
import { calendarAttendeeStatusToParstat, iCalReplacements, repeatPeriodToIcalFrequency } from "./ImportExportUtils-chunk.js";
import { convertToDataFile } from "./BlobUtils-chunk.js";
import { CALENDAR_MIME_TYPE } from "./SharedMailUtils-chunk.js";

//#region src/calendar-app/calendar/export/CalendarExporter.ts
function makeInvitationCalendarFile(event, method, now, zone) {
	const stringValue = makeInvitationCalendar(env.versionNumber, event, method, now, zone);
	const data = stringToUtf8Uint8Array(stringValue);
	const date = new Date();
	const tmpFile = createFile({
		name: `${method.toLowerCase()}-${date.getFullYear()}${date.getMonth() + 1}${date.getDate()}.ics`,
		mimeType: CALENDAR_MIME_TYPE,
		size: String(data.byteLength),
		cid: null,
		blobs: [],
		parent: null,
		subFiles: null
	});
	return convertToDataFile(tmpFile, data);
}
function serializeCalendar(versionNumber, events, now, zone) {
	return wrapIntoCalendar(versionNumber, "PUBLISH", events.map(({ event, alarms }) => serializeEvent(event, alarms, now, zone)).flat());
}
function serializeEvent(event, alarms, now, timeZone) {
	const repeatRule = event.repeatRule;
	const isAllDay = isAllDayEvent(event);
	const localZone = getTimeZone();
	let dateStart, dateEnd;
	if (isAllDay) {
		dateStart = `DTSTART;VALUE=DATE:${formatDate(getAllDayDateLocal(event.startTime), localZone)}`;
		dateEnd = `DTEND;VALUE=DATE:${formatDate(getAllDayDateLocal(event.endTime), localZone)}`;
	} else if (repeatRule) {
		dateStart = `DTSTART;TZID=${repeatRule.timeZone}:${formatDateTime(event.startTime, repeatRule.timeZone)}`;
		dateEnd = `DTEND;TZID=${repeatRule.timeZone}:${formatDateTime(event.endTime, repeatRule.timeZone)}`;
	} else {
		dateStart = `DTSTART:${formatDateTimeUTC(event.startTime)}`;
		dateEnd = `DTEND:${formatDateTimeUTC(event.endTime)}`;
	}
	return [
		"BEGIN:VEVENT",
		dateStart,
		dateEnd,
		`DTSTAMP:${formatDateTimeUTC(now)}`,
		`UID:${event.uid ? event.uid : generateUid(assertNotNull(event._ownerGroup), now.getTime())}`,
		`SEQUENCE:${event.sequence}`,
		`SUMMARY:${serializeIcalText(event.summary)}`
	].concat(event.recurrenceId != null ? isAllDay ? `RECURRENCE-ID;VALUE=DATE:${formatDate(getAllDayDateLocal(event.recurrenceId), localZone)}` : `RECURRENCE-ID;VALUE=DATETIME:${formatDateTimeUTC(event.recurrenceId)}` : []).concat(event.description && event.description !== "" ? `DESCRIPTION:${serializeIcalText(event.description)}` : []).concat(event.recurrenceId == null ? serializeRepeatRule(repeatRule, isAllDay, timeZone) : []).concat(event.location && event.location.length > 0 ? `LOCATION:${serializeIcalText(event.location)}` : []).concat(...mapAndFilterNull(alarms, (alarm) => {
		try {
			return serializeAlarm(event, alarm);
		} catch (e) {
			console.log(`error serializing alarm ${getLetId(alarm).toString()} for event ${getLetId(event).toString()}:`, e);
			return null;
		}
	})).concat(serializeParticipants(event)).concat("END:VEVENT");
}
function serializeRepeatRule(repeatRule, isAllDayEvent$1, localTimeZone) {
	if (repeatRule) {
		let endType = "";
		if (repeatRule.endType === EndType.Count) endType = `;COUNT=${neverNull(repeatRule.endValue)}`;
else if (repeatRule.endType === EndType.UntilDate) {
			const date = new Date(Number(repeatRule.endValue));
			const value = isAllDayEvent$1 ? formatDate(incrementDate(date, -1), localTimeZone) : formatDateTimeUTC(new Date(date.getTime() - SECOND_MS));
			endType = `;UNTIL=${value}`;
		}
		const excludedDates = serializeExcludedDates(repeatRule.excludedDates, repeatRule.timeZone);
		return [`RRULE:FREQ=${repeatPeriodToIcalFrequency(assertEnumValue(RepeatPeriod, repeatRule.frequency))}` + `;INTERVAL=${repeatRule.interval}` + endType].concat(excludedDates);
	} else return [];
}
function serializeExcludedDates(excludedDates, timeZone) {
	if (excludedDates.length > 0) {
		let dates = "";
		for (let i = 0; i < excludedDates.length; i++) {
			dates += formatDateTime(excludedDates[i].date, timeZone);
			if (i < excludedDates.length - 1) dates += ",";
		}
		return [`EXDATE;TZID=${timeZone}:${dates}`];
	} else return [];
}
function formatDateTimeUTC(date) {
	return `${date.getUTCFullYear()}${pad2(date.getUTCMonth() + 1)}${pad2(date.getUTCDate())}T${pad2(date.getUTCHours())}${pad2(date.getUTCMinutes())}${pad2(date.getUTCSeconds())}Z`;
}
function formatDateTime(date, timeZone) {
	const dateTime = DateTime.fromJSDate(date, { zone: timeZone });
	return `${dateTime.year}${pad2(dateTime.month)}${pad2(dateTime.day)}T${pad2(dateTime.hour)}${pad2(dateTime.minute)}${pad2(dateTime.second)}`;
}
function formatDate(date, timeZone) {
	const dateTime = DateTime.fromJSDate(date, { zone: timeZone });
	return `${dateTime.year}${pad2(dateTime.month)}${pad2(dateTime.day)}`;
}
function makeInvitationCalendar(versionNumber, event, method, now, zone) {
	const eventSerialized = serializeEvent(event, [], now, zone);
	return wrapIntoCalendar(versionNumber, method, eventSerialized);
}
function serializeTrigger(dbAlarmInterval) {
	const alarmInterval = parseAlarmInterval(dbAlarmInterval);
	let timeMarker = "";
	if (alarmInterval.unit === AlarmIntervalUnit.MINUTE || alarmInterval.unit === AlarmIntervalUnit.HOUR) timeMarker += "T";
	return "-P" + timeMarker + alarmInterval.value.toString() + alarmInterval.unit;
}
function serializeParticipants(event) {
	const { organizer, attendees } = event;
	if (attendees.length === 0 && organizer == null) return [];
	const lines = [];
	if (organizer) {
		const namePart = organizer.name ? `;CN=${quotedString(organizer.name)}` : "";
		lines.push(`ORGANIZER${namePart};EMAIL=${organizer.address}:mailto:${organizer.address}`);
	}
	const attendeesProperties = attendees.map(({ address, status }) => {
		const namePart = address.name ? `;CN=${quotedString(address.name)}` : "";
		const partstat = calendarAttendeeStatusToParstat[downcast(status)];
		return `ATTENDEE;CUTYPE=INDIVIDUAL;ROLE=REQ-PARTICIPANT;PARTSTAT=${partstat}` + `;RSVP=TRUE${namePart};EMAIL=${address.address}:mailto:${address.address}`;
	});
	return lines.concat(attendeesProperties);
}
/**
* Create an ical quoted-string param-value
* double quotes are not allowed inside of param-value properties so they are removed
*/
function quotedString(input) {
	return `"${input.replace(/"/g, "")}"`;
}
/**
* Serialize text properties according to the iCal standard.
* https://icalendar.org/iCalendar-RFC-5545/3-3-11-text.html
*/
function serializeIcalText(value) {
	let text = value;
	for (const rawEscape in iCalReplacements) text = text.replaceAll(rawEscape, iCalReplacements[rawEscape]);
	return text;
}
function pad2(number) {
	return pad(number, 2);
}
function wrapIntoCalendar(versionNumber, method, contents) {
	let value = [
		"BEGIN:VCALENDAR",
		`PRODID:-//Tutao GmbH//Tutanota ${versionNumber}//EN`,
		"VERSION:2.0",
		"CALSCALE:GREGORIAN",
		`METHOD:${method}`
	];
	value.push(...contents);
	value.push("END:VCALENDAR");
	return value.join("\r\n");
}
function serializeAlarm(event, alarm) {
	return [
		"BEGIN:VALARM",
		"ACTION:DISPLAY",
		"DESCRIPTION:This is an event reminder",
		`TRIGGER:${serializeTrigger(alarm.alarmInfo.trigger)}`,
		"END:VALARM"
	];
}

//#endregion
export { makeInvitationCalendarFile, serializeCalendar };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2FsZW5kYXJFeHBvcnRlci1jaHVuay5qcyIsIm5hbWVzIjpbImV2ZW50OiBDYWxlbmRhckV2ZW50IiwibWV0aG9kOiBDYWxlbmRhck1ldGhvZCIsIm5vdzogRGF0ZSIsInpvbmU6IHN0cmluZyIsInZlcnNpb25OdW1iZXI6IHN0cmluZyIsImV2ZW50czogQXJyYXk8e1xuXHRcdGV2ZW50OiBDYWxlbmRhckV2ZW50XG5cdFx0YWxhcm1zOiBBcnJheTxVc2VyQWxhcm1JbmZvPlxuXHR9PiIsImFsYXJtczogQXJyYXk8VXNlckFsYXJtSW5mbz4iLCJ0aW1lWm9uZTogc3RyaW5nIiwicmVwZWF0UnVsZTogUmVwZWF0UnVsZSB8IG51bGwiLCJpc0FsbERheUV2ZW50OiBib29sZWFuIiwibG9jYWxUaW1lWm9uZTogc3RyaW5nIiwiaXNBbGxEYXlFdmVudCIsImV4Y2x1ZGVkRGF0ZXM6IERhdGVXcmFwcGVyW10iLCJkYXRlOiBEYXRlIiwibWV0aG9kOiBzdHJpbmciLCJkYkFsYXJtSW50ZXJ2YWw6IHN0cmluZyIsImxpbmVzOiBzdHJpbmdbXSIsImlucHV0OiBzdHJpbmciLCJ2YWx1ZTogc3RyaW5nIiwibnVtYmVyOiBudW1iZXIiLCJjb250ZW50czogQXJyYXk8c3RyaW5nPiIsImFsYXJtOiBVc2VyQWxhcm1JbmZvIl0sInNvdXJjZXMiOlsiLi4vc3JjL2NhbGVuZGFyLWFwcC9jYWxlbmRhci9leHBvcnQvQ2FsZW5kYXJFeHBvcnRlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IENhbGVuZGFyQXR0ZW5kZWVTdGF0dXMsIENhbGVuZGFyTWV0aG9kIH0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9hcGkvY29tbW9uL1R1dGFub3RhQ29uc3RhbnRzXCJcbmltcG9ydCB7IGFzc2VydEVudW1WYWx1ZSwgRW5kVHlwZSwgUmVwZWF0UGVyaW9kLCBTRUNPTkRfTVMgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2FwaS9jb21tb24vVHV0YW5vdGFDb25zdGFudHNcIlxuaW1wb3J0IHsgYXNzZXJ0Tm90TnVsbCwgZG93bmNhc3QsIGluY3JlbWVudERhdGUsIG1hcEFuZEZpbHRlck51bGwsIG5ldmVyTnVsbCwgcGFkLCBzdHJpbmdUb1V0ZjhVaW50OEFycmF5IH0gZnJvbSBcIkB0dXRhby90dXRhbm90YS11dGlsc1wiXG5pbXBvcnQgeyBjYWxlbmRhckF0dGVuZGVlU3RhdHVzVG9QYXJzdGF0LCBpQ2FsUmVwbGFjZW1lbnRzLCByZXBlYXRQZXJpb2RUb0ljYWxGcmVxdWVuY3kgfSBmcm9tIFwiLi9DYWxlbmRhclBhcnNlclwiXG5pbXBvcnQgeyBnZXRBbGxEYXlEYXRlTG9jYWwsIGlzQWxsRGF5RXZlbnQgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2FwaS9jb21tb24vdXRpbHMvQ29tbW9uQ2FsZW5kYXJVdGlsc1wiXG5pbXBvcnQgeyBBbGFybUludGVydmFsVW5pdCwgZ2VuZXJhdGVVaWQsIGdldFRpbWVab25lLCBwYXJzZUFsYXJtSW50ZXJ2YWwgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2NhbGVuZGFyL2RhdGUvQ2FsZW5kYXJVdGlsc1wiXG5pbXBvcnQgdHlwZSB7IENhbGVuZGFyRXZlbnQgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2FwaS9lbnRpdGllcy90dXRhbm90YS9UeXBlUmVmcy5qc1wiXG5pbXBvcnQgeyBjcmVhdGVGaWxlIH0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9hcGkvZW50aXRpZXMvdHV0YW5vdGEvVHlwZVJlZnMuanNcIlxuaW1wb3J0IHsgY29udmVydFRvRGF0YUZpbGUsIERhdGFGaWxlIH0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9hcGkvY29tbW9uL0RhdGFGaWxlXCJcbmltcG9ydCB0eXBlIHsgRGF0ZVdyYXBwZXIsIFJlcGVhdFJ1bGUsIFVzZXJBbGFybUluZm8gfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2FwaS9lbnRpdGllcy9zeXMvVHlwZVJlZnMuanNcIlxuaW1wb3J0IHsgRGF0ZVRpbWUgfSBmcm9tIFwibHV4b25cIlxuaW1wb3J0IHsgZ2V0TGV0SWQgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2FwaS9jb21tb24vdXRpbHMvRW50aXR5VXRpbHNcIlxuaW1wb3J0IHsgQ0FMRU5EQVJfTUlNRV9UWVBFIH0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9maWxlL0ZpbGVDb250cm9sbGVyLmpzXCJcblxuLyoqIGNyZWF0ZSBhbiBpY2FsIGRhdGEgZmlsZSB0aGF0IGNhbiBiZSBhdHRhY2hlZCB0byBhbiBpbnZpdGF0aW9uL3VwZGF0ZS9jYW5jZWxsYXRpb24vcmVzcG9uc2UgbWFpbCAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1ha2VJbnZpdGF0aW9uQ2FsZW5kYXJGaWxlKGV2ZW50OiBDYWxlbmRhckV2ZW50LCBtZXRob2Q6IENhbGVuZGFyTWV0aG9kLCBub3c6IERhdGUsIHpvbmU6IHN0cmluZyk6IERhdGFGaWxlIHtcblx0Y29uc3Qgc3RyaW5nVmFsdWUgPSBtYWtlSW52aXRhdGlvbkNhbGVuZGFyKGVudi52ZXJzaW9uTnVtYmVyLCBldmVudCwgbWV0aG9kLCBub3csIHpvbmUpXG5cdGNvbnN0IGRhdGEgPSBzdHJpbmdUb1V0ZjhVaW50OEFycmF5KHN0cmluZ1ZhbHVlKVxuXHRjb25zdCBkYXRlID0gbmV3IERhdGUoKVxuXHRjb25zdCB0bXBGaWxlID0gY3JlYXRlRmlsZSh7XG5cdFx0bmFtZTogYCR7bWV0aG9kLnRvTG93ZXJDYXNlKCl9LSR7ZGF0ZS5nZXRGdWxsWWVhcigpfSR7ZGF0ZS5nZXRNb250aCgpICsgMX0ke2RhdGUuZ2V0RGF0ZSgpfS5pY3NgLFxuXHRcdG1pbWVUeXBlOiBDQUxFTkRBUl9NSU1FX1RZUEUsXG5cdFx0c2l6ZTogU3RyaW5nKGRhdGEuYnl0ZUxlbmd0aCksXG5cdFx0Y2lkOiBudWxsLFxuXHRcdGJsb2JzOiBbXSxcblx0XHRwYXJlbnQ6IG51bGwsXG5cdFx0c3ViRmlsZXM6IG51bGwsXG5cdH0pXG5cdHJldHVybiBjb252ZXJ0VG9EYXRhRmlsZSh0bXBGaWxlLCBkYXRhKVxufVxuXG4vKiogc2VyaWFsaXplIGEgbGlzdCBvZiBldmVudHMgaW50byBhIHZhbGlkIGljYWwgc3RyaW5nIHVzaW5nIHRoZSBQVUJMSVNIIG1ldGhvZCBzdWl0YWJsZSB0byBpbXBvcnQgYXMgYSBjYWxlbmRhciBpbnRvIGFueSBhcHAgc3VwcG9ydGluZyBpY2FsICovXG5leHBvcnQgZnVuY3Rpb24gc2VyaWFsaXplQ2FsZW5kYXIoXG5cdHZlcnNpb25OdW1iZXI6IHN0cmluZyxcblx0ZXZlbnRzOiBBcnJheTx7XG5cdFx0ZXZlbnQ6IENhbGVuZGFyRXZlbnRcblx0XHRhbGFybXM6IEFycmF5PFVzZXJBbGFybUluZm8+XG5cdH0+LFxuXHRub3c6IERhdGUsXG5cdHpvbmU6IHN0cmluZyxcbik6IHN0cmluZyB7XG5cdHJldHVybiB3cmFwSW50b0NhbGVuZGFyKHZlcnNpb25OdW1iZXIsIFwiUFVCTElTSFwiLCBldmVudHMubWFwKCh7IGV2ZW50LCBhbGFybXMgfSkgPT4gc2VyaWFsaXplRXZlbnQoZXZlbnQsIGFsYXJtcywgbm93LCB6b25lKSkuZmxhdCgpKVxufVxuXG4vL1xuLy8gZW5kIG9mIHRoZSBwdWJsaWMgaW50ZXJmYWNlIGZvciBjYWxlbmRhciBpbnZpdGVzL2ltcG9ydC9leHBvcnQsIGV2ZXJ5dGhpbmcgYmVsb3cgdGhpcyBpcyBleHBvcnRlZCBmb3IgdGVzdGluZy5cbi8vXG5cbi8qKiBpbXBvcnRlciBpbnRlcm5hbHMgZXhwb3J0ZWQgZm9yIHRlc3RpbmcsIHNob3VsZCBhbHdheXMgYmUgdXNlZCB0aHJvdWdoIHNlcmlhbGl6ZUNhbGVuZGFyICovXG5leHBvcnQgZnVuY3Rpb24gc2VyaWFsaXplRXZlbnQoZXZlbnQ6IENhbGVuZGFyRXZlbnQsIGFsYXJtczogQXJyYXk8VXNlckFsYXJtSW5mbz4sIG5vdzogRGF0ZSwgdGltZVpvbmU6IHN0cmluZyk6IEFycmF5PHN0cmluZz4ge1xuXHRjb25zdCByZXBlYXRSdWxlID0gZXZlbnQucmVwZWF0UnVsZVxuXHRjb25zdCBpc0FsbERheSA9IGlzQWxsRGF5RXZlbnQoZXZlbnQpXG5cdGNvbnN0IGxvY2FsWm9uZSA9IGdldFRpbWVab25lKClcblx0bGV0IGRhdGVTdGFydCwgZGF0ZUVuZFxuXG5cdGlmIChpc0FsbERheSkge1xuXHRcdC8vIFdlIHVzZSBsb2NhbCB6b25lIGJlY2F1c2Ugd2UgY29udmVydCBVVEMgdGltZSB0byBsb2NhbCBmaXJzdCBzbyB0byBjb252ZXJ0IGl0IGJhY2sgd2UgbmVlZCB0byB1c2UgdGhlIHJpZ2h0IG9uZS5cblx0XHQvLyBJdCB3aWxsIG5vdCBhZmZlY3QgdGltZXMgaW4gY2FzZSBvZiBhbGwtZGF5IGV2ZW50IGFueXdheVxuXHRcdGRhdGVTdGFydCA9IGBEVFNUQVJUO1ZBTFVFPURBVEU6JHtmb3JtYXREYXRlKGdldEFsbERheURhdGVMb2NhbChldmVudC5zdGFydFRpbWUpLCBsb2NhbFpvbmUpfWBcblx0XHRkYXRlRW5kID0gYERURU5EO1ZBTFVFPURBVEU6JHtmb3JtYXREYXRlKGdldEFsbERheURhdGVMb2NhbChldmVudC5lbmRUaW1lKSwgbG9jYWxab25lKX1gXG5cdH0gZWxzZSBpZiAocmVwZWF0UnVsZSkge1xuXHRcdGRhdGVTdGFydCA9IGBEVFNUQVJUO1RaSUQ9JHtyZXBlYXRSdWxlLnRpbWVab25lfToke2Zvcm1hdERhdGVUaW1lKGV2ZW50LnN0YXJ0VGltZSwgcmVwZWF0UnVsZS50aW1lWm9uZSl9YFxuXHRcdGRhdGVFbmQgPSBgRFRFTkQ7VFpJRD0ke3JlcGVhdFJ1bGUudGltZVpvbmV9OiR7Zm9ybWF0RGF0ZVRpbWUoZXZlbnQuZW5kVGltZSwgcmVwZWF0UnVsZS50aW1lWm9uZSl9YFxuXHR9IGVsc2Uge1xuXHRcdGRhdGVTdGFydCA9IGBEVFNUQVJUOiR7Zm9ybWF0RGF0ZVRpbWVVVEMoZXZlbnQuc3RhcnRUaW1lKX1gXG5cdFx0ZGF0ZUVuZCA9IGBEVEVORDoke2Zvcm1hdERhdGVUaW1lVVRDKGV2ZW50LmVuZFRpbWUpfWBcblx0fVxuXG5cdHJldHVybiBbXG5cdFx0XCJCRUdJTjpWRVZFTlRcIixcblx0XHRkYXRlU3RhcnQsXG5cdFx0ZGF0ZUVuZCxcblx0XHRgRFRTVEFNUDoke2Zvcm1hdERhdGVUaW1lVVRDKG5vdyl9YCxcblx0XHRgVUlEOiR7ZXZlbnQudWlkID8gZXZlbnQudWlkIDogZ2VuZXJhdGVVaWQoYXNzZXJ0Tm90TnVsbChldmVudC5fb3duZXJHcm91cCksIG5vdy5nZXRUaW1lKCkpfWAsIC8vIGxlZ2FjeTogb25seSBnZW5lcmF0ZSB1aWQgZm9yIG9sZGVyIGNhbGVuZGFyIGV2ZW50cy5cblx0XHRgU0VRVUVOQ0U6JHtldmVudC5zZXF1ZW5jZX1gLFxuXHRcdGBTVU1NQVJZOiR7c2VyaWFsaXplSWNhbFRleHQoZXZlbnQuc3VtbWFyeSl9YCxcblx0XVxuXHRcdC5jb25jYXQoXG5cdFx0XHRldmVudC5yZWN1cnJlbmNlSWQgIT0gbnVsbFxuXHRcdFx0XHQ/IGlzQWxsRGF5XG5cdFx0XHRcdFx0PyBgUkVDVVJSRU5DRS1JRDtWQUxVRT1EQVRFOiR7Zm9ybWF0RGF0ZShnZXRBbGxEYXlEYXRlTG9jYWwoZXZlbnQucmVjdXJyZW5jZUlkKSwgbG9jYWxab25lKX1gXG5cdFx0XHRcdFx0OiBgUkVDVVJSRU5DRS1JRDtWQUxVRT1EQVRFVElNRToke2Zvcm1hdERhdGVUaW1lVVRDKGV2ZW50LnJlY3VycmVuY2VJZCl9YFxuXHRcdFx0XHQ6IFtdLFxuXHRcdClcblx0XHQuY29uY2F0KGV2ZW50LmRlc2NyaXB0aW9uICYmIGV2ZW50LmRlc2NyaXB0aW9uICE9PSBcIlwiID8gYERFU0NSSVBUSU9OOiR7c2VyaWFsaXplSWNhbFRleHQoZXZlbnQuZGVzY3JpcHRpb24pfWAgOiBbXSlcblx0XHQuY29uY2F0KGV2ZW50LnJlY3VycmVuY2VJZCA9PSBudWxsID8gc2VyaWFsaXplUmVwZWF0UnVsZShyZXBlYXRSdWxlLCBpc0FsbERheSwgdGltZVpvbmUpIDogW10pXG5cdFx0LmNvbmNhdChldmVudC5sb2NhdGlvbiAmJiBldmVudC5sb2NhdGlvbi5sZW5ndGggPiAwID8gYExPQ0FUSU9OOiR7c2VyaWFsaXplSWNhbFRleHQoZXZlbnQubG9jYXRpb24pfWAgOiBbXSlcblx0XHQuY29uY2F0KFxuXHRcdFx0Li4ubWFwQW5kRmlsdGVyTnVsbChhbGFybXMsIChhbGFybSkgPT4ge1xuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdHJldHVybiBzZXJpYWxpemVBbGFybShldmVudCwgYWxhcm0pXG5cdFx0XHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhgZXJyb3Igc2VyaWFsaXppbmcgYWxhcm0gJHtnZXRMZXRJZChhbGFybSkudG9TdHJpbmcoKX0gZm9yIGV2ZW50ICR7Z2V0TGV0SWQoZXZlbnQpLnRvU3RyaW5nKCl9OmAsIGUpXG5cdFx0XHRcdFx0cmV0dXJuIG51bGxcblx0XHRcdFx0fVxuXHRcdFx0fSksXG5cdFx0KVxuXHRcdC5jb25jYXQoc2VyaWFsaXplUGFydGljaXBhbnRzKGV2ZW50KSlcblx0XHQuY29uY2F0KFwiRU5EOlZFVkVOVFwiKVxufVxuXG4vKiogaW1wb3J0ZXIgaW50ZXJuYWxzIGV4cG9ydGVkIGZvciB0ZXN0aW5nICovXG5leHBvcnQgZnVuY3Rpb24gc2VyaWFsaXplUmVwZWF0UnVsZShyZXBlYXRSdWxlOiBSZXBlYXRSdWxlIHwgbnVsbCwgaXNBbGxEYXlFdmVudDogYm9vbGVhbiwgbG9jYWxUaW1lWm9uZTogc3RyaW5nKSB7XG5cdGlmIChyZXBlYXRSdWxlKSB7XG5cdFx0bGV0IGVuZFR5cGUgPSBcIlwiXG5cblx0XHRpZiAocmVwZWF0UnVsZS5lbmRUeXBlID09PSBFbmRUeXBlLkNvdW50KSB7XG5cdFx0XHRlbmRUeXBlID0gYDtDT1VOVD0ke25ldmVyTnVsbChyZXBlYXRSdWxlLmVuZFZhbHVlKX1gXG5cdFx0fSBlbHNlIGlmIChyZXBlYXRSdWxlLmVuZFR5cGUgPT09IEVuZFR5cGUuVW50aWxEYXRlKSB7XG5cdFx0XHQvLyBBY2NvcmRpbmcgdG8gdGhlIFJGQyA1NTQ1IHNlY3Rpb24gMy4zLjVcblx0XHRcdC8vICBUaGUgVU5USUwgcnVsZSBwYXJ0IGRlZmluZXMgYSBEQVRFIG9yIERBVEUtVElNRSB2YWx1ZSB0aGF0IGJvdW5kc1xuXHRcdFx0Ly8gIHRoZSByZWN1cnJlbmNlIHJ1bGUgaW4gYW4gaW5jbHVzaXZlIG1hbm5lci4gIElmIHRoZSB2YWx1ZVxuXHRcdFx0Ly8gIHNwZWNpZmllZCBieSBVTlRJTCBpcyBzeW5jaHJvbml6ZWQgd2l0aCB0aGUgc3BlY2lmaWVkIHJlY3VycmVuY2UsXG5cdFx0XHQvLyAgdGhpcyBEQVRFIG9yIERBVEUtVElNRSBiZWNvbWVzIHRoZSBsYXN0IGluc3RhbmNlIG9mIHRoZVxuXHRcdFx0Ly8gIHJlY3VycmVuY2UuICBUaGUgdmFsdWUgb2YgdGhlIFVOVElMIHJ1bGUgcGFydCBNVVNUIGhhdmUgdGhlIHNhbWVcblx0XHRcdC8vICB2YWx1ZSB0eXBlIGFzIHRoZSBcIkRUU1RBUlRcIiBwcm9wZXJ0eS4gIEZ1cnRoZXJtb3JlLCBpZiB0aGVcblx0XHRcdC8vICBcIkRUU1RBUlRcIiBwcm9wZXJ0eSBpcyBzcGVjaWZpZWQgYXMgYSBkYXRlIHdpdGggbG9jYWwgdGltZSwgdGhlblxuXHRcdFx0Ly8gIHRoZSBVTlRJTCBydWxlIHBhcnQgTVVTVCBhbHNvIGJlIHNwZWNpZmllZCBhcyBhIGRhdGUgd2l0aCBsb2NhbFxuXHRcdFx0Ly8gIHRpbWUuICBJZiB0aGUgXCJEVFNUQVJUXCIgcHJvcGVydHkgaXMgc3BlY2lmaWVkIGFzIGEgZGF0ZSB3aXRoIFVUQ1xuXHRcdFx0Ly8gIHRpbWUgb3IgYSBkYXRlIHdpdGggbG9jYWwgdGltZSBhbmQgdGltZSB6b25lIHJlZmVyZW5jZSwgdGhlbiB0aGVcblx0XHRcdC8vICBVTlRJTCBydWxlIHBhcnQgTVVTVCBiZSBzcGVjaWZpZWQgYXMgYSBkYXRlIHdpdGggVVRDIHRpbWUuXG5cdFx0XHQvLyBXZSBoYXZlIHRocmVlIGNhc2VzIChjaGVjayBzZXJpYWxpemVFdmVudCgpKS5cblx0XHRcdC8vIFNvIG91ciBtYXRyaXggd2lsIGJlOlxuXHRcdFx0Ly9cblx0XHRcdC8vIENhc2UgICAgICAgfCBzdGFydC9lbmQgZm9ybWF0IHwgVU5USUwgZm9ybWF0XG5cdFx0XHQvLyBBbGwtZGF5OiAgIHwgZGF0ZSAgICAgICAgICAgICB8IGRhdGVcblx0XHRcdC8vIHcvUlIgICAgICAgfCBUWklEICsgRGF0ZVRpbWUgIHwgdGltZXN0YW1wXG5cdFx0XHQvLyB3L28vUlIgICAgIHwgdGltZXN0YW1wICAgICAgICB8IE4vQVxuXHRcdFx0Ly9cblx0XHRcdC8vIEluIHRoaXMgYnJhbmNoIHRoZXJlIGlzIGEgcmVwZWF0IHJ1bGUgYW5kIHdlIGp1c3QgY2hlY2sgaWYgaXQncyBhbGwgZGF5LlxuXHRcdFx0Ly8gV2UgYWxzbyBkaWZmZXIgaW4gYSB3YXkgdGhhdCB3ZSBkZWZpbmUgZW5kIGFzIGV4Y2x1c2l2ZSAoYmVjYXVzZSBpdCdzIHNvXG5cdFx0XHQvLyBoYXJkIHRvIGZpbmQgYW55dGhpbmcgaW4gdGhpcyBSRkMpLlxuXHRcdFx0Y29uc3QgZGF0ZSA9IG5ldyBEYXRlKE51bWJlcihyZXBlYXRSdWxlLmVuZFZhbHVlKSlcblx0XHRcdGNvbnN0IHZhbHVlID0gaXNBbGxEYXlFdmVudCA/IGZvcm1hdERhdGUoaW5jcmVtZW50RGF0ZShkYXRlLCAtMSksIGxvY2FsVGltZVpvbmUpIDogZm9ybWF0RGF0ZVRpbWVVVEMobmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkgLSBTRUNPTkRfTVMpKVxuXHRcdFx0ZW5kVHlwZSA9IGA7VU5USUw9JHt2YWx1ZX1gXG5cdFx0fVxuXG5cdFx0Y29uc3QgZXhjbHVkZWREYXRlcyA9IHNlcmlhbGl6ZUV4Y2x1ZGVkRGF0ZXMocmVwZWF0UnVsZS5leGNsdWRlZERhdGVzLCByZXBlYXRSdWxlLnRpbWVab25lKVxuXHRcdHJldHVybiBbXG5cdFx0XHRgUlJVTEU6RlJFUT0ke3JlcGVhdFBlcmlvZFRvSWNhbEZyZXF1ZW5jeShhc3NlcnRFbnVtVmFsdWUoUmVwZWF0UGVyaW9kLCByZXBlYXRSdWxlLmZyZXF1ZW5jeSkpfWAgKyBgO0lOVEVSVkFMPSR7cmVwZWF0UnVsZS5pbnRlcnZhbH1gICsgZW5kVHlwZSxcblx0XHRdLmNvbmNhdChleGNsdWRlZERhdGVzKVxuXHR9IGVsc2Uge1xuXHRcdHJldHVybiBbXVxuXHR9XG59XG5cbi8qKiBpbXBvcnRlciBpbnRlcm5hbHMgZXhwb3J0ZWQgZm9yIHRlc3RpbmcgKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXJpYWxpemVFeGNsdWRlZERhdGVzKGV4Y2x1ZGVkRGF0ZXM6IERhdGVXcmFwcGVyW10sIHRpbWVab25lOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG5cdGlmIChleGNsdWRlZERhdGVzLmxlbmd0aCA+IDApIHtcblx0XHRsZXQgZGF0ZXMgPSBcIlwiXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBleGNsdWRlZERhdGVzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRkYXRlcyArPSBmb3JtYXREYXRlVGltZShleGNsdWRlZERhdGVzW2ldLmRhdGUsIHRpbWVab25lKVxuXHRcdFx0aWYgKGkgPCBleGNsdWRlZERhdGVzLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0ZGF0ZXMgKz0gXCIsXCJcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIFtgRVhEQVRFO1RaSUQ9JHt0aW1lWm9uZX06JHtkYXRlc31gXVxuXHR9IGVsc2Uge1xuXHRcdHJldHVybiBbXVxuXHR9XG59XG5cbi8qKiBpbXBvcnRlciBpbnRlcm5hbHMgZXhwb3J0ZWQgZm9yIHRlc3RpbmcgKi9cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXREYXRlVGltZVVUQyhkYXRlOiBEYXRlKTogc3RyaW5nIHtcblx0cmV0dXJuIGAke2RhdGUuZ2V0VVRDRnVsbFllYXIoKX0ke3BhZDIoZGF0ZS5nZXRVVENNb250aCgpICsgMSl9JHtwYWQyKGRhdGUuZ2V0VVRDRGF0ZSgpKX1UJHtwYWQyKGRhdGUuZ2V0VVRDSG91cnMoKSl9JHtwYWQyKGRhdGUuZ2V0VVRDTWludXRlcygpKX0ke3BhZDIoXG5cdFx0ZGF0ZS5nZXRVVENTZWNvbmRzKCksXG5cdCl9WmBcbn1cblxuZnVuY3Rpb24gZm9ybWF0RGF0ZVRpbWUoZGF0ZTogRGF0ZSwgdGltZVpvbmU6IHN0cmluZyk6IHN0cmluZyB7XG5cdGNvbnN0IGRhdGVUaW1lID0gRGF0ZVRpbWUuZnJvbUpTRGF0ZShkYXRlLCB7XG5cdFx0em9uZTogdGltZVpvbmUsXG5cdH0pXG5cdHJldHVybiBgJHtkYXRlVGltZS55ZWFyfSR7cGFkMihkYXRlVGltZS5tb250aCl9JHtwYWQyKGRhdGVUaW1lLmRheSl9VCR7cGFkMihkYXRlVGltZS5ob3VyKX0ke3BhZDIoZGF0ZVRpbWUubWludXRlKX0ke3BhZDIoZGF0ZVRpbWUuc2Vjb25kKX1gXG59XG5cbmZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZTogRGF0ZSwgdGltZVpvbmU6IHN0cmluZyk6IHN0cmluZyB7XG5cdGNvbnN0IGRhdGVUaW1lID0gRGF0ZVRpbWUuZnJvbUpTRGF0ZShkYXRlLCB7XG5cdFx0em9uZTogdGltZVpvbmUsXG5cdH0pXG5cdHJldHVybiBgJHtkYXRlVGltZS55ZWFyfSR7cGFkMihkYXRlVGltZS5tb250aCl9JHtwYWQyKGRhdGVUaW1lLmRheSl9YFxufVxuXG5mdW5jdGlvbiBtYWtlSW52aXRhdGlvbkNhbGVuZGFyKHZlcnNpb25OdW1iZXI6IHN0cmluZywgZXZlbnQ6IENhbGVuZGFyRXZlbnQsIG1ldGhvZDogc3RyaW5nLCBub3c6IERhdGUsIHpvbmU6IHN0cmluZyk6IHN0cmluZyB7XG5cdGNvbnN0IGV2ZW50U2VyaWFsaXplZCA9IHNlcmlhbGl6ZUV2ZW50KGV2ZW50LCBbXSwgbm93LCB6b25lKVxuXHRyZXR1cm4gd3JhcEludG9DYWxlbmRhcih2ZXJzaW9uTnVtYmVyLCBtZXRob2QsIGV2ZW50U2VyaWFsaXplZClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNlcmlhbGl6ZVRyaWdnZXIoZGJBbGFybUludGVydmFsOiBzdHJpbmcpOiBzdHJpbmcge1xuXHRjb25zdCBhbGFybUludGVydmFsID0gcGFyc2VBbGFybUludGVydmFsKGRiQWxhcm1JbnRlcnZhbClcblxuXHRsZXQgdGltZU1hcmtlciA9IFwiXCJcblxuXHRpZiAoYWxhcm1JbnRlcnZhbC51bml0ID09PSBBbGFybUludGVydmFsVW5pdC5NSU5VVEUgfHwgYWxhcm1JbnRlcnZhbC51bml0ID09PSBBbGFybUludGVydmFsVW5pdC5IT1VSKSB7XG5cdFx0dGltZU1hcmtlciArPSBcIlRcIlxuXHR9XG5cblx0cmV0dXJuIFwiLVBcIiArIHRpbWVNYXJrZXIgKyBhbGFybUludGVydmFsLnZhbHVlLnRvU3RyaW5nKCkgKyBhbGFybUludGVydmFsLnVuaXRcbn1cblxuZnVuY3Rpb24gc2VyaWFsaXplUGFydGljaXBhbnRzKGV2ZW50OiBDYWxlbmRhckV2ZW50KTogQXJyYXk8c3RyaW5nPiB7XG5cdGNvbnN0IHsgb3JnYW5pemVyLCBhdHRlbmRlZXMgfSA9IGV2ZW50XG5cblx0aWYgKGF0dGVuZGVlcy5sZW5ndGggPT09IDAgJiYgb3JnYW5pemVyID09IG51bGwpIHtcblx0XHRyZXR1cm4gW11cblx0fVxuXG5cdGNvbnN0IGxpbmVzOiBzdHJpbmdbXSA9IFtdXG5cblx0aWYgKG9yZ2FuaXplcikge1xuXHRcdGNvbnN0IG5hbWVQYXJ0ID0gb3JnYW5pemVyLm5hbWUgPyBgO0NOPSR7cXVvdGVkU3RyaW5nKG9yZ2FuaXplci5uYW1lKX1gIDogXCJcIlxuXHRcdGxpbmVzLnB1c2goYE9SR0FOSVpFUiR7bmFtZVBhcnR9O0VNQUlMPSR7b3JnYW5pemVyLmFkZHJlc3N9Om1haWx0bzoke29yZ2FuaXplci5hZGRyZXNzfWApXG5cdH1cblxuXHRjb25zdCBhdHRlbmRlZXNQcm9wZXJ0aWVzID0gYXR0ZW5kZWVzLm1hcCgoeyBhZGRyZXNzLCBzdGF0dXMgfSkgPT4ge1xuXHRcdGNvbnN0IG5hbWVQYXJ0ID0gYWRkcmVzcy5uYW1lID8gYDtDTj0ke3F1b3RlZFN0cmluZyhhZGRyZXNzLm5hbWUpfWAgOiBcIlwiXG5cdFx0Y29uc3QgcGFydHN0YXQgPSBjYWxlbmRhckF0dGVuZGVlU3RhdHVzVG9QYXJzdGF0W2Rvd25jYXN0PENhbGVuZGFyQXR0ZW5kZWVTdGF0dXM+KHN0YXR1cyldXG5cdFx0cmV0dXJuIChcblx0XHRcdGBBVFRFTkRFRTtDVVRZUEU9SU5ESVZJRFVBTDtST0xFPVJFUS1QQVJUSUNJUEFOVDtQQVJUU1RBVD0ke3BhcnRzdGF0fWAgKyBgO1JTVlA9VFJVRSR7bmFtZVBhcnR9O0VNQUlMPSR7YWRkcmVzcy5hZGRyZXNzfTptYWlsdG86JHthZGRyZXNzLmFkZHJlc3N9YFxuXHRcdClcblx0fSlcblx0cmV0dXJuIGxpbmVzLmNvbmNhdChhdHRlbmRlZXNQcm9wZXJ0aWVzKVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbiBpY2FsIHF1b3RlZC1zdHJpbmcgcGFyYW0tdmFsdWVcbiAqIGRvdWJsZSBxdW90ZXMgYXJlIG5vdCBhbGxvd2VkIGluc2lkZSBvZiBwYXJhbS12YWx1ZSBwcm9wZXJ0aWVzIHNvIHRoZXkgYXJlIHJlbW92ZWRcbiAqL1xuZnVuY3Rpb24gcXVvdGVkU3RyaW5nKGlucHV0OiBzdHJpbmcpOiBzdHJpbmcge1xuXHRyZXR1cm4gYFwiJHtpbnB1dC5yZXBsYWNlKC9cIi9nLCBcIlwiKX1cImBcbn1cblxuLyoqXG4gKiBTZXJpYWxpemUgdGV4dCBwcm9wZXJ0aWVzIGFjY29yZGluZyB0byB0aGUgaUNhbCBzdGFuZGFyZC5cbiAqIGh0dHBzOi8vaWNhbGVuZGFyLm9yZy9pQ2FsZW5kYXItUkZDLTU1NDUvMy0zLTExLXRleHQuaHRtbFxuICovXG5mdW5jdGlvbiBzZXJpYWxpemVJY2FsVGV4dCh2YWx1ZTogc3RyaW5nKTogc3RyaW5nIHtcblx0bGV0IHRleHQgPSB2YWx1ZVxuXHRmb3IgKGNvbnN0IHJhd0VzY2FwZSBpbiBpQ2FsUmVwbGFjZW1lbnRzKSB7XG5cdFx0dGV4dCA9IHRleHQucmVwbGFjZUFsbChyYXdFc2NhcGUsIGlDYWxSZXBsYWNlbWVudHNbcmF3RXNjYXBlIGFzIGtleW9mIHR5cGVvZiBpQ2FsUmVwbGFjZW1lbnRzXSlcblx0fVxuXHRyZXR1cm4gdGV4dFxufVxuXG5mdW5jdGlvbiBwYWQyKG51bWJlcjogbnVtYmVyKSB7XG5cdHJldHVybiBwYWQobnVtYmVyLCAyKVxufVxuXG5mdW5jdGlvbiB3cmFwSW50b0NhbGVuZGFyKHZlcnNpb25OdW1iZXI6IHN0cmluZywgbWV0aG9kOiBzdHJpbmcsIGNvbnRlbnRzOiBBcnJheTxzdHJpbmc+KTogc3RyaW5nIHtcblx0bGV0IHZhbHVlID0gW1wiQkVHSU46VkNBTEVOREFSXCIsIGBQUk9ESUQ6LS8vVHV0YW8gR21iSC8vVHV0YW5vdGEgJHt2ZXJzaW9uTnVtYmVyfS8vRU5gLCBcIlZFUlNJT046Mi4wXCIsIFwiQ0FMU0NBTEU6R1JFR09SSUFOXCIsIGBNRVRIT0Q6JHttZXRob2R9YF1cblx0dmFsdWUucHVzaCguLi5jb250ZW50cylcblx0dmFsdWUucHVzaChcIkVORDpWQ0FMRU5EQVJcIilcblx0cmV0dXJuIHZhbHVlLmpvaW4oXCJcXHJcXG5cIilcbn1cblxuZnVuY3Rpb24gc2VyaWFsaXplQWxhcm0oZXZlbnQ6IENhbGVuZGFyRXZlbnQsIGFsYXJtOiBVc2VyQWxhcm1JbmZvKTogQXJyYXk8c3RyaW5nPiB7XG5cdC8vIHByZXR0aWVyLWlnbm9yZVxuXHRyZXR1cm4gW1xuXHRcdFwiQkVHSU46VkFMQVJNXCIsXG5cdFx0XCJBQ1RJT046RElTUExBWVwiLFxuXHRcdFwiREVTQ1JJUFRJT046VGhpcyBpcyBhbiBldmVudCByZW1pbmRlclwiLFxuXHRcdGBUUklHR0VSOiR7c2VyaWFsaXplVHJpZ2dlcihhbGFybS5hbGFybUluZm8udHJpZ2dlcil9YCxcblx0XHRcIkVORDpWQUxBUk1cIixcblx0XVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFlTyxTQUFTLDJCQUEyQkEsT0FBc0JDLFFBQXdCQyxLQUFXQyxNQUF3QjtDQUMzSCxNQUFNLGNBQWMsdUJBQXVCLElBQUksZUFBZSxPQUFPLFFBQVEsS0FBSyxLQUFLO0NBQ3ZGLE1BQU0sT0FBTyx1QkFBdUIsWUFBWTtDQUNoRCxNQUFNLE9BQU8sSUFBSTtDQUNqQixNQUFNLFVBQVUsV0FBVztFQUMxQixPQUFPLEVBQUUsT0FBTyxhQUFhLENBQUMsR0FBRyxL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