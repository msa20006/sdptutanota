import "./dist-chunk.js";
import "./ProgrammingError-chunk.js";
import { assertMainOrNode, getApiBaseUrl, isDesktop } from "./Env-chunk.js";
import "./ClientDetector-chunk.js";
import { assertNotNull, downcast, first, mapAndFilterNull, neverNull, ofClass } from "./dist2-chunk.js";
import { getWhitelabelCustomizations } from "./WhitelabelCustomizations-chunk.js";
import { AccountType, FeatureType, GroupType, LegacyPlans, OperationType, PlanType } from "./TutanotaConstants-chunk.js";
import { elementIdPart, isSameId, listIdPart } from "./EntityUtils-chunk.js";
import "./TypeModels-chunk.js";
import { TutanotaPropertiesTypeRef, UserSettingsGroupRootTypeRef, createUserSettingsGroupRoot } from "./TypeRefs-chunk.js";
import { typeModels$3 as typeModels } from "./TypeModels2-chunk.js";
import { AccountingInfoTypeRef, CustomerInfoTypeRef, CustomerPropertiesTypeRef, CustomerTypeRef, GroupInfoTypeRef, UserTypeRef, WhitelabelConfigTypeRef, createCloseSessionServicePost } from "./TypeRefs2-chunk.js";
import "./ParserCombinator-chunk.js";
import "./ErrorHandler-chunk.js";
import { MediaType } from "./EntityFunctions-chunk.js";
import "./TypeModels3-chunk.js";
import "./ModelInfo-chunk.js";
import "./ErrorUtils-chunk.js";
import { NotFoundError } from "./RestError-chunk.js";
import "./SetupMultipleError-chunk.js";
import "./OutOfSyncError-chunk.js";
import "./CancelledError-chunk.js";
import "./EventQueue-chunk.js";
import { CacheMode } from "./EntityRestClient-chunk.js";
import "./SuspensionError-chunk.js";
import "./LoginIncompleteError-chunk.js";
import "./CryptoError-chunk.js";
import "./error-chunk.js";
import "./RecipientsNotFoundError-chunk.js";
import "./DbError-chunk.js";
import "./QuotaExceededError-chunk.js";
import "./DeviceStorageUnavailableError-chunk.js";
import "./MailBodyTooLargeError-chunk.js";
import "./ImportError-chunk.js";
import "./WebauthnError-chunk.js";
import "./PermissionError-chunk.js";
import "./MessageDispatcher-chunk.js";
import "./WorkerProxy-chunk.js";
import { isUpdateForTypeRef } from "./EntityUpdateUtils-chunk.js";
import "./dist3-chunk.js";
import "./KeyLoaderFacade-chunk.js";
import { SessionType } from "./SessionType-chunk.js";
import { CloseSessionService, PlanService } from "./Services-chunk.js";
import { locator } from "./CommonLocator-chunk.js";
import { isCustomizationEnabledForCustomer } from "./CustomerUtils-chunk.js";

//#region src/common/api/common/utils/UserUtils.ts
function isGlobalAdmin(user) {
	if (isInternalUser(user)) return user.memberships.some((m) => m.groupType === GroupType.Admin);
else return false;
}
function isInternalUser(user) {
	return user.accountType !== AccountType.EXTERNAL;
}

//#endregion
//#region src/common/api/main/UserController.ts
assertMainOrNode();
var UserController = class {
	planConfig;
	constructor(user, _userGroupInfo, sessionId, _props, accessToken, _userSettingsGroupRoot, sessionType, loginUsername, entityClient, serviceExecutor) {
		this.user = user;
		this._userGroupInfo = _userGroupInfo;
		this.sessionId = sessionId;
		this._props = _props;
		this.accessToken = accessToken;
		this._userSettingsGroupRoot = _userSettingsGroupRoot;
		this.sessionType = sessionType;
		this.loginUsername = loginUsername;
		this.entityClient = entityClient;
		this.serviceExecutor = serviceExecutor;
		this.planConfig = null;
	}
	get userId() {
		return this.user._id;
	}
	get props() {
		return this._props;
	}
	get userGroupInfo() {
		return this._userGroupInfo;
	}
	get userSettingsGroupRoot() {
		return this._userSettingsGroupRoot;
	}
	/**
	* Checks if the current user is an admin of the customer.
	* @return True if the user is an admin
	*/
	isGlobalAdmin() {
		return isGlobalAdmin(this.user);
	}
	/**
	* Checks if the account type of the logged-in user is FREE.
	* @returns True if the account type is FREE otherwise false
	*/
	isFreeAccount() {
		return this.user.accountType === AccountType.FREE;
	}
	isPaidAccount() {
		return this.user.accountType === AccountType.PAID;
	}
	/**
	* Provides the information if an internal user is logged in.
	* @return True if an internal user is logged in, false if no user or an external user is logged in.
	*/
	isInternalUser() {
		return isInternalUser(this.user);
	}
	loadCustomer(cacheMode = CacheMode.ReadAndWrite) {
		return this.entityClient.load(CustomerTypeRef, assertNotNull(this.user.customer), { cacheMode });
	}
	async loadCustomerInfo() {
		const customer = await this.loadCustomer();
		return await this.entityClient.load(CustomerInfoTypeRef, customer.customerInfo);
	}
	async loadCustomerProperties() {
		const customer = await this.loadCustomer();
		return await this.entityClient.load(CustomerPropertiesTypeRef, assertNotNull(customer.properties));
	}
	async getPlanType() {
		const customerInfo = await this.loadCustomerInfo();
		return downcast(customerInfo.plan);
	}
	async getPlanConfig() {
		if (this.planConfig === null) {
			const planServiceGetOut = await this.serviceExecutor.get(PlanService, null);
			this.planConfig = planServiceGetOut.config;
		}
		return downcast(this.planConfig);
	}
	isLegacyPlan(type) {
		return LegacyPlans.includes(type);
	}
	async isNewPaidPlan() {
		const type = await this.getPlanType();
		return !this.isLegacyPlan(type) && type !== PlanType.Free;
	}
	async useLegacyBookingItem() {
		const customerInfo = await this.loadCustomerInfo();
		const type = downcast(customerInfo.plan);
		return !(this.isLegacyPlan(type) && customerInfo.customPlan == null) && type !== PlanType.Free;
	}
	/**
	* Checks if the current plan allows adding users and groups.
	*/
	async canHaveUsers() {
		const customer = await this.loadCustomer();
		const planType = await this.getPlanType();
		const planConfig = await this.getPlanConfig();
		return this.isLegacyPlan(planType) || planConfig.multiUser || isCustomizationEnabledForCustomer(customer, FeatureType.MultipleUsers);
	}
	async loadAccountingInfo() {
		const customerInfo = await this.loadCustomerInfo();
		return await this.entityClient.load(AccountingInfoTypeRef, customerInfo.accountingInfo);
	}
	getMailGroupMemberships() {
		return this.user.memberships.filter((membership) => membership.groupType === GroupType.Mail);
	}
	getContactGroupMemberships() {
		return this.user.memberships.filter((membership) => membership.groupType === GroupType.Contact);
	}
	getCalendarMemberships() {
		return this.user.memberships.filter((membership) => membership.groupType === GroupType.Calendar);
	}
	getUserMailGroupMembership() {
		return this.getMailGroupMemberships()[0];
	}
	getTemplateMemberships() {
		return this.user.memberships.filter((membership) => membership.groupType === GroupType.Template);
	}
	getContactListMemberships() {
		return this.user.memberships.filter((membership) => membership.groupType === GroupType.ContactList);
	}
	/**
	* Returns true if the given update is an update on the user instance of the logged in user and the update event is sent for the user group.
	* There are two updates for the user instance sent if the logged in user is an admin:, one for the user group and one for the admin group.
	* We only want to process it once, so we skip the admin group update
	*
	* Attention: Modules that act on user updates, e.g. for changed group memberships, need to use this function in their entityEventsReceived listener.
	* Only then it is guaranteed that the user in the user controller has been updated. The update event for the admin group might come first, so if a module
	* reacts on that one the user controller is not updated yet.
	*/
	isUpdateForLoggedInUserInstance(update, eventOwnerGroupId) {
		return update.operation === OperationType.UPDATE && isUpdateForTypeRef(UserTypeRef, update) && isSameId(this.user._id, update.instanceId) && isSameId(this.user.userGroup.group, eventOwnerGroupId);
	}
	async entityEventsReceived(updates, eventOwnerGroupId) {
		for (const update of updates) {
			const { instanceListId, instanceId, operation } = update;
			if (this.isUpdateForLoggedInUserInstance(update, eventOwnerGroupId)) this.user = await this.entityClient.load(UserTypeRef, this.user._id);
else if (operation === OperationType.UPDATE && isUpdateForTypeRef(GroupInfoTypeRef, update) && isSameId(this.userGroupInfo._id, [neverNull(instanceListId), instanceId])) this._userGroupInfo = await this.entityClient.load(GroupInfoTypeRef, this._userGroupInfo._id);
else if (isUpdateForTypeRef(TutanotaPropertiesTypeRef, update) && operation === OperationType.UPDATE) this._props = await this.entityClient.loadRoot(TutanotaPropertiesTypeRef, this.user.userGroup.group);
else if (isUpdateForTypeRef(UserSettingsGroupRootTypeRef, update)) this._userSettingsGroupRoot = await this.entityClient.load(UserSettingsGroupRootTypeRef, this.user.userGroup.group);
else if (isUpdateForTypeRef(CustomerInfoTypeRef, update)) {
				if (operation === OperationType.CREATE) await this.entityClient.load(CustomerInfoTypeRef, [update.instanceListId, update.instanceId]);
				this.planConfig = null;
			}
		}
	}
	/**
	* Delete the session (only if it's a non-persistent session
	* @param sync whether or not to delete in the main thread. For example, will be true when logging out due to closing the tab
	*/
	async deleteSession(sync) {
		if (sync) {
			if (this.sessionType !== SessionType.Persistent) await this.deleteSessionSync();
		} else if (this.sessionType !== SessionType.Persistent) await locator.loginFacade.deleteSession(this.accessToken).catch((e) => console.log("Error ignored on Logout:", e));
	}
	deleteSessionSync() {
		return new Promise((resolve, reject) => {
			const sendBeacon = navigator.sendBeacon;
			if (sendBeacon) try {
				const apiUrl = new URL(getApiBaseUrl(locator.domainConfigProvider().getCurrentDomainConfig()));
				apiUrl.pathname += `/rest/sys/${CloseSessionService.name.toLowerCase()}`;
				const requestObject = createCloseSessionServicePost({
					accessToken: this.accessToken,
					sessionId: this.sessionId
				});
				delete downcast(requestObject)["_type"];
				const queued = sendBeacon.call(navigator, apiUrl, new Blob([JSON.stringify(requestObject)], { type: MediaType.Json }));
				console.log("queued closing session: ", queued);
				resolve();
			} catch (e) {
				console.log("Failed to send beacon", e);
				reject(e);
			}
else {
				const apiUrl = new URL(getApiBaseUrl(locator.domainConfigProvider().getCurrentDomainConfig()));
				apiUrl.pathname += `/rest/sys/session/${listIdPart(this.sessionId)}/${elementIdPart(this.sessionId)}`;
				const xhr = new XMLHttpRequest();
				xhr.open("DELETE", apiUrl, false);
				xhr.setRequestHeader("accessToken", this.accessToken);
				xhr.setRequestHeader("v", typeModels.Session.version);
				xhr.onload = function() {
					if (xhr.status === 200) {
						console.log("deleted session");
						resolve();
					} else if (xhr.status === 401) {
						console.log("authentication failed => session is already deleted");
						resolve();
					} else {
						console.error("could not delete session " + xhr.status);
						reject(new Error("could not delete session " + xhr.status));
					}
				};
				xhr.onerror = function() {
					console.error("failed to request delete session");
					reject(new Error("failed to request delete session"));
				};
				xhr.send();
			}
		});
	}
	async isWhitelabelAccount() {
		if (!isDesktop()) return !!getWhitelabelCustomizations(window);
		const customerInfo = await this.loadCustomerInfo();
		return customerInfo.domainInfos.some((domainInfo) => domainInfo.whitelabelConfig);
	}
	async loadWhitelabelConfig() {
		const customerInfo = await this.loadCustomerInfo();
		const domainInfoAndConfig = first(mapAndFilterNull(customerInfo.domainInfos, (domainInfo) => domainInfo.whitelabelConfig && {
			domainInfo,
			whitelabelConfig: domainInfo.whitelabelConfig
		}));
		if (domainInfoAndConfig) {
			const whitelabelConfig = await locator.entityClient.load(WhitelabelConfigTypeRef, domainInfoAndConfig.whitelabelConfig);
			return {
				domainInfo: domainInfoAndConfig.domainInfo,
				whitelabelConfig
			};
		}
	}
};
async function initUserController({ user, userGroupInfo, sessionId, accessToken, sessionType, loginUsername }) {
	const entityClient = locator.entityClient;
	const [props, userSettingsGroupRoot] = await Promise.all([entityClient.loadRoot(TutanotaPropertiesTypeRef, user.userGroup.group), entityClient.load(UserSettingsGroupRootTypeRef, user.userGroup.group).catch(ofClass(NotFoundError, () => entityClient.setup(null, createUserSettingsGroupRoot({
		_ownerGroup: user.userGroup.group,
		startOfTheWeek: "0",
		timeFormat: "0",
		groupSettings: [],
		usageDataOptedIn: null
	})).then(() => entityClient.load(UserSettingsGroupRootTypeRef, user.userGroup.group))))]);
	return new UserController(user, userGroupInfo, sessionId, props, accessToken, userSettingsGroupRoot, sessionType, loginUsername, entityClient, locator.serviceExecutor);
}

//#endregion
export { initUserController };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlckNvbnRyb2xsZXItY2h1bmsuanMiLCJuYW1lcyI6WyJ1c2VyOiBVc2VyIiwidXNlcjogVXNlciIsIl91c2VyR3JvdXBJbmZvOiBHcm91cEluZm8iLCJzZXNzaW9uSWQ6IElkVHVwbGUiLCJfcHJvcHM6IFR1dGFub3RhUHJvcGVydGllcyIsImFjY2Vzc1Rva2VuOiBCYXNlNjRVcmwiLCJfdXNlclNldHRpbmdzR3JvdXBSb290OiBVc2VyU2V0dGluZ3NHcm91cFJvb3QiLCJzZXNzaW9uVHlwZTogU2Vzc2lvblR5cGUiLCJsb2dpblVzZXJuYW1lOiBzdHJpbmciLCJlbnRpdHlDbGllbnQ6IEVudGl0eUNsaWVudCIsInNlcnZpY2VFeGVjdXRvcjogSVNlcnZpY2VFeGVjdXRvciIsImNhY2hlTW9kZTogQ2FjaGVNb2RlIiwidHlwZTogUGxhblR5cGUiLCJ1cGRhdGU6IEVudGl0eVVwZGF0ZURhdGEiLCJldmVudE93bmVyR3JvdXBJZDogSWQiLCJ1cGRhdGVzOiBSZWFkb25seUFycmF5PEVudGl0eVVwZGF0ZURhdGE+Iiwic3luYzogYm9vbGVhbiIsInN5c1R5cGVNb2RlbHMiXSwic291cmNlcyI6WyIuLi9zcmMvY29tbW9uL2FwaS9jb21tb24vdXRpbHMvVXNlclV0aWxzLnRzIiwiLi4vc3JjL2NvbW1vbi9hcGkvbWFpbi9Vc2VyQ29udHJvbGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBY2NvdW50VHlwZSwgR3JvdXBUeXBlIH0gZnJvbSBcIi4uL1R1dGFub3RhQ29uc3RhbnRzLmpzXCJcbmltcG9ydCB7IFVzZXIgfSBmcm9tIFwiLi4vLi4vZW50aXRpZXMvc3lzL1R5cGVSZWZzLmpzXCJcblxuLyoqXG4gKiBDaGVja3MgaWYgdGhlIGN1cnJlbnQgdXNlciBpcyBhbiBhZG1pbiBvZiB0aGUgY3VzdG9tZXIuXG4gKiBAcmV0dXJuIFRydWUgaWYgdGhlIHVzZXIgaXMgYW4gYWRtaW5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzR2xvYmFsQWRtaW4odXNlcjogVXNlcik6IGJvb2xlYW4ge1xuXHRpZiAoaXNJbnRlcm5hbFVzZXIodXNlcikpIHtcblx0XHRyZXR1cm4gdXNlci5tZW1iZXJzaGlwcy5zb21lKChtKSA9PiBtLmdyb3VwVHlwZSA9PT0gR3JvdXBUeXBlLkFkbWluKVxuXHR9IGVsc2Uge1xuXHRcdHJldHVybiBmYWxzZVxuXHR9XG59XG5cbi8qKlxuICogUHJvdmlkZXMgdGhlIGluZm9ybWF0aW9uIGlmIGFuIGludGVybmFsIHVzZXIgaXMgbG9nZ2VkIGluLlxuICogQHJldHVybiBUcnVlIGlmIGFuIGludGVybmFsIHVzZXIgaXMgbG9nZ2VkIGluLCBmYWxzZSBpZiBubyB1c2VyIG9yIGFuIGV4dGVybmFsIHVzZXIgaXMgbG9nZ2VkIGluLlxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNJbnRlcm5hbFVzZXIodXNlcjogVXNlcik6IGJvb2xlYW4ge1xuXHRyZXR1cm4gdXNlci5hY2NvdW50VHlwZSAhPT0gQWNjb3VudFR5cGUuRVhURVJOQUxcbn1cbiIsImltcG9ydCB7IEFjY291bnRUeXBlLCBGZWF0dXJlVHlwZSwgR3JvdXBUeXBlLCBMZWdhY3lQbGFucywgT3BlcmF0aW9uVHlwZSwgUGxhblR5cGUgfSBmcm9tIFwiLi4vY29tbW9uL1R1dGFub3RhQ29uc3RhbnRzXCJcbmltcG9ydCB0eXBlIHsgQmFzZTY0VXJsIH0gZnJvbSBcIkB0dXRhby90dXRhbm90YS11dGlsc1wiXG5pbXBvcnQgeyBhc3NlcnROb3ROdWxsLCBkb3duY2FzdCwgZmlyc3QsIG1hcEFuZEZpbHRlck51bGwsIG5ldmVyTnVsbCwgb2ZDbGFzcyB9IGZyb20gXCJAdHV0YW8vdHV0YW5vdGEtdXRpbHNcIlxuaW1wb3J0IHsgTWVkaWFUeXBlIH0gZnJvbSBcIi4uL2NvbW1vbi9FbnRpdHlGdW5jdGlvbnNcIlxuaW1wb3J0IHsgYXNzZXJ0TWFpbk9yTm9kZSwgZ2V0QXBpQmFzZVVybCwgaXNEZXNrdG9wIH0gZnJvbSBcIi4uL2NvbW1vbi9FbnZcIlxuXG5pbXBvcnQgeyBOb3RGb3VuZEVycm9yIH0gZnJvbSBcIi4uL2NvbW1vbi9lcnJvci9SZXN0RXJyb3JcIlxuaW1wb3J0IHsgbG9jYXRvciB9IGZyb20gXCIuL0NvbW1vbkxvY2F0b3JcIlxuaW1wb3J0IHsgZWxlbWVudElkUGFydCwgaXNTYW1lSWQsIGxpc3RJZFBhcnQgfSBmcm9tIFwiLi4vY29tbW9uL3V0aWxzL0VudGl0eVV0aWxzXCJcbmltcG9ydCB7IGdldFdoaXRlbGFiZWxDdXN0b21pemF0aW9ucyB9IGZyb20gXCIuLi8uLi9taXNjL1doaXRlbGFiZWxDdXN0b21pemF0aW9uc1wiXG5pbXBvcnQgeyBFbnRpdHlDbGllbnQgfSBmcm9tIFwiLi4vY29tbW9uL0VudGl0eUNsaWVudFwiXG5pbXBvcnQgeyBDbG9zZVNlc3Npb25TZXJ2aWNlLCBQbGFuU2VydmljZSB9IGZyb20gXCIuLi9lbnRpdGllcy9zeXMvU2VydmljZXNcIlxuaW1wb3J0IHtcblx0QWNjb3VudGluZ0luZm8sXG5cdEFjY291bnRpbmdJbmZvVHlwZVJlZixcblx0Y3JlYXRlQ2xvc2VTZXNzaW9uU2VydmljZVBvc3QsXG5cdEN1c3RvbWVyLFxuXHRDdXN0b21lckluZm8sXG5cdEN1c3RvbWVySW5mb1R5cGVSZWYsXG5cdEN1c3RvbWVyUHJvcGVydGllcyxcblx0Q3VzdG9tZXJQcm9wZXJ0aWVzVHlwZVJlZixcblx0Q3VzdG9tZXJUeXBlUmVmLFxuXHREb21haW5JbmZvLFxuXHRHcm91cEluZm8sXG5cdEdyb3VwSW5mb1R5cGVSZWYsXG5cdEdyb3VwTWVtYmVyc2hpcCxcblx0UGxhbkNvbmZpZ3VyYXRpb24sXG5cdFVzZXIsXG5cdFVzZXJUeXBlUmVmLFxuXHRXaGl0ZWxhYmVsQ29uZmlnLFxuXHRXaGl0ZWxhYmVsQ29uZmlnVHlwZVJlZixcbn0gZnJvbSBcIi4uL2VudGl0aWVzL3N5cy9UeXBlUmVmc1wiXG5pbXBvcnQge1xuXHRjcmVhdGVVc2VyU2V0dGluZ3NHcm91cFJvb3QsXG5cdFR1dGFub3RhUHJvcGVydGllcyxcblx0VHV0YW5vdGFQcm9wZXJ0aWVzVHlwZVJlZixcblx0VXNlclNldHRpbmdzR3JvdXBSb290LFxuXHRVc2VyU2V0dGluZ3NHcm91cFJvb3RUeXBlUmVmLFxufSBmcm9tIFwiLi4vZW50aXRpZXMvdHV0YW5vdGEvVHlwZVJlZnNcIlxuaW1wb3J0IHsgdHlwZU1vZGVscyBhcyBzeXNUeXBlTW9kZWxzIH0gZnJvbSBcIi4uL2VudGl0aWVzL3N5cy9UeXBlTW9kZWxzXCJcbmltcG9ydCB7IFNlc3Npb25UeXBlIH0gZnJvbSBcIi4uL2NvbW1vbi9TZXNzaW9uVHlwZVwiXG5pbXBvcnQgeyBJU2VydmljZUV4ZWN1dG9yIH0gZnJvbSBcIi4uL2NvbW1vbi9TZXJ2aWNlUmVxdWVzdC5qc1wiXG5pbXBvcnQgeyBpc0N1c3RvbWl6YXRpb25FbmFibGVkRm9yQ3VzdG9tZXIgfSBmcm9tIFwiLi4vY29tbW9uL3V0aWxzL0N1c3RvbWVyVXRpbHMuanNcIlxuaW1wb3J0IHsgRW50aXR5VXBkYXRlRGF0YSwgaXNVcGRhdGVGb3JUeXBlUmVmIH0gZnJvbSBcIi4uL2NvbW1vbi91dGlscy9FbnRpdHlVcGRhdGVVdGlscy5qc1wiXG5pbXBvcnQgeyBpc0dsb2JhbEFkbWluLCBpc0ludGVybmFsVXNlciB9IGZyb20gXCIuLi9jb21tb24vdXRpbHMvVXNlclV0aWxzLmpzXCJcbmltcG9ydCB7IENhY2hlTW9kZSB9IGZyb20gXCIuLi93b3JrZXIvcmVzdC9FbnRpdHlSZXN0Q2xpZW50LmpzXCJcblxuYXNzZXJ0TWFpbk9yTm9kZSgpXG5cbmV4cG9ydCBjbGFzcyBVc2VyQ29udHJvbGxlciB7XG5cdHByaXZhdGUgcGxhbkNvbmZpZzogUGxhbkNvbmZpZ3VyYXRpb24gfCBudWxsXG5cblx0Y29uc3RydWN0b3IoXG5cdFx0Ly8gc2hvdWxkIGJlIHJlYWRvbmx5IGJ1dCBpcyBuZWVkZWQgZm9yIGEgd29ya2Fyb3VuZCBpbiBDYWxlbmRhck1vZGVsXG5cdFx0cHVibGljIHVzZXI6IFVzZXIsXG5cdFx0cHJpdmF0ZSBfdXNlckdyb3VwSW5mbzogR3JvdXBJbmZvLFxuXHRcdHB1YmxpYyByZWFkb25seSBzZXNzaW9uSWQ6IElkVHVwbGUsXG5cdFx0cHJpdmF0ZSBfcHJvcHM6IFR1dGFub3RhUHJvcGVydGllcyxcblx0XHRwdWJsaWMgcmVhZG9ubHkgYWNjZXNzVG9rZW46IEJhc2U2NFVybCxcblx0XHRwcml2YXRlIF91c2VyU2V0dGluZ3NHcm91cFJvb3Q6IFVzZXJTZXR0aW5nc0dyb3VwUm9vdCxcblx0XHRwdWJsaWMgcmVhZG9ubHkgc2Vzc2lvblR5cGU6IFNlc3Npb25UeXBlLFxuXHRcdC8qKiBXaGljaCBpZGVudGlmaWVyIChlLmcuIGVtYWlsIGFkZHJlc3MpIHdhcyB1c2VkIHRvIGNyZWF0ZSB0aGUgc2Vzc2lvbi4gKi9cblx0XHRwdWJsaWMgcmVhZG9ubHkgbG9naW5Vc2VybmFtZTogc3RyaW5nLFxuXHRcdHByaXZhdGUgcmVhZG9ubHkgZW50aXR5Q2xpZW50OiBFbnRpdHlDbGllbnQsXG5cdFx0cHJpdmF0ZSByZWFkb25seSBzZXJ2aWNlRXhlY3V0b3I6IElTZXJ2aWNlRXhlY3V0b3IsXG5cdCkge1xuXHRcdHRoaXMucGxhbkNvbmZpZyA9IG51bGxcblx0fVxuXG5cdGdldCB1c2VySWQoKTogSWQge1xuXHRcdHJldHVybiB0aGlzLnVzZXIuX2lkXG5cdH1cblxuXHRnZXQgcHJvcHMoKTogVHV0YW5vdGFQcm9wZXJ0aWVzIHtcblx0XHRyZXR1cm4gdGhpcy5fcHJvcHNcblx0fVxuXG5cdGdldCB1c2VyR3JvdXBJbmZvKCk6IEdyb3VwSW5mbyB7XG5cdFx0cmV0dXJuIHRoaXMuX3VzZXJHcm91cEluZm9cblx0fVxuXG5cdGdldCB1c2VyU2V0dGluZ3NHcm91cFJvb3QoKTogVXNlclNldHRpbmdzR3JvdXBSb290IHtcblx0XHRyZXR1cm4gdGhpcy5fdXNlclNldHRpbmdzR3JvdXBSb290XG5cdH1cblxuXHQvKipcblx0ICogQ2hlY2tzIGlmIHRoZSBjdXJyZW50IHVzZXIgaXMgYW4gYWRtaW4gb2YgdGhlIGN1c3RvbWVyLlxuXHQgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHVzZXIgaXMgYW4gYWRtaW5cblx0ICovXG5cdGlzR2xvYmFsQWRtaW4oKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIGlzR2xvYmFsQWRtaW4odGhpcy51c2VyKVxuXHR9XG5cblx0LyoqXG5cdCAqIENoZWNrcyBpZiB0aGUgYWNjb3VudCB0eXBlIG9mIHRoZSBsb2dnZWQtaW4gdXNlciBpcyBGUkVFLlxuXHQgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBhY2NvdW50IHR5cGUgaXMgRlJFRSBvdGhlcndpc2UgZmFsc2Vcblx0ICovXG5cdGlzRnJlZUFjY291bnQoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMudXNlci5hY2NvdW50VHlwZSA9PT0gQWNjb3VudFR5cGUuRlJFRVxuXHR9XG5cblx0aXNQYWlkQWNjb3VudCgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdGhpcy51c2VyLmFjY291bnRUeXBlID09PSBBY2NvdW50VHlwZS5QQUlEXG5cdH1cblxuXHQvKipcblx0ICogUHJvdmlkZXMgdGhlIGluZm9ybWF0aW9uIGlmIGFuIGludGVybmFsIHVzZXIgaXMgbG9nZ2VkIGluLlxuXHQgKiBAcmV0dXJuIFRydWUgaWYgYW4gaW50ZXJuYWwgdXNlciBpcyBsb2dnZWQgaW4sIGZhbHNlIGlmIG5vIHVzZXIgb3IgYW4gZXh0ZXJuYWwgdXNlciBpcyBsb2dnZWQgaW4uXG5cdCAqL1xuXHRpc0ludGVybmFsVXNlcigpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gaXNJbnRlcm5hbFVzZXIodGhpcy51c2VyKVxuXHR9XG5cblx0bG9hZEN1c3RvbWVyKGNhY2hlTW9kZTogQ2FjaGVNb2RlID0gQ2FjaGVNb2RlLlJlYWRBbmRXcml0ZSk6IFByb21pc2U8Q3VzdG9tZXI+IHtcblx0XHRyZXR1cm4gdGhpcy5lbnRpdHlDbGllbnQubG9hZChDdXN0b21lclR5cGVSZWYsIGFzc2VydE5vdE51bGwodGhpcy51c2VyLmN1c3RvbWVyKSwgeyBjYWNoZU1vZGUgfSlcblx0fVxuXG5cdGFzeW5jIGxvYWRDdXN0b21lckluZm8oKTogUHJvbWlzZTxDdXN0b21lckluZm8+IHtcblx0XHRjb25zdCBjdXN0b21lciA9IGF3YWl0IHRoaXMubG9hZEN1c3RvbWVyKClcblx0XHRyZXR1cm4gYXdhaXQgdGhpcy5lbnRpdHlDbGllbnQubG9hZChDdXN0b21lckluZm9UeXBlUmVmLCBjdXN0b21lci5jdXN0b21lckluZm8pXG5cdH1cblxuXHRhc3luYyBsb2FkQ3VzdG9tZXJQcm9wZXJ0aWVzKCk6IFByb21pc2U8Q3VzdG9tZXJQcm9wZXJ0aWVzPiB7XG5cdFx0Y29uc3QgY3VzdG9tZXIgPSBhd2FpdCB0aGlzLmxvYWRDdXN0b21lcigpXG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuZW50aXR5Q2xpZW50LmxvYWQoQ3VzdG9tZXJQcm9wZXJ0aWVzVHlwZVJlZiwgYXNzZXJ0Tm90TnVsbChjdXN0b21lci5wcm9wZXJ0aWVzKSlcblx0fVxuXG5cdGFzeW5jIGdldFBsYW5UeXBlKCk6IFByb21pc2U8UGxhblR5cGU+IHtcblx0XHRjb25zdCBjdXN0b21lckluZm8gPSBhd2FpdCB0aGlzLmxvYWRDdXN0b21lckluZm8oKVxuXHRcdHJldHVybiBkb3duY2FzdChjdXN0b21lckluZm8ucGxhbilcblx0fVxuXG5cdGFzeW5jIGdldFBsYW5Db25maWcoKTogUHJvbWlzZTxQbGFuQ29uZmlndXJhdGlvbj4ge1xuXHRcdGlmICh0aGlzLnBsYW5Db25maWcgPT09IG51bGwpIHtcblx0XHRcdGNvbnN0IHBsYW5TZXJ2aWNlR2V0T3V0ID0gYXdhaXQgdGhpcy5zZXJ2aWNlRXhlY3V0b3IuZ2V0KFBsYW5TZXJ2aWNlLCBudWxsKVxuXHRcdFx0dGhpcy5wbGFuQ29uZmlnID0gcGxhblNlcnZpY2VHZXRPdXQuY29uZmlnXG5cdFx0fVxuXHRcdHJldHVybiBkb3duY2FzdCh0aGlzLnBsYW5Db25maWcpXG5cdH1cblxuXHRpc0xlZ2FjeVBsYW4odHlwZTogUGxhblR5cGUpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gTGVnYWN5UGxhbnMuaW5jbHVkZXModHlwZSlcblx0fVxuXG5cdGFzeW5jIGlzTmV3UGFpZFBsYW4oKTogUHJvbWlzZTxib29sZWFuPiB7XG5cdFx0Y29uc3QgdHlwZSA9IGF3YWl0IHRoaXMuZ2V0UGxhblR5cGUoKVxuXHRcdHJldHVybiAhdGhpcy5pc0xlZ2FjeVBsYW4odHlwZSkgJiYgdHlwZSAhPT0gUGxhblR5cGUuRnJlZVxuXHR9XG5cblx0YXN5bmMgdXNlTGVnYWN5Qm9va2luZ0l0ZW0oKTogUHJvbWlzZTxib29sZWFuPiB7XG5cdFx0Y29uc3QgY3VzdG9tZXJJbmZvID0gYXdhaXQgdGhpcy5sb2FkQ3VzdG9tZXJJbmZvKClcblx0XHRjb25zdCB0eXBlOiBQbGFuVHlwZSA9IGRvd25jYXN0KGN1c3RvbWVySW5mby5wbGFuKVxuXHRcdHJldHVybiAhKHRoaXMuaXNMZWdhY3lQbGFuKHR5cGUpICYmIGN1c3RvbWVySW5mby5jdXN0b21QbGFuID09IG51bGwpICYmIHR5cGUgIT09IFBsYW5UeXBlLkZyZWVcblx0fVxuXG5cdC8qKlxuXHQgKiBDaGVja3MgaWYgdGhlIGN1cnJlbnQgcGxhbiBhbGxvd3MgYWRkaW5nIHVzZXJzIGFuZCBncm91cHMuXG5cdCAqL1xuXHRhc3luYyBjYW5IYXZlVXNlcnMoKTogUHJvbWlzZTxib29sZWFuPiB7XG5cdFx0Y29uc3QgY3VzdG9tZXIgPSBhd2FpdCB0aGlzLmxvYWRDdXN0b21lcigpXG5cdFx0Y29uc3QgcGxhblR5cGUgPSBhd2FpdCB0aGlzLmdldFBsYW5UeXBlKClcblx0XHRjb25zdCBwbGFuQ29uZmlnID0gYXdhaXQgdGhpcy5nZXRQbGFuQ29uZmlnKClcblxuXHRcdHJldHVybiB0aGlzLmlzTGVnYWN5UGxhbihwbGFuVHlwZSkgfHwgcGxhbkNvbmZpZy5tdWx0aVVzZXIgfHwgaXNDdXN0b21pemF0aW9uRW5hYmxlZEZvckN1c3RvbWVyKGN1c3RvbWVyLCBGZWF0dXJlVHlwZS5NdWx0aXBsZVVzZXJzKVxuXHR9XG5cblx0YXN5bmMgbG9hZEFjY291bnRpbmdJbmZvKCk6IFByb21pc2U8QWNjb3VudGluZ0luZm8+IHtcblx0XHRjb25zdCBjdXN0b21lckluZm8gPSBhd2FpdCB0aGlzLmxvYWRDdXN0b21lckluZm8oKVxuXHRcdHJldHVybiBhd2FpdCB0aGlzLmVudGl0eUNsaWVudC5sb2FkKEFjY291bnRpbmdJbmZvVHlwZVJlZiwgY3VzdG9tZXJJbmZvLmFjY291bnRpbmdJbmZvKVxuXHR9XG5cblx0Z2V0TWFpbEdyb3VwTWVtYmVyc2hpcHMoKTogR3JvdXBNZW1iZXJzaGlwW10ge1xuXHRcdHJldHVybiB0aGlzLnVzZXIubWVtYmVyc2hpcHMuZmlsdGVyKChtZW1iZXJzaGlwKSA9PiBtZW1iZXJzaGlwLmdyb3VwVHlwZSA9PT0gR3JvdXBUeXBlLk1haWwpXG5cdH1cblxuXHRnZXRDb250YWN0R3JvdXBNZW1iZXJzaGlwcygpOiBHcm91cE1lbWJlcnNoaXBbXSB7XG5cdFx0cmV0dXJuIHRoaXMudXNlci5tZW1iZXJzaGlwcy5maWx0ZXIoKG1lbWJlcnNoaXApID0+IG1lbWJlcnNoaXAuZ3JvdXBUeXBlID09PSBHcm91cFR5cGUuQ29udGFjdClcblx0fVxuXG5cdGdldENhbGVuZGFyTWVtYmVyc2hpcHMoKTogR3JvdXBNZW1iZXJzaGlwW10ge1xuXHRcdHJldHVybiB0aGlzLnVzZXIubWVtYmVyc2hpcHMuZmlsdGVyKChtZW1iZXJzaGlwKSA9PiBtZW1iZXJzaGlwLmdyb3VwVHlwZSA9PT0gR3JvdXBUeXBlLkNhbGVuZGFyKVxuXHR9XG5cblx0Z2V0VXNlck1haWxHcm91cE1lbWJlcnNoaXAoKTogR3JvdXBNZW1iZXJzaGlwIHtcblx0XHRyZXR1cm4gdGhpcy5nZXRNYWlsR3JvdXBNZW1iZXJzaGlwcygpWzBdXG5cdH1cblxuXHRnZXRUZW1wbGF0ZU1lbWJlcnNoaXBzKCk6IEdyb3VwTWVtYmVyc2hpcFtdIHtcblx0XHRyZXR1cm4gdGhpcy51c2VyLm1lbWJlcnNoaXBzLmZpbHRlcigobWVtYmVyc2hpcCkgPT4gbWVtYmVyc2hpcC5ncm91cFR5cGUgPT09IEdyb3VwVHlwZS5UZW1wbGF0ZSlcblx0fVxuXG5cdGdldENvbnRhY3RMaXN0TWVtYmVyc2hpcHMoKTogR3JvdXBNZW1iZXJzaGlwW10ge1xuXHRcdHJldHVybiB0aGlzLnVzZXIubWVtYmVyc2hpcHMuZmlsdGVyKChtZW1iZXJzaGlwKSA9PiBtZW1iZXJzaGlwLmdyb3VwVHlwZSA9PT0gR3JvdXBUeXBlLkNvbnRhY3RMaXN0KVxuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gdXBkYXRlIGlzIGFuIHVwZGF0ZSBvbiB0aGUgdXNlciBpbnN0YW5jZSBvZiB0aGUgbG9nZ2VkIGluIHVzZXIgYW5kIHRoZSB1cGRhdGUgZXZlbnQgaXMgc2VudCBmb3IgdGhlIHVzZXIgZ3JvdXAuXG5cdCAqIFRoZXJlIGFyZSB0d28gdXBkYXRlcyBmb3IgdGhlIHVzZXIgaW5zdGFuY2Ugc2VudCBpZiB0aGUgbG9nZ2VkIGluIHVzZXIgaXMgYW4gYWRtaW46LCBvbmUgZm9yIHRoZSB1c2VyIGdyb3VwIGFuZCBvbmUgZm9yIHRoZSBhZG1pbiBncm91cC5cblx0ICogV2Ugb25seSB3YW50IHRvIHByb2Nlc3MgaXQgb25jZSwgc28gd2Ugc2tpcCB0aGUgYWRtaW4gZ3JvdXAgdXBkYXRlXG5cdCAqXG5cdCAqIEF0dGVudGlvbjogTW9kdWxlcyB0aGF0IGFjdCBvbiB1c2VyIHVwZGF0ZXMsIGUuZy4gZm9yIGNoYW5nZWQgZ3JvdXAgbWVtYmVyc2hpcHMsIG5lZWQgdG8gdXNlIHRoaXMgZnVuY3Rpb24gaW4gdGhlaXIgZW50aXR5RXZlbnRzUmVjZWl2ZWQgbGlzdGVuZXIuXG5cdCAqIE9ubHkgdGhlbiBpdCBpcyBndWFyYW50ZWVkIHRoYXQgdGhlIHVzZXIgaW4gdGhlIHVzZXIgY29udHJvbGxlciBoYXMgYmVlbiB1cGRhdGVkLiBUaGUgdXBkYXRlIGV2ZW50IGZvciB0aGUgYWRtaW4gZ3JvdXAgbWlnaHQgY29tZSBmaXJzdCwgc28gaWYgYSBtb2R1bGVcblx0ICogcmVhY3RzIG9uIHRoYXQgb25lIHRoZSB1c2VyIGNvbnRyb2xsZXIgaXMgbm90IHVwZGF0ZWQgeWV0LlxuXHQgKi9cblx0aXNVcGRhdGVGb3JMb2dnZWRJblVzZXJJbnN0YW5jZSh1cGRhdGU6IEVudGl0eVVwZGF0ZURhdGEsIGV2ZW50T3duZXJHcm91cElkOiBJZCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiAoXG5cdFx0XHR1cGRhdGUub3BlcmF0aW9uID09PSBPcGVyYXRpb25UeXBlLlVQREFURSAmJlxuXHRcdFx0aXNVcGRhdGVGb3JUeXBlUmVmKFVzZXJUeXBlUmVmLCB1cGRhdGUpICYmXG5cdFx0XHRpc1NhbWVJZCh0aGlzLnVzZXIuX2lkLCB1cGRhdGUuaW5zdGFuY2VJZCkgJiZcblx0XHRcdGlzU2FtZUlkKHRoaXMudXNlci51c2VyR3JvdXAuZ3JvdXAsIGV2ZW50T3duZXJHcm91cElkKVxuXHRcdCkgLy8gb25seSBpbmNsdWRlIHVwZGF0ZXMgZm9yIHRoZSB1c2VyIGdyb3VwIGhlcmVcblx0fVxuXG5cdGFzeW5jIGVudGl0eUV2ZW50c1JlY2VpdmVkKHVwZGF0ZXM6IFJlYWRvbmx5QXJyYXk8RW50aXR5VXBkYXRlRGF0YT4sIGV2ZW50T3duZXJHcm91cElkOiBJZCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGZvciAoY29uc3QgdXBkYXRlIG9mIHVwZGF0ZXMpIHtcblx0XHRcdGNvbnN0IHsgaW5zdGFuY2VMaXN0SWQsIGluc3RhbmNlSWQsIG9wZXJhdGlvbiB9ID0gdXBkYXRlXG5cdFx0XHRpZiAodGhpcy5pc1VwZGF0ZUZvckxvZ2dlZEluVXNlckluc3RhbmNlKHVwZGF0ZSwgZXZlbnRPd25lckdyb3VwSWQpKSB7XG5cdFx0XHRcdHRoaXMudXNlciA9IGF3YWl0IHRoaXMuZW50aXR5Q2xpZW50LmxvYWQoVXNlclR5cGVSZWYsIHRoaXMudXNlci5faWQpXG5cdFx0XHR9IGVsc2UgaWYgKFxuXHRcdFx0XHRvcGVyYXRpb24gPT09IE9wZXJhdGlvblR5cGUuVVBEQVRFICYmXG5cdFx0XHRcdGlzVXBkYXRlRm9yVHlwZVJlZihHcm91cEluZm9UeXBlUmVmLCB1cGRhdGUpICYmXG5cdFx0XHRcdGlzU2FtZUlkKHRoaXMudXNlckdyb3VwSW5mby5faWQsIFtuZXZlck51bGwoaW5zdGFuY2VMaXN0SWQpLCBpbnN0YW5jZUlkXSlcblx0XHRcdCkge1xuXHRcdFx0XHR0aGlzLl91c2VyR3JvdXBJbmZvID0gYXdhaXQgdGhpcy5lbnRpdHlDbGllbnQubG9hZChHcm91cEluZm9UeXBlUmVmLCB0aGlzLl91c2VyR3JvdXBJbmZvLl9pZClcblx0XHRcdH0gZWxzZSBpZiAoaXNVcGRhdGVGb3JUeXBlUmVmKFR1dGFub3RhUHJvcGVydGllc1R5cGVSZWYsIHVwZGF0ZSkgJiYgb3BlcmF0aW9uID09PSBPcGVyYXRpb25UeXBlLlVQREFURSkge1xuXHRcdFx0XHR0aGlzLl9wcm9wcyA9IGF3YWl0IHRoaXMuZW50aXR5Q2xpZW50LmxvYWRSb290KFR1dGFub3RhUHJvcGVydGllc1R5cGVSZWYsIHRoaXMudXNlci51c2VyR3JvdXAuZ3JvdXApXG5cdFx0XHR9IGVsc2UgaWYgKGlzVXBkYXRlRm9yVHlwZVJlZihVc2VyU2V0dGluZ3NHcm91cFJvb3RUeXBlUmVmLCB1cGRhdGUpKSB7XG5cdFx0XHRcdHRoaXMuX3VzZXJTZXR0aW5nc0dyb3VwUm9vdCA9IGF3YWl0IHRoaXMuZW50aXR5Q2xpZW50LmxvYWQoVXNlclNldHRpbmdzR3JvdXBSb290VHlwZVJlZiwgdGhpcy51c2VyLnVzZXJHcm91cC5ncm91cClcblx0XHRcdH0gZWxzZSBpZiAoaXNVcGRhdGVGb3JUeXBlUmVmKEN1c3RvbWVySW5mb1R5cGVSZWYsIHVwZGF0ZSkpIHtcblx0XHRcdFx0aWYgKG9wZXJhdGlvbiA9PT0gT3BlcmF0aW9uVHlwZS5DUkVBVEUpIHtcblx0XHRcdFx0XHQvLyBBZnRlciBwcmVtaXVtIHVwZ3JhZGUgY3VzdG9tZXIgaW5mbyBpcyBkZWxldGVkIGFuZCBjcmVhdGVkIHdpdGggbmV3IGlkLiBXZSB3YW50IHRvIG1ha2Ugc3VyZSB0aGF0IGl0J3MgY2FjaGVkIGZvciBvZmZsaW5lIGxvZ2luLlxuXHRcdFx0XHRcdGF3YWl0IHRoaXMuZW50aXR5Q2xpZW50LmxvYWQoQ3VzdG9tZXJJbmZvVHlwZVJlZiwgW3VwZGF0ZS5pbnN0YW5jZUxpc3RJZCwgdXBkYXRlLmluc3RhbmNlSWRdKVxuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIGNhY2hlZCBwbGFuIGNvbmZpZyBtaWdodCBiZSBvdXRkYXRlZCBub3dcblx0XHRcdFx0dGhpcy5wbGFuQ29uZmlnID0gbnVsbFxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBEZWxldGUgdGhlIHNlc3Npb24gKG9ubHkgaWYgaXQncyBhIG5vbi1wZXJzaXN0ZW50IHNlc3Npb25cblx0ICogQHBhcmFtIHN5bmMgd2hldGhlciBvciBub3QgdG8gZGVsZXRlIGluIHRoZSBtYWluIHRocmVhZC4gRm9yIGV4YW1wbGUsIHdpbGwgYmUgdHJ1ZSB3aGVuIGxvZ2dpbmcgb3V0IGR1ZSB0byBjbG9zaW5nIHRoZSB0YWJcblx0ICovXG5cdGFzeW5jIGRlbGV0ZVNlc3Npb24oc3luYzogYm9vbGVhbik6IFByb21pc2U8dm9pZD4ge1xuXHRcdC8vIGluIGNhc2UgdGhlIHRhYiBpcyBjbG9zZWQgd2UgbmVlZCB0byBkZWxldGUgdGhlIHNlc3Npb24gaW4gdGhlIG1haW4gdGhyZWFkIChzeW5jaHJvbm91cyByZXN0IHJlcXVlc3QpXG5cdFx0aWYgKHN5bmMpIHtcblx0XHRcdGlmICh0aGlzLnNlc3Npb25UeXBlICE9PSBTZXNzaW9uVHlwZS5QZXJzaXN0ZW50KSB7XG5cdFx0XHRcdGF3YWl0IHRoaXMuZGVsZXRlU2Vzc2lvblN5bmMoKVxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAodGhpcy5zZXNzaW9uVHlwZSAhPT0gU2Vzc2lvblR5cGUuUGVyc2lzdGVudCkge1xuXHRcdFx0XHRhd2FpdCBsb2NhdG9yLmxvZ2luRmFjYWRlLmRlbGV0ZVNlc3Npb24odGhpcy5hY2Nlc3NUb2tlbikuY2F0Y2goKGUpID0+IGNvbnNvbGUubG9nKFwiRXJyb3IgaWdub3JlZCBvbiBMb2dvdXQ6XCIsIGUpKVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGRlbGV0ZVNlc3Npb25TeW5jKCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHRjb25zdCBzZW5kQmVhY29uID0gbmF2aWdhdG9yLnNlbmRCZWFjb24gLy8gU2F2ZSBzZW5kQmVhY29uIHRvIHZhcmlhYmxlIHRvIHNhdGlzZnkgdHlwZSBjaGVja2VyXG5cblx0XHRcdGlmIChzZW5kQmVhY29uKSB7XG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0Y29uc3QgYXBpVXJsID0gbmV3IFVSTChnZXRBcGlCYXNlVXJsKGxvY2F0b3IuZG9tYWluQ29uZmlnUHJvdmlkZXIoKS5nZXRDdXJyZW50RG9tYWluQ29uZmlnKCkpKVxuXHRcdFx0XHRcdGFwaVVybC5wYXRobmFtZSArPSBgL3Jlc3Qvc3lzLyR7Q2xvc2VTZXNzaW9uU2VydmljZS5uYW1lLnRvTG93ZXJDYXNlKCl9YFxuXHRcdFx0XHRcdGNvbnN0IHJlcXVlc3RPYmplY3QgPSBjcmVhdGVDbG9zZVNlc3Npb25TZXJ2aWNlUG9zdCh7XG5cdFx0XHRcdFx0XHRhY2Nlc3NUb2tlbjogdGhpcy5hY2Nlc3NUb2tlbixcblx0XHRcdFx0XHRcdHNlc3Npb25JZDogdGhpcy5zZXNzaW9uSWQsXG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHRkZWxldGUgZG93bmNhc3QocmVxdWVzdE9iamVjdClbXCJfdHlwZVwiXSAvLyBSZW1vdmUgZXh0cmEgZmllbGQgd2hpY2ggaXMgbm90IHBhcnQgb2YgdGhlIGRhdGEgbW9kZWxcblxuXHRcdFx0XHRcdC8vIFNlbmQgYXMgQmxvYiB0byBiZSBhYmxlIHRvIHNldCBjb250ZW50IHR5cGUgb3RoZXJ3aXNlIHNlbmRzICd0ZXh0L3BsYWluJ1xuXHRcdFx0XHRcdGNvbnN0IHF1ZXVlZCA9IHNlbmRCZWFjb24uY2FsbChcblx0XHRcdFx0XHRcdG5hdmlnYXRvcixcblx0XHRcdFx0XHRcdGFwaVVybCxcblx0XHRcdFx0XHRcdG5ldyBCbG9iKFtKU09OLnN0cmluZ2lmeShyZXF1ZXN0T2JqZWN0KV0sIHtcblx0XHRcdFx0XHRcdFx0dHlwZTogTWVkaWFUeXBlLkpzb24sXG5cdFx0XHRcdFx0XHR9KSxcblx0XHRcdFx0XHQpXG5cdFx0XHRcdFx0Y29uc29sZS5sb2coXCJxdWV1ZWQgY2xvc2luZyBzZXNzaW9uOiBcIiwgcXVldWVkKVxuXHRcdFx0XHRcdHJlc29sdmUoKVxuXHRcdFx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coXCJGYWlsZWQgdG8gc2VuZCBiZWFjb25cIiwgZSlcblx0XHRcdFx0XHRyZWplY3QoZSlcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gRmFsbCBiYWNrIHRvIHN5bmMgWEhSIGlmIEJlYWNvbiBBUEkgaXMgbm90IGF2YWlsYWJsZSAod2hpY2ggaXQgc2hvdWxkIGJlIGV2ZXJ5d2hlcmUgYnkgbm93IGJ1dCBtYXliZSBpdCBpcyBzdXBwcmVzc2VkIHNvbWVob3cpXG5cdFx0XHRcdGNvbnN0IGFwaVVybCA9IG5ldyBVUkwoZ2V0QXBpQmFzZVVybChsb2NhdG9yLmRvbWFpbkNvbmZpZ1Byb3ZpZGVyKCkuZ2V0Q3VycmVudERvbWFpbkNvbmZpZygpKSlcblx0XHRcdFx0YXBpVXJsLnBhdGhuYW1lICs9IGAvcmVzdC9zeXMvc2Vzc2lvbi8ke2xpc3RJZFBhcnQodGhpcy5zZXNzaW9uSWQpfS8ke2VsZW1lbnRJZFBhcnQodGhpcy5zZXNzaW9uSWQpfWBcblx0XHRcdFx0Y29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KClcblx0XHRcdFx0eGhyLm9wZW4oXCJERUxFVEVcIiwgYXBpVXJsLCBmYWxzZSkgLy8gc3luYyByZXF1ZXN0cyBpbmNyZWFzZSByZWxpYWJpbGl0eSB3aGVuIGludm9rZWQgaW4gb251bmxvYWRcblxuXHRcdFx0XHR4aHIuc2V0UmVxdWVzdEhlYWRlcihcImFjY2Vzc1Rva2VuXCIsIHRoaXMuYWNjZXNzVG9rZW4pXG5cdFx0XHRcdHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwidlwiLCBzeXNUeXBlTW9kZWxzLlNlc3Npb24udmVyc2lvbilcblxuXHRcdFx0XHR4aHIub25sb2FkID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdC8vIFhNTEh0dHBSZXF1ZXN0UHJvZ3Jlc3NFdmVudCwgYnV0IG5vdCBuZWVkZWRcblx0XHRcdFx0XHRpZiAoeGhyLnN0YXR1cyA9PT0gMjAwKSB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhcImRlbGV0ZWQgc2Vzc2lvblwiKVxuXHRcdFx0XHRcdFx0cmVzb2x2ZSgpXG5cdFx0XHRcdFx0fSBlbHNlIGlmICh4aHIuc3RhdHVzID09PSA0MDEpIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiYXV0aGVudGljYXRpb24gZmFpbGVkID0+IHNlc3Npb24gaXMgYWxyZWFkeSBkZWxldGVkXCIpXG5cdFx0XHRcdFx0XHRyZXNvbHZlKClcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y29uc29sZS5lcnJvcihcImNvdWxkIG5vdCBkZWxldGUgc2Vzc2lvbiBcIiArIHhoci5zdGF0dXMpXG5cdFx0XHRcdFx0XHRyZWplY3QobmV3IEVycm9yKFwiY291bGQgbm90IGRlbGV0ZSBzZXNzaW9uIFwiICsgeGhyLnN0YXR1cykpXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0eGhyLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0Y29uc29sZS5lcnJvcihcImZhaWxlZCB0byByZXF1ZXN0IGRlbGV0ZSBzZXNzaW9uXCIpXG5cdFx0XHRcdFx0cmVqZWN0KG5ldyBFcnJvcihcImZhaWxlZCB0byByZXF1ZXN0IGRlbGV0ZSBzZXNzaW9uXCIpKVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0eGhyLnNlbmQoKVxuXHRcdFx0fVxuXHRcdH0pXG5cdH1cblxuXHRhc3luYyBpc1doaXRlbGFiZWxBY2NvdW50KCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuXHRcdC8vIGlzVHV0YW5vdGFEb21haW4gYWx3YXlzIHJldHVybnMgdHJ1ZSBvbiBkZXNrdG9wXG5cdFx0aWYgKCFpc0Rlc2t0b3AoKSkge1xuXHRcdFx0cmV0dXJuICEhZ2V0V2hpdGVsYWJlbEN1c3RvbWl6YXRpb25zKHdpbmRvdylcblx0XHR9XG5cblx0XHRjb25zdCBjdXN0b21lckluZm8gPSBhd2FpdCB0aGlzLmxvYWRDdXN0b21lckluZm8oKVxuXHRcdHJldHVybiBjdXN0b21lckluZm8uZG9tYWluSW5mb3Muc29tZSgoZG9tYWluSW5mbykgPT4gZG9tYWluSW5mby53aGl0ZWxhYmVsQ29uZmlnKVxuXHR9XG5cblx0YXN5bmMgbG9hZFdoaXRlbGFiZWxDb25maWcoKTogUHJvbWlzZTxcblx0XHR8IHtcblx0XHRcdFx0d2hpdGVsYWJlbENvbmZpZzogV2hpdGVsYWJlbENvbmZpZ1xuXHRcdFx0XHRkb21haW5JbmZvOiBEb21haW5JbmZvXG5cdFx0ICB9XG5cdFx0fCBudWxsXG5cdFx0fCB1bmRlZmluZWRcblx0PiB7XG5cdFx0Ly8gVGhlIG1vZGVsIGFsbG93cyBmb3IgbXVsdGlwbGUgZG9tYWluSW5mb3MgdG8gaGF2ZSB3aGl0ZWxhYmVsIGNvbmZpZ3Ncblx0XHQvLyBidXQgaW4gcmVhbGl0eSBvbiB0aGUgc2VydmVyIG9ubHkgYSBzaW5nbGUgY3VzdG9tIGNvbmZpZ3VyYXRpb24gaXMgYWxsb3dlZFxuXHRcdC8vIHRoZXJlZm9yZSB0aGUgcmVzdWx0IG9mIHRoZSBmaWx0ZXJpbmcgYWxsIGRvbWFpbkluZm9zIHdpdGggbm8gd2hpdGVsYWJlbENvbmZpZ1xuXHRcdC8vIGNhbiBvbmx5IGJlIGFuIGFycmF5IG9mIGxlbmd0aCAwIG9yIDFcblx0XHRjb25zdCBjdXN0b21lckluZm8gPSBhd2FpdCB0aGlzLmxvYWRDdXN0b21lckluZm8oKVxuXHRcdGNvbnN0IGRvbWFpbkluZm9BbmRDb25maWcgPSBmaXJzdChcblx0XHRcdG1hcEFuZEZpbHRlck51bGwoXG5cdFx0XHRcdGN1c3RvbWVySW5mby5kb21haW5JbmZvcyxcblx0XHRcdFx0KGRvbWFpbkluZm8pID0+XG5cdFx0XHRcdFx0ZG9tYWluSW5mby53aGl0ZWxhYmVsQ29uZmlnICYmIHtcblx0XHRcdFx0XHRcdGRvbWFpbkluZm8sXG5cdFx0XHRcdFx0XHR3aGl0ZWxhYmVsQ29uZmlnOiBkb21haW5JbmZvLndoaXRlbGFiZWxDb25maWcsXG5cdFx0XHRcdFx0fSxcblx0XHRcdCksXG5cdFx0KVxuXG5cdFx0aWYgKGRvbWFpbkluZm9BbmRDb25maWcpIHtcblx0XHRcdGNvbnN0IHdoaXRlbGFiZWxDb25maWcgPSBhd2FpdCBsb2NhdG9yLmVudGl0eUNsaWVudC5sb2FkKFdoaXRlbGFiZWxDb25maWdUeXBlUmVmLCBkb21haW5JbmZvQW5kQ29uZmlnLndoaXRlbGFiZWxDb25maWcpXG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRkb21haW5JbmZvOiBkb21haW5JbmZvQW5kQ29uZmlnLmRvbWFpbkluZm8sXG5cdFx0XHRcdHdoaXRlbGFiZWxDb25maWcsXG5cdFx0XHR9XG5cdFx0fVxuXHR9XG59XG5cbmV4cG9ydCB0eXBlIFVzZXJDb250cm9sbGVySW5pdERhdGEgPSB7XG5cdHVzZXI6IFVzZXJcblx0dXNlckdyb3VwSW5mbzogR3JvdXBJbmZvXG5cdHNlc3Npb25JZDogSWRUdXBsZVxuXHRhY2Nlc3NUb2tlbjogQmFzZTY0VXJsXG5cdHNlc3Npb25UeXBlOiBTZXNzaW9uVHlwZVxuXHRsb2dpblVzZXJuYW1lOiBzdHJpbmdcbn1cbi8vIG5vaW5zcGVjdGlvbiBKU1VudXNlZEdsb2JhbFN5bWJvbHNcbi8vIGR5bmFtaWNhbGx5IGltcG9ydGVkXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdFVzZXJDb250cm9sbGVyKHtcblx0dXNlcixcblx0dXNlckdyb3VwSW5mbyxcblx0c2Vzc2lvbklkLFxuXHRhY2Nlc3NUb2tlbixcblx0c2Vzc2lvblR5cGUsXG5cdGxvZ2luVXNlcm5hbWUsXG59OiBVc2VyQ29udHJvbGxlckluaXREYXRhKTogUHJvbWlzZTxVc2VyQ29udHJvbGxlcj4ge1xuXHRjb25zdCBlbnRpdHlDbGllbnQgPSBsb2NhdG9yLmVudGl0eUNsaWVudFxuXHRjb25zdCBbcHJvcHMsIHVzZXJTZXR0aW5nc0dyb3VwUm9vdF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG5cdFx0ZW50aXR5Q2xpZW50LmxvYWRSb290KFR1dGFub3RhUHJvcGVydGllc1R5cGVSZWYsIHVzZXIudXNlckdyb3VwLmdyb3VwKSxcblx0XHRlbnRpdHlDbGllbnQubG9hZChVc2VyU2V0dGluZ3NHcm91cFJvb3RUeXBlUmVmLCB1c2VyLnVzZXJHcm91cC5ncm91cCkuY2F0Y2goXG5cdFx0XHRvZkNsYXNzKE5vdEZvdW5kRXJyb3IsICgpID0+XG5cdFx0XHRcdGVudGl0eUNsaWVudFxuXHRcdFx0XHRcdC5zZXR1cChcblx0XHRcdFx0XHRcdG51bGwsXG5cdFx0XHRcdFx0XHRjcmVhdGVVc2VyU2V0dGluZ3NHcm91cFJvb3Qoe1xuXHRcdFx0XHRcdFx0XHRfb3duZXJHcm91cDogdXNlci51c2VyR3JvdXAuZ3JvdXAsXG5cdFx0XHRcdFx0XHRcdHN0YXJ0T2ZUaGVXZWVrOiBcIjBcIixcblx0XHRcdFx0XHRcdFx0dGltZUZvcm1hdDogXCIwXCIsXG5cdFx0XHRcdFx0XHRcdGdyb3VwU2V0dGluZ3M6IFtdLFxuXHRcdFx0XHRcdFx0XHR1c2FnZURhdGFPcHRlZEluOiBudWxsLFxuXHRcdFx0XHRcdFx0fSksXG5cdFx0XHRcdFx0KVxuXHRcdFx0XHRcdC50aGVuKCgpID0+IGVudGl0eUNsaWVudC5sb2FkKFVzZXJTZXR0aW5nc0dyb3VwUm9vdFR5cGVSZWYsIHVzZXIudXNlckdyb3VwLmdyb3VwKSksXG5cdFx0XHQpLFxuXHRcdCksXG5cdF0pXG5cdHJldHVybiBuZXcgVXNlckNvbnRyb2xsZXIoXG5cdFx0dXNlcixcblx0XHR1c2VyR3JvdXBJbmZvLFxuXHRcdHNlc3Npb25JZCxcblx0XHRwcm9wcyxcblx0XHRhY2Nlc3NUb2tlbixcblx0XHR1c2VyU2V0dGluZ3NHcm91cFJvb3QsXG5cdFx0c2Vzc2lvblR5cGUsXG5cdFx0bG9naW5Vc2VybmFtZSxcblx0XHRlbnRpdHlDbGllbnQsXG5cdFx0bG9jYXRvci5zZXJ2aWNlRXhlY3V0b3IsXG5cdClcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFPTyxTQUFTLGNBQWNBLE1BQXFCO0FBQ2xELEtBQUksZUFBZSxLQUFLLENBQ3ZCLFFBQU8sS0FBSyxZQUFZLEtBQUssQ0FBQyxNQUFNLEVBQUUsY0FBYyxVQUFVLE1BQU07SUFFcEUsUUFBTztBQUVSO0FBTU0sU0FBUyxlQUFlQSxNQUFxQjtBQUNuRCxRQUFPLEtBQUssZ0JBQWdCLFlBQVk7QUFDeEM7Ozs7QUMwQkQsa0JBQWtCO0lBRUwsaUJBQU4sTUFBcUI7Q0FDM0IsQUFBUTtDQUVSLFlBRVFDLE1BQ0NDLGdCQUNRQyxXQUNSQyxRQUNRQyxhQUNSQyx3QkFDUUMsYUFFQUMsZUFDQ0MsY0FDQUMsaUJBQ2hCO0VBNFZGLEtBdldRO0VBdVdQLEtBdFdRO0VBc1dQLEtBcldlO0VBcVdkLEtBcFdNO0VBb1dMLEtBbldhO0VBbVdaLEtBbFdJO0VBa1dILEtBaldXO0VBaVdWLEtBL1ZVO0VBK1ZULEtBOVZVO0VBOFZULEtBN1ZTO0FBRWpCLE9BQUssYUFBYTtDQUNsQjtDQUVELElBQUksU0FBYTtBQUNoQixTQUFPLEtBQUssS0FBSztDQUNqQjtDQUVELElBQUksUUFBNEI7QUFDL0IsU0FBTyxLQUFLO0NBQ1o7Q0FFRCxJQUFJLGdCQUEyQjtBQUM5QixTQUFPLEtBQUs7Q0FDWjtDQUVELElBQUksd0JBQStDO0FBQ2xELFNBQU8sS0FBSztDQUNaOzs7OztDQU1ELGdCQUF5QjtBQUN4QixTQUFPLGNBQWMsS0FBSyxLQUFLO0NBQy9COzs7OztDQU1ELGdCQUF5QjtBQUN4QixTQUFPLEtBQUssS0FBSyxnQkFBZ0IsWUFBWTtDQUM3QztDQUVELGdCQUF5QjtBQUN4QixTQUFPLEtBQUssS0FBSyxnQkFBZ0IsWUFBWTtDQUM3Qzs7Ozs7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