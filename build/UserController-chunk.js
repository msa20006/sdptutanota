import "./dist-chunk.js";
import "./ProgrammingError-chunk.js";
import { assertMainOrNode, getApiBaseUrl, isDesktop } from "./Env-chunk.js";
import "./ClientDetector-chunk.js";
import { assertNotNull, downcast, first, mapAndFilterNull, neverNull, ofClass } from "./dist2-chunk.js";
import { getWhitelabelCustomizations } from "./WhitelabelCustomizations-chunk.js";
import { AccountType, FeatureType, GroupType, LegacyPlans, OperationType, PlanType } from "./TutanotaConstants-chunk.js";
import { elementIdPart, isSameId, listIdPart } from "./EntityUtils-chunk.js";
import "./TypeModels-chunk.js";
import { TutanotaPropertiesTypeRef, UserSettingsGroupRootTypeRef, createUserSettingsGroupRoot } from "./TypeRefs-chunk.js";
import { typeModels$3 as typeModels } from "./TypeModels2-chunk.js";
import { AccountingInfoTypeRef, CustomerInfoTypeRef, CustomerPropertiesTypeRef, CustomerTypeRef, GroupInfoTypeRef, UserTypeRef, WhitelabelConfigTypeRef, createCloseSessionServicePost } from "./TypeRefs2-chunk.js";
import "./ParserCombinator-chunk.js";
import "./ErrorHandler-chunk.js";
import { MediaType } from "./EntityFunctions-chunk.js";
import "./TypeModels3-chunk.js";
import "./ModelInfo-chunk.js";
import "./ErrorUtils-chunk.js";
import { NotFoundError } from "./RestError-chunk.js";
import "./SetupMultipleError-chunk.js";
import "./OutOfSyncError-chunk.js";
import "./CancelledError-chunk.js";
import "./EventQueue-chunk.js";
import { CacheMode } from "./EntityRestClient-chunk.js";
import "./SuspensionError-chunk.js";
import "./LoginIncompleteError-chunk.js";
import "./CryptoError-chunk.js";
import "./RecipientsNotFoundError-chunk.js";
import "./DbError-chunk.js";
import "./QuotaExceededError-chunk.js";
import "./DeviceStorageUnavailableError-chunk.js";
import "./MailBodyTooLargeError-chunk.js";
import "./ImportError-chunk.js";
import "./WebauthnError-chunk.js";
import "./PermissionError-chunk.js";
import "./MessageDispatcher-chunk.js";
import "./WorkerProxy-chunk.js";
import { isUpdateForTypeRef } from "./EntityUpdateUtils-chunk.js";
import { SessionType } from "./SessionType-chunk.js";
import { CloseSessionService, PlanService } from "./Services-chunk.js";
import { locator } from "./CommonLocator-chunk.js";
import { isCustomizationEnabledForCustomer } from "./CustomerUtils-chunk.js";
import { isGlobalAdmin, isInternalUser } from "./UserUtils-chunk.js";

//#region src/common/api/main/UserController.ts
assertMainOrNode();
var UserController = class {
	planConfig;
	constructor(user, _userGroupInfo, sessionId, _props, accessToken, _userSettingsGroupRoot, sessionType, loginUsername, entityClient, serviceExecutor) {
		this.user = user;
		this._userGroupInfo = _userGroupInfo;
		this.sessionId = sessionId;
		this._props = _props;
		this.accessToken = accessToken;
		this._userSettingsGroupRoot = _userSettingsGroupRoot;
		this.sessionType = sessionType;
		this.loginUsername = loginUsername;
		this.entityClient = entityClient;
		this.serviceExecutor = serviceExecutor;
		this.planConfig = null;
	}
	get userId() {
		return this.user._id;
	}
	get props() {
		return this._props;
	}
	get userGroupInfo() {
		return this._userGroupInfo;
	}
	get userSettingsGroupRoot() {
		return this._userSettingsGroupRoot;
	}
	/**
	* Checks if the current user is an admin of the customer.
	* @return True if the user is an admin
	*/
	isGlobalAdmin() {
		return isGlobalAdmin(this.user);
	}
	/**
	* Checks if the account type of the logged-in user is FREE.
	* @returns True if the account type is FREE otherwise false
	*/
	isFreeAccount() {
		return this.user.accountType === AccountType.FREE;
	}
	isPremiumAccount() {
		return this.user.accountType === AccountType.PAID;
	}
	/**
	* Provides the information if an internal user is logged in.
	* @return True if an internal user is logged in, false if no user or an external user is logged in.
	*/
	isInternalUser() {
		return isInternalUser(this.user);
	}
	loadCustomer(cacheMode = CacheMode.ReadAndWrite) {
		return this.entityClient.load(CustomerTypeRef, assertNotNull(this.user.customer), { cacheMode });
	}
	async loadCustomerInfo() {
		const customer = await this.loadCustomer();
		return await this.entityClient.load(CustomerInfoTypeRef, customer.customerInfo);
	}
	async loadCustomerProperties() {
		const customer = await this.loadCustomer();
		return await this.entityClient.load(CustomerPropertiesTypeRef, assertNotNull(customer.properties));
	}
	async getPlanType() {
		const customerInfo = await this.loadCustomerInfo();
		return downcast(customerInfo.plan);
	}
	async getPlanConfig() {
		if (this.planConfig === null) {
			const planServiceGetOut = await this.serviceExecutor.get(PlanService, null);
			this.planConfig = planServiceGetOut.config;
		}
		return downcast(this.planConfig);
	}
	isLegacyPlan(type) {
		return LegacyPlans.includes(type);
	}
	async isNewPaidPlan() {
		const type = await this.getPlanType();
		return !this.isLegacyPlan(type) && type !== PlanType.Free;
	}
	async useLegacyBookingItem() {
		const customerInfo = await this.loadCustomerInfo();
		const type = downcast(customerInfo.plan);
		return !(this.isLegacyPlan(type) && customerInfo.customPlan == null) && type !== PlanType.Free;
	}
	/**
	* Checks if the current plan allows adding users and groups.
	*/
	async canHaveUsers() {
		const customer = await this.loadCustomer();
		const planType = await this.getPlanType();
		const planConfig = await this.getPlanConfig();
		return this.isLegacyPlan(planType) || planConfig.multiUser || isCustomizationEnabledForCustomer(customer, FeatureType.MultipleUsers);
	}
	async loadAccountingInfo() {
		const customerInfo = await this.loadCustomerInfo();
		return await this.entityClient.load(AccountingInfoTypeRef, customerInfo.accountingInfo);
	}
	getMailGroupMemberships() {
		return this.user.memberships.filter((membership) => membership.groupType === GroupType.Mail);
	}
	getContactGroupMemberships() {
		return this.user.memberships.filter((membership) => membership.groupType === GroupType.Contact);
	}
	getCalendarMemberships() {
		return this.user.memberships.filter((membership) => membership.groupType === GroupType.Calendar);
	}
	getUserMailGroupMembership() {
		return this.getMailGroupMemberships()[0];
	}
	getTemplateMemberships() {
		return this.user.memberships.filter((membership) => membership.groupType === GroupType.Template);
	}
	getContactListMemberships() {
		return this.user.memberships.filter((membership) => membership.groupType === GroupType.ContactList);
	}
	/**
	* Returns true if the given update is an update on the user instance of the logged in user and the update event is sent for the user group.
	* There are two updates for the user instance sent if the logged in user is an admin:, one for the user group and one for the admin group.
	* We only want to process it once, so we skip the admin group update
	*
	* Attention: Modules that act on user updates, e.g. for changed group memberships, need to use this function in their entityEventsReceived listener.
	* Only then it is guaranteed that the user in the user controller has been updated. The update event for the admin group might come first, so if a module
	* reacts on that one the user controller is not updated yet.
	*/
	isUpdateForLoggedInUserInstance(update, eventOwnerGroupId) {
		return update.operation === OperationType.UPDATE && isUpdateForTypeRef(UserTypeRef, update) && isSameId(this.user._id, update.instanceId) && isSameId(this.user.userGroup.group, eventOwnerGroupId);
	}
	async entityEventsReceived(updates, eventOwnerGroupId) {
		for (const update of updates) {
			const { instanceListId, instanceId, operation } = update;
			if (this.isUpdateForLoggedInUserInstance(update, eventOwnerGroupId)) this.user = await this.entityClient.load(UserTypeRef, this.user._id);
else if (operation === OperationType.UPDATE && isUpdateForTypeRef(GroupInfoTypeRef, update) && isSameId(this.userGroupInfo._id, [neverNull(instanceListId), instanceId])) this._userGroupInfo = await this.entityClient.load(GroupInfoTypeRef, this._userGroupInfo._id);
else if (isUpdateForTypeRef(TutanotaPropertiesTypeRef, update) && operation === OperationType.UPDATE) this._props = await this.entityClient.loadRoot(TutanotaPropertiesTypeRef, this.user.userGroup.group);
else if (isUpdateForTypeRef(UserSettingsGroupRootTypeRef, update)) this._userSettingsGroupRoot = await this.entityClient.load(UserSettingsGroupRootTypeRef, this.user.userGroup.group);
else if (isUpdateForTypeRef(CustomerInfoTypeRef, update)) {
				if (operation === OperationType.CREATE) await this.entityClient.load(CustomerInfoTypeRef, [update.instanceListId, update.instanceId]);
				this.planConfig = null;
			}
		}
	}
	/**
	* Delete the session (only if it's a non-persistent session
	* @param sync whether or not to delete in the main thread. For example, will be true when logging out due to closing the tab
	*/
	async deleteSession(sync) {
		if (sync) {
			if (this.sessionType !== SessionType.Persistent) await this.deleteSessionSync();
		} else if (this.sessionType !== SessionType.Persistent) await locator.loginFacade.deleteSession(this.accessToken).catch((e) => console.log("Error ignored on Logout:", e));
	}
	deleteSessionSync() {
		return new Promise((resolve, reject) => {
			const sendBeacon = navigator.sendBeacon;
			if (sendBeacon) try {
				const apiUrl = new URL(getApiBaseUrl(locator.domainConfigProvider().getCurrentDomainConfig()));
				apiUrl.pathname += `/rest/sys/${CloseSessionService.name.toLowerCase()}`;
				const requestObject = createCloseSessionServicePost({
					accessToken: this.accessToken,
					sessionId: this.sessionId
				});
				delete downcast(requestObject)["_type"];
				const queued = sendBeacon.call(navigator, apiUrl, new Blob([JSON.stringify(requestObject)], { type: MediaType.Json }));
				console.log("queued closing session: ", queued);
				resolve();
			} catch (e) {
				console.log("Failed to send beacon", e);
				reject(e);
			}
else {
				const apiUrl = new URL(getApiBaseUrl(locator.domainConfigProvider().getCurrentDomainConfig()));
				apiUrl.pathname += `/rest/sys/session/${listIdPart(this.sessionId)}/${elementIdPart(this.sessionId)}`;
				const xhr = new XMLHttpRequest();
				xhr.open("DELETE", apiUrl, false);
				xhr.setRequestHeader("accessToken", this.accessToken);
				xhr.setRequestHeader("v", typeModels.Session.version);
				xhr.onload = function() {
					if (xhr.status === 200) {
						console.log("deleted session");
						resolve();
					} else if (xhr.status === 401) {
						console.log("authentication failed => session is already deleted");
						resolve();
					} else {
						console.error("could not delete session " + xhr.status);
						reject(new Error("could not delete session " + xhr.status));
					}
				};
				xhr.onerror = function() {
					console.error("failed to request delete session");
					reject(new Error("failed to request delete session"));
				};
				xhr.send();
			}
		});
	}
	async isWhitelabelAccount() {
		if (!isDesktop()) return !!getWhitelabelCustomizations(window);
		const customerInfo = await this.loadCustomerInfo();
		return customerInfo.domainInfos.some((domainInfo) => domainInfo.whitelabelConfig);
	}
	async loadWhitelabelConfig() {
		const customerInfo = await this.loadCustomerInfo();
		const domainInfoAndConfig = first(mapAndFilterNull(customerInfo.domainInfos, (domainInfo) => domainInfo.whitelabelConfig && {
			domainInfo,
			whitelabelConfig: domainInfo.whitelabelConfig
		}));
		if (domainInfoAndConfig) {
			const whitelabelConfig = await locator.entityClient.load(WhitelabelConfigTypeRef, domainInfoAndConfig.whitelabelConfig);
			return {
				domainInfo: domainInfoAndConfig.domainInfo,
				whitelabelConfig
			};
		}
	}
};
async function initUserController({ user, userGroupInfo, sessionId, accessToken, sessionType, loginUsername }) {
	const entityClient = locator.entityClient;
	const [props, userSettingsGroupRoot] = await Promise.all([entityClient.loadRoot(TutanotaPropertiesTypeRef, user.userGroup.group), entityClient.load(UserSettingsGroupRootTypeRef, user.userGroup.group).catch(ofClass(NotFoundError, () => entityClient.setup(null, createUserSettingsGroupRoot({
		_ownerGroup: user.userGroup.group,
		startOfTheWeek: "0",
		timeFormat: "0",
		groupSettings: [],
		usageDataOptedIn: null
	})).then(() => entityClient.load(UserSettingsGroupRootTypeRef, user.userGroup.group))))]);
	return new UserController(user, userGroupInfo, sessionId, props, accessToken, userSettingsGroupRoot, sessionType, loginUsername, entityClient, locator.serviceExecutor);
}

//#endregion
export { initUserController };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlckNvbnRyb2xsZXItY2h1bmsuanMiLCJuYW1lcyI6WyJ1c2VyOiBVc2VyIiwiX3VzZXJHcm91cEluZm86IEdyb3VwSW5mbyIsInNlc3Npb25JZDogSWRUdXBsZSIsIl9wcm9wczogVHV0YW5vdGFQcm9wZXJ0aWVzIiwiYWNjZXNzVG9rZW46IEJhc2U2NFVybCIsIl91c2VyU2V0dGluZ3NHcm91cFJvb3Q6IFVzZXJTZXR0aW5nc0dyb3VwUm9vdCIsInNlc3Npb25UeXBlOiBTZXNzaW9uVHlwZSIsImxvZ2luVXNlcm5hbWU6IHN0cmluZyIsImVudGl0eUNsaWVudDogRW50aXR5Q2xpZW50Iiwic2VydmljZUV4ZWN1dG9yOiBJU2VydmljZUV4ZWN1dG9yIiwiY2FjaGVNb2RlOiBDYWNoZU1vZGUiLCJ0eXBlOiBQbGFuVHlwZSIsInVwZGF0ZTogRW50aXR5VXBkYXRlRGF0YSIsImV2ZW50T3duZXJHcm91cElkOiBJZCIsInVwZGF0ZXM6IFJlYWRvbmx5QXJyYXk8RW50aXR5VXBkYXRlRGF0YT4iLCJzeW5jOiBib29sZWFuIiwic3lzVHlwZU1vZGVscyJdLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21tb24vYXBpL21haW4vVXNlckNvbnRyb2xsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWNjb3VudFR5cGUsIEZlYXR1cmVUeXBlLCBHcm91cFR5cGUsIExlZ2FjeVBsYW5zLCBPcGVyYXRpb25UeXBlLCBQbGFuVHlwZSB9IGZyb20gXCIuLi9jb21tb24vVHV0YW5vdGFDb25zdGFudHNcIlxuaW1wb3J0IHR5cGUgeyBCYXNlNjRVcmwgfSBmcm9tIFwiQHR1dGFvL3R1dGFub3RhLXV0aWxzXCJcbmltcG9ydCB7IGFzc2VydE5vdE51bGwsIGRvd25jYXN0LCBmaXJzdCwgbWFwQW5kRmlsdGVyTnVsbCwgbmV2ZXJOdWxsLCBvZkNsYXNzIH0gZnJvbSBcIkB0dXRhby90dXRhbm90YS11dGlsc1wiXG5pbXBvcnQgeyBNZWRpYVR5cGUgfSBmcm9tIFwiLi4vY29tbW9uL0VudGl0eUZ1bmN0aW9uc1wiXG5pbXBvcnQgeyBhc3NlcnRNYWluT3JOb2RlLCBnZXRBcGlCYXNlVXJsLCBpc0Rlc2t0b3AgfSBmcm9tIFwiLi4vY29tbW9uL0VudlwiXG5cbmltcG9ydCB7IE5vdEZvdW5kRXJyb3IgfSBmcm9tIFwiLi4vY29tbW9uL2Vycm9yL1Jlc3RFcnJvclwiXG5pbXBvcnQgeyBsb2NhdG9yIH0gZnJvbSBcIi4vQ29tbW9uTG9jYXRvclwiXG5pbXBvcnQgeyBlbGVtZW50SWRQYXJ0LCBpc1NhbWVJZCwgbGlzdElkUGFydCB9IGZyb20gXCIuLi9jb21tb24vdXRpbHMvRW50aXR5VXRpbHNcIlxuaW1wb3J0IHsgZ2V0V2hpdGVsYWJlbEN1c3RvbWl6YXRpb25zIH0gZnJvbSBcIi4uLy4uL21pc2MvV2hpdGVsYWJlbEN1c3RvbWl6YXRpb25zXCJcbmltcG9ydCB7IEVudGl0eUNsaWVudCB9IGZyb20gXCIuLi9jb21tb24vRW50aXR5Q2xpZW50XCJcbmltcG9ydCB7IENsb3NlU2Vzc2lvblNlcnZpY2UsIFBsYW5TZXJ2aWNlIH0gZnJvbSBcIi4uL2VudGl0aWVzL3N5cy9TZXJ2aWNlc1wiXG5pbXBvcnQge1xuXHRBY2NvdW50aW5nSW5mbyxcblx0QWNjb3VudGluZ0luZm9UeXBlUmVmLFxuXHRjcmVhdGVDbG9zZVNlc3Npb25TZXJ2aWNlUG9zdCxcblx0Q3VzdG9tZXIsXG5cdEN1c3RvbWVySW5mbyxcblx0Q3VzdG9tZXJJbmZvVHlwZVJlZixcblx0Q3VzdG9tZXJQcm9wZXJ0aWVzLFxuXHRDdXN0b21lclByb3BlcnRpZXNUeXBlUmVmLFxuXHRDdXN0b21lclR5cGVSZWYsXG5cdERvbWFpbkluZm8sXG5cdEdyb3VwSW5mbyxcblx0R3JvdXBJbmZvVHlwZVJlZixcblx0R3JvdXBNZW1iZXJzaGlwLFxuXHRQbGFuQ29uZmlndXJhdGlvbixcblx0VXNlcixcblx0VXNlclR5cGVSZWYsXG5cdFdoaXRlbGFiZWxDb25maWcsXG5cdFdoaXRlbGFiZWxDb25maWdUeXBlUmVmLFxufSBmcm9tIFwiLi4vZW50aXRpZXMvc3lzL1R5cGVSZWZzXCJcbmltcG9ydCB7XG5cdGNyZWF0ZVVzZXJTZXR0aW5nc0dyb3VwUm9vdCxcblx0VHV0YW5vdGFQcm9wZXJ0aWVzLFxuXHRUdXRhbm90YVByb3BlcnRpZXNUeXBlUmVmLFxuXHRVc2VyU2V0dGluZ3NHcm91cFJvb3QsXG5cdFVzZXJTZXR0aW5nc0dyb3VwUm9vdFR5cGVSZWYsXG59IGZyb20gXCIuLi9lbnRpdGllcy90dXRhbm90YS9UeXBlUmVmc1wiXG5pbXBvcnQgeyB0eXBlTW9kZWxzIGFzIHN5c1R5cGVNb2RlbHMgfSBmcm9tIFwiLi4vZW50aXRpZXMvc3lzL1R5cGVNb2RlbHNcIlxuaW1wb3J0IHsgU2Vzc2lvblR5cGUgfSBmcm9tIFwiLi4vY29tbW9uL1Nlc3Npb25UeXBlXCJcbmltcG9ydCB7IElTZXJ2aWNlRXhlY3V0b3IgfSBmcm9tIFwiLi4vY29tbW9uL1NlcnZpY2VSZXF1ZXN0LmpzXCJcbmltcG9ydCB7IGlzQ3VzdG9taXphdGlvbkVuYWJsZWRGb3JDdXN0b21lciB9IGZyb20gXCIuLi9jb21tb24vdXRpbHMvQ3VzdG9tZXJVdGlscy5qc1wiXG5pbXBvcnQgeyBFbnRpdHlVcGRhdGVEYXRhLCBpc1VwZGF0ZUZvclR5cGVSZWYgfSBmcm9tIFwiLi4vY29tbW9uL3V0aWxzL0VudGl0eVVwZGF0ZVV0aWxzLmpzXCJcbmltcG9ydCB7IGlzR2xvYmFsQWRtaW4sIGlzSW50ZXJuYWxVc2VyIH0gZnJvbSBcIi4uL2NvbW1vbi91dGlscy9Vc2VyVXRpbHMuanNcIlxuaW1wb3J0IHsgQ2FjaGVNb2RlIH0gZnJvbSBcIi4uL3dvcmtlci9yZXN0L0VudGl0eVJlc3RDbGllbnQuanNcIlxuXG5hc3NlcnRNYWluT3JOb2RlKClcblxuZXhwb3J0IGNsYXNzIFVzZXJDb250cm9sbGVyIHtcblx0cHJpdmF0ZSBwbGFuQ29uZmlnOiBQbGFuQ29uZmlndXJhdGlvbiB8IG51bGxcblxuXHRjb25zdHJ1Y3Rvcihcblx0XHQvLyBzaG91bGQgYmUgcmVhZG9ubHkgYnV0IGlzIG5lZWRlZCBmb3IgYSB3b3JrYXJvdW5kIGluIENhbGVuZGFyTW9kZWxcblx0XHRwdWJsaWMgdXNlcjogVXNlcixcblx0XHRwcml2YXRlIF91c2VyR3JvdXBJbmZvOiBHcm91cEluZm8sXG5cdFx0cHVibGljIHJlYWRvbmx5IHNlc3Npb25JZDogSWRUdXBsZSxcblx0XHRwcml2YXRlIF9wcm9wczogVHV0YW5vdGFQcm9wZXJ0aWVzLFxuXHRcdHB1YmxpYyByZWFkb25seSBhY2Nlc3NUb2tlbjogQmFzZTY0VXJsLFxuXHRcdHByaXZhdGUgX3VzZXJTZXR0aW5nc0dyb3VwUm9vdDogVXNlclNldHRpbmdzR3JvdXBSb290LFxuXHRcdHB1YmxpYyByZWFkb25seSBzZXNzaW9uVHlwZTogU2Vzc2lvblR5cGUsXG5cdFx0LyoqIFdoaWNoIGlkZW50aWZpZXIgKGUuZy4gZW1haWwgYWRkcmVzcykgd2FzIHVzZWQgdG8gY3JlYXRlIHRoZSBzZXNzaW9uLiAqL1xuXHRcdHB1YmxpYyByZWFkb25seSBsb2dpblVzZXJuYW1lOiBzdHJpbmcsXG5cdFx0cHJpdmF0ZSByZWFkb25seSBlbnRpdHlDbGllbnQ6IEVudGl0eUNsaWVudCxcblx0XHRwcml2YXRlIHJlYWRvbmx5IHNlcnZpY2VFeGVjdXRvcjogSVNlcnZpY2VFeGVjdXRvcixcblx0KSB7XG5cdFx0dGhpcy5wbGFuQ29uZmlnID0gbnVsbFxuXHR9XG5cblx0Z2V0IHVzZXJJZCgpOiBJZCB7XG5cdFx0cmV0dXJuIHRoaXMudXNlci5faWRcblx0fVxuXG5cdGdldCBwcm9wcygpOiBUdXRhbm90YVByb3BlcnRpZXMge1xuXHRcdHJldHVybiB0aGlzLl9wcm9wc1xuXHR9XG5cblx0Z2V0IHVzZXJHcm91cEluZm8oKTogR3JvdXBJbmZvIHtcblx0XHRyZXR1cm4gdGhpcy5fdXNlckdyb3VwSW5mb1xuXHR9XG5cblx0Z2V0IHVzZXJTZXR0aW5nc0dyb3VwUm9vdCgpOiBVc2VyU2V0dGluZ3NHcm91cFJvb3Qge1xuXHRcdHJldHVybiB0aGlzLl91c2VyU2V0dGluZ3NHcm91cFJvb3Rcblx0fVxuXG5cdC8qKlxuXHQgKiBDaGVja3MgaWYgdGhlIGN1cnJlbnQgdXNlciBpcyBhbiBhZG1pbiBvZiB0aGUgY3VzdG9tZXIuXG5cdCAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdXNlciBpcyBhbiBhZG1pblxuXHQgKi9cblx0aXNHbG9iYWxBZG1pbigpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gaXNHbG9iYWxBZG1pbih0aGlzLnVzZXIpXG5cdH1cblxuXHQvKipcblx0ICogQ2hlY2tzIGlmIHRoZSBhY2NvdW50IHR5cGUgb2YgdGhlIGxvZ2dlZC1pbiB1c2VyIGlzIEZSRUUuXG5cdCAqIEByZXR1cm5zIFRydWUgaWYgdGhlIGFjY291bnQgdHlwZSBpcyBGUkVFIG90aGVyd2lzZSBmYWxzZVxuXHQgKi9cblx0aXNGcmVlQWNjb3VudCgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdGhpcy51c2VyLmFjY291bnRUeXBlID09PSBBY2NvdW50VHlwZS5GUkVFXG5cdH1cblxuXHRpc1ByZW1pdW1BY2NvdW50KCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiB0aGlzLnVzZXIuYWNjb3VudFR5cGUgPT09IEFjY291bnRUeXBlLlBBSURcblx0fVxuXG5cdC8qKlxuXHQgKiBQcm92aWRlcyB0aGUgaW5mb3JtYXRpb24gaWYgYW4gaW50ZXJuYWwgdXNlciBpcyBsb2dnZWQgaW4uXG5cdCAqIEByZXR1cm4gVHJ1ZSBpZiBhbiBpbnRlcm5hbCB1c2VyIGlzIGxvZ2dlZCBpbiwgZmFsc2UgaWYgbm8gdXNlciBvciBhbiBleHRlcm5hbCB1c2VyIGlzIGxvZ2dlZCBpbi5cblx0ICovXG5cdGlzSW50ZXJuYWxVc2VyKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiBpc0ludGVybmFsVXNlcih0aGlzLnVzZXIpXG5cdH1cblxuXHRsb2FkQ3VzdG9tZXIoY2FjaGVNb2RlOiBDYWNoZU1vZGUgPSBDYWNoZU1vZGUuUmVhZEFuZFdyaXRlKTogUHJvbWlzZTxDdXN0b21lcj4ge1xuXHRcdHJldHVybiB0aGlzLmVudGl0eUNsaWVudC5sb2FkKEN1c3RvbWVyVHlwZVJlZiwgYXNzZXJ0Tm90TnVsbCh0aGlzLnVzZXIuY3VzdG9tZXIpLCB7IGNhY2hlTW9kZSB9KVxuXHR9XG5cblx0YXN5bmMgbG9hZEN1c3RvbWVySW5mbygpOiBQcm9taXNlPEN1c3RvbWVySW5mbz4ge1xuXHRcdGNvbnN0IGN1c3RvbWVyID0gYXdhaXQgdGhpcy5sb2FkQ3VzdG9tZXIoKVxuXHRcdHJldHVybiBhd2FpdCB0aGlzLmVudGl0eUNsaWVudC5sb2FkKEN1c3RvbWVySW5mb1R5cGVSZWYsIGN1c3RvbWVyLmN1c3RvbWVySW5mbylcblx0fVxuXG5cdGFzeW5jIGxvYWRDdXN0b21lclByb3BlcnRpZXMoKTogUHJvbWlzZTxDdXN0b21lclByb3BlcnRpZXM+IHtcblx0XHRjb25zdCBjdXN0b21lciA9IGF3YWl0IHRoaXMubG9hZEN1c3RvbWVyKClcblx0XHRyZXR1cm4gYXdhaXQgdGhpcy5lbnRpdHlDbGllbnQubG9hZChDdXN0b21lclByb3BlcnRpZXNUeXBlUmVmLCBhc3NlcnROb3ROdWxsKGN1c3RvbWVyLnByb3BlcnRpZXMpKVxuXHR9XG5cblx0YXN5bmMgZ2V0UGxhblR5cGUoKTogUHJvbWlzZTxQbGFuVHlwZT4ge1xuXHRcdGNvbnN0IGN1c3RvbWVySW5mbyA9IGF3YWl0IHRoaXMubG9hZEN1c3RvbWVySW5mbygpXG5cdFx0cmV0dXJuIGRvd25jYXN0KGN1c3RvbWVySW5mby5wbGFuKVxuXHR9XG5cblx0YXN5bmMgZ2V0UGxhbkNvbmZpZygpOiBQcm9taXNlPFBsYW5Db25maWd1cmF0aW9uPiB7XG5cdFx0aWYgKHRoaXMucGxhbkNvbmZpZyA9PT0gbnVsbCkge1xuXHRcdFx0Y29uc3QgcGxhblNlcnZpY2VHZXRPdXQgPSBhd2FpdCB0aGlzLnNlcnZpY2VFeGVjdXRvci5nZXQoUGxhblNlcnZpY2UsIG51bGwpXG5cdFx0XHR0aGlzLnBsYW5Db25maWcgPSBwbGFuU2VydmljZUdldE91dC5jb25maWdcblx0XHR9XG5cdFx0cmV0dXJuIGRvd25jYXN0KHRoaXMucGxhbkNvbmZpZylcblx0fVxuXG5cdGlzTGVnYWN5UGxhbih0eXBlOiBQbGFuVHlwZSk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiBMZWdhY3lQbGFucy5pbmNsdWRlcyh0eXBlKVxuXHR9XG5cblx0YXN5bmMgaXNOZXdQYWlkUGxhbigpOiBQcm9taXNlPGJvb2xlYW4+IHtcblx0XHRjb25zdCB0eXBlID0gYXdhaXQgdGhpcy5nZXRQbGFuVHlwZSgpXG5cdFx0cmV0dXJuICF0aGlzLmlzTGVnYWN5UGxhbih0eXBlKSAmJiB0eXBlICE9PSBQbGFuVHlwZS5GcmVlXG5cdH1cblxuXHRhc3luYyB1c2VMZWdhY3lCb29raW5nSXRlbSgpOiBQcm9taXNlPGJvb2xlYW4+IHtcblx0XHRjb25zdCBjdXN0b21lckluZm8gPSBhd2FpdCB0aGlzLmxvYWRDdXN0b21lckluZm8oKVxuXHRcdGNvbnN0IHR5cGU6IFBsYW5UeXBlID0gZG93bmNhc3QoY3VzdG9tZXJJbmZvLnBsYW4pXG5cdFx0cmV0dXJuICEodGhpcy5pc0xlZ2FjeVBsYW4odHlwZSkgJiYgY3VzdG9tZXJJbmZvLmN1c3RvbVBsYW4gPT0gbnVsbCkgJiYgdHlwZSAhPT0gUGxhblR5cGUuRnJlZVxuXHR9XG5cblx0LyoqXG5cdCAqIENoZWNrcyBpZiB0aGUgY3VycmVudCBwbGFuIGFsbG93cyBhZGRpbmcgdXNlcnMgYW5kIGdyb3Vwcy5cblx0ICovXG5cdGFzeW5jIGNhbkhhdmVVc2VycygpOiBQcm9taXNlPGJvb2xlYW4+IHtcblx0XHRjb25zdCBjdXN0b21lciA9IGF3YWl0IHRoaXMubG9hZEN1c3RvbWVyKClcblx0XHRjb25zdCBwbGFuVHlwZSA9IGF3YWl0IHRoaXMuZ2V0UGxhblR5cGUoKVxuXHRcdGNvbnN0IHBsYW5Db25maWcgPSBhd2FpdCB0aGlzLmdldFBsYW5Db25maWcoKVxuXG5cdFx0cmV0dXJuIHRoaXMuaXNMZWdhY3lQbGFuKHBsYW5UeXBlKSB8fCBwbGFuQ29uZmlnLm11bHRpVXNlciB8fCBpc0N1c3RvbWl6YXRpb25FbmFibGVkRm9yQ3VzdG9tZXIoY3VzdG9tZXIsIEZlYXR1cmVUeXBlLk11bHRpcGxlVXNlcnMpXG5cdH1cblxuXHRhc3luYyBsb2FkQWNjb3VudGluZ0luZm8oKTogUHJvbWlzZTxBY2NvdW50aW5nSW5mbz4ge1xuXHRcdGNvbnN0IGN1c3RvbWVySW5mbyA9IGF3YWl0IHRoaXMubG9hZEN1c3RvbWVySW5mbygpXG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuZW50aXR5Q2xpZW50LmxvYWQoQWNjb3VudGluZ0luZm9UeXBlUmVmLCBjdXN0b21lckluZm8uYWNjb3VudGluZ0luZm8pXG5cdH1cblxuXHRnZXRNYWlsR3JvdXBNZW1iZXJzaGlwcygpOiBHcm91cE1lbWJlcnNoaXBbXSB7XG5cdFx0cmV0dXJuIHRoaXMudXNlci5tZW1iZXJzaGlwcy5maWx0ZXIoKG1lbWJlcnNoaXApID0+IG1lbWJlcnNoaXAuZ3JvdXBUeXBlID09PSBHcm91cFR5cGUuTWFpbClcblx0fVxuXG5cdGdldENvbnRhY3RHcm91cE1lbWJlcnNoaXBzKCk6IEdyb3VwTWVtYmVyc2hpcFtdIHtcblx0XHRyZXR1cm4gdGhpcy51c2VyLm1lbWJlcnNoaXBzLmZpbHRlcigobWVtYmVyc2hpcCkgPT4gbWVtYmVyc2hpcC5ncm91cFR5cGUgPT09IEdyb3VwVHlwZS5Db250YWN0KVxuXHR9XG5cblx0Z2V0Q2FsZW5kYXJNZW1iZXJzaGlwcygpOiBHcm91cE1lbWJlcnNoaXBbXSB7XG5cdFx0cmV0dXJuIHRoaXMudXNlci5tZW1iZXJzaGlwcy5maWx0ZXIoKG1lbWJlcnNoaXApID0+IG1lbWJlcnNoaXAuZ3JvdXBUeXBlID09PSBHcm91cFR5cGUuQ2FsZW5kYXIpXG5cdH1cblxuXHRnZXRVc2VyTWFpbEdyb3VwTWVtYmVyc2hpcCgpOiBHcm91cE1lbWJlcnNoaXAge1xuXHRcdHJldHVybiB0aGlzLmdldE1haWxHcm91cE1lbWJlcnNoaXBzKClbMF1cblx0fVxuXG5cdGdldFRlbXBsYXRlTWVtYmVyc2hpcHMoKTogR3JvdXBNZW1iZXJzaGlwW10ge1xuXHRcdHJldHVybiB0aGlzLnVzZXIubWVtYmVyc2hpcHMuZmlsdGVyKChtZW1iZXJzaGlwKSA9PiBtZW1iZXJzaGlwLmdyb3VwVHlwZSA9PT0gR3JvdXBUeXBlLlRlbXBsYXRlKVxuXHR9XG5cblx0Z2V0Q29udGFjdExpc3RNZW1iZXJzaGlwcygpOiBHcm91cE1lbWJlcnNoaXBbXSB7XG5cdFx0cmV0dXJuIHRoaXMudXNlci5tZW1iZXJzaGlwcy5maWx0ZXIoKG1lbWJlcnNoaXApID0+IG1lbWJlcnNoaXAuZ3JvdXBUeXBlID09PSBHcm91cFR5cGUuQ29udGFjdExpc3QpXG5cdH1cblxuXHQvKipcblx0ICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiB1cGRhdGUgaXMgYW4gdXBkYXRlIG9uIHRoZSB1c2VyIGluc3RhbmNlIG9mIHRoZSBsb2dnZWQgaW4gdXNlciBhbmQgdGhlIHVwZGF0ZSBldmVudCBpcyBzZW50IGZvciB0aGUgdXNlciBncm91cC5cblx0ICogVGhlcmUgYXJlIHR3byB1cGRhdGVzIGZvciB0aGUgdXNlciBpbnN0YW5jZSBzZW50IGlmIHRoZSBsb2dnZWQgaW4gdXNlciBpcyBhbiBhZG1pbjosIG9uZSBmb3IgdGhlIHVzZXIgZ3JvdXAgYW5kIG9uZSBmb3IgdGhlIGFkbWluIGdyb3VwLlxuXHQgKiBXZSBvbmx5IHdhbnQgdG8gcHJvY2VzcyBpdCBvbmNlLCBzbyB3ZSBza2lwIHRoZSBhZG1pbiBncm91cCB1cGRhdGVcblx0ICpcblx0ICogQXR0ZW50aW9uOiBNb2R1bGVzIHRoYXQgYWN0IG9uIHVzZXIgdXBkYXRlcywgZS5nLiBmb3IgY2hhbmdlZCBncm91cCBtZW1iZXJzaGlwcywgbmVlZCB0byB1c2UgdGhpcyBmdW5jdGlvbiBpbiB0aGVpciBlbnRpdHlFdmVudHNSZWNlaXZlZCBsaXN0ZW5lci5cblx0ICogT25seSB0aGVuIGl0IGlzIGd1YXJhbnRlZWQgdGhhdCB0aGUgdXNlciBpbiB0aGUgdXNlciBjb250cm9sbGVyIGhhcyBiZWVuIHVwZGF0ZWQuIFRoZSB1cGRhdGUgZXZlbnQgZm9yIHRoZSBhZG1pbiBncm91cCBtaWdodCBjb21lIGZpcnN0LCBzbyBpZiBhIG1vZHVsZVxuXHQgKiByZWFjdHMgb24gdGhhdCBvbmUgdGhlIHVzZXIgY29udHJvbGxlciBpcyBub3QgdXBkYXRlZCB5ZXQuXG5cdCAqL1xuXHRpc1VwZGF0ZUZvckxvZ2dlZEluVXNlckluc3RhbmNlKHVwZGF0ZTogRW50aXR5VXBkYXRlRGF0YSwgZXZlbnRPd25lckdyb3VwSWQ6IElkKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIChcblx0XHRcdHVwZGF0ZS5vcGVyYXRpb24gPT09IE9wZXJhdGlvblR5cGUuVVBEQVRFICYmXG5cdFx0XHRpc1VwZGF0ZUZvclR5cGVSZWYoVXNlclR5cGVSZWYsIHVwZGF0ZSkgJiZcblx0XHRcdGlzU2FtZUlkKHRoaXMudXNlci5faWQsIHVwZGF0ZS5pbnN0YW5jZUlkKSAmJlxuXHRcdFx0aXNTYW1lSWQodGhpcy51c2VyLnVzZXJHcm91cC5ncm91cCwgZXZlbnRPd25lckdyb3VwSWQpXG5cdFx0KSAvLyBvbmx5IGluY2x1ZGUgdXBkYXRlcyBmb3IgdGhlIHVzZXIgZ3JvdXAgaGVyZVxuXHR9XG5cblx0YXN5bmMgZW50aXR5RXZlbnRzUmVjZWl2ZWQodXBkYXRlczogUmVhZG9ubHlBcnJheTxFbnRpdHlVcGRhdGVEYXRhPiwgZXZlbnRPd25lckdyb3VwSWQ6IElkKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0Zm9yIChjb25zdCB1cGRhdGUgb2YgdXBkYXRlcykge1xuXHRcdFx0Y29uc3QgeyBpbnN0YW5jZUxpc3RJZCwgaW5zdGFuY2VJZCwgb3BlcmF0aW9uIH0gPSB1cGRhdGVcblx0XHRcdGlmICh0aGlzLmlzVXBkYXRlRm9yTG9nZ2VkSW5Vc2VySW5zdGFuY2UodXBkYXRlLCBldmVudE93bmVyR3JvdXBJZCkpIHtcblx0XHRcdFx0dGhpcy51c2VyID0gYXdhaXQgdGhpcy5lbnRpdHlDbGllbnQubG9hZChVc2VyVHlwZVJlZiwgdGhpcy51c2VyLl9pZClcblx0XHRcdH0gZWxzZSBpZiAoXG5cdFx0XHRcdG9wZXJhdGlvbiA9PT0gT3BlcmF0aW9uVHlwZS5VUERBVEUgJiZcblx0XHRcdFx0aXNVcGRhdGVGb3JUeXBlUmVmKEdyb3VwSW5mb1R5cGVSZWYsIHVwZGF0ZSkgJiZcblx0XHRcdFx0aXNTYW1lSWQodGhpcy51c2VyR3JvdXBJbmZvLl9pZCwgW25ldmVyTnVsbChpbnN0YW5jZUxpc3RJZCksIGluc3RhbmNlSWRdKVxuXHRcdFx0KSB7XG5cdFx0XHRcdHRoaXMuX3VzZXJHcm91cEluZm8gPSBhd2FpdCB0aGlzLmVudGl0eUNsaWVudC5sb2FkKEdyb3VwSW5mb1R5cGVSZWYsIHRoaXMuX3VzZXJHcm91cEluZm8uX2lkKVxuXHRcdFx0fSBlbHNlIGlmIChpc1VwZGF0ZUZvclR5cGVSZWYoVHV0YW5vdGFQcm9wZXJ0aWVzVHlwZVJlZiwgdXBkYXRlKSAmJiBvcGVyYXRpb24gPT09IE9wZXJhdGlvblR5cGUuVVBEQVRFKSB7XG5cdFx0XHRcdHRoaXMuX3Byb3BzID0gYXdhaXQgdGhpcy5lbnRpdHlDbGllbnQubG9hZFJvb3QoVHV0YW5vdGFQcm9wZXJ0aWVzVHlwZVJlZiwgdGhpcy51c2VyLnVzZXJHcm91cC5ncm91cClcblx0XHRcdH0gZWxzZSBpZiAoaXNVcGRhdGVGb3JUeXBlUmVmKFVzZXJTZXR0aW5nc0dyb3VwUm9vdFR5cGVSZWYsIHVwZGF0ZSkpIHtcblx0XHRcdFx0dGhpcy5fdXNlclNldHRpbmdzR3JvdXBSb290ID0gYXdhaXQgdGhpcy5lbnRpdHlDbGllbnQubG9hZChVc2VyU2V0dGluZ3NHcm91cFJvb3RUeXBlUmVmLCB0aGlzLnVzZXIudXNlckdyb3VwLmdyb3VwKVxuXHRcdFx0fSBlbHNlIGlmIChpc1VwZGF0ZUZvclR5cGVSZWYoQ3VzdG9tZXJJbmZvVHlwZVJlZiwgdXBkYXRlKSkge1xuXHRcdFx0XHRpZiAob3BlcmF0aW9uID09PSBPcGVyYXRpb25UeXBlLkNSRUFURSkge1xuXHRcdFx0XHRcdC8vIEFmdGVyIHByZW1pdW0gdXBncmFkZSBjdXN0b21lciBpbmZvIGlzIGRlbGV0ZWQgYW5kIGNyZWF0ZWQgd2l0aCBuZXcgaWQuIFdlIHdhbnQgdG8gbWFrZSBzdXJlIHRoYXQgaXQncyBjYWNoZWQgZm9yIG9mZmxpbmUgbG9naW4uXG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5lbnRpdHlDbGllbnQubG9hZChDdXN0b21lckluZm9UeXBlUmVmLCBbdXBkYXRlLmluc3RhbmNlTGlzdElkLCB1cGRhdGUuaW5zdGFuY2VJZF0pXG5cdFx0XHRcdH1cblx0XHRcdFx0Ly8gY2FjaGVkIHBsYW4gY29uZmlnIG1pZ2h0IGJlIG91dGRhdGVkIG5vd1xuXHRcdFx0XHR0aGlzLnBsYW5Db25maWcgPSBudWxsXG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIERlbGV0ZSB0aGUgc2Vzc2lvbiAob25seSBpZiBpdCdzIGEgbm9uLXBlcnNpc3RlbnQgc2Vzc2lvblxuXHQgKiBAcGFyYW0gc3luYyB3aGV0aGVyIG9yIG5vdCB0byBkZWxldGUgaW4gdGhlIG1haW4gdGhyZWFkLiBGb3IgZXhhbXBsZSwgd2lsbCBiZSB0cnVlIHdoZW4gbG9nZ2luZyBvdXQgZHVlIHRvIGNsb3NpbmcgdGhlIHRhYlxuXHQgKi9cblx0YXN5bmMgZGVsZXRlU2Vzc2lvbihzeW5jOiBib29sZWFuKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0Ly8gaW4gY2FzZSB0aGUgdGFiIGlzIGNsb3NlZCB3ZSBuZWVkIHRvIGRlbGV0ZSB0aGUgc2Vzc2lvbiBpbiB0aGUgbWFpbiB0aHJlYWQgKHN5bmNocm9ub3VzIHJlc3QgcmVxdWVzdClcblx0XHRpZiAoc3luYykge1xuXHRcdFx0aWYgKHRoaXMuc2Vzc2lvblR5cGUgIT09IFNlc3Npb25UeXBlLlBlcnNpc3RlbnQpIHtcblx0XHRcdFx0YXdhaXQgdGhpcy5kZWxldGVTZXNzaW9uU3luYygpXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmICh0aGlzLnNlc3Npb25UeXBlICE9PSBTZXNzaW9uVHlwZS5QZXJzaXN0ZW50KSB7XG5cdFx0XHRcdGF3YWl0IGxvY2F0b3IubG9naW5GYWNhZGUuZGVsZXRlU2Vzc2lvbih0aGlzLmFjY2Vzc1Rva2VuKS5jYXRjaCgoZSkgPT4gY29uc29sZS5sb2coXCJFcnJvciBpZ25vcmVkIG9uIExvZ291dDpcIiwgZSkpXG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0ZGVsZXRlU2Vzc2lvblN5bmMoKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblx0XHRcdGNvbnN0IHNlbmRCZWFjb24gPSBuYXZpZ2F0b3Iuc2VuZEJlYWNvbiAvLyBTYXZlIHNlbmRCZWFjb24gdG8gdmFyaWFibGUgdG8gc2F0aXNmeSB0eXBlIGNoZWNrZXJcblxuXHRcdFx0aWYgKHNlbmRCZWFjb24pIHtcblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRjb25zdCBhcGlVcmwgPSBuZXcgVVJMKGdldEFwaUJhc2VVcmwobG9jYXRvci5kb21haW5Db25maWdQcm92aWRlcigpLmdldEN1cnJlbnREb21haW5Db25maWcoKSkpXG5cdFx0XHRcdFx0YXBpVXJsLnBhdGhuYW1lICs9IGAvcmVzdC9zeXMvJHtDbG9zZVNlc3Npb25TZXJ2aWNlLm5hbWUudG9Mb3dlckNhc2UoKX1gXG5cdFx0XHRcdFx0Y29uc3QgcmVxdWVzdE9iamVjdCA9IGNyZWF0ZUNsb3NlU2Vzc2lvblNlcnZpY2VQb3N0KHtcblx0XHRcdFx0XHRcdGFjY2Vzc1Rva2VuOiB0aGlzLmFjY2Vzc1Rva2VuLFxuXHRcdFx0XHRcdFx0c2Vzc2lvbklkOiB0aGlzLnNlc3Npb25JZCxcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdGRlbGV0ZSBkb3duY2FzdChyZXF1ZXN0T2JqZWN0KVtcIl90eXBlXCJdIC8vIFJlbW92ZSBleHRyYSBmaWVsZCB3aGljaCBpcyBub3QgcGFydCBvZiB0aGUgZGF0YSBtb2RlbFxuXG5cdFx0XHRcdFx0Ly8gU2VuZCBhcyBCbG9iIHRvIGJlIGFibGUgdG8gc2V0IGNvbnRlbnQgdHlwZSBvdGhlcndpc2Ugc2VuZHMgJ3RleHQvcGxhaW4nXG5cdFx0XHRcdFx0Y29uc3QgcXVldWVkID0gc2VuZEJlYWNvbi5jYWxsKFxuXHRcdFx0XHRcdFx0bmF2aWdhdG9yLFxuXHRcdFx0XHRcdFx0YXBpVXJsLFxuXHRcdFx0XHRcdFx0bmV3IEJsb2IoW0pTT04uc3RyaW5naWZ5KHJlcXVlc3RPYmplY3QpXSwge1xuXHRcdFx0XHRcdFx0XHR0eXBlOiBNZWRpYVR5cGUuSnNvbixcblx0XHRcdFx0XHRcdH0pLFxuXHRcdFx0XHRcdClcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhcInF1ZXVlZCBjbG9zaW5nIHNlc3Npb246IFwiLCBxdWV1ZWQpXG5cdFx0XHRcdFx0cmVzb2x2ZSgpXG5cdFx0XHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkZhaWxlZCB0byBzZW5kIGJlYWNvblwiLCBlKVxuXHRcdFx0XHRcdHJlamVjdChlKVxuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBGYWxsIGJhY2sgdG8gc3luYyBYSFIgaWYgQmVhY29uIEFQSSBpcyBub3QgYXZhaWxhYmxlICh3aGljaCBpdCBzaG91bGQgYmUgZXZlcnl3aGVyZSBieSBub3cgYnV0IG1heWJlIGl0IGlzIHN1cHByZXNzZWQgc29tZWhvdylcblx0XHRcdFx0Y29uc3QgYXBpVXJsID0gbmV3IFVSTChnZXRBcGlCYXNlVXJsKGxvY2F0b3IuZG9tYWluQ29uZmlnUHJvdmlkZXIoKS5nZXRDdXJyZW50RG9tYWluQ29uZmlnKCkpKVxuXHRcdFx0XHRhcGlVcmwucGF0aG5hbWUgKz0gYC9yZXN0L3N5cy9zZXNzaW9uLyR7bGlzdElkUGFydCh0aGlzLnNlc3Npb25JZCl9LyR7ZWxlbWVudElkUGFydCh0aGlzLnNlc3Npb25JZCl9YFxuXHRcdFx0XHRjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKVxuXHRcdFx0XHR4aHIub3BlbihcIkRFTEVURVwiLCBhcGlVcmwsIGZhbHNlKSAvLyBzeW5jIHJlcXVlc3RzIGluY3JlYXNlIHJlbGlhYmlsaXR5IHdoZW4gaW52b2tlZCBpbiBvbnVubG9hZFxuXG5cdFx0XHRcdHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiYWNjZXNzVG9rZW5cIiwgdGhpcy5hY2Nlc3NUb2tlbilcblx0XHRcdFx0eGhyLnNldFJlcXVlc3RIZWFkZXIoXCJ2XCIsIHN5c1R5cGVNb2RlbHMuU2Vzc2lvbi52ZXJzaW9uKVxuXG5cdFx0XHRcdHhoci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0Ly8gWE1MSHR0cFJlcXVlc3RQcm9ncmVzc0V2ZW50LCBidXQgbm90IG5lZWRlZFxuXHRcdFx0XHRcdGlmICh4aHIuc3RhdHVzID09PSAyMDApIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiZGVsZXRlZCBzZXNzaW9uXCIpXG5cdFx0XHRcdFx0XHRyZXNvbHZlKClcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHhoci5zdGF0dXMgPT09IDQwMSkge1xuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coXCJhdXRoZW50aWNhdGlvbiBmYWlsZWQgPT4gc2Vzc2lvbiBpcyBhbHJlYWR5IGRlbGV0ZWRcIilcblx0XHRcdFx0XHRcdHJlc29sdmUoKVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmVycm9yKFwiY291bGQgbm90IGRlbGV0ZSBzZXNzaW9uIFwiICsgeGhyLnN0YXR1cylcblx0XHRcdFx0XHRcdHJlamVjdChuZXcgRXJyb3IoXCJjb3VsZCBub3QgZGVsZXRlIHNlc3Npb24gXCIgKyB4aHIuc3RhdHVzKSlcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR4aHIub25lcnJvciA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKFwiZmFpbGVkIHRvIHJlcXVlc3QgZGVsZXRlIHNlc3Npb25cIilcblx0XHRcdFx0XHRyZWplY3QobmV3IEVycm9yKFwiZmFpbGVkIHRvIHJlcXVlc3QgZGVsZXRlIHNlc3Npb25cIikpXG5cdFx0XHRcdH1cblxuXHRcdFx0XHR4aHIuc2VuZCgpXG5cdFx0XHR9XG5cdFx0fSlcblx0fVxuXG5cdGFzeW5jIGlzV2hpdGVsYWJlbEFjY291bnQoKTogUHJvbWlzZTxib29sZWFuPiB7XG5cdFx0Ly8gaXNUdXRhbm90YURvbWFpbiBhbHdheXMgcmV0dXJucyB0cnVlIG9uIGRlc2t0b3Bcblx0XHRpZiAoIWlzRGVza3RvcCgpKSB7XG5cdFx0XHRyZXR1cm4gISFnZXRXaGl0ZWxhYmVsQ3VzdG9taXphdGlvbnMod2luZG93KVxuXHRcdH1cblxuXHRcdGNvbnN0IGN1c3RvbWVySW5mbyA9IGF3YWl0IHRoaXMubG9hZEN1c3RvbWVySW5mbygpXG5cdFx0cmV0dXJuIGN1c3RvbWVySW5mby5kb21haW5JbmZvcy5zb21lKChkb21haW5JbmZvKSA9PiBkb21haW5JbmZvLndoaXRlbGFiZWxDb25maWcpXG5cdH1cblxuXHRhc3luYyBsb2FkV2hpdGVsYWJlbENvbmZpZygpOiBQcm9taXNlPFxuXHRcdHwge1xuXHRcdFx0XHR3aGl0ZWxhYmVsQ29uZmlnOiBXaGl0ZWxhYmVsQ29uZmlnXG5cdFx0XHRcdGRvbWFpbkluZm86IERvbWFpbkluZm9cblx0XHQgIH1cblx0XHR8IG51bGxcblx0XHR8IHVuZGVmaW5lZFxuXHQ+IHtcblx0XHQvLyBUaGUgbW9kZWwgYWxsb3dzIGZvciBtdWx0aXBsZSBkb21haW5JbmZvcyB0byBoYXZlIHdoaXRlbGFiZWwgY29uZmlnc1xuXHRcdC8vIGJ1dCBpbiByZWFsaXR5IG9uIHRoZSBzZXJ2ZXIgb25seSBhIHNpbmdsZSBjdXN0b20gY29uZmlndXJhdGlvbiBpcyBhbGxvd2VkXG5cdFx0Ly8gdGhlcmVmb3JlIHRoZSByZXN1bHQgb2YgdGhlIGZpbHRlcmluZyBhbGwgZG9tYWluSW5mb3Mgd2l0aCBubyB3aGl0ZWxhYmVsQ29uZmlnXG5cdFx0Ly8gY2FuIG9ubHkgYmUgYW4gYXJyYXkgb2YgbGVuZ3RoIDAgb3IgMVxuXHRcdGNvbnN0IGN1c3RvbWVySW5mbyA9IGF3YWl0IHRoaXMubG9hZEN1c3RvbWVySW5mbygpXG5cdFx0Y29uc3QgZG9tYWluSW5mb0FuZENvbmZpZyA9IGZpcnN0KFxuXHRcdFx0bWFwQW5kRmlsdGVyTnVsbChcblx0XHRcdFx0Y3VzdG9tZXJJbmZvLmRvbWFpbkluZm9zLFxuXHRcdFx0XHQoZG9tYWluSW5mbykgPT5cblx0XHRcdFx0XHRkb21haW5JbmZvLndoaXRlbGFiZWxDb25maWcgJiYge1xuXHRcdFx0XHRcdFx0ZG9tYWluSW5mbyxcblx0XHRcdFx0XHRcdHdoaXRlbGFiZWxDb25maWc6IGRvbWFpbkluZm8ud2hpdGVsYWJlbENvbmZpZyxcblx0XHRcdFx0XHR9LFxuXHRcdFx0KSxcblx0XHQpXG5cblx0XHRpZiAoZG9tYWluSW5mb0FuZENvbmZpZykge1xuXHRcdFx0Y29uc3Qgd2hpdGVsYWJlbENvbmZpZyA9IGF3YWl0IGxvY2F0b3IuZW50aXR5Q2xpZW50LmxvYWQoV2hpdGVsYWJlbENvbmZpZ1R5cGVSZWYsIGRvbWFpbkluZm9BbmRDb25maWcud2hpdGVsYWJlbENvbmZpZylcblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdGRvbWFpbkluZm86IGRvbWFpbkluZm9BbmRDb25maWcuZG9tYWluSW5mbyxcblx0XHRcdFx0d2hpdGVsYWJlbENvbmZpZyxcblx0XHRcdH1cblx0XHR9XG5cdH1cbn1cblxuZXhwb3J0IHR5cGUgVXNlckNvbnRyb2xsZXJJbml0RGF0YSA9IHtcblx0dXNlcjogVXNlclxuXHR1c2VyR3JvdXBJbmZvOiBHcm91cEluZm9cblx0c2Vzc2lvbklkOiBJZFR1cGxlXG5cdGFjY2Vzc1Rva2VuOiBCYXNlNjRVcmxcblx0c2Vzc2lvblR5cGU6IFNlc3Npb25UeXBlXG5cdGxvZ2luVXNlcm5hbWU6IHN0cmluZ1xufVxuLy8gbm9pbnNwZWN0aW9uIEpTVW51c2VkR2xvYmFsU3ltYm9sc1xuLy8gZHluYW1pY2FsbHkgaW1wb3J0ZWRcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpbml0VXNlckNvbnRyb2xsZXIoe1xuXHR1c2VyLFxuXHR1c2VyR3JvdXBJbmZvLFxuXHRzZXNzaW9uSWQsXG5cdGFjY2Vzc1Rva2VuLFxuXHRzZXNzaW9uVHlwZSxcblx0bG9naW5Vc2VybmFtZSxcbn06IFVzZXJDb250cm9sbGVySW5pdERhdGEpOiBQcm9taXNlPFVzZXJDb250cm9sbGVyPiB7XG5cdGNvbnN0IGVudGl0eUNsaWVudCA9IGxvY2F0b3IuZW50aXR5Q2xpZW50XG5cdGNvbnN0IFtwcm9wcywgdXNlclNldHRpbmdzR3JvdXBSb290XSA9IGF3YWl0IFByb21pc2UuYWxsKFtcblx0XHRlbnRpdHlDbGllbnQubG9hZFJvb3QoVHV0YW5vdGFQcm9wZXJ0aWVzVHlwZVJlZiwgdXNlci51c2VyR3JvdXAuZ3JvdXApLFxuXHRcdGVudGl0eUNsaWVudC5sb2FkKFVzZXJTZXR0aW5nc0dyb3VwUm9vdFR5cGVSZWYsIHVzZXIudXNlckdyb3VwLmdyb3VwKS5jYXRjaChcblx0XHRcdG9mQ2xhc3MoTm90Rm91bmRFcnJvciwgKCkgPT5cblx0XHRcdFx0ZW50aXR5Q2xpZW50XG5cdFx0XHRcdFx0LnNldHVwKFxuXHRcdFx0XHRcdFx0bnVsbCxcblx0XHRcdFx0XHRcdGNyZWF0ZVVzZXJTZXR0aW5nc0dyb3VwUm9vdCh7XG5cdFx0XHRcdFx0XHRcdF9vd25lckdyb3VwOiB1c2VyLnVzZXJHcm91cC5ncm91cCxcblx0XHRcdFx0XHRcdFx0c3RhcnRPZlRoZVdlZWs6IFwiMFwiLFxuXHRcdFx0XHRcdFx0XHR0aW1lRm9ybWF0OiBcIjBcIixcblx0XHRcdFx0XHRcdFx0Z3JvdXBTZXR0aW5nczogW10sXG5cdFx0XHRcdFx0XHRcdHVzYWdlRGF0YU9wdGVkSW46IG51bGwsXG5cdFx0XHRcdFx0XHR9KSxcblx0XHRcdFx0XHQpXG5cdFx0XHRcdFx0LnRoZW4oKCkgPT4gZW50aXR5Q2xpZW50LmxvYWQoVXNlclNldHRpbmdzR3JvdXBSb290VHlwZVJlZiwgdXNlci51c2VyR3JvdXAuZ3JvdXApKSxcblx0XHRcdCksXG5cdFx0KSxcblx0XSlcblx0cmV0dXJuIG5ldyBVc2VyQ29udHJvbGxlcihcblx0XHR1c2VyLFxuXHRcdHVzZXJHcm91cEluZm8sXG5cdFx0c2Vzc2lvbklkLFxuXHRcdHByb3BzLFxuXHRcdGFjY2Vzc1Rva2VuLFxuXHRcdHVzZXJTZXR0aW5nc0dyb3VwUm9vdCxcblx0XHRzZXNzaW9uVHlwZSxcblx0XHRsb2dpblVzZXJuYW1lLFxuXHRcdGVudGl0eUNsaWVudCxcblx0XHRsb2NhdG9yLnNlcnZpY2VFeGVjdXRvcixcblx0KVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUErQ0Esa0JBQWtCO0lBRUwsaUJBQU4sTUFBcUI7Q0FDM0IsQUFBUTtDQUVSLFlBRVFBLE1BQ0NDLGdCQUNRQyxXQUNSQyxRQUNRQyxhQUNSQyx3QkFDUUMsYUFFQUMsZUFDQ0MsY0FDQUMsaUJBQ2hCO0VBNFZGLEtBdldRO0VBdVdQLEtBdFdRO0VBc1dQLEtBcldlO0VBcVdkLEtBcFdNO0VBb1dMLEtBbldhO0VBbVdaLEtBbFdJO0VBa1dILEtBaldXO0VBaVdWLEtBL1ZVO0VBK1ZULEtBOVZVO0VBOFZULEtBN1ZTO0FBRWpCLE9BQUssYUFBYTtDQUNsQjtDQUVELElBQUksU0FBYTtBQUNoQixTQUFPLEtBQUssS0FBSztDQUNqQjtDQUVELElBQUksUUFBNEI7QUFDL0IsU0FBTyxLQUFLO0NBQ1o7Q0FFRCxJQUFJLGdCQUEyQjtBQUM5QixTQUFPLEtBQUs7Q0FDWjtDQUVELElBQUksd0JBQStDO0FBQ2xELFNBQU8sS0FBSztDQUNaOzs7OztDQU1ELGdCQUF5QjtBQUN4QixTQUFPLGNBQWMsS0FBSyxLQUFLO0NBQy9COzs7OztDQU1ELGdCQUF5QjtBQUN4QixTQUFPLEtBQUssS0FBSyxnQkFBZ0IsWUFBWTtDQUM3QztDQUVELG1CQUE0QjtBQUMzQixTQUFPLEtBQUssS0FBSyxnQkFBZ0IsWUFBWTtDQUM3Qzs7Ozs7Q0FNRCxpQkFBMEI7QUFDekIsU0FBTyxlQUFlLEtBQUssS0FBSztDQUNoQztDQUVELGFBQWFDLFlB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