import { __toESM } from "./chunk-chunk.js";
import "./dist-chunk.js";
import "./ProgrammingError-chunk.js";
import { assertMainOrNode } from "./Env-chunk.js";
import "./ClientDetector-chunk.js";
import { mithril_default } from "./mithril-chunk.js";
import { last } from "./dist2-chunk.js";
import "./WhitelabelCustomizations-chunk.js";
import "./LanguageViewModel-chunk.js";
import { styles } from "./styles-chunk.js";
import "./theme-chunk.js";
import { CloseEventBusOption, SECOND_MS } from "./TutanotaConstants-chunk.js";
import "./KeyManager-chunk.js";
import "./WindowFacade-chunk.js";
import { modal } from "./RootView-chunk.js";
import "./size-chunk.js";
import "./HtmlUtils-chunk.js";
import "./EntityUtils-chunk.js";
import { CalendarViewType } from "./CommonCalendarUtils-chunk.js";
import { require_stream } from "./stream-chunk.js";
import { CALENDAR_PREFIX, CONTACTS_PREFIX, SEARCH_PREFIX, SETTINGS_PREFIX } from "./RouteChange-chunk.js";

//#region src/common/native/main/WebMobileFacade.ts
var import_stream = __toESM(require_stream(), 1);
assertMainOrNode();
var WebMobileFacade = class {
	disconnectTimeoutId;
	isAppVisible = (0, import_stream.default)(false);
	constructor(connectivityModel, baseViewPrefix) {
		this.connectivityModel = connectivityModel;
		this.baseViewPrefix = baseViewPrefix;
	}
	getIsAppVisible() {
		return this.isAppVisible;
	}
	async handleBackPress() {
		await Promise.resolve();
		const lastModalComponent = last(modal.components);
		if (lastModalComponent) {
			lastModalComponent.component.onClose();
			return true;
		} else {
			const viewSlider = window.tutao.currentView?.getViewSlider?.();
			const currentRoute = mithril_default.route.get();
			if (viewSlider && viewSlider.isForegroundColumnFocused()) {
				viewSlider.focusNextColumn();
				return true;
			} else if (this.handlesBackButtonViaCurrentView()) return true;
else if (viewSlider && viewSlider.focusedColumn !== viewSlider.getMainColumn() && styles.isSingleColumnLayout() && viewSlider.isFocusPreviousPossible()) {
				viewSlider.focusPreviousColumn();
				return true;
			} else if (currentRoute.startsWith(CALENDAR_PREFIX)) {
				if (history.state?.origin === CalendarViewType.MONTH) {
					const date = history.state.dateString ?? new Date().toISOString().substring(0, 10);
					mithril_default.route.set("/calendar/:view/:date", {
						view: CalendarViewType.MONTH,
						date
					});
					return true;
				}
				if (this.baseViewPrefix === CALENDAR_PREFIX) return false;
else {
					mithril_default.route.set(this.baseViewPrefix);
					return true;
				}
			} else if (currentRoute.startsWith(CONTACTS_PREFIX) || currentRoute.startsWith(SETTINGS_PREFIX) || currentRoute.startsWith(SEARCH_PREFIX)) {
				mithril_default.route.set(this.baseViewPrefix);
				return true;
			} else return false;
		}
	}
	handlesBackButtonViaCurrentView() {
		const currentView = window.tutao.currentView;
		return currentView?.handleBackButton != null && currentView.handleBackButton();
	}
	async visibilityChange(visibility) {
		console.log("native visibility change", visibility);
		this.isAppVisible(visibility);
		if (visibility) {
			if (this.disconnectTimeoutId != null) {
				clearTimeout(this.disconnectTimeoutId);
				this.disconnectTimeoutId = null;
			}
			return this.connectivityModel.tryReconnect(false, true);
		} else this.disconnectTimeoutId = setTimeout(() => {
			this.connectivityModel.close(CloseEventBusOption.Pause);
		}, 30 * SECOND_MS);
	}
	async keyboardSizeChanged(newSize) {
		const { windowFacade } = await import("./WindowFacade2-chunk.js");
		return windowFacade.onKeyboardSizeChanged(newSize);
	}
};

//#endregion
export { WebMobileFacade };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2ViTW9iaWxlRmFjYWRlLWNodW5rLmpzIiwibmFtZXMiOlsiY29ubmVjdGl2aXR5TW9kZWw6IFdlYnNvY2tldENvbm5lY3Rpdml0eU1vZGVsIiwiYmFzZVZpZXdQcmVmaXg6IHN0cmluZyIsImN1cnJlbnRWaWV3OiBUb3BMZXZlbFZpZXcgfCBudWxsIiwidmlzaWJpbGl0eTogYm9vbGVhbiIsIm5ld1NpemU6IG51bWJlciJdLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21tb24vbmF0aXZlL21haW4vV2ViTW9iaWxlRmFjYWRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtIGZyb20gXCJtaXRocmlsXCJcbmltcG9ydCB7IGFzc2VydE1haW5Pck5vZGUgfSBmcm9tIFwiLi4vLi4vYXBpL2NvbW1vbi9FbnZcIlxuaW1wb3J0IHsgbW9kYWwgfSBmcm9tIFwiLi4vLi4vZ3VpL2Jhc2UvTW9kYWxcIlxuaW1wb3J0IHsgQ0FMRU5EQVJfUFJFRklYLCBDT05UQUNUU19QUkVGSVgsIE1BSUxfUFJFRklYLCBTRUFSQ0hfUFJFRklYLCBTRVRUSU5HU19QUkVGSVggfSBmcm9tIFwiLi4vLi4vbWlzYy9Sb3V0ZUNoYW5nZVwiXG5pbXBvcnQgeyBsYXN0IH0gZnJvbSBcIkB0dXRhby90dXRhbm90YS11dGlsc1wiXG5pbXBvcnQgeyBDbG9zZUV2ZW50QnVzT3B0aW9uLCBNYWlsU2V0S2luZCwgU0VDT05EX01TIH0gZnJvbSBcIi4uLy4uL2FwaS9jb21tb24vVHV0YW5vdGFDb25zdGFudHMuanNcIlxuaW1wb3J0IHsgTW9iaWxlRmFjYWRlIH0gZnJvbSBcIi4uL2NvbW1vbi9nZW5lcmF0ZWRpcGMvTW9iaWxlRmFjYWRlLmpzXCJcbmltcG9ydCB7IHN0eWxlcyB9IGZyb20gXCIuLi8uLi9ndWkvc3R5bGVzXCJcbmltcG9ydCB7IFdlYnNvY2tldENvbm5lY3Rpdml0eU1vZGVsIH0gZnJvbSBcIi4uLy4uL21pc2MvV2Vic29ja2V0Q29ubmVjdGl2aXR5TW9kZWwuanNcIlxuaW1wb3J0IHsgTWFpbGJveE1vZGVsIH0gZnJvbSBcIi4uLy4uL21haWxGdW5jdGlvbmFsaXR5L01haWxib3hNb2RlbC5qc1wiXG5pbXBvcnQgeyBUb3BMZXZlbFZpZXcgfSBmcm9tIFwiLi4vLi4vLi4vVG9wTGV2ZWxWaWV3LmpzXCJcbmltcG9ydCBzdHJlYW0gZnJvbSBcIm1pdGhyaWwvc3RyZWFtXCJcbmltcG9ydCB7IENhbGVuZGFyVmlld1R5cGUgfSBmcm9tIFwiLi4vLi4vYXBpL2NvbW1vbi91dGlscy9Db21tb25DYWxlbmRhclV0aWxzLmpzXCJcblxuYXNzZXJ0TWFpbk9yTm9kZSgpXG5cbi8qKlxuICogSGFuZGxlcyBwcmVzcyBvZiB0aGUgYW5kcm9pZCBiYWNrIGJ1dHRvbi4gUmV0dXJucyB0cnVlIGlmIHRoZSBhY3Rpb24gaGFzIGJlZW4gcHJvY2Vzc2VkIGJ5IHRoZSBhcHBsaWNhdGlvbi5cbiAqIEZhbHNlIGlmIHRoZSBjYWxsZXIgbXVzdCBoYW5kbGUgdGhlIGJ1dHRvbiBwcmVzcyAocXVpdCB0aGUgYXBwbGljYXRpb24pXG4gKi9cbmV4cG9ydCBjbGFzcyBXZWJNb2JpbGVGYWNhZGUgaW1wbGVtZW50cyBNb2JpbGVGYWNhZGUge1xuXHRwcml2YXRlIGRpc2Nvbm5lY3RUaW1lb3V0SWQ6IFRpbWVvdXRJRCB8IG51bGxcblxuXHRwcml2YXRlIGlzQXBwVmlzaWJsZTogc3RyZWFtPGJvb2xlYW4+ID0gc3RyZWFtKGZhbHNlKVxuXG5cdGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgY29ubmVjdGl2aXR5TW9kZWw6IFdlYnNvY2tldENvbm5lY3Rpdml0eU1vZGVsLCBwcml2YXRlIHJlYWRvbmx5IGJhc2VWaWV3UHJlZml4OiBzdHJpbmcpIHt9XG5cblx0cHVibGljIGdldElzQXBwVmlzaWJsZSgpOiBzdHJlYW08Ym9vbGVhbj4ge1xuXHRcdHJldHVybiB0aGlzLmlzQXBwVmlzaWJsZVxuXHR9XG5cblx0YXN5bmMgaGFuZGxlQmFja1ByZXNzKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuXHRcdGF3YWl0IFByb21pc2UucmVzb2x2ZSgpXG5cdFx0Y29uc3QgbGFzdE1vZGFsQ29tcG9uZW50ID0gbGFzdChtb2RhbC5jb21wb25lbnRzKVxuXG5cdFx0aWYgKGxhc3RNb2RhbENvbXBvbmVudCkge1xuXHRcdFx0Ly8gZmlyc3QgY2hlY2sgaWYgYW55IG1vZGFsIGRpYWxvZyBpcyB2aXNpYmxlXG5cdFx0XHRsYXN0TW9kYWxDb21wb25lbnQuY29tcG9uZW50Lm9uQ2xvc2UoKVxuXHRcdFx0cmV0dXJuIHRydWVcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gb3RoZXJ3aXNlIHRyeSB0byBuYXZpZ2F0ZSBiYWNrIGluIHRoZSBjdXJyZW50IHZpZXdcblx0XHRcdGNvbnN0IHZpZXdTbGlkZXIgPSB3aW5kb3cudHV0YW8uY3VycmVudFZpZXc/LmdldFZpZXdTbGlkZXI/LigpXG5cblx0XHRcdGNvbnN0IGN1cnJlbnRSb3V0ZSA9IG0ucm91dGUuZ2V0KClcblxuXHRcdFx0Ly8gSWYgdGhlIHNpZGViYXIgaXMgb3BlbmVkLCBjbG9zZSBpdFxuXHRcdFx0aWYgKHZpZXdTbGlkZXIgJiYgdmlld1NsaWRlci5pc0ZvcmVncm91bmRDb2x1bW5Gb2N1c2VkKCkpIHtcblx0XHRcdFx0dmlld1NsaWRlci5mb2N1c05leHRDb2x1bW4oKVxuXHRcdFx0XHRyZXR1cm4gdHJ1ZVxuXHRcdFx0fSBlbHNlIGlmICh0aGlzLmhhbmRsZXNCYWNrQnV0dG9uVmlhQ3VycmVudFZpZXcoKSkge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZVxuXHRcdFx0fSBlbHNlIGlmIChcblx0XHRcdFx0dmlld1NsaWRlciAmJlxuXHRcdFx0XHR2aWV3U2xpZGVyLmZvY3VzZWRDb2x1bW4gIT09IHZpZXdTbGlkZXIuZ2V0TWFpbkNvbHVtbigpICYmXG5cdFx0XHRcdHN0eWxlcy5pc1NpbmdsZUNvbHVtbkxheW91dCgpICYmXG5cdFx0XHRcdHZpZXdTbGlkZXIuaXNGb2N1c1ByZXZpb3VzUG9zc2libGUoKVxuXHRcdFx0KSB7XG5cdFx0XHRcdC8vIGN1cnJlbnQgdmlldyBjYW4gbmF2aWdhdGUgYmFjaywgYSByZWdpb24gY29sdW1uIGlzIGZvY3VzZWQgKG5vdCBtYWluKSBhbmQgaXMgaW4gc2luZ2xlQ29sdW1uTGF5b3V0XG5cdFx0XHRcdHZpZXdTbGlkZXIuZm9jdXNQcmV2aW91c0NvbHVtbigpXG5cdFx0XHRcdHJldHVybiB0cnVlXG5cdFx0XHR9IGVsc2UgaWYgKGN1cnJlbnRSb3V0ZS5zdGFydHNXaXRoKENBTEVOREFSX1BSRUZJWCkpIHtcblx0XHRcdFx0aWYgKGhpc3Rvcnkuc3RhdGU/Lm9yaWdpbiA9PT0gQ2FsZW5kYXJWaWV3VHlwZS5NT05USCkge1xuXHRcdFx0XHRcdGNvbnN0IGRhdGUgPSBoaXN0b3J5LnN0YXRlLmRhdGVTdHJpbmcgPz8gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCAxMClcblx0XHRcdFx0XHRtLnJvdXRlLnNldChcIi9jYWxlbmRhci86dmlldy86ZGF0ZVwiLCB7XG5cdFx0XHRcdFx0XHR2aWV3OiBDYWxlbmRhclZpZXdUeXBlLk1PTlRILFxuXHRcdFx0XHRcdFx0ZGF0ZSxcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdHJldHVybiB0cnVlXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodGhpcy5iYXNlVmlld1ByZWZpeCA9PT0gQ0FMRU5EQVJfUFJFRklYKSB7XG5cdFx0XHRcdFx0Ly8gd2UgYXJlIGF0IHRoZSBtYWluIHZpZXcgYW5kIHdhbnQgdG8gZXhpdCB0aGUgYXBwXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlXG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0bS5yb3V0ZS5zZXQodGhpcy5iYXNlVmlld1ByZWZpeClcblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZVxuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKGN1cnJlbnRSb3V0ZS5zdGFydHNXaXRoKENPTlRBQ1RTX1BSRUZJWCkgfHwgY3VycmVudFJvdXRlLnN0YXJ0c1dpdGgoU0VUVElOR1NfUFJFRklYKSB8fCBjdXJyZW50Um91dGUuc3RhcnRzV2l0aChTRUFSQ0hfUFJFRklYKSkge1xuXHRcdFx0XHQvLyBnbyBiYWNrIHRvIG1haWwgb3IgY2FsZW5kYXIgZnJvbSBvdGhlciBwYXRoc1xuXHRcdFx0XHRtLnJvdXRlLnNldCh0aGlzLmJhc2VWaWV3UHJlZml4KVxuXHRcdFx0XHRyZXR1cm4gdHJ1ZVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlXG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBoYW5kbGVzQmFja0J1dHRvblZpYUN1cnJlbnRWaWV3KCk6IGJvb2xlYW4ge1xuXHRcdGNvbnN0IGN1cnJlbnRWaWV3OiBUb3BMZXZlbFZpZXcgfCBudWxsID0gd2luZG93LnR1dGFvLmN1cnJlbnRWaWV3XG5cdFx0cmV0dXJuIGN1cnJlbnRWaWV3Py5oYW5kbGVCYWNrQnV0dG9uICE9IG51bGwgJiYgY3VycmVudFZpZXcuaGFuZGxlQmFja0J1dHRvbigpXG5cdH1cblxuXHRhc3luYyB2aXNpYmlsaXR5Q2hhbmdlKHZpc2liaWxpdHk6IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRjb25zb2xlLmxvZyhcIm5hdGl2ZSB2aXNpYmlsaXR5IGNoYW5nZVwiLCB2aXNpYmlsaXR5KVxuXHRcdHRoaXMuaXNBcHBWaXNpYmxlKHZpc2liaWxpdHkpXG5cblx0XHRpZiAodmlzaWJpbGl0eSkge1xuXHRcdFx0aWYgKHRoaXMuZGlzY29ubmVjdFRpbWVvdXRJZCAhPSBudWxsKSB7XG5cdFx0XHRcdGNsZWFyVGltZW91dCh0aGlzLmRpc2Nvbm5lY3RUaW1lb3V0SWQpXG5cdFx0XHRcdHRoaXMuZGlzY29ubmVjdFRpbWVvdXRJZCA9IG51bGxcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRoaXMuY29ubmVjdGl2aXR5TW9kZWwudHJ5UmVjb25uZWN0KGZhbHNlLCB0cnVlKVxuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLmRpc2Nvbm5lY3RUaW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0dGhpcy5jb25uZWN0aXZpdHlNb2RlbC5jbG9zZShDbG9zZUV2ZW50QnVzT3B0aW9uLlBhdXNlKVxuXHRcdFx0fSwgMzAgKiBTRUNPTkRfTVMpXG5cdFx0fVxuXHR9XG5cblx0YXN5bmMga2V5Ym9hcmRTaXplQ2hhbmdlZChuZXdTaXplOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRjb25zdCB7IHdpbmRvd0ZhY2FkZSB9ID0gYXdhaXQgaW1wb3J0KFwiLi4vLi4vbWlzYy9XaW5kb3dGYWNhZGUuanNcIilcblx0XHRyZXR1cm4gd2luZG93RmFjYWRlLm9uS2V5Ym9hcmRTaXplQ2hhbmdlZChuZXdTaXplKVxuXHR9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWNBLGtCQUFrQjtJQU1MLGtCQUFOLE1BQThDO0NBQ3BELEFBQVE7Q0FFUixBQUFRLGVBQWdDLDJCQUFPLE1BQU07Q0FFckQsWUFBNkJBLG1CQUFnRUMsZ0JBQXdCO0VBMEZySCxLQTFGNkI7RUEwRjVCLEtBMUY0RjtDQUEwQjtDQUV2SCxBQUFPLGtCQUFtQztBQUN6QyxTQUFPLEtBQUs7Q0FDWjtDQUVELE1BQU0sa0JBQW9DO0FBQ3pDLFFBQU0sUUFBUSxTQUFTO0VBQ3ZCLE1BQU0scUJBQXFCLEtBQUssTUFBTSxXQUFXO0FBRWpELE1BQUksb0JBQW9CO0FBRXZCLHNCQUFtQixVQUFVLFNBQVM7QUFDdEMsVUFBTztFQUNQLE9BQU07R0FFTixNQUFNLGFBQWEsT0FBTyxNQUFNLGFBQWEsaUJBQWlCO0dBRTlELE1BQU0sZUFBZSxnQkFBRSxNQUFNLEtBQUs7QUFHbEMsT0FBSSxjQUFjLFdBQVcsMkJBQTJCLEVBQUU7QUFDekQsZUFBVyxpQkFBaUI7QUFDNUIsV0FBTztHQUNQLFdBQVUsS0FBSyxpQ0FBaUMsQ0FDaEQsUUFBTztTQUVQLGNBQ0EsV0FBVyxrQkFBa0IsV0FBVyxlQUFlLElBQ3ZELE9BQU8sc0JBQXNCLElBQzdCLFdBQVcseUJBQXlCLEVBQ25DO0FBRUQsZUFBVyxxQkFBcUI7QUFDaEMsV0FBTztHQUNQLFdBQVUsYUFBYSxXQUFXLGdCQUFnQixFQUFFO0FBQ3BELFFBQUksUUFBUSxPQUFPLFdBQVcsaUJBQWlCLE9BQU87S0FDckQsTUFBTSxPQUFPLFFBQVEsTUFBTSxjQUFjLElBQUksT0FBTyxhQUFhLENBQUMsVUFBVSxHQUFHLEdBQUc7QUFDbEYscUJBQUUsTUFBTSxJQUFJLHlCQUF5QjtNQUNwQyxNQUFNLGlCQUFpQjtNQUN2QjtLQUNBLEVBQUM7QUFDRixZQUFPO0lBQ1A7QUFFRCxRQUFJLEtBQUssbUJBQW1CLGdCQUUzQixRQUFPO0tBQ0Q7QUFDTixxQkFBRSxNQUFNLElBQUksS0FBSyxlQUFlO0FBQ2hDLFlBQU87SUFDUDtHQUNELFdBQVUsYUFBYSxXQUFXLGdCQUFnQixJQUFJLGFBQWEsV0FBVyxnQkFBZ0IsSUFBSSxhQUFhLFdBQVcsY0FBYyxFQUFFO0FBRTFJLG9CQUFFLE1BQU0sSUFBSSxLQUFLLGVBQWU7QUFDaEMsV0FBTztHQUNQLE1BQ0EsUUFBTztFQUVSO0NBQ0Q7Q0FFRCxBQUFRLGtDQUEyQztFQUNsRCxNQUFNQyxjQUFtQyxPQUFPLE1BQU07QUFDdEQsU0FBTyxhQUFhLG9CQUFvQixRQUFRLFlBQVksa0JBQWtCO0NBQzlFO0NBRUQsTUFBTSxpQkFBaUJDLFlBQW9DO0FBQzFELFVBQVEsSUFBSSw0QkFBNEIsV0FBVztBQUNuRCxPQUFLLGFBQWEsV0FBVztBQUU3QixNQUFJLFlBQVk7QUFDZixPQUFJLEtBQUssdUJBQXVCLE1BQU07QUFDckMsaUJBQWEsS0FBSyxvQkFBb0I7QUFDdEMsU0FBSyxzQkFBc0I7R0FDM0I7QUFFRCxVQUFPLEtBQUssa0JBQWtCLGFBQWEsT0FBTyxLQUFLO0VBQ3ZELE1BQ0EsTUFBSyxzQkFBc0IsV0FBVyxNQUFNO0FBQzNDLFFBQUssa0JBQWtCLE1BQU0sb0JBQW9CLE1BQU07RUFDdkQsR0FBRSxLQUFLLFVBQVU7Q0FFbkI7Q0FFRCxNQUFNLG9CQUFvQkMsU0FBZ0M7RUFDekQsTUFBTSxFQUFFLGNBQWMsR0FBRyxNQUFNLE9BQU87QUFDdEMsU0FBTyxhQUFhLHNCQUFzQixRQUFRO0NBQ2xEO0FBQ0QifQ==