import { __toESM } from "./chunk-chunk.js";
import { LazyLoaded, SortedArray, pMap } from "./dist2-chunk.js";
import { lang } from "./LanguageViewModel-chunk.js";
import { OperationType } from "./TutanotaConstants-chunk.js";
import { getElementId, getEtId, isSameId } from "./EntityUtils-chunk.js";
import { EmailTemplateTypeRef, TemplateGroupRootTypeRef } from "./TypeRefs-chunk.js";
import { GroupInfoTypeRef, GroupTypeRef } from "./TypeRefs2-chunk.js";
import { require_stream } from "./stream-chunk.js";
import { isUpdateForTypeRef } from "./EntityUpdateUtils-chunk.js";

//#region src/common/api/common/utils/PlainTextSearch.ts
function search(queryString, entries, attributeNames, markHits = false) {
	entries = entries.map((e) => Object.assign({}, e));
	if (queryString) return _search(queryString, entries, attributeNames, markHits).filter((match) => match.matchedWords.length > 0).sort((a, b) => {
		if (a.completeMatch !== b.completeMatch) return b.completeMatch - a.completeMatch;
		if (a.matchedWords.length !== b.matchedWords.length) return b.matchedWords.length - a.matchedWords.length;
else if (a.fullWordMatches !== b.fullWordMatches) return b.fullWordMatches - a.fullWordMatches;
else if (a.partialWordMatches !== b.partialWordMatches) return b.partialWordMatches - a.partialWordMatches;
else return 0;
	}).map((match) => match.entry);
else return entries;
}
function _findMatchInEntry(nestedEntry, attributeName, queryString, queryWords, searchMatch, markHits) {
	const value = nestedEntry[attributeName];
	if (!value || typeof value !== "string") return;
	const splittedValue = value.split(/(<[^>]+>)/gi);
	const completeRegExp = new RegExp(escapeRegExp(queryString), "gi");
	searchMatch.completeMatch += _findMatches(splittedValue, completeRegExp, false).hits;
	const fullWordRegExp = new RegExp(queryWords.map((queryWord) => "\\b" + escapeRegExp(queryWord) + "\\b").join("|"), "gi");
	searchMatch.fullWordMatches += _findMatches(splittedValue, fullWordRegExp, false).hits;
	let regExp = new RegExp(queryWords.map((queryWord) => escapeRegExp(queryWord)).join("|"), "gi");
	let findResult = _findMatches(splittedValue, regExp, markHits);
	if (markHits && findResult.hits > 0) nestedEntry[attributeName] = splittedValue.join("");
	for (const queryWord of findResult.matchedQueryWords) if (searchMatch.matchedWords.indexOf(queryWord) === -1) searchMatch.matchedWords.push(queryWord);
	if (findResult.hits > 0) searchMatch.partialWordMatches += findResult.hits;
}
function _search(queryString, entries, attributeNames, markHits) {
	let queryWords = queryString.toLocaleLowerCase().split(" ").map((word) => word.trim()).filter((word) => word.length > 0);
	return entries.map((entry) => {
		const searchMatch = {
			entry,
			completeMatch: 0,
			fullWordMatches: 0,
			partialWordMatches: 0,
			matchedWords: []
		};
		for (const name of attributeNames) {
			const nestedAttributes = name.split(".");
			if (nestedAttributes.length === 1) _findMatchInEntry(entry, nestedAttributes[0], queryString, queryWords, searchMatch, markHits);
else if (nestedAttributes.length === 2) {
				const [nestedArrayName, nestedEntryAttributeName] = nestedAttributes;
				const nestedArray = entry[nestedArrayName];
				if (Array.isArray(nestedArray)) for (const nestedEntry of nestedArray) _findMatchInEntry(nestedEntry, nestedEntryAttributeName, queryString, queryWords, searchMatch, markHits);
			}
		}
		return searchMatch;
	});
}
function _findMatches(splittedValue, regExp, markHits) {
	return splittedValue.reduce((sum, value, index) => {
		if (value.trim().length === 0 || value.startsWith("<")) return sum;
		splittedValue[index] = value.replace(regExp, (match) => {
			sum.hits++;
			if (sum.matchedQueryWords.indexOf(match.toLowerCase()) === -1) sum.matchedQueryWords.push(match.toLowerCase());
			if (markHits && match.length > 2) return `<mark>${match}</mark>`;
else return match;
		});
		return sum;
	}, {
		hits: 0,
		matchedQueryWords: []
	});
}
function escapeRegExp(string) {
	return string.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
}

//#endregion
//#region src/mail-app/templates/model/TemplatePopupModel.ts
var import_stream = __toESM(require_stream(), 1);
const TEMPLATE_SHORTCUT_PREFIX = "#";
const SELECT_NEXT_TEMPLATE = "next";
const SELECT_PREV_TEMPLATE = "previous";
function compareTemplatesForSort(template1, template2) {
	const titleComparison = template1.title.localeCompare(template2.title);
	return titleComparison === 0 ? template1.tag.localeCompare(template2.tag) : titleComparison;
}
var TemplatePopupModel = class {
	_allTemplates;
	searchResults;
	selectedTemplate;
	initialized;
	_eventController;
	_entityEventReceived;
	_logins;
	_entityClient;
	_groupInstances;
	_selectedContentLanguage;
	_searchFilter;
	constructor(eventController, logins, entityClient) {
		this._eventController = eventController;
		this._logins = logins;
		this._entityClient = entityClient;
		this._allTemplates = SortedArray.empty(compareTemplatesForSort);
		this.searchResults = (0, import_stream.default)([]);
		this.selectedTemplate = (0, import_stream.default)(null);
		this._selectedContentLanguage = lang.code;
		this._searchFilter = new TemplateSearchFilter();
		this._groupInstances = [];
		this._entityEventReceived = (updates, eventOwnerGroupId) => {
			return this._entityUpdate(updates, eventOwnerGroupId);
		};
		this.initialized = new LazyLoaded(() => {
			const templateMemberships = this._logins.getUserController().getTemplateMemberships();
			return loadTemplateGroupInstances(templateMemberships, this._entityClient).then((templateGroupInstances) => loadTemplates(templateGroupInstances, this._entityClient).then((templates) => {
				this._allTemplates.insertAll(templates);
				this._groupInstances = templateGroupInstances;
			})).then(() => {
				this.searchResults(this._searchFilter.filter("", this._allTemplates.array));
				this.setSelectedTemplate(this.searchResults()[0]);
				return this;
			});
		});
		this._eventController.addEntityListener(this._entityEventReceived);
	}
	init() {
		return this.initialized.getAsync();
	}
	isLoaded() {
		return this.initialized.isLoaded();
	}
	dispose() {
		this._eventController.removeEntityListener(this._entityEventReceived);
	}
	isSelectedTemplate(template) {
		return this.selectedTemplate() === template;
	}
	getAllTemplates() {
		return this._allTemplates.array;
	}
	getSelectedTemplate() {
		return this.selectedTemplate();
	}
	getSelectedContent() {
		const selectedTemplate = this.selectedTemplate();
		return selectedTemplate && (selectedTemplate.contents.find((contents) => contents.languageCode === this._selectedContentLanguage) || selectedTemplate.contents.find((contents) => contents.languageCode === lang.code) || selectedTemplate.contents[0]);
	}
	getSelectedTemplateIndex() {
		const selectedTemplate = this.selectedTemplate();
		if (selectedTemplate == null) return -1;
		return this.searchResults().indexOf(selectedTemplate);
	}
	setSelectedTemplate(template) {
		this.selectedTemplate(template);
	}
	setSelectedContentLanguage(langCode) {
		this._selectedContentLanguage = langCode;
	}
	search(query) {
		this.searchResults(this._searchFilter.filter(query, this._allTemplates.array));
		this.setSelectedTemplate(this.searchResults()[0]);
	}
	_rerunSearch() {
		this.searchResults(this._searchFilter.rerunQuery(this._allTemplates.array));
		this.setSelectedTemplate(this.searchResults()[0]);
	}
	/**
	* Increments or decrements the selection, unless it would go past the beginning or end of the search results
	* @param action
	* @returns true if the selection changed
	*/
	selectNextTemplate(action) {
		const selectedIndex = this.getSelectedTemplateIndex();
		const nextIndex = selectedIndex + (action === SELECT_NEXT_TEMPLATE ? 1 : -1);
		if (nextIndex >= 0 && nextIndex < this.searchResults().length) {
			const nextSelectedTemplate = this.searchResults()[nextIndex];
			this.setSelectedTemplate(nextSelectedTemplate);
			return true;
		}
		return false;
	}
	findTemplateWithTag(selectedText) {
		const tag = selectedText.substring(TEMPLATE_SHORTCUT_PREFIX.length);
		return this._allTemplates.array.find((template) => template.tag === tag) ?? null;
	}
	_entityUpdate(updates, eventOwnerGroupId) {
		return pMap(updates, (update) => {
			if (isUpdateForTypeRef(EmailTemplateTypeRef, update)) {
				if (update.operation === OperationType.CREATE) return this._entityClient.load(EmailTemplateTypeRef, [update.instanceListId, update.instanceId]).then((template) => {
					this._allTemplates.insert(template);
					this._rerunSearch();
					this.setSelectedTemplate(template);
				});
else if (update.operation === OperationType.UPDATE) return this._entityClient.load(EmailTemplateTypeRef, [update.instanceListId, update.instanceId]).then((template) => {
					this._allTemplates.removeFirst((t) => isSameId(getElementId(t), update.instanceId));
					this._allTemplates.insert(template);
					this._rerunSearch();
					this.setSelectedTemplate(template);
				});
else if (update.operation === OperationType.DELETE) {
					if (!this.selectNextTemplate("next") && !this.selectNextTemplate("previous")) this.setSelectedTemplate(null);
					this._allTemplates.removeFirst((t) => isSameId(getElementId(t), update.instanceId));
					this._rerunSearch();
				}
			} else if (this._logins.getUserController().isUpdateForLoggedInUserInstance(update, eventOwnerGroupId)) {
				if (this._groupInstances.length !== this._logins.getUserController().getTemplateMemberships().length) {
					this.initialized.reset();
					return this.initialized.getAsync().then(() => this._rerunSearch());
				}
			}
		});
	}
	getTemplateGroupInstances() {
		return this._groupInstances;
	}
	getSelectedTemplateGroupInstance() {
		const selected = this.getSelectedTemplate();
		if (selected == null) return null;
else return this._groupInstances.find((instance) => isSameId(getEtId(instance.group), selected._ownerGroup)) ?? null;
	}
};
function loadTemplateGroupInstances(memberships, entityClient) {
	return pMap(memberships, (membership) => loadTemplateGroupInstance(membership, entityClient));
}
function loadTemplateGroupInstance(groupMembership, entityClient) {
	return entityClient.load(GroupInfoTypeRef, groupMembership.groupInfo).then((groupInfo) => entityClient.load(TemplateGroupRootTypeRef, groupInfo.group).then((groupRoot) => entityClient.load(GroupTypeRef, groupInfo.group).then((group) => {
		return {
			groupInfo,
			group,
			groupRoot,
			groupMembership
		};
	})));
}
function loadTemplates(templateGroups, entityClient) {
	return pMap(templateGroups, (group) => entityClient.loadAll(EmailTemplateTypeRef, group.groupRoot.templates)).then((groupedTemplates) => groupedTemplates.flat());
}
function searchInTemplates(input, allTemplates) {
	if (input.startsWith(TEMPLATE_SHORTCUT_PREFIX)) {
		const newQueryString = input.substring(TEMPLATE_SHORTCUT_PREFIX.length);
		return search(newQueryString, allTemplates, ["tag"], false);
	} else return search(input, allTemplates, [
		"tag",
		"title",
		"contents.text"
	], false);
}
var TemplateSearchFilter = class {
	lastInput;
	lastQuery;
	lastResults;
	constructor() {
		this.lastInput = [];
		this.lastQuery = "";
		this.lastResults = [];
	}
	filter(query, input) {
		return this._doFilter(query, input);
	}
	rerunQuery(input) {
		return this._doFilter(this.lastQuery, input);
	}
	_doFilter(query, input) {
		this.lastInput = input.slice();
		this.lastQuery = query;
		this.lastResults = query === "" ? this.lastInput : searchInTemplates(query, input);
		return this.lastResults;
	}
};

//#endregion
export { SELECT_NEXT_TEMPLATE, SELECT_PREV_TEMPLATE, TEMPLATE_SHORTCUT_PREFIX, TemplatePopupModel, loadTemplateGroupInstance, loadTemplateGroupInstances, search, searchInTemplates };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGVtcGxhdGVQb3B1cE1vZGVsLWNodW5rLmpzIiwibmFtZXMiOlsicXVlcnlTdHJpbmc6IHN0cmluZyIsImVudHJpZXM6IFJlYWRvbmx5QXJyYXk8VD4iLCJhdHRyaWJ1dGVOYW1lczogc3RyaW5nW10iLCJtYXJrSGl0czogYm9vbGVhbiIsIm5lc3RlZEVudHJ5OiBSZWNvcmQ8c3RyaW5nLCBhbnk+IiwiYXR0cmlidXRlTmFtZTogc3RyaW5nIiwicXVlcnlXb3JkczogQXJyYXk8c3RyaW5nPiIsInNlYXJjaE1hdGNoOiBTZWFyY2hNYXRjaDxUPiIsIm5lc3RlZEFycmF5OiBBcnJheTxSZWNvcmQ8c3RyaW5nLCBhbnk+PiIsInNwbGl0dGVkVmFsdWU6IEFycmF5PHN0cmluZz4iLCJyZWdFeHA6IFJlZ0V4cCIsInN0cmluZzogc3RyaW5nIiwidGVtcGxhdGUxOiBFbWFpbFRlbXBsYXRlIiwidGVtcGxhdGUyOiBFbWFpbFRlbXBsYXRlIiwiZXZlbnRDb250cm9sbGVyOiBFdmVudENvbnRyb2xsZXIiLCJsb2dpbnM6IExvZ2luQ29udHJvbGxlciIsImVudGl0eUNsaWVudDogRW50aXR5Q2xpZW50IiwidGVtcGxhdGU6IEVtYWlsVGVtcGxhdGUiLCJ0ZW1wbGF0ZTogRW1haWxUZW1wbGF0ZSB8IG51bGwiLCJsYW5nQ29kZTogTGFuZ3VhZ2VDb2RlIiwicXVlcnk6IHN0cmluZyIsImFjdGlvbjogTmF2QWN0aW9uIiwic2VsZWN0ZWRUZXh0OiBzdHJpbmciLCJ1cGRhdGVzOiBSZWFkb25seUFycmF5PEVudGl0eVVwZGF0ZURhdGE+IiwiZXZlbnRPd25lckdyb3VwSWQ6IElkIiwibWVtYmVyc2hpcHM6IEFycmF5PEdyb3VwTWVtYmVyc2hpcD4iLCJncm91cE1lbWJlcnNoaXA6IEdyb3VwTWVtYmVyc2hpcCIsInRlbXBsYXRlR3JvdXBzOiBBcnJheTxUZW1wbGF0ZUdyb3VwSW5zdGFuY2U+IiwiaW5wdXQ6IHN0cmluZyIsImFsbFRlbXBsYXRlczogUmVhZG9ubHlBcnJheTxFbWFpbFRlbXBsYXRlPiIsImlucHV0OiBSZWFkb25seUFycmF5PEVtYWlsVGVtcGxhdGU+Il0sInNvdXJjZXMiOlsiLi4vc3JjL2NvbW1vbi9hcGkvY29tbW9uL3V0aWxzL1BsYWluVGV4dFNlYXJjaC50cyIsIi4uL3NyYy9tYWlsLWFwcC90ZW1wbGF0ZXMvbW9kZWwvVGVtcGxhdGVQb3B1cE1vZGVsLnRzIl0sInNvdXJjZXNDb250ZW50IjpbInR5cGUgU2VhcmNoTWF0Y2g8VD4gPSB7XG5cdGVudHJ5OiBUXG5cdC8vIHRoZSBpbnB1dCBlbnRyeSBpbiB3aGljaCB3ZSBzZWFyY2hlc1xuXHRjb21wbGV0ZU1hdGNoOiBudW1iZXJcblx0Ly90aGUgbnVtYmVyIG9mIG9jY3VyZW5jZXMgb2YgdGhlIGVudGlyZSBxdWVyeVN0cmluZyBpbiB0aGUgc2VhcmNoZWQgZW50cnlcblx0ZnVsbFdvcmRNYXRjaGVzOiBudW1iZXJcblx0Ly90aGUgbnVtYmVyIG9mIG9jY3VyZW5jZXMgb2YgYW55IHF1ZXJ5V29yZCBmcm9tIHRoZSBzcGxpdHRlZCBxdWVyeVN0cmluZ1xuXHRwYXJ0aWFsV29yZE1hdGNoZXM6IG51bWJlclxuXHQvLyB0aGUgbnVtYmVyIG9mIG9jY3VyZW5jZXMgYSBxdWVyeVdvcmQgaXMgcGFydCBvZiB0aGUgc2VhcmNoZWQgZW50cnlcblx0bWF0Y2hlZFdvcmRzOiBBcnJheTxzdHJpbmc+IC8vYWxsIGRpc3RpbmN0IHF1ZXJ5V29yZHMgdGhhdCB3ZXJlIGZvdW5kXG59XG5cbi8qKlxuICogQHBhcmFtIHF1ZXJ5U3RyaW5nIExpc3Qgb2YgcXVlcnkgd29yZHMgc2VwYXJhdGVkIGJ5IHdoaXRlc3BhY2VcbiAqIEBwYXJhbSBlbnRyaWVzIFBsYWluIHRleHQgZW50cmllcyB0byBzZWFyY2ggaW4uXG4gKiBAcGFyYW0gYXR0cmlidXRlTmFtZXMgVGhlIGF0dHJpYnV0ZXMgdGhhdCBhcmUgc2VhcmNoZWQgd2l0aGluIGVudHJpZXMuIFRoZSBsaXN0IHNob3VsZCBiZSBzb3J0ZWQgYnkgcHJpb3JpdHlcbiAqIEBwYXJhbSBtYXJrSGl0cyBJZiBzZXQgdG8gdHJ1ZSB0aGUgaGl0cyB3aWxsIGJlIG1hcmtlZCB3aXRoIGh0bWwgdGFnIDxtYXJrPlxuICogQHJldHVybnMgYSBsaXN0IG9mIGVudHJpZXMsIHNvcnRlZCBieSBwcmlvcml0eSwgdGhhdCBtYXRjaCB0aGUgcXVlcnkgc3RyaW5nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZWFyY2g8VCBleHRlbmRzIFJlY29yZDxzdHJpbmcsIGFueT4+KFxuXHRxdWVyeVN0cmluZzogc3RyaW5nLFxuXHRlbnRyaWVzOiBSZWFkb25seUFycmF5PFQ+LFxuXHRhdHRyaWJ1dGVOYW1lczogc3RyaW5nW10sXG5cdG1hcmtIaXRzOiBib29sZWFuID0gZmFsc2UsXG4pOiBSZWFkb25seUFycmF5PFQ+IHtcblx0ZW50cmllcyA9IGVudHJpZXMubWFwKChlKSA9PiBPYmplY3QuYXNzaWduKHt9LCBlKSkgLy8gY3JlYXRlIGEgY29weSBpbiBvcmRlciB0byBub3Qgb3ZlcnJpZGUgdGhlIG9yaWdpbmFsIHZhbHVlc1xuXG5cdGlmIChxdWVyeVN0cmluZykge1xuXHRcdHJldHVybiBfc2VhcmNoPFQ+KHF1ZXJ5U3RyaW5nLCBlbnRyaWVzLCBhdHRyaWJ1dGVOYW1lcywgbWFya0hpdHMpXG5cdFx0XHQuZmlsdGVyKChtYXRjaCkgPT4gbWF0Y2gubWF0Y2hlZFdvcmRzLmxlbmd0aCA+IDApIC8vIGEgYW5kIGJlIGFyZSB0d28gbWF0Y2hlcyB0aGF0IHJlZmVyIHRvIGVudHJpZXMgKGUuZy4gZmFxcylcblx0XHRcdC5zb3J0KChhLCBiKSA9PiB7XG5cdFx0XHRcdGlmIChhLmNvbXBsZXRlTWF0Y2ggIT09IGIuY29tcGxldGVNYXRjaCkge1xuXHRcdFx0XHRcdHJldHVybiBiLmNvbXBsZXRlTWF0Y2ggLSBhLmNvbXBsZXRlTWF0Y2hcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChhLm1hdGNoZWRXb3Jkcy5sZW5ndGggIT09IGIubWF0Y2hlZFdvcmRzLmxlbmd0aCkge1xuXHRcdFx0XHRcdHJldHVybiBiLm1hdGNoZWRXb3Jkcy5sZW5ndGggLSBhLm1hdGNoZWRXb3Jkcy5sZW5ndGhcblx0XHRcdFx0fSBlbHNlIGlmIChhLmZ1bGxXb3JkTWF0Y2hlcyAhPT0gYi5mdWxsV29yZE1hdGNoZXMpIHtcblx0XHRcdFx0XHRyZXR1cm4gYi5mdWxsV29yZE1hdGNoZXMgLSBhLmZ1bGxXb3JkTWF0Y2hlc1xuXHRcdFx0XHR9IGVsc2UgaWYgKGEucGFydGlhbFdvcmRNYXRjaGVzICE9PSBiLnBhcnRpYWxXb3JkTWF0Y2hlcykge1xuXHRcdFx0XHRcdHJldHVybiBiLnBhcnRpYWxXb3JkTWF0Y2hlcyAtIGEucGFydGlhbFdvcmRNYXRjaGVzXG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuIDBcblx0XHRcdFx0fVxuXHRcdFx0fSlcblx0XHRcdC5tYXAoKG1hdGNoKSA9PiBtYXRjaC5lbnRyeSlcblx0fSBlbHNlIHtcblx0XHRyZXR1cm4gZW50cmllc1xuXHR9XG59XG5cbmZ1bmN0aW9uIF9maW5kTWF0Y2hJbkVudHJ5PFQ+KFxuXHRuZXN0ZWRFbnRyeTogUmVjb3JkPHN0cmluZywgYW55Pixcblx0YXR0cmlidXRlTmFtZTogc3RyaW5nLFxuXHRxdWVyeVN0cmluZzogc3RyaW5nLFxuXHRxdWVyeVdvcmRzOiBBcnJheTxzdHJpbmc+LFxuXHRzZWFyY2hNYXRjaDogU2VhcmNoTWF0Y2g8VD4sXG5cdG1hcmtIaXRzOiBib29sZWFuLFxuKSB7XG5cdGNvbnN0IHZhbHVlID0gbmVzdGVkRW50cnlbYXR0cmlidXRlTmFtZV1cblxuXHRpZiAoIXZhbHVlIHx8IHR5cGVvZiB2YWx1ZSAhPT0gXCJzdHJpbmdcIikge1xuXHRcdHJldHVyblxuXHR9XG5cblx0Y29uc3Qgc3BsaXR0ZWRWYWx1ZSA9IHZhbHVlLnNwbGl0KC8oPFtePl0rPikvZ2kpIC8vIHdlIHNwbGl0IHRoZSBhcnJheSBpbnRvIHdvcmRzIHRoYXQgYXJlIGh0bWwgbWFya3VwIGFuZCBub24gaHRtbCBtYXJrdXAgd29yZHMgYXMgd2UgZG9uJ3Qgd2FudCB0byBzZWFyY2ggaW4gaHRtbCB0YWdzXG5cblx0Ly8gZmluZCBhbGwgbWF0Y2hlcyB3aXRoIHRoZSBmdWxsIGFuZCBleGFjdCBxdWVyeVN0cmluZ1xuXHRjb25zdCBjb21wbGV0ZVJlZ0V4cCA9IG5ldyBSZWdFeHAoZXNjYXBlUmVnRXhwKHF1ZXJ5U3RyaW5nKSwgXCJnaVwiKVxuXHRzZWFyY2hNYXRjaC5jb21wbGV0ZU1hdGNoICs9IF9maW5kTWF0Y2hlcyhzcGxpdHRlZFZhbHVlLCBjb21wbGV0ZVJlZ0V4cCwgZmFsc2UpLmhpdHNcblx0Ly8gY3JlYXRlIHJlZ3VhbGFyIGV4cHJlc3Npb24gdG8gbWF0Y2ggd2hvbGUgd29yZHMsIGNhc2UgaW5zZW5zaXRpdmVcblx0Y29uc3QgZnVsbFdvcmRSZWdFeHAgPSBuZXcgUmVnRXhwKHF1ZXJ5V29yZHMubWFwKChxdWVyeVdvcmQpID0+IFwiXFxcXGJcIiArIGVzY2FwZVJlZ0V4cChxdWVyeVdvcmQpICsgXCJcXFxcYlwiKS5qb2luKFwifFwiKSwgXCJnaVwiKVxuXHRzZWFyY2hNYXRjaC5mdWxsV29yZE1hdGNoZXMgKz0gX2ZpbmRNYXRjaGVzKHNwbGl0dGVkVmFsdWUsIGZ1bGxXb3JkUmVnRXhwLCBmYWxzZSkuaGl0c1xuXHQvLyByZWd1bGFyIGV4cHJlc3Npb24gZm9yIGZpbmRpbmcgYWxsIG1hdGNoZXMgKGluY2x1ZGluZyBwYXJ0aWFsIG1hdGNoZXMpXG5cdGxldCByZWdFeHAgPSBuZXcgUmVnRXhwKHF1ZXJ5V29yZHMubWFwKChxdWVyeVdvcmQpID0+IGVzY2FwZVJlZ0V4cChxdWVyeVdvcmQpKS5qb2luKFwifFwiKSwgXCJnaVwiKVxuXG5cdGxldCBmaW5kUmVzdWx0ID0gX2ZpbmRNYXRjaGVzKHNwbGl0dGVkVmFsdWUsIHJlZ0V4cCwgbWFya0hpdHMpXG5cblx0aWYgKG1hcmtIaXRzICYmIGZpbmRSZXN1bHQuaGl0cyA+IDApIHtcblx0XHRuZXN0ZWRFbnRyeVthdHRyaWJ1dGVOYW1lXSA9IHNwbGl0dGVkVmFsdWUuam9pbihcIlwiKVxuXHR9XG5cblx0Zm9yIChjb25zdCBxdWVyeVdvcmQgb2YgZmluZFJlc3VsdC5tYXRjaGVkUXVlcnlXb3Jkcykge1xuXHRcdGlmIChzZWFyY2hNYXRjaC5tYXRjaGVkV29yZHMuaW5kZXhPZihxdWVyeVdvcmQpID09PSAtMSkge1xuXHRcdFx0c2VhcmNoTWF0Y2gubWF0Y2hlZFdvcmRzLnB1c2gocXVlcnlXb3JkKVxuXHRcdH1cblx0fVxuXG5cdGlmIChmaW5kUmVzdWx0LmhpdHMgPiAwKSB7XG5cdFx0c2VhcmNoTWF0Y2gucGFydGlhbFdvcmRNYXRjaGVzICs9IGZpbmRSZXN1bHQuaGl0c1xuXHR9XG59XG5cbi8vZXhwb3J0IG9ubHkgZm9yIHRlc3RpbmdcbmV4cG9ydCBmdW5jdGlvbiBfc2VhcmNoPFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+Pihcblx0cXVlcnlTdHJpbmc6IHN0cmluZyxcblx0ZW50cmllczogUmVhZG9ubHlBcnJheTxUPixcblx0YXR0cmlidXRlTmFtZXM6IHN0cmluZ1tdLFxuXHRtYXJrSGl0czogYm9vbGVhbixcbik6IFNlYXJjaE1hdGNoPFQ+W10ge1xuXHRsZXQgcXVlcnlXb3JkcyA9IHF1ZXJ5U3RyaW5nXG5cdFx0LnRvTG9jYWxlTG93ZXJDYXNlKClcblx0XHQuc3BsaXQoXCIgXCIpXG5cdFx0Lm1hcCgod29yZCkgPT4gd29yZC50cmltKCkpXG5cdFx0LmZpbHRlcigod29yZCkgPT4gd29yZC5sZW5ndGggPiAwKVxuXHRyZXR1cm4gZW50cmllcy5tYXAoKGVudHJ5KSA9PiB7XG5cdFx0Y29uc3Qgc2VhcmNoTWF0Y2ggPSB7XG5cdFx0XHRlbnRyeSxcblx0XHRcdGNvbXBsZXRlTWF0Y2g6IDAsXG5cdFx0XHRmdWxsV29yZE1hdGNoZXM6IDAsXG5cdFx0XHRwYXJ0aWFsV29yZE1hdGNoZXM6IDAsXG5cdFx0XHRtYXRjaGVkV29yZHM6IFtdLFxuXHRcdH1cblx0XHRmb3IgKGNvbnN0IG5hbWUgb2YgYXR0cmlidXRlTmFtZXMpIHtcblx0XHRcdGNvbnN0IG5lc3RlZEF0dHJpYnV0ZXMgPSBuYW1lLnNwbGl0KFwiLlwiKVxuXHRcdFx0aWYgKG5lc3RlZEF0dHJpYnV0ZXMubGVuZ3RoID09PSAxKSB7XG5cdFx0XHRcdC8vIG5vIG5lc3RpbmcgcmVndWxhciB2YWx1ZSBjaGVja1xuXHRcdFx0XHRfZmluZE1hdGNoSW5FbnRyeShlbnRyeSwgbmVzdGVkQXR0cmlidXRlc1swXSwgcXVlcnlTdHJpbmcsIHF1ZXJ5V29yZHMsIHNlYXJjaE1hdGNoLCBtYXJrSGl0cylcblx0XHRcdH0gZWxzZSBpZiAobmVzdGVkQXR0cmlidXRlcy5sZW5ndGggPT09IDIpIHtcblx0XHRcdFx0Ly8gV2Ugb25seSBhY2NlcHQgYXJyYXlzIHRoYXQgY29udGFpbiBvYmplY3RzIGZvciBub3cuXG5cdFx0XHRcdGNvbnN0IFtuZXN0ZWRBcnJheU5hbWUsIG5lc3RlZEVudHJ5QXR0cmlidXRlTmFtZV0gPSBuZXN0ZWRBdHRyaWJ1dGVzXG5cdFx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdFx0Y29uc3QgbmVzdGVkQXJyYXk6IEFycmF5PFJlY29yZDxzdHJpbmcsIGFueT4+ID0gZW50cnlbbmVzdGVkQXJyYXlOYW1lXVxuXG5cdFx0XHRcdGlmIChBcnJheS5pc0FycmF5KG5lc3RlZEFycmF5KSkge1xuXHRcdFx0XHRcdGZvciAoY29uc3QgbmVzdGVkRW50cnkgb2YgbmVzdGVkQXJyYXkpIHtcblx0XHRcdFx0XHRcdF9maW5kTWF0Y2hJbkVudHJ5KG5lc3RlZEVudHJ5LCBuZXN0ZWRFbnRyeUF0dHJpYnV0ZU5hbWUsIHF1ZXJ5U3RyaW5nLCBxdWVyeVdvcmRzLCBzZWFyY2hNYXRjaCwgbWFya0hpdHMpXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiBzZWFyY2hNYXRjaFxuXHR9KVxufVxuXG50eXBlIEZpbmRSZXN1bHQgPSB7XG5cdGhpdHM6IG51bWJlclxuXHRtYXRjaGVkUXVlcnlXb3Jkczogc3RyaW5nW11cbn1cblxuLy9leHBvcnQgZm9yIHRlc3Rpbmcgb25seVxuZXhwb3J0IGZ1bmN0aW9uIF9maW5kTWF0Y2hlcyhzcGxpdHRlZFZhbHVlOiBBcnJheTxzdHJpbmc+LCByZWdFeHA6IFJlZ0V4cCwgbWFya0hpdHM6IGJvb2xlYW4pOiBGaW5kUmVzdWx0IHtcblx0cmV0dXJuIHNwbGl0dGVkVmFsdWUucmVkdWNlKFxuXHRcdChzdW0sIHZhbHVlLCBpbmRleCkgPT4ge1xuXHRcdFx0aWYgKHZhbHVlLnRyaW0oKS5sZW5ndGggPT09IDAgfHwgdmFsdWUuc3RhcnRzV2l0aChcIjxcIikpIHtcblx0XHRcdFx0cmV0dXJuIHN1bVxuXHRcdFx0fVxuXG5cdFx0XHRzcGxpdHRlZFZhbHVlW2luZGV4XSA9IHZhbHVlLnJlcGxhY2UocmVnRXhwLCAobWF0Y2gpID0+IHtcblx0XHRcdFx0c3VtLmhpdHMrK1xuXG5cdFx0XHRcdGlmIChzdW0ubWF0Y2hlZFF1ZXJ5V29yZHMuaW5kZXhPZihtYXRjaC50b0xvd2VyQ2FzZSgpKSA9PT0gLTEpIHtcblx0XHRcdFx0XHRzdW0ubWF0Y2hlZFF1ZXJ5V29yZHMucHVzaChtYXRjaC50b0xvd2VyQ2FzZSgpKVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKG1hcmtIaXRzICYmIG1hdGNoLmxlbmd0aCA+IDIpIHtcblx0XHRcdFx0XHQvLyBvbmx5IG1hcmsgbWF0Y2hlcyB0aGF0IGFyZSBsb25nZXIgdGhlbiB0d28gY2hhcmFjdGVycy5cblx0XHRcdFx0XHQvLyBXZSBjb3VsZCBtYXJrIHRoZXNlIHNtYWxsIG1hdGNoZXMgYnV0IHdlIHNob3VsZCBjaGVjayB0aGF0IHRoZSBtYXRjaCBpcyBhIHdob2xlIHdvcmQgdGhlbi5cblx0XHRcdFx0XHRyZXR1cm4gYDxtYXJrPiR7bWF0Y2h9PC9tYXJrPmBcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRyZXR1cm4gbWF0Y2hcblx0XHRcdFx0fVxuXHRcdFx0fSlcblx0XHRcdHJldHVybiBzdW1cblx0XHR9LFxuXHRcdHtcblx0XHRcdGhpdHM6IDAsXG5cdFx0XHRtYXRjaGVkUXVlcnlXb3JkczogW10gYXMgc3RyaW5nW10sXG5cdFx0fSxcblx0KVxufVxuXG4vLyBzZWUgaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzY5Njk0ODZcbmZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHJpbmc6IHN0cmluZyk6IHN0cmluZyB7XG5cdHJldHVybiBzdHJpbmcucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xcXVxcXFxdL2csIFwiXFxcXCQmXCIpIC8vICQmIG1lYW5zIHRoZSB3aG9sZSBtYXRjaGVkIHN0cmluZ1xufVxuIiwiaW1wb3J0IHR5cGUgeyBMYW5ndWFnZUNvZGUgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL21pc2MvTGFuZ3VhZ2VWaWV3TW9kZWxcIlxuaW1wb3J0IHsgbGFuZyB9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vbWlzYy9MYW5ndWFnZVZpZXdNb2RlbFwiXG5pbXBvcnQgdHlwZSB7IEVtYWlsVGVtcGxhdGVDb250ZW50IH0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9hcGkvZW50aXRpZXMvdHV0YW5vdGEvVHlwZVJlZnMuanNcIlxuaW1wb3J0IHsgRW1haWxUZW1wbGF0ZSwgRW1haWxUZW1wbGF0ZVR5cGVSZWYsIFRlbXBsYXRlR3JvdXBSb290VHlwZVJlZiB9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vYXBpL2VudGl0aWVzL3R1dGFub3RhL1R5cGVSZWZzLmpzXCJcbmltcG9ydCB7IE9wZXJhdGlvblR5cGUgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2FwaS9jb21tb24vVHV0YW5vdGFDb25zdGFudHNcIlxuaW1wb3J0IHN0cmVhbSBmcm9tIFwibWl0aHJpbC9zdHJlYW1cIlxuaW1wb3J0IFN0cmVhbSBmcm9tIFwibWl0aHJpbC9zdHJlYW1cIlxuaW1wb3J0IHR5cGUgeyBFbnRpdHlDbGllbnQgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2FwaS9jb21tb24vRW50aXR5Q2xpZW50XCJcbmltcG9ydCB0eXBlIHsgTG9naW5Db250cm9sbGVyIH0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9hcGkvbWFpbi9Mb2dpbkNvbnRyb2xsZXJcIlxuaW1wb3J0IHsgZ2V0RWxlbWVudElkLCBnZXRFdElkLCBpc1NhbWVJZCB9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vYXBpL2NvbW1vbi91dGlscy9FbnRpdHlVdGlsc1wiXG5pbXBvcnQgdHlwZSB7IEdyb3VwTWVtYmVyc2hpcCB9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vYXBpL2VudGl0aWVzL3N5cy9UeXBlUmVmcy5qc1wiXG5pbXBvcnQgeyBHcm91cEluZm9UeXBlUmVmLCBHcm91cFR5cGVSZWYgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2FwaS9lbnRpdGllcy9zeXMvVHlwZVJlZnMuanNcIlxuaW1wb3J0IHsgTGF6eUxvYWRlZCwgcHJvbWlzZU1hcCwgU29ydGVkQXJyYXkgfSBmcm9tIFwiQHR1dGFvL3R1dGFub3RhLXV0aWxzXCJcbmltcG9ydCB0eXBlIHsgVGVtcGxhdGVHcm91cEluc3RhbmNlIH0gZnJvbSBcIi4vVGVtcGxhdGVHcm91cE1vZGVsLmpzXCJcbmltcG9ydCB7IHNlYXJjaCB9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vYXBpL2NvbW1vbi91dGlscy9QbGFpblRleHRTZWFyY2guanNcIlxuaW1wb3J0IHsgRW50aXR5RXZlbnRzTGlzdGVuZXIsIEV2ZW50Q29udHJvbGxlciB9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vYXBpL21haW4vRXZlbnRDb250cm9sbGVyLmpzXCJcbmltcG9ydCB7IEVudGl0eVVwZGF0ZURhdGEsIGlzVXBkYXRlRm9yVHlwZVJlZiB9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vYXBpL2NvbW1vbi91dGlscy9FbnRpdHlVcGRhdGVVdGlscy5qc1wiXG5cbi8qKlxuICogICBNb2RlbCB0aGF0IGhvbGRzIG1haW4gbG9naWMgZm9yIHRoZSBUZW1wbGF0ZSBGZWF0dXJlLlxuICogICBIYW5kbGVzIHRoaW5ncyBsaWtlIHJldHVybmluZyB0aGUgc2VsZWN0ZWQgVGVtcGxhdGUsIHNlbGVjdGluZyBUZW1wbGF0ZXMsIGluZGV4ZXMsIHNjcm9sbGluZy5cbiAqL1xuZXhwb3J0IGNvbnN0IFRFTVBMQVRFX1NIT1JUQ1VUX1BSRUZJWCA9IFwiI1wiXG5leHBvcnQgdHlwZSBOYXZBY3Rpb24gPSBcInByZXZpb3VzXCIgfCBcIm5leHRcIlxuZXhwb3J0IGNvbnN0IFNFTEVDVF9ORVhUX1RFTVBMQVRFID0gXCJuZXh0XCJcbmV4cG9ydCBjb25zdCBTRUxFQ1RfUFJFVl9URU1QTEFURSA9IFwicHJldmlvdXNcIlxuXG4vLyBzb3J0IGZpcnN0IGJ5IG5hbWUgdGhlbiBieSB0YWdcbmZ1bmN0aW9uIGNvbXBhcmVUZW1wbGF0ZXNGb3JTb3J0KHRlbXBsYXRlMTogRW1haWxUZW1wbGF0ZSwgdGVtcGxhdGUyOiBFbWFpbFRlbXBsYXRlKSB7XG5cdGNvbnN0IHRpdGxlQ29tcGFyaXNvbiA9IHRlbXBsYXRlMS50aXRsZS5sb2NhbGVDb21wYXJlKHRlbXBsYXRlMi50aXRsZSlcblx0cmV0dXJuIHRpdGxlQ29tcGFyaXNvbiA9PT0gMCA/IHRlbXBsYXRlMS50YWcubG9jYWxlQ29tcGFyZSh0ZW1wbGF0ZTIudGFnKSA6IHRpdGxlQ29tcGFyaXNvblxufVxuXG5leHBvcnQgY2xhc3MgVGVtcGxhdGVQb3B1cE1vZGVsIHtcblx0X2FsbFRlbXBsYXRlczogU29ydGVkQXJyYXk8RW1haWxUZW1wbGF0ZT5cblx0cmVhZG9ubHkgc2VhcmNoUmVzdWx0czogU3RyZWFtPFJlYWRvbmx5QXJyYXk8RW1haWxUZW1wbGF0ZT4+XG5cdHJlYWRvbmx5IHNlbGVjdGVkVGVtcGxhdGU6IFN0cmVhbTxFbWFpbFRlbXBsYXRlIHwgbnVsbD5cblx0aW5pdGlhbGl6ZWQ6IExhenlMb2FkZWQ8VGVtcGxhdGVQb3B1cE1vZGVsPlxuXHRyZWFkb25seSBfZXZlbnRDb250cm9sbGVyOiBFdmVudENvbnRyb2xsZXJcblx0cmVhZG9ubHkgX2VudGl0eUV2ZW50UmVjZWl2ZWQ6IEVudGl0eUV2ZW50c0xpc3RlbmVyXG5cdHJlYWRvbmx5IF9sb2dpbnM6IExvZ2luQ29udHJvbGxlclxuXHRyZWFkb25seSBfZW50aXR5Q2xpZW50OiBFbnRpdHlDbGllbnRcblx0X2dyb3VwSW5zdGFuY2VzOiBBcnJheTxUZW1wbGF0ZUdyb3VwSW5zdGFuY2U+XG5cdF9zZWxlY3RlZENvbnRlbnRMYW5ndWFnZTogTGFuZ3VhZ2VDb2RlXG5cdF9zZWFyY2hGaWx0ZXI6IFRlbXBsYXRlU2VhcmNoRmlsdGVyXG5cblx0Y29uc3RydWN0b3IoZXZlbnRDb250cm9sbGVyOiBFdmVudENvbnRyb2xsZXIsIGxvZ2luczogTG9naW5Db250cm9sbGVyLCBlbnRpdHlDbGllbnQ6IEVudGl0eUNsaWVudCkge1xuXHRcdHRoaXMuX2V2ZW50Q29udHJvbGxlciA9IGV2ZW50Q29udHJvbGxlclxuXHRcdHRoaXMuX2xvZ2lucyA9IGxvZ2luc1xuXHRcdHRoaXMuX2VudGl0eUNsaWVudCA9IGVudGl0eUNsaWVudFxuXHRcdHRoaXMuX2FsbFRlbXBsYXRlcyA9IFNvcnRlZEFycmF5LmVtcHR5KGNvbXBhcmVUZW1wbGF0ZXNGb3JTb3J0KVxuXHRcdHRoaXMuc2VhcmNoUmVzdWx0cyA9IHN0cmVhbTxSZWFkb25seUFycmF5PEVtYWlsVGVtcGxhdGU+PihbXSlcblx0XHR0aGlzLnNlbGVjdGVkVGVtcGxhdGUgPSBzdHJlYW08RW1haWxUZW1wbGF0ZSB8IG51bGw+KG51bGwpXG5cdFx0dGhpcy5fc2VsZWN0ZWRDb250ZW50TGFuZ3VhZ2UgPSBsYW5nLmNvZGVcblx0XHR0aGlzLl9zZWFyY2hGaWx0ZXIgPSBuZXcgVGVtcGxhdGVTZWFyY2hGaWx0ZXIoKVxuXHRcdHRoaXMuX2dyb3VwSW5zdGFuY2VzID0gW11cblxuXHRcdHRoaXMuX2VudGl0eUV2ZW50UmVjZWl2ZWQgPSAodXBkYXRlcywgZXZlbnRPd25lckdyb3VwSWQpID0+IHtcblx0XHRcdHJldHVybiB0aGlzLl9lbnRpdHlVcGRhdGUodXBkYXRlcywgZXZlbnRPd25lckdyb3VwSWQpXG5cdFx0fVxuXG5cdFx0dGhpcy5pbml0aWFsaXplZCA9IG5ldyBMYXp5TG9hZGVkKCgpID0+IHtcblx0XHRcdGNvbnN0IHRlbXBsYXRlTWVtYmVyc2hpcHMgPSB0aGlzLl9sb2dpbnMuZ2V0VXNlckNvbnRyb2xsZXIoKS5nZXRUZW1wbGF0ZU1lbWJlcnNoaXBzKClcblxuXHRcdFx0cmV0dXJuIGxvYWRUZW1wbGF0ZUdyb3VwSW5zdGFuY2VzKHRlbXBsYXRlTWVtYmVyc2hpcHMsIHRoaXMuX2VudGl0eUNsaWVudClcblx0XHRcdFx0LnRoZW4oKHRlbXBsYXRlR3JvdXBJbnN0YW5jZXMpID0+XG5cdFx0XHRcdFx0bG9hZFRlbXBsYXRlcyh0ZW1wbGF0ZUdyb3VwSW5zdGFuY2VzLCB0aGlzLl9lbnRpdHlDbGllbnQpLnRoZW4oKHRlbXBsYXRlcykgPT4ge1xuXHRcdFx0XHRcdFx0dGhpcy5fYWxsVGVtcGxhdGVzLmluc2VydEFsbCh0ZW1wbGF0ZXMpXG5cblx0XHRcdFx0XHRcdHRoaXMuX2dyb3VwSW5zdGFuY2VzID0gdGVtcGxhdGVHcm91cEluc3RhbmNlc1xuXHRcdFx0XHRcdH0pLFxuXHRcdFx0XHQpXG5cdFx0XHRcdC50aGVuKCgpID0+IHtcblx0XHRcdFx0XHR0aGlzLnNlYXJjaFJlc3VsdHModGhpcy5fc2VhcmNoRmlsdGVyLmZpbHRlcihcIlwiLCB0aGlzLl9hbGxUZW1wbGF0ZXMuYXJyYXkpKVxuXHRcdFx0XHRcdHRoaXMuc2V0U2VsZWN0ZWRUZW1wbGF0ZSh0aGlzLnNlYXJjaFJlc3VsdHMoKVswXSlcblx0XHRcdFx0XHRyZXR1cm4gdGhpc1xuXHRcdFx0XHR9KVxuXHRcdH0pXG5cblx0XHR0aGlzLl9ldmVudENvbnRyb2xsZXIuYWRkRW50aXR5TGlzdGVuZXIodGhpcy5fZW50aXR5RXZlbnRSZWNlaXZlZClcblx0fVxuXG5cdGluaXQoKTogUHJvbWlzZTxUZW1wbGF0ZVBvcHVwTW9kZWw+IHtcblx0XHRyZXR1cm4gdGhpcy5pbml0aWFsaXplZC5nZXRBc3luYygpXG5cdH1cblxuXHRpc0xvYWRlZCgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdGhpcy5pbml0aWFsaXplZC5pc0xvYWRlZCgpXG5cdH1cblxuXHRkaXNwb3NlKCkge1xuXHRcdHRoaXMuX2V2ZW50Q29udHJvbGxlci5yZW1vdmVFbnRpdHlMaXN0ZW5lcih0aGlzLl9lbnRpdHlFdmVudFJlY2VpdmVkKVxuXHR9XG5cblx0aXNTZWxlY3RlZFRlbXBsYXRlKHRlbXBsYXRlOiBFbWFpbFRlbXBsYXRlKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VsZWN0ZWRUZW1wbGF0ZSgpID09PSB0ZW1wbGF0ZVxuXHR9XG5cblx0Z2V0QWxsVGVtcGxhdGVzKCk6IFJlYWRvbmx5QXJyYXk8RW1haWxUZW1wbGF0ZT4ge1xuXHRcdHJldHVybiB0aGlzLl9hbGxUZW1wbGF0ZXMuYXJyYXlcblx0fVxuXG5cdGdldFNlbGVjdGVkVGVtcGxhdGUoKTogRW1haWxUZW1wbGF0ZSB8IG51bGwge1xuXHRcdHJldHVybiB0aGlzLnNlbGVjdGVkVGVtcGxhdGUoKVxuXHR9XG5cblx0Z2V0U2VsZWN0ZWRDb250ZW50KCk6IEVtYWlsVGVtcGxhdGVDb250ZW50IHwgbnVsbCB7XG5cdFx0Y29uc3Qgc2VsZWN0ZWRUZW1wbGF0ZSA9IHRoaXMuc2VsZWN0ZWRUZW1wbGF0ZSgpXG5cdFx0cmV0dXJuIChcblx0XHRcdHNlbGVjdGVkVGVtcGxhdGUgJiZcblx0XHRcdChzZWxlY3RlZFRlbXBsYXRlLmNvbnRlbnRzLmZpbmQoKGNvbnRlbnRzKSA9PiBjb250ZW50cy5sYW5ndWFnZUNvZGUgPT09IHRoaXMuX3NlbGVjdGVkQ29udGVudExhbmd1YWdlKSB8fFxuXHRcdFx0XHRzZWxlY3RlZFRlbXBsYXRlLmNvbnRlbnRzLmZpbmQoKGNvbnRlbnRzKSA9PiBjb250ZW50cy5sYW5ndWFnZUNvZGUgPT09IGxhbmcuY29kZSkgfHxcblx0XHRcdFx0c2VsZWN0ZWRUZW1wbGF0ZS5jb250ZW50c1swXSlcblx0XHQpXG5cdH1cblxuXHRnZXRTZWxlY3RlZFRlbXBsYXRlSW5kZXgoKTogbnVtYmVyIHtcblx0XHRjb25zdCBzZWxlY3RlZFRlbXBsYXRlID0gdGhpcy5zZWxlY3RlZFRlbXBsYXRlKClcblx0XHRpZiAoc2VsZWN0ZWRUZW1wbGF0ZSA9PSBudWxsKSB7XG5cdFx0XHRyZXR1cm4gLTFcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuc2VhcmNoUmVzdWx0cygpLmluZGV4T2Yoc2VsZWN0ZWRUZW1wbGF0ZSlcblx0fVxuXG5cdHNldFNlbGVjdGVkVGVtcGxhdGUodGVtcGxhdGU6IEVtYWlsVGVtcGxhdGUgfCBudWxsKSB7XG5cdFx0dGhpcy5zZWxlY3RlZFRlbXBsYXRlKHRlbXBsYXRlKVxuXHR9XG5cblx0c2V0U2VsZWN0ZWRDb250ZW50TGFuZ3VhZ2UobGFuZ0NvZGU6IExhbmd1YWdlQ29kZSkge1xuXHRcdHRoaXMuX3NlbGVjdGVkQ29udGVudExhbmd1YWdlID0gbGFuZ0NvZGVcblx0fVxuXG5cdHNlYXJjaChxdWVyeTogc3RyaW5nKTogdm9pZCB7XG5cdFx0dGhpcy5zZWFyY2hSZXN1bHRzKHRoaXMuX3NlYXJjaEZpbHRlci5maWx0ZXIocXVlcnksIHRoaXMuX2FsbFRlbXBsYXRlcy5hcnJheSkpXG5cdFx0dGhpcy5zZXRTZWxlY3RlZFRlbXBsYXRlKHRoaXMuc2VhcmNoUmVzdWx0cygpWzBdKVxuXHR9XG5cblx0X3JlcnVuU2VhcmNoKCk6IHZvaWQge1xuXHRcdHRoaXMuc2VhcmNoUmVzdWx0cyh0aGlzLl9zZWFyY2hGaWx0ZXIucmVydW5RdWVyeSh0aGlzLl9hbGxUZW1wbGF0ZXMuYXJyYXkpKVxuXHRcdHRoaXMuc2V0U2VsZWN0ZWRUZW1wbGF0ZSh0aGlzLnNlYXJjaFJlc3VsdHMoKVswXSlcblx0fVxuXG5cdC8qKlxuXHQgKiBJbmNyZW1lbnRzIG9yIGRlY3JlbWVudHMgdGhlIHNlbGVjdGlvbiwgdW5sZXNzIGl0IHdvdWxkIGdvIHBhc3QgdGhlIGJlZ2lubmluZyBvciBlbmQgb2YgdGhlIHNlYXJjaCByZXN1bHRzXG5cdCAqIEBwYXJhbSBhY3Rpb25cblx0ICogQHJldHVybnMgdHJ1ZSBpZiB0aGUgc2VsZWN0aW9uIGNoYW5nZWRcblx0ICovXG5cdHNlbGVjdE5leHRUZW1wbGF0ZShhY3Rpb246IE5hdkFjdGlvbik6IGJvb2xlYW4ge1xuXHRcdGNvbnN0IHNlbGVjdGVkSW5kZXggPSB0aGlzLmdldFNlbGVjdGVkVGVtcGxhdGVJbmRleCgpXG5cdFx0Y29uc3QgbmV4dEluZGV4ID0gc2VsZWN0ZWRJbmRleCArIChhY3Rpb24gPT09IFNFTEVDVF9ORVhUX1RFTVBMQVRFID8gMSA6IC0xKVxuXG5cdFx0aWYgKG5leHRJbmRleCA+PSAwICYmIG5leHRJbmRleCA8IHRoaXMuc2VhcmNoUmVzdWx0cygpLmxlbmd0aCkge1xuXHRcdFx0Y29uc3QgbmV4dFNlbGVjdGVkVGVtcGxhdGUgPSB0aGlzLnNlYXJjaFJlc3VsdHMoKVtuZXh0SW5kZXhdXG5cdFx0XHR0aGlzLnNldFNlbGVjdGVkVGVtcGxhdGUobmV4dFNlbGVjdGVkVGVtcGxhdGUpXG5cdFx0XHRyZXR1cm4gdHJ1ZVxuXHRcdH1cblxuXHRcdHJldHVybiBmYWxzZVxuXHR9XG5cblx0ZmluZFRlbXBsYXRlV2l0aFRhZyhzZWxlY3RlZFRleHQ6IHN0cmluZyk6IEVtYWlsVGVtcGxhdGUgfCBudWxsIHtcblx0XHRjb25zdCB0YWcgPSBzZWxlY3RlZFRleHQuc3Vic3RyaW5nKFRFTVBMQVRFX1NIT1JUQ1VUX1BSRUZJWC5sZW5ndGgpIC8vIHJlbW92ZSBURU1QTEFURV9TSE9SVENVVF9QUkVGSVggZnJvbSBzZWxlY3RlZCB0ZXh0XG5cblx0XHRyZXR1cm4gdGhpcy5fYWxsVGVtcGxhdGVzLmFycmF5LmZpbmQoKHRlbXBsYXRlKSA9PiB0ZW1wbGF0ZS50YWcgPT09IHRhZykgPz8gbnVsbFxuXHR9XG5cblx0X2VudGl0eVVwZGF0ZSh1cGRhdGVzOiBSZWFkb25seUFycmF5PEVudGl0eVVwZGF0ZURhdGE+LCBldmVudE93bmVyR3JvdXBJZDogSWQpOiBQcm9taXNlPGFueT4ge1xuXHRcdHJldHVybiBwcm9taXNlTWFwKHVwZGF0ZXMsICh1cGRhdGUpID0+IHtcblx0XHRcdGlmIChpc1VwZGF0ZUZvclR5cGVSZWYoRW1haWxUZW1wbGF0ZVR5cGVSZWYsIHVwZGF0ZSkpIHtcblx0XHRcdFx0aWYgKHVwZGF0ZS5vcGVyYXRpb24gPT09IE9wZXJhdGlvblR5cGUuQ1JFQVRFKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2VudGl0eUNsaWVudC5sb2FkKEVtYWlsVGVtcGxhdGVUeXBlUmVmLCBbdXBkYXRlLmluc3RhbmNlTGlzdElkLCB1cGRhdGUuaW5zdGFuY2VJZF0pLnRoZW4oKHRlbXBsYXRlKSA9PiB7XG5cdFx0XHRcdFx0XHR0aGlzLl9hbGxUZW1wbGF0ZXMuaW5zZXJ0KHRlbXBsYXRlKVxuXG5cdFx0XHRcdFx0XHR0aGlzLl9yZXJ1blNlYXJjaCgpXG5cblx0XHRcdFx0XHRcdHRoaXMuc2V0U2VsZWN0ZWRUZW1wbGF0ZSh0ZW1wbGF0ZSlcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHR9IGVsc2UgaWYgKHVwZGF0ZS5vcGVyYXRpb24gPT09IE9wZXJhdGlvblR5cGUuVVBEQVRFKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuX2VudGl0eUNsaWVudC5sb2FkKEVtYWlsVGVtcGxhdGVUeXBlUmVmLCBbdXBkYXRlLmluc3RhbmNlTGlzdElkLCB1cGRhdGUuaW5zdGFuY2VJZF0pLnRoZW4oKHRlbXBsYXRlKSA9PiB7XG5cdFx0XHRcdFx0XHR0aGlzLl9hbGxUZW1wbGF0ZXMucmVtb3ZlRmlyc3QoKHQpID0+IGlzU2FtZUlkKGdldEVsZW1lbnRJZCh0KSwgdXBkYXRlLmluc3RhbmNlSWQpKVxuXG5cdFx0XHRcdFx0XHR0aGlzLl9hbGxUZW1wbGF0ZXMuaW5zZXJ0KHRlbXBsYXRlKVxuXG5cdFx0XHRcdFx0XHR0aGlzLl9yZXJ1blNlYXJjaCgpXG5cblx0XHRcdFx0XHRcdHRoaXMuc2V0U2VsZWN0ZWRUZW1wbGF0ZSh0ZW1wbGF0ZSlcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHR9IGVsc2UgaWYgKHVwZGF0ZS5vcGVyYXRpb24gPT09IE9wZXJhdGlvblR5cGUuREVMRVRFKSB7XG5cdFx0XHRcdFx0Ly8gVHJ5IHNlbGVjdCB0aGUgbmV4dCBvciB0aGUgcHJldmlvdXMgdGVtcGxhdGVcblx0XHRcdFx0XHQvLyBpZiBuZWl0aGVyIG9wdGlvbiBpcyBwb3NzaWJsZSwgaXQgbWVhbnMgd2UgYXJlIGRlbGV0aW5nIHRoZSBsYXN0IHRlbXBsYXRlLCBzbyBjbGVhciB0aGUgc2VsZWN0aW9uXG5cdFx0XHRcdFx0aWYgKCF0aGlzLnNlbGVjdE5leHRUZW1wbGF0ZShcIm5leHRcIikgJiYgIXRoaXMuc2VsZWN0TmV4dFRlbXBsYXRlKFwicHJldmlvdXNcIikpIHtcblx0XHRcdFx0XHRcdHRoaXMuc2V0U2VsZWN0ZWRUZW1wbGF0ZShudWxsKVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHRoaXMuX2FsbFRlbXBsYXRlcy5yZW1vdmVGaXJzdCgodCkgPT4gaXNTYW1lSWQoZ2V0RWxlbWVudElkKHQpLCB1cGRhdGUuaW5zdGFuY2VJZCkpXG5cblx0XHRcdFx0XHR0aGlzLl9yZXJ1blNlYXJjaCgpXG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAodGhpcy5fbG9naW5zLmdldFVzZXJDb250cm9sbGVyKCkuaXNVcGRhdGVGb3JMb2dnZWRJblVzZXJJbnN0YW5jZSh1cGRhdGUsIGV2ZW50T3duZXJHcm91cElkKSkge1xuXHRcdFx0XHQvLyB0ZW1wbGF0ZSBncm91cCBtZW1iZXJzaGlwcyBtYXkgaGF2ZSBjaGFuZ2VkXG5cdFx0XHRcdGlmICh0aGlzLl9ncm91cEluc3RhbmNlcy5sZW5ndGggIT09IHRoaXMuX2xvZ2lucy5nZXRVc2VyQ29udHJvbGxlcigpLmdldFRlbXBsYXRlTWVtYmVyc2hpcHMoKS5sZW5ndGgpIHtcblx0XHRcdFx0XHR0aGlzLmluaXRpYWxpemVkLnJlc2V0KClcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5pbml0aWFsaXplZC5nZXRBc3luYygpLnRoZW4oKCkgPT4gdGhpcy5fcmVydW5TZWFyY2goKSlcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pXG5cdH1cblxuXHRnZXRUZW1wbGF0ZUdyb3VwSW5zdGFuY2VzKCk6IEFycmF5PFRlbXBsYXRlR3JvdXBJbnN0YW5jZT4ge1xuXHRcdHJldHVybiB0aGlzLl9ncm91cEluc3RhbmNlc1xuXHR9XG5cblx0Z2V0U2VsZWN0ZWRUZW1wbGF0ZUdyb3VwSW5zdGFuY2UoKTogVGVtcGxhdGVHcm91cEluc3RhbmNlIHwgbnVsbCB7XG5cdFx0Y29uc3Qgc2VsZWN0ZWQgPSB0aGlzLmdldFNlbGVjdGVkVGVtcGxhdGUoKVxuXHRcdGlmIChzZWxlY3RlZCA9PSBudWxsKSB7XG5cdFx0XHRyZXR1cm4gbnVsbFxuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fZ3JvdXBJbnN0YW5jZXMuZmluZCgoaW5zdGFuY2UpID0+IGlzU2FtZUlkKGdldEV0SWQoaW5zdGFuY2UuZ3JvdXApLCBzZWxlY3RlZC5fb3duZXJHcm91cCkpID8/IG51bGxcblx0XHR9XG5cdH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRUZW1wbGF0ZUdyb3VwSW5zdGFuY2VzKG1lbWJlcnNoaXBzOiBBcnJheTxHcm91cE1lbWJlcnNoaXA+LCBlbnRpdHlDbGllbnQ6IEVudGl0eUNsaWVudCk6IFByb21pc2U8QXJyYXk8VGVtcGxhdGVHcm91cEluc3RhbmNlPj4ge1xuXHRyZXR1cm4gcHJvbWlzZU1hcChtZW1iZXJzaGlwcywgKG1lbWJlcnNoaXApID0+IGxvYWRUZW1wbGF0ZUdyb3VwSW5zdGFuY2UobWVtYmVyc2hpcCwgZW50aXR5Q2xpZW50KSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRUZW1wbGF0ZUdyb3VwSW5zdGFuY2UoZ3JvdXBNZW1iZXJzaGlwOiBHcm91cE1lbWJlcnNoaXAsIGVudGl0eUNsaWVudDogRW50aXR5Q2xpZW50KTogUHJvbWlzZTxUZW1wbGF0ZUdyb3VwSW5zdGFuY2U+IHtcblx0cmV0dXJuIGVudGl0eUNsaWVudC5sb2FkKEdyb3VwSW5mb1R5cGVSZWYsIGdyb3VwTWVtYmVyc2hpcC5ncm91cEluZm8pLnRoZW4oKGdyb3VwSW5mbykgPT5cblx0XHRlbnRpdHlDbGllbnQubG9hZChUZW1wbGF0ZUdyb3VwUm9vdFR5cGVSZWYsIGdyb3VwSW5mby5ncm91cCkudGhlbigoZ3JvdXBSb290KSA9PlxuXHRcdFx0ZW50aXR5Q2xpZW50LmxvYWQoR3JvdXBUeXBlUmVmLCBncm91cEluZm8uZ3JvdXApLnRoZW4oKGdyb3VwKSA9PiB7XG5cdFx0XHRcdHJldHVybiB7XG5cdFx0XHRcdFx0Z3JvdXBJbmZvLFxuXHRcdFx0XHRcdGdyb3VwLFxuXHRcdFx0XHRcdGdyb3VwUm9vdCxcblx0XHRcdFx0XHRncm91cE1lbWJlcnNoaXAsXG5cdFx0XHRcdH1cblx0XHRcdH0pLFxuXHRcdCksXG5cdClcbn1cblxuZnVuY3Rpb24gbG9hZFRlbXBsYXRlcyh0ZW1wbGF0ZUdyb3VwczogQXJyYXk8VGVtcGxhdGVHcm91cEluc3RhbmNlPiwgZW50aXR5Q2xpZW50OiBFbnRpdHlDbGllbnQpOiBQcm9taXNlPEFycmF5PEVtYWlsVGVtcGxhdGU+PiB7XG5cdHJldHVybiBwcm9taXNlTWFwKHRlbXBsYXRlR3JvdXBzLCAoZ3JvdXApID0+IGVudGl0eUNsaWVudC5sb2FkQWxsKEVtYWlsVGVtcGxhdGVUeXBlUmVmLCBncm91cC5ncm91cFJvb3QudGVtcGxhdGVzKSkudGhlbigoZ3JvdXBlZFRlbXBsYXRlcykgPT5cblx0XHRncm91cGVkVGVtcGxhdGVzLmZsYXQoKSxcblx0KVxufVxuXG5leHBvcnQgZnVuY3Rpb24gc2VhcmNoSW5UZW1wbGF0ZXMoaW5wdXQ6IHN0cmluZywgYWxsVGVtcGxhdGVzOiBSZWFkb25seUFycmF5PEVtYWlsVGVtcGxhdGU+KTogUmVhZG9ubHlBcnJheTxFbWFpbFRlbXBsYXRlPiB7XG5cdGlmIChpbnB1dC5zdGFydHNXaXRoKFRFTVBMQVRFX1NIT1JUQ1VUX1BSRUZJWCkpIHtcblx0XHQvLyBzZWFyY2ggaW4gdGFnIG9ubHlcblx0XHRjb25zdCBuZXdRdWVyeVN0cmluZyA9IGlucHV0LnN1YnN0cmluZyhURU1QTEFURV9TSE9SVENVVF9QUkVGSVgubGVuZ3RoKVxuXHRcdHJldHVybiBzZWFyY2gobmV3UXVlcnlTdHJpbmcsIGFsbFRlbXBsYXRlcywgW1widGFnXCJdLCBmYWxzZSlcblx0fSBlbHNlIHtcblx0XHRyZXR1cm4gc2VhcmNoKGlucHV0LCBhbGxUZW1wbGF0ZXMsIFtcInRhZ1wiLCBcInRpdGxlXCIsIFwiY29udGVudHMudGV4dFwiXSwgZmFsc2UpXG5cdH1cbn1cblxuY2xhc3MgVGVtcGxhdGVTZWFyY2hGaWx0ZXIge1xuXHRsYXN0SW5wdXQ6IFJlYWRvbmx5QXJyYXk8RW1haWxUZW1wbGF0ZT5cblx0bGFzdFF1ZXJ5OiBzdHJpbmdcblx0bGFzdFJlc3VsdHM6IFJlYWRvbmx5QXJyYXk8RW1haWxUZW1wbGF0ZT5cblxuXHRjb25zdHJ1Y3RvcigpIHtcblx0XHR0aGlzLmxhc3RJbnB1dCA9IFtdXG5cdFx0dGhpcy5sYXN0UXVlcnkgPSBcIlwiXG5cdFx0dGhpcy5sYXN0UmVzdWx0cyA9IFtdXG5cdH1cblxuXHRmaWx0ZXIocXVlcnk6IHN0cmluZywgaW5wdXQ6IFJlYWRvbmx5QXJyYXk8RW1haWxUZW1wbGF0ZT4pOiBSZWFkb25seUFycmF5PEVtYWlsVGVtcGxhdGU+IHtcblx0XHRyZXR1cm4gdGhpcy5fZG9GaWx0ZXIocXVlcnksIGlucHV0KVxuXHR9XG5cblx0cmVydW5RdWVyeShpbnB1dDogUmVhZG9ubHlBcnJheTxFbWFpbFRlbXBsYXRlPik6IFJlYWRvbmx5QXJyYXk8RW1haWxUZW1wbGF0ZT4ge1xuXHRcdHJldHVybiB0aGlzLl9kb0ZpbHRlcih0aGlzLmxhc3RRdWVyeSwgaW5wdXQpXG5cdH1cblxuXHRfZG9GaWx0ZXIocXVlcnk6IHN0cmluZywgaW5wdXQ6IFJlYWRvbmx5QXJyYXk8RW1haWxUZW1wbGF0ZT4pOiBSZWFkb25seUFycmF5PEVtYWlsVGVtcGxhdGU+IHtcblx0XHR0aGlzLmxhc3RJbnB1dCA9IGlucHV0LnNsaWNlKClcblx0XHR0aGlzLmxhc3RRdWVyeSA9IHF1ZXJ5XG5cdFx0dGhpcy5sYXN0UmVzdWx0cyA9IHF1ZXJ5ID09PSBcIlwiID8gdGhpcy5sYXN0SW5wdXQgOiBzZWFyY2hJblRlbXBsYXRlcyhxdWVyeSwgaW5wdXQpXG5cdFx0cmV0dXJuIHRoaXMubGFzdFJlc3VsdHNcblx0fVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQW1CTyxTQUFTLE9BQ2ZBLGFBQ0FDLFNBQ0FDLGdCQUNBQyxXQUFvQixPQUNEO0FBQ25CLFdBQVUsUUFBUSxJQUFJLENBQUMsTUFBTSxPQUFPLE9BQU8sQ0FBRSxHQUFFLEVBQUUsQ0FBQztBQUVsRCxLQUFJLFlBQ0gsUUFBTyxRQUFXLGFBQWEsU0FBUyxnQkFBZ0IsU0FBUyxDQUMvRCxPQUFPLENBQUMsVUFBVSxNQUFNLGFBQWEsU0FBUyxFQUFFLENBQ2hELEtBQUssQ0FBQyxHQUFHLE1BQU07QUFDZixNQUFJLEVBQUUsa0JBQWtCLEVBQUUsY0FDekIsUUFBTyxFQUFFLGdCQUFnQixFQUFFO0FBRzVCLE1BQUksRUFBRSxhQUFhLFdBQVcsRUFBRSxhQUFhLE9BQzVDLFFBQU8sRUFBRSxhQUFhLFNBQVMsRUFBRSxhQUFhO1NBQ3BDLEVBQUUsb0JBQW9CLEVBQUUsZ0JBQ2xDLFFBQU8sRUFBRSxrQkFBa0IsRUFBRTtTQUNuQixFQUFFLHVCQUF1QixFQUFFLG1CQUNyQyxRQUFPLEVBQUUscUJBQXFCLEVBQUU7SUFFaEMsUUFBTztDQUVSLEVBQUMsQ0FDRCxJQUFJLENBQUMsVUFBVSxNQUFNLE1BQU07SUFFN0IsUUFBTztBQUVSO0FBRUQsU0FBUyxrQkFDUkMsYUFDQUMsZUFDQUwsYUFDQU0sWUFDQUMsYUFDQUosVUFDQztDQUNELE1BQU0sUUFBUSxZQUFZO0FBRTFCLE1BQUssZ0JBQWdCLFVBQVUsU0FDOUI7Q0FHRCxNQUFNLGdCQUFnQixNQUFNLE1BQU0sY0FBYztDQUdoRCxNQUFNLGlCQUFpQixJQUFJLE9BQU8sYUFBYSxZQUFZLEVBQUU7QUFDN0QsYUFBWSxpQkFBaUIsYUFBYSxlQUFlLGdCQUFnQixNQUFNLENBQUM7Q0FFaEYsTUFBTSxpQkFBaUIsSUFBSSxPQUFPLFdBQVcsSUFB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