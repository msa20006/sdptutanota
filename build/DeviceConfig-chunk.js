import { __toESM } from "./chunk-chunk.js";
import { ProgrammingError } from "./ProgrammingError-chunk.js";
import { assertMainOrNodeBoot, isApp } from "./Env-chunk.js";
import { client } from "./ClientDetector-chunk.js";
import { base64ToUint8Array, typedEntries, uint8ArrayToBase64 } from "./dist2-chunk.js";
import { SyncStatus } from "./ImportExportUtils-chunk.js";
import { require_stream } from "./stream-chunk.js";

//#region src/common/misc/DeviceConfig.ts
var import_stream = __toESM(require_stream(), 1);
assertMainOrNodeBoot();
const defaultThemePreference = "auto:light|dark";
let ListAutoSelectBehavior = function(ListAutoSelectBehavior$1) {
	ListAutoSelectBehavior$1[ListAutoSelectBehavior$1["NONE"] = 0] = "NONE";
	ListAutoSelectBehavior$1[ListAutoSelectBehavior$1["OLDER"] = 1] = "OLDER";
	ListAutoSelectBehavior$1[ListAutoSelectBehavior$1["NEWER"] = 2] = "NEWER";
	return ListAutoSelectBehavior$1;
}({});
var DeviceConfig = class DeviceConfig {
	static Version = 4;
	static LocalStorageKey = "tutanotaConfig";
	config;
	lastSyncStream = (0, import_stream.default)(new Map());
	constructor(_version, localStorage$1) {
		this._version = _version;
		this.localStorage = localStorage$1;
		this.init();
	}
	init() {
		const loadedConfig = this.loadConfigFromLocalStorage() ?? {};
		let doSave = false;
		if (loadedConfig._version != null && loadedConfig._version !== DeviceConfig.Version) {
			migrateConfig(loadedConfig);
			doSave = true;
		}
		let signupToken;
		if (loadedConfig._signupToken) signupToken = loadedConfig._signupToken;
else {
			let bytes = new Uint8Array(6);
			let crypto = window.crypto;
			crypto.getRandomValues(bytes);
			signupToken = uint8ArrayToBase64(bytes);
			doSave = true;
		}
		this.config = {
			_version: DeviceConfig.Version,
			_credentials: loadedConfig._credentials ? new Map(typedEntries(loadedConfig._credentials)) : new Map(),
			_credentialEncryptionMode: loadedConfig._credentialEncryptionMode ?? null,
			_encryptedCredentialsKey: loadedConfig._encryptedCredentialsKey ?? null,
			acknowledgedNewsItems: loadedConfig.acknowledgedNewsItems ?? [],
			_themeId: loadedConfig._themeId ?? defaultThemePreference,
			scheduledAlarmModelVersionPerUser: loadedConfig.scheduledAlarmModelVersionPerUser ?? {},
			_language: loadedConfig._language ?? null,
			_defaultCalendarView: loadedConfig._defaultCalendarView ?? {},
			_hiddenCalendars: loadedConfig._hiddenCalendars ?? {},
			expandedMailFolders: loadedConfig.expandedMailFolders ?? {},
			_testDeviceId: loadedConfig._testDeviceId ?? null,
			_testAssignments: loadedConfig._testAssignments ?? null,
			_signupToken: signupToken,
			offlineTimeRangeDaysByUser: loadedConfig.offlineTimeRangeDaysByUser ?? {},
			conversationViewShowOnlySelectedMail: loadedConfig.conversationViewShowOnlySelectedMail ?? false,
			syncContactsWithPhonePreference: loadedConfig.syncContactsWithPhonePreference ?? {},
			isCalendarDaySelectorExpanded: loadedConfig.isCalendarDaySelectorExpanded ?? false,
			mailAutoSelectBehavior: loadedConfig.mailAutoSelectBehavior ?? (isApp() ? ListAutoSelectBehavior.NONE : ListAutoSelectBehavior.OLDER),
			isSetupComplete: loadedConfig.isSetupComplete ?? false,
			isCredentialsMigratedToNative: loadedConfig.isCredentialsMigratedToNative ?? false,
			lastExternalCalendarSync: loadedConfig.lastExternalCalendarSync ?? {},
			clientOnlyCalendars: loadedConfig.clientOnlyCalendars ? new Map(typedEntries(loadedConfig.clientOnlyCalendars)) : new Map(),
			events: loadedConfig.events ?? [],
			lastRatingPromptedDate: loadedConfig.lastRatingPromptedDate ?? null,
			retryRatingPromptAfter: loadedConfig.retryRatingPromptAfter ?? null
		};
		this.lastSyncStream(new Map(Object.entries(this.config.lastExternalCalendarSync)));
		if (doSave) this.writeToStorage();
	}
	loadConfigFromLocalStorage() {
		if (this.localStorage == null) return null;
		const loadedConfigString = this.localStorage.getItem(DeviceConfig.LocalStorageKey);
		if (loadedConfigString == null) return null;
		try {
			return JSON.parse(loadedConfigString);
		} catch (e) {
			console.warn("Could not parse device config");
			return null;
		}
	}
	storeCredentials(credentials) {
		this.config._credentials.set(credentials.credentialInfo.userId, credentials);
		this.writeToStorage();
	}
	getCredentialsByUserId(userId) {
		return this.config._credentials.get(userId) ?? null;
	}
	getCredentials() {
		return Array.from(this.config._credentials.values());
	}
	async deleteByUserId(userId) {
		this.config._credentials.delete(userId);
		this.writeToStorage();
	}
	async clearCredentialsData() {
		this.config._credentials.clear();
		this.config._encryptedCredentialsKey = null;
		this.config._credentialEncryptionMode = null;
		this.writeToStorage();
	}
	getSignupToken() {
		return this.config._signupToken;
	}
	getScheduledAlarmsModelVersion(userId) {
		return this.config.scheduledAlarmModelVersionPerUser[userId] ?? null;
	}
	setScheduledAlarmsModelVersion(userId, version) {
		this.config.scheduledAlarmModelVersionPerUser[userId] = version;
		this.writeToStorage();
	}
	setNoAlarmsScheduled() {
		this.config.scheduledAlarmModelVersionPerUser = {};
		this.writeToStorage();
	}
	getIsSetupComplete() {
		return this.config.isSetupComplete ?? false;
	}
	setIsSetupComplete(value) {
		this.config.isSetupComplete = value;
		this.writeToStorage();
	}
	getIsCredentialsMigratedToNative() {
		return this.config.isCredentialsMigratedToNative ?? false;
	}
	setIsCredentialsMigratedToNative(value) {
		this.config.isCredentialsMigratedToNative = value;
		this.writeToStorage();
	}
	getLastExternalCalendarSync() {
		return this.lastSyncStream();
	}
	setLastExternalCalendarSync(value) {
		this.config.lastExternalCalendarSync = Object.fromEntries(value);
		this.writeToStorage();
		this.lastSyncStream(value);
	}
	updateLastSync(groupId, lastSyncStatus = SyncStatus.Success) {
		const lastExternalCalendarSync = this.getLastExternalCalendarSync();
		const lastSuccessfulSync = lastSyncStatus === SyncStatus.Success ? Date.now() : lastExternalCalendarSync.get(groupId)?.lastSuccessfulSync;
		lastExternalCalendarSync.set(groupId, {
			lastSuccessfulSync,
			lastSyncStatus
		});
		this.setLastExternalCalendarSync(lastExternalCalendarSync);
	}
	getLastSyncStream() {
		return this.lastSyncStream;
	}
	removeLastSync(groupId) {
		const lastExternalCalendarSync = this.getLastExternalCalendarSync();
		if (lastExternalCalendarSync.delete(groupId)) this.setLastExternalCalendarSync(lastExternalCalendarSync);
	}
	getLanguage() {
		return this.config._language;
	}
	setLanguage(language) {
		this.config._language = language;
		this.writeToStorage();
	}
	writeToStorage() {
		try {
			if (this.localStorage != null) this.localStorage.setItem(DeviceConfig.LocalStorageKey, JSON.stringify(this.config, (key, value) => {
				if (key === "_credentials") return Object.fromEntries(this.config._credentials.entries());
else if (key === "clientOnlyCalendars") return Object.fromEntries(this.config.clientOnlyCalendars.entries());
else return value;
			}));
		} catch (e) {
			console.log("could not store config", e);
		}
	}
	getTheme() {
		return this.config._themeId;
	}
	setTheme(theme) {
		if (this.config._themeId !== theme) {
			this.config._themeId = theme;
			this.writeToStorage();
		}
	}
	getDefaultCalendarView(userId) {
		return this.config._defaultCalendarView[userId];
	}
	setDefaultCalendarView(userId, defaultView) {
		if (this.config._defaultCalendarView[userId] !== defaultView) {
			this.config._defaultCalendarView[userId] = defaultView;
			this.writeToStorage();
		}
	}
	getHiddenCalendars(user) {
		return this.config._hiddenCalendars[user] ?? [];
	}
	setHiddenCalendars(user, calendars) {
		if (this.config._hiddenCalendars[user] !== calendars) {
			this.config._hiddenCalendars[user] = calendars;
			this.writeToStorage();
		}
	}
	getExpandedFolders(user) {
		return this.config.expandedMailFolders[user] ?? [];
	}
	setExpandedFolders(user, folders) {
		if (this.config.expandedMailFolders[user] !== folders) {
			this.config.expandedMailFolders[user] = folders;
			this.writeToStorage();
		}
	}
	hasAcknowledgedNewsItemForDevice(newsItemId) {
		return this.config.acknowledgedNewsItems.includes(newsItemId);
	}
	acknowledgeNewsItemForDevice(newsItemId) {
		if (!this.config.acknowledgedNewsItems.includes(newsItemId)) {
			this.config.acknowledgedNewsItems.push(newsItemId);
			this.writeToStorage();
		}
	}
	async getCredentialEncryptionMode() {
		return this.config._credentialEncryptionMode;
	}
	async getCredentialsEncryptionKey() {
		return this.config._encryptedCredentialsKey ? base64ToUint8Array(this.config._encryptedCredentialsKey) : null;
	}
	async getTestDeviceId() {
		return this.config._testDeviceId;
	}
	async storeTestDeviceId(testDeviceId) {
		this.config._testDeviceId = testDeviceId;
		this.writeToStorage();
	}
	async getAssignments() {
		return this.config._testAssignments;
	}
	async storeAssignments(persistedAssignmentData) {
		this.config._testAssignments = persistedAssignmentData;
		this.writeToStorage();
	}
	getOfflineTimeRangeDays(userId) {
		return this.config.offlineTimeRangeDaysByUser[userId];
	}
	setOfflineTimeRangeDays(userId, days) {
		this.config.offlineTimeRangeDaysByUser[userId] = days;
		this.writeToStorage();
	}
	getConversationViewShowOnlySelectedMail() {
		return this.config.conversationViewShowOnlySelectedMail;
	}
	setConversationViewShowOnlySelectedMail(setting) {
		this.config.conversationViewShowOnlySelectedMail = setting;
		this.writeToStorage();
	}
	getUserSyncContactsWithPhonePreference(id) {
		return this.config.syncContactsWithPhonePreference[id] ?? null;
	}
	setUserSyncContactsWithPhonePreference(user, value) {
		this.config.syncContactsWithPhonePreference[user] = value;
		this.writeToStorage();
	}
	isCalendarDaySelectorExpanded() {
		return this.config.isCalendarDaySelectorExpanded;
	}
	setCalendarDaySelectorExpanded(expanded) {
		this.config.isCalendarDaySelectorExpanded = expanded;
		this.writeToStorage();
	}
	getMailAutoSelectBehavior() {
		return this.config.mailAutoSelectBehavior;
	}
	setMailAutoSelectBehavior(action) {
		this.config.mailAutoSelectBehavior = action;
		this.writeToStorage();
	}
	getClientOnlyCalendars() {
		return this.config.clientOnlyCalendars;
	}
	updateClientOnlyCalendars(calendarId, clientOnlyCalendarConfig) {
		this.config.clientOnlyCalendars.set(calendarId, clientOnlyCalendarConfig);
		this.writeToStorage();
	}
	writeEvents(events) {
		this.config.events = events.map((date) => date.getTime());
		this.writeToStorage();
	}
	/**
	* Gets a list of dates on which a certain event has occurred. Could be email sent, replied, contact created etc.
	*
	* Only present on iOS.
	*/
	getEvents() {
		return (this.config.events ?? []).flatMap((timestamp) => {
			try {
				return new Date(timestamp);
			} catch (e) {
				return [];
			}
		});
	}
	setLastRatingPromptedDate(date) {
		this.config.lastRatingPromptedDate = date.getTime();
		this.writeToStorage();
	}
	/**
	* Gets the last date on which the user was prompted to rate the app.
	*/
	getLastRatingPromptedDate() {
		if (this.config.lastRatingPromptedDate == null) return null;
		try {
			return new Date(this.config.lastRatingPromptedDate);
		} catch (e) {
			return null;
		}
	}
	/**
	* Sets the date of the earliest possible next date from which another rating can be requested from the user.
	*/
	setRetryRatingPromptAfter(date) {
		this.config.retryRatingPromptAfter = date.getTime();
		this.writeToStorage();
	}
	/**
	* Gets the date of the earliest possible next date from which another rating can be requested from the user.
	*/
	getRetryRatingPromptAfter() {
		if (this.config.retryRatingPromptAfter == null) return null;
		try {
			return new Date(this.config.retryRatingPromptAfter);
		} catch (e) {
			return null;
		}
	}
};
function migrateConfig(loadedConfig) {
	if (loadedConfig === DeviceConfig.Version) throw new ProgrammingError("Should not migrate credentials, current version");
	if (loadedConfig._version < 2) loadedConfig._credentials = [];
	if (loadedConfig._version < 3) migrateConfigV2to3(loadedConfig);
}
function migrateConfigV2to3(loadedConfig) {
	const oldCredentialsArray = loadedConfig._credentials;
	loadedConfig._credentials = {};
	for (let credential of oldCredentialsArray) {
		let login, type;
		if (credential.mailAddress.includes("@")) {
			login = credential.mailAddress;
			type = "internal";
		} else {
			login = credential.userId;
			type = "external";
		}
		loadedConfig._credentials[credential.userId] = {
			credentialInfo: {
				login,
				userId: credential.userId,
				type
			},
			encryptedPassword: credential.encryptedPassword,
			accessToken: credential.accessToken,
			encryptedPassphraseKey: null
		};
	}
}
const deviceConfig = new DeviceConfig(DeviceConfig.Version, client.localStorage() ? localStorage : null);

//#endregion
export { ListAutoSelectBehavior, deviceConfig };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGV2aWNlQ29uZmlnLWNodW5rLmpzIiwibmFtZXMiOlsiZGVmYXVsdFRoZW1lUHJlZmVyZW5jZTogVGhlbWVQcmVmZXJlbmNlIiwiX3ZlcnNpb246IG51bWJlciIsImxvY2FsU3RvcmFnZTogU3RvcmFnZSB8IG51bGwiLCJjcmVkZW50aWFsczogRGV2aWNlQ29uZmlnQ3JlZGVudGlhbHMiLCJ1c2VySWQ6IElkIiwidmVyc2lvbjogbnVtYmVyIiwidmFsdWU6IGJvb2xlYW4iLCJ2YWx1ZTogTWFwPElkLCBMYXN0RXh0ZXJuYWxDYWxlbmRhclN5bmNFbnRyeT4iLCJncm91cElkOiBJZCIsImxhc3RTeW5jU3RhdHVzOiBTeW5jU3RhdHVzIiwibGFuZ3VhZ2U6IExhbmd1YWdlQ29kZSB8IG51bGwiLCJ0aGVtZTogVGhlbWVQcmVmZXJlbmNlIiwiZGVmYXVsdFZpZXc6IENhbGVuZGFyVmlld1R5cGUiLCJ1c2VyOiBJZCIsImNhbGVuZGFyczogSWRbXSIsImZvbGRlcnM6IElkW10iLCJuZXdzSXRlbUlkOiBJZCIsInRlc3REZXZpY2VJZDogc3RyaW5nIiwicGVyc2lzdGVkQXNzaWdubWVudERhdGE6IFBlcnNpc3RlZEFzc2lnbm1lbnREYXRhIiwiZGF5czogbnVtYmVyIiwic2V0dGluZzogYm9vbGVhbiIsImlkOiBJZCIsImV4cGFuZGVkOiBib29sZWFuIiwiYWN0aW9uOiBMaXN0QXV0b1NlbGVjdEJlaGF2aW9yIiwiY2FsZW5kYXJJZDogSWQiLCJjbGllbnRPbmx5Q2FsZW5kYXJDb25maWc6IENsaWVudE9ubHlDYWxlbmRhcnNJbmZvIiwiZXZlbnRzOiBEYXRlW10iLCJkYXRlOiBEYXRlIiwibG9hZGVkQ29uZmlnOiBhbnkiLCJkZXZpY2VDb25maWc6IERldmljZUNvbmZpZyJdLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21tb24vbWlzYy9EZXZpY2VDb25maWcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmFzZTY0LCBiYXNlNjRUb1VpbnQ4QXJyYXksIHR5cGVkRW50cmllcywgdWludDhBcnJheVRvQmFzZTY0IH0gZnJvbSBcIkB0dXRhby90dXRhbm90YS11dGlsc1wiXG5pbXBvcnQgdHlwZSB7IExhbmd1YWdlQ29kZSB9IGZyb20gXCIuL0xhbmd1YWdlVmlld01vZGVsXCJcbmltcG9ydCB0eXBlIHsgVGhlbWVQcmVmZXJlbmNlIH0gZnJvbSBcIi4uL2d1aS90aGVtZVwiXG5pbXBvcnQgeyBQcm9ncmFtbWluZ0Vycm9yIH0gZnJvbSBcIi4uL2FwaS9jb21tb24vZXJyb3IvUHJvZ3JhbW1pbmdFcnJvclwiXG5pbXBvcnQgdHlwZSB7IENyZWRlbnRpYWxFbmNyeXB0aW9uTW9kZSB9IGZyb20gXCIuL2NyZWRlbnRpYWxzL0NyZWRlbnRpYWxFbmNyeXB0aW9uTW9kZS5qc1wiXG5pbXBvcnQgeyBhc3NlcnRNYWluT3JOb2RlQm9vdCwgaXNBcHAgfSBmcm9tIFwiLi4vYXBpL2NvbW1vbi9FbnZcIlxuaW1wb3J0IHsgUGVyc2lzdGVkQXNzaWdubWVudERhdGEsIFVzYWdlVGVzdFN0b3JhZ2UgfSBmcm9tIFwiLi9Vc2FnZVRlc3RNb2RlbFwiXG5pbXBvcnQgeyBjbGllbnQgfSBmcm9tIFwiLi9DbGllbnREZXRlY3RvclwiXG5pbXBvcnQgeyBOZXdzSXRlbVN0b3JhZ2UgfSBmcm9tIFwiLi9uZXdzL05ld3NNb2RlbC5qc1wiXG5pbXBvcnQgeyBDcmVkZW50aWFsc0luZm8gfSBmcm9tIFwiLi4vbmF0aXZlL2NvbW1vbi9nZW5lcmF0ZWRpcGMvQ3JlZGVudGlhbHNJbmZvLmpzXCJcbmltcG9ydCB7IENhbGVuZGFyVmlld1R5cGUgfSBmcm9tIFwiLi4vYXBpL2NvbW1vbi91dGlscy9Db21tb25DYWxlbmRhclV0aWxzLmpzXCJcbmltcG9ydCB7IFN5bmNTdGF0dXMgfSBmcm9tIFwiLi4vY2FsZW5kYXIvaW1wb3J0L0ltcG9ydEV4cG9ydFV0aWxzLmpzXCJcbmltcG9ydCBTdHJlYW0gZnJvbSBcIm1pdGhyaWwvc3RyZWFtXCJcbmltcG9ydCBzdHJlYW0gZnJvbSBcIm1pdGhyaWwvc3RyZWFtXCJcbmltcG9ydCB0eXBlIHsgR3JvdXBTZXR0aW5ncyB9IGZyb20gXCIuLi9hcGkvZW50aXRpZXMvdHV0YW5vdGEvVHlwZVJlZnMuanNcIlxuXG5hc3NlcnRNYWluT3JOb2RlQm9vdCgpXG5leHBvcnQgY29uc3QgZGVmYXVsdFRoZW1lUHJlZmVyZW5jZTogVGhlbWVQcmVmZXJlbmNlID0gXCJhdXRvOmxpZ2h0fGRhcmtcIlxuXG5leHBvcnQgZW51bSBMaXN0QXV0b1NlbGVjdEJlaGF2aW9yIHtcblx0Tk9ORSxcblx0T0xERVIsXG5cdE5FV0VSLFxufVxuXG5leHBvcnQgdHlwZSBMYXN0RXh0ZXJuYWxDYWxlbmRhclN5bmNFbnRyeSA9IHtcblx0bGFzdFN1Y2Nlc3NmdWxTeW5jOiBudW1iZXIgfCB1bmRlZmluZWQgfCBudWxsXG5cdGxhc3RTeW5jU3RhdHVzOiBTeW5jU3RhdHVzXG59XG5cbmV4cG9ydCB0eXBlIENsaWVudE9ubHlDYWxlbmRhcnNJbmZvID0gUGljazxHcm91cFNldHRpbmdzLCBcIm5hbWVcIiB8IFwiY29sb3JcIj5cblxuLyoqXG4gKiBEZWZpbml0aW9uIG9mIHRoZSBjb25maWcgb2JqZWN0IHRoYXQgd2lsbCBiZSBzYXZlZCB0byBsb2NhbCBzdG9yYWdlXG4gKi9cbmludGVyZmFjZSBDb25maWdPYmplY3Qge1xuXHRfdmVyc2lvbjogbnVtYmVyXG5cdF9jcmVkZW50aWFsczogTWFwPElkLCBEZXZpY2VDb25maWdDcmVkZW50aWFscz5cblx0c2NoZWR1bGVkQWxhcm1Nb2RlbFZlcnNpb25QZXJVc2VyOiBSZWNvcmQ8SWQsIG51bWJlcj5cblx0X3RoZW1lSWQ6IFRoZW1lUHJlZmVyZW5jZVxuXHRfbGFuZ3VhZ2U6IExhbmd1YWdlQ29kZSB8IG51bGxcblx0X2RlZmF1bHRDYWxlbmRhclZpZXc6IFJlY29yZDxJZCwgQ2FsZW5kYXJWaWV3VHlwZSB8IG51bGw+XG5cdC8qKiBtYXAgZnJvbSB1c2VyIGlkIHRvIGEgbGlzdCBvZiBjYWxlbmRhciBncm91cHJvb3RzKi9cblx0X2hpZGRlbkNhbGVuZGFyczogUmVjb3JkPElkLCBJZFtdPlxuXHQvKiogbWFwIGZyb20gdXNlciBpZCB0byBhIGxpc3Qgb2YgZXhwYW5kZWQgZm9sZGVycyAoZWxlbWVudElkKSovXG5cdGV4cGFuZGVkTWFpbEZvbGRlcnM6IFJlY29yZDxJZCwgSWRbXT5cblx0X3NpZ251cFRva2VuOiBzdHJpbmdcblx0X2NyZWRlbnRpYWxFbmNyeXB0aW9uTW9kZTogQ3JlZGVudGlhbEVuY3J5cHRpb25Nb2RlIHwgbnVsbFxuXHRfZW5jcnlwdGVkQ3JlZGVudGlhbHNLZXk6IEJhc2U2NCB8IG51bGxcblx0LyoqIGxpc3Qgb2YgYWNrbm93bGVkZ2VkIG5ld3MgaXRlbSBpZHMgZm9yIHRoaXMgZGV2aWNlICovXG5cdGFja25vd2xlZGdlZE5ld3NJdGVtczogSWRbXVxuXHRfdGVzdERldmljZUlkOiBzdHJpbmcgfCBudWxsXG5cdF90ZXN0QXNzaWdubWVudHM6IFBlcnNpc3RlZEFzc2lnbm1lbnREYXRhIHwgbnVsbFxuXHRvZmZsaW5lVGltZVJhbmdlRGF5c0J5VXNlcjogUmVjb3JkPElkLCBudW1iZXI+XG5cdGNvbnZlcnNhdGlvblZpZXdTaG93T25seVNlbGVjdGVkTWFpbDogYm9vbGVhblxuXHQvKiogU3RvcmVzIGVhY2ggdXNlcnMnIGRlZmluaXRpb24gYWJvdXQgY29udGFjdCBzeW5jaHJvbml6YXRpb24gKi9cblx0c3luY0NvbnRhY3RzV2l0aFBob25lUHJlZmVyZW5jZTogUmVjb3JkPElkLCBib29sZWFuPlxuXHQvKiogV2hldGhlciBtb2JpbGUgY2FsZW5kYXIgbmF2aWdhdGlvbiBpcyBpbiB0aGUgXCJwZXIgd2Vla1wiIG9yIFwicGVyIG1vbnRoXCIgbW9kZSAqL1xuXHRpc0NhbGVuZGFyRGF5U2VsZWN0b3JFeHBhbmRlZDogYm9vbGVhblxuXHQvKiogU3RvcmVzIHVzZXIncyBkZXNpcmVkIGJlaGF2aW9yIHRvIHRoZSB2aWV3IHdoZW4gYW4gZW1haWwgaXMgcmVtb3ZlZCBmcm9tIHRoZSBsaXN0ICovXG5cdG1haWxBdXRvU2VsZWN0QmVoYXZpb3I6IExpc3RBdXRvU2VsZWN0QmVoYXZpb3Jcblx0Ly8gVHJ1ZSBpZiB0aGUgYXBwIGhhcyBhbHJlYWR5IGJlZW4gcnVuIGFmdGVyIGluc3RhbGxcblx0aXNTZXR1cENvbXBsZXRlOiBib29sZWFuXG5cdC8vIFRydWUgaWYgdGhlIGNyZWRlbnRpYWxzIGhhdmUgYmVlbiBtaWdyYXRlZCB0byBuYXRpdmVcblx0aXNDcmVkZW50aWFsc01pZ3JhdGVkVG9OYXRpdmU6IGJvb2xlYW5cblx0bGFzdEV4dGVybmFsQ2FsZW5kYXJTeW5jOiBSZWNvcmQ8SWQsIExhc3RFeHRlcm5hbENhbGVuZGFyU3luY0VudHJ5PlxuXHRjbGllbnRPbmx5Q2FsZW5kYXJzOiBNYXA8SWQsIENsaWVudE9ubHlDYWxlbmRhcnNJbmZvPlxuXG5cdC8qKlxuXHQgKiBBIGxpc3Qgb2YgZGF0ZXMgb24gd2hpY2ggYSB1c2VyIGhhcyBzZW50IGFuIGUtbWFpbCBvciBjcmVhdGVkIGEgY2FsZW5kYXIgZXZlbnQuIEVhY2ggZGF0ZSBpcyByZXByZXNlbnRlZCBhcyB0aGUgZGF0ZSdzIHRpbWVzdGFtcC5cblx0ICovXG5cdGV2ZW50czogQXJyYXk8bnVtYmVyPlxuXG5cdC8qKlxuXHQgKiBUaGUgbGFzdCBkYXRlIG9uIHdoaWNoIHRoZSB1c2VyIHdhcyBwcm9tcHRlZCB0byByYXRlIHRoZSBhcHAgYXMgYSB0aW1lc3RhbXAuXG5cdCAqL1xuXHRsYXN0UmF0aW5nUHJvbXB0ZWREYXRlPzogbnVtYmVyXG5cblx0LyoqXG5cdCAqIFRoZSBkYXRlIG9mIHRoZSBlYXJsaWVzdCBwb3NzaWJsZSBuZXh0IGRhdGUgZnJvbSB3aGljaCBhbm90aGVyIHJhdGluZyBjYW4gYmUgcmVxdWVzdGVkIGZyb20gdGhlIHVzZXIuXG5cdCAqIFRoaXMgaXMgb25seSBmb3IgdGhlIGNhc2UgdGhlIHVzZXIgZG9lcyBub3Qgd2FudCB0byByYXRlIHJpZ2h0IG5vdyBvciBjb21wbGV0ZWx5IG9wdHMgb3V0IG9mIHRoZSBpbi1hcHAgcmF0aW5ncy5cblx0ICovXG5cdHJldHJ5UmF0aW5nUHJvbXB0QWZ0ZXI/OiBudW1iZXJcbn1cblxuLyoqXG4gKiBEZXZpY2UgY29uZmlnIGZvciBpbnRlcm5hbCB1c2VyIGF1dG8gbG9naW4uIE9ubHkgb25lIGNvbmZpZyBwZXIgZGV2aWNlIGlzIHN0b3JlZC5cbiAqL1xuZXhwb3J0IGNsYXNzIERldmljZUNvbmZpZyBpbXBsZW1lbnRzIFVzYWdlVGVzdFN0b3JhZ2UsIE5ld3NJdGVtU3RvcmFnZSB7XG5cdHB1YmxpYyBzdGF0aWMgVmVyc2lvbiA9IDRcblx0cHVibGljIHN0YXRpYyBMb2NhbFN0b3JhZ2VLZXkgPSBcInR1dGFub3RhQ29uZmlnXCJcblxuXHRwcml2YXRlIGNvbmZpZyE6IENvbmZpZ09iamVjdFxuXHRwcml2YXRlIGxhc3RTeW5jU3RyZWFtOiBTdHJlYW08TWFwPElkLCBMYXN0RXh0ZXJuYWxDYWxlbmRhclN5bmNFbnRyeT4+ID0gc3RyZWFtKG5ldyBNYXAoKSlcblxuXHRjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IF92ZXJzaW9uOiBudW1iZXIsIHByaXZhdGUgcmVhZG9ubHkgbG9jYWxTdG9yYWdlOiBTdG9yYWdlIHwgbnVsbCkge1xuXHRcdHRoaXMuaW5pdCgpXG5cdH1cblxuXHRpbml0KCkge1xuXHRcdGNvbnN0IGxvYWRlZENvbmZpZyA9IHRoaXMubG9hZENvbmZpZ0Zyb21Mb2NhbFN0b3JhZ2UoKSA/PyB7fVxuXG5cdFx0bGV0IGRvU2F2ZSA9IGZhbHNlXG5cdFx0aWYgKGxvYWRlZENvbmZpZy5fdmVyc2lvbiAhPSBudWxsICYmIGxvYWRlZENvbmZpZy5fdmVyc2lvbiAhPT0gRGV2aWNlQ29uZmlnLlZlcnNpb24pIHtcblx0XHRcdG1pZ3JhdGVDb25maWcobG9hZGVkQ29uZmlnKVxuXHRcdFx0ZG9TYXZlID0gdHJ1ZVxuXHRcdH1cblxuXHRcdGxldCBzaWdudXBUb2tlblxuXHRcdGlmIChsb2FkZWRDb25maWcuX3NpZ251cFRva2VuKSB7XG5cdFx0XHRzaWdudXBUb2tlbiA9IGxvYWRlZENvbmZpZy5fc2lnbnVwVG9rZW5cblx0XHR9IGVsc2Uge1xuXHRcdFx0bGV0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoNilcblx0XHRcdGxldCBjcnlwdG8gPSB3aW5kb3cuY3J5cHRvXG5cdFx0XHRjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKGJ5dGVzKVxuXHRcdFx0c2lnbnVwVG9rZW4gPSB1aW50OEFycmF5VG9CYXNlNjQoYnl0ZXMpXG5cdFx0XHRkb1NhdmUgPSB0cnVlXG5cdFx0fVxuXG5cdFx0dGhpcy5jb25maWcgPSB7XG5cdFx0XHRfdmVyc2lvbjogRGV2aWNlQ29uZmlnLlZlcnNpb24sXG5cdFx0XHRfY3JlZGVudGlhbHM6IGxvYWRlZENvbmZpZy5fY3JlZGVudGlhbHMgPyBuZXcgTWFwKHR5cGVkRW50cmllcyhsb2FkZWRDb25maWcuX2NyZWRlbnRpYWxzKSkgOiBuZXcgTWFwKCksXG5cdFx0XHRfY3JlZGVudGlhbEVuY3J5cHRpb25Nb2RlOiBsb2FkZWRDb25maWcuX2NyZWRlbnRpYWxFbmNyeXB0aW9uTW9kZSA/PyBudWxsLFxuXHRcdFx0X2VuY3J5cHRlZENyZWRlbnRpYWxzS2V5OiBsb2FkZWRDb25maWcuX2VuY3J5cHRlZENyZWRlbnRpYWxzS2V5ID8/IG51bGwsXG5cdFx0XHRhY2tub3dsZWRnZWROZXdzSXRlbXM6IGxvYWRlZENvbmZpZy5hY2tub3dsZWRnZWROZXdzSXRlbXMgPz8gW10sXG5cdFx0XHRfdGhlbWVJZDogbG9hZGVkQ29uZmlnLl90aGVtZUlkID8/IGRlZmF1bHRUaGVtZVByZWZlcmVuY2UsXG5cdFx0XHRzY2hlZHVsZWRBbGFybU1vZGVsVmVyc2lvblBlclVzZXI6IGxvYWRlZENvbmZpZy5zY2hlZHVsZWRBbGFybU1vZGVsVmVyc2lvblBlclVzZXIgPz8ge30sXG5cdFx0XHRfbGFuZ3VhZ2U6IGxvYWRlZENvbmZpZy5fbGFuZ3VhZ2UgPz8gbnVsbCxcblx0XHRcdF9kZWZhdWx0Q2FsZW5kYXJWaWV3OiBsb2FkZWRDb25maWcuX2RlZmF1bHRDYWxlbmRhclZpZXcgPz8ge30sXG5cdFx0XHRfaGlkZGVuQ2FsZW5kYXJzOiBsb2FkZWRDb25maWcuX2hpZGRlbkNhbGVuZGFycyA/PyB7fSxcblx0XHRcdGV4cGFuZGVkTWFpbEZvbGRlcnM6IGxvYWRlZENvbmZpZy5leHBhbmRlZE1haWxGb2xkZXJzID8/IHt9LFxuXHRcdFx0X3Rlc3REZXZpY2VJZDogbG9hZGVkQ29uZmlnLl90ZXN0RGV2aWNlSWQgPz8gbnVsbCxcblx0XHRcdF90ZXN0QXNzaWdubWVudHM6IGxvYWRlZENvbmZpZy5fdGVzdEFzc2lnbm1lbnRzID8/IG51bGwsXG5cdFx0XHRfc2lnbnVwVG9rZW46IHNpZ251cFRva2VuLFxuXHRcdFx0b2ZmbGluZVRpbWVSYW5nZURheXNCeVVzZXI6IGxvYWRlZENvbmZpZy5vZmZsaW5lVGltZVJhbmdlRGF5c0J5VXNlciA/PyB7fSxcblx0XHRcdGNvbnZlcnNhdGlvblZpZXdTaG93T25seVNlbGVjdGVkTWFpbDogbG9hZGVkQ29uZmlnLmNvbnZlcnNhdGlvblZpZXdTaG93T25seVNlbGVjdGVkTWFpbCA/PyBmYWxzZSxcblx0XHRcdHN5bmNDb250YWN0c1dpdGhQaG9uZVByZWZlcmVuY2U6IGxvYWRlZENvbmZpZy5zeW5jQ29udGFjdHNXaXRoUGhvbmVQcmVmZXJlbmNlID8/IHt9LFxuXHRcdFx0aXNDYWxlbmRhckRheVNlbGVjdG9yRXhwYW5kZWQ6IGxvYWRlZENvbmZpZy5pc0NhbGVuZGFyRGF5U2VsZWN0b3JFeHBhbmRlZCA/PyBmYWxzZSxcblx0XHRcdG1haWxBdXRvU2VsZWN0QmVoYXZpb3I6IGxvYWRlZENvbmZpZy5tYWlsQXV0b1NlbGVjdEJlaGF2aW9yID8/IChpc0FwcCgpID8gTGlzdEF1dG9TZWxlY3RCZWhhdmlvci5OT05FIDogTGlzdEF1dG9TZWxlY3RCZWhhdmlvci5PTERFUiksXG5cdFx0XHRpc1NldHVwQ29tcGxldGU6IGxvYWRlZENvbmZpZy5pc1NldHVwQ29tcGxldGUgPz8gZmFsc2UsXG5cdFx0XHRpc0NyZWRlbnRpYWxzTWlncmF0ZWRUb05hdGl2ZTogbG9hZGVkQ29uZmlnLmlzQ3JlZGVudGlhbHNNaWdyYXRlZFRvTmF0aXZlID8/IGZhbHNlLFxuXHRcdFx0bGFzdEV4dGVybmFsQ2FsZW5kYXJTeW5jOiBsb2FkZWRDb25maWcubGFzdEV4dGVybmFsQ2FsZW5kYXJTeW5jID8/IHt9LFxuXHRcdFx0Y2xpZW50T25seUNhbGVuZGFyczogbG9hZGVkQ29uZmlnLmNsaWVudE9ubHlDYWxlbmRhcnMgPyBuZXcgTWFwKHR5cGVkRW50cmllcyhsb2FkZWRDb25maWcuY2xpZW50T25seUNhbGVuZGFycykpIDogbmV3IE1hcCgpLFxuXHRcdFx0ZXZlbnRzOiBsb2FkZWRDb25maWcuZXZlbnRzID8/IFtdLFxuXHRcdFx0bGFzdFJhdGluZ1Byb21wdGVkRGF0ZTogbG9hZGVkQ29uZmlnLmxhc3RSYXRpbmdQcm9tcHRlZERhdGUgPz8gbnVsbCxcblx0XHRcdHJldHJ5UmF0aW5nUHJvbXB0QWZ0ZXI6IGxvYWRlZENvbmZpZy5yZXRyeVJhdGluZ1Byb21wdEFmdGVyID8/IG51bGwsXG5cdFx0fVxuXG5cdFx0dGhpcy5sYXN0U3luY1N0cmVhbShuZXcgTWFwKE9iamVjdC5lbnRyaWVzKHRoaXMuY29uZmlnLmxhc3RFeHRlcm5hbENhbGVuZGFyU3luYykpKVxuXG5cdFx0Ly8gV2UgbmVlZCB0byB3cml0ZSB0aGUgY29uZmlnIGlmIHRoZXJlIHdhcyBhIG1pZ3JhdGlvbiBhbmQgaWYgd2UgZ2VuZXJhdGUgdGhlIHNpZ251cCB0b2tlbiBhbmQgaWYuXG5cdFx0Ly8gV2UgZG8gbm90IHNhdmUgdGhlIGNvbmZpZyBpZiB0aGVyZSB3YXMgbm8gY29uZmlnLiBUaGUgY29uZmlnIGlzIHN0b3JlZCB3aGVuIHNvbWUgdmFsdWUgY2hhbmdlcy5cblx0XHRpZiAoZG9TYXZlKSB7XG5cdFx0XHR0aGlzLndyaXRlVG9TdG9yYWdlKClcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIGxvYWRDb25maWdGcm9tTG9jYWxTdG9yYWdlKCk6IGFueSB8IG51bGwge1xuXHRcdGlmICh0aGlzLmxvY2FsU3RvcmFnZSA9PSBudWxsKSB7XG5cdFx0XHRyZXR1cm4gbnVsbFxuXHRcdH1cblxuXHRcdGNvbnN0IGxvYWRlZENvbmZpZ1N0cmluZyA9IHRoaXMubG9jYWxTdG9yYWdlLmdldEl0ZW0oRGV2aWNlQ29uZmlnLkxvY2FsU3RvcmFnZUtleSlcblx0XHRpZiAobG9hZGVkQ29uZmlnU3RyaW5nID09IG51bGwpIHtcblx0XHRcdHJldHVybiBudWxsXG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdHJldHVybiBKU09OLnBhcnNlKGxvYWRlZENvbmZpZ1N0cmluZylcblx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJDb3VsZCBub3QgcGFyc2UgZGV2aWNlIGNvbmZpZ1wiKVxuXHRcdFx0cmV0dXJuIG51bGxcblx0XHR9XG5cdH1cblxuXHRzdG9yZUNyZWRlbnRpYWxzKGNyZWRlbnRpYWxzOiBEZXZpY2VDb25maWdDcmVkZW50aWFscykge1xuXHRcdHRoaXMuY29uZmlnLl9jcmVkZW50aWFscy5zZXQoY3JlZGVudGlhbHMuY3JlZGVudGlhbEluZm8udXNlcklkLCBjcmVkZW50aWFscylcblxuXHRcdHRoaXMud3JpdGVUb1N0b3JhZ2UoKVxuXHR9XG5cblx0Z2V0Q3JlZGVudGlhbHNCeVVzZXJJZCh1c2VySWQ6IElkKTogRGV2aWNlQ29uZmlnQ3JlZGVudGlhbHMgfCBudWxsIHtcblx0XHRyZXR1cm4gdGhpcy5jb25maWcuX2NyZWRlbnRpYWxzLmdldCh1c2VySWQpID8/IG51bGxcblx0fVxuXG5cdGdldENyZWRlbnRpYWxzKCk6IEFycmF5PERldmljZUNvbmZpZ0NyZWRlbnRpYWxzPiB7XG5cdFx0cmV0dXJuIEFycmF5LmZyb20odGhpcy5jb25maWcuX2NyZWRlbnRpYWxzLnZhbHVlcygpKVxuXHR9XG5cblx0YXN5bmMgZGVsZXRlQnlVc2VySWQodXNlcklkOiBJZCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdHRoaXMuY29uZmlnLl9jcmVkZW50aWFscy5kZWxldGUodXNlcklkKVxuXG5cdFx0dGhpcy53cml0ZVRvU3RvcmFnZSgpXG5cdH1cblxuXHRhc3luYyBjbGVhckNyZWRlbnRpYWxzRGF0YSgpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHR0aGlzLmNvbmZpZy5fY3JlZGVudGlhbHMuY2xlYXIoKVxuXHRcdHRoaXMuY29uZmlnLl9lbmNyeXB0ZWRDcmVkZW50aWFsc0tleSA9IG51bGxcblx0XHR0aGlzLmNvbmZpZy5fY3JlZGVudGlhbEVuY3J5cHRpb25Nb2RlID0gbnVsbFxuXG5cdFx0dGhpcy53cml0ZVRvU3RvcmFnZSgpXG5cdH1cblxuXHRnZXRTaWdudXBUb2tlbigpOiBzdHJpbmcge1xuXHRcdHJldHVybiB0aGlzLmNvbmZpZy5fc2lnbnVwVG9rZW5cblx0fVxuXG5cdGdldFNjaGVkdWxlZEFsYXJtc01vZGVsVmVyc2lvbih1c2VySWQ6IElkKTogbnVtYmVyIHwgbnVsbCB7XG5cdFx0cmV0dXJuIHRoaXMuY29uZmlnLnNjaGVkdWxlZEFsYXJtTW9kZWxWZXJzaW9uUGVyVXNlclt1c2VySWRdID8/IG51bGxcblx0fVxuXG5cdHNldFNjaGVkdWxlZEFsYXJtc01vZGVsVmVyc2lvbih1c2VySWQ6IElkLCB2ZXJzaW9uOiBudW1iZXIpOiB2b2lkIHtcblx0XHR0aGlzLmNvbmZpZy5zY2hlZHVsZWRBbGFybU1vZGVsVmVyc2lvblBlclVzZXJbdXNlcklkXSA9IHZlcnNpb25cblx0XHR0aGlzLndyaXRlVG9TdG9yYWdlKClcblx0fVxuXG5cdHNldE5vQWxhcm1zU2NoZWR1bGVkKCkge1xuXHRcdHRoaXMuY29uZmlnLnNjaGVkdWxlZEFsYXJtTW9kZWxWZXJzaW9uUGVyVXNlciA9IHt9XG5cdFx0dGhpcy53cml0ZVRvU3RvcmFnZSgpXG5cdH1cblxuXHRnZXRJc1NldHVwQ29tcGxldGUoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMuY29uZmlnLmlzU2V0dXBDb21wbGV0ZSA/PyBmYWxzZVxuXHR9XG5cblx0c2V0SXNTZXR1cENvbXBsZXRlKHZhbHVlOiBib29sZWFuKTogdm9pZCB7XG5cdFx0dGhpcy5jb25maWcuaXNTZXR1cENvbXBsZXRlID0gdmFsdWVcblx0XHR0aGlzLndyaXRlVG9TdG9yYWdlKClcblx0fVxuXG5cdGdldElzQ3JlZGVudGlhbHNNaWdyYXRlZFRvTmF0aXZlKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiB0aGlzLmNvbmZpZy5pc0NyZWRlbnRpYWxzTWlncmF0ZWRUb05hdGl2ZSA/PyBmYWxzZVxuXHR9XG5cblx0c2V0SXNDcmVkZW50aWFsc01pZ3JhdGVkVG9OYXRpdmUodmFsdWU6IGJvb2xlYW4pOiB2b2lkIHtcblx0XHR0aGlzLmNvbmZpZy5pc0NyZWRlbnRpYWxzTWlncmF0ZWRUb05hdGl2ZSA9IHZhbHVlXG5cdFx0dGhpcy53cml0ZVRvU3RvcmFnZSgpXG5cdH1cblxuXHRnZXRMYXN0RXh0ZXJuYWxDYWxlbmRhclN5bmMoKTogTWFwPElkLCBMYXN0RXh0ZXJuYWxDYWxlbmRhclN5bmNFbnRyeT4ge1xuXHRcdHJldHVybiB0aGlzLmxhc3RTeW5jU3RyZWFtKClcblx0fVxuXG5cdHNldExhc3RFeHRlcm5hbENhbGVuZGFyU3luYyh2YWx1ZTogTWFwPElkLCBMYXN0RXh0ZXJuYWxDYWxlbmRhclN5bmNFbnRyeT4pOiB2b2lkIHtcblx0XHR0aGlzLmNvbmZpZy5sYXN0RXh0ZXJuYWxDYWxlbmRhclN5bmMgPSBPYmplY3QuZnJvbUVudHJpZXModmFsdWUpXG5cdFx0dGhpcy53cml0ZVRvU3RvcmFnZSgpXG5cdFx0dGhpcy5sYXN0U3luY1N0cmVhbSh2YWx1ZSlcblx0fVxuXG5cdHVwZGF0ZUxhc3RTeW5jKGdyb3VwSWQ6IElkLCBsYXN0U3luY1N0YXR1czogU3luY1N0YXR1cyA9IFN5bmNTdGF0dXMuU3VjY2Vzcykge1xuXHRcdGNvbnN0IGxhc3RFeHRlcm5hbENhbGVuZGFyU3luYyA9IHRoaXMuZ2V0TGFzdEV4dGVybmFsQ2FsZW5kYXJTeW5jKClcblx0XHRjb25zdCBsYXN0U3VjY2Vzc2Z1bFN5bmMgPSBsYXN0U3luY1N0YXR1cyA9PT0gU3luY1N0YXR1cy5TdWNjZXNzID8gRGF0ZS5ub3coKSA6IGxhc3RFeHRlcm5hbENhbGVuZGFyU3luYy5nZXQoZ3JvdXBJZCk/Lmxhc3RTdWNjZXNzZnVsU3luY1xuXHRcdGxhc3RFeHRlcm5hbENhbGVuZGFyU3luYy5zZXQoZ3JvdXBJZCwgeyBsYXN0U3VjY2Vzc2Z1bFN5bmMsIGxhc3RTeW5jU3RhdHVzIH0pXG5cdFx0dGhpcy5zZXRMYXN0RXh0ZXJuYWxDYWxlbmRhclN5bmMobGFzdEV4dGVybmFsQ2FsZW5kYXJTeW5jKVxuXHR9XG5cblx0Z2V0TGFzdFN5bmNTdHJlYW0oKSB7XG5cdFx0cmV0dXJuIHRoaXMubGFzdFN5bmNTdHJlYW1cblx0fVxuXG5cdHJlbW92ZUxhc3RTeW5jKGdyb3VwSWQ6IElkKSB7XG5cdFx0Y29uc3QgbGFzdEV4dGVybmFsQ2FsZW5kYXJTeW5jID0gdGhpcy5nZXRMYXN0RXh0ZXJuYWxDYWxlbmRhclN5bmMoKVxuXHRcdGlmIChsYXN0RXh0ZXJuYWxDYWxlbmRhclN5bmMuZGVsZXRlKGdyb3VwSWQpKSB0aGlzLnNldExhc3RFeHRlcm5hbENhbGVuZGFyU3luYyhsYXN0RXh0ZXJuYWxDYWxlbmRhclN5bmMpXG5cdH1cblxuXHRnZXRMYW5ndWFnZSgpOiBMYW5ndWFnZUNvZGUgfCBudWxsIHtcblx0XHRyZXR1cm4gdGhpcy5jb25maWcuX2xhbmd1YWdlXG5cdH1cblxuXHRzZXRMYW5ndWFnZShsYW5ndWFnZTogTGFuZ3VhZ2VDb2RlIHwgbnVsbCkge1xuXHRcdHRoaXMuY29uZmlnLl9sYW5ndWFnZSA9IGxhbmd1YWdlXG5cdFx0dGhpcy53cml0ZVRvU3RvcmFnZSgpXG5cdH1cblxuXHRwcml2YXRlIHdyaXRlVG9TdG9yYWdlKCkge1xuXHRcdHRyeSB7XG5cdFx0XHRpZiAodGhpcy5sb2NhbFN0b3JhZ2UgIT0gbnVsbCkge1xuXHRcdFx0XHR0aGlzLmxvY2FsU3RvcmFnZS5zZXRJdGVtKFxuXHRcdFx0XHRcdERldmljZUNvbmZpZy5Mb2NhbFN0b3JhZ2VLZXksXG5cdFx0XHRcdFx0SlNPTi5zdHJpbmdpZnkodGhpcy5jb25maWcsIChrZXksIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAoa2V5ID09PSBcIl9jcmVkZW50aWFsc1wiKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBPYmplY3QuZnJvbUVudHJpZXModGhpcy5jb25maWcuX2NyZWRlbnRpYWxzLmVudHJpZXMoKSlcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoa2V5ID09PSBcImNsaWVudE9ubHlDYWxlbmRhcnNcIikge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKHRoaXMuY29uZmlnLmNsaWVudE9ubHlDYWxlbmRhcnMuZW50cmllcygpKVxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlXG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSksXG5cdFx0XHRcdClcblx0XHRcdH1cblx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHQvLyBtYXkgb2NjdXIgaW4gU2FmYXJpIDwgMTEgaW4gaW5jb2duaXRvIG1vZGUgYmVjYXVzZSBpdCB0aHJvd3MgYSBRdW90YUV4Y2VlZGVkRXJyb3Jcblx0XHRcdC8vIERPTUV4Y2VwdGlvbiB3aWxsIG9jY3VyciBpZiBhbGwgY29va2llcyBhcmUgZGlzYWJsZWRcblx0XHRcdGNvbnNvbGUubG9nKFwiY291bGQgbm90IHN0b3JlIGNvbmZpZ1wiLCBlKVxuXHRcdH1cblx0fVxuXG5cdGdldFRoZW1lKCk6IFRoZW1lUHJlZmVyZW5jZSB7XG5cdFx0cmV0dXJuIHRoaXMuY29uZmlnLl90aGVtZUlkXG5cdH1cblxuXHRzZXRUaGVtZSh0aGVtZTogVGhlbWVQcmVmZXJlbmNlKSB7XG5cdFx0aWYgKHRoaXMuY29uZmlnLl90aGVtZUlkICE9PSB0aGVtZSkge1xuXHRcdFx0dGhpcy5jb25maWcuX3RoZW1lSWQgPSB0aGVtZVxuXG5cdFx0XHR0aGlzLndyaXRlVG9TdG9yYWdlKClcblx0XHR9XG5cdH1cblxuXHRnZXREZWZhdWx0Q2FsZW5kYXJWaWV3KHVzZXJJZDogSWQpOiBDYWxlbmRhclZpZXdUeXBlIHwgbnVsbCB7XG5cdFx0cmV0dXJuIHRoaXMuY29uZmlnLl9kZWZhdWx0Q2FsZW5kYXJWaWV3W3VzZXJJZF1cblx0fVxuXG5cdHNldERlZmF1bHRDYWxlbmRhclZpZXcodXNlcklkOiBJZCwgZGVmYXVsdFZpZXc6IENhbGVuZGFyVmlld1R5cGUpIHtcblx0XHRpZiAodGhpcy5jb25maWcuX2RlZmF1bHRDYWxlbmRhclZpZXdbdXNlcklkXSAhPT0gZGVmYXVsdFZpZXcpIHtcblx0XHRcdHRoaXMuY29uZmlnLl9kZWZhdWx0Q2FsZW5kYXJWaWV3W3VzZXJJZF0gPSBkZWZhdWx0Vmlld1xuXG5cdFx0XHR0aGlzLndyaXRlVG9TdG9yYWdlKClcblx0XHR9XG5cdH1cblxuXHRnZXRIaWRkZW5DYWxlbmRhcnModXNlcjogSWQpOiBJZFtdIHtcblx0XHRyZXR1cm4gdGhpcy5jb25maWcuX2hpZGRlbkNhbGVuZGFyc1t1c2VyXSA/PyBbXVxuXHR9XG5cblx0c2V0SGlkZGVuQ2FsZW5kYXJzKHVzZXI6IElkLCBjYWxlbmRhcnM6IElkW10pIHtcblx0XHRpZiAodGhpcy5jb25maWcuX2hpZGRlbkNhbGVuZGFyc1t1c2VyXSAhPT0gY2FsZW5kYXJzKSB7XG5cdFx0XHR0aGlzLmNvbmZpZy5faGlkZGVuQ2FsZW5kYXJzW3VzZXJdID0gY2FsZW5kYXJzXG5cblx0XHRcdHRoaXMud3JpdGVUb1N0b3JhZ2UoKVxuXHRcdH1cblx0fVxuXG5cdGdldEV4cGFuZGVkRm9sZGVycyh1c2VyOiBJZCk6IElkW10ge1xuXHRcdHJldHVybiB0aGlzLmNvbmZpZy5leHBhbmRlZE1haWxGb2xkZXJzW3VzZXJdID8/IFtdXG5cdH1cblxuXHRzZXRFeHBhbmRlZEZvbGRlcnModXNlcjogSWQsIGZvbGRlcnM6IElkW10pIHtcblx0XHRpZiAodGhpcy5jb25maWcuZXhwYW5kZWRNYWlsRm9sZGVyc1t1c2VyXSAhPT0gZm9sZGVycykge1xuXHRcdFx0dGhpcy5jb25maWcuZXhwYW5kZWRNYWlsRm9sZGVyc1t1c2VyXSA9IGZvbGRlcnNcblxuXHRcdFx0dGhpcy53cml0ZVRvU3RvcmFnZSgpXG5cdFx0fVxuXHR9XG5cblx0aGFzQWNrbm93bGVkZ2VkTmV3c0l0ZW1Gb3JEZXZpY2UobmV3c0l0ZW1JZDogSWQpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdGhpcy5jb25maWcuYWNrbm93bGVkZ2VkTmV3c0l0ZW1zLmluY2x1ZGVzKG5ld3NJdGVtSWQpXG5cdH1cblxuXHRhY2tub3dsZWRnZU5ld3NJdGVtRm9yRGV2aWNlKG5ld3NJdGVtSWQ6IElkKSB7XG5cdFx0aWYgKCF0aGlzLmNvbmZpZy5hY2tub3dsZWRnZWROZXdzSXRlbXMuaW5jbHVkZXMobmV3c0l0ZW1JZCkpIHtcblx0XHRcdHRoaXMuY29uZmlnLmFja25vd2xlZGdlZE5ld3NJdGVtcy5wdXNoKG5ld3NJdGVtSWQpXG5cdFx0XHR0aGlzLndyaXRlVG9TdG9yYWdlKClcblx0XHR9XG5cdH1cblxuXHRhc3luYyBnZXRDcmVkZW50aWFsRW5jcnlwdGlvbk1vZGUoKTogUHJvbWlzZTxDcmVkZW50aWFsRW5jcnlwdGlvbk1vZGUgfCBudWxsPiB7XG5cdFx0cmV0dXJuIHRoaXMuY29uZmlnLl9jcmVkZW50aWFsRW5jcnlwdGlvbk1vZGVcblx0fVxuXG5cdGFzeW5jIGdldENyZWRlbnRpYWxzRW5jcnlwdGlvbktleSgpOiBQcm9taXNlPFVpbnQ4QXJyYXkgfCBudWxsPiB7XG5cdFx0cmV0dXJuIHRoaXMuY29uZmlnLl9lbmNyeXB0ZWRDcmVkZW50aWFsc0tleSA/IGJhc2U2NFRvVWludDhBcnJheSh0aGlzLmNvbmZpZy5fZW5jcnlwdGVkQ3JlZGVudGlhbHNLZXkpIDogbnVsbFxuXHR9XG5cblx0YXN5bmMgZ2V0VGVzdERldmljZUlkKCk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuXHRcdHJldHVybiB0aGlzLmNvbmZpZy5fdGVzdERldmljZUlkXG5cdH1cblxuXHRhc3luYyBzdG9yZVRlc3REZXZpY2VJZCh0ZXN0RGV2aWNlSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuXHRcdHRoaXMuY29uZmlnLl90ZXN0RGV2aWNlSWQgPSB0ZXN0RGV2aWNlSWRcblx0XHR0aGlzLndyaXRlVG9TdG9yYWdlKClcblx0fVxuXG5cdGFzeW5jIGdldEFzc2lnbm1lbnRzKCk6IFByb21pc2U8UGVyc2lzdGVkQXNzaWdubWVudERhdGEgfCBudWxsPiB7XG5cdFx0cmV0dXJuIHRoaXMuY29uZmlnLl90ZXN0QXNzaWdubWVudHNcblx0fVxuXG5cdGFzeW5jIHN0b3JlQXNzaWdubWVudHMocGVyc2lzdGVkQXNzaWdubWVudERhdGE6IFBlcnNpc3RlZEFzc2lnbm1lbnREYXRhKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0dGhpcy5jb25maWcuX3Rlc3RBc3NpZ25tZW50cyA9IHBlcnNpc3RlZEFzc2lnbm1lbnREYXRhXG5cdFx0dGhpcy53cml0ZVRvU3RvcmFnZSgpXG5cdH1cblxuXHRnZXRPZmZsaW5lVGltZVJhbmdlRGF5cyh1c2VySWQ6IElkKTogbnVtYmVyIHwgbnVsbCB7XG5cdFx0cmV0dXJuIHRoaXMuY29uZmlnLm9mZmxpbmVUaW1lUmFuZ2VEYXlzQnlVc2VyW3VzZXJJZF1cblx0fVxuXG5cdHNldE9mZmxpbmVUaW1lUmFuZ2VEYXlzKHVzZXJJZDogSWQsIGRheXM6IG51bWJlcikge1xuXHRcdHRoaXMuY29uZmlnLm9mZmxpbmVUaW1lUmFuZ2VEYXlzQnlVc2VyW3VzZXJJZF0gPSBkYXlzXG5cdFx0dGhpcy53cml0ZVRvU3RvcmFnZSgpXG5cdH1cblxuXHRnZXRDb252ZXJzYXRpb25WaWV3U2hvd09ubHlTZWxlY3RlZE1haWwoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMuY29uZmlnLmNvbnZlcnNhdGlvblZpZXdTaG93T25seVNlbGVjdGVkTWFpbFxuXHR9XG5cblx0c2V0Q29udmVyc2F0aW9uVmlld1Nob3dPbmx5U2VsZWN0ZWRNYWlsKHNldHRpbmc6IGJvb2xlYW4pIHtcblx0XHR0aGlzLmNvbmZpZy5jb252ZXJzYXRpb25WaWV3U2hvd09ubHlTZWxlY3RlZE1haWwgPSBzZXR0aW5nXG5cdFx0dGhpcy53cml0ZVRvU3RvcmFnZSgpXG5cdH1cblxuXHRnZXRVc2VyU3luY0NvbnRhY3RzV2l0aFBob25lUHJlZmVyZW5jZShpZDogSWQpOiBib29sZWFuIHwgbnVsbCB7XG5cdFx0cmV0dXJuIHRoaXMuY29uZmlnLnN5bmNDb250YWN0c1dpdGhQaG9uZVByZWZlcmVuY2VbaWRdID8/IG51bGxcblx0fVxuXG5cdHNldFVzZXJTeW5jQ29udGFjdHNXaXRoUGhvbmVQcmVmZXJlbmNlKHVzZXI6IElkLCB2YWx1ZTogYm9vbGVhbikge1xuXHRcdHRoaXMuY29uZmlnLnN5bmNDb250YWN0c1dpdGhQaG9uZVByZWZlcmVuY2VbdXNlcl0gPSB2YWx1ZVxuXHRcdHRoaXMud3JpdGVUb1N0b3JhZ2UoKVxuXHR9XG5cblx0aXNDYWxlbmRhckRheVNlbGVjdG9yRXhwYW5kZWQoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMuY29uZmlnLmlzQ2FsZW5kYXJEYXlTZWxlY3RvckV4cGFuZGVkXG5cdH1cblxuXHRzZXRDYWxlbmRhckRheVNlbGVjdG9yRXhwYW5kZWQoZXhwYW5kZWQ6IGJvb2xlYW4pIHtcblx0XHR0aGlzLmNvbmZpZy5pc0NhbGVuZGFyRGF5U2VsZWN0b3JFeHBhbmRlZCA9IGV4cGFuZGVkXG5cdFx0dGhpcy53cml0ZVRvU3RvcmFnZSgpXG5cdH1cblxuXHRnZXRNYWlsQXV0b1NlbGVjdEJlaGF2aW9yKCk6IExpc3RBdXRvU2VsZWN0QmVoYXZpb3Ige1xuXHRcdHJldHVybiB0aGlzLmNvbmZpZy5tYWlsQXV0b1NlbGVjdEJlaGF2aW9yXG5cdH1cblxuXHRzZXRNYWlsQXV0b1NlbGVjdEJlaGF2aW9yKGFjdGlvbjogTGlzdEF1dG9TZWxlY3RCZWhhdmlvcikge1xuXHRcdHRoaXMuY29uZmlnLm1haWxBdXRvU2VsZWN0QmVoYXZpb3IgPSBhY3Rpb25cblx0XHR0aGlzLndyaXRlVG9TdG9yYWdlKClcblx0fVxuXG5cdGdldENsaWVudE9ubHlDYWxlbmRhcnMoKSB7XG5cdFx0cmV0dXJuIHRoaXMuY29uZmlnLmNsaWVudE9ubHlDYWxlbmRhcnNcblx0fVxuXG5cdHVwZGF0ZUNsaWVudE9ubHlDYWxlbmRhcnMoY2FsZW5kYXJJZDogSWQsIGNsaWVudE9ubHlDYWxlbmRhckNvbmZpZzogQ2xpZW50T25seUNhbGVuZGFyc0luZm8pOiB2b2lkIHtcblx0XHR0aGlzLmNvbmZpZy5jbGllbnRPbmx5Q2FsZW5kYXJzLnNldChjYWxlbmRhcklkLCBjbGllbnRPbmx5Q2FsZW5kYXJDb25maWcpXG5cdFx0dGhpcy53cml0ZVRvU3RvcmFnZSgpXG5cdH1cblxuXHRwdWJsaWMgd3JpdGVFdmVudHMoZXZlbnRzOiBEYXRlW10pOiB2b2lkIHtcblx0XHR0aGlzLmNvbmZpZy5ldmVudHMgPSBldmVudHMubWFwKChkYXRlKSA9PiBkYXRlLmdldFRpbWUoKSlcblx0XHR0aGlzLndyaXRlVG9TdG9yYWdlKClcblx0fVxuXG5cdC8qKlxuXHQgKiBHZXRzIGEgbGlzdCBvZiBkYXRlcyBvbiB3aGljaCBhIGNlcnRhaW4gZXZlbnQgaGFzIG9jY3VycmVkLiBDb3VsZCBiZSBlbWFpbCBzZW50LCByZXBsaWVkLCBjb250YWN0IGNyZWF0ZWQgZXRjLlxuXHQgKlxuXHQgKiBPbmx5IHByZXNlbnQgb24gaU9TLlxuXHQgKi9cblx0cHVibGljIGdldEV2ZW50cygpOiBEYXRlW10ge1xuXHRcdHJldHVybiAodGhpcy5jb25maWcuZXZlbnRzID8/IFtdKS5mbGF0TWFwKCh0aW1lc3RhbXApID0+IHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHJldHVybiBuZXcgRGF0ZSh0aW1lc3RhbXApXG5cdFx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHRcdHJldHVybiBbXVxuXHRcdFx0fVxuXHRcdH0pXG5cdH1cblxuXHRwdWJsaWMgc2V0TGFzdFJhdGluZ1Byb21wdGVkRGF0ZShkYXRlOiBEYXRlKTogdm9pZCB7XG5cdFx0dGhpcy5jb25maWcubGFzdFJhdGluZ1Byb21wdGVkRGF0ZSA9IGRhdGUuZ2V0VGltZSgpXG5cdFx0dGhpcy53cml0ZVRvU3RvcmFnZSgpXG5cdH1cblxuXHQvKipcblx0ICogR2V0cyB0aGUgbGFzdCBkYXRlIG9uIHdoaWNoIHRoZSB1c2VyIHdhcyBwcm9tcHRlZCB0byByYXRlIHRoZSBhcHAuXG5cdCAqL1xuXHRwdWJsaWMgZ2V0TGFzdFJhdGluZ1Byb21wdGVkRGF0ZSgpOiBEYXRlIHwgbnVsbCB7XG5cdFx0aWYgKHRoaXMuY29uZmlnLmxhc3RSYXRpbmdQcm9tcHRlZERhdGUgPT0gbnVsbCkge1xuXHRcdFx0cmV0dXJuIG51bGxcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0cmV0dXJuIG5ldyBEYXRlKHRoaXMuY29uZmlnLmxhc3RSYXRpbmdQcm9tcHRlZERhdGUpXG5cdFx0fSBjYXRjaCAoZSkge1xuXHRcdFx0cmV0dXJuIG51bGxcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogU2V0cyB0aGUgZGF0ZSBvZiB0aGUgZWFybGllc3QgcG9zc2libGUgbmV4dCBkYXRlIGZyb20gd2hpY2ggYW5vdGhlciByYXRpbmcgY2FuIGJlIHJlcXVlc3RlZCBmcm9tIHRoZSB1c2VyLlxuXHQgKi9cblx0cHVibGljIHNldFJldHJ5UmF0aW5nUHJvbXB0QWZ0ZXIoZGF0ZTogRGF0ZSk6IHZvaWQge1xuXHRcdHRoaXMuY29uZmlnLnJldHJ5UmF0aW5nUHJvbXB0QWZ0ZXIgPSBkYXRlLmdldFRpbWUoKVxuXHRcdHRoaXMud3JpdGVUb1N0b3JhZ2UoKVxuXHR9XG5cblx0LyoqXG5cdCAqIEdldHMgdGhlIGRhdGUgb2YgdGhlIGVhcmxpZXN0IHBvc3NpYmxlIG5leHQgZGF0ZSBmcm9tIHdoaWNoIGFub3RoZXIgcmF0aW5nIGNhbiBiZSByZXF1ZXN0ZWQgZnJvbSB0aGUgdXNlci5cblx0ICovXG5cdHB1YmxpYyBnZXRSZXRyeVJhdGluZ1Byb21wdEFmdGVyKCk6IERhdGUgfCBudWxsIHtcblx0XHRpZiAodGhpcy5jb25maWcucmV0cnlSYXRpbmdQcm9tcHRBZnRlciA9PSBudWxsKSB7XG5cdFx0XHRyZXR1cm4gbnVsbFxuXHRcdH1cblxuXHRcdHRyeSB7XG5cdFx0XHRyZXR1cm4gbmV3IERhdGUodGhpcy5jb25maWcucmV0cnlSYXRpbmdQcm9tcHRBZnRlcilcblx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHRyZXR1cm4gbnVsbFxuXHRcdH1cblx0fVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbWlncmF0ZUNvbmZpZyhsb2FkZWRDb25maWc6IGFueSkge1xuXHRpZiAobG9hZGVkQ29uZmlnID09PSBEZXZpY2VDb25maWcuVmVyc2lvbikge1xuXHRcdHRocm93IG5ldyBQcm9ncmFtbWluZ0Vycm9yKFwiU2hvdWxkIG5vdCBtaWdyYXRlIGNyZWRlbnRpYWxzLCBjdXJyZW50IHZlcnNpb25cIilcblx0fVxuXG5cdGlmIChsb2FkZWRDb25maWcuX3ZlcnNpb24gPCAyKSB7XG5cdFx0bG9hZGVkQ29uZmlnLl9jcmVkZW50aWFscyA9IFtdXG5cdH1cblxuXHRpZiAobG9hZGVkQ29uZmlnLl92ZXJzaW9uIDwgMykge1xuXHRcdG1pZ3JhdGVDb25maWdWMnRvMyhsb2FkZWRDb25maWcpXG5cdH1cbn1cblxuLyoqXG4gKiBNaWdyYXRlIGZyb20gVjIgb2YgdGhlIGNvbmZpZyB0byBWM1xuICpcbiAqIEV4cG9ydGVkIGZvciB0ZXN0aW5nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtaWdyYXRlQ29uZmlnVjJ0bzMobG9hZGVkQ29uZmlnOiBhbnkpIHtcblx0Y29uc3Qgb2xkQ3JlZGVudGlhbHNBcnJheSA9IGxvYWRlZENvbmZpZy5fY3JlZGVudGlhbHNcblx0bG9hZGVkQ29uZmlnLl9jcmVkZW50aWFscyA9IHt9XG5cblx0Zm9yIChsZXQgY3JlZGVudGlhbCBvZiBvbGRDcmVkZW50aWFsc0FycmF5KSB7XG5cdFx0bGV0IGxvZ2luLCB0eXBlXG5cdFx0aWYgKGNyZWRlbnRpYWwubWFpbEFkZHJlc3MuaW5jbHVkZXMoXCJAXCIpKSB7XG5cdFx0XHRsb2dpbiA9IGNyZWRlbnRpYWwubWFpbEFkZHJlc3Ncblx0XHRcdHR5cGUgPSBcImludGVybmFsXCJcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gaW4gdmVyc2lvbiAyIGV4dGVybmFsIHVzZXJzIGhhZCB1c2VySWQgYXMgdGhlaXIgZW1haWwgYWRkcmVzc1xuXHRcdFx0Ly8gV2UgdXNlIGVuY3J5cHRpb24gc3R1YiBpbiB0aGlzIHZlcnNpb25cblx0XHRcdGxvZ2luID0gY3JlZGVudGlhbC51c2VySWRcblx0XHRcdHR5cGUgPSBcImV4dGVybmFsXCJcblx0XHR9XG5cblx0XHRsb2FkZWRDb25maWcuX2NyZWRlbnRpYWxzW2NyZWRlbnRpYWwudXNlcklkXSA9IHtcblx0XHRcdGNyZWRlbnRpYWxJbmZvOiB7XG5cdFx0XHRcdGxvZ2luLFxuXHRcdFx0XHR1c2VySWQ6IGNyZWRlbnRpYWwudXNlcklkLFxuXHRcdFx0XHR0eXBlLFxuXHRcdFx0fSxcblx0XHRcdGVuY3J5cHRlZFBhc3N3b3JkOiBjcmVkZW50aWFsLmVuY3J5cHRlZFBhc3N3b3JkLFxuXHRcdFx0YWNjZXNzVG9rZW46IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW4sXG5cdFx0XHRlbmNyeXB0ZWRQYXNzcGhyYXNlS2V5OiBudWxsLCAvLyBzaG91bGQgbm90IGJlIHByZXNlbnRcblx0XHR9XG5cdH1cbn1cblxuLyoqXG4gKiBDcmVkZW50aWFscyBhcyB0aGV5IGFyZSBzdG9yZWQgaW4gRGV2aWNlQ29uZmlnIChieXRlIGFycmF5cyByZXBsYWNlZCB3aXRoIHN0cmluZ3MgYXMgRGV2aWNlQ29uZmlnIGNhbiBvbmx5IGRlYWwgd2l0aCBzdHJpbmdzKS5cbiAqIEBwcml2YXRlIHZpc2libGVGb3JUZXN0aW5nXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRGV2aWNlQ29uZmlnQ3JlZGVudGlhbHMge1xuXHRyZWFkb25seSBjcmVkZW50aWFsSW5mbzogQ3JlZGVudGlhbHNJbmZvXG5cdHJlYWRvbmx5IGFjY2Vzc1Rva2VuOiBzdHJpbmdcblx0cmVhZG9ubHkgZGF0YWJhc2VLZXk6IEJhc2U2NCB8IG51bGxcblx0cmVhZG9ubHkgZW5jcnlwdGVkUGFzc3dvcmQ6IHN0cmluZ1xuXHRyZWFkb25seSBlbmNyeXB0ZWRQYXNzcGhyYXNlS2V5OiBCYXNlNjQgfCBudWxsXG59XG5cbmV4cG9ydCBjb25zdCBkZXZpY2VDb25maWc6IERldmljZUNvbmZpZyA9IG5ldyBEZXZpY2VDb25maWcoRGV2aWNlQ29uZmlnLlZlcnNpb24sIGNsaWVudC5sb2NhbFN0b3JhZ2UoKSA/IGxvY2FsU3RvcmFnZSA6IG51bGwpXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFnQkEsc0JBQXNCO01BQ1RBLHlCQUEwQztJQUUzQyw0REFBTDtBQUNOO0FBQ0E7QUFDQTs7QUFDQTtJQWlFWSxlQUFOLE1BQU0sYUFBMEQ7Q0FDdEUsT0FBYyxVQUFVO0NBQ3hCLE9BQWMsa0JBQWtCO0NBRWhDLEFBQVE7Q0FDUixBQUFRLGlCQUFpRSwyQkFBTyxJQUFJLE1BQU07Q0FFMUYsWUFBNkJDLFVBQW1DQyxnQkFBOEI7RUFrZDlGLEtBbGQ2QjtFQWtkNUIsS0FsZCtEO0FBQy9ELE9BQUssTUFBTTtDQUNYO0NBRUQsT0FBTztFQUNOLE1BQU0sZUFBZSxLQUFLLDRCQUE0QixJQUFJLENBQUU7RUFFNUQsSUFBSSxTQUFTO0FBQ2IsTUFBSSxhQUFhLFlBQVksUUFBUSxhQUFhLGFBQWEsYUFBYSxTQUFTO0FBQ3BGLGlCQUFjLGFBQWE7QUFDM0IsWUFBUztFQUNUO0VBRUQsSUFBSTtBQUNKLE1BQUksYUFBYSxhQUNoQixlQUFjLGFBQWE7S0FDckI7R0FDTixJQUFJLFFBQVEsSUFBSSxXQUFXO0dBQzNCLElBQUksU0FBUyxPQUFPO0FBQ3BCLFVBQU8sZ0JBQWdCLE1BQU07QUFDN0IsaUJBQWMsbUJBQW1CLE1BQU07QUFDdkMsWUFBUztFQUNUO0FBRUQsT0FBSyxTQUFTO0dBQ2IsVUFBVSxhQUFhO0dBQ3ZCLGNBQWMsYUFBYSxlQUFlLElBQUksSUFBSSxhQUFhLGFBQWEsYUFBYSxJQUFJLElBQUk7R0FDakcsMkJBQTJCLGFBQWEsNkJBQTZCO0dBQ3JF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