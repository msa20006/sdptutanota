import { base64ToUint8Array, mapNullable, stringToUtf8Uint8Array, uint8ArrayToBase64, utf8Uint8ArrayToString } from "./dist2-chunk.js";

//#region src/common/misc/credentials/WebCredentialsFacade.ts
var WebCredentialsFacade = class {
	constructor(deviceConfig) {
		this.deviceConfig = deviceConfig;
	}
	async clear() {
		const allCredentials = this.deviceConfig.getCredentials();
		for (const credentials of allCredentials) await this.deviceConfig.deleteByUserId(credentials.credentialInfo.userId);
	}
	deleteByUserId(id) {
		return this.deviceConfig.deleteByUserId(id);
	}
	async getCredentialEncryptionMode() {
		return null;
	}
	async loadAll() {
		return this.deviceConfig.getCredentials().map(deviceConfigCredentialsToPersisted);
	}
	async loadByUserId(id) {
		const deviceConfigCredentials = this.deviceConfig.getCredentialsByUserId(id);
		if (deviceConfigCredentials == null) return null;
		return {
			credentialInfo: deviceConfigCredentials.credentialInfo,
			encryptedPassword: deviceConfigCredentials.encryptedPassword,
			encryptedPassphraseKey: mapNullable(deviceConfigCredentials.encryptedPassphraseKey, base64ToUint8Array),
			accessToken: deviceConfigCredentials.accessToken,
			databaseKey: null
		};
	}
	async setCredentialEncryptionMode(_) {}
	async store(credentials) {
		const deviceConfigCredentials = {
			credentialInfo: credentials.credentialInfo,
			encryptedPassphraseKey: mapNullable(credentials.encryptedPassphraseKey, uint8ArrayToBase64),
			accessToken: credentials.accessToken,
			databaseKey: null,
			encryptedPassword: credentials.encryptedPassword
		};
		this.deviceConfig.storeCredentials(deviceConfigCredentials);
	}
	async storeEncrypted(credentials) {
		this.deviceConfig.storeCredentials(persistedCredentialsToDeviceConfig(credentials));
	}
	async getSupportedEncryptionModes() {
		return [];
	}
	migrateToNativeCredentials(credentials, encryptionMode, credentialsKey) {
		throw new Error("Method not implemented.");
	}
};
function persistedCredentialsToDeviceConfig(persistentCredentials) {
	return {
		credentialInfo: persistentCredentials.credentialInfo,
		encryptedPassword: persistentCredentials.encryptedPassword,
		encryptedPassphraseKey: mapNullable(persistentCredentials.encryptedPassphraseKey, uint8ArrayToBase64),
		accessToken: utf8Uint8ArrayToString(persistentCredentials.accessToken),
		databaseKey: mapNullable(persistentCredentials.databaseKey, uint8ArrayToBase64)
	};
}
function deviceConfigCredentialsToPersisted(deviceConfigCredentials) {
	return {
		credentialInfo: deviceConfigCredentials.credentialInfo,
		encryptedPassword: deviceConfigCredentials.encryptedPassword,
		encryptedPassphraseKey: mapNullable(deviceConfigCredentials.encryptedPassphraseKey, base64ToUint8Array),
		accessToken: stringToUtf8Uint8Array(deviceConfigCredentials.accessToken),
		databaseKey: mapNullable(deviceConfigCredentials.databaseKey, base64ToUint8Array)
	};
}

//#endregion
export { WebCredentialsFacade };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2ViQ3JlZGVudGlhbHNGYWNhZGUtY2h1bmsuanMiLCJuYW1lcyI6WyJkZXZpY2VDb25maWc6IERldmljZUNvbmZpZyIsImlkOiBzdHJpbmciLCJfOiBDcmVkZW50aWFsRW5jcnlwdGlvbk1vZGUiLCJjcmVkZW50aWFsczogVW5lbmNyeXB0ZWRDcmVkZW50aWFscyIsImRldmljZUNvbmZpZ0NyZWRlbnRpYWxzOiBEZXZpY2VDb25maWdDcmVkZW50aWFscyIsImNyZWRlbnRpYWxzOiBQZXJzaXN0ZWRDcmVkZW50aWFscyIsImNyZWRlbnRpYWxzOiBSZWFkb25seUFycmF5PFBlcnNpc3RlZENyZWRlbnRpYWxzPiIsImVuY3J5cHRpb25Nb2RlOiBDcmVkZW50aWFsRW5jcnlwdGlvbk1vZGUgfCBudWxsIiwiY3JlZGVudGlhbHNLZXk6IFVpbnQ4QXJyYXkgfCBudWxsIiwicGVyc2lzdGVudENyZWRlbnRpYWxzOiBQZXJzaXN0ZWRDcmVkZW50aWFscyJdLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21tb24vbWlzYy9jcmVkZW50aWFscy9XZWJDcmVkZW50aWFsc0ZhY2FkZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQZXJzaXN0ZWRDcmVkZW50aWFscyB9IGZyb20gXCIuLi8uLi9uYXRpdmUvY29tbW9uL2dlbmVyYXRlZGlwYy9QZXJzaXN0ZWRDcmVkZW50aWFscy5qc1wiXG5pbXBvcnQgeyBOYXRpdmVDcmVkZW50aWFsc0ZhY2FkZSB9IGZyb20gXCIuLi8uLi9uYXRpdmUvY29tbW9uL2dlbmVyYXRlZGlwYy9OYXRpdmVDcmVkZW50aWFsc0ZhY2FkZS5qc1wiXG5pbXBvcnQgeyBEZXZpY2VDb25maWcsIERldmljZUNvbmZpZ0NyZWRlbnRpYWxzIH0gZnJvbSBcIi4uL0RldmljZUNvbmZpZy5qc1wiXG5pbXBvcnQgeyBDcmVkZW50aWFsRW5jcnlwdGlvbk1vZGUgfSBmcm9tIFwiLi9DcmVkZW50aWFsRW5jcnlwdGlvbk1vZGUuanNcIlxuaW1wb3J0IHsgVW5lbmNyeXB0ZWRDcmVkZW50aWFscyB9IGZyb20gXCIuLi8uLi9uYXRpdmUvY29tbW9uL2dlbmVyYXRlZGlwYy9VbmVuY3J5cHRlZENyZWRlbnRpYWxzLmpzXCJcbmltcG9ydCB7IGJhc2U2NFRvVWludDhBcnJheSwgbWFwTnVsbGFibGUsIHN0cmluZ1RvVXRmOFVpbnQ4QXJyYXksIHVpbnQ4QXJyYXlUb0Jhc2U2NCwgdXRmOFVpbnQ4QXJyYXlUb1N0cmluZyB9IGZyb20gXCJAdHV0YW8vdHV0YW5vdGEtdXRpbHNcIlxuXG4vKipcbiAqIFRoaXMgaXMgYSB0ZW1wb3Jhcnkgc3R1YiB0aGF0IHdlIHdpbGwgcmVwbGFjZSBzb29uIGJ5IHNvbWUgbWVjaGFuaXNtIHRoYXQgd2lsbCBiZSBhYmxlIHRvIHV0aWxpemUgZmluZ2VycHJpbnQvcGluIG9uIG1vYmlsZSBkZXZpY2VzXG4gKiBmb3IgZW5jcnlwdGlvbiBvZiBsb2dpbiBkYXRhLiBVc2luZyB0aGlzIGltcGxlbWVudGF0aW9uIGRvZXMgbm90IG1lYW4gd2UgZG8gbm90IGVuY3J5cHQgY3JlZGVudGlhbHMgY3VycmVudGx5IHNpbmNlIHRoZXJlIGlzIGFuXG4gKiBhZGRpdGlvbmFsIG1lY2hhbmlzbSBmb3IgY3JlZGVudGlhbHMgZW5jcnlwdGlvbiB1c2luZyBhbiBhY2Nlc3Mga2V5IHN0b3JlZCBzZXJ2ZXIgc2lkZS4gVGhpcyBpcyBkb25lIGluIExvZ2luRmFjYWRlLlxuICovXG5cbmV4cG9ydCBjbGFzcyBXZWJDcmVkZW50aWFsc0ZhY2FkZSBpbXBsZW1lbnRzIE5hdGl2ZUNyZWRlbnRpYWxzRmFjYWRlIHtcblx0Y29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBkZXZpY2VDb25maWc6IERldmljZUNvbmZpZykge31cblxuXHRhc3luYyBjbGVhcigpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRjb25zdCBhbGxDcmVkZW50aWFscyA9IHRoaXMuZGV2aWNlQ29uZmlnLmdldENyZWRlbnRpYWxzKClcblx0XHRmb3IgKGNvbnN0IGNyZWRlbnRpYWxzIG9mIGFsbENyZWRlbnRpYWxzKSB7XG5cdFx0XHRhd2FpdCB0aGlzLmRldmljZUNvbmZpZy5kZWxldGVCeVVzZXJJZChjcmVkZW50aWFscy5jcmVkZW50aWFsSW5mby51c2VySWQpXG5cdFx0fVxuXHR9XG5cblx0ZGVsZXRlQnlVc2VySWQoaWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuXHRcdHJldHVybiB0aGlzLmRldmljZUNvbmZpZy5kZWxldGVCeVVzZXJJZChpZClcblx0fVxuXG5cdGFzeW5jIGdldENyZWRlbnRpYWxFbmNyeXB0aW9uTW9kZSgpOiBQcm9taXNlPENyZWRlbnRpYWxFbmNyeXB0aW9uTW9kZSB8IG51bGw+IHtcblx0XHRyZXR1cm4gbnVsbFxuXHR9XG5cblx0YXN5bmMgbG9hZEFsbCgpOiBQcm9taXNlPFJlYWRvbmx5QXJyYXk8UGVyc2lzdGVkQ3JlZGVudGlhbHM+PiB7XG5cdFx0cmV0dXJuIHRoaXMuZGV2aWNlQ29uZmlnLmdldENyZWRlbnRpYWxzKCkubWFwKGRldmljZUNvbmZpZ0NyZWRlbnRpYWxzVG9QZXJzaXN0ZWQpXG5cdH1cblxuXHRhc3luYyBsb2FkQnlVc2VySWQoaWQ6IHN0cmluZyk6IFByb21pc2U8VW5lbmNyeXB0ZWRDcmVkZW50aWFscyB8IG51bGw+IHtcblx0XHRjb25zdCBkZXZpY2VDb25maWdDcmVkZW50aWFscyA9IHRoaXMuZGV2aWNlQ29uZmlnLmdldENyZWRlbnRpYWxzQnlVc2VySWQoaWQpXG5cdFx0aWYgKGRldmljZUNvbmZpZ0NyZWRlbnRpYWxzID09IG51bGwpIHJldHVybiBudWxsXG5cdFx0cmV0dXJuIHtcblx0XHRcdGNyZWRlbnRpYWxJbmZvOiBkZXZpY2VDb25maWdDcmVkZW50aWFscy5jcmVkZW50aWFsSW5mbyxcblx0XHRcdGVuY3J5cHRlZFBhc3N3b3JkOiBkZXZpY2VDb25maWdDcmVkZW50aWFscy5lbmNyeXB0ZWRQYXNzd29yZCxcblx0XHRcdGVuY3J5cHRlZFBhc3NwaHJhc2VLZXk6IG1hcE51bGxhYmxlKGRldmljZUNvbmZpZ0NyZWRlbnRpYWxzLmVuY3J5cHRlZFBhc3NwaHJhc2VLZXksIGJhc2U2NFRvVWludDhBcnJheSksXG5cdFx0XHRhY2Nlc3NUb2tlbjogZGV2aWNlQ29uZmlnQ3JlZGVudGlhbHMuYWNjZXNzVG9rZW4sXG5cdFx0XHRkYXRhYmFzZUtleTogbnVsbCxcblx0XHR9XG5cdH1cblxuXHRhc3luYyBzZXRDcmVkZW50aWFsRW5jcnlwdGlvbk1vZGUoXzogQ3JlZGVudGlhbEVuY3J5cHRpb25Nb2RlKTogUHJvbWlzZTx2b2lkPiB7fVxuXG5cdGFzeW5jIHN0b3JlKGNyZWRlbnRpYWxzOiBVbmVuY3J5cHRlZENyZWRlbnRpYWxzKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0Y29uc3QgZGV2aWNlQ29uZmlnQ3JlZGVudGlhbHM6IERldmljZUNvbmZpZ0NyZWRlbnRpYWxzID0ge1xuXHRcdFx0Y3JlZGVudGlhbEluZm86IGNyZWRlbnRpYWxzLmNyZWRlbnRpYWxJbmZvLFxuXHRcdFx0ZW5jcnlwdGVkUGFzc3BocmFzZUtleTogbWFwTnVsbGFibGUoY3JlZGVudGlhbHMuZW5jcnlwdGVkUGFzc3BocmFzZUtleSwgdWludDhBcnJheVRvQmFzZTY0KSxcblx0XHRcdGFjY2Vzc1Rva2VuOiBjcmVkZW50aWFscy5hY2Nlc3NUb2tlbixcblx0XHRcdGRhdGFiYXNlS2V5OiBudWxsLFxuXHRcdFx0ZW5jcnlwdGVkUGFzc3dvcmQ6IGNyZWRlbnRpYWxzLmVuY3J5cHRlZFBhc3N3b3JkLFxuXHRcdH1cblx0XHR0aGlzLmRldmljZUNvbmZpZy5zdG9yZUNyZWRlbnRpYWxzKGRldmljZUNvbmZpZ0NyZWRlbnRpYWxzKVxuXHR9XG5cblx0YXN5bmMgc3RvcmVFbmNyeXB0ZWQoY3JlZGVudGlhbHM6IFBlcnNpc3RlZENyZWRlbnRpYWxzKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0dGhpcy5kZXZpY2VDb25maWcuc3RvcmVDcmVkZW50aWFscyhwZXJzaXN0ZWRDcmVkZW50aWFsc1RvRGV2aWNlQ29uZmlnKGNyZWRlbnRpYWxzKSlcblx0fVxuXG5cdGFzeW5jIGdldFN1cHBvcnRlZEVuY3J5cHRpb25Nb2RlcygpIHtcblx0XHRyZXR1cm4gW11cblx0fVxuXG5cdG1pZ3JhdGVUb05hdGl2ZUNyZWRlbnRpYWxzKFxuXHRcdGNyZWRlbnRpYWxzOiBSZWFkb25seUFycmF5PFBlcnNpc3RlZENyZWRlbnRpYWxzPixcblx0XHRlbmNyeXB0aW9uTW9kZTogQ3JlZGVudGlhbEVuY3J5cHRpb25Nb2RlIHwgbnVsbCxcblx0XHRjcmVkZW50aWFsc0tleTogVWludDhBcnJheSB8IG51bGwsXG5cdCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpXG5cdH1cbn1cblxuZnVuY3Rpb24gcGVyc2lzdGVkQ3JlZGVudGlhbHNUb0RldmljZUNvbmZpZyhwZXJzaXN0ZW50Q3JlZGVudGlhbHM6IFBlcnNpc3RlZENyZWRlbnRpYWxzKTogRGV2aWNlQ29uZmlnQ3JlZGVudGlhbHMge1xuXHRyZXR1cm4ge1xuXHRcdGNyZWRlbnRpYWxJbmZvOiBwZXJzaXN0ZW50Q3JlZGVudGlhbHMuY3JlZGVudGlhbEluZm8sXG5cdFx0ZW5jcnlwdGVkUGFzc3dvcmQ6IHBlcnNpc3RlbnRDcmVkZW50aWFscy5lbmNyeXB0ZWRQYXNzd29yZCxcblx0XHRlbmNyeXB0ZWRQYXNzcGhyYXNlS2V5OiBtYXBOdWxsYWJsZShwZXJzaXN0ZW50Q3JlZGVudGlhbHMuZW5jcnlwdGVkUGFzc3BocmFzZUtleSwgdWludDhBcnJheVRvQmFzZTY0KSxcblx0XHRhY2Nlc3NUb2tlbjogdXRmOFVpbnQ4QXJyYXlUb1N0cmluZyhwZXJzaXN0ZW50Q3JlZGVudGlhbHMuYWNjZXNzVG9rZW4pLFxuXHRcdGRhdGFiYXNlS2V5OiBtYXBOdWxsYWJsZShwZXJzaXN0ZW50Q3JlZGVudGlhbHMuZGF0YWJhc2VLZXksIHVpbnQ4QXJyYXlUb0Jhc2U2NCksXG5cdH1cbn1cblxuZnVuY3Rpb24gZGV2aWNlQ29uZmlnQ3JlZGVudGlhbHNUb1BlcnNpc3RlZChkZXZpY2VDb25maWdDcmVkZW50aWFsczogRGV2aWNlQ29uZmlnQ3JlZGVudGlhbHMpOiBQZXJzaXN0ZWRDcmVkZW50aWFscyB7XG5cdHJldHVybiB7XG5cdFx0Y3JlZGVudGlhbEluZm86IGRldmljZUNvbmZpZ0NyZWRlbnRpYWxzLmNyZWRlbnRpYWxJbmZvLFxuXHRcdGVuY3J5cHRlZFBhc3N3b3JkOiBkZXZpY2VDb25maWdDcmVkZW50aWFscy5lbmNyeXB0ZWRQYXNzd29yZCxcblx0XHRlbmNyeXB0ZWRQYXNzcGhyYXNlS2V5OiBtYXBOdWxsYWJsZShkZXZpY2VDb25maWdDcmVkZW50aWFscy5lbmNyeXB0ZWRQYXNzcGhyYXNlS2V5LCBiYXNlNjRUb1VpbnQ4QXJyYXkpLFxuXHRcdGFjY2Vzc1Rva2VuOiBzdHJpbmdUb1V0ZjhVaW50OEFycmF5KGRldmljZUNvbmZpZ0NyZWRlbnRpYWxzLmFjY2Vzc1Rva2VuKSxcblx0XHRkYXRhYmFzZUtleTogbWFwTnVsbGFibGUoZGV2aWNlQ29uZmlnQ3JlZGVudGlhbHMuZGF0YWJhc2VLZXksIGJhc2U2NFRvVWludDhBcnJheSksXG5cdH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7O0lBYWEsdUJBQU4sTUFBOEQ7Q0FDcEUsWUFBNkJBLGNBQTRCO0VBa0Z6RCxLQWxGNkI7Q0FBOEI7Q0FFM0QsTUFBTSxRQUF1QjtFQUM1QixNQUFNLGlCQUFpQixLQUFLLGFBQWEsZ0JBQWdCO0FBQ3pELE9BQUssTUFBTSxlQUFlLGVBQ3pCLE9BQU0sS0FBSyxhQUFhLGVBQWUsWUFBWSxlQUFlLE9BQU87Q0FFMUU7Q0FFRCxlQUFlQyxJQUEyQjtBQUN6QyxTQUFPLEtBQUssYUFBYSxlQUFlLEdBQUc7Q0FDM0M7Q0FFRCxNQUFNLDhCQUF3RTtBQUM3RSxTQUFPO0NBQ1A7Q0FFRCxNQUFNLFVBQXdEO0FBQzdELFNBQU8sS0FBSyxhQUFhLGdCQUFnQixDQUFDLElBQUksbUNBQW1DO0NBQ2pGO0NBRUQsTUFBTSxhQUFhQSxJQUFvRDtFQUN0RSxNQUFNLDBCQUEwQixLQUFLLGFBQWEsdUJBQXVCLEdBQUc7QUFDNUUsTUFBSSwyQkFBMkIsS0FBTSxRQUFPO0FBQzVDLFNBQU87R0FDTixnQkFBZ0Isd0JBQXdCO0dBQ3hDLG1CQUFtQix3QkFBd0I7R0FDM0Msd0JBQXdCLFlBQVksd0JBQXdCLHdCQUF3QixtQkFBbUI7R0FDdkcsYUFBYSx3QkFBd0I7R0FDckMsYUFBYTtFQUNiO0NBQ0Q7Q0FFRCxNQUFNLDRCQUE0QkMsR0FBNEMsQ0FBRTtDQUVoRixNQUFNLE1BQU1DLGFBQW9EO0VBQy9ELE1BQU1DLDBCQUFtRDtHQUN4RCxnQkFBZ0IsWUFBWTtHQUM1Qix3QkFBd0IsWUFBWSxZQUFZLHdCQUF3QixtQkFBbUI7R0FDM0YsYUFBYSxZQUFZO0dBQ3pCLGFBQWE7R0FDYixtQkFBbUIsWUFBWTtFQUMvQjtBQUNELE9BQUssYUFBYSxpQkFBaUIsd0JBQXdCO0NBQzNEO0NBRUQsTUFBTSxlQUFlQyxhQUFrRDtBQUN0RSxPQUFLLGFBQWEsaUJBQWlCLG1DQUFtQyxZQUFZLENBQUM7Q0FDbkY7Q0FFRCxNQUFNLDhCQUE4QjtBQUNuQyxTQUFPLENBQUU7Q0FDVDtDQUVELDJCQUNDQyxhQUNBQyxnQkFDQUMsZ0JBQ2dCO0FBQ2hCLFFBQU0sSUFBSSxNQUFNO0NBQ2hCO0FBQ0Q7QUFFRCxTQUFTLG1DQUFtQ0MsdUJBQXNFO0FBQ2pILFFBQU87RUFDTixnQkFBZ0Isc0JBQXNCO0VBQ3RDLG1CQUFtQixzQkFBc0I7RUFDekMsd0JBQXdCLFlBQVksc0JBQXNCLHdCQUF3QixtQkFBbUI7RUFDckcsYUFBYSx1QkFBdUIsc0JBQXNCLFlBQVk7RUFDdEUsYUFBYSxZQUFZLHNCQUFzQixhQUFhLG1CQUFtQjtDQUMvRTtBQUNEO0FBRUQsU0FBUyxtQ0FBbUNMLHlCQUF3RTtBQUNuSCxRQUFPO0VBQ04sZ0JBQWdCLHdCQUF3QjtFQUN4QyxtQkFBbUIsd0JBQXdCO0VBQzNDLHdCQUF3QixZQUFZLHdCQUF3Qix3QkFBd0IsbUJBQW1CO0VBQ3ZHLGFBQWEsdUJBQXVCLHdCQUF3QixZQUFZO0VBQ3hFLGFBQWEsWUFBWSx3QkFBd0IsYUFBYSxtQkFBbUI7Q0FDakY7QUFDRCJ9