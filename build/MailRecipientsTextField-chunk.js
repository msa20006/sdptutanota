import { mithril_default } from "./mithril-chunk.js";
import { getFirstOrThrow } from "./dist2-chunk.js";
import { lang } from "./LanguageViewModel-chunk.js";
import { theme } from "./theme-chunk.js";
import { Keys } from "./TutanotaConstants-chunk.js";
import { windowFacade } from "./WindowFacade-chunk.js";
import { px, size } from "./size-chunk.js";
import { findRecipientWithAddress } from "./CommonCalendarUtils-chunk.js";
import { BaseButton } from "./Button-chunk.js";
import { Icons } from "./Icons-chunk.js";
import { Autocomplete, Dialog, TextField, TextFieldType, createAsyncDropdown, scrollListDom } from "./Dialog-chunk.js";
import { Icon, progressIcon } from "./Icon-chunk.js";
import { stringToNameAndMailAddress } from "./MailAddressParser-chunk.js";
import { getMailAddressDisplayText } from "./SharedMailUtils-chunk.js";

//#region src/common/gui/base/BubbleTextField.ts
var BubbleTextField = class {
	active = false;
	domInput = null;
	view({ attrs }) {
		return mithril_default(".bubble-text-field", [mithril_default(TextField, {
			label: attrs.label,
			disabled: attrs.disabled,
			value: attrs.text,
			oninput: attrs.onInput,
			helpLabel: attrs.helpLabel,
			type: TextFieldType.Email,
			autocompleteAs: Autocomplete.off,
			injectionsLeft: () => {
				return attrs.items.map((item, idx, items) => {
					const bubbleText = attrs.renderBubbleText(item);
					return mithril_default(".flex.overflow-hidden.items-end", [mithril_default(".flex-no-grow-shrink-auto.overflow-hidden", mithril_default(BaseButton, {
						label: bubbleText,
						text: bubbleText.text,
						class: "text-bubble button-content content-fg text-ellipsis flash",
						style: { "max-width": "100%" },
						onclick: (e) => {
							e.stopPropagation();
							createAsyncDropdown({
								lazyButtons: () => attrs.getBubbleDropdownAttrs(item),
								width: 250
							})(e, e.target);
						}
					})), this.active || idx < items.length - 1 || attrs.text !== "" ? mithril_default("span.pr", ",") : null]);
				});
			},
			injectionsRight: () => attrs.injectionsRight ?? null,
			oncreate: () => {
				requestAnimationFrame(() => {
					if (this.domInput) this.domInput.size = 1;
				});
			},
			onDomInputCreated: (dom) => this.domInput = dom,
			onfocus: () => {
				this.active = true;
				attrs.onFocus();
			},
			onblur: () => {
				this.active = false;
				attrs.onBlur();
			},
			keyHandler: (key) => {
				if (key.key != null) switch (key.key.toLowerCase()) {
					case Keys.BACKSPACE.code: return attrs.onBackspace();
					case Keys.RETURN.code: return attrs.onEnterKey();
					case Keys.DOWN.code: return attrs.onUpKey();
					case Keys.UP.code: return attrs.onDownKey();
				}
				return true;
			}
		})]);
	}
};

//#endregion
//#region src/common/gui/SearchDropDown.ts
const EntryHeight = 60;
var SearchDropDown = class {
	domSuggestions;
	keyboardHeight = 0;
	oncreate() {
		windowFacade.addKeyboardSizeListener((newSize) => {
			this.keyboardHeight = newSize;
		});
	}
	view({ attrs }) {
		if (attrs.selectedSuggestionIndex !== attrs.selectedSuggestionIndex && this.domSuggestions) requestAnimationFrame(() => {
			scrollListDom(this.domSuggestions, EntryHeight, attrs.selectedSuggestionIndex);
		});
		let dropdownHeight = EntryHeight * Math.min(attrs.maxHeight ?? Number.MAX_VALUE, attrs.suggestions.length);
		if (this.domSuggestions) {
			const top = this.domSuggestions.getBoundingClientRect().top;
			const availableHeight = window.innerHeight - top - this.keyboardHeight - size.vpad;
			dropdownHeight = Math.min(availableHeight, dropdownHeight);
		}
		return mithril_default(`.abs.z4.full-width.elevated-bg.scroll.text-ellipsis${attrs.suggestions.length ? ".dropdown-shadow" : ""}`, {
			oncreate: (vnode) => this.domSuggestions = vnode.dom,
			style: {
				transition: "height 0.2s",
				height: px(dropdownHeight)
			}
		}, attrs.suggestions.map((suggestion, idx) => this.renderSuggestion(attrs, suggestion, idx)));
	}
	renderSuggestion(attrs, { firstRow, secondRow, display }, idx) {
		const selected = idx === attrs.selectedSuggestionIndex;
		if (display !== undefined && !display) return null;
		return mithril_default(".pt-s.pb-s.click.content-hover", {
			class: selected ? "content-accent-fg row-selected icon-accent" : "",
			onmousedown: () => attrs.onSuggestionSelected(idx),
			style: {
				"padding-left": selected ? px(size.hpad_large - 3) : px(size.hpad_large),
				"border-left": selected ? "3px solid" : null,
				height: px(EntryHeight)
			}
		}, [mithril_default(".small.full-width.text-ellipsis", firstRow), mithril_default(".name.full-width.text-ellipsis", secondRow)]);
	}
};

//#endregion
//#region src/common/gui/MailRecipientsTextField.ts
var MailRecipientsTextField = class {
	selectedSuggestionIdx = 0;
	focused = false;
	view({ attrs }) {
		return [this.renderTextField(attrs), this.focused ? this.renderSuggestions(attrs) : null];
	}
	renderTextField(attrs) {
		return mithril_default(BubbleTextField, {
			label: attrs.label,
			text: attrs.text,
			helpLabel: attrs.helpLabel,
			onInput: (text) => {
				attrs.search.search(text).then(() => mithril_default.redraw());
				const { remainingText, newRecipients, errors } = text.length - attrs.text.length > 1 ? parsePastedInput(text) : parseTypedInput(text);
				for (const { address, name } of newRecipients) attrs.onRecipientAdded(address, name, null);
				if (errors.length === 1 && newRecipients.length === 0) attrs.onTextChanged(getFirstOrThrow(errors));
else {
					if (errors.length > 0) Dialog.message(lang.makeTranslation("invalidPastedRecipients_msg", `${lang.get("invalidPastedRecipients_msg")}\n\n${errors.join("\n")}`));
					attrs.onTextChanged(remainingText);
				}
			},
			items: attrs.recipients.map((recipient) => recipient.address),
			renderBubbleText: (address) => {
				const name = findRecipientWithAddress(attrs.recipients, address)?.name ?? null;
				return lang.makeTranslation(address, getMailAddressDisplayText(name, address, false));
			},
			getBubbleDropdownAttrs: async (address) => await attrs.getRecipientClickedDropdownAttrs?.(address) ?? [],
			onBackspace: () => {
				if (attrs.text === "" && attrs.recipients.length > 0) {
					const { address } = attrs.recipients.slice().pop();
					attrs.onTextChanged(address);
					attrs.onRecipientRemoved(address);
					return false;
				}
				return true;
			},
			onEnterKey: () => {
				this.resolveInput(attrs, true);
				return true;
			},
			onUpKey: () => {
				this.setSelectedSuggestionIdx(this.getSelectedSuggestionIdx(attrs) + 1);
				return false;
			},
			onDownKey: () => {
				this.setSelectedSuggestionIdx(this.getSelectedSuggestionIdx(attrs) - 1);
				return false;
			},
			onFocus: () => {
				this.focused = true;
			},
			onBlur: () => {
				this.focused = false;
				this.resolveInput(attrs, false);
				return true;
			},
			disabled: attrs.disabled,
			injectionsRight: mithril_default(".flex.items-center", [mithril_default(".flex.align-right.mr-s.flex.items-end.pb-s", { style: {
				width: px(20),
				height: px(size.button_height_compact)
			} }, attrs.search.isLoading() ? progressIcon() : null), attrs.injectionsRight])
		});
	}
	renderSuggestions(attrs) {
		return mithril_default(".rel", mithril_default(SearchDropDown, {
			suggestions: attrs.search.results().map((suggestion) => {
				if (suggestion.type === "recipient") return {
					firstRow: suggestion.value.name,
					secondRow: suggestion.value.address
				};
else return {
					firstRow: mithril_default(Icon, {
						icon: Icons.People,
						style: {
							fill: theme.content_fg,
							"aria-describedby": lang.get("contactListName_label")
						}
					}),
					secondRow: suggestion.value.name
				};
			}),
			selectedSuggestionIndex: this.getSelectedSuggestionIdx(attrs),
			onSuggestionSelected: (idx) => this.selectSuggestion(attrs, idx),
			maxHeight: attrs.maxSuggestionsToShow ?? null
		}));
	}
	/**
	* Resolves a typed in mail address or one of the suggested ones.
	* @param selectSuggestion boolean value indicating whether a suggestion should be selected or not. Should be true if a suggestion is explicitly selected by
	* for example hitting the enter key and false e.g. if the dialog is closed
	*/
	resolveInput(attrs, selectSuggestion) {
		const suggestions = attrs.search.results();
		if (suggestions.length > 0 && selectSuggestion) this.selectSuggestion(attrs, this.getSelectedSuggestionIdx(attrs));
else {
			const parsed = parseMailAddress(attrs.text);
			if (parsed != null) {
				attrs.onRecipientAdded(parsed.address, parsed.name, null);
				attrs.onTextChanged("");
			}
		}
	}
	async selectSuggestion(attrs, index) {
		const selection = attrs.search.results()[index];
		if (selection == null) return;
		if (selection.type === "recipient") {
			const { address, name, contact } = selection.value;
			attrs.onRecipientAdded(address, name, contact);
			attrs.search.clear();
			attrs.onTextChanged("");
		} else {
			attrs.search.clear();
			attrs.onTextChanged("");
			const recipients = await attrs.search.resolveContactList(selection.value);
			for (const { address, name, contact } of recipients) attrs.onRecipientAdded(address, name, contact);
			mithril_default.redraw();
		}
	}
	getSelectedSuggestionIdx(attrs) {
		return Math.min(Math.max(this.selectedSuggestionIdx, 0), attrs.search.results().length - 1);
	}
	setSelectedSuggestionIdx(idx) {
		this.selectedSuggestionIdx = idx;
	}
};
function parsePastedInput(text) {
	const separator = text.indexOf(";") !== -1 ? ";" : ",";
	const textParts = text.split(separator).map((part) => part.trim());
	const result = {
		remainingText: "",
		newRecipients: [],
		errors: []
	};
	for (let part of textParts) {
		part = part.trim();
		if (part.length !== 0) {
			const parsed = parseMailAddress(part);
			if (!parsed) result.errors.push(part);
else result.newRecipients.push(parsed);
		}
	}
	return result;
}
function parseTypedInput(text) {
	const lastCharacter = text.slice(-1);
	if (lastCharacter === ";" || lastCharacter === "," || lastCharacter === " ") {
		const textMinusLast = text.slice(0, -1);
		const result = parseMailAddress(textMinusLast);
		const remainingText = result != null ? "" : textMinusLast;
		return {
			remainingText,
			newRecipients: result ? [result] : [],
			errors: []
		};
	} else return {
		remainingText: text,
		newRecipients: [],
		errors: []
	};
}
function parseMailAddress(text) {
	text = text.trim();
	if (text === "") return null;
	const nameAndMailAddress = stringToNameAndMailAddress(text);
	if (nameAndMailAddress) {
		const name = nameAndMailAddress.name ? nameAndMailAddress.name : null;
		return {
			name,
			address: nameAndMailAddress.mailAddress
		};
	} else return null;
}

//#endregion
export { MailRecipientsTextField, parseMailAddress, parsePastedInput, parseTypedInput };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFpbFJlY2lwaWVudHNUZXh0RmllbGQtY2h1bmsuanMiLCJuYW1lcyI6WyJlOiBNb3VzZUV2ZW50IiwiYXR0cnM6IFNlYXJjaERyb3BEb3duQXR0cnM8VD4iLCJpZHg6IG51bWJlciIsImF0dHJzOiBNYWlsUmVjaXBpZW50c1RleHRGaWVsZEF0dHJzIiwiYWRkcmVzczogc3RyaW5nIiwic2VsZWN0U3VnZ2VzdGlvbjogYm9vbGVhbiIsImluZGV4OiBudW1iZXIiLCJpZHg6IG51bWJlciIsInRleHQ6IHN0cmluZyIsInJlc3VsdDogUGFyc2VkSW5wdXQiXSwic291cmNlcyI6WyIuLi9zcmMvY29tbW9uL2d1aS9iYXNlL0J1YmJsZVRleHRGaWVsZC50cyIsIi4uL3NyYy9jb21tb24vZ3VpL1NlYXJjaERyb3BEb3duLnRzIiwiLi4vc3JjL2NvbW1vbi9ndWkvTWFpbFJlY2lwaWVudHNUZXh0RmllbGQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG0sIHsgQ2hpbGRyZW4sIENsYXNzQ29tcG9uZW50LCBWbm9kZSB9IGZyb20gXCJtaXRocmlsXCJcbmltcG9ydCB7IEF1dG9jb21wbGV0ZSwgVGV4dEZpZWxkLCBUZXh0RmllbGRUeXBlIH0gZnJvbSBcIi4vVGV4dEZpZWxkLmpzXCJcbmltcG9ydCB7IFRyYW5zbGF0aW9uLCBNYXliZVRyYW5zbGF0aW9uIH0gZnJvbSBcIi4uLy4uL21pc2MvTGFuZ3VhZ2VWaWV3TW9kZWxcIlxuaW1wb3J0IHsgS2V5cyB9IGZyb20gXCIuLi8uLi9hcGkvY29tbW9uL1R1dGFub3RhQ29uc3RhbnRzXCJcbmltcG9ydCB7IGNyZWF0ZUFzeW5jRHJvcGRvd24sIERyb3Bkb3duQ2hpbGRBdHRycyB9IGZyb20gXCIuL0Ryb3Bkb3duLmpzXCJcbmltcG9ydCB7IGxhenkgfSBmcm9tIFwiQHR1dGFvL3R1dGFub3RhLXV0aWxzXCJcbmltcG9ydCB7IEJhc2VCdXR0b24gfSBmcm9tIFwiLi9idXR0b25zL0Jhc2VCdXR0b24uanNcIlxuXG5leHBvcnQgaW50ZXJmYWNlIEJ1YmJsZVRleHRGaWVsZEF0dHJzIHtcblx0bGFiZWw6IE1heWJlVHJhbnNsYXRpb25cblx0aXRlbXM6IEFycmF5PHN0cmluZz5cblx0cmVuZGVyQnViYmxlVGV4dDogKGl0ZW06IHN0cmluZykgPT4gVHJhbnNsYXRpb25cblx0Z2V0QnViYmxlRHJvcGRvd25BdHRyczogKGl0ZW06IHN0cmluZykgPT4gUHJvbWlzZTxEcm9wZG93bkNoaWxkQXR0cnNbXT5cblx0dGV4dDogc3RyaW5nXG5cdG9uSW5wdXQ6ICh0ZXh0OiBzdHJpbmcpID0+IHZvaWRcblx0b25CYWNrc3BhY2U6ICgpID0+IGJvb2xlYW5cblx0b25FbnRlcktleTogKCkgPT4gYm9vbGVhblxuXHRvblVwS2V5OiAoKSA9PiBib29sZWFuXG5cdG9uRG93bktleTogKCkgPT4gYm9vbGVhblxuXHRkaXNhYmxlZDogYm9vbGVhblxuXHRpbmplY3Rpb25zUmlnaHQ/OiBDaGlsZHJlbiB8IG51bGxcblx0b25Gb2N1czogKCkgPT4gdm9pZFxuXHRvbkJsdXI6ICgpID0+IHZvaWRcblx0aGVscExhYmVsPzogbGF6eTxDaGlsZHJlbj4gfCBudWxsXG59XG5cbmV4cG9ydCBjbGFzcyBCdWJibGVUZXh0RmllbGQgaW1wbGVtZW50cyBDbGFzc0NvbXBvbmVudDxCdWJibGVUZXh0RmllbGRBdHRycz4ge1xuXHRwcml2YXRlIGFjdGl2ZTogYm9vbGVhbiA9IGZhbHNlXG5cdHByaXZhdGUgZG9tSW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQgfCBudWxsID0gbnVsbFxuXG5cdHZpZXcoeyBhdHRycyB9OiBWbm9kZTxCdWJibGVUZXh0RmllbGRBdHRycz4pIHtcblx0XHRyZXR1cm4gbShcIi5idWJibGUtdGV4dC1maWVsZFwiLCBbXG5cdFx0XHRtKFRleHRGaWVsZCwge1xuXHRcdFx0XHRsYWJlbDogYXR0cnMubGFiZWwsXG5cdFx0XHRcdGRpc2FibGVkOiBhdHRycy5kaXNhYmxlZCxcblx0XHRcdFx0dmFsdWU6IGF0dHJzLnRleHQsXG5cdFx0XHRcdG9uaW5wdXQ6IGF0dHJzLm9uSW5wdXQsXG5cdFx0XHRcdGhlbHBMYWJlbDogYXR0cnMuaGVscExhYmVsLFxuXHRcdFx0XHR0eXBlOiBUZXh0RmllbGRUeXBlLkVtYWlsLFxuXHRcdFx0XHRhdXRvY29tcGxldGVBczogQXV0b2NvbXBsZXRlLm9mZixcblx0XHRcdFx0aW5qZWN0aW9uc0xlZnQ6ICgpID0+IHtcblx0XHRcdFx0XHRyZXR1cm4gYXR0cnMuaXRlbXMubWFwKChpdGVtLCBpZHgsIGl0ZW1zKSA9PiB7XG5cdFx0XHRcdFx0XHQvLyBXZSBuZWVkIG92ZXJmbG93OiBoaWRkZW4gb24gYm90aCBzbyB0aGF0IGVsbGlwc2lzIG9uIGJ1dHRvbiB3b3Jrcy5cblx0XHRcdFx0XHRcdC8vIGZsZXggaXMgZm9yIHJlc2VydmluZyBzcGFjZSBmb3IgdGhlIGNvbW1hLiBhbGlnbi1pdGVtczogZW5kIHNvIHRoYXQgY29tbWEgaXMgcHVzaGVkIHRvIHRoZSBib3R0b20uXG5cdFx0XHRcdFx0XHRjb25zdCBidWJibGVUZXh0ID0gYXR0cnMucmVuZGVyQnViYmxlVGV4dChpdGVtKVxuXHRcdFx0XHRcdFx0cmV0dXJuIG0oXCIuZmxleC5vdmVyZmxvdy1oaWRkZW4uaXRlbXMtZW5kXCIsIFtcblx0XHRcdFx0XHRcdFx0bShcblx0XHRcdFx0XHRcdFx0XHRcIi5mbGV4LW5vLWdyb3ctc2hyaW5rLWF1dG8ub3ZlcmZsb3ctaGlkZGVuXCIsXG5cdFx0XHRcdFx0XHRcdFx0bShCYXNlQnV0dG9uLCB7XG5cdFx0XHRcdFx0XHRcdFx0XHRsYWJlbDogYnViYmxlVGV4dCxcblx0XHRcdFx0XHRcdFx0XHRcdHRleHQ6IGJ1YmJsZVRleHQudGV4dCxcblx0XHRcdFx0XHRcdFx0XHRcdGNsYXNzOiBcInRleHQtYnViYmxlIGJ1dHRvbi1jb250ZW50IGNvbnRlbnQtZmcgdGV4dC1lbGxpcHNpcyBmbGFzaFwiLFxuXHRcdFx0XHRcdFx0XHRcdFx0c3R5bGU6IHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XCJtYXgtd2lkdGhcIjogXCIxMDAlXCIsXG5cdFx0XHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0XHRcdFx0b25jbGljazogKGU6IE1vdXNlRXZlbnQpID0+IHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKSAvLyBkbyBub3QgZm9jdXMgdGhlIHRleHQgZmllbGRcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y3JlYXRlQXN5bmNEcm9wZG93bih7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0bGF6eUJ1dHRvbnM6ICgpID0+IGF0dHJzLmdldEJ1YmJsZURyb3Bkb3duQXR0cnMoaXRlbSksXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0d2lkdGg6IDI1MCxcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSkoZSwgZS50YXJnZXQgYXMgSFRNTEVsZW1lbnQpXG5cdFx0XHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0XHRcdH0pLFxuXHRcdFx0XHRcdFx0XHQpLFxuXHRcdFx0XHRcdFx0XHQvLyBDb21tYSBpcyBzaG93biB3aGVuIHRoZXJlJ3MgdGV4dC9hbm90aGVyIGJ1YmJsZSBhZnRlcndhcmRzIG9yIGlmIHRoZSBmaWVsZCBpcyBhY3RpdmVcblx0XHRcdFx0XHRcdFx0dGhpcy5hY3RpdmUgfHwgaWR4IDwgaXRlbXMubGVuZ3RoIC0gMSB8fCBhdHRycy50ZXh0ICE9PSBcIlwiID8gbShcInNwYW4ucHJcIiwgXCIsXCIpIDogbnVsbCxcblx0XHRcdFx0XHRcdF0pXG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0fSxcblx0XHRcdFx0aW5qZWN0aW9uc1JpZ2h0OiAoKSA9PiBhdHRycy5pbmplY3Rpb25zUmlnaHQgPz8gbnVsbCxcblx0XHRcdFx0b25jcmVhdGU6ICgpID0+IHtcblx0XHRcdFx0XHQvLyBJZiB0aGUgZmllbGQgaXMgaW5pdGlhbGl6ZWQgd2l0aCBidWJibGVzIGJ1dCB0aGUgdXNlciBkaWQgbm90IGVkaXQgaXQgeWV0IHRoZW4gZmllbGQgd2lsbCBub3QgaGF2ZSBjb3JyZWN0IHNpemVcblx0XHRcdFx0XHQvLyBhbmQgbGFzdCBidWJibGUgd2lsbCBub3QgYmUgb24gdGhlIHNhbWUgbGluZSB3aXRoIHJpZ2h0IGluamVjdGlvbnMgKGxpa2UgXCJzaG93XCIgYnV0dG9uKS4gSXQgaXMgZml4ZWQgYWZ0ZXIgdXNlclxuXHRcdFx0XHRcdC8vIGVkaXRzIHRoZSBmaWVsZCBhbmQgYXV0b2NvbXBsZXRpb24gY2hhbmdlcyB0aGUgZmllbGQgYnV0IGJlZm9yZSB0aGF0IGl0J3MgYnJva2VuLiBUbyBhdm9pZCBpdCB3ZSBzZXQgdGhlIHNpemVcblx0XHRcdFx0XHQvLyBtYW51YWxseS5cblx0XHRcdFx0XHQvL1xuXHRcdFx0XHRcdC8vIFRoaXMgb25jcmVhdGUgaXMgcnVuIGJlZm9yZSB0aGUgZG9tIGlucHV0J3Mgb25jcmVhdGUgaXMgcnVuIGFuZCBzZXRzIHRoZSBmaWVsZCBzbyB3ZSBoYXZlIHRvIGFjY2VzcyBpbnB1dCBvbiB0aGVcblx0XHRcdFx0XHQvLyBuZXh0IGZyYW1lLiBUaGVyZSdzIG5vIG90aGVyIGNhbGxiYWNrIHRvIHVzZSB3aXRob3V0IHJlcXVlc3RpbmcgcmVkcmF3LlxuXHRcdFx0XHRcdHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodGhpcy5kb21JbnB1dCkgdGhpcy5kb21JbnB1dC5zaXplID0gMVxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdH0sXG5cdFx0XHRcdG9uRG9tSW5wdXRDcmVhdGVkOiAoZG9tKSA9PiAodGhpcy5kb21JbnB1dCA9IGRvbSksXG5cdFx0XHRcdG9uZm9jdXM6ICgpID0+IHtcblx0XHRcdFx0XHR0aGlzLmFjdGl2ZSA9IHRydWVcblx0XHRcdFx0XHRhdHRycy5vbkZvY3VzKClcblx0XHRcdFx0fSxcblx0XHRcdFx0b25ibHVyOiAoKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5hY3RpdmUgPSBmYWxzZVxuXHRcdFx0XHRcdGF0dHJzLm9uQmx1cigpXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGtleUhhbmRsZXI6IChrZXkpID0+IHtcblx0XHRcdFx0XHRpZiAoa2V5LmtleSAhPSBudWxsKSB7XG5cdFx0XHRcdFx0XHRzd2l0Y2ggKGtleS5rZXkudG9Mb3dlckNhc2UoKSkge1xuXHRcdFx0XHRcdFx0XHRjYXNlIEtleXMuQkFDS1NQQUNFLmNvZGU6XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGF0dHJzLm9uQmFja3NwYWNlKClcblxuXHRcdFx0XHRcdFx0XHRjYXNlIEtleXMuUkVUVVJOLmNvZGU6XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGF0dHJzLm9uRW50ZXJLZXkoKVxuXG5cdFx0XHRcdFx0XHRcdGNhc2UgS2V5cy5ET1dOLmNvZGU6XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGF0dHJzLm9uVXBLZXkoKVxuXG5cdFx0XHRcdFx0XHRcdGNhc2UgS2V5cy5VUC5jb2RlOlxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBhdHRycy5vbkRvd25LZXkoKVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZVxuXHRcdFx0XHR9LFxuXHRcdFx0fSksXG5cdFx0XSlcblx0fVxufVxuIiwiaW1wb3J0IG0sIHsgQ2hpbGRyZW4sIENsYXNzQ29tcG9uZW50LCBWbm9kZSB9IGZyb20gXCJtaXRocmlsXCJcbmltcG9ydCB7IHNjcm9sbExpc3REb20gfSBmcm9tIFwiLi9iYXNlL0d1aVV0aWxzLmpzXCJcbmltcG9ydCB7IHB4LCBzaXplIH0gZnJvbSBcIi4vc2l6ZS5qc1wiXG5pbXBvcnQgeyB3aW5kb3dGYWNhZGUgfSBmcm9tIFwiLi4vbWlzYy9XaW5kb3dGYWNhZGUuanNcIlxuXG5jb25zdCBFbnRyeUhlaWdodCA9IDYwXG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoRHJvcERvd25BdHRyczxUIGV4dGVuZHMgU3VnZ2VzdGlvbj4ge1xuXHRzdWdnZXN0aW9uczogUmVhZG9ubHlBcnJheTxUPlxuXHRzZWxlY3RlZFN1Z2dlc3Rpb25JbmRleDogbnVtYmVyXG5cdG9uU3VnZ2VzdGlvblNlbGVjdGVkOiAoaWR4OiBudW1iZXIpID0+IHZvaWRcblxuXHQvKiogbWF4IGFtb3VudCBvZiBzdWdnZXN0aW9ucyB0aGF0IGNhbiBiZSB2aXNpYmxlIHdpdGhvdXQgc2Nyb2xsaW5nICovXG5cdG1heEhlaWdodDogbnVtYmVyIHwgbnVsbFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN1Z2dlc3Rpb24ge1xuXHRmaXJzdFJvdzogQ2hpbGRyZW5cblx0c2Vjb25kUm93OiBzdHJpbmdcblx0ZGlzcGxheT86IGJvb2xlYW5cbn1cblxuZXhwb3J0IGNsYXNzIFNlYXJjaERyb3BEb3duPFQgZXh0ZW5kcyBTdWdnZXN0aW9uPiBpbXBsZW1lbnRzIENsYXNzQ29tcG9uZW50PFNlYXJjaERyb3BEb3duQXR0cnM8VD4+IHtcblx0cHJpdmF0ZSBkb21TdWdnZXN0aW9ucyE6IEhUTUxFbGVtZW50XG5cdHByaXZhdGUga2V5Ym9hcmRIZWlnaHQ6IG51bWJlciA9IDBcblxuXHRvbmNyZWF0ZSgpIHtcblx0XHR3aW5kb3dGYWNhZGUuYWRkS2V5Ym9hcmRTaXplTGlzdGVuZXIoKG5ld1NpemUpID0+IHtcblx0XHRcdC8vICotLS0tLS0tLS0tLS0tLS0tLS0tKiAgLVxuXHRcdFx0Ly8gfCAgICAgICAgICAgICAgICAgICB8ICB8XG5cdFx0XHQvLyB8ICAgLS0tLS0tLS0tLS0tLSAgIHwgIC0gPC0gdG9wXG5cdFx0XHQvLyB8ICAgfCAgICAgICAgICAgfCAgIHxcblx0XHRcdC8vIHwgICB8LS0tLS0tLS0tLS18ICAgfFxuXHRcdFx0Ly8gfC0tLS0tLS0tLS0tLS0tLS0tLS18ICAtIDwtIGtleWJvYXJkSGVpZ2h0XG5cdFx0XHQvLyB8IHEgdyBlIHIgdCB6IHUgaSBvIHwgIHxcblx0XHRcdC8vIHwgYSBzIGQgZiBnIGggaiBrIGwgfCAgLVxuXHRcdFx0Ly9cblx0XHRcdC8vIE9uIGlPUyBzY3JlZW4gaXMgbm90IHJlc2l6ZWQgd2hlbiBrZXlib2FyZCBpcyBvcGVuZWQuIEluc3RlYWQgd2Ugc2VuZCBhIHNpZ25hbCB0byBXZWJWaWV3IHdpdGgga2V5Ym9hcmQgaGVpZ2h0LlxuXHRcdFx0dGhpcy5rZXlib2FyZEhlaWdodCA9IG5ld1NpemVcblx0XHR9KVxuXHR9XG5cblx0dmlldyh7IGF0dHJzIH06IFZub2RlPFNlYXJjaERyb3BEb3duQXR0cnM8VD4+KTogQ2hpbGRyZW4ge1xuXHRcdGlmIChhdHRycy5zZWxlY3RlZFN1Z2dlc3Rpb25JbmRleCAhPT0gYXR0cnMuc2VsZWN0ZWRTdWdnZXN0aW9uSW5kZXggJiYgdGhpcy5kb21TdWdnZXN0aW9ucykge1xuXHRcdFx0cmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcblx0XHRcdFx0c2Nyb2xsTGlzdERvbSh0aGlzLmRvbVN1Z2dlc3Rpb25zLCBFbnRyeUhlaWdodCwgYXR0cnMuc2VsZWN0ZWRTdWdnZXN0aW9uSW5kZXgpXG5cdFx0XHR9KVxuXHRcdH1cblxuXHRcdC8vIFdlIG5lZWQgdG8gY2FsY3VsYXRlIGhvdyBtdWNoIHNwYWNlIGNhbiBiZSBhY3R1YWxseSB1c2VkIGZvciB0aGUgZHJvcGRvd24uIFdlIGNhbm5vdCBqdXN0IGFkZCBtYXJnaW4gbGlrZSB3ZSBkbyB3aXRoIGRpYWxvZ1xuXHRcdC8vIGJlY2F1c2UgdGhlIHN1Z2dlc3Rpb25zIGRyb3Bkb3duIGlzIGFic29sdXRlbHkgcG9zaXRpb25lZC5cblx0XHRsZXQgZHJvcGRvd25IZWlnaHQgPSBFbnRyeUhlaWdodCAqIE1hdGgubWluKGF0dHJzLm1heEhlaWdodCA/PyBOdW1iZXIuTUFYX1ZBTFVFLCBhdHRycy5zdWdnZXN0aW9ucy5sZW5ndGgpXG5cdFx0aWYgKHRoaXMuZG9tU3VnZ2VzdGlvbnMpIHtcblx0XHRcdGNvbnN0IHRvcCA9IHRoaXMuZG9tU3VnZ2VzdGlvbnMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wXG5cdFx0XHRjb25zdCBhdmFpbGFibGVIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgLSB0b3AgLSB0aGlzLmtleWJvYXJkSGVpZ2h0IC0gc2l6ZS52cGFkXG5cdFx0XHRkcm9wZG93bkhlaWdodCA9IE1hdGgubWluKGF2YWlsYWJsZUhlaWdodCwgZHJvcGRvd25IZWlnaHQpXG5cdFx0fVxuXG5cdFx0cmV0dXJuIG0oXG5cdFx0XHRgLmFicy56NC5mdWxsLXdpZHRoLmVsZXZhdGVkLWJnLnNjcm9sbC50ZXh0LWVsbGlwc2lzJHthdHRycy5zdWdnZXN0aW9ucy5sZW5ndGggPyBcIi5kcm9wZG93bi1zaGFkb3dcIiA6IFwiXCJ9YCxcblx0XHRcdHtcblx0XHRcdFx0b25jcmVhdGU6ICh2bm9kZSkgPT4gKHRoaXMuZG9tU3VnZ2VzdGlvbnMgPSB2bm9kZS5kb20gYXMgSFRNTEVsZW1lbnQpLFxuXHRcdFx0XHRzdHlsZToge1xuXHRcdFx0XHRcdHRyYW5zaXRpb246IFwiaGVpZ2h0IDAuMnNcIixcblx0XHRcdFx0XHRoZWlnaHQ6IHB4KGRyb3Bkb3duSGVpZ2h0KSxcblx0XHRcdFx0fSxcblx0XHRcdH0sXG5cdFx0XHRhdHRycy5zdWdnZXN0aW9ucy5tYXAoKHN1Z2dlc3Rpb24sIGlkeCkgPT4gdGhpcy5yZW5kZXJTdWdnZXN0aW9uKGF0dHJzLCBzdWdnZXN0aW9uLCBpZHgpKSxcblx0XHQpXG5cdH1cblxuXHRwcml2YXRlIHJlbmRlclN1Z2dlc3Rpb24oYXR0cnM6IFNlYXJjaERyb3BEb3duQXR0cnM8VD4sIHsgZmlyc3RSb3csIHNlY29uZFJvdywgZGlzcGxheSB9OiBULCBpZHg6IG51bWJlcik6IENoaWxkcmVuIHtcblx0XHRjb25zdCBzZWxlY3RlZCA9IGlkeCA9PT0gYXR0cnMuc2VsZWN0ZWRTdWdnZXN0aW9uSW5kZXhcblxuXHRcdGlmIChkaXNwbGF5ICE9PSB1bmRlZmluZWQgJiYgIWRpc3BsYXkpIHtcblx0XHRcdHJldHVybiBudWxsXG5cdFx0fVxuXG5cdFx0cmV0dXJuIG0oXG5cdFx0XHRcIi5wdC1zLnBiLXMuY2xpY2suY29udGVudC1ob3ZlclwiLFxuXHRcdFx0e1xuXHRcdFx0XHRjbGFzczogc2VsZWN0ZWQgPyBcImNvbnRlbnQtYWNjZW50LWZnIHJvdy1zZWxlY3RlZCBpY29uLWFjY2VudFwiIDogXCJcIixcblx0XHRcdFx0b25tb3VzZWRvd246ICgpID0+IGF0dHJzLm9uU3VnZ2VzdGlvblNlbGVjdGVkKGlkeCksXG5cdFx0XHRcdHN0eWxlOiB7XG5cdFx0XHRcdFx0XCJwYWRkaW5nLWxlZnRcIjogc2VsZWN0ZWQgPyBweChzaXplLmhwYWRfbGFyZ2UgLSAzKSA6IHB4KHNpemUuaHBhZF9sYXJnZSksXG5cdFx0XHRcdFx0XCJib3JkZXItbGVmdFwiOiBzZWxlY3RlZCA/IFwiM3B4IHNvbGlkXCIgOiBudWxsLFxuXHRcdFx0XHRcdGhlaWdodDogcHgoRW50cnlIZWlnaHQpLFxuXHRcdFx0XHR9LFxuXHRcdFx0fSxcblx0XHRcdFttKFwiLnNtYWxsLmZ1bGwtd2lkdGgudGV4dC1lbGxpcHNpc1wiLCBmaXJzdFJvdyksIG0oXCIubmFtZS5mdWxsLXdpZHRoLnRleHQtZWxsaXBzaXNcIiwgc2Vjb25kUm93KV0sXG5cdFx0KVxuXHR9XG59XG4iLCJpbXBvcnQgbSwgeyBDaGlsZHJlbiwgQ2xhc3NDb21wb25lbnQsIFZub2RlIH0gZnJvbSBcIm1pdGhyaWxcIlxuaW1wb3J0IHsgQnViYmxlVGV4dEZpZWxkIH0gZnJvbSBcIi4vYmFzZS9CdWJibGVUZXh0RmllbGQuanNcIlxuaW1wb3J0IHsgUmVjaXBpZW50IH0gZnJvbSBcIi4uL2FwaS9jb21tb24vcmVjaXBpZW50cy9SZWNpcGllbnQuanNcIlxuaW1wb3J0IHsgcHgsIHNpemUgfSBmcm9tIFwiLi9zaXplLmpzXCJcbmltcG9ydCB7IEljb24sIHByb2dyZXNzSWNvbiB9IGZyb20gXCIuL2Jhc2UvSWNvbi5qc1wiXG5pbXBvcnQgeyBsYW5nLCBUcmFuc2xhdGlvbktleSB9IGZyb20gXCIuLi9taXNjL0xhbmd1YWdlVmlld01vZGVsLmpzXCJcbmltcG9ydCB7IHN0cmluZ1RvTmFtZUFuZE1haWxBZGRyZXNzIH0gZnJvbSBcIi4uL21pc2MvcGFyc2luZy9NYWlsQWRkcmVzc1BhcnNlci5qc1wiXG5pbXBvcnQgeyBEcm9wZG93bkNoaWxkQXR0cnMgfSBmcm9tIFwiLi9iYXNlL0Ryb3Bkb3duLmpzXCJcbmltcG9ydCB7IENvbnRhY3QgfSBmcm9tIFwiLi4vYXBpL2VudGl0aWVzL3R1dGFub3RhL1R5cGVSZWZzLmpzXCJcbmltcG9ydCB7IFJlY2lwaWVudHNTZWFyY2hNb2RlbCB9IGZyb20gXCIuLi9taXNjL1JlY2lwaWVudHNTZWFyY2hNb2RlbC5qc1wiXG5pbXBvcnQgeyBnZXRGaXJzdE9yVGhyb3csIGxhenkgfSBmcm9tIFwiQHR1dGFvL3R1dGFub3RhLXV0aWxzXCJcbmltcG9ydCB7IERpYWxvZyB9IGZyb20gXCIuL2Jhc2UvRGlhbG9nLmpzXCJcbmltcG9ydCB7IFNlYXJjaERyb3BEb3duIH0gZnJvbSBcIi4vU2VhcmNoRHJvcERvd24uanNcIlxuaW1wb3J0IHsgZmluZFJlY2lwaWVudFdpdGhBZGRyZXNzIH0gZnJvbSBcIi4uL2FwaS9jb21tb24vdXRpbHMvQ29tbW9uQ2FsZW5kYXJVdGlscy5qc1wiXG5pbXBvcnQgeyBJY29ucyB9IGZyb20gXCIuL2Jhc2UvaWNvbnMvSWNvbnMuanNcIlxuaW1wb3J0IHsgdGhlbWUgfSBmcm9tIFwiLi90aGVtZS5qc1wiXG5pbXBvcnQgeyBnZXRNYWlsQWRkcmVzc0Rpc3BsYXlUZXh0IH0gZnJvbSBcIi4uL21haWxGdW5jdGlvbmFsaXR5L1NoYXJlZE1haWxVdGlscy5qc1wiXG5cbmV4cG9ydCBpbnRlcmZhY2UgTWFpbFJlY2lwaWVudHNUZXh0RmllbGRBdHRycyB7XG5cdGxhYmVsOiBUcmFuc2xhdGlvbktleVxuXHR0ZXh0OiBzdHJpbmdcblx0b25UZXh0Q2hhbmdlZDogKHRleHQ6IHN0cmluZykgPT4gdm9pZFxuXHRyZWNpcGllbnRzOiBSZWFkb25seUFycmF5PFJlY2lwaWVudD5cblx0b25SZWNpcGllbnRBZGRlZDogKGFkZHJlc3M6IHN0cmluZywgbmFtZTogc3RyaW5nIHwgbnVsbCwgY29udGFjdDogQ29udGFjdCB8IG51bGwpID0+IHZvaWRcblx0b25SZWNpcGllbnRSZW1vdmVkOiAoYWRkcmVzczogc3RyaW5nKSA9PiB2b2lkXG5cdGdldFJlY2lwaWVudENsaWNrZWREcm9wZG93bkF0dHJzPzogKGFkZHJlc3M6IHN0cmluZykgPT4gUHJvbWlzZTxEcm9wZG93bkNoaWxkQXR0cnNbXT5cblx0aW5qZWN0aW9uc1JpZ2h0PzogQ2hpbGRyZW4gfCBudWxsXG5cdGRpc2FibGVkOiBib29sZWFuXG5cdHNlYXJjaDogUmVjaXBpZW50c1NlYXJjaE1vZGVsXG5cdC8qKiBMaW1pdCB0aGUgc2VhcmNoIGRyb3Bkb3duIHRvIHRoaXMgbnVtYmVyIG9mIHN1Z2dlc3Rpb25zIGJlZm9yZSBzdGFydGluZyB0byBzY3JvbGwgKi9cblx0bWF4U3VnZ2VzdGlvbnNUb1Nob3c/OiBudW1iZXJcblx0aGVscExhYmVsPzogbGF6eTxDaGlsZHJlbj4gfCBudWxsXG59XG5cbi8qKlxuICogQSBjb21wb25lbnQgZm9yIGlucHV0dGluZyBhIGxpc3Qgb2YgcmVjaXBpZW50c1xuICogcmVjaXBpZW50cyBhcmUgcmVwcmVzZW50ZWQgYXMgYnViYmxlcywgYW5kIGEgY29udGFjdCBzZWFyY2ggZHJvcGRvd24gaXMgc2hvd24gYXMgdGhlIHVzZXIgdHlwZXNcbiAqL1xuZXhwb3J0IGNsYXNzIE1haWxSZWNpcGllbnRzVGV4dEZpZWxkIGltcGxlbWVudHMgQ2xhc3NDb21wb25lbnQ8TWFpbFJlY2lwaWVudHNUZXh0RmllbGRBdHRycz4ge1xuXHQvLyBkb24ndCBhY2Nlc3MgbWUgZGlyZWN0bHksIHVzZSBnZXR0ZXIgYW5kIHNldHRlclxuXHRwcml2YXRlIHNlbGVjdGVkU3VnZ2VzdGlvbklkeCA9IDBcblx0cHJpdmF0ZSBmb2N1c2VkID0gZmFsc2VcblxuXHR2aWV3KHsgYXR0cnMgfTogVm5vZGU8TWFpbFJlY2lwaWVudHNUZXh0RmllbGRBdHRycz4pOiBDaGlsZHJlbiB7XG5cdFx0cmV0dXJuIFt0aGlzLnJlbmRlclRleHRGaWVsZChhdHRycyksIHRoaXMuZm9jdXNlZCA/IHRoaXMucmVuZGVyU3VnZ2VzdGlvbnMoYXR0cnMpIDogbnVsbF1cblx0fVxuXG5cdHByaXZhdGUgcmVuZGVyVGV4dEZpZWxkKGF0dHJzOiBNYWlsUmVjaXBpZW50c1RleHRGaWVsZEF0dHJzKTogQ2hpbGRyZW4ge1xuXHRcdHJldHVybiBtKEJ1YmJsZVRleHRGaWVsZCwge1xuXHRcdFx0bGFiZWw6IGF0dHJzLmxhYmVsLFxuXHRcdFx0dGV4dDogYXR0cnMudGV4dCxcblx0XHRcdGhlbHBMYWJlbDogYXR0cnMuaGVscExhYmVsLFxuXHRcdFx0b25JbnB1dDogKHRleHQpID0+IHtcblx0XHRcdFx0YXR0cnMuc2VhcmNoLnNlYXJjaCh0ZXh0KS50aGVuKCgpID0+IG0ucmVkcmF3KCkpXG5cblx0XHRcdFx0Ly8gaWYgdGhlIG5ldyB0ZXh0IGxlbmd0aCBpcyBtb3JlIHRoYW4gb25lIGNoYXJhY3RlciBsb25nZXIsXG5cdFx0XHRcdC8vIGl0IG1lYW5zIHRoZSB1c2VyIHBhc3RlZCB0aGUgdGV4dCBpbiwgc28gd2Ugd2FudCB0byB0cnkgYW5kIHJlc29sdmUgYSBsaXN0IG9mIGNvbnRhY3RzXG5cdFx0XHRcdGNvbnN0IHsgcmVtYWluaW5nVGV4dCwgbmV3UmVjaXBpZW50cywgZXJyb3JzIH0gPSB0ZXh0Lmxlbmd0aCAtIGF0dHJzLnRleHQubGVuZ3RoID4gMSA/IHBhcnNlUGFzdGVkSW5wdXQodGV4dCkgOiBwYXJzZVR5cGVkSW5wdXQodGV4dClcblxuXHRcdFx0XHRmb3IgKGNvbnN0IHsgYWRkcmVzcywgbmFtZSB9IG9mIG5ld1JlY2lwaWVudHMpIHtcblx0XHRcdFx0XHRhdHRycy5vblJlY2lwaWVudEFkZGVkKGFkZHJlc3MsIG5hbWUsIG51bGwpXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoZXJyb3JzLmxlbmd0aCA9PT0gMSAmJiBuZXdSZWNpcGllbnRzLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0XHRcdC8vIGlmIHRoZXJlIHdhcyBhIHNpbmdsZSByZWNpcGllbnQgYW5kIGl0IHdhcyBpbnZhbGlkIHRoZW4ganVzdCBwcmV0ZW5kIG5vdGhpbmcgaGFwcGVuZWRcblx0XHRcdFx0XHRhdHRycy5vblRleHRDaGFuZ2VkKGdldEZpcnN0T3JUaHJvdyhlcnJvcnMpKVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdFx0RGlhbG9nLm1lc3NhZ2UoXG5cdFx0XHRcdFx0XHRcdGxhbmcubWFrZVRyYW5zbGF0aW9uKFwiaW52YWxpZFBhc3RlZFJlY2lwaWVudHNfbXNnXCIsIGAke2xhbmcuZ2V0KFwiaW52YWxpZFBhc3RlZFJlY2lwaWVudHNfbXNnXCIpfVxcblxcbiR7ZXJyb3JzLmpvaW4oXCJcXG5cIil9YCksXG5cdFx0XHRcdFx0XHQpXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGF0dHJzLm9uVGV4dENoYW5nZWQocmVtYWluaW5nVGV4dClcblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHRcdGl0ZW1zOiBhdHRycy5yZWNpcGllbnRzLm1hcCgocmVjaXBpZW50KSA9PiByZWNpcGllbnQuYWRkcmVzcyksXG5cdFx0XHRyZW5kZXJCdWJibGVUZXh0OiAoYWRkcmVzczogc3RyaW5nKSA9PiB7XG5cdFx0XHRcdGNvbnN0IG5hbWUgPSBmaW5kUmVjaXBpZW50V2l0aEFkZHJlc3MoYXR0cnMucmVjaXBpZW50cywgYWRkcmVzcyk/Lm5hbWUgPz8gbnVsbFxuXHRcdFx0XHRyZXR1cm4gbGFuZy5tYWtlVHJhbnNsYXRpb24oYWRkcmVzcywgZ2V0TWFpbEFkZHJlc3NEaXNwbGF5VGV4dChuYW1lLCBhZGRyZXNzLCBmYWxzZSkpXG5cdFx0XHR9LFxuXHRcdFx0Z2V0QnViYmxlRHJvcGRvd25BdHRyczogYXN5bmMgKGFkZHJlc3MpID0+IChhd2FpdCBhdHRycy5nZXRSZWNpcGllbnRDbGlja2VkRHJvcGRvd25BdHRycz8uKGFkZHJlc3MpKSA/PyBbXSxcblx0XHRcdG9uQmFja3NwYWNlOiAoKSA9PiB7XG5cdFx0XHRcdGlmIChhdHRycy50ZXh0ID09PSBcIlwiICYmIGF0dHJzLnJlY2lwaWVudHMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdGNvbnN0IHsgYWRkcmVzcyB9ID0gYXR0cnMucmVjaXBpZW50cy5zbGljZSgpLnBvcCgpIVxuXHRcdFx0XHRcdGF0dHJzLm9uVGV4dENoYW5nZWQoYWRkcmVzcylcblx0XHRcdFx0XHRhdHRycy5vblJlY2lwaWVudFJlbW92ZWQoYWRkcmVzcylcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2Vcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gdHJ1ZVxuXHRcdFx0fSxcblx0XHRcdG9uRW50ZXJLZXk6ICgpID0+IHtcblx0XHRcdFx0dGhpcy5yZXNvbHZlSW5wdXQoYXR0cnMsIHRydWUpXG5cdFx0XHRcdHJldHVybiB0cnVlXG5cdFx0XHR9LFxuXHRcdFx0b25VcEtleTogKCkgPT4ge1xuXHRcdFx0XHR0aGlzLnNldFNlbGVjdGVkU3VnZ2VzdGlvbklkeCh0aGlzLmdldFNlbGVjdGVkU3VnZ2VzdGlvbklkeChhdHRycykgKyAxKVxuXHRcdFx0XHRyZXR1cm4gZmFsc2Vcblx0XHRcdH0sXG5cdFx0XHRvbkRvd25LZXk6ICgpID0+IHtcblx0XHRcdFx0dGhpcy5zZXRTZWxlY3RlZFN1Z2dlc3Rpb25JZHgodGhpcy5nZXRTZWxlY3RlZFN1Z2dlc3Rpb25JZHgoYXR0cnMpIC0gMSlcblx0XHRcdFx0cmV0dXJuIGZhbHNlXG5cdFx0XHR9LFxuXHRcdFx0b25Gb2N1czogKCkgPT4ge1xuXHRcdFx0XHR0aGlzLmZvY3VzZWQgPSB0cnVlXG5cdFx0XHR9LFxuXHRcdFx0b25CbHVyOiAoKSA9PiB7XG5cdFx0XHRcdHRoaXMuZm9jdXNlZCA9IGZhbHNlXG5cdFx0XHRcdHRoaXMucmVzb2x2ZUlucHV0KGF0dHJzLCBmYWxzZSlcblx0XHRcdFx0cmV0dXJuIHRydWVcblx0XHRcdH0sXG5cdFx0XHRkaXNhYmxlZDogYXR0cnMuZGlzYWJsZWQsXG5cdFx0XHRpbmplY3Rpb25zUmlnaHQ6IG0oXCIuZmxleC5pdGVtcy1jZW50ZXJcIiwgW1xuXHRcdFx0XHQvLyBQbGFjZWhvbGRlciBlbGVtZW50IGZvciB0aGUgc3VnZ2VzdGlvbiBwcm9ncmVzcyBpY29uIHdpdGggYSBmaXhlZCB3aWR0aCBhbmQgaGVpZ2h0IHRvIGF2b2lkIGZsaWNrZXJpbmcuXG5cdFx0XHRcdC8vIHdoZW4gcmVhY2hpbmcgdGhlIGVuZCBvZiB0aGUgaW5wdXQgbGluZSBhbmQgd2hlbiBlbnRlcmluZyBhIHRleHQgaW50byB0aGUgc2Vjb25kIGxpbmUuXG5cdFx0XHRcdG0oXG5cdFx0XHRcdFx0XCIuZmxleC5hbGlnbi1yaWdodC5tci1zLmZsZXguaXRlbXMtZW5kLnBiLXNcIixcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRzdHlsZToge1xuXHRcdFx0XHRcdFx0XHR3aWR0aDogcHgoMjApLCAvLyBpbiBjYXNlIHRoZSBwcm9ncmVzcyBpY29uIGlzIG5vdCBzaG93biB3ZSByZXNlcnZlIHRoZSB3aWR0aCBvZiB0aGUgcHJvZ3Jlc3MgaWNvblxuXHRcdFx0XHRcdFx0XHRoZWlnaHQ6IHB4KHNpemUuYnV0dG9uX2hlaWdodF9jb21wYWN0KSxcblx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRhdHRycy5zZWFyY2guaXNMb2FkaW5nKCkgPyBwcm9ncmVzc0ljb24oKSA6IG51bGwsXG5cdFx0XHRcdCksXG5cdFx0XHRcdGF0dHJzLmluamVjdGlvbnNSaWdodCxcblx0XHRcdF0pLFxuXHRcdH0pXG5cdH1cblxuXHRwcml2YXRlIHJlbmRlclN1Z2dlc3Rpb25zKGF0dHJzOiBNYWlsUmVjaXBpZW50c1RleHRGaWVsZEF0dHJzKTogQ2hpbGRyZW4ge1xuXHRcdHJldHVybiBtKFxuXHRcdFx0XCIucmVsXCIsXG5cdFx0XHRtKFNlYXJjaERyb3BEb3duLCB7XG5cdFx0XHRcdHN1Z2dlc3Rpb25zOiBhdHRycy5zZWFyY2gucmVzdWx0cygpLm1hcCgoc3VnZ2VzdGlvbikgPT4ge1xuXHRcdFx0XHRcdGlmIChzdWdnZXN0aW9uLnR5cGUgPT09IFwicmVjaXBpZW50XCIpIHtcblx0XHRcdFx0XHRcdHJldHVybiB7XG5cdFx0XHRcdFx0XHRcdGZpcnN0Um93OiBzdWdnZXN0aW9uLnZhbHVlLm5hbWUsXG5cdFx0XHRcdFx0XHRcdHNlY29uZFJvdzogc3VnZ2VzdGlvbi52YWx1ZS5hZGRyZXNzLFxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRcdFx0XHRmaXJzdFJvdzogbShJY29uLCB7XG5cdFx0XHRcdFx0XHRcdFx0aWNvbjogSWNvbnMuUGVvcGxlLFxuXHRcdFx0XHRcdFx0XHRcdHN0eWxlOiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRmaWxsOiB0aGVtZS5jb250ZW50X2ZnLFxuXHRcdFx0XHRcdFx0XHRcdFx0XCJhcmlhLWRlc2NyaWJlZGJ5XCI6IGxhbmcuZ2V0KFwiY29udGFjdExpc3ROYW1lX2xhYmVsXCIpLFxuXHRcdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRcdH0pLFxuXHRcdFx0XHRcdFx0XHRzZWNvbmRSb3c6IHN1Z2dlc3Rpb24udmFsdWUubmFtZSxcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pLFxuXHRcdFx0XHRzZWxlY3RlZFN1Z2dlc3Rpb25JbmRleDogdGhpcy5nZXRTZWxlY3RlZFN1Z2dlc3Rpb25JZHgoYXR0cnMpLFxuXHRcdFx0XHRvblN1Z2dlc3Rpb25TZWxlY3RlZDogKGlkeCkgPT4gdGhpcy5zZWxlY3RTdWdnZXN0aW9uKGF0dHJzLCBpZHgpLFxuXHRcdFx0XHRtYXhIZWlnaHQ6IGF0dHJzLm1heFN1Z2dlc3Rpb25zVG9TaG93ID8/IG51bGwsXG5cdFx0XHR9KSxcblx0XHQpXG5cdH1cblxuXHQvKipcblx0ICogUmVzb2x2ZXMgYSB0eXBlZCBpbiBtYWlsIGFkZHJlc3Mgb3Igb25lIG9mIHRoZSBzdWdnZXN0ZWQgb25lcy5cblx0ICogQHBhcmFtIHNlbGVjdFN1Z2dlc3Rpb24gYm9vbGVhbiB2YWx1ZSBpbmRpY2F0aW5nIHdoZXRoZXIgYSBzdWdnZXN0aW9uIHNob3VsZCBiZSBzZWxlY3RlZCBvciBub3QuIFNob3VsZCBiZSB0cnVlIGlmIGEgc3VnZ2VzdGlvbiBpcyBleHBsaWNpdGx5IHNlbGVjdGVkIGJ5XG5cdCAqIGZvciBleGFtcGxlIGhpdHRpbmcgdGhlIGVudGVyIGtleSBhbmQgZmFsc2UgZS5nLiBpZiB0aGUgZGlhbG9nIGlzIGNsb3NlZFxuXHQgKi9cblx0cHJpdmF0ZSByZXNvbHZlSW5wdXQoYXR0cnM6IE1haWxSZWNpcGllbnRzVGV4dEZpZWxkQXR0cnMsIHNlbGVjdFN1Z2dlc3Rpb246IGJvb2xlYW4pIHtcblx0XHRjb25zdCBzdWdnZXN0aW9ucyA9IGF0dHJzLnNlYXJjaC5yZXN1bHRzKClcblx0XHRpZiAoc3VnZ2VzdGlvbnMubGVuZ3RoID4gMCAmJiBzZWxlY3RTdWdnZXN0aW9uKSB7XG5cdFx0XHR0aGlzLnNlbGVjdFN1Z2dlc3Rpb24oYXR0cnMsIHRoaXMuZ2V0U2VsZWN0ZWRTdWdnZXN0aW9uSWR4KGF0dHJzKSlcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uc3QgcGFyc2VkID0gcGFyc2VNYWlsQWRkcmVzcyhhdHRycy50ZXh0KVxuXHRcdFx0aWYgKHBhcnNlZCAhPSBudWxsKSB7XG5cdFx0XHRcdGF0dHJzLm9uUmVjaXBpZW50QWRkZWQocGFyc2VkLmFkZHJlc3MsIHBhcnNlZC5uYW1lLCBudWxsKVxuXHRcdFx0XHRhdHRycy5vblRleHRDaGFuZ2VkKFwiXCIpXG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBhc3luYyBzZWxlY3RTdWdnZXN0aW9uKGF0dHJzOiBNYWlsUmVjaXBpZW50c1RleHRGaWVsZEF0dHJzLCBpbmRleDogbnVtYmVyKSB7XG5cdFx0Y29uc3Qgc2VsZWN0aW9uID0gYXR0cnMuc2VhcmNoLnJlc3VsdHMoKVtpbmRleF1cblx0XHRpZiAoc2VsZWN0aW9uID09IG51bGwpIHtcblx0XHRcdHJldHVyblxuXHRcdH1cblxuXHRcdGlmIChzZWxlY3Rpb24udHlwZSA9PT0gXCJyZWNpcGllbnRcIikge1xuXHRcdFx0Y29uc3QgeyBhZGRyZXNzLCBuYW1lLCBjb250YWN0IH0gPSBzZWxlY3Rpb24udmFsdWVcblx0XHRcdGF0dHJzLm9uUmVjaXBpZW50QWRkZWQoYWRkcmVzcywgbmFtZSwgY29udGFjdClcblx0XHRcdGF0dHJzLnNlYXJjaC5jbGVhcigpXG5cdFx0XHRhdHRycy5vblRleHRDaGFuZ2VkKFwiXCIpXG5cdFx0fSBlbHNlIHtcblx0XHRcdGF0dHJzLnNlYXJjaC5jbGVhcigpXG5cdFx0XHRhdHRycy5vblRleHRDaGFuZ2VkKFwiXCIpXG5cdFx0XHRjb25zdCByZWNpcGllbnRzID0gYXdhaXQgYXR0cnMuc2VhcmNoLnJlc29sdmVDb250YWN0TGlzdChzZWxlY3Rpb24udmFsdWUpXG5cdFx0XHRmb3IgKGNvbnN0IHsgYWRkcmVzcywgbmFtZSwgY29udGFjdCB9IG9mIHJlY2lwaWVudHMpIHtcblx0XHRcdFx0YXR0cnMub25SZWNpcGllbnRBZGRlZChhZGRyZXNzLCBuYW1lLCBjb250YWN0KVxuXHRcdFx0fVxuXHRcdFx0bS5yZWRyYXcoKVxuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgZ2V0U2VsZWN0ZWRTdWdnZXN0aW9uSWR4KGF0dHJzOiBNYWlsUmVjaXBpZW50c1RleHRGaWVsZEF0dHJzKTogbnVtYmVyIHtcblx0XHRyZXR1cm4gTWF0aC5taW4oTWF0aC5tYXgodGhpcy5zZWxlY3RlZFN1Z2dlc3Rpb25JZHgsIDApLCBhdHRycy5zZWFyY2gucmVzdWx0cygpLmxlbmd0aCAtIDEpXG5cdH1cblxuXHRwcml2YXRlIHNldFNlbGVjdGVkU3VnZ2VzdGlvbklkeChpZHg6IG51bWJlcikge1xuXHRcdHRoaXMuc2VsZWN0ZWRTdWdnZXN0aW9uSWR4ID0gaWR4XG5cdH1cbn1cblxuaW50ZXJmYWNlIFBhcnNlZElucHV0IHtcblx0cmVtYWluaW5nVGV4dDogc3RyaW5nXG5cdG5ld1JlY2lwaWVudHM6IEFycmF5PHsgYWRkcmVzczogc3RyaW5nOyBuYW1lOiBzdHJpbmcgfCBudWxsIH0+XG5cdGVycm9yczogQXJyYXk8c3RyaW5nPlxufVxuXG4vKipcbiAqIFBhcnNlIGEgbGlzdCBvZiB2YWxpZCBtYWlsIGFkZHJlc3NlcyBzZXBhcmF0ZWQgYnkgZWl0aGVyIGEgc2VtaWNvbG9uIG9yIGEgY29tbWEuXG4gKiBJbnZhbGlkIGFkZHJlc3NlcyB3aWxsIGJlIHJldHVybmVkIGFzIGEgc2VwYXJhdGUgbGlzdFxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VQYXN0ZWRJbnB1dCh0ZXh0OiBzdHJpbmcpOiBQYXJzZWRJbnB1dCB7XG5cdGNvbnN0IHNlcGFyYXRvciA9IHRleHQuaW5kZXhPZihcIjtcIikgIT09IC0xID8gXCI7XCIgOiBcIixcIlxuXHRjb25zdCB0ZXh0UGFydHMgPSB0ZXh0LnNwbGl0KHNlcGFyYXRvcikubWFwKChwYXJ0KSA9PiBwYXJ0LnRyaW0oKSlcblxuXHRjb25zdCByZXN1bHQ6IFBhcnNlZElucHV0ID0ge1xuXHRcdHJlbWFpbmluZ1RleHQ6IFwiXCIsXG5cdFx0bmV3UmVjaXBpZW50czogW10sXG5cdFx0ZXJyb3JzOiBbXSxcblx0fVxuXG5cdGZvciAobGV0IHBhcnQgb2YgdGV4dFBhcnRzKSB7XG5cdFx0cGFydCA9IHBhcnQudHJpbSgpXG5cblx0XHRpZiAocGFydC5sZW5ndGggIT09IDApIHtcblx0XHRcdGNvbnN0IHBhcnNlZCA9IHBhcnNlTWFpbEFkZHJlc3MocGFydClcblxuXHRcdFx0aWYgKCFwYXJzZWQpIHtcblx0XHRcdFx0cmVzdWx0LmVycm9ycy5wdXNoKHBhcnQpXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXN1bHQubmV3UmVjaXBpZW50cy5wdXNoKHBhcnNlZClcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gcmVzdWx0XG59XG5cbi8qKlxuICogUGFyc2UgdGV4dCB3aGVuIGl0IGlzIHR5cGVkIGJ5IHRoZSB1c2VyXG4gKiBXaGVuIHRoZSBmaW5hbCBjaGFyYWN0ZXIgaXMgYW4gZXhwZWN0ZWQgZGVsaW1pdGVyICgnOycsICcsJywgJyAnKSxcbiAqIHRoZW4gd2UgYXR0ZW1wdCB0byBwYXJzZSB0aGUgcHJlY2VkaW5nIHRleHQuIElmIGl0IGlzIGEgdmFsaWQgbWFpbCBhZGRyZXNzLFxuICogaXQgaXMgc3VjY2Vzc2Z1bGx5IHBhcnNlZFxuICogaW52YWxpZCBpbnB1dCBnZXRzIHJldHVybmVkIGluIGByZW1haW5pbmdUZXh0YCwgYGVycm9yc2AgaXMgYWx3YXlzIGVtcHR5XG4gKiBAcGFyYW0gdGV4dFxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VUeXBlZElucHV0KHRleHQ6IHN0cmluZyk6IFBhcnNlZElucHV0IHtcblx0Y29uc3QgbGFzdENoYXJhY3RlciA9IHRleHQuc2xpY2UoLTEpXG5cblx0Ly8gb24gc2VtaWNvbG9uLCBjb21tYW4gb3Igc3BhY2Ugd2Ugd2FudCB0byB0cnkgdG8gcmVzb2x2ZSB0aGUgaW5wdXQgdGV4dFxuXHRpZiAobGFzdENoYXJhY3RlciA9PT0gXCI7XCIgfHwgbGFzdENoYXJhY3RlciA9PT0gXCIsXCIgfHwgbGFzdENoYXJhY3RlciA9PT0gXCIgXCIpIHtcblx0XHRjb25zdCB0ZXh0TWludXNMYXN0ID0gdGV4dC5zbGljZSgwLCAtMSlcblxuXHRcdGNvbnN0IHJlc3VsdCA9IHBhcnNlTWFpbEFkZHJlc3ModGV4dE1pbnVzTGFzdClcblx0XHRjb25zdCByZW1haW5pbmdUZXh0ID0gcmVzdWx0ICE9IG51bGwgPyBcIlwiIDogdGV4dE1pbnVzTGFzdFxuXG5cdFx0cmV0dXJuIHtcblx0XHRcdHJlbWFpbmluZ1RleHQsXG5cdFx0XHRuZXdSZWNpcGllbnRzOiByZXN1bHQgPyBbcmVzdWx0XSA6IFtdLFxuXHRcdFx0ZXJyb3JzOiBbXSxcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdHJlbWFpbmluZ1RleHQ6IHRleHQsXG5cdFx0XHRuZXdSZWNpcGllbnRzOiBbXSxcblx0XHRcdGVycm9yczogW10sXG5cdFx0fVxuXHR9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZU1haWxBZGRyZXNzKHRleHQ6IHN0cmluZyk6IHsgYWRkcmVzczogc3RyaW5nOyBuYW1lOiBzdHJpbmcgfCBudWxsIH0gfCBudWxsIHtcblx0dGV4dCA9IHRleHQudHJpbSgpXG5cblx0aWYgKHRleHQgPT09IFwiXCIpIHJldHVybiBudWxsXG5cblx0Y29uc3QgbmFtZUFuZE1haWxBZGRyZXNzID0gc3RyaW5nVG9OYW1lQW5kTWFpbEFkZHJlc3ModGV4dClcblxuXHRpZiAobmFtZUFuZE1haWxBZGRyZXNzKSB7XG5cdFx0Y29uc3QgbmFtZSA9IG5hbWVBbmRNYWlsQWRkcmVzcy5uYW1lID8gbmFtZUFuZE1haWxBZGRyZXNzLm5hbWUgOiBudWxsXG5cblx0XHRyZXR1cm4geyBuYW1lLCBhZGRyZXNzOiBuYW1lQW5kTWFpbEFkZHJlc3MubWFpbEFkZHJlc3MgfVxuXHR9IGVsc2Uge1xuXHRcdHJldHVybiBudWxsXG5cdH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztJQTBCYSxrQkFBTixNQUFzRTtDQUM1RSxBQUFRLFNBQWtCO0NBQzFCLEFBQVEsV0FBb0M7Q0FFNUMsS0FBSyxFQUFFLE9BQW9DLEVBQUU7QUFDNUMsU0FBTyxnQkFBRSxzQkFBc0IsQ0FDOUIsZ0JBQUUsV0FBVztHQUNaLE9BQU8sTUFBTTtHQUNiLFVBQVUsTUFBTTtHQUNoQixPQUFPLE1BQU07R0FDYixTQUFTLE1BQU07R0FDZixXQUFXLE1BQU07R0FDakIsTUFBTSxjQUFjO0dBQ3BCLGdCQUFnQixhQUFhO0dBQzdCLGdCQUFnQixNQUFNO0FBQ3JCLFdBQU8sTUFBTSxNQUFNLElBQUksQ0FBQyxNQUFNLEtBQUssVUFBVTtLQUc1QyxNQUFNLGFBQWEsTUFBTSxpQkFBaUIsS0FBSztBQUMvQyxZQUFPLGdCQUFFLG1DQUFtQyxDQUMzQyxnQkFDQyw2Q0FDQSxnQkFBRSxZQUFZO01BQ2IsT0FBTztNQUNQLE1BQU0sV0FBVztNQUNqQixPQUFPO01BQ1AsT0FBTyxFQUNOLGFBQWEsT0FDYjtNQUNELFNBQVMsQ0FBQ0EsTUFBa0I7QUFDM0IsU0FBRSxpQkFBaUI7QUFDbkIsMkJBQW9CO1FBQ25CLGFBQWEsTUFBTSxNQUFNLHVCQUF1QixLQUFLO1FBQ3JELE9BQU87T0FDUCxFQUFDLENBQUMsR0FBRyxFQUFFLE9BQXNCO01BQzlCO0tBQ0QsRUFBQyxDQUNGLEVBRUQsS0FBSyxVQUFVLE1BQU0sTUFBTSxTQUFTLEtBQUssTUFBTSxTQUFTLEtBQUssZ0JBQUUsV0FBVyxJQUFJLEdBQUcsSUFDakYsRUFBQztJQUNGLEVBQUM7R0FDRjtHQUNELGlCQUFpQixNQUFNLE1BQU0sbUJBQW1CO0dBQ2hELFVBQVUsTUFBTTtBQVFmLDBCQUFzQixNQUFNO0FBQzNCLFNBQUksS0FBSyxTQUFVLE1BQUssU0FBUyxPQUFPO0lBQ3hDLEVBQUM7R0FDRjtHQUNELG1CQUFtQixDQUFDLFFBQVMsS0FBSyxXQUFXO0dBQzdDLFNBQVMsTUFBTTtBQUNkLFNBQUssU0FBUztBQUNkLFVBQU0sU0FBUztHQUNmO0dBQ0QsUUFBUSxNQUFNO0FBQ2IsU0FBSyxTQUFTO0FBQ2QsVUFBTSxRQUFRO0dBQ2Q7R0FDRCxZQUFZLENBQUMsUUFBUTtBQUNwQixRQUFJLElBQUksT0FBTyxLQUNkLFNBQVEsSUFBSSxJQUFJLGFBQWEsRUFBN0I7QUFDQyxVQUFLLEtBQUssVUFBVSxLQUNuQixRQUFPLE1BQU0sYUFBYTtBQUUzQixVQUFLLEtBQUssT0FBTyxLQUNoQixRQUFPLE1BQU0sWUFBWTtBQUUxQixVQUFLLEtBQUssS0FBSyxLQUNkLFFBQU8sTUFBTSxTQUFTO0FBRXZCLFVBQUssS0FBSyxHQUFHLEtBQ1osUUFBTyxNQUFNLFdBQVc7SUFDekI7QUFFRixXQUFPO0dBQ1A7RUFDRCxFQUFDLEFBQ0YsRUFBQztDQUNGO0FBQ0Q7Ozs7QUMzR0QsTUFBTSxjQUFjO0lBaUJQLGlCQUFOLE1BQTZGO0NBQ25HLEFBQVE7Q0FDUixBQUFRLGlCQUF5QjtDQUVqQyxXQUFXO0FBQ1YsZUFBYSx3QkFBd0IsQ0FBQyxZQUFZO0FBV2pELFFBQUssaUJBQWlCO0VBQ3RCLEVBQUM7Q0FDRjtDQUVELEtBQUssRUFBRSxPQUFzQyxFQUFZO0FBQ3hELE1BQUksTUFBTSw0QkFBNEIsTUFBTSwyQkFBMkIsS0FBSyxlQUMzRSx1QkFBc0IsTUFBTTtBQUMzQixpQkFBYyxLQUFLLGdCQUFnQixhQUFhLE1BQU0sd0JBQXdCO0VBQzlFLEVBQUM7RUFLSCxJQUFJLGlCQUFpQixjQUFjLEtBQUssSUFBSSxNQUFNLGFBQWEsT0FBTyxXQUFXLE1BQU0sWUFBWSxPQUFPO0FBQzFHLE1BQUksS0FBSyxnQkFBZ0I7R0FDeEIsTUFBTSxNQUFNLEtBQUssZUFBZSx1QkFBdUIsQ0FBQztHQUN4RCxNQUFNLGtCQUFrQixPQUFPLGNBQWMsTUFBTSxLQUFLLGlCQUFpQixLQUFLO0FBQzlFLG9CQUFpQixLQUFLLElBQUksaUJBQWlCLGVBQWU7RUFDMUQ7QUFFRCxTQUFPLGlCQUNMLHFEQUFxRCxNQUFNLFlBQVksU0FBUyxxQkFBcUIsR0FBRyxHQUN6RztHQUNDLFVBQVUsQ0FBQyxVQUFXLEtBQUssaUJBQWlCLE1BQU07R0FDbEQsT0FBTztJQUNOLFlBQVk7SUFDWixRQUFRLEdBQUcsZUFBZTtHQUMxQjtFQUNELEdBQ0QsTUFBTSxZQUFZLElBQUksQ0FBQyxZQUFZLFFBQVEsS0FBSyxpQkFBaUIsT0FBTyxZQUFZLElBQUksQ0FBQyxDQUN6RjtDQUNEO0NBRUQsQUFBUSxpQkFBaUJDLE9BQStCLEVBQUUsVUFBVSxXQUFXLFNBQVksRUFBRUMsS0FBdUI7RUFDbkgsTUFBTSxXQUFXLFFBQVEsTUFBTTtBQUUvQixNQUFJLFlBQVksY0FBYyxRQUM3QixRQUFPO0FBR1IsU0FBTyxnQkFDTixrQ0FDQTtHQUNDLE9BQU8sV0FBVywrQ0FBK0M7R0FDakUsYUFBYSxNQUFNLE1BQU0scUJBQXFCLElBQUk7R0FDbEQsT0FBTztJQUNOLGdCQUFnQixXQUFXLEdBQUcsS0FBSyxhQUFhLEVBQUUsR0FBRyxHQUFHLEtBQUssV0FBVztJQUN4RSxlQUFlLFdBQVcsY0FBYztJQUN4QyxRQUFRLEdBQUcsWUFBWTtHQUN2QjtFQUNELEdBQ0QsQ0FBQyxnQkFBRSxtQ0FBbUMsU0FBUyxFQUFFLGdCQUFFLGtDQUFrQyxVQUFVLEFBQUMsRUFDaEc7Q0FDRDtBQUNEOzs7O0lDdERZLDBCQUFOLE1BQXNGO0NBRTVGLEFBQVEsd0JBQXdCO0NBQ2hDLEFBQVEsVUFBVTtDQUVsQixLQUFLLEVBQUUsT0FBNEMsRUFBWTtBQUM5RCxTQUFPLENBQUMsS0FBSyxnQkFBZ0IsTUFBTSxFQUFFLEtBQUssVUFBVSxLQUFLLGtCQUFrQixNQUFNLEdBQUcsSUFBSztDQUN6RjtDQUVELEFBQVEsZ0JBQWdCQyxPQUErQztBQUN0RSxTQUFPLGdCQUFFLGlCQUFpQjtHQUN6QixPQUFPLE1BQU07R0FDYixNQUFNLE1BQU07R0FDWixXQUFXLE1BQU07R0FDakIsU0FBUyxDQUFDLFNBQVM7QUFDbEIsVUFBTSxPQUFPLE9BQU8sS0FBSyxDQUFDLEtBQUssTUFBTSxnQkFBRSxRQUFRLENBQUM7SUFJaEQsTUFBTSxFQUFFLGVBQWUsZUFBZSxRQUFRLEdBQUcsS0FBSyxTQUFTLE1BQU0sS0FBSyxTQUFTLElBQUksaUJBQWlCLEtBQUssR0FBRyxnQkFBZ0IsS0FBSztBQUVySSxTQUFLLE1BQU0sRUFBRSxTQUFTLE1BQU0sSUFBSSxjQUMvQixPQUFNLGlCQUFpQixTQUFTLE1BQU0sS0FBSztBQUc1QyxRQUFJLE9BQU8sV0FBVyxLQUFLLGNBQWMsV0FBVyxFQUVuRCxPQUFNLGNBQWMsZ0JBQWdCLE9BQU8sQ0FBQztLQUN0QztBQUNOLFNBQUksT0FBTyxTQUFTLEVBQ25CLFFBQU8sUUFDTixLQUFLLGdCQUFnQixnQ0FBZ0MsRUFBRSxLQUFLLElBQUksOEJBQThCLENBQUMsTUFBTSxPQUFPLEtBQUssS0FBSyxDQUFDLEVBQUUsQ0FDekg7QUFFRixXQUFNLGNBQWMsY0FBYztJQUNsQztHQUNEO0dBQ0QsT0FBTyxNQUFNLFdBQVcsSUFBSSxDQUFDLGNBQWMsVUFBVSxRQUFRO0dBQzdELGtCQUFrQixDQUFDQyxZQUFvQjtJQUN0QyxNQUFNLE9BQU8seUJBQXlCLE1BQU0sWUFBWSxRQUFRLEVBQUUsUUFBUTtBQUMxRSxXQUFPLEtBQUssZ0JBQWdCLFNBQVMsMEJBQTBCLE1BQU0sU0FBUyxNQUFNLENBQUM7R0FDckY7R0FDRCx3QkFBd0IsT0FBTyxZQUFhLE1BQU0sTUFBTSxtQ0FBbUMsUUFBUSxJQUFLLENBQUU7R0FDMUcsYUFBYSxNQUFNO0FBQ2xCLFFBQUksTUFBTSxTQUFTLE1BQU0sTUFBTSxXQUFXLFNBQVMsR0FBRztLQUNyRCxNQUFNLEVBQUUsU0FBUyxHQUFHLE1BQU0sV0FBVyxPQUFPLENBQUMsS0FBSztBQUNsRCxXQUFNLGNBQWMsUUFBUTtBQUM1QixXQUFNLG1CQUFtQixRQUFRO0FBQ2pDLFlBQU87SUFDUDtBQUNELFdBQU87R0FDUDtHQUNELFlBQVksTUFBTTtBQUNqQixTQUFLLGFBQWEsT0FBTyxLQUFLO0FBQzlCLFdBQU87R0FDUDtHQUNELFNBQVMsTUFBTTtBQUNkLFNBQUsseUJBQXlCLEtBQUsseUJBQXlCLE1BQU0sR0FBRyxFQUFFO0FBQ3ZFLFdBQU87R0FDUDtHQUNELFdBQVcsTUFBTTtBQUNoQixTQUFLLHlCQUF5QixLQUFLLHlCQUF5QixNQUFNLEdBQUcsRUFBRTtBQUN2RSxXQUFPO0dBQ1A7R0FDRCxTQUFTLE1BQU07QUFDZCxTQUFLLFVBQVU7R0FDZjtHQUNELFFBQVEsTUFBTTtBQUNiLFNBQUssVUFBVTtBQUNmLFNBQUssYUFBYSxPQUFPLE1BQU07QUFDL0IsV0FBTztHQUNQO0dBQ0QsVUFBVSxNQUFNO0dBQ2hCLGlCQUFpQixnQkFBRSxzQkFBc0IsQ0FHeEMsZ0JBQ0MsOENBQ0EsRUFDQyxPQUFPO0lBQ04sT0FBTyxHQUFHLEdBQUc7SUFDYixRQUFRLEdBQUcsS0FBSyxzQkFBc0I7R0FDdEMsRUFDRCxHQUNELE1BQU0sT0FBTyxXQUFXLEdBQUcsY0FBYyxHQUFHLEtBQzVDLEVBQ0QsTUFBTSxlQUNOLEVBQUM7RUFDRixFQUFDO0NBQ0Y7Q0FFRCxBQUFRLGtCQUFrQkQsT0FBK0M7QUFDeEUsU0FBTyxnQkFDTixRQUNBLGdCQUFFLGdCQUFnQjtHQUNqQixhQUFhLE1BQU0sT0FBTyxTQUFTLENBQUMsSUFBSSxDQUFDLGVBQWU7QUFDdkQsUUFBSSxXQUFXLFNBQVMsWUFDdkIsUUFBTztLQUNOLFVBQVUsV0FBVyxNQUFNO0tBQzNCLFdBQVcsV0FBVyxNQUFNO0lBQzVCO0lBRUQsUUFBTztLQUNOLFVBQVUsZ0JBQUUsTUFBTTtNQUNqQixNQUFNLE1BQU07TUFDWixPQUFPO09BQ04sTUFBTSxNQUFNO09BQ1osb0JBQW9CLEtBQUssSUFBSSx3QkFBd0I7TUFDckQ7S0FDRCxFQUFDO0tBQ0YsV0FBVyxXQUFXLE1BQU07SUFDNUI7R0FFRixFQUFDO0dBQ0YseUJBQXlCLEtBQUsseUJBQXlCLE1BQU07R0FDN0Qsc0JBQXNCLENBQUMsUUFBUSxLQUFLLGlCQUFpQixPQUFPLElBQUk7R0FDaEUsV0FBVyxNQUFNLHdCQUF3QjtFQUN6QyxFQUFDLENBQ0Y7Q0FDRDs7Ozs7O0NBT0QsQUFBUSxhQUFhQSxPQUFxQ0Usa0JBQTJCO0VBQ3BGLE1BQU0sY0FBYyxNQUFNLE9BQU8sU0FBUztBQUMxQyxNQUFJLFlBQVksU0FBUyxLQUFLLGlCQUM3QixNQUFLLGlCQUFpQixPQUFPLEtBQUsseUJBQXlCLE1BQU0sQ0FBQztLQUM1RDtHQUNOLE1BQU0sU0FBUyxpQkFBaUIsTUFBTSxLQUFLO0FBQzNDLE9BQUksVUFBVSxNQUFNO0FBQ25CLFVBQU0saUJBQWlCLE9BQU8sU0FBUyxPQUFPLE1BQU0sS0FBSztBQUN6RCxVQUFNLGNBQWMsR0FBRztHQUN2QjtFQUNEO0NBQ0Q7Q0FFRCxNQUFjLGlCQUFpQkYsT0FBcUNHLE9BQWU7RUFDbEYsTUFBTSxZQUFZLE1BQU0sT0FBTyxTQUFTLENBQUM7QUFDekMsTUFBSSxhQUFhLEtBQ2hCO0FBR0QsTUFBSSxVQUFVLFNBQVMsYUFBYTtHQUNuQyxNQUFNLEVBQUUsU0FBUyxNQUFNLFNBQVMsR0FBRyxVQUFVO0FBQzdDLFNBQU0saUJBQWlCLFNBQVMsTUFBTSxRQUFRO0FBQzlDLFNBQU0sT0FBTyxPQUFPO0FBQ3BCLFNBQU0sY0FBYyxHQUFHO0VBQ3ZCLE9BQU07QUFDTixTQUFNLE9BQU8sT0FBTztBQUNwQixTQUFNLGNBQWMsR0FBRztHQUN2QixNQUFNLGFBQWEsTUFBTSxNQUFNLE9BQU8sbUJBQW1CLFVBQVUsTUFBTTtBQUN6RSxRQUFLLE1BQU0sRUFBRSxTQUFTLE1BQU0sU0FBUyxJQUFJLFdBQ3hDLE9BQU0saUJBQWlCLFNBQVMsTUFBTSxRQUFRO0FBRS9DLG1CQUFFLFFBQVE7RUFDVjtDQUNEO0NBRUQsQUFBUSx5QkFBeUJILE9BQTZDO0FBQzdFLFNBQU8sS0FBSyxJQUFJLEtBQUssSUFBSSxLQUFLLHVCQUF1QixFQUFFLEVBQUUsTUFBTSxPQUFPLFNBQVMsQ0FBQyxTQUFTLEVBQUU7Q0FDM0Y7Q0FFRCxBQUFRLHlCQUF5QkksS0FBYTtBQUM3QyxPQUFLLHdCQUF3QjtDQUM3QjtBQUNEO0FBWU0sU0FBUyxpQkFBaUJDLE1BQTJCO0NBQzNELE1BQU0sWUFBWSxLQUFLLFFBQVEsSUFBSSxLQUFLLEtBQUssTUFBTTtDQUNuRCxNQUFNLFlBQVksS0FBSyxNQUFNLFVBQVUsQ0FBQyxJQUFJLENBQUMsU0FBUyxLQUFLLE1BQU0sQ0FBQztDQUVsRSxNQUFNQyxTQUFzQjtFQUMzQixlQUFlO0VBQ2YsZUFBZSxDQUFFO0VBQ2pCLFFBQVEsQ0FBRTtDQUNWO0FBRUQsTUFBSyxJQUFJLFFBQVEsV0FBVztBQUMzQixTQUFPLEtBQUssTUFBTTtBQUVsQixNQUFJLEtBQUssV0FBVyxHQUFHO0dBQ3RCLE1BQU0sU0FBUyxpQkFBaUIsS0FBSztBQUVyQyxRQUFLLE9BQ0osUUFBTyxPQUFPLEtBQUssS0FBSztJQUV4QixRQUFPLGNBQWMsS0FBSyxPQUFPO0VBRWxDO0NBQ0Q7QUFFRCxRQUFPO0FBQ1A7QUFVTSxTQUFTLGdCQUFnQkQsTUFBMkI7Q0FDMUQsTUFBTSxnQkFBZ0IsS0FBSyxNQUFNLEdBQUc7QUFHcEMsS0FBSSxrQkFBa0IsT0FBTyxrQkFBa0IsT0FBTyxrQkFBa0IsS0FBSztFQUM1RSxNQUFNLGdCQUFnQixLQUFLLE1BQU0sR0FBRyxHQUFHO0VBRXZDLE1BQU0sU0FBUyxpQkFBaUIsY0FBYztFQUM5QyxNQUFNLGdCQUFnQixVQUFVLE9BQU8sS0FBSztBQUU1QyxTQUFPO0dBQ047R0FDQSxlQUFlLFNBQVMsQ0FBQyxNQUFPLElBQUcsQ0FBRTtHQUNyQyxRQUFRLENBQUU7RUFDVjtDQUNELE1BQ0EsUUFBTztFQUNOLGVBQWU7RUFDZixlQUFlLENBQUU7RUFDakIsUUFBUSxDQUFFO0NBQ1Y7QUFFRjtBQUVNLFNBQVMsaUJBQWlCQSxNQUErRDtBQUMvRixRQUFPLEtBQUssTUFBTTtBQUVsQixLQUFJLFNBQVMsR0FBSSxRQUFPO0NBRXhCLE1BQU0scUJBQXFCLDJCQUEyQixLQUFLO0FBRTNELEtBQUksb0JBQW9CO0VBQ3ZCLE1BQU0sT0FBTyxtQkFBbUIsT0FBTyxtQkFBbUIsT0FBTztBQUVqRSxTQUFPO0dBQUU7R0FBTSxTQUFTLG1CQUFtQjtFQUFhO0NBQ3hELE1BQ0EsUUFBTztBQUVSIn0=