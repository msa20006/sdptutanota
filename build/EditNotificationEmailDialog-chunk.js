import { __toESM } from "./chunk-chunk.js";
import { mithril_default } from "./mithril-chunk.js";
import { LazyLoaded, assertNotNull, memoized, neverNull, ofClass } from "./dist2-chunk.js";
import { InfoLink, lang, languages } from "./LanguageViewModel-chunk.js";
import { PlanType } from "./TutanotaConstants-chunk.js";
import { GENERATED_MAX_ID } from "./EntityUtils-chunk.js";
import { BookingTypeRef, CustomerInfoTypeRef, CustomerPropertiesTypeRef, createNotificationMailTemplate } from "./TypeRefs2-chunk.js";
import { require_stream } from "./stream-chunk.js";
import { PayloadTooLargeError } from "./RestError-chunk.js";
import { Dialog, DialogType, DropDownSelector, TextField } from "./Dialog-chunk.js";
import { locator } from "./CommonLocator-chunk.js";
import { UserError } from "./UserError-chunk.js";
import { showProgressDialog } from "./ProgressDialog-chunk.js";
import { insertInlineImageB64ClickHandler } from "./SharedMailUtils-chunk.js";
import { showNotAvailableForFreeDialog, showPlanUpgradeRequiredDialog } from "./SubscriptionDialogs-chunk.js";
import { getWhitelabelDomainInfo } from "./CustomerUtils-chunk.js";
import { HtmlEditor } from "./HtmlEditor-chunk.js";
import { htmlSanitizer } from "./HtmlSanitizer-chunk.js";
import { SegmentControl } from "./SegmentControl-chunk.js";
import { getAvailablePlansWithWhitelabel, isWhitelabelActive } from "./SubscriptionUtils-chunk.js";

//#region src/common/settings/EditNotificationEmailDialog.ts
var import_stream = __toESM(require_stream(), 1);
function showAddOrEditNotificationEmailDialog(userController, selectedNotificationLanguage) {
	let existingTemplate = undefined;
	userController.loadCustomer().then((customer) => {
		if (customer.properties) {
			const customerProperties = new LazyLoaded(() => locator.entityClient.load(CustomerPropertiesTypeRef, neverNull(customer.properties)));
			return customerProperties.getAsync().then((loadedCustomerProperties) => {
				if (selectedNotificationLanguage != null) existingTemplate = loadedCustomerProperties.notificationMailTemplates.find((template) => template.language === selectedNotificationLanguage);
			}).then(() => {
				return userController.loadCustomerInfo().then((customerInfo) => {
					return customerInfo.bookings ? locator.entityClient.loadRange(BookingTypeRef, customerInfo.bookings.items, GENERATED_MAX_ID, 1, true).then((bookings) => bookings.length === 1 ? bookings[0] : null) : null;
				}).then((lastBooking) => {
					showBuyOrSetNotificationEmailDialog(lastBooking, customerProperties, existingTemplate);
				});
			});
		}
	});
}
async function showBuyOrSetNotificationEmailDialog(lastBooking, customerProperties, existingTemplate) {
	if (locator.logins.getUserController().isFreeAccount()) showNotAvailableForFreeDialog([PlanType.Unlimited]);
else {
		const planConfiguration = await locator.logins.getUserController().getPlanConfig();
		let whitelabel = isWhitelabelActive(lastBooking, planConfiguration);
		if (!whitelabel) {
			const plansWithWhitelabel = await getAvailablePlansWithWhitelabel();
			whitelabel = await showPlanUpgradeRequiredDialog(plansWithWhitelabel);
		}
		if (whitelabel) show(existingTemplate ?? null, customerProperties);
	}
}
function show(existingTemplate, customerProperties) {
	let template;
	if (!existingTemplate) template = createNotificationMailTemplate({
		language: "en",
		body: getDefaultNotificationMail(),
		subject: lang.get("externalNotificationMailSubject_msg", { "{1}": "{sender}" })
	});
else template = existingTemplate;
	const editor = new HtmlEditor().setMinHeight(400).showBorders().setModeSwitcher("mailBody_label").setValue(template.body).enableToolbar().setToolbarOptions({ imageButtonClickHandler: insertInlineImageB64ClickHandler });
	const editSegment = {
		name: lang.get("edit_action"),
		value: "edit"
	};
	const previewSegment = {
		name: lang.get("preview_label"),
		value: "preview"
	};
	const selectedTab = (0, import_stream.default)(editSegment.value);
	const sortedLanguages = languages.slice().sort((a, b) => lang.get(a.textId).localeCompare(lang.get(b.textId))).map((language) => {
		return {
			name: lang.get(language.textId),
			value: language.code
		};
	});
	const selectedLanguage = assertNotNull(sortedLanguages.find(({ value }) => value === template.language));
	const selectedLanguageStream = (0, import_stream.default)(selectedLanguage.value);
	const subject = (0, import_stream.default)(template.subject);
	let savedHtml = editor.getValue();
	selectedTab.map((tab) => {
		if (tab === editSegment.value) editor.setValue(savedHtml);
else savedHtml = editor.getValue();
	});
	const editTabContent = () => [
		mithril_default(".small.mt-s", lang.get("templateHelp_msg")),
		existingTemplate ? mithril_default(TextField, {
			label: "notificationMailLanguage_label",
			isReadOnly: true,
			value: selectedLanguage.name
		}) : mithril_default(DropDownSelector, {
			label: "notificationMailLanguage_label",
			items: sortedLanguages,
			selectedValue: selectedLanguageStream(),
			selectionChangedHandler: selectedLanguageStream,
			dropdownWidth: 250
		}),
		mithril_default(TextField, {
			label: "subject_label",
			value: subject(),
			oninput: subject
		}),
		mithril_default(editor)
	];
	const senderName = locator.logins.getUserController().userGroupInfo.name;
	let senderDomain = "https://app.tuta.com";
	loadCustomerInfo().then((customerInfo) => {
		const whitelabelDomainInfo = customerInfo && getWhitelabelDomainInfo(customerInfo);
		senderDomain = "https://" + (whitelabelDomainInfo && whitelabelDomainInfo.domain || "app.tuta.com");
		mithril_default.redraw();
	});
	const sanitizePreview = memoized((html) => {
		return htmlSanitizer.sanitizeHTML(html).html;
	});
	const previewTabContent = () => [
		mithril_default(TextField, {
			label: "subject_label",
			value: subject().replace(/{sender}/g, senderName),
			isReadOnly: true
		}),
		mithril_default(".small.mt.mb", lang.get("mailBody_label")),
		mithril_default.trust(sanitizePreview(savedHtml.replace(/{sender}/g, senderName).replace(/{link}/g, senderDomain)))
	];
	Dialog.showActionDialog({
		type: DialogType.EditLarge,
		title: "edit_action",
		child: () => {
			return [mithril_default(SegmentControl, {
				items: [editSegment, previewSegment],
				selectedValue: selectedTab(),
				onValueSelected: selectedTab
			}), selectedTab() === editSegment.value ? editTabContent() : previewTabContent()];
		},
		okAction: (dialog) => {
			if (!editor.getValue().includes("{link}")) return Dialog.message(lang.getTranslation("templateMustContain_msg", { "{value}": "{link}" }));
			let templates;
			let isExistingTemplate;
			const oldLanguage = template.language;
			const oldSubject = template.subject;
			const oldBody = template.body;
			return showProgressDialog("pleaseWait_msg", customerProperties.getAsync().then((customerProperties$1) => {
				templates = customerProperties$1.notificationMailTemplates;
				if (customerProperties$1.notificationMailTemplates.some((t) => t !== existingTemplate && t.language === selectedLanguageStream())) throw new UserError("templateLanguageExists_msg");
				isExistingTemplate = templates.includes(template);
				if (!isExistingTemplate) customerProperties$1.notificationMailTemplates.push(template);
				template.subject = htmlSanitizer.sanitizeHTML(subject(), { blockExternalContent: false }).html;
				template.body = htmlSanitizer.sanitizeHTML(editor.getValue(), { blockExternalContent: false }).html;
				template.language = selectedLanguageStream();
				return locator.entityClient.update(customerProperties$1).then(() => dialog.close());
			})).catch(ofClass(UserError, (err) => {
				return Dialog.message(lang.makeTranslation("error_message", err.message));
			})).catch(ofClass(PayloadTooLargeError, () => {
				template.subject = oldSubject;
				template.body = oldBody;
				template.language = oldLanguage;
				if (!isExistingTemplate) templates.pop();
				return Dialog.message("notificationMailTemplateTooLarge_msg");
			}));
		}
	});
}
const HTML_PTAG_START = "<p>";
const HTML_PTAG_END = "</p>";
function getDefaultNotificationMail() {
	return HTML_PTAG_START + lang.get("externalNotificationMailBody1_msg") + HTML_PTAG_END + HTML_PTAG_START + lang.get("externalNotificationMailBody2_msg", { "{1}": InfoLink.HomePage }) + HTML_PTAG_END + HTML_PTAG_START + "<a href='{link}'>" + lang.get("externalNotificationMailBody3_msg") + "</a>" + HTML_PTAG_END + HTML_PTAG_START + lang.get("externalNotificationMailBody4_msg") + "<br>" + "{link}" + "<br>" + HTML_PTAG_END + HTML_PTAG_START + lang.get("externalNotificationMailBody5_msg") + HTML_PTAG_END + HTML_PTAG_START + lang.get("externalNotificationMailBody6_msg") + "<br>" + "{sender}" + HTML_PTAG_END;
}
function loadCustomerInfo() {
	return locator.logins.getUserController().loadCustomer().then((customer) => locator.entityClient.load(CustomerInfoTypeRef, customer.customerInfo));
}

//#endregion
export { show as show$1, showAddOrEditNotificationEmailDialog, showBuyOrSetNotificationEmailDialog };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWRpdE5vdGlmaWNhdGlvbkVtYWlsRGlhbG9nLWNodW5rLmpzIiwibmFtZXMiOlsidXNlckNvbnRyb2xsZXI6IFVzZXJDb250cm9sbGVyIiwic2VsZWN0ZWROb3RpZmljYXRpb25MYW5ndWFnZT86IHN0cmluZyIsImV4aXN0aW5nVGVtcGxhdGU6IE5vdGlmaWNhdGlvbk1haWxUZW1wbGF0ZSB8IHVuZGVmaW5lZCIsImxhc3RCb29raW5nOiBCb29raW5nIHwgbnVsbCIsImN1c3RvbWVyUHJvcGVydGllczogTGF6eUxvYWRlZDxDdXN0b21lclByb3BlcnRpZXM+IiwiZXhpc3RpbmdUZW1wbGF0ZT86IE5vdGlmaWNhdGlvbk1haWxUZW1wbGF0ZSIsImV4aXN0aW5nVGVtcGxhdGU6IE5vdGlmaWNhdGlvbk1haWxUZW1wbGF0ZSB8IG51bGwiLCJ0ZW1wbGF0ZTogTm90aWZpY2F0aW9uTWFpbFRlbXBsYXRlIiwic29ydGVkTGFuZ3VhZ2VzOiBTZWxlY3Rvckl0ZW1MaXN0PHN0cmluZz4iLCJzZWxlY3RlZExhbmd1YWdlU3RyZWFtOiBTdHJlYW08c3RyaW5nPiIsImRpYWxvZzogRGlhbG9nIiwidGVtcGxhdGVzOiBOb3RpZmljYXRpb25NYWlsVGVtcGxhdGVbXSIsImlzRXhpc3RpbmdUZW1wbGF0ZTogYm9vbGVhbiIsImN1c3RvbWVyUHJvcGVydGllcyJdLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21tb24vc2V0dGluZ3MvRWRpdE5vdGlmaWNhdGlvbkVtYWlsRGlhbG9nLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgQm9va2luZywgQ3VzdG9tZXJJbmZvLCBDdXN0b21lclByb3BlcnRpZXMsIE5vdGlmaWNhdGlvbk1haWxUZW1wbGF0ZSB9IGZyb20gXCIuLi9hcGkvZW50aXRpZXMvc3lzL1R5cGVSZWZzLmpzXCJcbmltcG9ydCB7IEJvb2tpbmdUeXBlUmVmLCBjcmVhdGVOb3RpZmljYXRpb25NYWlsVGVtcGxhdGUsIEN1c3RvbWVySW5mb1R5cGVSZWYsIEN1c3RvbWVyUHJvcGVydGllc1R5cGVSZWYgfSBmcm9tIFwiLi4vYXBpL2VudGl0aWVzL3N5cy9UeXBlUmVmcy5qc1wiXG5pbXBvcnQgeyBIdG1sRWRpdG9yIH0gZnJvbSBcIi4uL2d1aS9lZGl0b3IvSHRtbEVkaXRvci5qc1wiXG5pbXBvcnQgeyBJbmZvTGluaywgbGFuZywgbGFuZ3VhZ2VzIH0gZnJvbSBcIi4uL21pc2MvTGFuZ3VhZ2VWaWV3TW9kZWwuanNcIlxuaW1wb3J0IHN0cmVhbSBmcm9tIFwibWl0aHJpbC9zdHJlYW1cIlxuaW1wb3J0IFN0cmVhbSBmcm9tIFwibWl0aHJpbC9zdHJlYW1cIlxuaW1wb3J0IHsgRGlhbG9nLCBEaWFsb2dUeXBlIH0gZnJvbSBcIi4uL2d1aS9iYXNlL0RpYWxvZy5qc1wiXG5pbXBvcnQgbSBmcm9tIFwibWl0aHJpbFwiXG5pbXBvcnQgdHlwZSB7IFNlbGVjdG9ySXRlbUxpc3QgfSBmcm9tIFwiLi4vZ3VpL2Jhc2UvRHJvcERvd25TZWxlY3Rvci5qc1wiXG5pbXBvcnQgeyBEcm9wRG93blNlbGVjdG9yIH0gZnJvbSBcIi4uL2d1aS9iYXNlL0Ryb3BEb3duU2VsZWN0b3IuanNcIlxuaW1wb3J0IHsgVGV4dEZpZWxkIH0gZnJvbSBcIi4uL2d1aS9iYXNlL1RleHRGaWVsZC5qc1wiXG5pbXBvcnQgeyBzaG93UHJvZ3Jlc3NEaWFsb2cgfSBmcm9tIFwiLi4vZ3VpL2RpYWxvZ3MvUHJvZ3Jlc3NEaWFsb2cuanNcIlxuaW1wb3J0IHsgYXNzZXJ0Tm90TnVsbCwgTGF6eUxvYWRlZCwgbWVtb2l6ZWQsIG5ldmVyTnVsbCwgb2ZDbGFzcyB9IGZyb20gXCJAdHV0YW8vdHV0YW5vdGEtdXRpbHNcIlxuaW1wb3J0IHsgaHRtbFNhbml0aXplciB9IGZyb20gXCIuLi9taXNjL0h0bWxTYW5pdGl6ZXIuanNcIlxuaW1wb3J0IHsgUGF5bG9hZFRvb0xhcmdlRXJyb3IgfSBmcm9tIFwiLi4vYXBpL2NvbW1vbi9lcnJvci9SZXN0RXJyb3IuanNcIlxuaW1wb3J0IHsgU2VnbWVudENvbnRyb2wgfSBmcm9tIFwiLi4vZ3VpL2Jhc2UvU2VnbWVudENvbnRyb2wuanNcIlxuaW1wb3J0IHsgVXNlckVycm9yIH0gZnJvbSBcIi4uL2FwaS9tYWluL1VzZXJFcnJvci5qc1wiXG5pbXBvcnQgeyBzaG93Tm90QXZhaWxhYmxlRm9yRnJlZURpYWxvZywgc2hvd1BsYW5VcGdyYWRlUmVxdWlyZWREaWFsb2cgfSBmcm9tIFwiLi4vbWlzYy9TdWJzY3JpcHRpb25EaWFsb2dzLmpzXCJcbmltcG9ydCB7IGdldEF2YWlsYWJsZVBsYW5zV2l0aFdoaXRlbGFiZWwsIGlzV2hpdGVsYWJlbEFjdGl2ZSB9IGZyb20gXCIuLi9zdWJzY3JpcHRpb24vU3Vic2NyaXB0aW9uVXRpbHMuanNcIlxuaW1wb3J0IHR5cGUgeyBVc2VyQ29udHJvbGxlciB9IGZyb20gXCIuLi9hcGkvbWFpbi9Vc2VyQ29udHJvbGxlci5qc1wiXG5pbXBvcnQgeyBHRU5FUkFURURfTUFYX0lEIH0gZnJvbSBcIi4uL2FwaS9jb21tb24vdXRpbHMvRW50aXR5VXRpbHMuanNcIlxuaW1wb3J0IHsgbG9jYXRvciB9IGZyb20gXCIuLi9hcGkvbWFpbi9Db21tb25Mb2NhdG9yLmpzXCJcbmltcG9ydCB7IFBsYW5UeXBlIH0gZnJvbSBcIi4uL2FwaS9jb21tb24vVHV0YW5vdGFDb25zdGFudHMuanNcIlxuaW1wb3J0IHsgZ2V0V2hpdGVsYWJlbERvbWFpbkluZm8gfSBmcm9tIFwiLi4vYXBpL2NvbW1vbi91dGlscy9DdXN0b21lclV0aWxzLmpzXCJcblxuaW1wb3J0IHsgaW5zZXJ0SW5saW5lSW1hZ2VCNjRDbGlja0hhbmRsZXIgfSBmcm9tIFwiLi4vbWFpbEZ1bmN0aW9uYWxpdHkvU2hhcmVkTWFpbFV0aWxzLmpzXCJcblxuZXhwb3J0IGZ1bmN0aW9uIHNob3dBZGRPckVkaXROb3RpZmljYXRpb25FbWFpbERpYWxvZyh1c2VyQ29udHJvbGxlcjogVXNlckNvbnRyb2xsZXIsIHNlbGVjdGVkTm90aWZpY2F0aW9uTGFuZ3VhZ2U/OiBzdHJpbmcpIHtcblx0bGV0IGV4aXN0aW5nVGVtcGxhdGU6IE5vdGlmaWNhdGlvbk1haWxUZW1wbGF0ZSB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZFxuXHR1c2VyQ29udHJvbGxlci5sb2FkQ3VzdG9tZXIoKS50aGVuKChjdXN0b21lcikgPT4ge1xuXHRcdGlmIChjdXN0b21lci5wcm9wZXJ0aWVzKSB7XG5cdFx0XHRjb25zdCBjdXN0b21lclByb3BlcnRpZXMgPSBuZXcgTGF6eUxvYWRlZCgoKSA9PiBsb2NhdG9yLmVudGl0eUNsaWVudC5sb2FkKEN1c3RvbWVyUHJvcGVydGllc1R5cGVSZWYsIG5ldmVyTnVsbChjdXN0b21lci5wcm9wZXJ0aWVzKSkpXG5cdFx0XHRyZXR1cm4gY3VzdG9tZXJQcm9wZXJ0aWVzXG5cdFx0XHRcdC5nZXRBc3luYygpXG5cdFx0XHRcdC50aGVuKChsb2FkZWRDdXN0b21lclByb3BlcnRpZXMpID0+IHtcblx0XHRcdFx0XHRpZiAoc2VsZWN0ZWROb3RpZmljYXRpb25MYW5ndWFnZSAhPSBudWxsKSB7XG5cdFx0XHRcdFx0XHRleGlzdGluZ1RlbXBsYXRlID0gbG9hZGVkQ3VzdG9tZXJQcm9wZXJ0aWVzLm5vdGlmaWNhdGlvbk1haWxUZW1wbGF0ZXMuZmluZChcblx0XHRcdFx0XHRcdFx0KHRlbXBsYXRlKSA9PiB0ZW1wbGF0ZS5sYW5ndWFnZSA9PT0gc2VsZWN0ZWROb3RpZmljYXRpb25MYW5ndWFnZSxcblx0XHRcdFx0XHRcdClcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC50aGVuKCgpID0+IHtcblx0XHRcdFx0XHRyZXR1cm4gdXNlckNvbnRyb2xsZXJcblx0XHRcdFx0XHRcdC5sb2FkQ3VzdG9tZXJJbmZvKClcblx0XHRcdFx0XHRcdC50aGVuKChjdXN0b21lckluZm8pID0+IHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGN1c3RvbWVySW5mby5ib29raW5nc1xuXHRcdFx0XHRcdFx0XHRcdD8gbG9jYXRvci5lbnRpdHlDbGllbnRcblx0XHRcdFx0XHRcdFx0XHRcdFx0LmxvYWRSYW5nZShCb29raW5nVHlwZVJlZiwgY3VzdG9tZXJJbmZvLmJvb2tpbmdzLml0ZW1zLCBHRU5FUkFURURfTUFYX0lELCAxLCB0cnVlKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHQudGhlbigoYm9va2luZ3MpID0+IChib29raW5ncy5sZW5ndGggPT09IDEgPyBib29raW5nc1swXSA6IG51bGwpKVxuXHRcdFx0XHRcdFx0XHRcdDogbnVsbFxuXHRcdFx0XHRcdFx0fSlcblx0XHRcdFx0XHRcdC50aGVuKChsYXN0Qm9va2luZykgPT4ge1xuXHRcdFx0XHRcdFx0XHRzaG93QnV5T3JTZXROb3RpZmljYXRpb25FbWFpbERpYWxvZyhsYXN0Qm9va2luZywgY3VzdG9tZXJQcm9wZXJ0aWVzLCBleGlzdGluZ1RlbXBsYXRlKVxuXHRcdFx0XHRcdFx0fSlcblx0XHRcdFx0fSlcblx0XHR9XG5cdH0pXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaG93QnV5T3JTZXROb3RpZmljYXRpb25FbWFpbERpYWxvZyhcblx0bGFzdEJvb2tpbmc6IEJvb2tpbmcgfCBudWxsLFxuXHRjdXN0b21lclByb3BlcnRpZXM6IExhenlMb2FkZWQ8Q3VzdG9tZXJQcm9wZXJ0aWVzPixcblx0ZXhpc3RpbmdUZW1wbGF0ZT86IE5vdGlmaWNhdGlvbk1haWxUZW1wbGF0ZSxcbik6IFByb21pc2U8dm9pZD4ge1xuXHRpZiAobG9jYXRvci5sb2dpbnMuZ2V0VXNlckNvbnRyb2xsZXIoKS5pc0ZyZWVBY2NvdW50KCkpIHtcblx0XHRzaG93Tm90QXZhaWxhYmxlRm9yRnJlZURpYWxvZyhbUGxhblR5cGUuVW5saW1pdGVkXSlcblx0fSBlbHNlIHtcblx0XHRjb25zdCBwbGFuQ29uZmlndXJhdGlvbiA9IGF3YWl0IGxvY2F0b3IubG9naW5zLmdldFVzZXJDb250cm9sbGVyKCkuZ2V0UGxhbkNvbmZpZygpXG5cdFx0bGV0IHdoaXRlbGFiZWwgPSBpc1doaXRlbGFiZWxBY3RpdmUobGFzdEJvb2tpbmcsIHBsYW5Db25maWd1cmF0aW9uKVxuXHRcdGlmICghd2hpdGVsYWJlbCkge1xuXHRcdFx0Y29uc3QgcGxhbnNXaXRoV2hpdGVsYWJlbCA9IGF3YWl0IGdldEF2YWlsYWJsZVBsYW5zV2l0aFdoaXRlbGFiZWwoKVxuXHRcdFx0d2hpdGVsYWJlbCA9IGF3YWl0IHNob3dQbGFuVXBncmFkZVJlcXVpcmVkRGlhbG9nKHBsYW5zV2l0aFdoaXRlbGFiZWwpXG5cdFx0fVxuXHRcdGlmICh3aGl0ZWxhYmVsKSB7XG5cdFx0XHRzaG93KGV4aXN0aW5nVGVtcGxhdGUgPz8gbnVsbCwgY3VzdG9tZXJQcm9wZXJ0aWVzKVxuXHRcdH1cblx0fVxufVxuXG5leHBvcnQgZnVuY3Rpb24gc2hvdyhleGlzdGluZ1RlbXBsYXRlOiBOb3RpZmljYXRpb25NYWlsVGVtcGxhdGUgfCBudWxsLCBjdXN0b21lclByb3BlcnRpZXM6IExhenlMb2FkZWQ8Q3VzdG9tZXJQcm9wZXJ0aWVzPikge1xuXHRsZXQgdGVtcGxhdGU6IE5vdGlmaWNhdGlvbk1haWxUZW1wbGF0ZVxuXG5cdGlmICghZXhpc3RpbmdUZW1wbGF0ZSkge1xuXHRcdHRlbXBsYXRlID0gY3JlYXRlTm90aWZpY2F0aW9uTWFpbFRlbXBsYXRlKHtcblx0XHRcdGxhbmd1YWdlOiBcImVuXCIsXG5cdFx0XHRib2R5OiBnZXREZWZhdWx0Tm90aWZpY2F0aW9uTWFpbCgpLFxuXHRcdFx0c3ViamVjdDogbGFuZy5nZXQoXCJleHRlcm5hbE5vdGlmaWNhdGlvbk1haWxTdWJqZWN0X21zZ1wiLCB7XG5cdFx0XHRcdFwiezF9XCI6IFwie3NlbmRlcn1cIixcblx0XHRcdH0pLFxuXHRcdH0pXG5cdH0gZWxzZSB7XG5cdFx0dGVtcGxhdGUgPSBleGlzdGluZ1RlbXBsYXRlXG5cdH1cblxuXHRjb25zdCBlZGl0b3IgPSBuZXcgSHRtbEVkaXRvcigpXG5cdFx0LnNldE1pbkhlaWdodCg0MDApXG5cdFx0LnNob3dCb3JkZXJzKClcblx0XHQuc2V0TW9kZVN3aXRjaGVyKFwibWFpbEJvZHlfbGFiZWxcIilcblx0XHQuc2V0VmFsdWUodGVtcGxhdGUuYm9keSlcblx0XHQuZW5hYmxlVG9vbGJhcigpXG5cdFx0LnNldFRvb2xiYXJPcHRpb25zKHtcblx0XHRcdGltYWdlQnV0dG9uQ2xpY2tIYW5kbGVyOiBpbnNlcnRJbmxpbmVJbWFnZUI2NENsaWNrSGFuZGxlcixcblx0XHR9KVxuXHRjb25zdCBlZGl0U2VnbWVudCA9IHtcblx0XHRuYW1lOiBsYW5nLmdldChcImVkaXRfYWN0aW9uXCIpLFxuXHRcdHZhbHVlOiBcImVkaXRcIixcblx0fVxuXHRjb25zdCBwcmV2aWV3U2VnbWVudCA9IHtcblx0XHRuYW1lOiBsYW5nLmdldChcInByZXZpZXdfbGFiZWxcIiksXG5cdFx0dmFsdWU6IFwicHJldmlld1wiLFxuXHR9XG5cdGNvbnN0IHNlbGVjdGVkVGFiID0gc3RyZWFtKGVkaXRTZWdtZW50LnZhbHVlKVxuXHRjb25zdCBzb3J0ZWRMYW5ndWFnZXM6IFNlbGVjdG9ySXRlbUxpc3Q8c3RyaW5nPiA9IGxhbmd1YWdlc1xuXHRcdC5zbGljZSgpXG5cdFx0LnNvcnQoKGEsIGIpID0+IGxhbmcuZ2V0KGEudGV4dElkKS5sb2NhbGVDb21wYXJlKGxhbmcuZ2V0KGIudGV4dElkKSkpXG5cdFx0Lm1hcCgobGFuZ3VhZ2UpID0+IHtcblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdG5hbWU6IGxhbmcuZ2V0KGxhbmd1YWdlLnRleHRJZCksXG5cdFx0XHRcdHZhbHVlOiBsYW5ndWFnZS5jb2RlLFxuXHRcdFx0fVxuXHRcdH0pXG5cdGNvbnN0IHNlbGVjdGVkTGFuZ3VhZ2UgPSBhc3NlcnROb3ROdWxsKHNvcnRlZExhbmd1YWdlcy5maW5kKCh7IHZhbHVlIH0pID0+IHZhbHVlID09PSB0ZW1wbGF0ZS5sYW5ndWFnZSkpXG5cdGNvbnN0IHNlbGVjdGVkTGFuZ3VhZ2VTdHJlYW06IFN0cmVhbTxzdHJpbmc+ID0gc3RyZWFtKHNlbGVjdGVkTGFuZ3VhZ2UudmFsdWUpXG5cdGNvbnN0IHN1YmplY3QgPSBzdHJlYW0odGVtcGxhdGUuc3ViamVjdClcblx0Ly8gRWRpdG9yIHJlc2V0cyBpdHMgdmFsdWUgb24gcmUtYXR0YWNoIHNvIHdlIGtlZXAgaXQgb3Vyc2VsdmVzXG5cdGxldCBzYXZlZEh0bWwgPSBlZGl0b3IuZ2V0VmFsdWUoKVxuXHRzZWxlY3RlZFRhYi5tYXAoKHRhYikgPT4ge1xuXHRcdGlmICh0YWIgPT09IGVkaXRTZWdtZW50LnZhbHVlKSB7XG5cdFx0XHRlZGl0b3Iuc2V0VmFsdWUoc2F2ZWRIdG1sKVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRzYXZlZEh0bWwgPSBlZGl0b3IuZ2V0VmFsdWUoKVxuXHRcdH1cblx0fSlcblxuXHRjb25zdCBlZGl0VGFiQ29udGVudCA9ICgpID0+IFtcblx0XHRtKFwiLnNtYWxsLm10LXNcIiwgbGFuZy5nZXQoXCJ0ZW1wbGF0ZUhlbHBfbXNnXCIpKSxcblx0XHRleGlzdGluZ1RlbXBsYXRlXG5cdFx0XHQ/IG0oVGV4dEZpZWxkLCB7XG5cdFx0XHRcdFx0bGFiZWw6IFwibm90aWZpY2F0aW9uTWFpbExhbmd1YWdlX2xhYmVsXCIsXG5cdFx0XHRcdFx0aXNSZWFkT25seTogdHJ1ZSxcblx0XHRcdFx0XHR2YWx1ZTogc2VsZWN0ZWRMYW5ndWFnZS5uYW1lLFxuXHRcdFx0ICB9KVxuXHRcdFx0OiBtKERyb3BEb3duU2VsZWN0b3IsIHtcblx0XHRcdFx0XHRsYWJlbDogXCJub3RpZmljYXRpb25NYWlsTGFuZ3VhZ2VfbGFiZWxcIixcblx0XHRcdFx0XHRpdGVtczogc29ydGVkTGFuZ3VhZ2VzLFxuXHRcdFx0XHRcdHNlbGVjdGVkVmFsdWU6IHNlbGVjdGVkTGFuZ3VhZ2VTdHJlYW0oKSxcblx0XHRcdFx0XHRzZWxlY3Rpb25DaGFuZ2VkSGFuZGxlcjogc2VsZWN0ZWRMYW5ndWFnZVN0cmVhbSxcblx0XHRcdFx0XHRkcm9wZG93bldpZHRoOiAyNTAsXG5cdFx0XHQgIH0pLFxuXHRcdG0oVGV4dEZpZWxkLCB7XG5cdFx0XHRsYWJlbDogXCJzdWJqZWN0X2xhYmVsXCIsXG5cdFx0XHR2YWx1ZTogc3ViamVjdCgpLFxuXHRcdFx0b25pbnB1dDogc3ViamVjdCxcblx0XHR9KSxcblx0XHRtKGVkaXRvciksXG5cdF1cblxuXHRjb25zdCBzZW5kZXJOYW1lID0gbG9jYXRvci5sb2dpbnMuZ2V0VXNlckNvbnRyb2xsZXIoKS51c2VyR3JvdXBJbmZvLm5hbWVcblx0bGV0IHNlbmRlckRvbWFpbiA9IFwiaHR0cHM6Ly9hcHAudHV0YS5jb21cIlxuXHRsb2FkQ3VzdG9tZXJJbmZvKCkudGhlbigoY3VzdG9tZXJJbmZvKSA9PiB7XG5cdFx0Y29uc3Qgd2hpdGVsYWJlbERvbWFpbkluZm8gPSBjdXN0b21lckluZm8gJiYgZ2V0V2hpdGVsYWJlbERvbWFpbkluZm8oY3VzdG9tZXJJbmZvKVxuXHRcdHNlbmRlckRvbWFpbiA9IFwiaHR0cHM6Ly9cIiArICgod2hpdGVsYWJlbERvbWFpbkluZm8gJiYgd2hpdGVsYWJlbERvbWFpbkluZm8uZG9tYWluKSB8fCBcImFwcC50dXRhLmNvbVwiKVxuXHRcdG0ucmVkcmF3KClcblx0fSlcblx0Ly8gRXZlbiB0aG91Z2ggc2F2ZWRIdG1sIGlzIGFsd2F5cyBzYW5pdGl6ZWQgY2hhbmdpbmcgaXQgbWlnaHQgbGVhZCB0byBtWFNTXG5cdGNvbnN0IHNhbml0aXplUHJldmlldyA9IG1lbW9pemVkPHN0cmluZywgc3RyaW5nPigoaHRtbCkgPT4ge1xuXHRcdHJldHVybiBodG1sU2FuaXRpemVyLnNhbml0aXplSFRNTChodG1sKS5odG1sXG5cdH0pXG5cblx0Y29uc3QgcHJldmlld1RhYkNvbnRlbnQgPSAoKSA9PiBbXG5cdFx0bShUZXh0RmllbGQsIHtcblx0XHRcdGxhYmVsOiBcInN1YmplY3RfbGFiZWxcIixcblx0XHRcdHZhbHVlOiBzdWJqZWN0KCkucmVwbGFjZSgve3NlbmRlcn0vZywgc2VuZGVyTmFtZSksXG5cdFx0XHRpc1JlYWRPbmx5OiB0cnVlLFxuXHRcdH0pLFxuXHRcdG0oXCIuc21hbGwubXQubWJcIiwgbGFuZy5nZXQoXCJtYWlsQm9keV9sYWJlbFwiKSksXG5cdFx0bS50cnVzdChzYW5pdGl6ZVByZXZpZXcoc2F2ZWRIdG1sLnJlcGxhY2UoL3tzZW5kZXJ9L2csIHNlbmRlck5hbWUpLnJlcGxhY2UoL3tsaW5rfS9nLCBzZW5kZXJEb21haW4pKSksXG5cdF1cblxuXHREaWFsb2cuc2hvd0FjdGlvbkRpYWxvZyh7XG5cdFx0dHlwZTogRGlhbG9nVHlwZS5FZGl0TGFyZ2UsXG5cdFx0dGl0bGU6IFwiZWRpdF9hY3Rpb25cIixcblx0XHRjaGlsZDogKCkgPT4ge1xuXHRcdFx0cmV0dXJuIFtcblx0XHRcdFx0bShTZWdtZW50Q29udHJvbCwge1xuXHRcdFx0XHRcdGl0ZW1zOiBbZWRpdFNlZ21lbnQsIHByZXZpZXdTZWdtZW50XSxcblx0XHRcdFx0XHRzZWxlY3RlZFZhbHVlOiBzZWxlY3RlZFRhYigpLFxuXHRcdFx0XHRcdG9uVmFsdWVTZWxlY3RlZDogc2VsZWN0ZWRUYWIsXG5cdFx0XHRcdH0pLFxuXHRcdFx0XHRzZWxlY3RlZFRhYigpID09PSBlZGl0U2VnbWVudC52YWx1ZSA/IGVkaXRUYWJDb250ZW50KCkgOiBwcmV2aWV3VGFiQ29udGVudCgpLFxuXHRcdFx0XVxuXHRcdH0sXG5cdFx0b2tBY3Rpb246IChkaWFsb2c6IERpYWxvZykgPT4ge1xuXHRcdFx0aWYgKCFlZGl0b3IuZ2V0VmFsdWUoKS5pbmNsdWRlcyhcIntsaW5rfVwiKSkge1xuXHRcdFx0XHRyZXR1cm4gRGlhbG9nLm1lc3NhZ2UoXG5cdFx0XHRcdFx0bGFuZy5nZXRUcmFuc2xhdGlvbihcInRlbXBsYXRlTXVzdENvbnRhaW5fbXNnXCIsIHtcblx0XHRcdFx0XHRcdFwie3ZhbHVlfVwiOiBcIntsaW5rfVwiLFxuXHRcdFx0XHRcdH0pLFxuXHRcdFx0XHQpXG5cdFx0XHR9XG5cblx0XHRcdGxldCB0ZW1wbGF0ZXM6IE5vdGlmaWNhdGlvbk1haWxUZW1wbGF0ZVtdXG5cdFx0XHRsZXQgaXNFeGlzdGluZ1RlbXBsYXRlOiBib29sZWFuXG5cdFx0XHRjb25zdCBvbGRMYW5ndWFnZSA9IHRlbXBsYXRlLmxhbmd1YWdlXG5cdFx0XHRjb25zdCBvbGRTdWJqZWN0ID0gdGVtcGxhdGUuc3ViamVjdFxuXHRcdFx0Y29uc3Qgb2xkQm9keSA9IHRlbXBsYXRlLmJvZHlcblx0XHRcdHJldHVybiBzaG93UHJvZ3Jlc3NEaWFsb2coXG5cdFx0XHRcdFwicGxlYXNlV2FpdF9tc2dcIixcblx0XHRcdFx0Y3VzdG9tZXJQcm9wZXJ0aWVzLmdldEFzeW5jKCkudGhlbigoY3VzdG9tZXJQcm9wZXJ0aWVzKSA9PiB7XG5cdFx0XHRcdFx0dGVtcGxhdGVzID0gY3VzdG9tZXJQcm9wZXJ0aWVzLm5vdGlmaWNhdGlvbk1haWxUZW1wbGF0ZXNcblxuXHRcdFx0XHRcdGlmIChjdXN0b21lclByb3BlcnRpZXMubm90aWZpY2F0aW9uTWFpbFRlbXBsYXRlcy5zb21lKCh0KSA9PiB0ICE9PSBleGlzdGluZ1RlbXBsYXRlICYmIHQubGFuZ3VhZ2UgPT09IHNlbGVjdGVkTGFuZ3VhZ2VTdHJlYW0oKSkpIHtcblx0XHRcdFx0XHRcdHRocm93IG5ldyBVc2VyRXJyb3IoXCJ0ZW1wbGF0ZUxhbmd1YWdlRXhpc3RzX21zZ1wiKVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlzRXhpc3RpbmdUZW1wbGF0ZSA9IHRlbXBsYXRlcy5pbmNsdWRlcyh0ZW1wbGF0ZSlcblxuXHRcdFx0XHRcdGlmICghaXNFeGlzdGluZ1RlbXBsYXRlKSB7XG5cdFx0XHRcdFx0XHRjdXN0b21lclByb3BlcnRpZXMubm90aWZpY2F0aW9uTWFpbFRlbXBsYXRlcy5wdXNoKHRlbXBsYXRlKVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHRlbXBsYXRlLnN1YmplY3QgPSBodG1sU2FuaXRpemVyLnNhbml0aXplSFRNTChzdWJqZWN0KCksIHtcblx0XHRcdFx0XHRcdGJsb2NrRXh0ZXJuYWxDb250ZW50OiBmYWxzZSxcblx0XHRcdFx0XHR9KS5odG1sXG5cdFx0XHRcdFx0dGVtcGxhdGUuYm9keSA9IGh0bWxTYW5pdGl6ZXIuc2FuaXRpemVIVE1MKGVkaXRvci5nZXRWYWx1ZSgpLCB7XG5cdFx0XHRcdFx0XHRibG9ja0V4dGVybmFsQ29udGVudDogZmFsc2UsXG5cdFx0XHRcdFx0fSkuaHRtbFxuXHRcdFx0XHRcdHRlbXBsYXRlLmxhbmd1YWdlID0gc2VsZWN0ZWRMYW5ndWFnZVN0cmVhbSgpXG5cdFx0XHRcdFx0cmV0dXJuIGxvY2F0b3IuZW50aXR5Q2xpZW50LnVwZGF0ZShjdXN0b21lclByb3BlcnRpZXMpLnRoZW4oKCkgPT4gZGlhbG9nLmNsb3NlKCkpXG5cdFx0XHRcdH0pLFxuXHRcdFx0KVxuXHRcdFx0XHQuY2F0Y2goXG5cdFx0XHRcdFx0b2ZDbGFzcyhVc2VyRXJyb3IsIChlcnIpID0+IHtcblx0XHRcdFx0XHRcdHJldHVybiBEaWFsb2cubWVzc2FnZShsYW5nLm1ha2VUcmFuc2xhdGlvbihcImVycm9yX21lc3NhZ2VcIiwgZXJyLm1lc3NhZ2UpKVxuXHRcdFx0XHRcdH0pLFxuXHRcdFx0XHQpXG5cdFx0XHRcdC5jYXRjaChcblx0XHRcdFx0XHRvZkNsYXNzKFBheWxvYWRUb29MYXJnZUVycm9yLCAoKSA9PiB7XG5cdFx0XHRcdFx0XHR0ZW1wbGF0ZS5zdWJqZWN0ID0gb2xkU3ViamVjdFxuXHRcdFx0XHRcdFx0dGVtcGxhdGUuYm9keSA9IG9sZEJvZHlcblx0XHRcdFx0XHRcdHRlbXBsYXRlLmxhbmd1YWdlID0gb2xkTGFuZ3VhZ2VcblxuXHRcdFx0XHRcdFx0aWYgKCFpc0V4aXN0aW5nVGVtcGxhdGUpIHtcblx0XHRcdFx0XHRcdFx0dGVtcGxhdGVzLnBvcCgpXG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBEaWFsb2cubWVzc2FnZShcIm5vdGlmaWNhdGlvbk1haWxUZW1wbGF0ZVRvb0xhcmdlX21zZ1wiKVxuXHRcdFx0XHRcdH0pLFxuXHRcdFx0XHQpXG5cdFx0fSxcblx0fSlcbn1cblxuY29uc3QgSFRNTF9QVEFHX1NUQVJUID0gXCI8cD5cIlxuY29uc3QgSFRNTF9QVEFHX0VORCA9IFwiPC9wPlwiXG5cbmZ1bmN0aW9uIGdldERlZmF1bHROb3RpZmljYXRpb25NYWlsKCk6IHN0cmluZyB7XG5cdHJldHVybiAoXG5cdFx0SFRNTF9QVEFHX1NUQVJUICtcblx0XHRsYW5nLmdldChcImV4dGVybmFsTm90aWZpY2F0aW9uTWFpbEJvZHkxX21zZ1wiKSArXG5cdFx0SFRNTF9QVEFHX0VORCArXG5cdFx0SFRNTF9QVEFHX1NUQVJUICtcblx0XHRsYW5nLmdldChcImV4dGVybmFsTm90aWZpY2F0aW9uTWFpbEJvZHkyX21zZ1wiLCB7XG5cdFx0XHRcInsxfVwiOiBJbmZvTGluay5Ib21lUGFnZSxcblx0XHR9KSArXG5cdFx0SFRNTF9QVEFHX0VORCArXG5cdFx0SFRNTF9QVEFHX1NUQVJUICtcblx0XHRcIjxhIGhyZWY9J3tsaW5rfSc+XCIgK1xuXHRcdGxhbmcuZ2V0KFwiZXh0ZXJuYWxOb3RpZmljYXRpb25NYWlsQm9keTNfbXNnXCIpICtcblx0XHRcIjwvYT5cIiArXG5cdFx0SFRNTF9QVEFHX0VORCArXG5cdFx0SFRNTF9QVEFHX1NUQVJUICtcblx0XHRsYW5nLmdldChcImV4dGVybmFsTm90aWZpY2F0aW9uTWFpbEJvZHk0X21zZ1wiKSArXG5cdFx0XCI8YnI+XCIgK1xuXHRcdFwie2xpbmt9XCIgK1xuXHRcdFwiPGJyPlwiICtcblx0XHRIVE1MX1BUQUdfRU5EICtcblx0XHRIVE1MX1BUQUdfU1RBUlQgK1xuXHRcdGxhbmcuZ2V0KFwiZXh0ZXJuYWxOb3RpZmljYXRpb25NYWlsQm9keTVfbXNnXCIpICtcblx0XHRIVE1MX1BUQUdfRU5EICtcblx0XHRIVE1MX1BUQUdfU1RBUlQgK1xuXHRcdGxhbmcuZ2V0KFwiZXh0ZXJuYWxOb3RpZmljYXRpb25NYWlsQm9keTZfbXNnXCIpICtcblx0XHRcIjxicj5cIiArXG5cdFx0XCJ7c2VuZGVyfVwiICtcblx0XHRIVE1MX1BUQUdfRU5EXG5cdClcbn1cblxuZnVuY3Rpb24gbG9hZEN1c3RvbWVySW5mbygpOiBQcm9taXNlPEN1c3RvbWVySW5mbyB8IG51bGw+IHtcblx0cmV0dXJuIGxvY2F0b3IubG9naW5zXG5cdFx0LmdldFVzZXJDb250cm9sbGVyKClcblx0XHQubG9hZEN1c3RvbWVyKClcblx0XHQudGhlbigoY3VzdG9tZXIpID0+IGxvY2F0b3IuZW50aXR5Q2xpZW50LmxvYWQ8Q3VzdG9tZXJJbmZvPihDdXN0b21lckluZm9UeXBlUmVmLCBjdXN0b21lci5jdXN0b21lckluZm8pKVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTJCTyxTQUFTLHFDQUFxQ0EsZ0JBQWdDQyw4QkFBdUM7Q0FDM0gsSUFBSUMsbUJBQXlEO0FBQzdELGdCQUFlLGNBQWMsQ0FBQyxLQUFLLENBQUMsYUFBYTtBQUNoRCxNQUFJLFNBQVMsWUFBWTtHQUN4QixNQUFNLHFCQUFxQixJQUFJLFdBQVcsTUFBTSxRQUFRLGFBQWEsS0FBSywyQkFBMkIsVUFBVSxTQUFTLFdBQVcsQ0FBQztBQUNwSSxVQUFPLG1CQUNMLFVBQVUsQ0FDVixLQUFLLENBQUMsNkJBQTZCO0FBQ25DLFFBQUksZ0NBQWdDLEtBQ25DLG9CQUFtQix5QkFBeUIsMEJBQTBCLEtBQ3JFLENBQUMsYUFBYSxTQUFTLGFBQWEsNkJBQ3BDO0dBRUYsRUFBQyxDQUNELEtBQUssTUFBTTtBQUNYLFdBQU8sZUFDTCxrQkFBa0IsQ0FDbEIsS0FBSyxDQUFDLGlCQUFpQjtBQUN2QixZQUFPLGFBQWEsV0FDakIsUUFBUSxhQUNQLFVBQVUsZ0JBQWdCLGFBQWEsU0FBUyxPQUFPLGtCQUFrQixHQUFHLEtBQUssQ0FDakYsS0FBSyxDQUFDLGFBQWMsU0FBUyxXQUFXLElBQUksU0FBUyxLQUFLLEtBQU0sR0FDakU7SUFDSCxFQUFDLENBQ0QsS0FBSyxDQUFDLGdCQUFnQjtBQUN0Qix5Q0FBb0MsYUFBYSxvQkFBb0IsaUJBQWlCO0lBQ3RGLEVBQUM7R0FDSCxFQUFDO0VBQ0g7Q0FDRCxFQUFDO0FBQ0Y7QUFFTSxlQUFlLG9DQUNyQkMsYUFDQUMsb0JBQ0FDLGtCQUNnQjtBQUNoQixLQUFJLFFBQVEsT0FBTyxtQkFBbUIsQ0FBQyxlQUFlLENBQ3JELCtCQUE4QixD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