import { __toESM } from "./chunk-chunk.js";
import { mithril_default } from "./mithril-chunk.js";
import { clone, difference, downcast, getFirstOrThrow, ofClass, remove } from "./dist2-chunk.js";
import { lang, languageByCode, languages } from "./LanguageViewModel-chunk.js";
import { getElementId, isSameId } from "./EntityUtils-chunk.js";
import { EmailTemplateTypeRef, createEmailTemplate, createEmailTemplateContent } from "./TypeRefs-chunk.js";
import { require_stream } from "./stream-chunk.js";
import { ButtonType } from "./Button-chunk.js";
import { Icons } from "./Icons-chunk.js";
import { Autocapitalize, Dialog, TextField, createDropdown } from "./Dialog-chunk.js";
import { ButtonSize, IconButton } from "./IconButton-chunk.js";
import { locator } from "./CommonLocator-chunk.js";
import { UserError } from "./UserError-chunk.js";
import { showUserError } from "./ErrorHandlerImpl-chunk.js";
import { HtmlEditor } from "./HtmlEditor-chunk.js";

//#region src/mail-app/settings/TemplateEditorModel.ts
var import_stream = __toESM(require_stream(), 1);
var TemplateEditorModel = class {
	template;
	title;
	tag;
	selectedContent;
	_templateGroupRoot;
	_entityClient;
	_contentProvider;
	constructor(template, templateGroupRoot, entityClient) {
		this.template = template ? clone(template) : createEmailTemplate({
			tag: "",
			title: "",
			contents: []
		});
		this.title = (0, import_stream.default)("");
		this.tag = (0, import_stream.default)("");
		const contents = this.template.contents;
		this.selectedContent = (0, import_stream.default)(contents.length > 0 ? getFirstOrThrow(contents) : this.createContent(lang.code));
		this._templateGroupRoot = templateGroupRoot;
		this._entityClient = entityClient;
		this._contentProvider = null;
	}
	isUpdate() {
		return this.template._id != null;
	}
	setContentProvider(provider) {
		this._contentProvider = provider;
	}
	createContent(languageCode) {
		const emailTemplateContent = createEmailTemplateContent({
			languageCode,
			text: ""
		});
		this.template.contents.push(emailTemplateContent);
		return emailTemplateContent;
	}
	updateContent() {
		const selectedContent = this.selectedContent();
		if (selectedContent && this._contentProvider) selectedContent.text = this._contentProvider();
	}
	removeContent() {
		const content = this.selectedContent();
		if (content) remove(this.template.contents, content);
	}
	/**
	* Returns all languages that are available for creating new template content. Returns them in alphabetic order sorted by name.
	* @returns {Array<{name: string, value: LanguageCode}>}
	*/
	getAdditionalLanguages() {
		return difference(languages, this.getAddedLanguages(), (lang1, lang2) => lang1.code === lang2.code);
	}
	getAddedLanguages() {
		return this.template.contents.map((content) => languageByCode[getLanguageCode(content)]);
	}
	tagAlreadyExists() {
		if (this.template._id) return this._entityClient.loadAll(EmailTemplateTypeRef, this._templateGroupRoot.templates).then((allTemplates) => {
			const filteredTemplates = allTemplates.filter((template) => !isSameId(getElementId(this.template), getElementId(template)));
			return filteredTemplates.some((template) => template.tag.toLowerCase() === this.template.tag.toLowerCase());
		});
else return this._entityClient.loadAll(EmailTemplateTypeRef, this._templateGroupRoot.templates).then((allTemplates) => {
			return allTemplates.some((template) => template.tag.toLowerCase() === this.template.tag.toLowerCase());
		});
	}
	save() {
		if (!this.title()) return Promise.reject(new UserError("emptyTitle_msg"));
		if (!this.tag()) return Promise.reject(new UserError("emptyShortcut_msg"));
		this.updateContent();
		this.template.title = this.title().trim();
		this.template.tag = this.tag().trim();
		return this.tagAlreadyExists().then(async (exists) => {
			if (exists) return Promise.reject(new UserError("templateShortcutExists_msg"));
else if (this.template._id) return this._entityClient.update(this.template);
else {
				this.template._ownerGroup = this._templateGroupRoot._id;
				return this._entityClient.setup(this._templateGroupRoot.templates, this.template);
			}
		});
	}
};
function getLanguageCode(content) {
	return downcast(content.languageCode);
}
function getLanguageName(content) {
	return languageByCode[getLanguageCode(content)].textId;
}

//#endregion
//#region src/mail-app/settings/TemplateEditor.ts
function showTemplateEditor(template, templateGroupRoot) {
	const entityClient = locator.entityClient;
	const editorModel = new TemplateEditorModel(template, templateGroupRoot, entityClient);
	const dialogCloseAction = () => {
		dialog.close();
	};
	const saveAction = () => {
		editorModel.save().then(() => {
			dialogCloseAction();
		}).catch(ofClass(UserError, showUserError));
	};
	let headerBarAttrs = {
		left: [{
			label: "cancel_action",
			click: dialogCloseAction,
			type: ButtonType.Secondary
		}],
		right: [{
			label: "save_action",
			click: saveAction,
			type: ButtonType.Primary
		}],
		middle: editorModel.template._id ? "editTemplate_action" : "createTemplate_action"
	};
	const dialog = Dialog.editDialog(headerBarAttrs, TemplateEditor, { model: editorModel });
	dialog.show();
}
var TemplateEditor = class {
	model;
	templateContentEditor;
	constructor(vnode) {
		this.model = vnode.attrs.model;
		this.templateContentEditor = new HtmlEditor("content_label").showBorders().setMinHeight(500).enableToolbar();
		this.model.setContentProvider(() => {
			return this.templateContentEditor.getValue();
		});
		this.model.title(this.model.template.title);
		this.model.tag(this.model.template.tag);
		const content = this.model.selectedContent();
		if (content) this.templateContentEditor.setValue(content.text);
	}
	view() {
		return mithril_default("", [
			mithril_default(TextField, {
				label: "title_placeholder",
				value: this.model.title(),
				oninput: this.model.title
			}),
			mithril_default(TextField, {
				label: "shortcut_label",
				autocapitalize: Autocapitalize.none,
				value: this.model.tag(),
				oninput: this.model.tag
			}),
			mithril_default(TextField, {
				label: "language_label",
				value: this.model.selectedContent() ? lang.getTranslationText(getLanguageName(this.model.selectedContent())) : "",
				injectionsRight: () => mithril_default(".flex.ml-between-s", [this.model.getAddedLanguages().length > 1 ? [this.renderRemoveLangButton(), this.renderSelectLangButton()] : null, this.renderAddLangButton()]),
				isReadOnly: true
			}),
			mithril_default(this.templateContentEditor)
		]);
	}
	renderAddLangButton() {
		return mithril_default(IconButton, {
			title: "addLanguage_action",
			icon: Icons.Add,
			size: ButtonSize.Compact,
			click: createDropdown({
				lazyButtons: () => this.model.getAdditionalLanguages().sort((a, b) => lang.get(a.textId).localeCompare(lang.get(b.textId))).map((lang$1) => this.createAddNewLanguageButtonAttrs(lang$1)),
				width: 250
			})
		});
	}
	renderSelectLangButton() {
		return mithril_default(IconButton, {
			title: "languages_label",
			icon: Icons.Language,
			size: ButtonSize.Compact,
			click: createDropdown({ lazyButtons: () => {
				this.model.updateContent();
				return this.model.template.contents.map((content) => {
					return {
						label: getLanguageName(content),
						click: () => {
							this.model.selectedContent(content);
							this.templateContentEditor.setValue(content.text);
						}
					};
				});
			} })
		});
	}
	renderRemoveLangButton() {
		return mithril_default(IconButton, {
			title: "removeLanguage_action",
			icon: Icons.Trash,
			click: () => this.removeLanguage(),
			size: ButtonSize.Compact
		});
	}
	removeLanguage() {
		return Dialog.confirm(lang.getTranslation("deleteLanguageConfirmation_msg", { "{language}": getLanguageName(this.model.selectedContent()) })).then((confirmed) => {
			if (confirmed) {
				this.model.removeContent();
				this.model.selectedContent(this.model.template.contents[0]);
				this.templateContentEditor.setValue(this.model.selectedContent().text);
			}
			return confirmed;
		});
	}
	createAddNewLanguageButtonAttrs(lang$1) {
		return {
			label: lang$1.textId,
			click: () => {
				this.model.updateContent();
				const newContent = this.model.createContent(lang$1.code);
				this.model.selectedContent(newContent);
				this.templateContentEditor.setValue("");
			}
		};
	}
};

//#endregion
export { getLanguageCode, showTemplateEditor };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGVtcGxhdGVFZGl0b3ItY2h1bmsuanMiLCJuYW1lcyI6WyJ0ZW1wbGF0ZTogRW1haWxUZW1wbGF0ZSB8IG51bGwiLCJ0ZW1wbGF0ZUdyb3VwUm9vdDogVGVtcGxhdGVHcm91cFJvb3QiLCJlbnRpdHlDbGllbnQ6IEVudGl0eUNsaWVudCIsInByb3ZpZGVyOiAoKSA9PiBzdHJpbmciLCJsYW5ndWFnZUNvZGU6IExhbmd1YWdlQ29kZSIsImNvbnRlbnQ6IEVtYWlsVGVtcGxhdGVDb250ZW50IiwidGVtcGxhdGU6IEVtYWlsVGVtcGxhdGUgfCBudWxsIiwidGVtcGxhdGVHcm91cFJvb3Q6IFRlbXBsYXRlR3JvdXBSb290IiwiaGVhZGVyQmFyQXR0cnM6IERpYWxvZ0hlYWRlckJhckF0dHJzIiwidm5vZGU6IFZub2RlPFRlbXBsYXRlRWRpdG9yQXR0cnM+IiwibGFuZyIsImxhbmc6IExhbmd1YWdlIl0sInNvdXJjZXMiOlsiLi4vc3JjL21haWwtYXBwL3NldHRpbmdzL1RlbXBsYXRlRWRpdG9yTW9kZWwudHMiLCIuLi9zcmMvbWFpbC1hcHAvc2V0dGluZ3MvVGVtcGxhdGVFZGl0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBMYW5ndWFnZSwgTGFuZ3VhZ2VDb2RlLCBUcmFuc2xhdGlvbiwgVHJhbnNsYXRpb25LZXkgfSBmcm9tIFwiLi4vLi4vY29tbW9uL21pc2MvTGFuZ3VhZ2VWaWV3TW9kZWxcIlxuaW1wb3J0IHsgbGFuZywgbGFuZ3VhZ2VCeUNvZGUsIGxhbmd1YWdlcyB9IGZyb20gXCIuLi8uLi9jb21tb24vbWlzYy9MYW5ndWFnZVZpZXdNb2RlbFwiXG5pbXBvcnQgdHlwZSB7IEVtYWlsVGVtcGxhdGVDb250ZW50IH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9hcGkvZW50aXRpZXMvdHV0YW5vdGEvVHlwZVJlZnMuanNcIlxuaW1wb3J0IHR5cGUgeyBFbWFpbFRlbXBsYXRlIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9hcGkvZW50aXRpZXMvdHV0YW5vdGEvVHlwZVJlZnMuanNcIlxuaW1wb3J0IHsgY3JlYXRlRW1haWxUZW1wbGF0ZUNvbnRlbnQgfSBmcm9tIFwiLi4vLi4vY29tbW9uL2FwaS9lbnRpdGllcy90dXRhbm90YS9UeXBlUmVmcy5qc1wiXG5pbXBvcnQgeyBjbG9uZSwgZG93bmNhc3QgfSBmcm9tIFwiQHR1dGFvL3R1dGFub3RhLXV0aWxzXCJcbmltcG9ydCB0eXBlIHsgVGVtcGxhdGVHcm91cFJvb3QgfSBmcm9tIFwiLi4vLi4vY29tbW9uL2FwaS9lbnRpdGllcy90dXRhbm90YS9UeXBlUmVmcy5qc1wiXG5pbXBvcnQgeyBjcmVhdGVFbWFpbFRlbXBsYXRlLCBFbWFpbFRlbXBsYXRlVHlwZVJlZiB9IGZyb20gXCIuLi8uLi9jb21tb24vYXBpL2VudGl0aWVzL3R1dGFub3RhL1R5cGVSZWZzLmpzXCJcbmltcG9ydCBzdHJlYW0gZnJvbSBcIm1pdGhyaWwvc3RyZWFtXCJcbmltcG9ydCB7IGRpZmZlcmVuY2UsIGdldEZpcnN0T3JUaHJvdywgcmVtb3ZlIH0gZnJvbSBcIkB0dXRhby90dXRhbm90YS11dGlsc1wiXG5pbXBvcnQgeyBnZXRFbGVtZW50SWQsIGlzU2FtZUlkIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9hcGkvY29tbW9uL3V0aWxzL0VudGl0eVV0aWxzXCJcbmltcG9ydCB0eXBlIHsgRW50aXR5Q2xpZW50IH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9hcGkvY29tbW9uL0VudGl0eUNsaWVudFwiXG5pbXBvcnQgeyBVc2VyRXJyb3IgfSBmcm9tIFwiLi4vLi4vY29tbW9uL2FwaS9tYWluL1VzZXJFcnJvclwiXG5pbXBvcnQgU3RyZWFtIGZyb20gXCJtaXRocmlsL3N0cmVhbVwiXG5cbmV4cG9ydCBjbGFzcyBUZW1wbGF0ZUVkaXRvck1vZGVsIHtcblx0dGVtcGxhdGU6IEVtYWlsVGVtcGxhdGVcblx0dGl0bGU6IFN0cmVhbTxzdHJpbmc+XG5cdHRhZzogU3RyZWFtPHN0cmluZz5cblx0c2VsZWN0ZWRDb250ZW50OiBTdHJlYW08RW1haWxUZW1wbGF0ZUNvbnRlbnQ+XG5cdF90ZW1wbGF0ZUdyb3VwUm9vdDogVGVtcGxhdGVHcm91cFJvb3Rcblx0X2VudGl0eUNsaWVudDogRW50aXR5Q2xpZW50XG5cdF9jb250ZW50UHJvdmlkZXI6ICgoKSA9PiBzdHJpbmcpIHwgbnVsbFxuXG5cdGNvbnN0cnVjdG9yKHRlbXBsYXRlOiBFbWFpbFRlbXBsYXRlIHwgbnVsbCwgdGVtcGxhdGVHcm91cFJvb3Q6IFRlbXBsYXRlR3JvdXBSb290LCBlbnRpdHlDbGllbnQ6IEVudGl0eUNsaWVudCkge1xuXHRcdHRoaXMudGVtcGxhdGUgPSB0ZW1wbGF0ZSA/IGNsb25lKHRlbXBsYXRlKSA6IGNyZWF0ZUVtYWlsVGVtcGxhdGUoeyB0YWc6IFwiXCIsIHRpdGxlOiBcIlwiLCBjb250ZW50czogW10gfSlcblx0XHR0aGlzLnRpdGxlID0gc3RyZWFtKFwiXCIpXG5cdFx0dGhpcy50YWcgPSBzdHJlYW0oXCJcIilcblx0XHRjb25zdCBjb250ZW50cyA9IHRoaXMudGVtcGxhdGUuY29udGVudHNcblx0XHR0aGlzLnNlbGVjdGVkQ29udGVudCA9IHN0cmVhbShjb250ZW50cy5sZW5ndGggPiAwID8gZ2V0Rmlyc3RPclRocm93KGNvbnRlbnRzKSA6IHRoaXMuY3JlYXRlQ29udGVudChsYW5nLmNvZGUpKVxuXHRcdHRoaXMuX3RlbXBsYXRlR3JvdXBSb290ID0gdGVtcGxhdGVHcm91cFJvb3Rcblx0XHR0aGlzLl9lbnRpdHlDbGllbnQgPSBlbnRpdHlDbGllbnRcblx0XHR0aGlzLl9jb250ZW50UHJvdmlkZXIgPSBudWxsXG5cdH1cblxuXHRpc1VwZGF0ZSgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdGhpcy50ZW1wbGF0ZS5faWQgIT0gbnVsbFxuXHR9XG5cblx0c2V0Q29udGVudFByb3ZpZGVyKHByb3ZpZGVyOiAoKSA9PiBzdHJpbmcpIHtcblx0XHR0aGlzLl9jb250ZW50UHJvdmlkZXIgPSBwcm92aWRlclxuXHR9XG5cblx0Y3JlYXRlQ29udGVudChsYW5ndWFnZUNvZGU6IExhbmd1YWdlQ29kZSk6IEVtYWlsVGVtcGxhdGVDb250ZW50IHtcblx0XHRjb25zdCBlbWFpbFRlbXBsYXRlQ29udGVudCA9IGNyZWF0ZUVtYWlsVGVtcGxhdGVDb250ZW50KHtcblx0XHRcdGxhbmd1YWdlQ29kZTogbGFuZ3VhZ2VDb2RlLFxuXHRcdFx0dGV4dDogXCJcIixcblx0XHR9KVxuXHRcdHRoaXMudGVtcGxhdGUuY29udGVudHMucHVzaChlbWFpbFRlbXBsYXRlQ29udGVudClcblx0XHRyZXR1cm4gZW1haWxUZW1wbGF0ZUNvbnRlbnRcblx0fVxuXG5cdHVwZGF0ZUNvbnRlbnQoKTogdm9pZCB7XG5cdFx0Y29uc3Qgc2VsZWN0ZWRDb250ZW50ID0gdGhpcy5zZWxlY3RlZENvbnRlbnQoKVxuXG5cdFx0aWYgKHNlbGVjdGVkQ29udGVudCAmJiB0aGlzLl9jb250ZW50UHJvdmlkZXIpIHtcblx0XHRcdHNlbGVjdGVkQ29udGVudC50ZXh0ID0gdGhpcy5fY29udGVudFByb3ZpZGVyKClcblx0XHR9XG5cdH1cblxuXHRyZW1vdmVDb250ZW50KCk6IHZvaWQge1xuXHRcdGNvbnN0IGNvbnRlbnQgPSB0aGlzLnNlbGVjdGVkQ29udGVudCgpXG5cblx0XHRpZiAoY29udGVudCkge1xuXHRcdFx0cmVtb3ZlKHRoaXMudGVtcGxhdGUuY29udGVudHMsIGNvbnRlbnQpXG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgYWxsIGxhbmd1YWdlcyB0aGF0IGFyZSBhdmFpbGFibGUgZm9yIGNyZWF0aW5nIG5ldyB0ZW1wbGF0ZSBjb250ZW50LiBSZXR1cm5zIHRoZW0gaW4gYWxwaGFiZXRpYyBvcmRlciBzb3J0ZWQgYnkgbmFtZS5cblx0ICogQHJldHVybnMge0FycmF5PHtuYW1lOiBzdHJpbmcsIHZhbHVlOiBMYW5ndWFnZUNvZGV9Pn1cblx0ICovXG5cdGdldEFkZGl0aW9uYWxMYW5ndWFnZXMoKTogQXJyYXk8TGFuZ3VhZ2U+IHtcblx0XHRyZXR1cm4gZGlmZmVyZW5jZShsYW5ndWFnZXMsIHRoaXMuZ2V0QWRkZWRMYW5ndWFnZXMoKSwgKGxhbmcxLCBsYW5nMikgPT4gbGFuZzEuY29kZSA9PT0gbGFuZzIuY29kZSlcblx0fVxuXG5cdGdldEFkZGVkTGFuZ3VhZ2VzKCk6IEFycmF5PExhbmd1YWdlPiB7XG5cdFx0cmV0dXJuIHRoaXMudGVtcGxhdGUuY29udGVudHMubWFwKChjb250ZW50KSA9PiBsYW5ndWFnZUJ5Q29kZVtnZXRMYW5ndWFnZUNvZGUoY29udGVudCldKVxuXHR9XG5cblx0dGFnQWxyZWFkeUV4aXN0cygpOiBQcm9taXNlPGJvb2xlYW4+IHtcblx0XHRpZiAodGhpcy50ZW1wbGF0ZS5faWQpIHtcblx0XHRcdC8vIHRoZSBjdXJyZW50IGVkaXRlZCB0ZW1wbGF0ZSBzaG91bGQgbm90IGJlIGluY2x1ZGVkIGluIGZpbmQoKVxuXHRcdFx0cmV0dXJuIHRoaXMuX2VudGl0eUNsaWVudC5sb2FkQWxsKEVtYWlsVGVtcGxhdGVUeXBlUmVmLCB0aGlzLl90ZW1wbGF0ZUdyb3VwUm9vdC50ZW1wbGF0ZXMpLnRoZW4oKGFsbFRlbXBsYXRlcykgPT4ge1xuXHRcdFx0XHRjb25zdCBmaWx0ZXJlZFRlbXBsYXRlcyA9IGFsbFRlbXBsYXRlcy5maWx0ZXIoKHRlbXBsYXRlKSA9PiAhaXNTYW1lSWQoZ2V0RWxlbWVudElkKHRoaXMudGVtcGxhdGUpLCBnZXRFbGVtZW50SWQodGVtcGxhdGUpKSlcblx0XHRcdFx0cmV0dXJuIGZpbHRlcmVkVGVtcGxhdGVzLnNvbWUoKHRlbXBsYXRlKSA9PiB0ZW1wbGF0ZS50YWcudG9Mb3dlckNhc2UoKSA9PT0gdGhpcy50ZW1wbGF0ZS50YWcudG9Mb3dlckNhc2UoKSlcblx0XHRcdH0pXG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLl9lbnRpdHlDbGllbnQubG9hZEFsbChFbWFpbFRlbXBsYXRlVHlwZVJlZiwgdGhpcy5fdGVtcGxhdGVHcm91cFJvb3QudGVtcGxhdGVzKS50aGVuKChhbGxUZW1wbGF0ZXMpID0+IHtcblx0XHRcdFx0cmV0dXJuIGFsbFRlbXBsYXRlcy5zb21lKCh0ZW1wbGF0ZSkgPT4gdGVtcGxhdGUudGFnLnRvTG93ZXJDYXNlKCkgPT09IHRoaXMudGVtcGxhdGUudGFnLnRvTG93ZXJDYXNlKCkpXG5cdFx0XHR9KVxuXHRcdH1cblx0fVxuXG5cdHNhdmUoKTogUHJvbWlzZTxhbnk+IHtcblx0XHRpZiAoIXRoaXMudGl0bGUoKSkge1xuXHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBVc2VyRXJyb3IoXCJlbXB0eVRpdGxlX21zZ1wiKSlcblx0XHR9XG5cblx0XHRpZiAoIXRoaXMudGFnKCkpIHtcblx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgVXNlckVycm9yKFwiZW1wdHlTaG9ydGN1dF9tc2dcIikpXG5cdFx0fVxuXG5cdFx0dGhpcy51cGRhdGVDb250ZW50KClcblx0XHR0aGlzLnRlbXBsYXRlLnRpdGxlID0gdGhpcy50aXRsZSgpLnRyaW0oKVxuXHRcdHRoaXMudGVtcGxhdGUudGFnID0gdGhpcy50YWcoKS50cmltKClcblx0XHRyZXR1cm4gdGhpcy50YWdBbHJlYWR5RXhpc3RzKCkudGhlbihhc3luYyAoZXhpc3RzKSA9PiB7XG5cdFx0XHRpZiAoZXhpc3RzKSB7XG5cdFx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgVXNlckVycm9yKFwidGVtcGxhdGVTaG9ydGN1dEV4aXN0c19tc2dcIikpXG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMudGVtcGxhdGUuX2lkKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9lbnRpdHlDbGllbnQudXBkYXRlKHRoaXMudGVtcGxhdGUpXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLnRlbXBsYXRlLl9vd25lckdyb3VwID0gdGhpcy5fdGVtcGxhdGVHcm91cFJvb3QuX2lkXG5cdFx0XHRcdHJldHVybiB0aGlzLl9lbnRpdHlDbGllbnQuc2V0dXAodGhpcy5fdGVtcGxhdGVHcm91cFJvb3QudGVtcGxhdGVzLCB0aGlzLnRlbXBsYXRlKVxuXHRcdFx0fVxuXHRcdH0pXG5cdH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldExhbmd1YWdlQ29kZShjb250ZW50OiBFbWFpbFRlbXBsYXRlQ29udGVudCk6IExhbmd1YWdlQ29kZSB7XG5cdHJldHVybiBkb3duY2FzdChjb250ZW50Lmxhbmd1YWdlQ29kZSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldExhbmd1YWdlTmFtZShjb250ZW50OiBFbWFpbFRlbXBsYXRlQ29udGVudCk6IFRyYW5zbGF0aW9uS2V5IHtcblx0cmV0dXJuIGxhbmd1YWdlQnlDb2RlW2dldExhbmd1YWdlQ29kZShjb250ZW50KV0udGV4dElkXG59XG4iLCJpbXBvcnQgbSwgeyBDaGlsZHJlbiwgQ29tcG9uZW50LCBWbm9kZSB9IGZyb20gXCJtaXRocmlsXCJcbmltcG9ydCB7IEF1dG9jYXBpdGFsaXplLCBUZXh0RmllbGQgfSBmcm9tIFwiLi4vLi4vY29tbW9uL2d1aS9iYXNlL1RleHRGaWVsZC5qc1wiXG5pbXBvcnQgdHlwZSB7IERpYWxvZ0hlYWRlckJhckF0dHJzIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9ndWkvYmFzZS9EaWFsb2dIZWFkZXJCYXJcIlxuaW1wb3J0IHsgQnV0dG9uVHlwZSB9IGZyb20gXCIuLi8uLi9jb21tb24vZ3VpL2Jhc2UvQnV0dG9uLmpzXCJcbmltcG9ydCB7IERpYWxvZyB9IGZyb20gXCIuLi8uLi9jb21tb24vZ3VpL2Jhc2UvRGlhbG9nXCJcbmltcG9ydCB7IEljb25zIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9ndWkvYmFzZS9pY29ucy9JY29uc1wiXG5pbXBvcnQgeyBjcmVhdGVEcm9wZG93biwgRHJvcGRvd25CdXR0b25BdHRycyB9IGZyb20gXCIuLi8uLi9jb21tb24vZ3VpL2Jhc2UvRHJvcGRvd24uanNcIlxuaW1wb3J0IHR5cGUgeyBMYW5ndWFnZSB9IGZyb20gXCIuLi8uLi9jb21tb24vbWlzYy9MYW5ndWFnZVZpZXdNb2RlbFwiXG5pbXBvcnQgeyBsYW5nIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9taXNjL0xhbmd1YWdlVmlld01vZGVsXCJcbmltcG9ydCB0eXBlIHsgRW1haWxUZW1wbGF0ZSwgVGVtcGxhdGVHcm91cFJvb3QgfSBmcm9tIFwiLi4vLi4vY29tbW9uL2FwaS9lbnRpdGllcy90dXRhbm90YS9UeXBlUmVmcy5qc1wiXG5pbXBvcnQgeyBnZXRMYW5ndWFnZU5hbWUsIFRlbXBsYXRlRWRpdG9yTW9kZWwgfSBmcm9tIFwiLi9UZW1wbGF0ZUVkaXRvck1vZGVsXCJcbmltcG9ydCB7IGxvY2F0b3IgfSBmcm9tIFwiLi4vLi4vY29tbW9uL2FwaS9tYWluL0NvbW1vbkxvY2F0b3JcIlxuaW1wb3J0IHsgc2hvd1VzZXJFcnJvciB9IGZyb20gXCIuLi8uLi9jb21tb24vbWlzYy9FcnJvckhhbmRsZXJJbXBsXCJcbmltcG9ydCB7IFVzZXJFcnJvciB9IGZyb20gXCIuLi8uLi9jb21tb24vYXBpL21haW4vVXNlckVycm9yXCJcbmltcG9ydCB7IEh0bWxFZGl0b3IgfSBmcm9tIFwiLi4vLi4vY29tbW9uL2d1aS9lZGl0b3IvSHRtbEVkaXRvclwiXG5pbXBvcnQgeyBvZkNsYXNzIH0gZnJvbSBcIkB0dXRhby90dXRhbm90YS11dGlsc1wiXG5pbXBvcnQgeyBJY29uQnV0dG9uIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9ndWkvYmFzZS9JY29uQnV0dG9uLmpzXCJcbmltcG9ydCB7IEJ1dHRvblNpemUgfSBmcm9tIFwiLi4vLi4vY29tbW9uL2d1aS9iYXNlL0J1dHRvblNpemUuanNcIlxuXG4vKipcbiAqIENyZWF0ZXMgYW4gRWRpdG9yIFBvcHVwIGluIHdoaWNoIHlvdSBjYW4gY3JlYXRlIGEgbmV3IHRlbXBsYXRlIG9yIGVkaXQgYW4gZXhpc3Rpbmcgb25lXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG93VGVtcGxhdGVFZGl0b3IodGVtcGxhdGU6IEVtYWlsVGVtcGxhdGUgfCBudWxsLCB0ZW1wbGF0ZUdyb3VwUm9vdDogVGVtcGxhdGVHcm91cFJvb3QpOiB2b2lkIHtcblx0Y29uc3QgZW50aXR5Q2xpZW50ID0gbG9jYXRvci5lbnRpdHlDbGllbnRcblx0Y29uc3QgZWRpdG9yTW9kZWwgPSBuZXcgVGVtcGxhdGVFZGl0b3JNb2RlbCh0ZW1wbGF0ZSwgdGVtcGxhdGVHcm91cFJvb3QsIGVudGl0eUNsaWVudClcblxuXHRjb25zdCBkaWFsb2dDbG9zZUFjdGlvbiA9ICgpID0+IHtcblx0XHRkaWFsb2cuY2xvc2UoKVxuXHR9XG5cblx0Y29uc3Qgc2F2ZUFjdGlvbiA9ICgpID0+IHtcblx0XHRlZGl0b3JNb2RlbFxuXHRcdFx0LnNhdmUoKVxuXHRcdFx0LnRoZW4oKCkgPT4ge1xuXHRcdFx0XHRkaWFsb2dDbG9zZUFjdGlvbigpXG5cdFx0XHR9KVxuXHRcdFx0LmNhdGNoKG9mQ2xhc3MoVXNlckVycm9yLCBzaG93VXNlckVycm9yKSlcblx0fVxuXG5cdGxldCBoZWFkZXJCYXJBdHRyczogRGlhbG9nSGVhZGVyQmFyQXR0cnMgPSB7XG5cdFx0bGVmdDogW1xuXHRcdFx0e1xuXHRcdFx0XHRsYWJlbDogXCJjYW5jZWxfYWN0aW9uXCIsXG5cdFx0XHRcdGNsaWNrOiBkaWFsb2dDbG9zZUFjdGlvbixcblx0XHRcdFx0dHlwZTogQnV0dG9uVHlwZS5TZWNvbmRhcnksXG5cdFx0XHR9LFxuXHRcdF0sXG5cdFx0cmlnaHQ6IFtcblx0XHRcdHtcblx0XHRcdFx0bGFiZWw6IFwic2F2ZV9hY3Rpb25cIixcblx0XHRcdFx0Y2xpY2s6IHNhdmVBY3Rpb24sXG5cdFx0XHRcdHR5cGU6IEJ1dHRvblR5cGUuUHJpbWFyeSxcblx0XHRcdH0sXG5cdFx0XSxcblx0XHRtaWRkbGU6IGVkaXRvck1vZGVsLnRlbXBsYXRlLl9pZCA/IFwiZWRpdFRlbXBsYXRlX2FjdGlvblwiIDogXCJjcmVhdGVUZW1wbGF0ZV9hY3Rpb25cIixcblx0fVxuXHRjb25zdCBkaWFsb2cgPSBEaWFsb2cuZWRpdERpYWxvZyhoZWFkZXJCYXJBdHRycywgVGVtcGxhdGVFZGl0b3IsIHtcblx0XHRtb2RlbDogZWRpdG9yTW9kZWwsXG5cdH0pXG5cdGRpYWxvZy5zaG93KClcbn1cblxudHlwZSBUZW1wbGF0ZUVkaXRvckF0dHJzID0ge1xuXHRtb2RlbDogVGVtcGxhdGVFZGl0b3JNb2RlbFxufVxuXG5jbGFzcyBUZW1wbGF0ZUVkaXRvciBpbXBsZW1lbnRzIENvbXBvbmVudDxUZW1wbGF0ZUVkaXRvckF0dHJzPiB7XG5cdHByaXZhdGUgbW9kZWw6IFRlbXBsYXRlRWRpdG9yTW9kZWxcblx0cHJpdmF0ZSByZWFkb25seSB0ZW1wbGF0ZUNvbnRlbnRFZGl0b3I6IEh0bWxFZGl0b3JcblxuXHRjb25zdHJ1Y3Rvcih2bm9kZTogVm5vZGU8VGVtcGxhdGVFZGl0b3JBdHRycz4pIHtcblx0XHR0aGlzLm1vZGVsID0gdm5vZGUuYXR0cnMubW9kZWxcblx0XHR0aGlzLnRlbXBsYXRlQ29udGVudEVkaXRvciA9IG5ldyBIdG1sRWRpdG9yKFwiY29udGVudF9sYWJlbFwiKS5zaG93Qm9yZGVycygpLnNldE1pbkhlaWdodCg1MDApLmVuYWJsZVRvb2xiYXIoKVxuXG5cdFx0dGhpcy5tb2RlbC5zZXRDb250ZW50UHJvdmlkZXIoKCkgPT4ge1xuXHRcdFx0cmV0dXJuIHRoaXMudGVtcGxhdGVDb250ZW50RWRpdG9yLmdldFZhbHVlKClcblx0XHR9KVxuXHRcdC8vIGluaXQgYWxsIGlucHV0IGZpZWxkc1xuXHRcdHRoaXMubW9kZWwudGl0bGUodGhpcy5tb2RlbC50ZW1wbGF0ZS50aXRsZSlcblx0XHR0aGlzLm1vZGVsLnRhZyh0aGlzLm1vZGVsLnRlbXBsYXRlLnRhZylcblx0XHRjb25zdCBjb250ZW50ID0gdGhpcy5tb2RlbC5zZWxlY3RlZENvbnRlbnQoKVxuXG5cdFx0aWYgKGNvbnRlbnQpIHtcblx0XHRcdHRoaXMudGVtcGxhdGVDb250ZW50RWRpdG9yLnNldFZhbHVlKGNvbnRlbnQudGV4dClcblx0XHR9XG5cdH1cblxuXHR2aWV3KCk6IENoaWxkcmVuIHtcblx0XHRyZXR1cm4gbShcIlwiLCBbXG5cdFx0XHRtKFRleHRGaWVsZCwge1xuXHRcdFx0XHRsYWJlbDogXCJ0aXRsZV9wbGFjZWhvbGRlclwiLFxuXHRcdFx0XHR2YWx1ZTogdGhpcy5tb2RlbC50aXRsZSgpLFxuXHRcdFx0XHRvbmlucHV0OiB0aGlzLm1vZGVsLnRpdGxlLFxuXHRcdFx0fSksXG5cdFx0XHRtKFRleHRGaWVsZCwge1xuXHRcdFx0XHRsYWJlbDogXCJzaG9ydGN1dF9sYWJlbFwiLFxuXHRcdFx0XHRhdXRvY2FwaXRhbGl6ZTogQXV0b2NhcGl0YWxpemUubm9uZSxcblx0XHRcdFx0dmFsdWU6IHRoaXMubW9kZWwudGFnKCksXG5cdFx0XHRcdG9uaW5wdXQ6IHRoaXMubW9kZWwudGFnLFxuXHRcdFx0fSksXG5cdFx0XHRtKFRleHRGaWVsZCwge1xuXHRcdFx0XHRsYWJlbDogXCJsYW5ndWFnZV9sYWJlbFwiLFxuXHRcdFx0XHR2YWx1ZTogdGhpcy5tb2RlbC5zZWxlY3RlZENvbnRlbnQoKSA/IGxhbmcuZ2V0VHJhbnNsYXRpb25UZXh0KGdldExhbmd1YWdlTmFtZSh0aGlzLm1vZGVsLnNlbGVjdGVkQ29udGVudCgpKSkgOiBcIlwiLFxuXHRcdFx0XHRpbmplY3Rpb25zUmlnaHQ6ICgpID0+XG5cdFx0XHRcdFx0bShcIi5mbGV4Lm1sLWJldHdlZW4tc1wiLCBbXG5cdFx0XHRcdFx0XHR0aGlzLm1vZGVsLmdldEFkZGVkTGFuZ3VhZ2VzKCkubGVuZ3RoID4gMSA/IFt0aGlzLnJlbmRlclJlbW92ZUxhbmdCdXR0b24oKSwgdGhpcy5yZW5kZXJTZWxlY3RMYW5nQnV0dG9uKCldIDogbnVsbCxcblx0XHRcdFx0XHRcdHRoaXMucmVuZGVyQWRkTGFuZ0J1dHRvbigpLFxuXHRcdFx0XHRcdF0pLFxuXHRcdFx0XHRpc1JlYWRPbmx5OiB0cnVlLFxuXHRcdFx0fSksXG5cdFx0XHRtKHRoaXMudGVtcGxhdGVDb250ZW50RWRpdG9yKSxcblx0XHRdKVxuXHR9XG5cblx0cHJpdmF0ZSByZW5kZXJBZGRMYW5nQnV0dG9uKCkge1xuXHRcdHJldHVybiBtKEljb25CdXR0b24sIHtcblx0XHRcdHRpdGxlOiBcImFkZExhbmd1YWdlX2FjdGlvblwiLFxuXHRcdFx0aWNvbjogSWNvbnMuQWRkLFxuXHRcdFx0c2l6ZTogQnV0dG9uU2l6ZS5Db21wYWN0LFxuXHRcdFx0Y2xpY2s6IGNyZWF0ZURyb3Bkb3duKHtcblx0XHRcdFx0bGF6eUJ1dHRvbnM6ICgpID0+XG5cdFx0XHRcdFx0dGhpcy5tb2RlbFxuXHRcdFx0XHRcdFx0LmdldEFkZGl0aW9uYWxMYW5ndWFnZXMoKVxuXHRcdFx0XHRcdFx0LnNvcnQoKGEsIGIpID0+IGxhbmcuZ2V0KGEudGV4dElkKS5sb2NhbGVDb21wYXJlKGxhbmcuZ2V0KGIudGV4dElkKSkpXG5cdFx0XHRcdFx0XHQubWFwKChsYW5nKSA9PiB0aGlzLmNyZWF0ZUFkZE5ld0xhbmd1YWdlQnV0dG9uQXR0cnMobGFuZykpLFxuXHRcdFx0XHR3aWR0aDogMjUwLFxuXHRcdFx0fSksXG5cdFx0fSlcblx0fVxuXG5cdHByaXZhdGUgcmVuZGVyU2VsZWN0TGFuZ0J1dHRvbigpIHtcblx0XHRyZXR1cm4gbShJY29uQnV0dG9uLCB7XG5cdFx0XHR0aXRsZTogXCJsYW5ndWFnZXNfbGFiZWxcIixcblx0XHRcdGljb246IEljb25zLkxhbmd1YWdlLFxuXHRcdFx0c2l6ZTogQnV0dG9uU2l6ZS5Db21wYWN0LFxuXHRcdFx0Y2xpY2s6IGNyZWF0ZURyb3Bkb3duKHtcblx0XHRcdFx0bGF6eUJ1dHRvbnM6ICgpID0+IHtcblx0XHRcdFx0XHQvLyBzYXZlIGN1cnJlbnQgY29udGVudCB3aXRoIGxhbmd1YWdlICYgY3JlYXRlIGEgZHJvcGR3b24gd2l0aCBhbGwgYWRkZWQgbGFuZ3VhZ2VzICYgYW4gb3B0aW9uIHRvIGFkZCBhIG5ldyBsYW5ndWFnZVxuXHRcdFx0XHRcdHRoaXMubW9kZWwudXBkYXRlQ29udGVudCgpXG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMubW9kZWwudGVtcGxhdGUuY29udGVudHMubWFwKChjb250ZW50KSA9PiB7XG5cdFx0XHRcdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRcdFx0XHRsYWJlbDogZ2V0TGFuZ3VhZ2VOYW1lKGNvbnRlbnQpLFxuXHRcdFx0XHRcdFx0XHRjbGljazogKCkgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdHRoaXMubW9kZWwuc2VsZWN0ZWRDb250ZW50KGNvbnRlbnQpXG5cblx0XHRcdFx0XHRcdFx0XHR0aGlzLnRlbXBsYXRlQ29udGVudEVkaXRvci5zZXRWYWx1ZShjb250ZW50LnRleHQpXG5cdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0fSxcblx0XHRcdH0pLFxuXHRcdH0pXG5cdH1cblxuXHRwcml2YXRlIHJlbmRlclJlbW92ZUxhbmdCdXR0b24oKSB7XG5cdFx0cmV0dXJuIG0oSWNvbkJ1dHRvbiwge1xuXHRcdFx0dGl0bGU6IFwicmVtb3ZlTGFuZ3VhZ2VfYWN0aW9uXCIsXG5cdFx0XHRpY29uOiBJY29ucy5UcmFzaCxcblx0XHRcdGNsaWNrOiAoKSA9PiB0aGlzLnJlbW92ZUxhbmd1YWdlKCksXG5cdFx0XHRzaXplOiBCdXR0b25TaXplLkNvbXBhY3QsXG5cdFx0fSlcblx0fVxuXG5cdHByaXZhdGUgcmVtb3ZlTGFuZ3VhZ2UoKSB7XG5cdFx0cmV0dXJuIERpYWxvZy5jb25maXJtKFxuXHRcdFx0bGFuZy5nZXRUcmFuc2xhdGlvbihcImRlbGV0ZUxhbmd1YWdlQ29uZmlybWF0aW9uX21zZ1wiLCB7XG5cdFx0XHRcdFwie2xhbmd1YWdlfVwiOiBnZXRMYW5ndWFnZU5hbWUodGhpcy5tb2RlbC5zZWxlY3RlZENvbnRlbnQoKSksXG5cdFx0XHR9KSxcblx0XHQpLnRoZW4oKGNvbmZpcm1lZCkgPT4ge1xuXHRcdFx0aWYgKGNvbmZpcm1lZCkge1xuXHRcdFx0XHR0aGlzLm1vZGVsLnJlbW92ZUNvbnRlbnQoKVxuXHRcdFx0XHR0aGlzLm1vZGVsLnNlbGVjdGVkQ29udGVudCh0aGlzLm1vZGVsLnRlbXBsYXRlLmNvbnRlbnRzWzBdKVxuXG5cdFx0XHRcdHRoaXMudGVtcGxhdGVDb250ZW50RWRpdG9yLnNldFZhbHVlKHRoaXMubW9kZWwuc2VsZWN0ZWRDb250ZW50KCkudGV4dClcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGNvbmZpcm1lZFxuXHRcdH0pXG5cdH1cblxuXHRjcmVhdGVBZGROZXdMYW5ndWFnZUJ1dHRvbkF0dHJzKGxhbmc6IExhbmd1YWdlKTogRHJvcGRvd25CdXR0b25BdHRycyB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdGxhYmVsOiBsYW5nLnRleHRJZCxcblx0XHRcdGNsaWNrOiAoKSA9PiB7XG5cdFx0XHRcdC8vIHNhdmUgdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIGNvbnRlbnQgZWRpdG9yIGluIHRoZSBtb2RlbCxcblx0XHRcdFx0Ly8gYmVjYXVzZSB3ZSB3aWxsIG92ZXJ3cml0ZSBpdCB3aGVuIGEgbmV3IGxhbmd1YWdlIGlzIGFkZGVkXG5cdFx0XHRcdHRoaXMubW9kZWwudXBkYXRlQ29udGVudCgpXG5cdFx0XHRcdGNvbnN0IG5ld0NvbnRlbnQgPSB0aGlzLm1vZGVsLmNyZWF0ZUNvbnRlbnQobGFuZy5jb2RlKVxuXHRcdFx0XHR0aGlzLm1vZGVsLnNlbGVjdGVkQ29udGVudChuZXdDb250ZW50KVxuXG5cdFx0XHRcdHRoaXMudGVtcGxhdGVDb250ZW50RWRpdG9yLnNldFZhbHVlKFwiXCIpXG5cdFx0XHR9LFxuXHRcdH1cblx0fVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFlYSxzQkFBTixNQUEwQjtDQUNoQztDQUNBO0NBQ0E7Q0FDQTtDQUNBO0NBQ0E7Q0FDQTtDQUVBLFlBQVlBLFVBQWdDQyxtQkFBc0NDLGNBQTRCO0FBQzdHLE9BQUssV0FBVyxXQUFXLE1BQU0sU0FBUyxHQUFHLG9CQUFvQjtHQUFFLEtBQUs7R0FBSSxPQUFPO0dBQUksVUFBVSxDQUFFO0VBQUUsRUFBQztBQUN0RyxPQUFLLFFBQVEsMkJBQU8sR0FBRztBQUN2QixPQUFLLE1BQU0sMkJBQU8sR0FBRztFQUNyQixNQUFNLFdBQVcsS0FBSyxTQUFTO0FBQy9CLE9BQUssa0JBQWtCLDJCQUFPLFNB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