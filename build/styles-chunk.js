import { assertMainOrNodeBoot, isAdminClient, isTest } from "./Env-chunk.js";
import { client } from "./ClientDetector-chunk.js";
import { assertNotNull, downcast, neverNull } from "./dist2-chunk.js";
import { hexToRgb, theme } from "./theme-chunk.js";
import { windowFacade } from "./WindowFacade-chunk.js";
import { size } from "./size-chunk.js";

//#region src/common/gui/animation/Easing.ts
assertMainOrNodeBoot();
const EasingType = {
	linear: 1,
	quad: 2,
	cubic: 3,
	quart: 4,
	quint: 5
};
const ease = {
	in: function(percent) {
		return Math.pow(percent, EasingType.cubic);
	},
	out: function(percent) {
		return 1 - ease.in(1 - percent);
	},
	inOut: function(percent) {
		return percent < .5 ? ease.in(percent * 2) / 2 : 1 - ease.in(percent * -2 + 2) / 2;
	},
	linear: function(percent) {
		return percent;
	}
};

//#endregion
//#region src/common/gui/animation/Animations.ts
assertMainOrNodeBoot();
let AlphaEnum = function(AlphaEnum$1) {
	AlphaEnum$1["BackgroundColor"] = "backgroundColor";
	AlphaEnum$1["Color"] = "color";
	return AlphaEnum$1;
}({});
let TransformEnum = function(TransformEnum$1) {
	/** shift the element in left-right direction. begin and end denote the target offset from the "natural" position */
	TransformEnum$1["TranslateX"] = "translateX";
	/** shift the element in top-bottom direction. begin and end denote the target offset from the "natural" position */
	TransformEnum$1["TranslateY"] = "translateY";
	TransformEnum$1["RotateY"] = "rotateY";
	TransformEnum$1["RotateZ"] = "rotateZ";
	/** scale the element both horizontally and vertically. begin and end denote the desired scale in 0-1 range. */
	TransformEnum$1["Scale"] = "scale";
	return TransformEnum$1;
}({});
const DefaultAnimationTime = 200;
const InitializedOptions = {
	stagger: 0,
	delay: 0,
	easing: ease.linear,
	duration: DefaultAnimationTime
};
var Animations = class Animations {
	activeAnimations;
	_animate;
	constructor() {
		this.activeAnimations = [];
		this._animate = () => {
			let finished = [];
			let now = window.performance.now();
			for (let animation of this.activeAnimations) {
				animation.animateFrame(now);
				if (animation.isFinished()) finished.push(animation);
			}
			for (let animation of finished) {
				this.activeAnimations.splice(this.activeAnimations.indexOf(animation), 1);
				if (animation.resolve) animation.resolve();
			}
			if (this.activeAnimations.length > 0) window.requestAnimationFrame(this._animate);
		};
	}
	/**
	* Adds an animation that should be executed immediately. Returns a promise that resolves after the animation is complete.
	*/
	add(targets, mutations, options) {
		const targetsArray = targets instanceof HTMLElement ? [targets] : Array.from(targets);
		let targetMutations;
		if (!(mutations instanceof Array)) targetMutations = [mutations];
else targetMutations = mutations;
		let verifiedOptions = Animations.verifiyOptions(options);
		const willChange = targetMutations.map((mutation) => mutation.willChange()).filter((willChange$1) => willChange$1.length).join(" ");
		for (const t of targetsArray) t.style.willChange = willChange;
		const animations$1 = [];
		const promise = new Promise((resolve) => {
			let start = this.activeAnimations.length ? false : true;
			for (let i = 0; i < targetsArray.length; i++) {
				let delay = verifiedOptions.delay;
				if (verifiedOptions.stagger) delay += verifiedOptions.stagger * i;
				const animation = new Animation(targetsArray[i], targetMutations, i === targetsArray.length - 1 ? resolve : null, delay, verifiedOptions.easing, verifiedOptions.duration);
				animations$1.push(animation);
				this.activeAnimations.push(animation);
			}
			if (start) window.requestAnimationFrame(this._animate);
		});
		const animationPromise = downcast(promise);
		animationPromise.animations = animations$1;
		return animationPromise;
	}
	cancel(animation) {
		this.activeAnimations.splice(this.activeAnimations.indexOf(animation), 1);
		if (animation.resolve) animation.resolve();
	}
	static verifiyOptions(options) {
		return Object.assign({}, InitializedOptions, options);
	}
};
var Animation = class {
	target;
	mutations;
	resolve;
	duration;
	delay;
	animationStart;
	runTime;
	easing;
	constructor(target, mutations, resolve, delay, easing, duration = DefaultAnimationTime) {
		this.target = target;
		this.mutations = mutations;
		this.resolve = resolve;
		this.delay = delay;
		this.duration = duration;
		this.animationStart = null;
		this.runTime = null;
		this.easing = easing;
	}
	animateFrame(now) {
		if (this.animationStart == null) this.animationStart = now;
		this.runTime = Math.min(now - this.animationStart - this.delay, this.duration);
		if (this.runTime >= 0) for (let m of this.mutations) m.updateDom(this.target, this.runTime / this.duration, this.easing);
	}
	isFinished() {
		return this.runTime != null && this.runTime >= this.duration;
	}
};
function transform(type, begin, end) {
	const values = {};
	values[type] = {
		begin,
		end
	};
	let updateDom = function(target, percent, easing) {
		target.style.transform = buildTransformString(values, percent, easing);
	};
	const willChange = () => "transform";
	let chain = function(type$1, begin$1, end$1) {
		values[type$1] = {
			begin: begin$1,
			end: end$1
		};
		return {
			updateDom,
			chain,
			willChange
		};
	};
	return {
		updateDom,
		chain,
		willChange
	};
}
const TransformUnits = {
	[TransformEnum.TranslateX]: "px",
	[TransformEnum.TranslateY]: "px",
	[TransformEnum.RotateY]: "deg",
	[TransformEnum.RotateZ]: "deg",
	[TransformEnum.Scale]: ""
};
function buildTransformString(values, percent, easing) {
	let transform$1 = [];
	let types = Object.keys(TransformUnits);
	for (let type of types) if (values[type]) {
		let value = calculateValue(percent, values[type].begin, values[type].end, easing);
		transform$1.push(type + "(" + value + TransformUnits[type] + ")");
	}
	return transform$1.join(" ");
}
function alpha(type, colorHex, begin, end) {
	let color = hexToRgb(colorHex);
	return {
		updateDom: function(target, percent, easing) {
			let alphaChannel = calculateValue(percent, begin, end, easing);
			if (type === AlphaEnum.BackgroundColor) target.style.backgroundColor = `rgba(${color.r}, ${color.g}, ${color.b}, ${alphaChannel})`;
else if (type === AlphaEnum.Color) target.style.color = `rgba(${color.r}, ${color.g}, ${color.b}, ${alphaChannel})`;
		},
		willChange: () => "alpha"
	};
}
function opacity(begin, end, keepValue) {
	let initialOpacity = null;
	return {
		updateDom: function(target, percent, easing) {
			if (percent === 0 && initialOpacity === null) initialOpacity = target.style.opacity;
			let opacity$1 = calculateValue(percent, begin, end, easing);
			if (percent === 1 && !keepValue) target.style.opacity = initialOpacity ? initialOpacity : "";
else target.style.opacity = opacity$1 + "";
		},
		willChange: () => "opacity"
	};
}
function height(begin, end) {
	return {
		updateDom: function(target, percent, easing) {
			target.style.height = calculateValue(percent, begin, end, easing) + "px";
		},
		willChange: () => "height"
	};
}
function width(begin, end) {
	return {
		updateDom: function(target, percent, easing) {
			target.style.width = calculateValue(percent, begin, end, easing) + "px";
		},
		willChange: () => "width"
	};
}
function calculateValue(percent, begin, end, easing) {
	return (end - begin) * easing(percent) + begin;
}
const animations = new Animations();

//#endregion
//#region src/common/misc/Log.ts
assertMainOrNodeBoot();
const Cat = {
	css: {
		name: "css",
		color: "orange"
	},
	mithril: {
		name: "mithril",
		color: "darkgreen"
	},
	error: {
		name: "error",
		color: "red"
	},
	info: {
		name: "info",
		color: "lightblue"
	},
	debug: {
		name: "debug",
		color: "#009688"
	}
};
const activeCategories = [];
function log(category, message, ...args) {
	if (activeCategories.indexOf(category) === -1) return;
	console.log("%c" + category.name, "color:" + category.color, message, ...args);
}
function timer(category) {
	if (activeCategories.indexOf(category) === -1) return function() {};
	let start = window.performance.now();
	return function() {
		return Math.round(window.performance.now() - start);
	};
}

//#endregion
//#region src/common/gui/styles.ts
assertMainOrNodeBoot();
var Styles = class {
	styles;
	initialized;
	bodyWidth;
	bodyHeight;
	styleSheets = new Map();
	constructor() {
		this.initialized = false;
		this.styles = new Map();
		this.bodyWidth = neverNull(document.body).offsetWidth;
		this.bodyHeight = neverNull(document.body).offsetHeight;
		windowFacade.addResizeListener((width$1, height$1) => {
			this.bodyWidth = width$1;
			this.bodyHeight = height$1;
		});
	}
	init(themeController) {
		if (this.initialized) return;
		this.initialized = true;
		this.updateDomStyles();
		themeController.observableThemeId.map(() => {
			this.updateDomStyles();
		});
	}
	getStyleSheetElement(id) {
		return assertNotNull(this.styleSheets.get(id)).cloneNode(true);
	}
	isDesktopLayout() {
		return this.bodyWidth >= size.desktop_layout_width;
	}
	isSingleColumnLayout() {
		return this.bodyWidth < size.two_column_layout_width;
	}
	isTwoColumnLayout() {
		return this.bodyWidth >= size.two_column_layout_width && this.bodyWidth < size.desktop_layout_width;
	}
	isUsingBottomNavigation() {
		return !isAdminClient() && (client.isMobileDevice() || !this.isDesktopLayout());
	}
	registerStyle(id, styleCreator) {
		if (!this.initialized && this.styles.has(id)) throw new Error("duplicate style definition: " + id);
		this.styles.set(id, styleCreator);
		if (this.initialized) {
			log(Cat.css, "update style", id, styleCreator(theme));
			this.updateDomStyle(id, styleCreator);
		}
	}
	updateStyle(id) {
		if (!this.initialized || !this.styles.has(id)) throw new Error("cannot update nonexistent style " + id);
		const creator = neverNull(this.styles.get(id));
		log(Cat.css, "update style", id, creator(theme));
		this.updateDomStyle(id, creator);
	}
	updateDomStyles() {
		if (isTest()) return;
		let time = timer(Cat.css);
		Array.from(this.styles.entries()).map((entry) => {
			this.updateDomStyle(entry[0], entry[1]);
		});
		log(Cat.css, "creation time", time());
	}
	updateDomStyle(id, styleCreator) {
		const styleSheet = this.getDomStyleSheet(`css-${id}`);
		styleSheet.textContent = toCss(styleCreator());
		this.styleSheets.set(id, styleSheet);
	}
	getDomStyleSheet(id) {
		let styleDomElement = document.getElementById(id);
		if (!styleDomElement) {
			styleDomElement = document.createElement("style");
			styleDomElement.setAttribute("type", "text/css");
			styleDomElement.id = id;
			styleDomElement = document.getElementsByTagName("head")[0].appendChild(styleDomElement);
		}
		return styleDomElement;
	}
};
function objectToCss(indent, key, o) {
	let cssString = `${indent}${key} { \n`;
	cssString += indent + toCss(o, indent + "  ");
	cssString += ` \n${indent}} \n`;
	return cssString;
}
function toCss(obj, indent = "") {
	let ret = Object.keys(obj).map((key) => {
		if (obj[key] instanceof Array) return obj[key].map((o) => {
			return objectToCss(indent, key, o);
		}).join("\n");
else if (obj[key] instanceof Object) return objectToCss(indent, key, obj[key]);
else return `${indent}${key}: ${obj[key]};`;
	}).join("\n");
	return ret;
}
const styles = new Styles();

//#endregion
export { AlphaEnum, DefaultAnimationTime, TransformEnum, alpha, animations, ease, height, opacity, styles, transform, width };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3R5bGVzLWNodW5rLmpzIiwibmFtZXMiOlsiZWFzZTogUmVjb3JkPHN0cmluZywgRWFzaW5nRnVuY3Rpb24+IiwicGVyY2VudDogbnVtYmVyIiwiZmluaXNoZWQ6IEFuaW1hdGlvbltdIiwidGFyZ2V0czogSFRNTEVsZW1lbnQgfCBIVE1MRWxlbWVudFtdIHwgSFRNTENvbGxlY3Rpb24iLCJtdXRhdGlvbnM6IERvbU11dGF0aW9uIHwgRG9tTXV0YXRpb25bXSIsIm9wdGlvbnM/OiB7XG5cdFx0XHRzdGFnZ2VyPzogbnVtYmVyXG5cdFx0XHRkZWxheT86IG51bWJlclxuXHRcdFx0ZWFzaW5nPzogRWFzaW5nRnVuY3Rpb25cblx0XHRcdGR1cmF0aW9uPzogbnVtYmVyXG5cdFx0fSIsInRhcmdldHNBcnJheTogQXJyYXk8SFRNTEVsZW1lbnQ+IiwidGFyZ2V0TXV0YXRpb25zOiBEb21NdXRhdGlvbltdIiwid2lsbENoYW5nZSIsImFuaW1hdGlvbnM6IEFuaW1hdGlvbltdIiwiYW5pbWF0aW9ucyIsImFuaW1hdGlvbjogQW5pbWF0aW9uIiwib3B0aW9uczpcblx0XHRcdHwge1xuXHRcdFx0XHRcdHN0YWdnZXI/OiBudW1iZXJcblx0XHRcdFx0XHRkZWxheT86IG51bWJlclxuXHRcdFx0XHRcdGVhc2luZz86IEVhc2luZ0Z1bmN0aW9uXG5cdFx0XHQgIH1cblx0XHRcdHwgbnVsbFxuXHRcdFx0fCB1bmRlZmluZWQiLCJ0YXJnZXQ6IEhUTUxFbGVtZW50IiwibXV0YXRpb25zOiBEb21NdXRhdGlvbltdIiwicmVzb2x2ZTogKCguLi5hcmdzOiBBcnJheTxhbnk+KSA9PiBhbnkpIHwgbnVsbCIsImRlbGF5OiBudW1iZXIiLCJlYXNpbmc6IEVhc2luZ0Z1bmN0aW9uIiwiZHVyYXRpb246IG51bWJlciIsIm5vdzogbnVtYmVyIiwidHlwZTogVHJhbnNmb3JtRW51bSIsImJlZ2luOiBudW1iZXIiLCJlbmQ6IG51bWJlciIsInBlcmNlbnQ6IG51bWJlciIsInR5cGUiLCJ2YWx1ZXM6IFRyYW5zZm9ybVZhbHVlcyIsInRyYW5zZm9ybTogc3RyaW5nW10iLCJ0eXBlczogVHJhbnNmb3JtRW51bVtdIiwidHlwZTogQWxwaGFFbnVtIiwiY29sb3JIZXg6IHN0cmluZyIsImtlZXBWYWx1ZTogYm9vbGVhbiIsImluaXRpYWxPcGFjaXR5OiBzdHJpbmcgfCBudWxsIiwib3BhY2l0eSIsImVhc2luZzogKC4uLmFyZ3M6IEFycmF5PGFueT4pID0+IGFueSIsImFuaW1hdGlvbnM6IEFuaW1hdGlvbnMiLCJDYXQ6IFJlY29yZDxzdHJpbmcsIExvZ0NhdGVnb3J5PiIsImFjdGl2ZUNhdGVnb3JpZXM6IExvZ0NhdGVnb3J5W10iLCJjYXRlZ29yeTogTG9nQ2F0ZWdvcnkiLCJtZXNzYWdlOiBzdHJpbmciLCJ3aWR0aDogbnVtYmVyIiwiaGVpZ2h0OiBudW1iZXIiLCJ3aWR0aCIsImhlaWdodCIsInRoZW1lQ29udHJvbGxlcjogVGhlbWVDb250cm9sbGVyIiwiaWQ6IFN0eWxlU2hlZXRJZCIsInN0eWxlQ3JlYXRvcjogKC4uLmFyZ3M6IEFycmF5PGFueT4pID0+IFJlY29yZDxzdHJpbmcsIFBhcnRpYWw8Q1NTU3R5bGVEZWNsYXJhdGlvbj4gfCBvYmplY3Q+Iiwic3R5bGVDcmVhdG9yOiAoLi4uYXJnczogQXJyYXk8YW55PikgPT4gYW55IiwiaWQ6IHN0cmluZyIsImluZGVudDogc3RyaW5nIiwia2V5OiBzdHJpbmciLCJvOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+Iiwib2JqOiBSZWNvcmQ8c3RyaW5nLCBhbnk+IiwibzogYW55Iiwic3R5bGVzOiBTdHlsZXMiXSwic291cmNlcyI6WyIuLi9zcmMvY29tbW9uL2d1aS9hbmltYXRpb24vRWFzaW5nLnRzIiwiLi4vc3JjL2NvbW1vbi9ndWkvYW5pbWF0aW9uL0FuaW1hdGlvbnMudHMiLCIuLi9zcmMvY29tbW9uL21pc2MvTG9nLnRzIiwiLi4vc3JjL2NvbW1vbi9ndWkvc3R5bGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFzc2VydE1haW5Pck5vZGVCb290IH0gZnJvbSBcIi4uLy4uL2FwaS9jb21tb24vRW52XCJcblxuYXNzZXJ0TWFpbk9yTm9kZUJvb3QoKVxuZXhwb3J0IHR5cGUgRWFzaW5nRnVuY3Rpb24gPSAocGVyY2VudDogbnVtYmVyKSA9PiBudW1iZXJcbmNvbnN0IEVhc2luZ1R5cGUgPSB7XG5cdGxpbmVhcjogMSxcblx0cXVhZDogMixcblx0Y3ViaWM6IDMsXG5cdHF1YXJ0OiA0LFxuXHRxdWludDogNSxcbn1cblxuLypcbiAqIEVhc2luZ3MuIEltcGxlbWVudGVkIGFzIGRlc2NyaWJlZCBpbiBodHRwOi8vdXBzaG90cy5vcmcvYWN0aW9uc2NyaXB0L2pzYXMtdW5kZXJzdGFuZGluZy1lYXNpbmdcbiAqIGJhc2VkIG9uIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5LXVpL2Jsb2IvbWFzdGVyL3VpL2VmZmVjdC5qcyNMMTU4MVxuICpcbiAqIEBzZWU6IGh0dHA6Ly9lYXNpbmdzLm5ldC9cbiAqIEBzZWU6IGh0dHA6Ly9yb2JlcnRwZW5uZXIuY29tL2Vhc2luZy9cbiAqL1xuZXhwb3J0IGNvbnN0IGVhc2U6IFJlY29yZDxzdHJpbmcsIEVhc2luZ0Z1bmN0aW9uPiA9IHtcblx0aW46IGZ1bmN0aW9uIChwZXJjZW50OiBudW1iZXIpOiBudW1iZXIge1xuXHRcdHJldHVybiBNYXRoLnBvdyhwZXJjZW50LCBFYXNpbmdUeXBlLmN1YmljKSAvLyBjdWJpY1xuXHR9LFxuXHRvdXQ6IGZ1bmN0aW9uIChwZXJjZW50OiBudW1iZXIpOiBudW1iZXIge1xuXHRcdHJldHVybiAxIC0gZWFzZS5pbigxIC0gcGVyY2VudClcblx0fSxcblx0aW5PdXQ6IGZ1bmN0aW9uIChwZXJjZW50OiBudW1iZXIpOiBudW1iZXIge1xuXHRcdHJldHVybiBwZXJjZW50IDwgMC41ID8gZWFzZS5pbihwZXJjZW50ICogMikgLyAyIDogMSAtIGVhc2UuaW4ocGVyY2VudCAqIC0yICsgMikgLyAyXG5cdH0sXG5cdGxpbmVhcjogZnVuY3Rpb24gKHBlcmNlbnQ6IG51bWJlcikge1xuXHRcdHJldHVybiBwZXJjZW50XG5cdH0sXG59XG4iLCJpbXBvcnQgdHlwZSB7IEVhc2luZ0Z1bmN0aW9uIH0gZnJvbSBcIi4vRWFzaW5nXCJcbmltcG9ydCB7IGVhc2UgfSBmcm9tIFwiLi9FYXNpbmdcIlxuaW1wb3J0IHsgZG93bmNhc3QgfSBmcm9tIFwiQHR1dGFvL3R1dGFub3RhLXV0aWxzXCJcbmltcG9ydCB7IGhleFRvUmdiIH0gZnJvbSBcIi4uL2Jhc2UvQ29sb3JcIlxuaW1wb3J0IHsgYXNzZXJ0TWFpbk9yTm9kZUJvb3QgfSBmcm9tIFwiLi4vLi4vYXBpL2NvbW1vbi9FbnZcIlxuXG5hc3NlcnRNYWluT3JOb2RlQm9vdCgpXG5cbmV4cG9ydCBpbnRlcmZhY2UgRG9tTXV0YXRpb24ge1xuXHR1cGRhdGVEb20odGFyZ2V0OiBIVE1MRWxlbWVudCwgcGVyY2VudDogbnVtYmVyLCBlYXNpbmc6IEVhc2luZ0Z1bmN0aW9uKTogdm9pZFxuXG5cdHdpbGxDaGFuZ2UoKTogc3RyaW5nXG59XG5cbmludGVyZmFjZSBEb21UcmFuc2Zvcm0gZXh0ZW5kcyBEb21NdXRhdGlvbiB7XG5cdGNoYWluKHR5cGU6IFRyYW5zZm9ybUVudW0sIGJlZ2luOiBudW1iZXIsIGVuZDogbnVtYmVyKTogRG9tVHJhbnNmb3JtXG59XG5cbmV4cG9ydCBjb25zdCBlbnVtIEFscGhhRW51bSB7XG5cdEJhY2tncm91bmRDb2xvciA9IFwiYmFja2dyb3VuZENvbG9yXCIsXG5cdENvbG9yID0gXCJjb2xvclwiLFxufVxuXG5leHBvcnQgY29uc3QgZW51bSBUcmFuc2Zvcm1FbnVtIHtcblx0LyoqIHNoaWZ0IHRoZSBlbGVtZW50IGluIGxlZnQtcmlnaHQgZGlyZWN0aW9uLiBiZWdpbiBhbmQgZW5kIGRlbm90ZSB0aGUgdGFyZ2V0IG9mZnNldCBmcm9tIHRoZSBcIm5hdHVyYWxcIiBwb3NpdGlvbiAqL1xuXHRUcmFuc2xhdGVYID0gXCJ0cmFuc2xhdGVYXCIsXG5cdC8qKiBzaGlmdCB0aGUgZWxlbWVudCBpbiB0b3AtYm90dG9tIGRpcmVjdGlvbi4gYmVnaW4gYW5kIGVuZCBkZW5vdGUgdGhlIHRhcmdldCBvZmZzZXQgZnJvbSB0aGUgXCJuYXR1cmFsXCIgcG9zaXRpb24gKi9cblx0VHJhbnNsYXRlWSA9IFwidHJhbnNsYXRlWVwiLFxuXHRSb3RhdGVZID0gXCJyb3RhdGVZXCIsXG5cdFJvdGF0ZVogPSBcInJvdGF0ZVpcIixcblx0LyoqIHNjYWxlIHRoZSBlbGVtZW50IGJvdGggaG9yaXpvbnRhbGx5IGFuZCB2ZXJ0aWNhbGx5LiBiZWdpbiBhbmQgZW5kIGRlbm90ZSB0aGUgZGVzaXJlZCBzY2FsZSBpbiAwLTEgcmFuZ2UuICovXG5cdFNjYWxlID0gXCJzY2FsZVwiLFxufVxuXG50eXBlIFRyYW5zZm9ybVZhbHVlcyA9IFJlY29yZDxcblx0VHJhbnNmb3JtRW51bSxcblx0e1xuXHRcdGJlZ2luOiBudW1iZXJcblx0XHRlbmQ6IG51bWJlclxuXHR9XG4+XG5leHBvcnQgY29uc3QgRGVmYXVsdEFuaW1hdGlvblRpbWUgPSAyMDAgLy8gbXNcblxuY29uc3QgSW5pdGlhbGl6ZWRPcHRpb25zID0ge1xuXHRzdGFnZ2VyOiAwLFxuXHRkZWxheTogMCxcblx0ZWFzaW5nOiBlYXNlLmxpbmVhcixcblx0ZHVyYXRpb246IERlZmF1bHRBbmltYXRpb25UaW1lLFxufVxuZXhwb3J0IHR5cGUgQW5pbWF0aW9uUHJvbWlzZSA9IHtcblx0YW5pbWF0aW9ucz86IEFycmF5PEFuaW1hdGlvbj5cbn0gJiBQcm9taXNlPHVua25vd24+XG5cbmNsYXNzIEFuaW1hdGlvbnMge1xuXHRhY3RpdmVBbmltYXRpb25zOiBBbmltYXRpb25bXVxuXHRfYW5pbWF0ZTogKC4uLmFyZ3M6IEFycmF5PGFueT4pID0+IGFueVxuXG5cdGNvbnN0cnVjdG9yKCkge1xuXHRcdHRoaXMuYWN0aXZlQW5pbWF0aW9ucyA9IFtdXG5cblx0XHR0aGlzLl9hbmltYXRlID0gKCkgPT4ge1xuXHRcdFx0bGV0IGZpbmlzaGVkOiBBbmltYXRpb25bXSA9IFtdXG5cdFx0XHRsZXQgbm93ID0gd2luZG93LnBlcmZvcm1hbmNlLm5vdygpXG5cblx0XHRcdGZvciAobGV0IGFuaW1hdGlvbiBvZiB0aGlzLmFjdGl2ZUFuaW1hdGlvbnMpIHtcblx0XHRcdFx0YW5pbWF0aW9uLmFuaW1hdGVGcmFtZShub3cpXG5cblx0XHRcdFx0aWYgKGFuaW1hdGlvbi5pc0ZpbmlzaGVkKCkpIHtcblx0XHRcdFx0XHRmaW5pc2hlZC5wdXNoKGFuaW1hdGlvbilcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRmb3IgKGxldCBhbmltYXRpb24gb2YgZmluaXNoZWQpIHtcblx0XHRcdFx0dGhpcy5hY3RpdmVBbmltYXRpb25zLnNwbGljZSh0aGlzLmFjdGl2ZUFuaW1hdGlvbnMuaW5kZXhPZihhbmltYXRpb24pLCAxKVxuXG5cdFx0XHRcdGlmIChhbmltYXRpb24ucmVzb2x2ZSkge1xuXHRcdFx0XHRcdGFuaW1hdGlvbi5yZXNvbHZlKClcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGhpcy5hY3RpdmVBbmltYXRpb25zLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0d2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLl9hbmltYXRlKVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBBZGRzIGFuIGFuaW1hdGlvbiB0aGF0IHNob3VsZCBiZSBleGVjdXRlZCBpbW1lZGlhdGVseS4gUmV0dXJucyBhIHByb21pc2UgdGhhdCByZXNvbHZlcyBhZnRlciB0aGUgYW5pbWF0aW9uIGlzIGNvbXBsZXRlLlxuXHQgKi9cblx0YWRkKFxuXHRcdHRhcmdldHM6IEhUTUxFbGVtZW50IHwgSFRNTEVsZW1lbnRbXSB8IEhUTUxDb2xsZWN0aW9uLFxuXHRcdG11dGF0aW9uczogRG9tTXV0YXRpb24gfCBEb21NdXRhdGlvbltdLFxuXHRcdG9wdGlvbnM/OiB7XG5cdFx0XHRzdGFnZ2VyPzogbnVtYmVyXG5cdFx0XHRkZWxheT86IG51bWJlclxuXHRcdFx0ZWFzaW5nPzogRWFzaW5nRnVuY3Rpb25cblx0XHRcdGR1cmF0aW9uPzogbnVtYmVyXG5cdFx0fSxcblx0KTogQW5pbWF0aW9uUHJvbWlzZSB7XG5cdFx0Y29uc3QgdGFyZ2V0c0FycmF5OiBBcnJheTxIVE1MRWxlbWVudD4gPSB0YXJnZXRzIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgPyBbdGFyZ2V0c10gOiAoQXJyYXkuZnJvbSh0YXJnZXRzKSBhcyBBcnJheTxIVE1MRWxlbWVudD4pXG5cblx0XHRsZXQgdGFyZ2V0TXV0YXRpb25zOiBEb21NdXRhdGlvbltdXG5cblx0XHRpZiAoIShtdXRhdGlvbnMgaW5zdGFuY2VvZiBBcnJheSkpIHtcblx0XHRcdHRhcmdldE11dGF0aW9ucyA9IFttdXRhdGlvbnNdXG5cdFx0fSBlbHNlIHtcblx0XHRcdHRhcmdldE11dGF0aW9ucyA9IG11dGF0aW9uc1xuXHRcdH1cblxuXHRcdGxldCB2ZXJpZmllZE9wdGlvbnMgPSBBbmltYXRpb25zLnZlcmlmaXlPcHRpb25zKG9wdGlvbnMpXG5cdFx0Y29uc3Qgd2lsbENoYW5nZSA9IHRhcmdldE11dGF0aW9uc1xuXHRcdFx0Lm1hcCgobXV0YXRpb24pID0+IG11dGF0aW9uLndpbGxDaGFuZ2UoKSlcblx0XHRcdC5maWx0ZXIoKHdpbGxDaGFuZ2UpID0+IHdpbGxDaGFuZ2UubGVuZ3RoKVxuXHRcdFx0LmpvaW4oXCIgXCIpXG5cdFx0Zm9yIChjb25zdCB0IG9mIHRhcmdldHNBcnJheSkge1xuXHRcdFx0dC5zdHlsZS53aWxsQ2hhbmdlID0gd2lsbENoYW5nZVxuXHRcdH1cblx0XHRjb25zdCBhbmltYXRpb25zOiBBbmltYXRpb25bXSA9IFtdXG5cdFx0Y29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG5cdFx0XHRsZXQgc3RhcnQgPSB0aGlzLmFjdGl2ZUFuaW1hdGlvbnMubGVuZ3RoID8gZmFsc2UgOiB0cnVlXG5cblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGFyZ2V0c0FycmF5Lmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGxldCBkZWxheSA9IHZlcmlmaWVkT3B0aW9ucy5kZWxheVxuXG5cdFx0XHRcdGlmICh2ZXJpZmllZE9wdGlvbnMuc3RhZ2dlcikge1xuXHRcdFx0XHRcdGRlbGF5ICs9IHZlcmlmaWVkT3B0aW9ucy5zdGFnZ2VyICogaVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y29uc3QgYW5pbWF0aW9uID0gbmV3IEFuaW1hdGlvbihcblx0XHRcdFx0XHR0YXJnZXRzQXJyYXlbaV0sXG5cdFx0XHRcdFx0dGFyZ2V0TXV0YXRpb25zLFxuXHRcdFx0XHRcdGkgPT09IHRhcmdldHNBcnJheS5sZW5ndGggLSAxID8gcmVzb2x2ZSA6IG51bGwsXG5cdFx0XHRcdFx0ZGVsYXksXG5cdFx0XHRcdFx0dmVyaWZpZWRPcHRpb25zLmVhc2luZyxcblx0XHRcdFx0XHR2ZXJpZmllZE9wdGlvbnMuZHVyYXRpb24sXG5cdFx0XHRcdClcblx0XHRcdFx0YW5pbWF0aW9ucy5wdXNoKGFuaW1hdGlvbilcblx0XHRcdFx0dGhpcy5hY3RpdmVBbmltYXRpb25zLnB1c2goYW5pbWF0aW9uKVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc3RhcnQpIHtcblx0XHRcdFx0d2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLl9hbmltYXRlKVxuXHRcdFx0fVxuXHRcdH0pXG5cdFx0Y29uc3QgYW5pbWF0aW9uUHJvbWlzZSA9IGRvd25jYXN0PEFuaW1hdGlvblByb21pc2U+KHByb21pc2UpXG5cdFx0YW5pbWF0aW9uUHJvbWlzZS5hbmltYXRpb25zID0gYW5pbWF0aW9uc1xuXHRcdHJldHVybiBhbmltYXRpb25Qcm9taXNlXG5cdH1cblxuXHRjYW5jZWwoYW5pbWF0aW9uOiBBbmltYXRpb24pIHtcblx0XHR0aGlzLmFjdGl2ZUFuaW1hdGlvbnMuc3BsaWNlKHRoaXMuYWN0aXZlQW5pbWF0aW9ucy5pbmRleE9mKGFuaW1hdGlvbiksIDEpXG5cblx0XHRpZiAoYW5pbWF0aW9uLnJlc29sdmUpIHtcblx0XHRcdGFuaW1hdGlvbi5yZXNvbHZlKClcblx0XHR9XG5cdH1cblxuXHRzdGF0aWMgdmVyaWZpeU9wdGlvbnMoXG5cdFx0b3B0aW9uczpcblx0XHRcdHwge1xuXHRcdFx0XHRcdHN0YWdnZXI/OiBudW1iZXJcblx0XHRcdFx0XHRkZWxheT86IG51bWJlclxuXHRcdFx0XHRcdGVhc2luZz86IEVhc2luZ0Z1bmN0aW9uXG5cdFx0XHQgIH1cblx0XHRcdHwgbnVsbFxuXHRcdFx0fCB1bmRlZmluZWQsXG5cdCk6IHtcblx0XHRzdGFnZ2VyOiBudW1iZXJcblx0XHRkZWxheTogbnVtYmVyXG5cdFx0ZWFzaW5nOiBFYXNpbmdGdW5jdGlvblxuXHRcdGR1cmF0aW9uOiBudW1iZXJcblx0fSB7XG5cdFx0cmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIEluaXRpYWxpemVkT3B0aW9ucywgb3B0aW9ucylcblx0fVxufVxuXG5leHBvcnQgY2xhc3MgQW5pbWF0aW9uIHtcblx0dGFyZ2V0OiBIVE1MRWxlbWVudFxuXHRtdXRhdGlvbnM6IERvbU11dGF0aW9uW11cblx0cmVzb2x2ZTogKCguLi5hcmdzOiBBcnJheTxhbnk+KSA9PiBhbnkpIHwgbnVsbFxuXHRkdXJhdGlvbjogbnVtYmVyXG5cdGRlbGF5OiBudW1iZXJcblx0YW5pbWF0aW9uU3RhcnQ6IG51bWJlciB8IG51bGxcblx0cnVuVGltZTogbnVtYmVyIHwgbnVsbFxuXHRlYXNpbmc6IEVhc2luZ0Z1bmN0aW9uXG5cblx0Y29uc3RydWN0b3IoXG5cdFx0dGFyZ2V0OiBIVE1MRWxlbWVudCxcblx0XHRtdXRhdGlvbnM6IERvbU11dGF0aW9uW10sXG5cdFx0cmVzb2x2ZTogKCguLi5hcmdzOiBBcnJheTxhbnk+KSA9PiBhbnkpIHwgbnVsbCxcblx0XHRkZWxheTogbnVtYmVyLFxuXHRcdGVhc2luZzogRWFzaW5nRnVuY3Rpb24sXG5cdFx0ZHVyYXRpb246IG51bWJlciA9IERlZmF1bHRBbmltYXRpb25UaW1lLFxuXHQpIHtcblx0XHR0aGlzLnRhcmdldCA9IHRhcmdldFxuXHRcdHRoaXMubXV0YXRpb25zID0gbXV0YXRpb25zXG5cdFx0dGhpcy5yZXNvbHZlID0gcmVzb2x2ZVxuXHRcdHRoaXMuZGVsYXkgPSBkZWxheVxuXHRcdHRoaXMuZHVyYXRpb24gPSBkdXJhdGlvblxuXHRcdHRoaXMuYW5pbWF0aW9uU3RhcnQgPSBudWxsXG5cdFx0dGhpcy5ydW5UaW1lID0gbnVsbFxuXHRcdHRoaXMuZWFzaW5nID0gZWFzaW5nXG5cdH1cblxuXHRhbmltYXRlRnJhbWUobm93OiBudW1iZXIpIHtcblx0XHRpZiAodGhpcy5hbmltYXRpb25TdGFydCA9PSBudWxsKSB0aGlzLmFuaW1hdGlvblN0YXJ0ID0gbm93XG5cdFx0dGhpcy5ydW5UaW1lID0gTWF0aC5taW4obm93IC0gdGhpcy5hbmltYXRpb25TdGFydCAtIHRoaXMuZGVsYXksIHRoaXMuZHVyYXRpb24pXG5cblx0XHRpZiAodGhpcy5ydW5UaW1lID49IDApIHtcblx0XHRcdGZvciAobGV0IG0gb2YgdGhpcy5tdXRhdGlvbnMpIHtcblx0XHRcdFx0bS51cGRhdGVEb20odGhpcy50YXJnZXQsIHRoaXMucnVuVGltZSAvIHRoaXMuZHVyYXRpb24sIHRoaXMuZWFzaW5nKVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlzRmluaXNoZWQoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMucnVuVGltZSAhPSBudWxsICYmIHRoaXMucnVuVGltZSA+PSB0aGlzLmR1cmF0aW9uXG5cdH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRyYW5zZm9ybSh0eXBlOiBUcmFuc2Zvcm1FbnVtLCBiZWdpbjogbnVtYmVyLCBlbmQ6IG51bWJlcik6IERvbVRyYW5zZm9ybSB7XG5cdGNvbnN0IHZhbHVlcyA9IHt9IGFzIFRyYW5zZm9ybVZhbHVlc1xuXG5cdHZhbHVlc1t0eXBlXSA9IHtcblx0XHRiZWdpbixcblx0XHRlbmQsXG5cdH1cblxuXHRsZXQgdXBkYXRlRG9tID0gZnVuY3Rpb24gKHRhcmdldDogSFRNTEVsZW1lbnQsIHBlcmNlbnQ6IG51bWJlciwgZWFzaW5nOiBFYXNpbmdGdW5jdGlvbik6IHZvaWQge1xuXHRcdHRhcmdldC5zdHlsZS50cmFuc2Zvcm0gPSBidWlsZFRyYW5zZm9ybVN0cmluZyh2YWx1ZXMsIHBlcmNlbnQsIGVhc2luZylcblx0fVxuXG5cdGNvbnN0IHdpbGxDaGFuZ2UgPSAoKSA9PiBcInRyYW5zZm9ybVwiXG5cblx0bGV0IGNoYWluID0gZnVuY3Rpb24gKHR5cGU6IFRyYW5zZm9ybUVudW0sIGJlZ2luOiBudW1iZXIsIGVuZDogbnVtYmVyKSB7XG5cdFx0dmFsdWVzW3R5cGVdID0ge1xuXHRcdFx0YmVnaW4sXG5cdFx0XHRlbmQsXG5cdFx0fVxuXHRcdHJldHVybiB7XG5cdFx0XHR1cGRhdGVEb20sXG5cdFx0XHRjaGFpbixcblx0XHRcdHdpbGxDaGFuZ2UsXG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIHtcblx0XHR1cGRhdGVEb20sXG5cdFx0Y2hhaW4sXG5cdFx0d2lsbENoYW5nZSxcblx0fVxufVxuXG5leHBvcnQgZnVuY3Rpb24gc2Nyb2xsKGJlZ2luOiBudW1iZXIsIGVuZDogbnVtYmVyKTogRG9tTXV0YXRpb24ge1xuXHRyZXR1cm4ge1xuXHRcdHVwZGF0ZURvbTogZnVuY3Rpb24gKHRhcmdldDogSFRNTEVsZW1lbnQsIHBlcmNlbnQ6IG51bWJlciwgZWFzaW5nOiBFYXNpbmdGdW5jdGlvbik6IHZvaWQge1xuXHRcdFx0dGFyZ2V0LnNjcm9sbFRvcCA9IGNhbGN1bGF0ZVZhbHVlKHBlcmNlbnQsIGJlZ2luLCBlbmQsIGVhc2luZylcblx0XHR9LFxuXHRcdHdpbGxDaGFuZ2U6ICgpID0+IFwiXCIsXG5cdH1cbn1cblxuY29uc3QgVHJhbnNmb3JtVW5pdHMgPSB7XG5cdFtUcmFuc2Zvcm1FbnVtLlRyYW5zbGF0ZVhdOiBcInB4XCIsXG5cdFtUcmFuc2Zvcm1FbnVtLlRyYW5zbGF0ZVldOiBcInB4XCIsXG5cdFtUcmFuc2Zvcm1FbnVtLlJvdGF0ZVldOiBcImRlZ1wiLFxuXHRbVHJhbnNmb3JtRW51bS5Sb3RhdGVaXTogXCJkZWdcIixcblx0W1RyYW5zZm9ybUVudW0uU2NhbGVdOiBcIlwiLFxufVxuXG5mdW5jdGlvbiBidWlsZFRyYW5zZm9ybVN0cmluZyh2YWx1ZXM6IFRyYW5zZm9ybVZhbHVlcywgcGVyY2VudDogbnVtYmVyLCBlYXNpbmc6IEVhc2luZ0Z1bmN0aW9uKSB7XG5cdGxldCB0cmFuc2Zvcm06IHN0cmluZ1tdID0gW11cblx0bGV0IHR5cGVzOiBUcmFuc2Zvcm1FbnVtW10gPSBPYmplY3Qua2V5cyhUcmFuc2Zvcm1Vbml0cykgYXMgYW55W10gLy8gdGhlIG9yZGVyIGlzIGltcG9ydGFudCAoZS5nLiAncm90YXRlWSg0NWRlZykgdHJhbnNsYXRlWCgxMHB4KScgbGVhZHMgdG8gb3RoZXIgcmVzdWx0cyB0aGFuICd0cmFuc2xhdGVYKDEwcHgpIHJvdGF0ZVkoNDVkZWcpJ1xuXG5cdGZvciAobGV0IHR5cGUgb2YgdHlwZXMpIHtcblx0XHRpZiAodmFsdWVzW3R5cGVdKSB7XG5cdFx0XHRsZXQgdmFsdWUgPSBjYWxjdWxhdGVWYWx1ZShwZXJjZW50LCB2YWx1ZXNbdHlwZV0uYmVnaW4sIHZhbHVlc1t0eXBlXS5lbmQsIGVhc2luZylcblx0XHRcdHRyYW5zZm9ybS5wdXNoKHR5cGUgKyBcIihcIiArIHZhbHVlICsgVHJhbnNmb3JtVW5pdHNbdHlwZV0gKyBcIilcIilcblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gdHJhbnNmb3JtLmpvaW4oXCIgXCIpXG59XG5cbi8qKlxuICogV2UgdXNlIHRoZSBhbHBoYSBjaGFubmVsIGluc3RlYWQgb2YgdXNpbmcgb3BhY2l0eSBmb3IgZmFkaW5nIGNvbG9ycy4gT3BhY2l0eSBjaGFuZ2VzIGFyZSBzbG93IG9uIG1vYmlsZSBkZXZpY2VzIGFzIHRoZXlcbiAqIGVmZmVjdCB0aGUgd2hvbGUgdHJlZSBvZiB0aGUgZG9tIGVsZW1lbnQgd2l0aCBjaGFuZ2luZyBvcGFjaXR5LlxuICpcbiAqIFNlZSBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xNDY3NzM3MyBmb3IgYSBtb3JlIGRldGFpbGVkIGV4cGxhbmF0aW9uLlxuICovXG5leHBvcnQgZnVuY3Rpb24gYWxwaGEodHlwZTogQWxwaGFFbnVtLCBjb2xvckhleDogc3RyaW5nLCBiZWdpbjogbnVtYmVyLCBlbmQ6IG51bWJlcik6IERvbU11dGF0aW9uIHtcblx0bGV0IGNvbG9yID0gaGV4VG9SZ2IoY29sb3JIZXgpXG5cdHJldHVybiB7XG5cdFx0dXBkYXRlRG9tOiBmdW5jdGlvbiAodGFyZ2V0OiBIVE1MRWxlbWVudCwgcGVyY2VudDogbnVtYmVyLCBlYXNpbmc6IEVhc2luZ0Z1bmN0aW9uKTogdm9pZCB7XG5cdFx0XHRsZXQgYWxwaGFDaGFubmVsID0gY2FsY3VsYXRlVmFsdWUocGVyY2VudCwgYmVnaW4sIGVuZCwgZWFzaW5nKVxuXG5cdFx0XHRpZiAodHlwZSA9PT0gQWxwaGFFbnVtLkJhY2tncm91bmRDb2xvcikge1xuXHRcdFx0XHR0YXJnZXQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gYHJnYmEoJHtjb2xvci5yfSwgJHtjb2xvci5nfSwgJHtjb2xvci5ifSwgJHthbHBoYUNoYW5uZWx9KWBcblx0XHRcdH0gZWxzZSBpZiAodHlwZSA9PT0gQWxwaGFFbnVtLkNvbG9yKSB7XG5cdFx0XHRcdHRhcmdldC5zdHlsZS5jb2xvciA9IGByZ2JhKCR7Y29sb3Iucn0sICR7Y29sb3IuZ30sICR7Y29sb3IuYn0sICR7YWxwaGFDaGFubmVsfSlgXG5cdFx0XHR9XG5cdFx0fSxcblx0XHR3aWxsQ2hhbmdlOiAoKSA9PiBcImFscGhhXCIsXG5cdH1cbn1cblxuLyoqXG4gKiBPbmx5IHVzZSBvbiBzbWFsbCBlbGVtZW50cy4gWW91IHNob3VsZCB1c2UgQWxwaGEgZm9yIGZhZGluZyBsYXJnZSBiYWNrZ3JvdW5kcyB3aGljaCBpcyB3YXkgZmFzdGVyIG9uIG1vYmlsZXMuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBvcGFjaXR5KGJlZ2luOiBudW1iZXIsIGVuZDogbnVtYmVyLCBrZWVwVmFsdWU6IGJvb2xlYW4pOiBEb21NdXRhdGlvbiB7XG5cdGxldCBpbml0aWFsT3BhY2l0eTogc3RyaW5nIHwgbnVsbCA9IG51bGxcblx0cmV0dXJuIHtcblx0XHR1cGRhdGVEb206IGZ1bmN0aW9uICh0YXJnZXQ6IEhUTUxFbGVtZW50LCBwZXJjZW50OiBudW1iZXIsIGVhc2luZzogRWFzaW5nRnVuY3Rpb24pOiB2b2lkIHtcblx0XHRcdGlmIChwZXJjZW50ID09PSAwICYmIGluaXRpYWxPcGFjaXR5ID09PSBudWxsKSB7XG5cdFx0XHRcdGluaXRpYWxPcGFjaXR5ID0gdGFyZ2V0LnN0eWxlLm9wYWNpdHlcblx0XHRcdH1cblxuXHRcdFx0bGV0IG9wYWNpdHkgPSBjYWxjdWxhdGVWYWx1ZShwZXJjZW50LCBiZWdpbiwgZW5kLCBlYXNpbmcpXG5cblx0XHRcdGlmIChwZXJjZW50ID09PSAxICYmICFrZWVwVmFsdWUpIHtcblx0XHRcdFx0Ly8gb24gc29tZSBlbGVtZW50cyB0aGUgdmFsdWUgaGFzdCB0byBiZSBzZXQgdG8gdGhlIGluaXRpYWwgdmFsdWUgYmVjYXVzZSBob3ZlciB1c2luZyBvcGFjaXR5IHdvbid0IHdvcmsgb3RoZXJ3aXNlLlxuXHRcdFx0XHR0YXJnZXQuc3R5bGUub3BhY2l0eSA9IGluaXRpYWxPcGFjaXR5ID8gaW5pdGlhbE9wYWNpdHkgOiBcIlwiXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0YXJnZXQuc3R5bGUub3BhY2l0eSA9IG9wYWNpdHkgKyBcIlwiXG5cdFx0XHR9XG5cdFx0fSxcblx0XHR3aWxsQ2hhbmdlOiAoKSA9PiBcIm9wYWNpdHlcIixcblx0fVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaGVpZ2h0KGJlZ2luOiBudW1iZXIsIGVuZDogbnVtYmVyKTogRG9tTXV0YXRpb24ge1xuXHRyZXR1cm4ge1xuXHRcdHVwZGF0ZURvbTogZnVuY3Rpb24gKHRhcmdldDogSFRNTEVsZW1lbnQsIHBlcmNlbnQ6IG51bWJlciwgZWFzaW5nOiBFYXNpbmdGdW5jdGlvbik6IHZvaWQge1xuXHRcdFx0dGFyZ2V0LnN0eWxlLmhlaWdodCA9IGNhbGN1bGF0ZVZhbHVlKHBlcmNlbnQsIGJlZ2luLCBlbmQsIGVhc2luZykgKyBcInB4XCJcblx0XHR9LFxuXHRcdHdpbGxDaGFuZ2U6ICgpID0+IFwiaGVpZ2h0XCIsXG5cdH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHdpZHRoKGJlZ2luOiBudW1iZXIsIGVuZDogbnVtYmVyKTogRG9tTXV0YXRpb24ge1xuXHRyZXR1cm4ge1xuXHRcdHVwZGF0ZURvbTogZnVuY3Rpb24gKHRhcmdldDogSFRNTEVsZW1lbnQsIHBlcmNlbnQ6IG51bWJlciwgZWFzaW5nOiBFYXNpbmdGdW5jdGlvbik6IHZvaWQge1xuXHRcdFx0dGFyZ2V0LnN0eWxlLndpZHRoID0gY2FsY3VsYXRlVmFsdWUocGVyY2VudCwgYmVnaW4sIGVuZCwgZWFzaW5nKSArIFwicHhcIlxuXHRcdH0sXG5cdFx0d2lsbENoYW5nZTogKCkgPT4gXCJ3aWR0aFwiLFxuXHR9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmb250U2l6ZShiZWdpbjogbnVtYmVyLCBlbmQ6IG51bWJlcik6IERvbU11dGF0aW9uIHtcblx0cmV0dXJuIHtcblx0XHR1cGRhdGVEb206IGZ1bmN0aW9uICh0YXJnZXQ6IEhUTUxFbGVtZW50LCBwZXJjZW50OiBudW1iZXIsIGVhc2luZzogRWFzaW5nRnVuY3Rpb24pOiB2b2lkIHtcblx0XHRcdHRhcmdldC5zdHlsZS5mb250U2l6ZSA9IGNhbGN1bGF0ZVZhbHVlKHBlcmNlbnQsIGJlZ2luLCBlbmQsIGVhc2luZykgKyBcInB4XCJcblx0XHR9LFxuXHRcdHdpbGxDaGFuZ2U6ICgpID0+IFwiXCIsXG5cdH1cbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlVmFsdWUocGVyY2VudDogbnVtYmVyLCBiZWdpbjogbnVtYmVyLCBlbmQ6IG51bWJlciwgZWFzaW5nOiAoLi4uYXJnczogQXJyYXk8YW55PikgPT4gYW55KTogbnVtYmVyIHtcblx0cmV0dXJuIChlbmQgLSBiZWdpbikgKiBlYXNpbmcocGVyY2VudCkgKyBiZWdpblxufVxuXG5leHBvcnQgY29uc3QgYW5pbWF0aW9uczogQW5pbWF0aW9ucyA9IG5ldyBBbmltYXRpb25zKClcblxuZXhwb3J0IGZ1bmN0aW9uIGdldChlbGVtZW50OiBIVE1MRWxlbWVudCB8IG51bGwpOiBIVE1MRWxlbWVudCB7XG5cdGlmICghZWxlbWVudCkgdGhyb3cgbmV3IEVycm9yKFwidHJpZWQgdG8gdXBkYXRlIGEgbm9uIGV4aXN0aW5nIGVsZW1lbnRcIilcblx0cmV0dXJuIGVsZW1lbnRcbn1cbiIsImltcG9ydCB7IGFzc2VydE1haW5Pck5vZGVCb290IH0gZnJvbSBcIi4uL2FwaS9jb21tb24vRW52XCJcblxuYXNzZXJ0TWFpbk9yTm9kZUJvb3QoKVxudHlwZSBMb2dDYXRlZ29yeSA9IFJlY29yZDxzdHJpbmcsIHN0cmluZz5cbmV4cG9ydCBjb25zdCBDYXQ6IFJlY29yZDxzdHJpbmcsIExvZ0NhdGVnb3J5PiA9IHtcblx0Y3NzOiB7XG5cdFx0bmFtZTogXCJjc3NcIixcblx0XHRjb2xvcjogXCJvcmFuZ2VcIixcblx0fSxcblx0bWl0aHJpbDoge1xuXHRcdG5hbWU6IFwibWl0aHJpbFwiLFxuXHRcdGNvbG9yOiBcImRhcmtncmVlblwiLFxuXHR9LFxuXHRlcnJvcjoge1xuXHRcdG5hbWU6IFwiZXJyb3JcIixcblx0XHRjb2xvcjogXCJyZWRcIixcblx0fSxcblx0aW5mbzoge1xuXHRcdG5hbWU6IFwiaW5mb1wiLFxuXHRcdGNvbG9yOiBcImxpZ2h0Ymx1ZVwiLFxuXHR9LFxuXHRkZWJ1Zzoge1xuXHRcdG5hbWU6IFwiZGVidWdcIixcblx0XHRjb2xvcjogXCIjMDA5Njg4XCIsXG5cdH0sXG59XG5jb25zdCBhY3RpdmVDYXRlZ29yaWVzOiBMb2dDYXRlZ29yeVtdID0gW11cblxuZXhwb3J0IGZ1bmN0aW9uIGVuYWJsZShjYXQ6IExvZ0NhdGVnb3J5KSB7XG5cdGFjdGl2ZUNhdGVnb3JpZXMucHVzaChjYXQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2coY2F0ZWdvcnk6IExvZ0NhdGVnb3J5LCBtZXNzYWdlOiBzdHJpbmcsIC4uLmFyZ3M6IGFueVtdKSB7XG5cdGlmIChhY3RpdmVDYXRlZ29yaWVzLmluZGV4T2YoY2F0ZWdvcnkpID09PSAtMSkgcmV0dXJuXG5cdGNvbnNvbGUubG9nKFwiJWNcIiArIGNhdGVnb3J5Lm5hbWUsIFwiY29sb3I6XCIgKyBjYXRlZ29yeS5jb2xvciwgbWVzc2FnZSwgLi4uYXJncylcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRpbWVyKGNhdGVnb3J5OiBMb2dDYXRlZ29yeSk6ICguLi5hcmdzOiBBcnJheTxhbnk+KSA9PiBhbnkge1xuXHRpZiAoYWN0aXZlQ2F0ZWdvcmllcy5pbmRleE9mKGNhdGVnb3J5KSA9PT0gLTEpIHtcblx0XHRyZXR1cm4gZnVuY3Rpb24gKCkge31cblx0fVxuXG5cdGxldCBzdGFydCA9IHdpbmRvdy5wZXJmb3JtYW5jZS5ub3coKVxuXHRyZXR1cm4gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiBNYXRoLnJvdW5kKHdpbmRvdy5wZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0KVxuXHR9XG59XG4iLCJpbXBvcnQgeyBDYXQsIGxvZywgdGltZXIgfSBmcm9tIFwiLi4vbWlzYy9Mb2dcIlxuaW1wb3J0IHsgc2l6ZSB9IGZyb20gXCIuL3NpemVcIlxuaW1wb3J0IHsgYXNzZXJ0TWFpbk9yTm9kZUJvb3QsIGlzQWRtaW5DbGllbnQsIGlzVGVzdCB9IGZyb20gXCIuLi9hcGkvY29tbW9uL0VudlwiXG5pbXBvcnQgeyB3aW5kb3dGYWNhZGUgfSBmcm9tIFwiLi4vbWlzYy9XaW5kb3dGYWNhZGVcIlxuaW1wb3J0IHsgdGhlbWUgfSBmcm9tIFwiLi90aGVtZVwiXG5pbXBvcnQgeyBhc3NlcnROb3ROdWxsLCBuZXZlck51bGwgfSBmcm9tIFwiQHR1dGFvL3R1dGFub3RhLXV0aWxzXCJcbmltcG9ydCB7IGNsaWVudCB9IGZyb20gXCIuLi9taXNjL0NsaWVudERldGVjdG9yXCJcbmltcG9ydCB7IFRoZW1lQ29udHJvbGxlciB9IGZyb20gXCIuL1RoZW1lQ29udHJvbGxlci5qc1wiXG5cbmFzc2VydE1haW5Pck5vZGVCb290KClcblxuZXhwb3J0IHR5cGUgU3R5bGVTaGVldElkID0gXCJtYWluXCIgfCBcIm91dGxpbmVcIlxuXG4vKipcbiAqIFdyaXRlcyBhbGwgc3R5bGVzIHRvIGEgc2luZ2xlIGRvbSA8c3R5bGU+LXRhZ1xuICovXG5cbmNsYXNzIFN0eWxlcyB7XG5cdHN0eWxlczogTWFwPFN0eWxlU2hlZXRJZCwgKC4uLmFyZ3M6IEFycmF5PGFueT4pID0+IGFueT5cblx0aW5pdGlhbGl6ZWQ6IGJvb2xlYW5cblx0Ym9keVdpZHRoOiBudW1iZXJcblx0Ym9keUhlaWdodDogbnVtYmVyXG5cblx0cHJpdmF0ZSBzdHlsZVNoZWV0cyA9IG5ldyBNYXA8U3R5bGVTaGVldElkLCBIVE1MU3R5bGVFbGVtZW50PigpXG5cblx0Y29uc3RydWN0b3IoKSB7XG5cdFx0dGhpcy5pbml0aWFsaXplZCA9IGZhbHNlXG5cdFx0dGhpcy5zdHlsZXMgPSBuZXcgTWFwKClcblx0XHR0aGlzLmJvZHlXaWR0aCA9IG5ldmVyTnVsbChkb2N1bWVudC5ib2R5KS5vZmZzZXRXaWR0aFxuXHRcdHRoaXMuYm9keUhlaWdodCA9IG5ldmVyTnVsbChkb2N1bWVudC5ib2R5KS5vZmZzZXRIZWlnaHRcblx0XHR3aW5kb3dGYWNhZGUuYWRkUmVzaXplTGlzdGVuZXIoKHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKSA9PiB7XG5cdFx0XHR0aGlzLmJvZHlXaWR0aCA9IHdpZHRoXG5cdFx0XHR0aGlzLmJvZHlIZWlnaHQgPSBoZWlnaHRcblx0XHR9KVxuXHR9XG5cblx0aW5pdCh0aGVtZUNvbnRyb2xsZXI6IFRoZW1lQ29udHJvbGxlcikge1xuXHRcdGlmICh0aGlzLmluaXRpYWxpemVkKSByZXR1cm5cblx0XHR0aGlzLmluaXRpYWxpemVkID0gdHJ1ZVxuXG5cdFx0dGhpcy51cGRhdGVEb21TdHlsZXMoKVxuXG5cdFx0dGhlbWVDb250cm9sbGVyLm9ic2VydmFibGVUaGVtZUlkLm1hcCgoKSA9PiB7XG5cdFx0XHR0aGlzLnVwZGF0ZURvbVN0eWxlcygpXG5cdFx0fSlcblx0fVxuXG5cdGdldFN0eWxlU2hlZXRFbGVtZW50KGlkOiBTdHlsZVNoZWV0SWQpOiBOb2RlIHtcblx0XHRyZXR1cm4gYXNzZXJ0Tm90TnVsbCh0aGlzLnN0eWxlU2hlZXRzLmdldChpZCkpLmNsb25lTm9kZSh0cnVlKVxuXHR9XG5cblx0aXNEZXNrdG9wTGF5b3V0KCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiB0aGlzLmJvZHlXaWR0aCA+PSBzaXplLmRlc2t0b3BfbGF5b3V0X3dpZHRoXG5cdH1cblxuXHRpc1NpbmdsZUNvbHVtbkxheW91dCgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdGhpcy5ib2R5V2lkdGggPCBzaXplLnR3b19jb2x1bW5fbGF5b3V0X3dpZHRoXG5cdH1cblxuXHRpc1R3b0NvbHVtbkxheW91dCgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdGhpcy5ib2R5V2lkdGggPj0gc2l6ZS50d29fY29sdW1uX2xheW91dF93aWR0aCAmJiB0aGlzLmJvZHlXaWR0aCA8IHNpemUuZGVza3RvcF9sYXlvdXRfd2lkdGhcblx0fVxuXG5cdGlzVXNpbmdCb3R0b21OYXZpZ2F0aW9uKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiAhaXNBZG1pbkNsaWVudCgpICYmIChjbGllbnQuaXNNb2JpbGVEZXZpY2UoKSB8fCAhdGhpcy5pc0Rlc2t0b3BMYXlvdXQoKSlcblx0fVxuXG5cdHJlZ2lzdGVyU3R5bGUoaWQ6IFN0eWxlU2hlZXRJZCwgc3R5bGVDcmVhdG9yOiAoLi4uYXJnczogQXJyYXk8YW55PikgPT4gUmVjb3JkPHN0cmluZywgUGFydGlhbDxDU1NTdHlsZURlY2xhcmF0aW9uPiB8IG9iamVjdD4pIHtcblx0XHRpZiAoIXRoaXMuaW5pdGlhbGl6ZWQgJiYgdGhpcy5zdHlsZXMuaGFzKGlkKSkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiZHVwbGljYXRlIHN0eWxlIGRlZmluaXRpb246IFwiICsgaWQpXG5cdFx0fVxuXG5cdFx0dGhpcy5zdHlsZXMuc2V0KGlkLCBzdHlsZUNyZWF0b3IpXG5cblx0XHRpZiAodGhpcy5pbml0aWFsaXplZCkge1xuXHRcdFx0bG9nKENhdC5jc3MsIFwidXBkYXRlIHN0eWxlXCIsIGlkLCBzdHlsZUNyZWF0b3IodGhlbWUpKVxuXG5cdFx0XHR0aGlzLnVwZGF0ZURvbVN0eWxlKGlkLCBzdHlsZUNyZWF0b3IpXG5cdFx0fVxuXHR9XG5cblx0dXBkYXRlU3R5bGUoaWQ6IFN0eWxlU2hlZXRJZCkge1xuXHRcdGlmICghdGhpcy5pbml0aWFsaXplZCB8fCAhdGhpcy5zdHlsZXMuaGFzKGlkKSkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiY2Fubm90IHVwZGF0ZSBub25leGlzdGVudCBzdHlsZSBcIiArIGlkKVxuXHRcdH1cblxuXHRcdGNvbnN0IGNyZWF0b3IgPSBuZXZlck51bGwodGhpcy5zdHlsZXMuZ2V0KGlkKSlcblx0XHRsb2coQ2F0LmNzcywgXCJ1cGRhdGUgc3R5bGVcIiwgaWQsIGNyZWF0b3IodGhlbWUpKVxuXG5cdFx0dGhpcy51cGRhdGVEb21TdHlsZShpZCwgY3JlYXRvcilcblx0fVxuXG5cdHByaXZhdGUgdXBkYXRlRG9tU3R5bGVzKCkge1xuXHRcdC8vIFRoaXMgaXMgaGFja2luZyBidXQgd2UgY3VycmVudGx5IGltcG9ydCBndWkgc3R1ZmYgZnJvbSBhIGxvdCBvZiB0ZXN0ZWQgdGhpbmdzXG5cdFx0aWYgKGlzVGVzdCgpKSB7XG5cdFx0XHRyZXR1cm5cblx0XHR9XG5cblx0XHRsZXQgdGltZSA9IHRpbWVyKENhdC5jc3MpXG5cdFx0QXJyYXkuZnJvbSh0aGlzLnN0eWxlcy5lbnRyaWVzKCkpLm1hcCgoZW50cnkpID0+IHtcblx0XHRcdHRoaXMudXBkYXRlRG9tU3R5bGUoZW50cnlbMF0sIGVudHJ5WzFdKVxuXHRcdH0pXG5cdFx0bG9nKENhdC5jc3MsIFwiY3JlYXRpb24gdGltZVwiLCB0aW1lKCkpXG5cdH1cblxuXHRwcml2YXRlIHVwZGF0ZURvbVN0eWxlKGlkOiBTdHlsZVNoZWV0SWQsIHN0eWxlQ3JlYXRvcjogKC4uLmFyZ3M6IEFycmF5PGFueT4pID0+IGFueSkge1xuXHRcdGNvbnN0IHN0eWxlU2hlZXQgPSB0aGlzLmdldERvbVN0eWxlU2hlZXQoYGNzcy0ke2lkfWApXG5cdFx0c3R5bGVTaGVldC50ZXh0Q29udGVudCA9IHRvQ3NzKHN0eWxlQ3JlYXRvcigpKVxuXHRcdHRoaXMuc3R5bGVTaGVldHMuc2V0KGlkLCBzdHlsZVNoZWV0KVxuXHR9XG5cblx0cHJpdmF0ZSBnZXREb21TdHlsZVNoZWV0KGlkOiBzdHJpbmcpOiBIVE1MU3R5bGVFbGVtZW50IHtcblx0XHRsZXQgc3R5bGVEb21FbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpXG5cblx0XHRpZiAoIXN0eWxlRG9tRWxlbWVudCkge1xuXHRcdFx0c3R5bGVEb21FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInN0eWxlXCIpXG5cdFx0XHRzdHlsZURvbUVsZW1lbnQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInRleHQvY3NzXCIpXG5cdFx0XHRzdHlsZURvbUVsZW1lbnQuaWQgPSBpZFxuXHRcdFx0c3R5bGVEb21FbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdLmFwcGVuZENoaWxkKHN0eWxlRG9tRWxlbWVudClcblx0XHR9XG5cblx0XHRyZXR1cm4gc3R5bGVEb21FbGVtZW50IGFzIEhUTUxTdHlsZUVsZW1lbnRcblx0fVxufVxuXG5mdW5jdGlvbiBvYmplY3RUb0NzcyhpbmRlbnQ6IHN0cmluZywga2V5OiBzdHJpbmcsIG86IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pIHtcblx0bGV0IGNzc1N0cmluZyA9IGAke2luZGVudH0ke2tleX0geyBcXG5gXG5cdGNzc1N0cmluZyArPSBpbmRlbnQgKyB0b0NzcyhvLCBpbmRlbnQgKyBcIiAgXCIpXG5cdGNzc1N0cmluZyArPSBgIFxcbiR7aW5kZW50fX0gXFxuYFxuXHRyZXR1cm4gY3NzU3RyaW5nXG59XG5cbmZ1bmN0aW9uIHRvQ3NzKG9iajogUmVjb3JkPHN0cmluZywgYW55PiwgaW5kZW50ID0gXCJcIikge1xuXHRsZXQgcmV0ID0gT2JqZWN0LmtleXMob2JqKVxuXHRcdC5tYXAoKGtleSkgPT4ge1xuXHRcdFx0aWYgKG9ialtrZXldIGluc3RhbmNlb2YgQXJyYXkpIHtcblx0XHRcdFx0cmV0dXJuIG9ialtrZXldXG5cdFx0XHRcdFx0Lm1hcCgobzogYW55KSA9PiB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gb2JqZWN0VG9Dc3MoaW5kZW50LCBrZXksIG8pXG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQuam9pbihcIlxcblwiKVxuXHRcdFx0fSBlbHNlIGlmIChvYmpba2V5XSBpbnN0YW5jZW9mIE9iamVjdCkge1xuXHRcdFx0XHRyZXR1cm4gb2JqZWN0VG9Dc3MoaW5kZW50LCBrZXksIG9ialtrZXldKVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIGAke2luZGVudH0ke2tleX06ICR7b2JqW2tleV19O2Bcblx0XHRcdH1cblx0XHR9KVxuXHRcdC5qb2luKFwiXFxuXCIpXG5cdHJldHVybiByZXRcbn1cblxuZXhwb3J0IGNvbnN0IHN0eWxlczogU3R5bGVzID0gbmV3IFN0eWxlcygpXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBRUEsc0JBQXNCO0FBRXRCLE1BQU0sYUFBYTtDQUNsQixRQUFRO0NBQ1IsTUFBTTtDQUNOLE9BQU87Q0FDUCxPQUFPO0NBQ1AsT0FBTztBQUNQO01BU1lBLE9BQXVDO0NBQ25ELElBQUksU0FBVUMsU0FBeUI7QUFDdEMsU0FBTyxLQUFLLElBQUksU0FBUyxXQUFXLE1BQU07Q0FDMUM7Q0FDRCxLQUFLLFNBQVVBLFNBQXlCO0FBQ3ZDLFNBQU8sSUFBSSxLQUFLLEdBQUcsSUFBSSxRQUFRO0NBQy9CO0NBQ0QsT0FBTyxTQUFVQSxTQUF5QjtBQUN6QyxTQUFPLFVBQVUsS0FBTSxLQUFLLEdBQUcsVUFBVSxFQUFFLEdBQUcsSUFBSSxJQUFJLEtBQUssR0FB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