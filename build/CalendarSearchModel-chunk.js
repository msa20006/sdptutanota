import { __toESM } from "./chunk-chunk.js";
import { assertMainOrNode } from "./Env-chunk.js";
import { arrayEquals, assertNonNull, assertNotNull, incrementMonth, isSameTypeRef, tokenize } from "./dist2-chunk.js";
import { listIdPart } from "./EntityUtils-chunk.js";
import { require_stream } from "./stream-chunk.js";

//#region src/calendar-app/calendar/search/model/CalendarSearchModel.ts
var import_stream = __toESM(require_stream(), 1);
assertMainOrNode();
var CalendarSearchModel = class {
	result;
	lastQueryString;
	lastQuery;
	lastSearchPromise;
	cancelSignal;
	constructor(calendarModel) {
		this.calendarModel = calendarModel;
		this.result = (0, import_stream.default)();
		this.lastQueryString = (0, import_stream.default)("");
		this.lastQuery = null;
		this.lastSearchPromise = Promise.resolve();
		this.cancelSignal = (0, import_stream.default)(false);
	}
	async search(searchQuery, progressTracker) {
		if (this.lastQuery && searchQueryEquals(searchQuery, this.lastQuery)) return this.lastSearchPromise;
		this.lastQuery = searchQuery;
		const { query, restriction, minSuggestionCount, maxResults } = searchQuery;
		this.lastQueryString(query);
		let result = this.result();
		if (result && !isSameTypeRef(restriction.type, result.restriction.type)) this.result(null);
		if (query.trim() === "") {
			const result$1 = {
				query,
				restriction,
				results: [],
				currentIndexTimestamp: 0,
				lastReadSearchIndexRow: [],
				maxResults: 0,
				matchWordOrder: false,
				moreResults: [],
				moreResultsEntries: []
			};
			this.result(result$1);
			this.lastSearchPromise = Promise.resolve(result$1);
		} else {
			let currentDate = new Date(assertNotNull(restriction.start));
			const endDate = new Date(assertNotNull(restriction.end));
			const calendarModel = await this.calendarModel();
			const daysInMonths = [];
			while (currentDate.getTime() <= endDate.getTime()) {
				daysInMonths.push(currentDate);
				currentDate = incrementMonth(currentDate, 1);
			}
			const calendarResult = {
				currentIndexTimestamp: 0,
				moreResults: [],
				moreResultsEntries: [],
				lastReadSearchIndexRow: [],
				matchWordOrder: false,
				restriction,
				results: [],
				query
			};
			const monitorHandle = progressTracker.registerMonitorSync(daysInMonths.length);
			const monitor = assertNotNull(progressTracker.getMonitor(monitorHandle));
			if (this.cancelSignal()) {
				this.result(calendarResult);
				this.lastSearchPromise = Promise.resolve(calendarResult);
				return this.lastSearchPromise;
			}
			const hasNewPaidPlan = await calendarModel.canLoadBirthdaysCalendar();
			if (hasNewPaidPlan) await calendarModel.loadContactsBirthdays();
			await calendarModel.loadMonthsIfNeeded(daysInMonths, monitor, this.cancelSignal);
			monitor.completed();
			const eventsForDays = calendarModel.getEventsForMonths()();
			assertNonNull(restriction.start);
			assertNonNull(restriction.end);
			const tokens = tokenize(query.trim());
			const alreadyAdded = new Set();
			if (this.cancelSignal()) {
				this.result(calendarResult);
				this.lastSearchPromise = Promise.resolve(calendarResult);
				return this.lastSearchPromise;
			}
			const followCommonRestrictions = (key, event) => {
				if (alreadyAdded.has(key)) return false;
				if (restriction.folderIds.length > 0 && !restriction.folderIds.includes(listIdPart(event._id))) return false;
				if (restriction.eventSeries === false && event.repeatRule != null) return false;
				return true;
			};
			if (tokens.length > 0) {
				for (const [startOfDay, eventsOnDay] of eventsForDays) eventLoop: for (const event of eventsOnDay) {
					if (!(startOfDay >= restriction.start && startOfDay <= restriction.end)) continue;
					const key = idToKey(event._id);
					if (!followCommonRestrictions(key, event)) continue;
					for (const token of tokens) if (event.summary.toLowerCase().includes(token)) {
						alreadyAdded.add(key);
						calendarResult.results.push(event._id);
						continue eventLoop;
					}
					const descriptionToSearch = event.description.replaceAll(/(<[^>]+>)/gi, " ").toLowerCase();
					for (const token of tokens) if (descriptionToSearch.includes(token)) {
						alreadyAdded.add(key);
						calendarResult.results.push(event._id);
						continue eventLoop;
					}
					if (this.cancelSignal()) {
						this.result(calendarResult);
						this.lastSearchPromise = Promise.resolve(calendarResult);
						return this.lastSearchPromise;
					}
				}
				const startDate = new Date(restriction.start);
				const endDate$1 = new Date(restriction.end);
				if (hasNewPaidPlan) {
					const birthdayEvents = Array.from(calendarModel.getBirthdayEvents().values()).flat();
					eventLoop: for (const eventRegistry of birthdayEvents) {
						const month = eventRegistry.event.startTime.getMonth();
						if (!(month >= startDate.getMonth() && month <= endDate$1.getMonth())) continue;
						const key = idToKey(eventRegistry.event._id);
						if (!followCommonRestrictions(key, eventRegistry.event)) continue;
						for (const token of tokens) if (eventRegistry.event.summary.toLowerCase().includes(token)) {
							alreadyAdded.add(key);
							calendarResult.results.push(eventRegistry.event._id);
							continue eventLoop;
						}
						if (this.cancelSignal()) {
							this.result(calendarResult);
							this.lastSearchPromise = Promise.resolve(calendarResult);
							return this.lastSearchPromise;
						}
					}
				}
			}
			this.result(calendarResult);
			this.lastSearchPromise = Promise.resolve(calendarResult);
		}
		return this.lastSearchPromise;
	}
	isNewSearch(query, restriction) {
		let isNew = false;
		let lastQuery = this.lastQuery;
		if (lastQuery == null) isNew = true;
else if (lastQuery.query !== query) isNew = true;
else if (lastQuery.restriction !== restriction) isNew = !isSameSearchRestriction(restriction, lastQuery.restriction);
		if (isNew) this.sendCancelSignal();
		return isNew;
	}
	sendCancelSignal() {
		this.cancelSignal(true);
		this.cancelSignal.end(true);
		this.cancelSignal = (0, import_stream.default)(false);
	}
};
function idToKey(id) {
	return id.join("/");
}
function searchQueryEquals(a, b) {
	return a.query === b.query && isSameSearchRestriction(a.restriction, b.restriction) && a.minSuggestionCount === b.minSuggestionCount && a.maxResults === b.maxResults;
}
function isSameSearchRestriction(a, b) {
	const isSameAttributeIds = a.attributeIds === b.attributeIds || !!a.attributeIds && !!b.attributeIds && arrayEquals(a.attributeIds, b.attributeIds);
	return isSameTypeRef(a.type, b.type) && a.start === b.start && a.end === b.end && isSameAttributeIds && (a.eventSeries === b.eventSeries || a.eventSeries === null && b.eventSeries === true || a.eventSeries === true && b.eventSeries === null) && arrayEquals(a.folderIds, b.folderIds);
}
function areResultsForTheSameQuery(a, b) {
	return a.query === b.query && isSameSearchRestriction(a.restriction, b.restriction);
}
function hasMoreResults(searchResult) {
	return searchResult.moreResults.length > 0 || searchResult.lastReadSearchIndexRow.length > 0 && searchResult.lastReadSearchIndexRow.every(([word, id]) => id !== 0);
}

//#endregion
export { CalendarSearchModel, areResultsForTheSameQuery as areResultsForTheSameQuery$1, hasMoreResults as hasMoreResults$1, isSameSearchRestriction as isSameSearchRestriction$1 };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2FsZW5kYXJTZWFyY2hNb2RlbC1jaHVuay5qcyIsIm5hbWVzIjpbImNhbGVuZGFyTW9kZWw6IGxhenlBc3luYzxDYWxlbmRhckV2ZW50c1JlcG9zaXRvcnk+Iiwic2VhcmNoUXVlcnk6IFNlYXJjaFF1ZXJ5IiwicHJvZ3Jlc3NUcmFja2VyOiBQcm9ncmVzc1RyYWNrZXIiLCJyZXN1bHQ6IFNlYXJjaFJlc3VsdCIsInJlc3VsdCIsImRheXNJbk1vbnRoczogQXJyYXk8RGF0ZT4iLCJjYWxlbmRhclJlc3VsdDogU2VhcmNoUmVzdWx0IiwibW9uaXRvcjogSVByb2dyZXNzTW9uaXRvciIsImFscmVhZHlBZGRlZDogU2V0PHN0cmluZz4iLCJrZXk6IHN0cmluZyIsImV2ZW50OiBDYWxlbmRhckV2ZW50IiwiZW5kRGF0ZSIsInF1ZXJ5OiBzdHJpbmciLCJyZXN0cmljdGlvbjogU2VhcmNoUmVzdHJpY3Rpb24iLCJpZDogSWRUdXBsZSIsImE6IFNlYXJjaFF1ZXJ5IiwiYjogU2VhcmNoUXVlcnkiLCJhOiBTZWFyY2hSZXN0cmljdGlvbiIsImI6IFNlYXJjaFJlc3RyaWN0aW9uIiwiYTogU2VhcmNoUmVzdWx0IiwiYjogU2VhcmNoUmVzdWx0Iiwic2VhcmNoUmVzdWx0OiBTZWFyY2hSZXN1bHQiXSwic291cmNlcyI6WyIuLi9zcmMvY2FsZW5kYXItYXBwL2NhbGVuZGFyL3NlYXJjaC9tb2RlbC9DYWxlbmRhclNlYXJjaE1vZGVsLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBzdHJlYW0gZnJvbSBcIm1pdGhyaWwvc3RyZWFtXCJcbmltcG9ydCBTdHJlYW0gZnJvbSBcIm1pdGhyaWwvc3RyZWFtXCJcbmltcG9ydCB0eXBlIHsgU2VhcmNoUmVzdHJpY3Rpb24sIFNlYXJjaFJlc3VsdCB9IGZyb20gXCIuLi8uLi8uLi8uLi9jb21tb24vYXBpL3dvcmtlci9zZWFyY2gvU2VhcmNoVHlwZXNcIlxuaW1wb3J0IHsgYXJyYXlFcXVhbHMsIGFzc2VydE5vbk51bGwsIGFzc2VydE5vdE51bGwsIGluY3JlbWVudE1vbnRoLCBpc1NhbWVUeXBlUmVmLCBsYXp5QXN5bmMsIHRva2VuaXplIH0gZnJvbSBcIkB0dXRhby90dXRhbm90YS11dGlsc1wiXG5pbXBvcnQgeyBhc3NlcnRNYWluT3JOb2RlIH0gZnJvbSBcIi4uLy4uLy4uLy4uL2NvbW1vbi9hcGkvY29tbW9uL0VudlwiXG5pbXBvcnQgeyBsaXN0SWRQYXJ0IH0gZnJvbSBcIi4uLy4uLy4uLy4uL2NvbW1vbi9hcGkvY29tbW9uL3V0aWxzL0VudGl0eVV0aWxzLmpzXCJcbmltcG9ydCB7IElQcm9ncmVzc01vbml0b3IgfSBmcm9tIFwiLi4vLi4vLi4vLi4vY29tbW9uL2FwaS9jb21tb24vdXRpbHMvUHJvZ3Jlc3NNb25pdG9yLmpzXCJcbmltcG9ydCB7IFByb2dyZXNzVHJhY2tlciB9IGZyb20gXCIuLi8uLi8uLi8uLi9jb21tb24vYXBpL21haW4vUHJvZ3Jlc3NUcmFja2VyLmpzXCJcbmltcG9ydCB7IENhbGVuZGFyRXZlbnRzUmVwb3NpdG9yeSB9IGZyb20gXCIuLi8uLi8uLi8uLi9jb21tb24vY2FsZW5kYXIvZGF0ZS9DYWxlbmRhckV2ZW50c1JlcG9zaXRvcnkuanNcIlxuaW1wb3J0IHsgQ2FsZW5kYXJFdmVudCB9IGZyb20gXCIuLi8uLi8uLi8uLi9jb21tb24vYXBpL2VudGl0aWVzL3R1dGFub3RhL1R5cGVSZWZzLmpzXCJcblxuYXNzZXJ0TWFpbk9yTm9kZSgpXG5leHBvcnQgdHlwZSBTZWFyY2hRdWVyeSA9IHtcblx0cXVlcnk6IHN0cmluZ1xuXHRyZXN0cmljdGlvbjogU2VhcmNoUmVzdHJpY3Rpb25cblx0bWluU3VnZ2VzdGlvbkNvdW50OiBudW1iZXJcblx0bWF4UmVzdWx0czogbnVtYmVyIHwgbnVsbFxufVxuXG5leHBvcnQgY2xhc3MgQ2FsZW5kYXJTZWFyY2hNb2RlbCB7XG5cdHJlc3VsdDogU3RyZWFtPFNlYXJjaFJlc3VsdCB8IG51bGw+XG5cdC8vIHdlIHN0b3JlIHRoaXMgYXMgYSByZWZlcmVuY2UgdG8gdGhlIGN1cnJlbnRseSBydW5uaW5nIHNlYXJjaC4gaWYgd2UgZG9uJ3QsIHdlIG9ubHkgaGF2ZSB0aGUgbGFzdCByZXN1bHQncyBxdWVyeSBpbmZvXG5cdC8vIHRvIGNvbXBhcmUgYWdhaW5zdCBpbmNvbWluZyBuZXcgcXVlcmllc1xuXHRsYXN0UXVlcnlTdHJpbmc6IFN0cmVhbTxzdHJpbmcgfCBudWxsPlxuXHRwcml2YXRlIGxhc3RRdWVyeTogU2VhcmNoUXVlcnkgfCBudWxsXG5cdHByaXZhdGUgbGFzdFNlYXJjaFByb21pc2U6IFByb21pc2U8U2VhcmNoUmVzdWx0IHwgdm9pZD5cblx0Y2FuY2VsU2lnbmFsOiBTdHJlYW08Ym9vbGVhbj5cblxuXHRjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGNhbGVuZGFyTW9kZWw6IGxhenlBc3luYzxDYWxlbmRhckV2ZW50c1JlcG9zaXRvcnk+KSB7XG5cdFx0dGhpcy5yZXN1bHQgPSBzdHJlYW0oKVxuXHRcdHRoaXMubGFzdFF1ZXJ5U3RyaW5nID0gc3RyZWFtPHN0cmluZyB8IG51bGw+KFwiXCIpXG5cdFx0dGhpcy5sYXN0UXVlcnkgPSBudWxsXG5cdFx0dGhpcy5sYXN0U2VhcmNoUHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSgpXG5cdFx0dGhpcy5jYW5jZWxTaWduYWwgPSBzdHJlYW0oZmFsc2UpXG5cdH1cblxuXHRhc3luYyBzZWFyY2goc2VhcmNoUXVlcnk6IFNlYXJjaFF1ZXJ5LCBwcm9ncmVzc1RyYWNrZXI6IFByb2dyZXNzVHJhY2tlcik6IFByb21pc2U8U2VhcmNoUmVzdWx0IHwgdm9pZD4ge1xuXHRcdGlmICh0aGlzLmxhc3RRdWVyeSAmJiBzZWFyY2hRdWVyeUVxdWFscyhzZWFyY2hRdWVyeSwgdGhpcy5sYXN0UXVlcnkpKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5sYXN0U2VhcmNoUHJvbWlzZVxuXHRcdH1cblxuXHRcdHRoaXMubGFzdFF1ZXJ5ID0gc2VhcmNoUXVlcnlcblx0XHRjb25zdCB7IHF1ZXJ5LCByZXN0cmljdGlvbiwgbWluU3VnZ2VzdGlvbkNvdW50LCBtYXhSZXN1bHRzIH0gPSBzZWFyY2hRdWVyeVxuXHRcdHRoaXMubGFzdFF1ZXJ5U3RyaW5nKHF1ZXJ5KVxuXHRcdGxldCByZXN1bHQgPSB0aGlzLnJlc3VsdCgpXG5cblx0XHRpZiAocmVzdWx0ICYmICFpc1NhbWVUeXBlUmVmKHJlc3RyaWN0aW9uLnR5cGUsIHJlc3VsdC5yZXN0cmljdGlvbi50eXBlKSkge1xuXHRcdFx0Ly8gcmVzZXQgdGhlIHJlc3VsdCBpbiBjYXNlIG9ubHkgdGhlIHNlYXJjaCB0eXBlIGhhcyBjaGFuZ2VkXG5cdFx0XHR0aGlzLnJlc3VsdChudWxsKVxuXHRcdH1cblxuXHRcdGlmIChxdWVyeS50cmltKCkgPT09IFwiXCIpIHtcblx0XHRcdC8vIGlmIHRoZXJlIHdhcyBhbiBlbXB0eSBxdWVyeSwganVzdCBzZW5kIGVtcHR5IHJlc3VsdFxuXHRcdFx0Y29uc3QgcmVzdWx0OiBTZWFyY2hSZXN1bHQgPSB7XG5cdFx0XHRcdHF1ZXJ5OiBxdWVyeSxcblx0XHRcdFx0cmVzdHJpY3Rpb246IHJlc3RyaWN0aW9uLFxuXHRcdFx0XHRyZXN1bHRzOiBbXSxcblx0XHRcdFx0Y3VycmVudEluZGV4VGltZXN0YW1wOiAwLFxuXHRcdFx0XHRsYXN0UmVhZFNlYXJjaEluZGV4Um93OiBbXSxcblx0XHRcdFx0bWF4UmVzdWx0czogMCxcblx0XHRcdFx0bWF0Y2hXb3JkT3JkZXI6IGZhbHNlLFxuXHRcdFx0XHRtb3JlUmVzdWx0czogW10sXG5cdFx0XHRcdG1vcmVSZXN1bHRzRW50cmllczogW10sXG5cdFx0XHR9XG5cdFx0XHR0aGlzLnJlc3VsdChyZXN1bHQpXG5cdFx0XHR0aGlzLmxhc3RTZWFyY2hQcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKHJlc3VsdClcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gd2UgaW50ZXJwcmV0IHJlc3RyaWN0aW9uLnN0YXJ0IGFzIHRoZSBzdGFydCBvZiB0aGUgZmlyc3QgZGF5IG9mIHRoZSBmaXJzdCBtb250aCB3ZSB3YW50IHRvIHNlYXJjaFxuXHRcdFx0Ly8gcmVzdHJpY3Rpb24uZW5kIGlzIHRoZSBlbmQgb2YgdGhlIGxhc3QgZGF5IG9mIHRoZSBsYXN0IG1vbnRoIHdlIHdhbnQgdG8gc2VhcmNoXG5cdFx0XHRsZXQgY3VycmVudERhdGUgPSBuZXcgRGF0ZShhc3NlcnROb3ROdWxsKHJlc3RyaWN0aW9uLnN0YXJ0KSlcblx0XHRcdGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZShhc3NlcnROb3ROdWxsKHJlc3RyaWN0aW9uLmVuZCkpXG5cdFx0XHRjb25zdCBjYWxlbmRhck1vZGVsID0gYXdhaXQgdGhpcy5jYWxlbmRhck1vZGVsKClcblx0XHRcdGNvbnN0IGRheXNJbk1vbnRoczogQXJyYXk8RGF0ZT4gPSBbXVxuXHRcdFx0d2hpbGUgKGN1cnJlbnREYXRlLmdldFRpbWUoKSA8PSBlbmREYXRlLmdldFRpbWUoKSkge1xuXHRcdFx0XHRkYXlzSW5Nb250aHMucHVzaChjdXJyZW50RGF0ZSlcblx0XHRcdFx0Y3VycmVudERhdGUgPSBpbmNyZW1lbnRNb250aChjdXJyZW50RGF0ZSwgMSlcblx0XHRcdH1cblxuXHRcdFx0Y29uc3QgY2FsZW5kYXJSZXN1bHQ6IFNlYXJjaFJlc3VsdCA9IHtcblx0XHRcdFx0Ly8gaW5kZXggcmVsYXRlZCwga2VlcCBlbXB0eVxuXHRcdFx0XHRjdXJyZW50SW5kZXhUaW1lc3RhbXA6IDAsXG5cdFx0XHRcdG1vcmVSZXN1bHRzOiBbXSxcblx0XHRcdFx0bW9yZVJlc3VsdHNFbnRyaWVzOiBbXSxcblx0XHRcdFx0bGFzdFJlYWRTZWFyY2hJbmRleFJvdzogW10sXG5cdFx0XHRcdC8vIGRhdGEgdGhhdCBpcyByZWxldmFudCB0byBjYWxlbmRhciBzZWFyY2hcblx0XHRcdFx0bWF0Y2hXb3JkT3JkZXI6IGZhbHNlLFxuXHRcdFx0XHRyZXN0cmljdGlvbixcblx0XHRcdFx0cmVzdWx0czogW10sXG5cdFx0XHRcdHF1ZXJ5LFxuXHRcdFx0fVxuXG5cdFx0XHRjb25zdCBtb25pdG9ySGFuZGxlID0gcHJvZ3Jlc3NUcmFja2VyLnJlZ2lzdGVyTW9uaXRvclN5bmMoZGF5c0luTW9udGhzLmxlbmd0aClcblx0XHRcdGNvbnN0IG1vbml0b3I6IElQcm9ncmVzc01vbml0b3IgPSBhc3NlcnROb3ROdWxsKHByb2dyZXNzVHJhY2tlci5nZXRNb25pdG9yKG1vbml0b3JIYW5kbGUpKVxuXG5cdFx0XHRpZiAodGhpcy5jYW5jZWxTaWduYWwoKSkge1xuXHRcdFx0XHR0aGlzLnJlc3VsdChjYWxlbmRhclJlc3VsdClcblx0XHRcdFx0dGhpcy5sYXN0U2VhcmNoUHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZShjYWxlbmRhclJlc3VsdClcblx0XHRcdFx0cmV0dXJuIHRoaXMubGFzdFNlYXJjaFByb21pc2Vcblx0XHRcdH1cblxuXHRcdFx0Y29uc3QgaGFzTmV3UGFpZFBsYW4gPSBhd2FpdCBjYWxlbmRhck1vZGVsLmNhbkxvYWRCaXJ0aGRheXNDYWxlbmRhcigpXG5cdFx0XHRpZiAoaGFzTmV3UGFpZFBsYW4pIHtcblx0XHRcdFx0YXdhaXQgY2FsZW5kYXJNb2RlbC5sb2FkQ29udGFjdHNCaXJ0aGRheXMoKVxuXHRcdFx0fVxuXG5cdFx0XHRhd2FpdCBjYWxlbmRhck1vZGVsLmxvYWRNb250aHNJZk5lZWRlZChkYXlzSW5Nb250aHMsIG1vbml0b3IsIHRoaXMuY2FuY2VsU2lnbmFsKVxuXHRcdFx0bW9uaXRvci5jb21wbGV0ZWQoKVxuXG5cdFx0XHRjb25zdCBldmVudHNGb3JEYXlzID0gY2FsZW5kYXJNb2RlbC5nZXRFdmVudHNGb3JNb250aHMoKSgpXG5cblx0XHRcdGFzc2VydE5vbk51bGwocmVzdHJpY3Rpb24uc3RhcnQpXG5cdFx0XHRhc3NlcnROb25OdWxsKHJlc3RyaWN0aW9uLmVuZClcblxuXHRcdFx0Y29uc3QgdG9rZW5zID0gdG9rZW5pemUocXVlcnkudHJpbSgpKVxuXHRcdFx0Ly8gd2Ugd2FudCBldmVudCBpbnN0YW5jZXMgdGhhdCBvY2N1ciBvbiBtdWx0aXBsZSBkYXlzIHRvIG9ubHkgYXBwZWFyIG9uY2UsIGJ1dCB3YW50XG5cdFx0XHQvLyBzZXBhcmF0ZSBpbnN0YW5jZXMgb2YgZXZlbnQgc2VyaWVzIHRvIG9jY3VyIG9uIHRoZWlyIG93bi5cblx0XHRcdGNvbnN0IGFscmVhZHlBZGRlZDogU2V0PHN0cmluZz4gPSBuZXcgU2V0KClcblxuXHRcdFx0aWYgKHRoaXMuY2FuY2VsU2lnbmFsKCkpIHtcblx0XHRcdFx0dGhpcy5yZXN1bHQoY2FsZW5kYXJSZXN1bHQpXG5cdFx0XHRcdHRoaXMubGFzdFNlYXJjaFByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoY2FsZW5kYXJSZXN1bHQpXG5cdFx0XHRcdHJldHVybiB0aGlzLmxhc3RTZWFyY2hQcm9taXNlXG5cdFx0XHR9XG5cblx0XHRcdGNvbnN0IGZvbGxvd0NvbW1vblJlc3RyaWN0aW9ucyA9IChrZXk6IHN0cmluZywgZXZlbnQ6IENhbGVuZGFyRXZlbnQpID0+IHtcblx0XHRcdFx0aWYgKGFscmVhZHlBZGRlZC5oYXMoa2V5KSkge1xuXHRcdFx0XHRcdC8vIHdlIG9ubHkgbmVlZCB0aGUgZmlyc3QgZXZlbnQgaW4gdGhlIHNlcmllcywgdGhlIHZpZXcgd2lsbCBsb2FkICYgdGhlbiBnZW5lcmF0ZVxuXHRcdFx0XHRcdC8vIHRoZSBzZXJpZXMgZm9yIHRoZSBzZWFyY2hlZCB0aW1lIHJhbmdlLlxuXHRcdFx0XHRcdHJldHVybiBmYWxzZVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHJlc3RyaWN0aW9uLmZvbGRlcklkcy5sZW5ndGggPiAwICYmICFyZXN0cmljdGlvbi5mb2xkZXJJZHMuaW5jbHVkZXMobGlzdElkUGFydChldmVudC5faWQpKSkge1xuXHRcdFx0XHRcdC8vIGNoZWNrIHRoYXQgdGhlIGV2ZW50IGlzIGluIHRoZSBzZWFyY2hlZCBjYWxlbmRhci5cblx0XHRcdFx0XHRyZXR1cm4gZmFsc2Vcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChyZXN0cmljdGlvbi5ldmVudFNlcmllcyA9PT0gZmFsc2UgJiYgZXZlbnQucmVwZWF0UnVsZSAhPSBudWxsKSB7XG5cdFx0XHRcdFx0Ly8gYXBwbGllZCBcInJlcGVhdGluZ1wiIHNlYXJjaCBmaWx0ZXJcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2Vcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB0cnVlXG5cdFx0XHR9XG5cblx0XHRcdGlmICh0b2tlbnMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHQvLyB3ZSdyZSBpdGVyYXRpbmcgYnkgZXZlbnQgZmlyc3QgdG8gb25seSBoYXZlIHRvIHNhbml0aXplIHRoZSBkZXNjcmlwdGlvbiBvbmNlLlxuXHRcdFx0XHQvLyB0aGF0J3MgYSBzbWFsbGVyIHNhdmluZ3MgdGhhbiBvbmUgbWlnaHQgdGhpbmsgYmVjYXVzZSBmb3IgdGhlIHZhc3QgbWFqb3JpdHkgb2Zcblx0XHRcdFx0Ly8gZXZlbnRzIHdlJ3JlIHByb2JhYmx5IG5vdCBtYXRjaGluZyBhbmQgbG9va2luZyBpbnRvIHRoZSBkZXNjcmlwdGlvbiBhbnl3YXkuXG5cdFx0XHRcdGZvciAoY29uc3QgW3N0YXJ0T2ZEYXksIGV2ZW50c09uRGF5XSBvZiBldmVudHNGb3JEYXlzKSB7XG5cdFx0XHRcdFx0ZXZlbnRMb29wOiBmb3IgKGNvbnN0IGV2ZW50IG9mIGV2ZW50c09uRGF5KSB7XG5cdFx0XHRcdFx0XHRpZiAoIShzdGFydE9mRGF5ID49IHJlc3RyaWN0aW9uLnN0YXJ0ICYmIHN0YXJ0T2ZEYXkgPD0gcmVzdHJpY3Rpb24uZW5kKSkge1xuXHRcdFx0XHRcdFx0XHRjb250aW51ZVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRjb25zdCBrZXkgPSBpZFRvS2V5KGV2ZW50Ll9pZClcblxuXHRcdFx0XHRcdFx0aWYgKCFmb2xsb3dDb21tb25SZXN0cmljdGlvbnMoa2V5LCBldmVudCkpIHtcblx0XHRcdFx0XHRcdFx0Y29udGludWVcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0Zm9yIChjb25zdCB0b2tlbiBvZiB0b2tlbnMpIHtcblx0XHRcdFx0XHRcdFx0aWYgKGV2ZW50LnN1bW1hcnkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0b2tlbikpIHtcblx0XHRcdFx0XHRcdFx0XHRhbHJlYWR5QWRkZWQuYWRkKGtleSlcblx0XHRcdFx0XHRcdFx0XHRjYWxlbmRhclJlc3VsdC5yZXN1bHRzLnB1c2goZXZlbnQuX2lkKVxuXHRcdFx0XHRcdFx0XHRcdGNvbnRpbnVlIGV2ZW50TG9vcFxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIGNoZWNraW5nIHRoZSBzdW1tYXJ5IHdhcyBjaGVhcCwgbm93IHdlIHN0b3JlIHRoZSBzYW5pdGl6ZWQgZGVzY3JpcHRpb24gdG8gY2hlY2sgaXQgYWdhaW5zdFxuXHRcdFx0XHRcdFx0Ly8gYWxsIHRva2Vucy5cblx0XHRcdFx0XHRcdGNvbnN0IGRlc2NyaXB0aW9uVG9TZWFyY2ggPSBldmVudC5kZXNjcmlwdGlvbi5yZXBsYWNlQWxsKC8oPFtePl0rPikvZ2ksIFwiIFwiKS50b0xvd2VyQ2FzZSgpXG5cdFx0XHRcdFx0XHRmb3IgKGNvbnN0IHRva2VuIG9mIHRva2Vucykge1xuXHRcdFx0XHRcdFx0XHRpZiAoZGVzY3JpcHRpb25Ub1NlYXJjaC5pbmNsdWRlcyh0b2tlbikpIHtcblx0XHRcdFx0XHRcdFx0XHRhbHJlYWR5QWRkZWQuYWRkKGtleSlcblx0XHRcdFx0XHRcdFx0XHRjYWxlbmRhclJlc3VsdC5yZXN1bHRzLnB1c2goZXZlbnQuX2lkKVxuXHRcdFx0XHRcdFx0XHRcdGNvbnRpbnVlIGV2ZW50TG9vcFxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmICh0aGlzLmNhbmNlbFNpZ25hbCgpKSB7XG5cdFx0XHRcdFx0XHRcdHRoaXMucmVzdWx0KGNhbGVuZGFyUmVzdWx0KVxuXHRcdFx0XHRcdFx0XHR0aGlzLmxhc3RTZWFyY2hQcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKGNhbGVuZGFyUmVzdWx0KVxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdGhpcy5sYXN0U2VhcmNoUHJvbWlzZVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKHJlc3RyaWN0aW9uLnN0YXJ0KVxuXHRcdFx0XHRjb25zdCBlbmREYXRlID0gbmV3IERhdGUocmVzdHJpY3Rpb24uZW5kKVxuXG5cdFx0XHRcdGlmIChoYXNOZXdQYWlkUGxhbikge1xuXHRcdFx0XHRcdGNvbnN0IGJpcnRoZGF5RXZlbnRzID0gQXJyYXkuZnJvbShjYWxlbmRhck1vZGVsLmdldEJpcnRoZGF5RXZlbnRzKCkudmFsdWVzKCkpLmZsYXQoKVxuXG5cdFx0XHRcdFx0ZXZlbnRMb29wOiBmb3IgKGNvbnN0IGV2ZW50UmVnaXN0cnkgb2YgYmlydGhkYXlFdmVudHMpIHtcblx0XHRcdFx0XHRcdC8vIEJpcnRoZGF5cyBzaG91bGQgc3RpbGwgYXBwZWFyIG9uIHNlYXJjaCBldmVuIGlmIHRoZSBkYXRlIGl0c2VsZiBkb2Vzbid0IGNvbXBseSB0byB0aGUgd2hvbGUgcmVzdHJpY3Rpb25cblx0XHRcdFx0XHRcdC8vIHdlIG9ubHkgY2FyZSBhYm91dCBtb250aHNcblx0XHRcdFx0XHRcdGNvbnN0IG1vbnRoID0gZXZlbnRSZWdpc3RyeS5ldmVudC5zdGFydFRpbWUuZ2V0TW9udGgoKVxuXHRcdFx0XHRcdFx0aWYgKCEobW9udGggPj0gc3RhcnREYXRlLmdldE1vbnRoKCkgJiYgbW9udGggPD0gZW5kRGF0ZS5nZXRNb250aCgpKSkge1xuXHRcdFx0XHRcdFx0XHRjb250aW51ZVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRjb25zdCBrZXkgPSBpZFRvS2V5KGV2ZW50UmVnaXN0cnkuZXZlbnQuX2lkKVxuXG5cdFx0XHRcdFx0XHRpZiAoIWZvbGxvd0NvbW1vblJlc3RyaWN0aW9ucyhrZXksIGV2ZW50UmVnaXN0cnkuZXZlbnQpKSB7XG5cdFx0XHRcdFx0XHRcdGNvbnRpbnVlXG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGZvciAoY29uc3QgdG9rZW4gb2YgdG9rZW5zKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChldmVudFJlZ2lzdHJ5LmV2ZW50LnN1bW1hcnkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0b2tlbikpIHtcblx0XHRcdFx0XHRcdFx0XHRhbHJlYWR5QWRkZWQuYWRkKGtleSlcblx0XHRcdFx0XHRcdFx0XHRjYWxlbmRhclJlc3VsdC5yZXN1bHRzLnB1c2goZXZlbnRSZWdpc3RyeS5ldmVudC5faWQpXG5cdFx0XHRcdFx0XHRcdFx0Y29udGludWUgZXZlbnRMb29wXG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKHRoaXMuY2FuY2VsU2lnbmFsKCkpIHtcblx0XHRcdFx0XHRcdFx0dGhpcy5yZXN1bHQoY2FsZW5kYXJSZXN1bHQpXG5cdFx0XHRcdFx0XHRcdHRoaXMubGFzdFNlYXJjaFByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoY2FsZW5kYXJSZXN1bHQpXG5cdFx0XHRcdFx0XHRcdHJldHVybiB0aGlzLmxhc3RTZWFyY2hQcm9taXNlXG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMucmVzdWx0KGNhbGVuZGFyUmVzdWx0KVxuXHRcdFx0dGhpcy5sYXN0U2VhcmNoUHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZShjYWxlbmRhclJlc3VsdClcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5sYXN0U2VhcmNoUHJvbWlzZVxuXHR9XG5cblx0aXNOZXdTZWFyY2gocXVlcnk6IHN0cmluZywgcmVzdHJpY3Rpb246IFNlYXJjaFJlc3RyaWN0aW9uKTogYm9vbGVhbiB7XG5cdFx0bGV0IGlzTmV3ID0gZmFsc2Vcblx0XHRsZXQgbGFzdFF1ZXJ5ID0gdGhpcy5sYXN0UXVlcnlcblx0XHRpZiAobGFzdFF1ZXJ5ID09IG51bGwpIHtcblx0XHRcdGlzTmV3ID0gdHJ1ZVxuXHRcdH0gZWxzZSBpZiAobGFzdFF1ZXJ5LnF1ZXJ5ICE9PSBxdWVyeSkge1xuXHRcdFx0aXNOZXcgPSB0cnVlXG5cdFx0fSBlbHNlIGlmIChsYXN0UXVlcnkucmVzdHJpY3Rpb24gIT09IHJlc3RyaWN0aW9uKSB7XG5cdFx0XHQvLyBib3RoIGFyZSB0aGUgc2FtZSBpbnN0YW5jZVxuXHRcdFx0aXNOZXcgPSAhaXNTYW1lU2VhcmNoUmVzdHJpY3Rpb24ocmVzdHJpY3Rpb24sIGxhc3RRdWVyeS5yZXN0cmljdGlvbilcblx0XHR9XG5cblx0XHRpZiAoaXNOZXcpIHRoaXMuc2VuZENhbmNlbFNpZ25hbCgpXG5cdFx0cmV0dXJuIGlzTmV3XG5cdH1cblxuXHRzZW5kQ2FuY2VsU2lnbmFsKCkge1xuXHRcdHRoaXMuY2FuY2VsU2lnbmFsKHRydWUpXG5cdFx0dGhpcy5jYW5jZWxTaWduYWwuZW5kKHRydWUpXG5cdFx0dGhpcy5jYW5jZWxTaWduYWwgPSBzdHJlYW0oZmFsc2UpXG5cdH1cbn1cblxuZnVuY3Rpb24gaWRUb0tleShpZDogSWRUdXBsZSk6IHN0cmluZyB7XG5cdHJldHVybiBpZC5qb2luKFwiL1wiKVxufVxuXG5mdW5jdGlvbiBzZWFyY2hRdWVyeUVxdWFscyhhOiBTZWFyY2hRdWVyeSwgYjogU2VhcmNoUXVlcnkpIHtcblx0cmV0dXJuIChcblx0XHRhLnF1ZXJ5ID09PSBiLnF1ZXJ5ICYmXG5cdFx0aXNTYW1lU2VhcmNoUmVzdHJpY3Rpb24oYS5yZXN0cmljdGlvbiwgYi5yZXN0cmljdGlvbikgJiZcblx0XHRhLm1pblN1Z2dlc3Rpb25Db3VudCA9PT0gYi5taW5TdWdnZXN0aW9uQ291bnQgJiZcblx0XHRhLm1heFJlc3VsdHMgPT09IGIubWF4UmVzdWx0c1xuXHQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1NhbWVTZWFyY2hSZXN0cmljdGlvbihhOiBTZWFyY2hSZXN0cmljdGlvbiwgYjogU2VhcmNoUmVzdHJpY3Rpb24pOiBib29sZWFuIHtcblx0Y29uc3QgaXNTYW1lQXR0cmlidXRlSWRzID0gYS5hdHRyaWJ1dGVJZHMgPT09IGIuYXR0cmlidXRlSWRzIHx8ICghIWEuYXR0cmlidXRlSWRzICYmICEhYi5hdHRyaWJ1dGVJZHMgJiYgYXJyYXlFcXVhbHMoYS5hdHRyaWJ1dGVJZHMsIGIuYXR0cmlidXRlSWRzKSlcblx0cmV0dXJuIChcblx0XHRpc1NhbWVUeXBlUmVmKGEudHlwZSwgYi50eXBlKSAmJlxuXHRcdGEuc3RhcnQgPT09IGIuc3RhcnQgJiZcblx0XHRhLmVuZCA9PT0gYi5lbmQgJiZcblx0XHRpc1NhbWVBdHRyaWJ1dGVJZHMgJiZcblx0XHQoYS5ldmVudFNlcmllcyA9PT0gYi5ldmVudFNlcmllcyB8fCAoYS5ldmVudFNlcmllcyA9PT0gbnVsbCAmJiBiLmV2ZW50U2VyaWVzID09PSB0cnVlKSB8fCAoYS5ldmVudFNlcmllcyA9PT0gdHJ1ZSAmJiBiLmV2ZW50U2VyaWVzID09PSBudWxsKSkgJiZcblx0XHRhcnJheUVxdWFscyhhLmZvbGRlcklkcywgYi5mb2xkZXJJZHMpXG5cdClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFyZVJlc3VsdHNGb3JUaGVTYW1lUXVlcnkoYTogU2VhcmNoUmVzdWx0LCBiOiBTZWFyY2hSZXN1bHQpIHtcblx0cmV0dXJuIGEucXVlcnkgPT09IGIucXVlcnkgJiYgaXNTYW1lU2VhcmNoUmVzdHJpY3Rpb24oYS5yZXN0cmljdGlvbiwgYi5yZXN0cmljdGlvbilcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhc01vcmVSZXN1bHRzKHNlYXJjaFJlc3VsdDogU2VhcmNoUmVzdWx0KTogYm9vbGVhbiB7XG5cdHJldHVybiAoXG5cdFx0c2VhcmNoUmVzdWx0Lm1vcmVSZXN1bHRzLmxlbmd0aCA+IDAgfHxcblx0XHQoc2VhcmNoUmVzdWx0Lmxhc3RSZWFkU2VhcmNoSW5kZXhSb3cubGVuZ3RoID4gMCAmJiBzZWFyY2hSZXN1bHQubGFzdFJlYWRTZWFyY2hJbmRleFJvdy5ldmVyeSgoW3dvcmQsIGlkXSkgPT4gaWQgIT09IDApKVxuXHQpXG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBV0Esa0JBQWtCO0lBUUwsc0JB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