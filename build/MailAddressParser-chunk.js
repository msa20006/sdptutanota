import { isMailAddress } from "./FormatValidator-chunk.js";
import { convertTextToHtml } from "./Formatter-chunk.js";

//#region src/common/misc/parsing/MailAddressParser.ts
function parseMailtoUrl(mailtoUrl) {
	let url = new URL(mailtoUrl);
	const createMailAddressFromString = (address) => {
		const nameAndMailAddress = stringToNameAndMailAddress(address);
		if (!nameAndMailAddress) return null;
		return {
			name: nameAndMailAddress.name,
			address: nameAndMailAddress.mailAddress
		};
	};
	const addresses = url.pathname.split(",").map((address) => {
		if (!address) return null;
		const decodedAddress = decodeURIComponent(address);
		if (!decodedAddress) return null;
		return createMailAddressFromString(decodedAddress);
	}).filter(Boolean);
	const result = {
		recipients: {
			to: addresses.length > 0 ? addresses : undefined,
			cc: undefined,
			bcc: undefined
		},
		attach: null,
		subject: null,
		body: null
	};
	if (!url.searchParams || typeof url.searchParams.entries !== "function") return result;
	for (let pair of url.searchParams.entries()) {
		let paramName = pair[0].toLowerCase();
		let paramValue = pair[1];
		switch (paramName) {
			case "subject":
				result.subject = paramValue;
				break;
			case "body":
				result.body = convertTextToHtml(paramValue);
				break;
			case "to":
			case "cc":
			case "bcc": {
				if (result.recipients[paramName] == null) result.recipients[paramName] = [];
				const nextAddresses = paramValue.split(",").map((address) => createMailAddressFromString(address)).filter(Boolean);
				result.recipients[paramName].push(...nextAddresses);
				break;
			}
			case "attach":
				if (result.attach == null) result.attach = [];
				result.attach.push(paramValue);
				break;
			default: console.warn("unexpected mailto param, ignoring");
		}
	}
	return result;
}
function stringToNameAndMailAddress(string) {
	string = string.trim();
	if (string === "") return null;
	let startIndex = string.indexOf("<");
	if (startIndex !== -1) {
		const endIndex = string.indexOf(">", startIndex);
		if (endIndex === -1) return null;
		const cleanedMailAddress = getCleanedMailAddress(string.substring(startIndex + 1, endIndex));
		if (cleanedMailAddress == null || !isMailAddress(cleanedMailAddress, false)) return null;
		const name = string.substring(0, startIndex).trim();
		return {
			name,
			mailAddress: cleanedMailAddress
		};
	} else {
		startIndex = string.lastIndexOf(" ");
		startIndex++;
		const cleanedMailAddress = getCleanedMailAddress(string.substring(startIndex));
		if (cleanedMailAddress == null || !isMailAddress(cleanedMailAddress, false)) return null;
		const name = string.substring(0, startIndex).trim();
		return {
			name,
			mailAddress: cleanedMailAddress
		};
	}
}
function getCleanedMailAddress(mailAddress) {
	const cleanedMailAddress = mailAddress.toLowerCase().trim();
	if (isMailAddress(cleanedMailAddress, false)) return cleanedMailAddress;
	return null;
}
function getDomainPart(mailAddress) {
	const cleanedMailAddress = getCleanedMailAddress(mailAddress);
	if (cleanedMailAddress) {
		const parts = mailAddress.split("@");
		if (parts.length === 2) return parts[1];
else return null;
	} else return null;
}
function fullNameToFirstAndLastName(fullName) {
	fullName = fullName.trim();
	if (fullName === "") return {
		firstName: "",
		lastName: ""
	};
	const separator = fullName.indexOf(" ");
	if (separator !== -1) return {
		firstName: fullName.substring(0, separator),
		lastName: fullName.substring(separator + 1)
	};
else return {
		firstName: fullName,
		lastName: ""
	};
}
function mailAddressToFirstAndLastName(mailAddress) {
	const addr = mailAddress.substring(0, mailAddress.indexOf("@"));
	let nameData;
	if (addr.indexOf(".") !== -1) nameData = addr.split(".");
else if (addr.indexOf("_") !== -1) nameData = addr.split("_");
else if (addr.indexOf("-") !== -1) nameData = addr.split("-");
else nameData = [addr];
	for (let i = 0; i < nameData.length; i++) if (nameData[i].length > 0) nameData[i] = nameData[i].substring(0, 1).toUpperCase() + nameData[i].substring(1);
	return {
		firstName: nameData[0],
		lastName: nameData.slice(1).join(" ")
	};
}

//#endregion
export { fullNameToFirstAndLastName, getCleanedMailAddress, getDomainPart, mailAddressToFirstAndLastName, parseMailtoUrl, stringToNameAndMailAddress };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFpbEFkZHJlc3NQYXJzZXItY2h1bmsuanMiLCJuYW1lcyI6WyJtYWlsdG9Vcmw6IHN0cmluZyIsImFkZHJlc3M6IHN0cmluZyIsInJlc3VsdDogYW55Iiwic3RyaW5nOiBzdHJpbmciLCJtYWlsQWRkcmVzczogc3RyaW5nIiwiZnVsbE5hbWU6IHN0cmluZyJdLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21tb24vbWlzYy9wYXJzaW5nL01haWxBZGRyZXNzUGFyc2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGlzTWFpbEFkZHJlc3MgfSBmcm9tIFwiLi4vRm9ybWF0VmFsaWRhdG9yXCJcbmltcG9ydCB7IFBhcnRpYWxSZWNpcGllbnQgfSBmcm9tIFwiLi4vLi4vYXBpL2NvbW1vbi9yZWNpcGllbnRzL1JlY2lwaWVudFwiXG5pbXBvcnQgeyBjb252ZXJ0VGV4dFRvSHRtbCB9IGZyb20gXCIuLi9Gb3JtYXR0ZXIuanNcIlxuXG5leHBvcnQgdHlwZSBQYXJzZWRNYWlsdG8gPSB7XG5cdHJlY2lwaWVudHM6IHtcblx0XHR0bz86IFBhcnRpYWxSZWNpcGllbnRbXVxuXHRcdGNjPzogUGFydGlhbFJlY2lwaWVudFtdXG5cdFx0YmNjPzogUGFydGlhbFJlY2lwaWVudFtdXG5cdH1cblx0c3ViamVjdDogc3RyaW5nIHwgbnVsbFxuXHRib2R5OiBzdHJpbmcgfCBudWxsXG5cdGF0dGFjaDogQXJyYXk8c3RyaW5nPiB8IG51bGxcbn1cblxuLyoqXG4gKiB0YWtlcyBhIFVSTCBvZiB0aGUgZm9ybSBtYWlsdG86YUBiLmM/Ym9keT1oZWxsbyUyMHdvcmxkJmF0dGFjaD1maWxlOi8vL2hvbWUvdXNlci9jdXRlJTIwY2F0LmpwZyZhdHRhY2g9ZmlsZTovLy9ob21lL3VzZXIvdWdseSUyMGRvZy5qcGdcbiAqIGFuZCByZXR1cm5zIGFuIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHN0cnVjdHVyZWQgaW5mb3JtYXRpb24gdGhhdCBzaG91bGQgYmUgcGFzc2VkIHRvIHRoZSBtYWlsIGVkaXRvciBmb3IgdGhpcyBVUkxcbiAqXG4gKiBpZiBhIHBhcmFtIGlzIG5vdCBnaXZlbiwgaXQgaXMgc2V0IHRvIG51bGwuIGlmIGl0IGlzIGdpdmVuLCBidXQgZW1wdHksIGl0IHdpbGwgYmUgc2V0IHRvIGFuIGVtcHR5IHN0cmluZy9hcnJheS5cbiAqXG4gKiBAcGFyYW0gbWFpbHRvVXJsIHtzdHJpbmd9XG4gKiBAcmV0dXJucyB7UGFyc2VkTWFpbHRvfVxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VNYWlsdG9VcmwobWFpbHRvVXJsOiBzdHJpbmcpOiBQYXJzZWRNYWlsdG8ge1xuXHRsZXQgdXJsID0gbmV3IFVSTChtYWlsdG9VcmwpXG5cblx0Y29uc3QgY3JlYXRlTWFpbEFkZHJlc3NGcm9tU3RyaW5nID0gKGFkZHJlc3M6IHN0cmluZyk6IFBhcnRpYWxSZWNpcGllbnQgfCBudWxsID0+IHtcblx0XHRjb25zdCBuYW1lQW5kTWFpbEFkZHJlc3MgPSBzdHJpbmdUb05hbWVBbmRNYWlsQWRkcmVzcyhhZGRyZXNzKVxuXHRcdGlmICghbmFtZUFuZE1haWxBZGRyZXNzKSByZXR1cm4gbnVsbFxuXHRcdHJldHVybiB7XG5cdFx0XHRuYW1lOiBuYW1lQW5kTWFpbEFkZHJlc3MubmFtZSxcblx0XHRcdGFkZHJlc3M6IG5hbWVBbmRNYWlsQWRkcmVzcy5tYWlsQWRkcmVzcyxcblx0XHR9XG5cdH1cblxuXHRjb25zdCBhZGRyZXNzZXMgPSB1cmwucGF0aG5hbWVcblx0XHQuc3BsaXQoXCIsXCIpXG5cdFx0Lm1hcCgoYWRkcmVzcykgPT4ge1xuXHRcdFx0aWYgKCFhZGRyZXNzKSByZXR1cm4gbnVsbFxuXHRcdFx0Y29uc3QgZGVjb2RlZEFkZHJlc3MgPSBkZWNvZGVVUklDb21wb25lbnQoYWRkcmVzcylcblx0XHRcdGlmICghZGVjb2RlZEFkZHJlc3MpIHJldHVybiBudWxsXG5cdFx0XHRyZXR1cm4gY3JlYXRlTWFpbEFkZHJlc3NGcm9tU3RyaW5nKGRlY29kZWRBZGRyZXNzKVxuXHRcdH0pXG5cdFx0LmZpbHRlcihCb29sZWFuKVxuXHRjb25zdCByZXN1bHQ6IGFueSA9IHtcblx0XHRyZWNpcGllbnRzOiB7XG5cdFx0XHR0bzogYWRkcmVzc2VzLmxlbmd0aCA+IDAgPyBhZGRyZXNzZXMgOiB1bmRlZmluZWQsXG5cdFx0XHRjYzogdW5kZWZpbmVkLFxuXHRcdFx0YmNjOiB1bmRlZmluZWQsXG5cdFx0fSxcblx0XHRhdHRhY2g6IG51bGwsXG5cdFx0c3ViamVjdDogbnVsbCxcblx0XHRib2R5OiBudWxsLFxuXHR9XG5cdC8vIEB0cy1pZ25vcmUgTWlzc2luZyBkZWZpbml0aW9uXG5cdGlmICghdXJsLnNlYXJjaFBhcmFtcyB8fCB0eXBlb2YgdXJsLnNlYXJjaFBhcmFtcy5lbnRyaWVzICE9PSBcImZ1bmN0aW9uXCIpIHJldHVybiByZXN1bHRcblxuXHQvLyBAdHMtaWdub3JlXG5cdGZvciAobGV0IHBhaXIgb2YgdXJsLnNlYXJjaFBhcmFtcy5lbnRyaWVzKCkpIHtcblx0XHRsZXQgcGFyYW1OYW1lID0gcGFpclswXS50b0xvd2VyQ2FzZSgpXG5cdFx0bGV0IHBhcmFtVmFsdWUgPSBwYWlyWzFdXG5cblx0XHRzd2l0Y2ggKHBhcmFtTmFtZSkge1xuXHRcdFx0Y2FzZSBcInN1YmplY3RcIjpcblx0XHRcdFx0cmVzdWx0LnN1YmplY3QgPSBwYXJhbVZhbHVlXG5cdFx0XHRcdGJyZWFrXG5cblx0XHRcdGNhc2UgXCJib2R5XCI6XG5cdFx0XHRcdHJlc3VsdC5ib2R5ID0gY29udmVydFRleHRUb0h0bWwocGFyYW1WYWx1ZSlcblx0XHRcdFx0YnJlYWtcblxuXHRcdFx0Y2FzZSBcInRvXCI6XG5cdFx0XHRjYXNlIFwiY2NcIjpcblx0XHRcdGNhc2UgXCJiY2NcIjoge1xuXHRcdFx0XHRpZiAocmVzdWx0LnJlY2lwaWVudHNbcGFyYW1OYW1lXSA9PSBudWxsKSByZXN1bHQucmVjaXBpZW50c1twYXJhbU5hbWVdID0gW11cblx0XHRcdFx0Y29uc3QgbmV4dEFkZHJlc3NlcyA9IHBhcmFtVmFsdWVcblx0XHRcdFx0XHQuc3BsaXQoXCIsXCIpXG5cdFx0XHRcdFx0Lm1hcCgoYWRkcmVzczogc3RyaW5nKSA9PiBjcmVhdGVNYWlsQWRkcmVzc0Zyb21TdHJpbmcoYWRkcmVzcykpXG5cdFx0XHRcdFx0LmZpbHRlcihCb29sZWFuKVxuXHRcdFx0XHRyZXN1bHQucmVjaXBpZW50c1twYXJhbU5hbWVdLnB1c2goLi4ubmV4dEFkZHJlc3Nlcylcblx0XHRcdFx0YnJlYWtcblx0XHRcdH1cblxuXHRcdFx0Y2FzZSBcImF0dGFjaFwiOlxuXHRcdFx0XHRpZiAocmVzdWx0LmF0dGFjaCA9PSBudWxsKSByZXN1bHQuYXR0YWNoID0gW11cblx0XHRcdFx0cmVzdWx0LmF0dGFjaC5wdXNoKHBhcmFtVmFsdWUpXG5cdFx0XHRcdGJyZWFrXG5cblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdGNvbnNvbGUud2FybihcInVuZXhwZWN0ZWQgbWFpbHRvIHBhcmFtLCBpZ25vcmluZ1wiKVxuXHRcdH1cblx0fVxuXG5cdHJldHVybiByZXN1bHRcbn1cblxuLyoqXG4gKiBQYXJzZXMgdGhlIGdpdmVuIHN0cmluZyBmb3IgYSBuYW1lIGFuZCBtYWlsIGFkZHJlc3MuIFRoZSBmb2xsb3dpbmcgZm9ybWF0cyBhcmUgcmVjb2duaXplZDogW25hbWVdWzxdbWFpbEFkZHJlc3NbPl1cbiAqIEFkZGl0aW9uYWxseSwgd2hpdGVzcGFjZXMgYXQgYW55IHBvc2l0aW9ucyBvdXRzaWRlIG5hbWUgYW5kIG1haWxBZGRyZXNzIGFyZSBpZ25vcmVkLlxuICogQHBhcmFtIHN0cmluZyBUaGUgc3RyaW5nIHRvIGNoZWNrLlxuICogQHJldHVybiBhbiBvYmplY3Qgd2l0aCB0aGUgYXR0cmlidXRlcyBcIm5hbWVcIiBhbmQgXCJtYWlsQWRkcmVzc1wiIG9yIG51bGwgaWYgbm90aGluZyB3YXMgZm91bmQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzdHJpbmdUb05hbWVBbmRNYWlsQWRkcmVzcyhzdHJpbmc6IHN0cmluZyk6XG5cdHwge1xuXHRcdFx0bmFtZTogc3RyaW5nXG5cdFx0XHRtYWlsQWRkcmVzczogc3RyaW5nXG5cdCAgfVxuXHR8IG51bGxcblx0fCB1bmRlZmluZWQge1xuXHRzdHJpbmcgPSBzdHJpbmcudHJpbSgpXG5cblx0aWYgKHN0cmluZyA9PT0gXCJcIikge1xuXHRcdHJldHVybiBudWxsXG5cdH1cblxuXHRsZXQgc3RhcnRJbmRleCA9IHN0cmluZy5pbmRleE9mKFwiPFwiKVxuXG5cdGlmIChzdGFydEluZGV4ICE9PSAtMSkge1xuXHRcdGNvbnN0IGVuZEluZGV4ID0gc3RyaW5nLmluZGV4T2YoXCI+XCIsIHN0YXJ0SW5kZXgpXG5cblx0XHRpZiAoZW5kSW5kZXggPT09IC0xKSB7XG5cdFx0XHRyZXR1cm4gbnVsbFxuXHRcdH1cblxuXHRcdGNvbnN0IGNsZWFuZWRNYWlsQWRkcmVzcyA9IGdldENsZWFuZWRNYWlsQWRkcmVzcyhzdHJpbmcuc3Vic3RyaW5nKHN0YXJ0SW5kZXggKyAxLCBlbmRJbmRleCkpXG5cblx0XHRpZiAoY2xlYW5lZE1haWxBZGRyZXNzID09IG51bGwgfHwgIWlzTWFpbEFkZHJlc3MoY2xlYW5lZE1haWxBZGRyZXNzLCBmYWxzZSkpIHtcblx0XHRcdHJldHVybiBudWxsXG5cdFx0fVxuXG5cdFx0Y29uc3QgbmFtZSA9IHN0cmluZy5zdWJzdHJpbmcoMCwgc3RhcnRJbmRleCkudHJpbSgpXG5cdFx0cmV0dXJuIHtcblx0XHRcdG5hbWU6IG5hbWUsXG5cdFx0XHRtYWlsQWRkcmVzczogY2xlYW5lZE1haWxBZGRyZXNzLFxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHRzdGFydEluZGV4ID0gc3RyaW5nLmxhc3RJbmRleE9mKFwiIFwiKVxuXHRcdHN0YXJ0SW5kZXgrK1xuXHRcdGNvbnN0IGNsZWFuZWRNYWlsQWRkcmVzcyA9IGdldENsZWFuZWRNYWlsQWRkcmVzcyhzdHJpbmcuc3Vic3RyaW5nKHN0YXJ0SW5kZXgpKVxuXG5cdFx0aWYgKGNsZWFuZWRNYWlsQWRkcmVzcyA9PSBudWxsIHx8ICFpc01haWxBZGRyZXNzKGNsZWFuZWRNYWlsQWRkcmVzcywgZmFsc2UpKSB7XG5cdFx0XHRyZXR1cm4gbnVsbFxuXHRcdH1cblxuXHRcdGNvbnN0IG5hbWUgPSBzdHJpbmcuc3Vic3RyaW5nKDAsIHN0YXJ0SW5kZXgpLnRyaW0oKVxuXHRcdHJldHVybiB7XG5cdFx0XHRuYW1lOiBuYW1lLFxuXHRcdFx0bWFpbEFkZHJlc3M6IGNsZWFuZWRNYWlsQWRkcmVzcyxcblx0XHR9XG5cdH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgY2xlYW5lZCBtYWlsIGFkZHJlc3MgZnJvbSB0aGUgaW5wdXQgbWFpbCBhZGRyZXNzLiBSZW1vdmVzIGxlYWRpbmcgb3IgdHJhaWxpbmcgd2hpdGVzcGFjZXMgYW5kIGNvbnZlcnRlcnNcbiAqIHRoZSBhZGRyZXNzIHRvIGxvd2VyIGNhc2UuXG4gKiBAcGFyYW0gbWFpbEFkZHJlc3MgVGhlIGlucHV0IG1haWwgYWRkcmVzcy5cbiAqIEByZXR1cm4gVGhlIGNsZWFuZWQgbWFpbCBhZGRyZXNzLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2xlYW5lZE1haWxBZGRyZXNzKG1haWxBZGRyZXNzOiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsIHtcblx0Y29uc3QgY2xlYW5lZE1haWxBZGRyZXNzID0gbWFpbEFkZHJlc3MudG9Mb3dlckNhc2UoKS50cmltKClcblxuXHRpZiAoaXNNYWlsQWRkcmVzcyhjbGVhbmVkTWFpbEFkZHJlc3MsIGZhbHNlKSkge1xuXHRcdHJldHVybiBjbGVhbmVkTWFpbEFkZHJlc3Ncblx0fVxuXG5cdHJldHVybiBudWxsXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREb21haW5QYXJ0KG1haWxBZGRyZXNzOiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsIHtcblx0Y29uc3QgY2xlYW5lZE1haWxBZGRyZXNzID0gZ2V0Q2xlYW5lZE1haWxBZGRyZXNzKG1haWxBZGRyZXNzKVxuXG5cdGlmIChjbGVhbmVkTWFpbEFkZHJlc3MpIHtcblx0XHRjb25zdCBwYXJ0cyA9IG1haWxBZGRyZXNzLnNwbGl0KFwiQFwiKVxuXG5cdFx0aWYgKHBhcnRzLmxlbmd0aCA9PT0gMikge1xuXHRcdFx0cmV0dXJuIHBhcnRzWzFdXG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiBudWxsXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdHJldHVybiBudWxsXG5cdH1cbn1cblxuLyoqXG4gKiBQYXJzZXMgdGhlIGdpdmVuIHN0cmluZyBmb3IgYSBmaXN0IG5hbWUgYW5kIGEgbGFzdCBuYW1lIHNlcGFyYXRlZCBieSB3aGl0ZXNwYWNlLiBJZiB0aGVyZSBpcyBvbmx5IG9uZSBwYXJ0IGl0IGlzIHJlZ2FyZGVkIGFzIGZpcnN0IG5hbWUuIElmIHRoZXJlIGFyZSBtb3JlIHRoYW4gdHdvIHBhcnRzLCBvbmx5IHRoZSBmaXJzdCBvbmUgaXMgcmVnYXJkZWQgYXMgZmlyc3QgbmFtZS5cbiAqIEBwYXJhbSBmdWxsTmFtZSBUaGUgZnVsbCBuYW1lIHRvIGNoZWNrLlxuICogQHJldHVybiBSZXR1cm5zIGFuIG9iamVjdCB3aXRoIHRoZSBhdHRyaWJ1dGVzIFwiZmlyc3ROYW1lXCIgYW5kIFwibGFzdE5hbWVcIi5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZ1bGxOYW1lVG9GaXJzdEFuZExhc3ROYW1lKGZ1bGxOYW1lOiBzdHJpbmcpOiB7XG5cdGZpcnN0TmFtZTogc3RyaW5nXG5cdGxhc3ROYW1lOiBzdHJpbmdcbn0ge1xuXHRmdWxsTmFtZSA9IGZ1bGxOYW1lLnRyaW0oKVxuXG5cdGlmIChmdWxsTmFtZSA9PT0gXCJcIikge1xuXHRcdHJldHVybiB7XG5cdFx0XHRmaXJzdE5hbWU6IFwiXCIsXG5cdFx0XHRsYXN0TmFtZTogXCJcIixcblx0XHR9XG5cdH1cblxuXHRjb25zdCBzZXBhcmF0b3IgPSBmdWxsTmFtZS5pbmRleE9mKFwiIFwiKVxuXG5cdGlmIChzZXBhcmF0b3IgIT09IC0xKSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdGZpcnN0TmFtZTogZnVsbE5hbWUuc3Vic3RyaW5nKDAsIHNlcGFyYXRvciksXG5cdFx0XHRsYXN0TmFtZTogZnVsbE5hbWUuc3Vic3RyaW5nKHNlcGFyYXRvciArIDEpLFxuXHRcdH1cblx0fSBlbHNlIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0Zmlyc3ROYW1lOiBmdWxsTmFtZSxcblx0XHRcdGxhc3ROYW1lOiBcIlwiLFxuXHRcdH1cblx0fVxufVxuXG4vKipcbiAqIFBhcnNlcyB0aGUgZ2l2ZW4gZW1haWwgYWRkcmVzcyBmb3IgYSBmaXN0IG5hbWUgYW5kIGEgbGFzdCBuYW1lIHNlcGFyYXRlZCBieSB3aGl0ZXNwYWNlLCBjb21tYSwgZG90IG9yIHVuZGVyc2NvcmUuXG4gKiBAcGFyYW0gbWFpbEFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gY2hlY2suXG4gKiBAcmV0dXJuIFJldHVybnMgYW4gb2JqZWN0IHdpdGggdGhlIGF0dHJpYnV0ZXMgXCJmaXJzdE5hbWVcIiBhbmQgXCJsYXN0TmFtZVwiLlxuICovXG5leHBvcnQgZnVuY3Rpb24gbWFpbEFkZHJlc3NUb0ZpcnN0QW5kTGFzdE5hbWUobWFpbEFkZHJlc3M6IHN0cmluZyk6IHtcblx0Zmlyc3ROYW1lOiBzdHJpbmdcblx0bGFzdE5hbWU6IHN0cmluZ1xufSB7XG5cdGNvbnN0IGFkZHIgPSBtYWlsQWRkcmVzcy5zdWJzdHJpbmcoMCwgbWFpbEFkZHJlc3MuaW5kZXhPZihcIkBcIikpXG5cdGxldCBuYW1lRGF0YVxuXG5cdGlmIChhZGRyLmluZGV4T2YoXCIuXCIpICE9PSAtMSkge1xuXHRcdG5hbWVEYXRhID0gYWRkci5zcGxpdChcIi5cIilcblx0fSBlbHNlIGlmIChhZGRyLmluZGV4T2YoXCJfXCIpICE9PSAtMSkge1xuXHRcdG5hbWVEYXRhID0gYWRkci5zcGxpdChcIl9cIilcblx0fSBlbHNlIGlmIChhZGRyLmluZGV4T2YoXCItXCIpICE9PSAtMSkge1xuXHRcdG5hbWVEYXRhID0gYWRkci5zcGxpdChcIi1cIilcblx0fSBlbHNlIHtcblx0XHRuYW1lRGF0YSA9IFthZGRyXVxuXHR9XG5cblx0Ly8gZmlyc3QgY2hhcmFjdGVyIHVwcGVyIGNhc2Vcblx0Zm9yIChsZXQgaSA9IDA7IGkgPCBuYW1lRGF0YS5sZW5ndGg7IGkrKykge1xuXHRcdGlmIChuYW1lRGF0YVtpXS5sZW5ndGggPiAwKSB7XG5cdFx0XHRuYW1lRGF0YVtpXSA9IG5hbWVEYXRhW2ldLnN1YnN0cmluZygwLCAxKS50b1VwcGVyQ2FzZSgpICsgbmFtZURhdGFbaV0uc3Vic3RyaW5nKDEpXG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIHtcblx0XHRmaXJzdE5hbWU6IG5hbWVEYXRhWzBdLFxuXHRcdGxhc3ROYW1lOiBuYW1lRGF0YS5zbGljZSgxKS5qb2luKFwiIFwiKSxcblx0fVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7O0FBd0JPLFNBQVMsZUFBZUEsV0FBaUM7Q0FDL0QsSUFBSSxNQUFNLElBQUksSUFBSTtDQUVsQixNQUFNLDhCQUE4QixDQUFDQyxZQUE2QztFQUNqRixNQUFNLHFCQUFxQiwyQkFBMkIsUUFBUTtBQUM5RCxPQUFLLG1CQUFvQixRQUFPO0FBQ2hDLFNBQU87R0FDTixNQUFNLG1CQUFtQjtHQUN6QixTQUFTLG1CQUFtQjtFQUM1QjtDQUNEO0NBRUQsTUFBTSxZQUFZLElBQUksU0FDcEIsTUFBTSxJQUFJLENBQ1YsSUFBSSxDQUFDLFlBQVk7QUFDakIsT0FBSyxRQUFTLFFBQU87RUFDckIsTUFBTSxpQkFBaUIsbUJBQW1CLFFBQVE7QUFDbEQsT0FBSyxlQUFnQixRQUFPO0FBQzVCLFNBQU8sNEJBQTRCLGVBQWU7Q0FDbEQsRUFBQyxDQUNELE9BQU8sUUFBUTtDQUNqQixNQUFNQyxTQUFjO0VBQ25CLFlBQVk7R0FDWCxJQUFJLFVBQVUsU0FBUyxJQUFJLFlBQVk7R0FDdkMsSUFBSTtHQUNKLEtBQUs7RUFDTDtFQUNELFFBQVE7RUFDUixTQUFTO0VBQ1QsTUFBTTtDQUNOO0FBRUQsTUFBSyxJQUFJLHVCQUF1QixJQUFJLGFBQWEsWUFBWSxXQUFZLFFBQU87QUFHaEYsTUFBSyxJQUFJLFFBQVEsSUFBSSxhQUFhLFNBQVMsRUFBRTtFQUM1QyxJQUFJLFlBQVksS0FBSyxHQUFHLGFBQWE7RUFDckMsSUFBSSxhQUFhLEtBQUs7QUFFdEIsVUFBUSxXQUFSO0FBQ0MsUUFBSztBQUNKLFdBQU8sVUFBVTtBQUNqQjtBQUVELFFBQUs7QUFDSixXQUFPLE9BQU8sa0JBQWtCLFdBQVc7QUFDM0M7QUFFRCxRQUFLO0FBQ0wsUUFBSztBQUNMLFFBQUssT0FBTztBQUNYLFFBQUksT0FBTyxXQUFXLGNBQWMsS0FBTSxRQUFPLFdBQVcsYUFBYSxDQUFFO0lBQzNFLE1BQU0sZ0JBQWdCLFdBQ3BCLE1BQU0sSUFBSSxDQUNWLElBQUksQ0FBQ0QsWUFBb0IsNEJBQTRCLFFBQVEsQ0FBQyxDQUM5RCxPQUFPLFFBQVE7QUFDakIsV0FBTyxXQUFXLFdBQVcsS0FBSyxHQUFHLGNBQWM7QUFDbkQ7R0FDQTtBQUVELFFBQUs7QUFDSixRQUFJLE9BQU8sVUFBVSxLQUFNLFFBQU8sU0FBUyxDQUFFO0FBQzdDLFdBQU8sT0FBTyxLQUFLLFdBQVc7QUFDOUI7QUFFRCxXQUNDLFNBQVEsS0FBSyxvQ0FBb0M7RUFDbEQ7Q0FDRDtBQUVELFFBQU87QUFDUDtBQVFNLFNBQVMsMkJBQTJCRSxRQU05QjtBQUNaLFVBQVMsT0FBTyxNQUFNO0FBRXRCLEtBQUksV0FBVyxHQUNkLFFBQU87Q0FHUixJQUFJLGFBQWEsT0FBTyxRQUFRLElBQUk7QUFFcEMsS0FBSSxlQUFlLElBQUk7RUFDdEIsTUFBTSxXQUFXLE9BQU8sUUFBUSxLQUFLLFdBQVc7QUFFaEQsTUFBSSxhQUFhLEdBQ2hCLFFBQU87RUFHUixNQUFNLHFCQUFxQixzQkFBc0IsT0FBTyxVQUFVLGFBQWEsR0FBRyxTQUFTLENBQUM7QUFFNUYsTUFBSSxzQkFBc0IsU0FBUyxjQUFjLG9CQUFvQixNQUFNLENBQzFFLFFBQU87RUFHUixNQUFNLE9BQU8sT0FBTyxVQUFVLEdBQUcsV0FBVyxDQUFDLE1BQU07QUFDbkQsU0FBTztHQUNBO0dBQ04sYUFBYTtFQUNiO0NBQ0QsT0FBTTtBQUNOLGVBQWEsT0FBTyxZQUFZLElBQUk7QUFDcEM7RUFDQSxNQUFNLHFCQUFxQixzQkFBc0IsT0FBTyxVQUFVLFdBQVcsQ0FBQztBQUU5RSxNQUFJLHNCQUFzQixTQUFTLGNBQWMsb0JBQW9CLE1BQU0sQ0FDMUUsUUFBTztFQUdSLE1BQU0sT0FBTyxPQUFPLFVBQVUsR0FBRyxXQUFXLENBQUMsTUFBTTtBQUNuRCxTQUFPO0dBQ0E7R0FDTixhQUFhO0VBQ2I7Q0FDRDtBQUNEO0FBUU0sU0FBUyxzQkFBc0JDLGFBQW9DO0NBQ3pFLE1BQU0scUJBQXFCLFlBQVksYUFBYSxDQUFDLE1BQU07QUFFM0QsS0FBSSxjQUFjLG9CQUFvQixNQUFNLENBQzNDLFFBQU87QUFHUixRQUFPO0FBQ1A7QUFFTSxTQUFTLGNBQWNBLGFBQW9DO0NBQ2pFLE1BQU0scUJBQXFCLHNCQUFzQixZQUFZO0FBRTdELEtBQUksb0JBQW9CO0VBQ3ZCLE1BQU0sUUFBUSxZQUFZLE1BQU0sSUFBSTtBQUVwQyxNQUFJLE1BQU0sV0FBVyxFQUNwQixRQUFPLE1BQU07SUFFYixRQUFPO0NBRVIsTUFDQSxRQUFPO0FBRVI7QUFPTSxTQUFTLDJCQUEyQkMsVUFHekM7QUFDRCxZQUFXLFNBQVMsTUFBTTtBQUUxQixLQUFJLGFBQWEsR0FDaEIsUUFBTztFQUNOLFdBQVc7RUFDWCxVQUFVO0NBQ1Y7Q0FHRixNQUFNLFlBQVksU0FBUyxRQUFRLElBQUk7QUFFdkMsS0FBSSxjQUFjLEdBQ2pCLFFBQU87RUFDTixXQUFXLFNBQVMsVUFBVSxHQUFHLFVBQVU7RUFDM0MsVUFBVSxTQUFTLFVBQVUsWUFBWSxFQUFFO0NBQzNDO0lBRUQsUUFBTztFQUNOLFdBQVc7RUFDWCxVQUFVO0NBQ1Y7QUFFRjtBQU9NLFNBQVMsOEJBQThCRCxhQUc1QztDQUNELE1BQU0sT0FBTyxZQUFZLFVBQVUsR0FBRyxZQUFZLFFBQVEsSUFBSSxDQUFDO0NBQy9ELElBQUk7QUFFSixLQUFJLEtBQUssUUFBUSxJQUFJLEtBQUssR0FDekIsWUFBVyxLQUFLLE1BQU0sSUFBSTtTQUNoQixLQUFLLFFBQVEsSUFBSSxLQUFLLEdBQ2hDLFlBQVcsS0FBSyxNQUFNLElBQUk7U0FDaEIsS0FBSyxRQUFRLElBQUksS0FBSyxHQUNoQyxZQUFXLEtBQUssTUFBTSxJQUFJO0lBRTFCLFlBQVcsQ0FBQyxJQUFLO0FBSWxCLE1BQUssSUFBSSxJQUFJLEdBQUcsSUFBSSxTQUFTLFFBQVEsSUFDcEMsS0FBSSxTQUFTLEdBQUcsU0FBUyxFQUN4QixVQUFTLEtBQUssU0FBUyxHQUFHLFVBQVUsR0FBRyxFQUFFLENBQUMsYUFBYSxHQUFHLFNBQVMsR0FBRyxVQUFVLEVBQUU7QUFJcEYsUUFBTztFQUNOLFdBQVcsU0FBUztFQUNwQixVQUFVLFNBQVMsTUFBTSxFQUFFLENBQUMsS0FBSyxJQUFJO0NBQ3JDO0FBQ0QifQ==